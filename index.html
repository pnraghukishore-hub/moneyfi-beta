<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ═══ PWA: MoneyFi ═══ -->
  <link rel="manifest" href="./manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="MoneyFi">
  <meta name="theme-color" content="#1E2A6E">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <!-- ══════════════════════ -->
  <!-- ═══ Firebase SDKs ═══ -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- ═══════════════════ -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoneyFi – Personal Finance</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #FFF9E6;
      --bg-cream: #FFFBF0;
      --yellow: #F5C842;
      --yellow-light: #FFF0B0;
      --blue-circle: #3B4A9C;
      --text-dark: #2D3250;
      --text-med: #5A6070;
      --text-light: #9AA0B2;
      --white: #FFFFFF;
      --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
      --card-shadow-hover: 0 8px 30px rgba(0,0,0,0.13);
      --radius: 20px;
      --radius-sm: 12px;
      --food: #FF6B35;
      --transport: #4A9EFF;
      --housing: #FF8C42;
      --health: #4ECDC4;
      --shopping: #FF4757;
      --membership: #FFBE0B;
      --giving: #FF6B9D;
      --income: #10B981;
      --expenses: #EF4444;
      --debt: #8B5CF6;
      --gold: #C8900A;
      --silver: #6E7A8A;
      --platinum: #4A5C6E;
      --portfolio: #7C3AED;
      --portfolio-light: #F3EEFF;
      --primary: #1E2A6E;
      --primary-light: #F0F4FF;

      /* Theme background variables (overridable by themes) */
      --theme-bg-main: #FFF9E6;
      --theme-overlay: none;
      --theme-card-extra: none;
    }

    /* ══ THEMES ══ */
    body.theme-looney { 
      --bg: #FFF0F5; --bg-cream: #FFF8FB; 
      background: #FFF0F5 !important;
    }
    body.theme-jungle { 
      --bg: #E8F5E9; --bg-cream: #F1F8E9; 
      background: #E8F5E9 !important;
    }
    body.theme-space { 
      --bg: #0D0D1A; --bg-cream: #12122A;
      --text-dark: #E8E8FF; --text-med: #A0A8CC; --text-light: #6070A0;
      --white: #1A1A30;
      background: #0D0D1A !important;
    }
    body.theme-ocean { 
      --bg: #E0F4FF; --bg-cream: #ECF9FF;
      background: #E0F4FF !important;
    }

    body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text-dark); min-height: 100vh; position: relative; overflow-x: hidden; }

    /* Theme decorations */
    .theme-deco { position: fixed; pointer-events: none; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-looney .theme-deco.looney-deco { opacity: 1; }
    body.theme-jungle .theme-deco.jungle-deco { opacity: 1; }
    body.theme-space .theme-deco.space-deco { opacity: 1; }
    body.theme-ocean .theme-deco.ocean-deco { opacity: 1; }

    /* ── TOP BAR ── */
    .topbar { background: var(--bg); padding: 16px 20px 0; display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 10; }
    .topbar-title { font-size: 1.3em; font-weight: 900; color: var(--text-dark); }
    .topbar-badge { background: var(--yellow); color: var(--text-dark); font-weight: 800; font-size: 0.8em; padding: 4px 12px; border-radius: 20px; cursor: pointer; }
    /* Quick-access icon buttons in topbar - fixed positioning replaced with flex in topbar */
    .topbar-icons { display: flex; align-items: center; gap: 6px; }
    .topbar-icon-btn { background: var(--white); border: none; border-radius: 50%; width: 34px; height: 34px; font-size: 1em; cursor: pointer; box-shadow: var(--card-shadow); display: flex; align-items: center; justify-content: center; transition: transform 0.2s; flex-shrink: 0; }
    .topbar-icon-btn:hover { transform: scale(1.1); }

    /* ── BOTTOM NAV ── */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--white); display: flex; justify-content: space-around; align-items: center; padding: 10px 0 18px; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 100; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; color: var(--text-light); font-size: 0.68em; font-weight: 700; transition: color 0.2s; background: none; border: none; padding: 0 10px; }
    .nav-item .nav-icon { font-size: 1.4em; }
    .nav-item.active { color: var(--yellow); }
    .nav-item.active .nav-icon { background: var(--yellow); color: white; width: 38px; height: 38px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.05em; }
    /* Floating add button */
    /* Floating add button + launcher */
    .fab-add { position: fixed; bottom: 72px; right: 20px; width: 56px; height: 56px; background: var(--yellow); border-radius: 50%; border: none; font-size: 1.8em; font-weight: 900; cursor: pointer; box-shadow: 0 4px 20px rgba(245,200,66,0.55); z-index: 200; display: flex; align-items: center; justify-content: center; transition: transform 0.25s, box-shadow 0.2s; animation: fabPulse 2.8s ease-in-out infinite; color: var(--text-dark); line-height: 1; }
    .fab-add:hover { transform: scale(1.12); box-shadow: 0 8px 28px rgba(245,200,66,0.7); animation: none; }
    .fab-add.open { transform: rotate(45deg); animation: none; box-shadow: 0 8px 28px rgba(245,200,66,0.7); }
    @keyframes fabPulse { 0%,100%{box-shadow:0 4px 20px rgba(245,200,66,0.55)} 50%{box-shadow:0 4px 30px rgba(245,200,66,0.85),0 0 0 8px rgba(245,200,66,0.15)} }
    @keyframes goalsFabPulse { 0%,100%{box-shadow:0 4px 20px rgba(30,42,110,0.45)} 50%{box-shadow:0 6px 28px rgba(30,42,110,0.7),0 0 0 8px rgba(30,42,110,0.12)} }
    /* Launcher menu */
    .fab-menu { position: fixed; bottom: 138px; right: 16px; display: flex; flex-direction: column; gap: 10px; z-index: 199; pointer-events: none; }
    .fab-menu-item { display: flex; align-items: center; gap: 10px; justify-content: flex-end; opacity: 0; transform: translateY(16px) scale(0.9); transition: opacity 0.2s, transform 0.2s; pointer-events: none; }
    .fab-menu-item.visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }
    .fab-menu-item:nth-child(1).visible { transition-delay: 0.05s; }
    .fab-menu-item:nth-child(2).visible { transition-delay: 0.02s; }
    .fab-menu-item:nth-child(3).visible { transition-delay: 0s; }
    .fab-menu-label { background: var(--white); color: var(--text-dark); font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; padding: 6px 12px; border-radius: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.12); white-space: nowrap; }
    .fab-menu-btn { width: 44px; height: 44px; border-radius: 50%; border: none; font-size: 1.2em; cursor: pointer; box-shadow: 0 3px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    /* Backdrop */
    .fab-backdrop { position: fixed; inset: 0; z-index: 198; display: none; }
    .fab-backdrop.open { display: block; }

    /* ── SCREENS ── */
    .screen { display: none; padding: 16px 20px 100px; position: relative; z-index: 1; }
    .screen.active { display: block; }

    /* ── TIME PERIOD SELECTOR (innovative calendar strip) ── */
    .time-period-bar { display: flex; background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin: 12px 0 16px; overflow: hidden; }
    .period-tab { flex: 1; padding: 10px 4px; border: none; background: none; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.78em; color: var(--text-light); cursor: pointer; transition: all 0.2s; text-align: center; }
    .period-tab.active { background: var(--yellow); color: var(--text-dark); border-radius: var(--radius-sm); margin: 3px; }
    .period-nav { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 16px; }
    .period-nav button { background: none; border: none; font-size: 1.3em; cursor: pointer; color: var(--text-med); padding: 4px 8px; border-radius: 8px; transition: background 0.15s; }
    .period-nav button:hover { background: rgba(0,0,0,0.06); }
    .period-nav .period-label { font-size: 1em; font-weight: 800; color: var(--text-dark); min-width: 180px; text-align: center; }

    /* Day/Week detail row - shows mini days */
    .period-detail { display: none; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 12px; padding: 0 2px; }
    .period-detail::-webkit-scrollbar { display: none; }
    .period-detail.show { display: flex; }
    .day-chip { flex-shrink: 0; background: var(--white); border-radius: 10px; padding: 8px 10px; text-align: center; min-width: 44px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
    .day-chip.today { border-color: var(--yellow); background: var(--yellow-light); }
    .day-chip.selected { background: var(--yellow); }
    .day-chip .dc-day { font-size: 0.65em; font-weight: 800; color: var(--text-light); text-transform: uppercase; }
    .day-chip .dc-num { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .day-chip.selected .dc-day, .day-chip.selected .dc-num { color: var(--text-dark); }

    /* ── HOME ── */
    .spending-hero { text-align: center; padding: 4px 0 16px; }
    .spending-label { color: var(--text-med); font-size: 0.9em; font-weight: 600; }
    .spending-amount { font-size: 2.8em; font-weight: 900; color: var(--text-dark); margin: 4px 0; }

    /* Income Section on Home */
    .home-income-section { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .home-income-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .home-income-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .home-income-total { font-size: 1.1em; font-weight: 900; color: var(--income); }
    .income-sub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .income-sub-card { background: #F0FBF3; border-radius: var(--radius-sm); padding: 14px 10px; text-align: center; cursor: pointer; transition: transform 0.2s; }
    .income-sub-card:hover { transform: translateY(-2px); }
    .income-sub-card .isc-icon { font-size: 1.5em; margin-bottom: 6px; }
    .income-sub-card .isc-name { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-bottom: 4px; }
    .income-sub-card .isc-amount { font-size: 1em; font-weight: 900; color: var(--income); }

    .budget-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
    .budget-card { background: var(--white); border-radius: var(--radius); padding: 16px 12px 14px; text-align: center; box-shadow: var(--card-shadow); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .budget-card:hover { transform: translateY(-2px); box-shadow: var(--card-shadow-hover); }
    .budget-card .cat-icon { width: 48px; height: 48px; border-radius: 14px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.4em; }
    .budget-card .cat-name { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-bottom: 4px; }
    .budget-card .cat-amount { font-size: 1.05em; font-weight: 900; color: var(--text-dark); }
    .budget-card .cat-bar { height: 3px; background: #F0F0F0; border-radius: 4px; margin-top: 10px; overflow: hidden; }
    .budget-card .cat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }
    .budget-card.food { background: #FFF3EE; } .budget-card.food .cat-icon { background: #FFE0D3; }
    .budget-card.transport { background: #EEF5FF; } .budget-card.transport .cat-icon { background: #D6EAFF; }
    .budget-card.housing { background: #FFF5EE; } .budget-card.housing .cat-icon { background: #FFE5CC; }
    .budget-card.health { background: #F0FAFA; } .budget-card.health .cat-icon { background: #D0F0EE; }
    .budget-card.shopping { background: #FFF0F0; } .budget-card.shopping .cat-icon { background: #FFD6D6; }
    .budget-card.membership { background: #FFFBEE; } .budget-card.membership .cat-icon { background: #FFF0C0; }
    .budget-card.giving { background: #FFF0F7; } .budget-card.giving .cat-icon { background: #FFD6EA; }
    .budget-card.invest { background: #F0FBF3; } .budget-card.invest .cat-icon { background: #C6F0D0; }
    .budget-card.debt-cat { background: #F5F0FF; } .budget-card.debt-cat .cat-icon { background: #E0D5FF; }
    .budget-card.other-cat { background: #F5F8FF; } .budget-card.other-cat .cat-icon { background: #D8E5FF; }

    /* ── TRANSACTIONS ── */
    .search-bar { background: var(--white); border-radius: var(--radius-sm); padding: 12px 16px; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; box-shadow: var(--card-shadow); }
    .search-bar input { border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.95em; color: var(--text-dark); flex: 1; outline: none; }
    .search-bar input::placeholder { color: var(--text-light); }

    .filter-row { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
    .filter-chip { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 6px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.78em; color: var(--text-med); cursor: pointer; box-shadow: var(--card-shadow); white-space: nowrap; transition: all 0.2s; }
    .filter-chip.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }
    .date-filter-input { background: var(--white); border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 7px 10px; font-family: 'Nunito', sans-serif; font-size: 0.8em; font-weight: 700; color: var(--text-dark); outline: none; }
    .date-filter-input:focus { border-color: var(--yellow); }

    .tx-date-group { margin-bottom: 16px; }
    .tx-date-label { font-size: 0.82em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; padding: 0 4px; display: flex; justify-content: space-between; }
    .tx-row { background: var(--white); border-radius: var(--radius-sm); padding: 12px 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.15s; }
    .tx-row:hover { transform: translateX(4px); }
    .tx-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; flex-shrink: 0; }
    .tx-info { flex: 1; }
    .tx-cat { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .tx-sub { font-size: 0.78em; color: var(--text-light); font-weight: 600; margin-top: 2px; }
    .tx-amount { font-weight: 900; font-size: 1em; }
    .tx-amount.expense { color: var(--expenses); }
    .tx-amount.income-c { color: var(--income); }
    .tx-amount.invest-c { color: var(--portfolio); }
    .tx-time { font-size: 0.72em; color: var(--text-light); margin-top: 2px; text-align: right; }

    /* ── CATEGORY MANAGER ── */
    .cat-mgr-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:14px; }
    .cat-mgr-tab { background:#F0F0F0; border:none; border-radius:20px; padding:6px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; color:var(--text-med); cursor:pointer; transition:all 0.2s; }
    .cat-mgr-tab.active { background:var(--yellow); color:var(--text-dark); }
    .cat-pills-wrap { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px; min-height:36px; }
    .cat-pill { display:flex; align-items:center; gap:5px; background:var(--bg-cream); border:1.5px solid #E8E8E8; border-radius:20px; padding:6px 10px 6px 12px; font-size:0.8em; font-weight:700; color:var(--text-dark); }
    .cat-pill-del { background:none; border:none; cursor:pointer; color:var(--text-light); font-size:0.85em; font-weight:900; line-height:1; padding:0; transition:color 0.15s; }
    .cat-pill-del:hover { color:var(--expenses); }
    .cat-add-row { display:flex; gap:8px; align-items:center; }
    .cat-add-input { flex:1; border:1.5px solid #E8E8E8; border-radius:10px; padding:9px 12px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; background:var(--white); }
    .cat-add-input:focus { border-color:var(--yellow); }
    .cat-add-btn { background:var(--yellow); border:none; border-radius:10px; padding:9px 16px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.88em; cursor:pointer; color:var(--text-dark); white-space:nowrap; }
    .cat-add-btn:hover { background:#e8b900; }
    /* Quick-add subcats with delete on hold */
    .qa-sub-pill { position:relative; }
    .qa-sub-pill .qa-pill-del { display:none; position:absolute; top:-6px; right:-6px; background:var(--expenses); color:white; border:none; border-radius:50%; width:16px; height:16px; font-size:0.6em; font-weight:900; cursor:pointer; align-items:center; justify-content:center; line-height:1; padding:0; }
    .qa-sub-pill.delete-mode .qa-pill-del { display:flex; }

    /* ── CALENDAR MODULE ── */
    .cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
    .cal-month-title { font-size:1.25em; font-weight:900; color:var(--text-dark); }
    .cal-nav-btn { background:var(--white); border:none; border-radius:12px; width:38px; height:38px; font-size:1.4em; color:var(--text-dark); cursor:pointer; box-shadow:var(--card-shadow); display:flex; align-items:center; justify-content:center; font-weight:900; transition:background 0.15s; line-height:1; }
    .cal-nav-btn:hover { background:var(--yellow); }
    .cal-summary { display:flex; background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:14px 10px; margin-bottom:14px; align-items:center; justify-content:space-around; }
    .cal-sum-item { text-align:center; }
    .cal-sum-label { font-size:0.68em; font-weight:800; color:var(--text-light); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.4px; }
    .cal-sum-val { font-size:1.05em; font-weight:900; }
    .cal-sum-item.income .cal-sum-val { color:var(--income); }
    .cal-sum-item.expense .cal-sum-val { color:var(--expenses); }
    .cal-sum-item.savings .cal-sum-val { color:#7C3AED; }
    .cal-sum-item.net .cal-sum-val { color:var(--text-dark); }
    .cal-sum-divider { width:1px; height:32px; background:#F0F0F0; }
    .cal-grid-wrap { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); overflow:hidden; margin-bottom:14px; }
    .cal-dow-row { display:grid; grid-template-columns:repeat(7,1fr); padding:10px 0 8px; border-bottom:1px solid #F5F5F5; }
    .cal-dow { text-align:center; font-size:0.7em; font-weight:900; color:var(--text-light); letter-spacing:0.3px; }
    .cal-grid { display:grid; grid-template-columns:repeat(7,1fr); }
    .cal-cell { border-right:1px solid #F5F5F5; border-bottom:1px solid #F5F5F5; padding:6px 3px 5px; min-height:70px; cursor:pointer; transition:background 0.15s; display:flex; flex-direction:column; align-items:center; }
    .cal-cell:nth-child(7n) { border-right:none; }
    .cal-cell:hover:not(.empty) { background:#FAFAFA; }
    .cal-cell.empty { cursor:default; }
    .cal-cell.today .cal-day-num { background:var(--yellow); color:var(--text-dark); }
    .cal-cell.selected { background:var(--yellow-light); }
    .cal-cell.selected .cal-day-num { background:var(--yellow); }
    .cal-day-num { width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8em; font-weight:800; color:var(--text-dark); margin-bottom:4px; transition:background 0.15s; }
    .cal-dots { display:flex; gap:2px; flex-wrap:wrap; justify-content:center; margin-bottom:3px; min-height:8px; }
    .cal-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; }
    .cal-cell-amt { font-size:0.58em; font-weight:900; line-height:1.3; text-align:center; }
    .cal-detail-header { font-size:0.82em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; padding:0 4px; display:flex; justify-content:space-between; align-items:center; }
    .cal-detail-header .cal-det-right { display:flex; gap:8px; }
    .cal-empty-day { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:24px; text-align:center; color:var(--text-light); }

    /* ── HOME TABS (Spending / Investment) ── */
    .home-tab-bar { display:flex; background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); margin-bottom:16px; padding:4px; gap:4px; }
    .home-tab-btn { flex:1; padding:11px 8px; border:none; border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:900; font-size:0.88em; cursor:pointer; background:none; color:var(--text-light); transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:5px; }
    .home-tab-btn.active { background:var(--yellow); color:var(--text-dark); box-shadow:0 2px 10px rgba(245,200,66,0.4); }
    .home-section { display:none; }
    .home-section.active { display:block; }

    /* ── INVESTMENT HOME GRID ── */
    .invest-home-hero { text-align:center; padding:4px 0 16px; }
    .invest-home-hero-label { font-size:0.88em; font-weight:700; color:var(--text-med); }
    .invest-home-hero-amt { font-size:2.6em; font-weight:900; color:var(--text-dark); margin:4px 0; }
    .invest-cat-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-bottom:16px; }
    .invest-cat-card { background:var(--white); border-radius:var(--radius); padding:16px; box-shadow:var(--card-shadow); cursor:pointer; transition:transform 0.2s,box-shadow 0.2s; }
    .invest-cat-card:hover { transform:translateY(-2px); box-shadow:var(--card-shadow-hover); }
    .inv-card-icon { width:46px; height:46px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:1.35em; margin-bottom:10px; }
    .inv-card-label { font-size:0.72em; font-weight:800; color:var(--text-med); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.3px; }
    .inv-card-amt { font-size:1.08em; font-weight:900; color:var(--text-dark); }
    .inv-card-units { font-size:0.72em; color:var(--text-light); font-weight:600; margin-top:3px; }
    .inv-card-bar { height:3px; background:#F0F0F0; border-radius:4px; margin-top:10px; overflow:hidden; }
    .inv-card-bar-fill { height:100%; border-radius:4px; transition:width 0.6s; }

    /* ── INVESTMENT QUICK-ADD MODAL ── */
    .inv-type-tabs { display:flex; gap:6px; overflow-x:auto; scrollbar-width:none; margin-bottom:16px; padding-bottom:2px; }
    .inv-type-tabs::-webkit-scrollbar { display:none; }
    .inv-type-chip { flex-shrink:0; border:none; border-radius:20px; padding:7px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; cursor:pointer; background:#F0F0F0; color:var(--text-med); transition:all 0.2s; }
    .inv-type-chip.active { color:white; }
    .inv-fields-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:14px; }
    .inv-field-box { display:flex; flex-direction:column; gap:5px; }
    .inv-field-box.full { grid-column:span 2; }
    .inv-field-box label { font-size:0.7em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; }
    .inv-field-input, .inv-field-select { border:1.5px solid #EEE; border-radius:10px; padding:9px 10px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; background:var(--white); width:100%; }
    .inv-field-input:focus, .inv-field-select:focus { border-color:#7C3AED; }
    .inv-total-pill { background:#F3EEFF; border-radius:12px; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
    .inv-total-pill-label { font-size:0.75em; font-weight:900; color:#7C3AED; }
    .inv-total-pill-val { font-size:1.2em; font-weight:900; color:#7C3AED; }
    .inv-save-btn { width:100%; background:#7C3AED; border:none; border-radius:var(--radius-sm); padding:16px; font-family:'Nunito',sans-serif; font-weight:900; font-size:1em; color:white; cursor:pointer; transition:background 0.2s; }
    .inv-save-btn:hover { background:#6D28D9; }

    /* ── CURRENCY PICKER ── */
    .curr-search { width:100%; border:1.5px solid #EEE; border-radius:10px; padding:10px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; margin-bottom:8px; box-sizing:border-box; }
    .curr-search:focus { border-color:var(--yellow); }
    .curr-list { max-height:300px; overflow-y:auto; }
    .curr-item { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; cursor:pointer; transition:background 0.15s; }
    .curr-item:hover { background:#F5F5F5; }
    .curr-item.active { background:var(--yellow-light); }
    .curr-flag { font-size:1.3em; width:28px; text-align:center; flex-shrink:0; }
    .curr-info { flex:1; }
    .curr-name { font-weight:800; font-size:0.88em; color:var(--text-dark); }
    .curr-country { font-size:0.72em; color:var(--text-light); font-weight:600; }
    .curr-code { font-weight:900; font-size:0.88em; color:var(--text-med); }
    .curr-symbol { font-size:1em; font-weight:900; color:var(--text-dark); min-width:20px; text-align:right; }

    /* ── HOME CARD MANAGER (Settings) ── */
    .home-card-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:14px; }
    .home-card-item { display:flex; align-items:center; gap:8px; background:#F8F8F8; border-radius:10px; padding:8px 10px; }
    .home-card-item-icon { font-size:1.1em; }
    .home-card-item-label { flex:1; font-weight:800; font-size:0.82em; color:var(--text-dark); }
    .home-card-toggle { background:none; border:none; cursor:pointer; font-size:1em; padding:0; color:var(--text-light); transition:color 0.15s; font-weight:900; }
    .home-card-toggle.on { color:var(--income); }
    .home-card-add-row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:4px; }
    .home-card-emoji-pick { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:8px; }
    .emoji-opt { font-size:1.2em; cursor:pointer; padding:4px; border-radius:6px; transition:background 0.15s; }
    .emoji-opt:hover, .emoji-opt.selected { background:var(--yellow-light); }

    /* ── STATS ── */
    .chart-card { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .chart-title { font-weight: 800; font-size: 0.9em; color: var(--text-med); margin-bottom: 14px; }
    .chart-container { position: relative; height: 200px; }
    .spending-tops { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .top-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .top-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .top-label { flex: 1; font-weight: 700; font-size: 0.9em; color: var(--text-dark); }
    .top-pct { font-weight: 800; font-size: 0.85em; color: var(--text-med); }

    /* ── ACCOUNT ── */
    .networth-card { background: var(--white); border-radius: var(--radius); padding: 24px; text-align: center; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .nw-label { color: var(--text-light); font-size: 0.85em; font-weight: 700; margin-bottom: 8px; }
    .nw-amount { font-size: 2.5em; font-weight: 900; color: var(--text-dark); }
    .nw-sub { display: flex; justify-content: center; gap: 24px; margin-top: 12px; flex-wrap: wrap; }
    .nw-sub-item { font-size: 0.82em; font-weight: 700; color: var(--text-med); }
    .nw-sub-item span { color: var(--text-dark); display: block; font-size: 1.15em; }
    .account-section-title { font-weight: 900; font-size: 0.9em; color: var(--text-med); margin-bottom: 12px; letter-spacing: 0.3px; }
    .account-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
    .account-card { background: var(--white); border-radius: var(--radius-sm); padding: 14px 10px; text-align: center; box-shadow: var(--card-shadow); cursor: pointer; }
    .account-card .acc-icon { font-size: 1.6em; margin-bottom: 6px; }
    .account-card .acc-name { font-size: 0.72em; font-weight: 700; color: var(--text-light); margin-bottom: 4px; }
    .account-card .acc-amount { font-size: 0.95em; font-weight: 900; color: var(--text-dark); }
    .account-card.credit .acc-amount { color: var(--expenses); }

    /* ── ADD SCREEN ── */
    .add-type-toggle { display: flex; background: var(--white); border-radius: var(--radius-sm); padding: 4px; gap: 4px; box-shadow: var(--card-shadow); margin-bottom: 16px; overflow-x: auto; }
    .add-type-btn { flex: 1; padding: 10px 8px; border: none; border-radius: 10px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; cursor: pointer; background: none; color: var(--text-light); white-space: nowrap; transition: all 0.2s; }
    .add-type-btn.active { background: var(--yellow); color: var(--text-dark); box-shadow: 0 2px 8px rgba(245,200,66,0.4); }

    .amount-display { background: var(--white); border-radius: var(--radius); padding: 30px 20px; text-align: center; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .amount-display .amount-num { font-size: 3em; font-weight: 900; color: var(--text-dark); letter-spacing: -2px; }
    .amount-display .amount-cur { color: var(--text-light); font-size: 0.5em; vertical-align: super; }

    .sub-cats { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-bottom: 16px; scrollbar-width: none; }
    .sub-cats::-webkit-scrollbar { display: none; }
    .sub-cat-pill { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 6px 14px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.82em; color: var(--text-med); cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .sub-cat-pill.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }

    .add-form { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .form-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #F5F5F5; }
    .form-row:last-child { border-bottom: none; }
    .form-icon { font-size: 1.2em; width: 28px; text-align: center; }
    .form-label { font-weight: 700; color: var(--text-med); font-size: 0.88em; min-width: 80px; }
    .form-input { flex: 1; border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.92em; font-weight: 700; color: var(--text-dark); text-align: right; outline: none; }
    .form-input::placeholder { color: var(--text-light); }
    .form-select { border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.92em; font-weight: 700; color: var(--text-dark); text-align: right; outline: none; cursor: pointer; flex: 1; direction: rtl; }

    .numpad { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .numpad-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .num-btn { background: #F8F8F8; border: none; border-radius: 12px; padding: 16px 8px; font-family: 'Nunito', sans-serif; font-size: 1.1em; font-weight: 800; color: var(--text-dark); cursor: pointer; transition: background 0.15s; text-align: center; }
    .num-btn:hover { background: #F0F0F0; }
    .num-btn.special { color: var(--text-med); font-size: 0.9em; }
    .num-btn.save-btn { background: var(--yellow); color: var(--text-dark); font-weight: 900; font-size: 1em; }
    .num-btn.save-btn:hover { background: #E8B800; }

    /* ── DATA SCREEN ── */
    .data-controls { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .data-controls-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
    .data-controls-row:last-child { margin-bottom: 0; }
    .data-label { font-size: 0.82em; font-weight: 800; color: var(--text-med); }

    .data-section { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; overflow: hidden; }
    .data-section-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 18px; cursor: pointer; border-bottom: 1px solid #F5F5F5; gap: 10px; flex-wrap: wrap; }
    .data-section-title { display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .data-section-total { font-size: 0.85em; font-weight: 700; }
    .data-section-actions { display: flex; gap: 6px; }
    .data-section-body { display: none; }
    .data-section-body.open { display: block; }

    .data-table-wrap { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; min-width: 480px; }
    .data-table th { background: #F8F8F8; padding: 10px 10px; text-align: left; font-size: 0.78em; font-weight: 800; color: var(--text-med); text-transform: uppercase; letter-spacing: 0.4px; cursor: pointer; user-select: none; white-space: nowrap; }
    .data-table th:hover { background: var(--yellow-light); color: var(--text-dark); }
    .data-table td { padding: 10px 10px; border-bottom: 1px solid #F8F8F8; font-size: 0.88em; font-weight: 600; color: var(--text-dark); }
    .data-table td[contenteditable="true"]:hover { background: rgba(245,200,66,0.08); outline: 1px solid var(--yellow); cursor: text; }
    .data-table td[contenteditable="true"]:focus { background: var(--yellow-light); outline: 2px solid var(--yellow); }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: #FAFAFA; }
    .del-btn-sm { background: #FFF0F0; border: none; border-radius: 8px; padding: 4px 8px; font-size: 0.82em; color: var(--expenses); cursor: pointer; font-weight: 700; }
    .del-btn-sm:hover { background: var(--expenses); color: white; }
    .icon-btn { background: var(--white); border: 1.5px solid #EEE; border-radius: 8px; padding: 6px 10px; font-size: 0.78em; font-weight: 800; color: var(--text-med); cursor: pointer; }
    .icon-btn:hover { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }
    .icon-btn.danger:hover { border-color: var(--expenses); background: #FFF0F0; color: var(--expenses); }

    .quick-add-row { display: flex; gap: 8px; padding: 14px 16px; border-top: 1px solid #F5F5F5; flex-wrap: wrap; align-items: center; background: #FAFAFA; }
    .qa-input { background: var(--white); border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 8px 12px; font-family: 'Nunito', sans-serif; font-size: 0.85em; font-weight: 700; color: var(--text-dark); outline: none; flex: 1; min-width: 80px; }
    .qa-input:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .qa-input::placeholder { color: var(--text-light); font-weight: 600; }
    .qa-btn { background: var(--yellow); border: none; border-radius: var(--radius-sm); padding: 8px 14px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.85em; color: var(--text-dark); cursor: pointer; white-space: nowrap; }
    .qa-btn:hover { background: #E8B800; }

    .import-panel { padding: 14px 16px; border-top: 1px solid #F5F5F5; }
    .import-panel-title { font-size: 0.78em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 8px; }
    .paste-area { width: 100%; height: 90px; background: #F8F8F8; border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 10px 12px; font-family: monospace; font-size: 0.82em; color: var(--text-dark); resize: vertical; outline: none; }
    .paste-area:focus { border-color: var(--yellow); }
    .import-controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }

    /* ── METALS ── */
    .metals-portfolio-bar { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .metals-portfolio-title { font-size: 0.78em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px; }
    .metals-portfolio-total { font-size: 2.2em; font-weight: 900; color: var(--text-dark); margin-bottom: 16px; }
    .metals-mini-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .metals-mini-card { border-radius: var(--radius-sm); padding: 12px 10px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .metals-mini-card:hover { transform: translateY(-2px); box-shadow: var(--card-shadow-hover); }
    .metals-mini-card.active-metal { box-shadow: 0 0 0 2.5px var(--text-dark); }
    .metals-mini-card.gold-card { background: linear-gradient(145deg, #FFF3C4, #FFE580); }
    .metals-mini-card.silver-card { background: linear-gradient(145deg, #E8EDF2, #D0D8E0); }
    .metals-mini-card.platinum-card { background: linear-gradient(145deg, #DDE5EC, #C5D2DC); }
    .metals-mini-icon { font-size: 1.6em; margin-bottom: 6px; }
    .metals-mini-name { font-size: 0.72em; font-weight: 800; color: var(--text-med); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.4px; }
    .metals-mini-grams { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metals-mini-usd { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-top: 2px; }

    .metal-detail-header { display: flex; align-items: center; gap: 14px; padding: 18px 20px; background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; }
    .metal-detail-icon-wrap { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.8em; flex-shrink: 0; }
    .metal-detail-icon-wrap.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
    .metal-detail-icon-wrap.silver { background: linear-gradient(135deg, #C0C0C0, #8A9BA8); }
    .metal-detail-icon-wrap.platinum { background: linear-gradient(135deg, #8FA4B2, #4A6070); }
    .metal-detail-info { flex: 1; }
    .metal-detail-name { font-size: 1.1em; font-weight: 900; color: var(--text-dark); }
    .metal-detail-grams { font-size: 0.82em; font-weight: 700; color: var(--text-med); margin-top: 3px; }
    .metal-detail-usd { font-size: 1.4em; font-weight: 900; margin-top: 2px; }
    .metal-detail-usd.gold { color: #C8900A; } .metal-detail-usd.silver { color: #6E7A8A; } .metal-detail-usd.platinum { color: #4A5C6E; }
    .metal-stat-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 14px; }
    .metal-stat-box { background: var(--white); border-radius: var(--radius-sm); padding: 12px; text-align: center; box-shadow: var(--card-shadow); }
    .metal-stat-box-val { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metal-stat-box-lbl { font-size: 0.7em; font-weight: 700; color: var(--text-light); margin-top: 3px; text-transform: uppercase; }
    .metal-add-panel { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; overflow: hidden; }
    .metal-add-panel-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; cursor: pointer; user-select: none; }
    .metal-add-panel-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); display: flex; align-items: center; gap: 8px; }
    .metal-add-panel-toggle { font-size: 1.2em; color: var(--text-light); transition: transform 0.2s; }
    .metal-add-panel-body { display: none; padding: 0 20px 20px; border-top: 1px solid #F0F0F0; }
    .metal-add-panel-body.open { display: block; }
    .metal-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 14px 0; }
    .metal-form-field { display: flex; flex-direction: column; gap: 5px; }
    .metal-form-field label { font-size: 0.72em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .metal-form-field input, .metal-form-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.88em; color: var(--text-dark); outline: none; width: 100%; }
    .metal-form-field input:focus, .metal-form-field select:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .metal-form-field.full { grid-column: span 2; }
    .metal-save-btn { width: 100%; border: none; border-radius: var(--radius-sm); padding: 14px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.95em; color: white; cursor: pointer; }
    .metal-save-btn.gold { background: linear-gradient(135deg, #C8900A, #F5C842); }
    .metal-save-btn.silver { background: linear-gradient(135deg, #6E7A8A, #9BA8B5); }
    .metal-save-btn.platinum { background: linear-gradient(135deg, #4A5C6E, #6B8FA6); }
    .metal-holdings-card { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); overflow: hidden; margin-bottom: 16px; }
    .metal-holdings-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #F5F5F5; }
    .metal-holdings-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .metal-holdings-count { font-size: 0.78em; font-weight: 700; color: var(--text-light); background: #F5F5F5; padding: 4px 10px; border-radius: 20px; }
    .metal-holding-item { display: flex; align-items: center; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #F8F8F8; }
    .metal-holding-item:last-child { border-bottom: none; }
    .metal-holding-badge { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; flex-shrink: 0; }
    .metal-holding-badge.gold { background: linear-gradient(135deg, #FFE080, #FFD700); }
    .metal-holding-badge.silver { background: linear-gradient(135deg, #D8E0E8, #B0BBC5); }
    .metal-holding-badge.platinum { background: linear-gradient(135deg, #C0CDD6, #8A9FAD); }
    .metal-holding-main { flex: 1; min-width: 0; }
    .metal-holding-top { display: flex; align-items: center; gap: 8px; }
    .metal-holding-name-text { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .metal-holding-form-chip { font-size: 0.68em; font-weight: 800; padding: 2px 7px; border-radius: 6px; background: #F0F0F0; color: var(--text-med); }
    .metal-holding-bottom { font-size: 0.76em; font-weight: 600; color: var(--text-light); margin-top: 3px; }
    .metal-holding-right { text-align: right; flex-shrink: 0; }
    .metal-holding-value { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metal-holding-weight { font-size: 0.76em; font-weight: 700; color: var(--text-light); margin-top: 2px; }
    .metal-holding-del { background: none; border: none; color: #DDD; font-size: 1em; cursor: pointer; padding: 4px; border-radius: 6px; }
    .metal-holding-del:hover { color: var(--expenses); background: #FFF0F0; }
    .metal-empty { text-align: center; padding: 40px 20px; color: var(--text-light); }
    .metal-empty-icon { font-size: 2.5em; margin-bottom: 10px; opacity: 0.5; }
    .metal-empty-text { font-weight: 700; font-size: 0.9em; }

    /* ── INVESTMENTS ── */
    .invest-hero { background: linear-gradient(135deg, #7C3AED 0%, #A855F7 60%, #C084FC 100%); border-radius: var(--radius); padding: 24px; margin-bottom: 16px; position: relative; overflow: hidden; }
    .invest-hero-label { color: rgba(255,255,255,0.85); font-size: 0.85em; font-weight: 700; margin-bottom: 6px; }
    .invest-hero-value { color: #fff; font-size: 2.4em; font-weight: 900; }
    .invest-hero-stats { display: flex; gap: 12px; margin-top: 14px; flex-wrap: wrap; }
    .invest-hero-stat { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 10px 14px; }
    .invest-hero-stat-val { color: #fff; font-weight: 900; font-size: 1em; }
    .invest-hero-stat-lbl { color: rgba(255,255,255,0.75); font-size: 0.72em; font-weight: 700; margin-top: 2px; }
    .invest-deco { position: absolute; right: -10px; top: -10px; font-size: 5em; opacity: 0.1; }
    .invest-cat-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-bottom: 16px; scrollbar-width: none; }
    .invest-cat-tabs::-webkit-scrollbar { display: none; }
    .invest-cat-tab { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 8px 16px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; color: var(--text-med); cursor: pointer; white-space: nowrap; box-shadow: var(--card-shadow); }
    .invest-cat-tab.active { border-color: var(--portfolio); background: var(--portfolio-light); color: var(--portfolio); }
    .invest-holding-row { background: var(--white); border-radius: var(--radius-sm); padding: 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; box-shadow: var(--card-shadow); cursor: pointer; }
    .invest-holding-row:hover { transform: translateX(4px); }
    .invest-ticker-badge { background: var(--portfolio-light); color: var(--portfolio); border-radius: 10px; padding: 8px 10px; font-weight: 900; font-size: 0.85em; min-width: 56px; text-align: center; flex-shrink: 0; }
    .invest-info { flex: 1; }
    .invest-name { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .invest-detail { font-size: 0.78em; color: var(--text-light); font-weight: 600; margin-top: 2px; }
    .invest-values { text-align: right; }
    .invest-value { font-weight: 900; font-size: 1em; color: var(--text-dark); }
    .invest-gain { font-size: 0.78em; font-weight: 700; margin-top: 2px; }
    .invest-gain.up { color: var(--income); } .invest-gain.down { color: var(--expenses); }
    .invest-entry-card { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .invest-entry-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); margin-bottom: 14px; }
    .inv-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
    .inv-field { display: flex; flex-direction: column; gap: 5px; }
    .inv-field label { font-size: 0.72em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .inv-field input, .inv-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.88em; color: var(--text-dark); outline: none; width: 100%; }
    .inv-field input:focus, .inv-field select:focus { border-color: var(--portfolio); background: var(--portfolio-light); }
    .inv-field.full { grid-column: span 2; }
    .add-invest-btn { width: 100%; background: var(--portfolio); border: none; border-radius: var(--radius-sm); padding: 16px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.95em; color: white; cursor: pointer; margin-top: 4px; }

    /* ── MODAL (shared) ── */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 200; backdrop-filter: blur(4px); }
    .modal-overlay.open { display: flex; align-items: flex-end; }
    .modal { background: var(--white); border-radius: 24px 24px 0 0; padding: 24px 20px; width: 100%; max-height: 92vh; overflow-y: auto; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-size: 1.1em; font-weight: 900; color: var(--text-dark); }
    .modal-close { background: #F0F0F0; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 1em; color: var(--text-med); display: flex; align-items: center; justify-content: center; }

    /* ── QUICK ADD POPUP ── */
    #quick-add-modal .modal { padding-bottom: 32px; }
    .qa-type-row { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 14px; }
    .qa-type-row::-webkit-scrollbar { display: none; }
    .qa-type-chip { flex-shrink: 0; padding: 8px 14px; border: 2px solid transparent; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.8em; background: #F5F5F5; color: var(--text-med); cursor: pointer; transition: all 0.2s; }
    .qa-type-chip.active { background: var(--yellow); color: var(--text-dark); border-color: var(--yellow); }

    .qa-amount-row { display: flex; align-items: center; background: #F8F8F8; border-radius: var(--radius-sm); padding: 12px 16px; margin-bottom: 14px; }
    .qa-currency-sym { font-size: 1.2em; font-weight: 900; color: var(--text-light); margin-right: 6px; }
    .qa-amount-input { flex: 1; border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 2em; font-weight: 900; color: var(--text-dark); outline: none; width: 100%; }

    .qa-sub-cats { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 12px; padding-bottom: 2px; }
    .qa-sub-cats::-webkit-scrollbar { display: none; }
    .qa-sub-pill { flex-shrink: 0; padding: 6px 12px; border: 2px solid #EEE; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.78em; color: var(--text-med); cursor: pointer; background: var(--white); transition: all 0.15s; }
    .qa-sub-pill.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }

    .qa-fields-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .qa-field { display: flex; flex-direction: column; gap: 4px; }
    .qa-field label { font-size: 0.7em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .qa-field input, .qa-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.85em; color: var(--text-dark); outline: none; }
    .qa-field input:focus, .qa-field select:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .qa-field.full { grid-column: span 2; }

    .qa-numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 14px; }
    .qa-key { background: #F5F5F5; border: none; border-radius: 12px; padding: 14px 8px; font-family: 'Nunito', sans-serif; font-size: 1.2em; font-weight: 800; color: var(--text-dark); cursor: pointer; transition: all 0.12s; text-align: center; -webkit-tap-highlight-color: transparent; }
    .qa-key:active { background: #E8E8E8; transform: scale(0.94); }
    .qa-key.qa-del { font-size: 1em; color: var(--text-med); }
    .qa-key.qa-dot { font-size: 1.3em; }
    .qa-key.qa-save { background: var(--yellow); color: var(--text-dark); font-size: 0.9em; font-weight: 900; }
    .qa-key.qa-save:active { background: #E8B800; }

    /* ══ SETTINGS ══ */
    .settings-card { background: var(--white); border-radius: var(--radius); padding: 24px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .settings-title { font-weight: 900; font-size: 1.05em; color: var(--text-dark); margin-bottom: 16px; }

    /* Theme Selector */
    .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .theme-card { border-radius: var(--radius-sm); padding: 14px 12px; cursor: pointer; border: 2.5px solid transparent; transition: all 0.2s; position: relative; overflow: hidden; }
    .theme-card.active-theme { border-color: var(--text-dark); }
    .theme-card .tc-preview { font-size: 2em; margin-bottom: 6px; line-height: 1; }
    .theme-card .tc-name { font-size: 0.82em; font-weight: 800; color: var(--text-dark); }
    .theme-card .tc-desc { font-size: 0.7em; font-weight: 600; color: var(--text-med); margin-top: 2px; }
    .theme-card .tc-active-badge { position: absolute; top: 8px; right: 8px; background: var(--yellow); border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.65em; }
    .theme-card.active-theme .tc-active-badge { display: flex; }

    /* Theme: Looney Toons */
    .theme-card.looney { background: linear-gradient(135deg, #FFE8F0, #FFC8E8); }
    /* Theme: Jungle */
    .theme-card.jungle { background: linear-gradient(135deg, #E8F5E9, #C8E6C9); }
    /* Theme: Space */
    .theme-card.space { background: linear-gradient(135deg, #1A1A40, #2D1B69); }
    .theme-card.space .tc-name, .theme-card.space .tc-desc { color: #C8C8FF; }
    /* Theme: Ocean */
    .theme-card.ocean { background: linear-gradient(135deg, #E0F4FF, #B3E5FC); }
    /* Theme: Default */
    .theme-card.default { background: linear-gradient(135deg, #FFF9E6, #FFF0B0); }

    /* ── FLOATING THEME ELEMENTS ── */
    /* Looney Tunes characters */
    .looney-char { position: fixed; pointer-events: none; font-size: 2.5em; animation: floatBounce 3s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-looney .looney-char { opacity: 0.35; }
    @keyframes floatBounce { 0%,100%{transform:translateY(0) rotate(-5deg)} 50%{transform:translateY(-12px) rotate(5deg)} }

    /* Jungle elements */
    .jungle-leaf { position: fixed; pointer-events: none; font-size: 2em; animation: leafSway 4s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-jungle .jungle-leaf { opacity: 0.3; }
    @keyframes leafSway { 0%,100%{transform:rotate(-8deg) scale(1)} 50%{transform:rotate(8deg) scale(1.05)} }

    /* Space elements */
    .space-star { position: fixed; pointer-events: none; font-size: 1.2em; animation: twinkle 2s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-space .space-star { opacity: 0.5; }
    @keyframes twinkle { 0%,100%{opacity:0.3;transform:scale(1)} 50%{opacity:0.8;transform:scale(1.2)} }

    /* Ocean elements */
    .ocean-wave { position: fixed; pointer-events: none; font-size: 2em; animation: waveFloat 5s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-ocean .ocean-wave { opacity: 0.25; }
    @keyframes waveFloat { 0%,100%{transform:translateX(0) rotate(0deg)} 50%{transform:translateX(15px) rotate(10deg)} }

    /* ── DECORATIVE ── */
    .deco-circle { position: fixed; border-radius: 50%; pointer-events: none; z-index: 0; }
    .deco-yellow { background: var(--yellow); }
    .deco-blue { background: var(--blue-circle); }

    /* ── TOAST ── */
    .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--text-dark); color: white; padding: 12px 20px; border-radius: 30px; font-weight: 700; font-size: 0.85em; z-index: 999; opacity: 0; transition: all 0.3s; white-space: nowrap; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .positive { color: var(--income); } .negative { color: var(--expenses); }

    /* ══ BUDGET MODULE ══ */
    .budget-module-tabs { display:flex; gap:8px; margin-bottom:16px; }
    .bm-tab { flex:1; padding:10px 8px; border:none; background:var(--white); border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:800; font-size:0.82em; color:var(--text-light); cursor:pointer; box-shadow:var(--card-shadow); transition:all 0.2s; }
    .bm-tab.active { background:var(--yellow); color:var(--text-dark); }

    /* Overview Hero Card */
    .budget-hero-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; margin-bottom:16px; position:relative; overflow:hidden; }
    .budget-hero-card::before { content:''; position:absolute; top:-30px; right:-30px; width:140px; height:140px; border-radius:50%; background:var(--yellow); opacity:0.12; pointer-events:none; }
    .bh-title { font-size:0.78em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
    .bh-amount { font-size:2.4em; font-weight:900; color:var(--text-dark); line-height:1.1; }
    .bh-sub { font-size:0.85em; font-weight:700; margin-top:2px; }
    .bh-dual-lines { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px; }
    .bh-line-block { background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; }
    .bh-line-label { font-size:0.68em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:4px; }
    .bh-line-val { font-size:1em; font-weight:900; }
    .bh-line-sub { font-size:0.72em; font-weight:700; margin-top:2px; }
    .bh-chart-wrap { height:80px; margin:14px 0 4px; position:relative; }
    .bh-view-toggle { display:inline-flex; background:#F0F0F0; border-radius:20px; padding:3px; margin-bottom:10px; }
    .bh-view-btn { border:none; background:none; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.75em; color:var(--text-light); padding:5px 14px; border-radius:16px; cursor:pointer; transition:all 0.2s; }
    .bh-view-btn.active { background:var(--white); color:var(--text-dark); box-shadow:0 1px 4px rgba(0,0,0,0.12); }
    .bh-year-badge { display:inline-block; background:var(--yellow-light); color:var(--text-dark); font-size:0.68em; font-weight:900; padding:2px 7px; border-radius:10px; margin-left:4px; vertical-align:middle; }

    /* Category Bubbles Group Labels */
    #budget-cats-wrapper { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:14px 16px 10px; margin-bottom:16px; }
    .bcat-group-label { display:flex; align-items:center; margin:0 0 8px 0; }
    .bcat-group-label:not(:first-child) { margin-top:14px; padding-top:14px; border-top:1px solid #F0F0F0; }
    .bcat-group-pill { display:inline-flex; align-items:center; gap:5px; font-size:0.72em; font-weight:900; padding:4px 12px; border-radius:20px; letter-spacing:0.3px; }
    .bcat-group-pill.exp { background:#EF444412; color:#EF4444; border:1px solid #EF444430; }
    .bcat-group-pill.sav { background:#10B98112; color:#10B981; border:1px solid #10B98130; }

    /* Category Bubbles Row */
    .budget-cats-scroll { display:flex; gap:12px; overflow-x:auto; scrollbar-width:none; margin-bottom:2px; padding:2px 0 8px 0; }
    .budget-cats-scroll::-webkit-scrollbar { display:none; }
    .bcat-bubble { flex-shrink:0; display:flex; flex-direction:column; align-items:center; gap:5px; cursor:pointer; transition:transform 0.15s; }
    .bcat-bubble:active { transform:scale(0.93); }
    .bcat-ring { width:72px; height:72px; border-radius:50%; position:relative; display:flex; align-items:center; justify-content:center; }
    .bcat-ring svg { position:absolute; top:0; left:0; width:100%; height:100%; transform:rotate(-90deg); }
    .bcat-icon-wrap { width:56px; height:56px; border-radius:50%; background:var(--white); display:flex; align-items:center; justify-content:center; font-size:1.5em; z-index:1; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .bcat-name { font-size:0.67em; font-weight:800; color:var(--text-med); text-align:center; max-width:72px; line-height:1.2; }
    .bcat-status { font-size:0.67em; font-weight:900; text-align:center; }

    /* Goals Table */
    .budget-goals-section { margin-bottom:20px; }
    .bgs-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .bgs-title { font-weight:900; font-size:0.95em; color:var(--text-dark); }
    .bgs-add-btn { background:var(--yellow); border:none; border-radius:10px; padding:7px 14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.82em; cursor:pointer; transition:background 0.15s; }
    .bgs-add-btn:hover { background:#e8b900; }
    .budget-goal-row { background:var(--white); border-radius:var(--radius-sm); box-shadow:var(--card-shadow); padding:14px 16px; margin-bottom:8px; cursor:pointer; transition:transform 0.15s; }
    .budget-goal-row:hover { transform:translateX(3px); }
    .bgr-top { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .bgr-icon { width:38px; height:38px; border-radius:11px; display:flex; align-items:center; justify-content:center; font-size:1.1em; flex-shrink:0; }
    .bgr-info { flex:1; }
    .bgr-name { font-weight:900; font-size:0.9em; color:var(--text-dark); }
    .bgr-type { font-size:0.68em; font-weight:700; color:var(--text-light); margin-top:1px; }
    .bgr-right { text-align:right; }
    .bgr-spent { font-weight:900; font-size:0.95em; }
    .bgr-budget { font-size:0.72em; font-weight:700; color:var(--text-light); margin-top:1px; }
    .bgr-bar { height:4px; background:#F0F0F0; border-radius:4px; overflow:hidden; }
    .bgr-bar-fill { height:100%; border-radius:4px; transition:width 0.6s ease; }
    .bgr-actions { display:flex; gap:6px; margin-top:8px; }
    .bgr-action-btn { flex:1; padding:6px 8px; border:none; border-radius:8px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; transition:all 0.15s; }

    /* Category Detail View */
    .bcat-detail-view { display:none; }
    .bcat-detail-view.open { display:block; }
    .bcd-back-btn { background:var(--white); border:none; border-radius:var(--radius-sm); padding:8px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.82em; cursor:pointer; box-shadow:var(--card-shadow); display:inline-flex; align-items:center; gap:6px; margin-bottom:14px; color:var(--text-dark); }
    .bcd-header { text-align:center; padding:8px 0 16px; }
    .bcd-icon { font-size:2.2em; margin-bottom:6px; }
    .bcd-name { font-size:1.4em; font-weight:900; color:var(--text-dark); }
    .bcd-spent { font-size:1.1em; font-weight:700; margin-top:4px; }
    .bcd-chart-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:16px; margin-bottom:16px; }
    .bcd-chart-title { font-size:0.78em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; }
    .bcd-chart-outer { position:relative; }
    .bcd-chart-wrap { height:180px; position:relative; }
    /* Floating budget chip — sits on the right end of the budget line */
    .bcd-budget-chip { position:absolute; right:0; top:50%; transform:translateY(-80%); display:flex; align-items:center; gap:5px; background:#1E2A6E; color:white; border-radius:20px; padding:5px 10px 5px 12px; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,0.25); transition:all 0.18s; z-index:10; user-select:none; }
    .bcd-budget-chip:hover { background:#2D3EA8; box-shadow:0 4px 16px rgba(0,0,0,0.3); }
    .bcd-budget-chip.editing { background:var(--white); padding:3px 3px 3px 10px; box-shadow:0 4px 20px rgba(0,0,0,0.18); border:2px solid var(--yellow); }
    .bcd-chip-label { font-size:0.88em; font-weight:900; letter-spacing:0.3px; white-space:nowrap; }
    .bcd-chip-pencil { font-size:0.7em; opacity:0.75; }
    .bcd-budget-chip.editing .bcd-chip-label { display:none; }
    .bcd-budget-chip.editing .bcd-chip-pencil { display:none; }
    .bcd-chip-input { display:none; width:80px; background:transparent; border:none; outline:none; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.92em; color:var(--text-dark); padding:4px 0; }
    .bcd-budget-chip.editing .bcd-chip-input { display:block; }
    .budget-line-indicator { position:absolute; right:0; top:0; bottom:0; display:flex; align-items:center; pointer-events:none; }
    .bcd-metrics { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px; }
    .bcd-metric-card { background:var(--white); border-radius:var(--radius-sm); box-shadow:var(--card-shadow); padding:14px 12px; text-align:center; }
    .bcd-metric-label { font-size:0.68em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:4px; }
    .bcd-metric-val { font-size:1.15em; font-weight:900; color:var(--text-dark); }
    .bcd-txns-section { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:16px; }
    .bcd-txns-title { font-weight:900; font-size:0.9em; color:var(--text-dark); margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; }
    .bcd-tx-row { display:flex; align-items:center; gap:10px; padding:9px 0; border-bottom:1px solid #F5F5F5; }
    .bcd-tx-row:last-child { border-bottom:none; }
    .bcd-tx-icon { width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:0.9em; flex-shrink:0; }
    .bcd-tx-info { flex:1; min-width:0; }
    .bcd-tx-name { font-weight:800; font-size:0.85em; color:var(--text-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .bcd-tx-date { font-size:0.7em; color:var(--text-light); font-weight:600; margin-top:1px; }
    .bcd-tx-amt { font-weight:900; font-size:0.9em; color:var(--expenses); flex-shrink:0; }

    /* Edit Budget Popup */
    .edit-budget-popup { position:fixed; inset:0; z-index:500; display:flex; align-items:flex-end; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.25s; }
    .edit-budget-popup.open { opacity:1; pointer-events:all; }
    .edit-budget-popup .popup-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.35); }
    .edit-budget-sheet { background:var(--white); border-radius:24px 24px 0 0; padding:20px 20px 32px; position:relative; z-index:1; width:100%; max-width:480px; transform:translateY(30px); transition:transform 0.3s ease; box-shadow:0 -8px 40px rgba(0,0,0,0.15); }
    .edit-budget-popup.open .edit-budget-sheet { transform:translateY(0); }
    .ebp-handle { width:36px; height:4px; background:#E0E0E0; border-radius:4px; margin:0 auto 16px; }
    .ebp-title { font-size:1.1em; font-weight:900; color:var(--text-dark); margin-bottom:16px; }
    .ebp-field { margin-bottom:12px; }
    .ebp-field label { font-size:0.72em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; display:block; margin-bottom:4px; }
    .ebp-field input, .ebp-field select { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:12px; padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.95em; color:var(--text-dark); outline:none; }
    .ebp-field input:focus, .ebp-field select:focus { border-color:var(--yellow); background:var(--yellow-light); }
    .ebp-emoji-row { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:12px; }
    .ebp-emoji-opt { width:36px; height:36px; border-radius:10px; border:2px solid transparent; background:var(--bg); display:flex; align-items:center; justify-content:center; font-size:1.1em; cursor:pointer; transition:all 0.15s; }
    .ebp-emoji-opt.picked { border-color:var(--yellow); background:var(--yellow-light); }
    .ebp-actions { display:flex; gap:8px; margin-top:6px; }
    .ebp-save-btn { flex:1; background:var(--yellow); border:none; border-radius:12px; padding:14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); }
    .ebp-del-btn { background:#FFF0F0; border:none; border-radius:12px; padding:14px 18px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--expenses); }

    /* ══ NET WORTH MODULE ══ */
    /* ══ NET WORTH — HERO ══ */
    .nw-hero { background:linear-gradient(155deg,#1B1F5E 0%,#2D1B69 50%,#3D1A6E 100%); border-radius:20px; padding:28px 22px 24px; margin-bottom:16px; color:white; position:relative; overflow:hidden; }
    .nw-hero::before { content:''; position:absolute; top:-60px; right:-60px; width:220px; height:220px; border-radius:50%; background:rgba(255,255,255,0.05); pointer-events:none; }
    .nw-hero::after  { content:''; position:absolute; bottom:-70px; left:-40px; width:190px; height:190px; border-radius:50%; background:rgba(100,80,200,0.12); pointer-events:none; }
    .nw-hero-label { font-size:0.72em; font-weight:800; opacity:0.65; text-transform:uppercase; letter-spacing:0.8px; margin-bottom:6px; }
    .nw-hero-amount { font-size:3em; font-weight:900; line-height:1.05; letter-spacing:-1px; }
    .nw-hero-change { font-size:0.82em; font-weight:700; margin-top:6px; opacity:0.9; display:flex; align-items:center; gap:4px; }
    .nw-hero-bars { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-top:18px; }
    .nw-hero-bar-block { background:rgba(255,255,255,0.10); backdrop-filter:blur(4px); border-radius:14px; padding:12px 10px; border:1px solid rgba(255,255,255,0.08); }
    .nw-hero-bar-label { font-size:0.58em; font-weight:800; opacity:0.6; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
    .nw-hero-bar-val { font-size:0.92em; font-weight:900; }
    .nw-debt-badge { display:inline-block; font-size:0.62em; font-weight:900; padding:2px 7px; border-radius:10px; margin-top:4px; }
    /* ══ CTA BUTTONS ══ */
    .nw-cta-row { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px; }
    .nw-btn-snapshot { background:var(--yellow); border:none; border-radius:14px; padding:14px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--text-dark); display:flex; align-items:center; justify-content:center; gap:6px; transition:background 0.15s; }
    .nw-btn-snapshot:hover { background:#e8b900; }
    .nw-btn-add { background:transparent; border:2px solid var(--yellow); border-radius:14px; padding:14px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--text-dark); display:flex; align-items:center; justify-content:center; gap:6px; transition:all 0.15s; }
    .nw-btn-add:hover { background:var(--yellow-light); }
    /* ══ INSIGHTS CARDS ══ */
    .nw-insight-card { background:var(--white); border-radius:14px; box-shadow:var(--card-shadow); padding:14px 16px; margin-bottom:10px; display:flex; align-items:flex-start; gap:12px; border-left:4px solid; }
    .nw-insight-icon-wrap { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.2em; flex-shrink:0; }
    .nw-insight-title { font-weight:900; font-size:0.88em; color:var(--text-dark); margin-bottom:3px; }
    .nw-insight-sub   { font-size:0.75em; font-weight:600; color:var(--text-med); line-height:1.4; }
    /* ══ TREND CARD ══ */
    .nw-trend-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:18px; margin-bottom:14px; }
    .nw-trend-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
    .nw-trend-title { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; }
    .nw-trend-badge { font-size:0.72em; font-weight:900; color:var(--text-light); background:#F5F5F5; padding:3px 10px; border-radius:20px; }
    .nw-chart-wrap { height:130px; margin-bottom:16px; }
    .nw-snaps-label { font-size:0.7em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; }
    .nw-snap-row { display:flex; align-items:center; gap:10px; padding:7px 0; border-bottom:1px solid #F8F8F8; }
    .nw-snap-row:last-child { border-bottom:none; }
    .nw-snap-date { font-size:0.75em; font-weight:700; color:var(--text-light); width:76px; flex-shrink:0; }
    .nw-snap-bar-wrap { flex:1; height:8px; background:#F0F0F0; border-radius:6px; overflow:hidden; }
    .nw-snap-bar-fill { height:100%; border-radius:6px; background:linear-gradient(90deg,#3B4A9C,#7C3AED); transition:width 0.6s; }
    .nw-snap-val { font-size:0.82em; font-weight:900; color:var(--text-dark); width:72px; text-align:right; flex-shrink:0; }
    .nw-snap-del { background:none; border:none; font-size:0.85em; color:#CCC; cursor:pointer; padding:0 2px; flex-shrink:0; }
    .nw-snap-del:hover { color:#EF4444; }
    /* ══ ASSET ALLOCATION ══ */
    .nw-alloc-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:18px; margin-bottom:14px; }
    .nw-alloc-title { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:16px; }
    .nw-alloc-body { display:flex; align-items:flex-start; gap:18px; }
    .nw-alloc-donut { width:130px; height:130px; flex-shrink:0; }
    .nw-alloc-legend { flex:1; display:flex; flex-direction:column; gap:5px; max-height:140px; overflow-y:auto; }
    .nw-legend-row { display:flex; align-items:center; gap:8px; }
    .nw-legend-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
    .nw-legend-name { font-size:0.75em; font-weight:700; color:var(--text-med); flex:1; line-height:1.2; }
    .nw-legend-pct  { font-size:0.72em; font-weight:900; color:var(--text-dark); width:28px; text-align:right; flex-shrink:0; }
    .nw-legend-amt  { font-size:0.72em; font-weight:900; color:var(--text-dark); width:54px; text-align:right; flex-shrink:0; }
    /* ══ ACCOUNT SECTIONS ══ */
    .nw-group-header { display:flex; align-items:center; justify-content:space-between; margin:6px 0 10px; }
    .nw-group-label { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; display:flex; align-items:center; gap:6px; }
    .nw-group-total { font-size:0.82em; font-weight:900; }
    .nw-section { background:var(--white); border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.06); margin-bottom:10px; overflow:hidden; }
    .nw-section-header { display:flex; align-items:center; justify-content:space-between; padding:16px 16px; cursor:pointer; transition:background 0.1s; }
    .nw-section-header:active { background:#FAFAFA; }
    .nw-section-left { display:flex; align-items:center; gap:14px; }
    .nw-section-icon { width:50px; height:50px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:1.5em; flex-shrink:0; }
    .nw-section-name { font-weight:900; font-size:0.95em; color:var(--text-dark); }
    .nw-section-sub  { font-size:0.7em; font-weight:600; color:var(--text-light); margin-top:2px; }
    .nw-section-right { display:flex; align-items:center; gap:10px; }
    .nw-section-val  { font-weight:900; font-size:1.05em; }
    .nw-section-chevron { font-size:0.7em; color:var(--text-light); transition:transform 0.2s; }
    .nw-section-chevron.open { transform:rotate(180deg); }
    .nw-section-add  { background:var(--yellow); border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.72em; cursor:pointer; color:var(--text-dark); white-space:nowrap; }
    .nw-section-body { padding:0 16px 14px; border-top:1px solid #F5F5F5; display:none; }
    .nw-section-body.open { display:block; }
    .nw-account-row { display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid #F8F8F8; gap:8px; }
    .nw-metal-grp-body { overflow:hidden; transition:max-height 0.25s ease; max-height:2000px; }
    .nw-metal-grp-body.collapsed { max-height:0; }
    .nw-account-row:last-child { border-bottom:none; }
    .nw-account-left { flex:1; min-width:0; }
    .nw-account-name { font-size:0.85em; font-weight:800; color:var(--text-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .nw-account-meta { font-size:0.68em; font-weight:600; color:var(--text-light); margin-top:2px; }
    .nw-account-bar-wrap { height:3px; background:#F0F0F0; border-radius:4px; margin-top:6px; width:100%; max-width:120px; }
    .nw-account-bar-fill { height:100%; border-radius:4px; }
    .nw-account-right { display:flex; align-items:center; gap:6px; flex-shrink:0; }
    .nw-account-val { font-weight:900; font-size:0.9em; text-align:right; }
    .nw-account-updated { font-size:0.62em; font-weight:600; color:var(--text-light); text-align:right; margin-top:1px; }
    .nw-account-actions { display:flex; gap:4px; }
    .nw-account-btn { background:#F5F5F5; border:none; border-radius:7px; padding:5px 7px; font-size:0.72em; cursor:pointer; color:var(--text-med); font-family:'Nunito',sans-serif; font-weight:800; }
    .nw-account-btn.del { background:#FFF0F0; color:var(--expenses); }
    .nw-snapshot-btn { background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:10px 20px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.85em; cursor:pointer; width:100%; margin-bottom:12px; }
    /* Account add/edit bottom sheet */
    .nw-sheet-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1050; opacity:0; pointer-events:none; transition:opacity 0.25s; }
    /* Type picker grid */
    .nws-type-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:18px; }
    .nws-type-tile { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; padding:16px 8px; background:#F8F8F8; border-radius:14px; border:2px solid transparent; cursor:pointer; transition:all 0.15s; min-height:90px; }
    .nws-type-tile:hover { background:var(--yellow-light); }
    .nws-type-tile.selected { background:var(--yellow-light); border-color:var(--yellow); }
    .nws-type-tile-icon { font-size:2em; line-height:1; }
    .nws-type-tile-name { font-size:0.74em; font-weight:900; color:var(--text-dark); text-align:center; line-height:1.2; }
    /* Last 2 tiles in an 11-item grid span to stay even */
    .nws-type-tile:nth-child(10) { grid-column: 1 / 2; }
    .nws-type-tile:nth-child(11) { grid-column: 2 / 3; }
    /* Selected type banner */
    .nws-selected-banner { display:flex; align-items:center; justify-content:space-between; background:#EEF4FF; border-radius:14px; padding:14px 16px; margin-bottom:20px; }
    .nws-selected-left { display:flex; align-items:center; gap:10px; }
    .nws-selected-icon { font-size:1.6em; }
    .nws-selected-name { font-weight:900; font-size:1em; color:var(--text-dark); }
    .nws-type-badge { font-size:0.7em; font-weight:900; padding:3px 10px; border-radius:8px; letter-spacing:0.4px; }
    .nws-type-badge.asset { background:#D1FAE5; color:#059669; }
    .nws-type-badge.liab  { background:#FFE4E4; color:#DC2626; }
    /* Form section label */
    .nws-section-label { font-size:0.68em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
    .nw-sheet-overlay.open { opacity:1; pointer-events:all; }
    .nw-sheet { position:fixed; bottom:0; left:0; right:0; background:var(--white); border-radius:24px 24px 0 0; z-index:1100; transform:translateY(100%); transition:transform 0.32s cubic-bezier(0.32,0,0.15,1); max-height:90vh; overflow-y:auto; padding:0 20px 80px; }
    .nw-sheet.open { transform:translateY(0); }
    .nw-sheet-handle { width:36px; height:4px; background:#E0E0E0; border-radius:4px; margin:12px auto 18px; }
    .nw-sheet-title { font-size:1.05em; font-weight:900; color:var(--text-dark); margin-bottom:16px; }
    .nw-sheet-field { margin-bottom:14px; }
    .nw-sheet-label { font-size:0.75em; font-weight:800; color:var(--text-med); margin-bottom:5px; text-transform:uppercase; letter-spacing:0.3px; }
    .nw-sheet-input { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; }
    .nw-sheet-input:focus { border-color:var(--yellow); background:var(--white); }
    .nw-sheet-select { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; appearance:none; }
    .nw-sheet-select:focus { border-color:var(--yellow); }
    .nw-sheet-row { display:grid; grid-template-columns:1fr 1fr; gap:10px; }

    /* ── Goal Account Picker — redesigned ── */
    .gap-search { width:100%; border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:10px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; margin-bottom:10px; box-sizing:border-box; background:#FAFAFA; }
    .gap-search:focus { border-color:var(--yellow); background:var(--white); }
    .gap-group { margin-bottom:10px; }
    .gap-group-header { display:flex; align-items:center; justify-content:space-between; padding:7px 10px; background:#F5F5F5; border-radius:10px; cursor:pointer; user-select:none; margin-bottom:4px; }
    .gap-group-title { font-size:0.78em; font-weight:900; color:var(--text-dark); display:flex; align-items:center; gap:6px; }
    .gap-group-meta { font-size:0.72em; font-weight:700; color:var(--text-med); display:flex; align-items:center; gap:8px; }
    .gap-group-total { font-size:0.78em; font-weight:900; color:#10B981; }
    .gap-group-chevron { font-size:0.7em; color:var(--text-light); transition:transform 0.2s; }
    .gap-group-chevron.open { transform:rotate(90deg); }
    .gap-group-body { display:flex; flex-direction:column; gap:3px; padding:0 4px; }
    .gap-group-body.collapsed { display:none; }
    .gap-acc-row { display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:9px; cursor:pointer; transition:background 0.15s; }
    .gap-acc-row:hover { background:#F8F8F8; }
    .gap-acc-row.selected { background:#F0F4FF; }
    .gap-acc-cb { width:18px; height:18px; border-radius:5px; border:2px solid #D0D0D0; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:0.7em; transition:all 0.15s; background:white; }
    .gap-acc-cb.checked { background:var(--primary); border-color:var(--primary); color:white; }
    .gap-acc-name { flex:1; font-size:0.82em; font-weight:700; color:var(--text-dark); line-height:1.3; }
    .gap-acc-sub { font-size:0.68em; color:var(--text-light); font-weight:600; }
    .gap-acc-val { text-align:right; flex-shrink:0; }
    .gap-acc-val-main { font-size:0.82em; font-weight:900; color:#10B981; }
    .gap-acc-val-sub { font-size:0.68em; font-weight:600; color:var(--text-light); }
    .gap-select-all { display:flex; align-items:center; gap:6px; padding:4px 10px; cursor:pointer; font-size:0.72em; font-weight:800; color:var(--primary); }
    .gap-select-all:hover { text-decoration:underline; }
    .gap-preview-bar { background:#F0F4FF; border-radius:12px; padding:12px 14px; margin:10px 0 0; }
    .gap-preview-label { font-size:0.72em; font-weight:800; color:var(--primary); margin-bottom:6px; text-transform:uppercase; letter-spacing:0.3px; }
    .gap-preview-track { height:8px; background:#E0E8FF; border-radius:20px; overflow:hidden; margin-bottom:6px; }
    .gap-preview-fill { height:100%; border-radius:20px; background:var(--primary); transition:width 0.4s; }
    .gap-preview-nums { display:flex; justify-content:space-between; font-size:0.78em; font-weight:800; }
    .gap-empty { text-align:center; padding:20px; color:var(--text-light); font-size:0.82em; font-weight:600; }
    .nw-sheet-meta { font-size:0.75em; font-weight:700; color:var(--text-light); background:var(--bg); border-radius:10px; padding:8px 12px; margin-bottom:12px; line-height:1.5; }
    .nw-sheet-save { width:100%; background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:15px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); margin-top:6px; }
    .nw-asset-name { font-size:0.85em; font-weight:700; color:var(--text-dark); }
    .nw-asset-sub   { font-size:0.7em; font-weight:600; color:var(--text-light); }
    .nw-asset-val   { font-weight:900; font-size:0.9em; color:var(--text-dark); text-align:right; }

    /* ══ IMPORT HUB ══ */
    .import-tabs { display:flex; gap:6px; margin-bottom:16px; overflow-x:auto; scrollbar-width:none; padding:2px; }
    .import-tabs::-webkit-scrollbar { display:none; }
    .import-tab { flex-shrink:0; padding:8px 14px; border:none; background:var(--white); border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; color:var(--text-light); cursor:pointer; box-shadow:var(--card-shadow); transition:all 0.2s; white-space:nowrap; }
    .import-tab.active { background:var(--yellow); color:var(--text-dark); }
    .import-section { display:none; }
    .import-section.active { display:block; }
    .import-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; margin-bottom:14px; }
    .import-card-title { font-weight:900; font-size:0.95em; color:var(--text-dark); margin-bottom:6px; }
    .import-card-sub { font-size:0.78em; color:var(--text-light); font-weight:600; margin-bottom:16px; line-height:1.5; }
    .import-drop-zone { border:2.5px dashed #E0E0E0; border-radius:var(--radius-sm); padding:28px 20px; text-align:center; cursor:pointer; transition:all 0.2s; margin-bottom:14px; background:var(--bg); }
    .import-drop-zone:hover, .import-drop-zone.dragover { border-color:var(--yellow); background:var(--yellow-light); }
    .import-drop-icon { font-size:2.2em; margin-bottom:8px; }
    .import-drop-text { font-weight:800; font-size:0.9em; color:var(--text-dark); }
    .import-drop-sub  { font-size:0.75em; color:var(--text-light); font-weight:600; margin-top:3px; }
    .import-progress { background:#F0F0F0; border-radius:20px; height:8px; overflow:hidden; margin:10px 0; }
    .import-progress-fill { height:100%; background:var(--yellow); border-radius:20px; transition:width 0.4s ease; }
    .import-step { display:none; }
    .import-step.active { display:block; }
    .import-col-map { display:flex; flex-direction:column; gap:8px; margin-bottom:14px; }
    .import-col-row { display:flex; align-items:center; gap:10px; background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; }
    .import-col-field { font-size:0.8em; font-weight:800; color:var(--text-dark); min-width:100px; flex-shrink:0; }
    .import-col-select { flex:1; background:var(--white); border:1.5px solid #E8E8E8; border-radius:8px; padding:7px 10px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.82em; color:var(--text-dark); outline:none; }
    .import-col-select:focus { border-color:var(--yellow); }
    .import-preview-table { width:100%; border-collapse:collapse; font-size:0.75em; margin-bottom:14px; }
    .import-preview-table th { background:var(--yellow-light); font-weight:800; padding:6px 8px; text-align:left; border-bottom:2px solid var(--yellow); }
    .import-preview-table td { padding:5px 8px; border-bottom:1px solid #F0F0F0; color:var(--text-dark); font-weight:600; }
    .import-preview-table tr:nth-child(even) td { background:#FAFAFA; }
    .import-btn { width:100%; background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); margin-top:8px; transition:background 0.15s; }
    .import-btn:hover { background:#e8b900; }
    .import-btn.secondary { background:var(--bg); color:var(--text-med); }
    .import-btn.danger    { background:#FFF0F0; color:var(--expenses); }
    .cat-review-item { display:flex; align-items:center; gap:10px; background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; margin-bottom:8px; flex-wrap:wrap; }
    .cat-review-flag { font-size:0.7em; font-weight:800; padding:3px 8px; border-radius:10px; flex-shrink:0; }
    .cat-review-flag.dup  { background:#FFF0E0; color:#D97706; }
    .cat-review-flag.new  { background:#F0FBF3; color:#10B981; }
    .cat-review-names { flex:1; font-weight:800; font-size:0.85em; color:var(--text-dark); }
    .cat-review-action { display:flex; gap:6px; }
    .cat-merge-btn { background:var(--yellow-light); border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; }
    .cat-keep-btn  { background:#F5F5F5; border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; }
    .import-summary-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:14px; }
    .import-summary-box { background:var(--bg); border-radius:var(--radius-sm); padding:12px 10px; text-align:center; }
    .import-summary-box .isb-num { font-size:1.4em; font-weight:900; color:var(--text-dark); }
    .import-summary-box .isb-label { font-size:0.65em; font-weight:800; color:var(--text-light); margin-top:2px; text-transform:uppercase; }
    .given-ledger-row { display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid #F5F5F5; }
    .given-ledger-row:last-child { border-bottom:none; }
    .given-person { font-weight:900; font-size:0.9em; color:var(--text-dark); }
    .given-total  { font-weight:900; font-size:0.95em; color:var(--expenses); }

    /* ══ HOME INSIGHTS CARD ══ */
    .insights-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); margin-bottom:16px; overflow:hidden; }
    .insights-header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px 14px; cursor:pointer; user-select:none; }
    .insights-header-left { display:flex; align-items:center; gap:8px; }
    .insights-title { font-weight:900; font-size:0.92em; color:var(--text-dark); }
    .insights-toggle { font-size:0.82em; color:var(--text-light); font-weight:700; transition:transform 0.25s; display:inline-block; }
    .insights-toggle.open { transform:rotate(180deg); }
    .insights-body { padding:0 16px 16px; display:none; }
    .insights-body.open { display:block; }
    /* KPI row at top — always visible */
    .insights-kpi-row { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:12px; }
    .insights-kpi { background:var(--bg); border-radius:var(--radius-sm); padding:11px 10px; text-align:center; }
    .ikpi-val  { font-size:1.1em; font-weight:900; color:var(--text-dark); line-height:1.1; }
    .ikpi-label{ font-size:0.62em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.3px; margin-top:3px; }
    /* Insight chips — the interesting findings */
    .insights-chips { display:flex; flex-direction:column; gap:8px; }
    .insight-chip { display:flex; align-items:flex-start; gap:10px; padding:10px 12px; border-radius:var(--radius-sm); border-left:3px solid transparent; }
    .insight-chip.good    { background:#F0FBF3; border-color:#10B981; }
    .insight-chip.warn    { background:#FFFBEE; border-color:#F59E0B; }
    .insight-chip.alert   { background:#FFF5F5; border-color:#EF4444; }
    .insight-chip.neutral { background:var(--bg); border-color:var(--text-light); }
    .insight-chip-icon { font-size:1.1em; flex-shrink:0; margin-top:1px; }
    .insight-chip-text { flex:1; }
    .insight-chip-title { font-size:0.82em; font-weight:900; color:var(--text-dark); }
    .insight-chip-sub   { font-size:0.72em; font-weight:600; color:var(--text-med); margin-top:2px; line-height:1.4; }

    /* ══ PIN LOCK SCREEN (COMMENTED OUT - RE-ENABLE SECTION START) ══
    === To re-enable PIN functionality:
    === 1. Uncomment the CSS block below (remove the slash-star markers)
    === 2. Uncomment the #lock-screen HTML block in the body
    === 3. Uncomment the PIN JavaScript section at the bottom
    === 4. Call initLockScreen() in the init section

    #lock-screen {
      position: fixed; inset: 0; z-index: 9999;
      background: linear-gradient(160deg, #0f1229 0%, #1a1035 40%, #0d1f18 100%);
      display: flex; flex-direction: column; align-items: center;
      overflow: hidden;
      transition: opacity 0.45s cubic-bezier(.4,0,.2,1), transform 0.45s cubic-bezier(.4,0,.2,1);
    }
    ... (rest of lock screen CSS here when re-enabling)
    === RE-ENABLE SECTION END === */
    /* ══ ONBOARDING OVERLAY ══ */
    #onboarding-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: #1A1F3C;
      display: flex; flex-direction: column;
      font-family: 'Nunito', sans-serif;
      overflow: hidden;
    }
    #onboarding-overlay.hiding {
      animation: onboardFadeOut 0.6s ease forwards;
    }
    @keyframes onboardFadeOut {
      to { opacity: 0; transform: scale(1.04); }
    }
    .ob-slides-wrap {
      flex: 1; display: flex; overflow: hidden; position: relative;
    }
    .ob-slides-track {
      display: flex; height: 100%;
      transition: transform 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: transform;
    }
    .ob-slide {
      min-width: 100vw; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 32px 28px 12px;
      text-align: center;
      position: relative;
    }
    .ob-slide-art {
      font-size: 5.5em;
      margin-bottom: 18px;
      animation: obArtBounce 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,0.35));
    }
    @keyframes obArtBounce {
      from { transform: scale(0.4) translateY(30px); opacity: 0; }
      to   { transform: scale(1) translateY(0);      opacity: 1; }
    }
    .ob-slide-tag {
      font-size: 0.68em; font-weight: 900; letter-spacing: 2px;
      text-transform: uppercase; margin-bottom: 10px;
      padding: 4px 14px; border-radius: 20px;
      background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.6);
    }
    .ob-slide-title {
      font-size: 1.75em; font-weight: 900; line-height: 1.15;
      color: #FFFFFF; margin-bottom: 12px;
      animation: obTextSlide 0.5s 0.15s ease both;
    }
    .ob-slide-desc {
      font-size: 0.9em; font-weight: 600; line-height: 1.6;
      color: rgba(255,255,255,0.65); max-width: 300px;
      animation: obTextSlide 0.5s 0.25s ease both;
    }
    @keyframes obTextSlide {
      from { transform: translateY(18px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }
    .ob-highlight {
      color: #F5C842; font-weight: 900;
    }
    /* Slide-specific accent circles */
    .ob-bg-circle {
      position: absolute; border-radius: 50%; opacity: 0.07;
      pointer-events: none;
    }
    /* Bottom bar */
    .ob-bottom {
      padding: 16px 28px 36px;
      display: flex; flex-direction: column; align-items: center; gap: 14px;
    }
    .ob-dots {
      display: flex; gap: 7px; align-items: center;
    }
    .ob-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: rgba(255,255,255,0.25);
      transition: all 0.3s ease; cursor: pointer;
    }
    .ob-dot.active {
      background: #F5C842; width: 22px; border-radius: 4px;
    }
    .ob-btn-row {
      display: flex; gap: 10px; width: 100%;
    }
    .ob-skip-btn {
      flex: 0; padding: 14px 20px;
      background: rgba(255,255,255,0.1);
      border: none; border-radius: 14px;
      color: rgba(255,255,255,0.5); font-family: 'Nunito', sans-serif;
      font-weight: 800; font-size: 0.88em; cursor: pointer;
      transition: background 0.2s;
    }
    .ob-skip-btn:hover { background: rgba(255,255,255,0.18); }
    .ob-next-btn {
      flex: 1; padding: 14px;
      background: #F5C842;
      border: none; border-radius: 14px;
      color: #1A1F3C; font-family: 'Nunito', sans-serif;
      font-weight: 900; font-size: 1em; cursor: pointer;
      box-shadow: 0 4px 20px rgba(245,200,66,0.45);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    /* ══ COACH MARKS ══ */
    #coach-overlay {
      position: fixed; inset: 0; z-index: 9998; pointer-events: none; display: none;
    }
    #coach-overlay.active {
      pointer-events: all;
    }
    #coach-svg {
      position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;
    }
    #coach-tooltip {
      position: fixed; z-index: 9999;
      background: #1A1F3C; color: white;
      border-radius: 16px; padding: 14px 16px;
      max-width: 268px; min-width: 210px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      pointer-events: all;
    }
    .coach-tooltip-anim { animation: coachPop 0.3s cubic-bezier(0.34,1.56,0.64,1) both; }
    @keyframes coachPop {
      from { transform: scale(0.82); opacity: 0; }
      to   { transform: scale(1);    opacity: 1; }
    }
    .coach-arrow {
      position: absolute; width: 0; height: 0;
    }
    .coach-arrow.down {
      border-left: 9px solid transparent; border-right: 9px solid transparent;
      border-top: 10px solid #1A1F3C;
      bottom: -10px; left: 50%; transform: translateX(-50%);
    }
    .coach-arrow.up {
      border-left: 9px solid transparent; border-right: 9px solid transparent;
      border-bottom: 10px solid #1A1F3C;
      top: -10px; left: 50%; transform: translateX(-50%);
    }
    .coach-arrow.right {
      border-top: 9px solid transparent; border-bottom: 9px solid transparent;
      border-left: 10px solid #1A1F3C;
      right: -10px; top: 50%; transform: translateY(-50%);
    }
    .coach-step-tag {
      font-size: 0.62em; font-weight: 900; letter-spacing: 1.5px;
      text-transform: uppercase; color: #F5C842; margin-bottom: 5px;
    }
    .coach-title {
      font-weight: 900; font-size: 0.95em; color: #fff; margin-bottom: 5px; line-height: 1.3;
    }
    .coach-desc {
      font-size: 0.78em; font-weight: 600; color: rgba(255,255,255,0.68); line-height: 1.55;
    }
    .coach-btn-row { display: flex; gap: 7px; margin-top: 11px; align-items: center; }
    .coach-prev-btn {
      padding: 7px 12px; background: rgba(255,255,255,0.1);
      border: none; border-radius: 9px; color: rgba(255,255,255,0.6);
      font-family: 'Nunito',sans-serif; font-weight: 800; font-size: 0.78em; cursor: pointer;
    }
    .coach-next-btn {
      flex: 1; padding: 8px 12px; background: #F5C842;
      border: none; border-radius: 9px; color: #1A1F3C;
      font-family: 'Nunito',sans-serif; font-weight: 900; font-size: 0.85em; cursor: pointer;
    }
    .coach-skip-btn {
      padding: 7px 8px; background: transparent; border: none;
      color: rgba(255,255,255,0.3); font-family: 'Nunito',sans-serif;
      font-weight: 800; font-size: 0.7em; cursor: pointer;
    }
    .coach-progress {
      font-size: 0.63em; font-weight: 800; color: rgba(255,255,255,0.25);
      text-align: right; margin-top: 5px;
    }
    #coach-pulse {
      position: fixed; border-radius: 12px;
      border: 2.5px solid #F5C842; pointer-events: none; z-index: 9999;
      animation: coachPulse 1.5s ease-in-out infinite;
    }
    @keyframes coachPulse {
      0%,100% { box-shadow: 0 0 0 0 rgba(245,200,66,0.6); }
      50%      { box-shadow: 0 0 0 10px rgba(245,200,66,0); }
    }
  </style>
</head>
<body>

<!-- ══ COACH MARK OVERLAY ══ -->
<div id="coach-overlay">
  <svg id="coach-svg" xmlns="http://www.w3.org/2000/svg"></svg>
  <div id="coach-pulse" style="display:none;"></div>
  <div id="coach-tooltip" style="display:none;"></div>
</div>
<div id="onboarding-overlay" style="display:none;">
  <div class="ob-slides-wrap" id="ob-slides-wrap">
    <div class="ob-slides-track" id="ob-track">

      <!-- Slide 1: Welcome -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:300px;height:300px;background:#F5C842;top:-80px;right:-80px;"></div>
        <div class="ob-bg-circle" style="width:200px;height:200px;background:#3B4A9C;bottom:-40px;left:-60px;"></div>
        <div class="ob-slide-art">💰</div>
        <div class="ob-slide-tag">Welcome</div>
        <div class="ob-slide-title">Meet <span class="ob-highlight">MoneyFi</span></div>
        <div class="ob-slide-desc">Your personal finance companion — built for clarity, designed for real life. Track every dollar, across every country.</div>
      </div>

      <!-- Slide 2: Tracking -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:250px;height:250px;background:#10B981;top:-60px;left:-60px;"></div>
        <div class="ob-bg-circle" style="width:180px;height:180px;background:#F5C842;bottom:-30px;right:-50px;"></div>
        <div class="ob-slide-art">📊</div>
        <div class="ob-slide-tag">Track</div>
        <div class="ob-slide-title">Income, Spending <span class="ob-highlight">&amp; Beyond</span></div>
        <div class="ob-slide-desc">Log income, expenses, investments and debts. View by day, week, month or year. Spot trends instantly.</div>
      </div>

      <!-- Slide 3: Net Worth -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:280px;height:280px;background:#7C3AED;top:-70px;right:-70px;"></div>
        <div class="ob-bg-circle" style="width:160px;height:160px;background:#EF4444;bottom:-20px;left:-40px;"></div>
        <div class="ob-slide-art">💎</div>
        <div class="ob-slide-tag">Net Worth</div>
        <div class="ob-slide-title">Your <span class="ob-highlight">Full Picture</span></div>
        <div class="ob-slide-desc">Assets, liabilities, real estate, gold &amp; silver — all in one place. Multi-currency with live FX rates you control.</div>
      </div>

      <!-- Slide 4: Goals -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:260px;height:260px;background:#F97316;top:-50px;left:-70px;"></div>
        <div class="ob-bg-circle" style="width:200px;height:200px;background:#3B4A9C;bottom:-50px;right:-50px;"></div>
        <div class="ob-slide-art">🎯</div>
        <div class="ob-slide-tag">Goals</div>
        <div class="ob-slide-title">Dream It. <span class="ob-highlight">Track It.</span></div>
        <div class="ob-slide-desc">Set goals to grow savings, buy property, or pay off a loan. Watch your progress bar fill up in real time.</div>
      </div>

      <!-- Slide 5: Get Started -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:320px;height:320px;background:#F5C842;top:-100px;right:-100px;opacity:0.1;"></div>
        <div class="ob-bg-circle" style="width:220px;height:220px;background:#10B981;bottom:-60px;left:-60px;opacity:0.1;"></div>
        <div class="ob-slide-art">🚀</div>
        <div class="ob-slide-tag">You're all set</div>
        <div class="ob-slide-title">Let's <span class="ob-highlight">Get Started</span></div>
        <div class="ob-slide-desc">Your financial story starts now. Tap below and add your first account — it takes less than a minute.</div>
      </div>

    </div>
  </div>

  <!-- Bottom controls -->
  <div class="ob-bottom">
    <div class="ob-dots" id="ob-dots">
      <div class="ob-dot active" onclick="obGoTo(0)"></div>
      <div class="ob-dot" onclick="obGoTo(1)"></div>
      <div class="ob-dot" onclick="obGoTo(2)"></div>
      <div class="ob-dot" onclick="obGoTo(3)"></div>
      <div class="ob-dot" onclick="obGoTo(4)"></div>
    </div>
    <div class="ob-btn-row">
      <button class="ob-skip-btn" id="ob-skip-btn" onclick="dismissOnboarding()">Skip</button>
      <button class="ob-next-btn" id="ob-next-btn" onclick="obNext()">Next →</button>
    </div>
  </div>
</div>

<!-- ══ THEME DECORATION ELEMENTS (always present, visible only when theme active) ══ -->
<!-- Looney -->
<div class="looney-char" style="bottom:160px;right:15px;animation-delay:0s;">🐰</div>
<div class="looney-char" style="bottom:320px;left:10px;animation-delay:1.2s;font-size:2em;">🦆</div>
<div class="looney-char" style="top:120px;right:8px;animation-delay:0.6s;font-size:1.8em;">🐦</div>
<div class="looney-char" style="top:300px;left:5px;animation-delay:1.8s;font-size:2.2em;">🐱</div>
<!-- Jungle -->
<div class="jungle-leaf" style="top:80px;right:5px;animation-delay:0s;">🍃</div>
<div class="jungle-leaf" style="bottom:200px;left:8px;animation-delay:1s;font-size:2.5em;">🌿</div>
<div class="jungle-leaf" style="top:280px;right:12px;animation-delay:2s;font-size:1.8em;">🐒</div>
<div class="jungle-leaf" style="bottom:350px;left:5px;animation-delay:0.5s;font-size:2.2em;">🦜</div>
<div class="jungle-leaf" style="top:180px;left:3px;animation-delay:1.5s;">🌺</div>
<!-- Space -->
<div class="space-star" style="top:100px;right:20px;animation-delay:0s;">⭐</div>
<div class="space-star" style="top:200px;left:15px;animation-delay:0.8s;">🌙</div>
<div class="space-star" style="bottom:250px;right:25px;animation-delay:0.4s;">✨</div>
<div class="space-star" style="top:350px;right:10px;animation-delay:1.2s;font-size:1.5em;">🚀</div>
<div class="space-star" style="bottom:300px;left:12px;animation-delay:1.6s;">💫</div>
<!-- Ocean -->
<div class="ocean-wave" style="bottom:160px;right:8px;animation-delay:0s;">🐠</div>
<div class="ocean-wave" style="top:200px;left:6px;animation-delay:1s;font-size:1.5em;">🌊</div>
<div class="ocean-wave" style="bottom:340px;right:12px;animation-delay:2s;font-size:1.8em;">🐚</div>
<div class="ocean-wave" style="top:320px;left:8px;animation-delay:0.5s;">🐟</div>

<!-- ══ LOCK SCREEN — COMMENTED OUT (RE-ENABLE LATER) ══
=== To re-enable: uncomment this entire block and the JS PIN section below ===
<div id="lock-screen" style="display:none;">
  ... lock screen HTML ...
</div>
=== END COMMENTED PIN LOCK SCREEN === -->

<!-- Decorative -->
<div class="deco-circle deco-yellow" style="width:160px;height:160px;top:-60px;right:-50px;opacity:0.7;"></div>
<div class="deco-circle deco-blue" style="width:120px;height:120px;bottom:120px;left:-40px;opacity:0.8;"></div>
<div class="deco-circle deco-yellow" style="width:80px;height:80px;bottom:200px;right:20px;opacity:0.5;"></div>

<!-- TOP BAR — Clean layout with icons inside topbar -->
<div class="topbar">
  <div class="topbar-title">💰 MoneyFlow</div>
  <div style="display:flex;align-items:center;gap:8px;">
    <div class="topbar-badge" id="topbar-month" style="cursor:default;">Feb 2026</div>
    <div class="topbar-icons">
      <button class="topbar-icon-btn" onclick="goToScreen('metals')" title="Metals">🥇</button>
      <button class="topbar-icon-btn" onclick="goToScreen('networth')" title="Net Worth">💎</button>
      <button class="topbar-icon-btn" onclick="goToScreen('settings')" title="Settings">⚙️</button>
    </div>
  </div>
</div>

<!-- ══════════════ HOME ══════════════ -->
<div class="screen active" id="screen-home">
  <!-- Time Period Selector -->
  <div class="time-period-bar" id="time-period-bar">
    <button class="period-tab" onclick="setPeriod('day',this)">Day</button>
    <button class="period-tab active" onclick="setPeriod('month',this)">Month</button>
    <button class="period-tab" onclick="setPeriod('week',this)">Week</button>
    <button class="period-tab" onclick="setPeriod('year',this)">Year</button>
  </div>
  <!-- Day chips (shown in day/week mode) -->
  <div class="period-detail" id="period-detail"></div>
  <!-- Period navigation -->
  <div class="period-nav">
    <button onclick="changePeriod(-1)">‹</button>
    <div class="period-label" id="home-month-label">February 2026</div>
    <button onclick="changePeriod(1)">›</button>
  </div>

  <!-- Spending / Investment Tab Toggle -->
  <div class="home-tab-bar">
    <button class="home-tab-btn active" id="htab-spending" onclick="setHomeTab('spending')">💸 Spending</button>
    <button class="home-tab-btn" id="htab-invest" onclick="setHomeTab('invest')">📈 Investing</button>
  </div>

  <!-- ── SPENDING SECTION ── -->
  <div class="home-section active" id="hsec-spending">
    <div class="spending-hero">
      <div class="spending-label">💸 Total Spending</div>
      <div class="spending-amount" id="home-spending">$0</div>
    </div>
    <div class="budget-grid" id="budget-grid"></div>

    <!-- Insights Card -->
    <div class="insights-card" id="home-insights-card">
      <div class="insights-header" onclick="toggleInsights()">
        <div class="insights-header-left">
          <span style="font-size:1.2em;">💡</span>
          <span class="insights-title">Monthly Insights</span>
        </div>
        <span class="insights-toggle" id="insights-toggle-arrow">▾</span>
      </div>
      <!-- KPI strip — always visible inside the header area -->
      <div style="padding:0 16px 14px;" id="insights-kpi-strip"></div>
      <!-- Expandable body -->
      <div class="insights-body" id="insights-body">
        <div class="insights-chips" id="insights-chips"></div>
      </div>
    </div>

    <div class="home-income-section">
      <div class="home-income-header">
        <div class="home-income-title">💵 Income</div>
        <div class="home-income-total" id="home-income">$0</div>
      </div>
      <div class="income-sub-grid">
        <div class="income-sub-card" onclick="openQuickAdd('income','Salary')">
          <div class="isc-icon">💼</div><div class="isc-name">Salary</div>
          <div class="isc-amount" id="home-salary">$0</div>
        </div>
        <div class="income-sub-card" onclick="openQuickAdd('income','Gift')">
          <div class="isc-icon">🎁</div><div class="isc-name">Gifts</div>
          <div class="isc-amount" id="home-gifts">$0</div>
        </div>
        <div class="income-sub-card" onclick="openQuickAdd('income','Other')">
          <div class="isc-icon">💰</div><div class="isc-name">Others</div>
          <div class="isc-amount" id="home-other-income">$0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ── INVESTMENT SECTION ── -->
  <div class="home-section" id="hsec-invest">
    <div class="invest-home-hero">
      <div class="invest-home-hero-label">📈 Total Portfolio Value</div>
      <div class="invest-home-hero-amt" id="home-invest-total">$0</div>
    </div>
    <div class="invest-cat-grid" id="invest-cat-grid"></div>
  </div>
</div>

<!-- ══════════════ TRANSACTIONS / CALENDAR ══════════════ -->
<div class="screen" id="screen-tx">
  <!-- Month Navigation -->
  <div class="cal-header">
    <button class="cal-nav-btn" onclick="calChangeMonth(-1)">&#8249;</button>
    <div class="cal-month-title" id="cal-month-title"></div>
    <button class="cal-nav-btn" onclick="calChangeMonth(1)">&#8250;</button>
  </div>
  <div style="display:flex;justify-content:flex-end;gap:6px;margin-bottom:8px;">
    <button id="cal-view-btn-calendar" onclick="setCalView('calendar')" style="background:#1E2A6E;color:white;border:none;border-radius:8px;padding:5px 12px;font-size:0.78em;font-weight:800;cursor:pointer;">📅 Calendar</button>
    <button id="cal-view-btn-list" onclick="setCalView('list')" style="background:#F0F0F0;color:var(--text-med);border:none;border-radius:8px;padding:5px 12px;font-size:0.78em;font-weight:800;cursor:pointer;">📋 List</button>
  </div>
  <!-- Monthly Summary -->
  <div class="cal-summary">
    <div class="cal-sum-item income">
      <div class="cal-sum-label">Income</div>
      <div class="cal-sum-val" id="cal-total-income">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item expense">
      <div class="cal-sum-label">Expenses</div>
      <div class="cal-sum-val" id="cal-total-expense">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item savings">
      <div class="cal-sum-label">INVESTING</div>
      <div class="cal-sum-val" id="cal-total-savings">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item net">
      <div class="cal-sum-label">Net</div>
      <div class="cal-sum-val" id="cal-total-net">$0</div>
    </div>
  </div>
  <!-- Calendar Grid -->
  <div class="cal-grid-wrap">
    <div class="cal-dow-row">
      <div class="cal-dow">SUN</div><div class="cal-dow">MON</div><div class="cal-dow">TUE</div>
      <div class="cal-dow">WED</div><div class="cal-dow">THU</div><div class="cal-dow">FRI</div><div class="cal-dow">SAT</div>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
  <!-- Month list view -->
  <div id="cal-list-view" style="display:none;"></div>
  </div>
  <!-- Day Detail -->
  <div id="cal-day-detail"></div>
</div>

<!-- ══════════════ ADD ══════════════ -->
<div class="screen" id="screen-add">
  <div class="add-type-toggle">
    <button class="add-type-btn active" onclick="setAddType('expense',this)">Expense</button>
    <button class="add-type-btn" onclick="setAddType('income',this)">Income</button>
    <button class="add-type-btn" onclick="setAddType('investment',this)">Investment</button>
    <button class="add-type-btn" onclick="setAddType('debt',this)">Debt</button>
    <button class="add-type-btn" onclick="setAddType('given',this)">Given</button>
    <button class="add-type-btn" onclick="setAddType('additional',this)">Additional</button>
  </div>
  <div class="amount-display">
    <div class="amount-num"><span class="amount-cur">$</span><span id="add-amount-display">0</span></div>
  </div>
  <div class="sub-cats" id="sub-cats-row"></div>
  <div class="add-form">
    <div class="form-row">
      <span class="form-icon">📝</span><span class="form-label">Note</span>
      <input type="text" class="form-input" id="add-note" placeholder="Add note...">
    </div>
    <div class="form-row">
      <span class="form-icon">📅</span><span class="form-label">Date</span>
      <input type="date" class="form-input" id="add-date" style="text-align:right;">
    </div>
    <div class="form-row">
      <span class="form-icon">💳</span><span class="form-label">Account</span>
      <select class="form-select" id="add-account"><option>Cash</option><option>Paypal</option><option>Bank</option></select>
    </div>
  </div>
  <div class="numpad">
    <div class="numpad-grid" id="numpad-grid"></div>
  </div>
</div>

<!-- ══════════════ DATA ══════════════ -->
<div class="screen" id="screen-data">
  <div class="data-controls">
    <div class="data-controls-row">
      <span class="data-label">📅 Month:</span>
      <select id="data-month-select" onchange="renderDataScreen()" style="flex:1;background:#F8F8F8;border:1.5px solid #EEE;border-radius:10px;padding:8px 12px;font-family:Nunito,sans-serif;font-weight:700;font-size:0.88em;color:var(--text-dark);outline:none;"></select>
    </div>
    <div class="data-controls-row">
      <span class="data-label">🗓 Range:</span>
      <input type="date" id="data-filter-start" onchange="renderDataScreen()" class="date-filter-input" style="flex:1;">
      <span class="data-label">to</span>
      <input type="date" id="data-filter-end" onchange="renderDataScreen()" class="date-filter-input" style="flex:1;">
      <button class="icon-btn" onclick="clearDataFilter()">Clear</button>
    </div>
    <div class="data-controls-row">
      <button class="icon-btn danger" onclick="deleteCurrentDataMonth()">🗑️ Month</button>
    </div>
  </div>
  <div id="data-sections"></div>
</div>

<!-- ══════════════ STATS ══════════════ -->
<div class="screen" id="screen-stats">
  <div class="chart-card">
    <div class="chart-title">Spending Trend (6 months)</div>
    <div class="chart-container"><canvas id="trendChart"></canvas></div>
    <div style="display:flex;gap:20px;margin-top:12px;justify-content:center;">
      <div style="display:flex;align-items:center;gap:6px;font-size:0.82em;font-weight:700;color:var(--expenses);"><div style="width:24px;height:3px;background:var(--expenses);border-radius:2px;"></div>Spending <span id="stat-spending-total">$0</span></div>
      <div style="display:flex;align-items:center;gap:6px;font-size:0.82em;font-weight:700;color:var(--income);"><div style="width:24px;height:3px;background:var(--income);border-radius:2px;"></div>Income <span id="stat-income-total">$0</span></div>
    </div>
  </div>
  <div class="spending-tops">
    <div class="chart-title">Top 5 Spending Categories</div>
    <div style="display:flex;gap:20px;align-items:center;">
      <div style="position:relative;width:120px;height:120px;flex-shrink:0;"><canvas id="donutChart"></canvas></div>
      <div id="top5-list" style="flex:1;"></div>
    </div>
  </div>
  <div class="chart-card">
    <div class="chart-title">Budget vs Spent</div>
    <div id="budget-bars"></div>
  </div>
  <div class="chart-card">
    <div class="chart-title">Account Breakdown</div>
    <div style="display:flex;gap:20px;align-items:center;">
      <canvas id="accountChart" width="120" height="120" style="width:120px;height:120px;flex-shrink:0;"></canvas>
      <div id="account-breakdown" style="flex:1;"></div>
    </div>
  </div>
</div>

<!-- ══════════════ ACCOUNT ══════════════ -->
<div class="screen" id="screen-account">
  <div class="networth-card">
    <div class="nw-label">Net Worth</div>
    <div class="nw-amount" id="nw-amount">$0</div>
    <div class="nw-sub">
      <div class="nw-sub-item">Assets<span id="nw-assets">$0</span></div>
      <div class="nw-sub-item">Liabilities<span id="nw-liabilities" class="negative">$0</span></div>
    </div>
  </div>
  <div class="account-section-title">Assets</div>
  <div class="account-grid" id="account-assets-grid"></div>
  <div class="account-section-title">Liabilities</div>
  <div class="account-grid" id="account-debts-grid"></div>
  <button onclick="showAddAccountModal()" style="width:100%;background:var(--yellow);border:none;border-radius:var(--radius-sm);padding:16px;font-family:Nunito,sans-serif;font-weight:900;font-size:0.95em;color:var(--text-dark);cursor:pointer;box-shadow:0 4px 15px rgba(245,200,66,0.4);margin-top:8px;">+ Add Account</button>
</div>

<!-- ══════════════ METALS ══════════════ -->
<div class="screen" id="screen-metals">
  <div class="metals-portfolio-bar">
    <div class="metals-portfolio-title">Total Precious Metals Value</div>
    <div class="metals-portfolio-total" id="metals-grand-total">$0</div>
    <div class="metals-mini-cards">
      <div class="metals-mini-card gold-card active-metal" id="mini-gold" onclick="switchMetal('gold')">
        <div class="metals-mini-icon">🥇</div><div class="metals-mini-name">Gold</div>
        <div class="metals-mini-grams" id="mini-gold-grams">0 g</div><div class="metals-mini-usd" id="mini-gold-usd">$0</div>
      </div>
      <div class="metals-mini-card silver-card" id="mini-silver" onclick="switchMetal('silver')">
        <div class="metals-mini-icon">🥈</div><div class="metals-mini-name">Silver</div>
        <div class="metals-mini-grams" id="mini-silver-grams">0 g</div><div class="metals-mini-usd" id="mini-silver-usd">$0</div>
      </div>
      <div class="metals-mini-card platinum-card" id="mini-platinum" onclick="switchMetal('platinum')">
        <div class="metals-mini-icon">🔷</div><div class="metals-mini-name">Platinum</div>
        <div class="metals-mini-grams" id="mini-platinum-grams">0 g</div><div class="metals-mini-usd" id="mini-platinum-usd">$0</div>
      </div>
    </div>
  </div>
  <div class="metal-detail-header">
    <div class="metal-detail-icon-wrap gold" id="metal-detail-icon">🥇</div>
    <div class="metal-detail-info">
      <div class="metal-detail-name" id="metal-detail-name">Gold</div>
      <div class="metal-detail-grams" id="metal-detail-grams">0 g · 0.000 oz</div>
      <div class="metal-detail-usd gold" id="metal-detail-usd">$0</div>
    </div>
    <div style="background:#F8F8F8;border-radius:8px;padding:6px 10px;font-size:0.72em;font-weight:800;color:var(--text-med);text-align:center;flex-shrink:0;">
      <div style="font-size:0.72em;color:var(--text-light);" id="metal-price-base-label">$/gram (24K pure)</div>
      <div style="display:flex;align-items:center;gap:6px;">
        <span style="font-size:1.3em;font-weight:900;color:var(--text-dark);" id="metal-live-price">$96.50</span>
        <button onclick="showMetalPriceEdit()" style="background:#F0F4FF;border:none;border-radius:7px;padding:3px 8px;font-size:0.72em;font-weight:800;color:var(--primary);cursor:pointer;">✏️ Edit</button>
      </div>
      <div id="metal-price-override-panel" style="display:none;margin-top:8px;background:white;border:1.5px solid #DDD;border-radius:10px;padding:10px 12px;text-align:left;">
        <div style="font-size:0.78em;font-weight:800;color:var(--text-dark);margin-bottom:6px;" id="metal-price-override-label">Set base $/gram:</div>
        <div style="display:flex;gap:8px;margin-bottom:8px;">
          <input type="number" id="metal-price-override-input" step="0.01" placeholder="e.g. 96.50" style="flex:1;border:1.5px solid #DDD;border-radius:8px;padding:6px 10px;font-size:0.9em;font-weight:700;">
          <button onclick="applyMetalPriceOverride()" style="background:#10B981;color:white;border:none;border-radius:8px;padding:6px 12px;font-weight:800;font-size:0.82em;cursor:pointer;">✓</button>
          <button onclick="resetMetalPriceOverride(currentMetal)" style="background:#FFF0F0;color:#EF4444;border:none;border-radius:8px;padding:6px 10px;font-weight:800;font-size:0.82em;cursor:pointer;">Reset All</button>
        </div>
        <div id="metal-purity-prices"></div>
      </div>
    </div>
  </div>
  <div class="metal-stat-row">
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-entries">0</div><div class="metal-stat-box-lbl">Entries</div></div>
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-oz">0</div><div class="metal-stat-box-lbl">Troy Oz</div></div>
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-avg">$0</div><div class="metal-stat-box-lbl">Avg Cost/g</div></div>
  </div>
  <div class="metal-add-panel">
    <div class="metal-add-panel-header" onclick="toggleAddPanel()">
      <div class="metal-add-panel-title"><span id="metal-add-icon">🥇</span> Add <span id="metal-add-label">Gold</span> Entry</div>
      <div class="metal-add-panel-toggle" id="add-panel-toggle">+</div>
    </div>
    <div class="metal-add-panel-body" id="metal-add-panel-body">
      <div class="metal-form-grid">
        <div class="metal-form-field"><label>Source / Name</label><input type="text" id="metal-name" placeholder="e.g. OneGold, Coin"></div>
        <div class="metal-form-field"><label>Weight (grams)</label><input type="number" id="metal-grams" placeholder="0.00" step="0.001"></div>
        <div class="metal-form-field"><label>Purity</label><input type="text" id="metal-purity" placeholder="e.g. 22K, 999"></div>
        <div class="metal-form-field"><label>Occasion</label><input type="text" id="metal-occasion" placeholder="e.g. Purchase, Gift"></div>
        <div class="metal-form-field"><label>Purchase Price / gram ($)</label><input type="number" id="metal-price" placeholder="Leave blank = current est." step="0.01"></div>
        <div class="metal-form-field"><label>Date</label><input type="date" id="metal-date"></div>
        <div class="metal-form-field"><label>Form</label><select id="metal-form"><option>Bar</option><option>Coin</option><option>Round</option><option>ETF / Digital</option><option>Jewelry</option><option>Other</option></select></div>
        <div class="metal-form-field"><label>Notes</label><input type="text" id="metal-notes" placeholder="Optional"></div>
      </div>
      <button class="metal-save-btn gold" id="metal-save-btn" onclick="addMetalEntry()">+ Add Gold Entry</button>
      <div style="font-size:0.73em;color:var(--text-light);font-weight:600;margin-top:10px;text-align:center;" id="metal-price-hint">💡 Est. gold ≈ $95.50/g · $2,970/oz</div>
    </div>
  </div>
  <div class="metal-holdings-card">
    <div class="metal-holdings-header">
      <div class="metal-holdings-title" id="holdings-list-title">🥇 Gold Holdings</div>
      <div class="metal-holdings-count" id="holdings-list-count">0 entries</div>
    </div>
    <div id="metals-holdings-list"><div class="metal-empty"><div class="metal-empty-icon">🥇</div><div class="metal-empty-text">No gold entries yet</div></div></div>
  </div>
</div>

<!-- ══════════════ INVESTMENTS ══════════════ -->
<div class="screen" id="screen-invest">
  <div class="invest-hero">
    <div class="invest-deco">📈</div>
    <div class="invest-hero-label">Total Portfolio Value</div>
    <div class="invest-hero-value" id="invest-total-value">$0</div>
    <div class="invest-hero-stats">
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-cost">$0</div><div class="invest-hero-stat-lbl">Total Cost</div></div>
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-gain">$0</div><div class="invest-hero-stat-lbl">Gain / Loss</div></div>
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-pct">0%</div><div class="invest-hero-stat-lbl">Return</div></div>
    </div>
  </div>
  <div class="invest-cat-tabs" id="invest-cat-tabs">
    <button class="invest-cat-tab active" onclick="filterInvest('All',this)">All</button>
    <button class="invest-cat-tab" onclick="filterInvest('Stocks',this)">📊 Stocks</button>
    <button class="invest-cat-tab" onclick="filterInvest('ETF',this)">🗂 ETF</button>
    <button class="invest-cat-tab" onclick="filterInvest('Crypto',this)">🪙 Crypto</button>
    <button class="invest-cat-tab" onclick="filterInvest('Retirement',this)">🏦 Retirement</button>
    <button class="invest-cat-tab" onclick="filterInvest('Real Estate',this)">🏡 Real Estate</button>
    <button class="invest-cat-tab" onclick="filterInvest('Other',this)">📦 Other</button>
  </div>
  <div id="invest-holdings-list" style="margin-bottom:16px;"></div>
  <div class="invest-entry-card">
    <div class="invest-entry-title">➕ Add Investment</div>
    <div class="inv-form-grid">
      <div class="inv-field"><label>Ticker / Name</label><input type="text" id="inv-ticker" placeholder="e.g. FXAIX, BTC"></div>
      <div class="inv-field"><label>Category</label><select id="inv-cat"><option>Stocks</option><option>ETF</option><option>Crypto</option><option>Retirement</option><option>Real Estate</option><option>Other</option></select></div>
      <div class="inv-field"><label>Shares / Units</label><input type="number" id="inv-shares" placeholder="0.00" step="0.0001"></div>
      <div class="inv-field"><label>Avg Cost / Share ($)</label><input type="number" id="inv-cost" placeholder="0.00" step="0.01"></div>
      <div class="inv-field"><label>Current Price ($)</label><input type="number" id="inv-price" placeholder="0.00" step="0.01"></div>
      <div class="inv-field"><label>Date Added</label><input type="date" id="inv-date"></div>
      <div class="inv-field full"><label>Account / Broker</label><input type="text" id="inv-broker" placeholder="e.g. Fidelity, Robinhood, Webull"></div>
    </div>
    <button class="add-invest-btn" onclick="addInvestEntry()">+ Add to Portfolio</button>
  </div>
</div>

<!-- ══════════════ SETTINGS ══════════════ -->
<div class="screen" id="screen-settings">
  <!-- Data Management (moved from Home) -->
  
    <!-- ═══ Firebase Account ═══ -->
    <div style="background:white;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 1px 6px rgba(0,0,0,0.06);">
      <div style="font-size:0.7em;font-weight:800;color:#888;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px;">☁️ Cloud Sync Account</div>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <img id="firebase-user-avatar" src="" style="display:none;width:40px;height:40px;border-radius:50%;border:2px solid #E8E8E8;">
        <div>
          <div id="firebase-user-display" style="font-weight:800;font-size:0.9em;color:#1E2A6E;">Loading...</div>
          <div style="font-size:0.72em;color:#10B981;font-weight:700;">✅ Synced across devices</div>
        </div>
      </div>
      <button onclick="signOut()" style="width:100%;padding:10px;background:#FFF0F0;border:1.5px solid #FFCDD2;border-radius:10px;color:#EF4444;font-weight:800;font-size:0.82em;cursor:pointer;">
        Sign Out
      </button>
    </div>
    <!-- ══════════════════════ -->
<div class="settings-card">
    <div class="settings-title">💾 Data Management</div>
    <div class="form-row">
      <span class="form-icon">💾</span><span class="form-label">Backup</span>
      <button onclick="downloadBackup()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">⬇️ Download</button>
    </div>
    <div class="form-row">
      <span class="form-icon">📊</span><span class="form-label">Export</span>
      <button onclick="exportAllData()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">Export Excel</button>
    </div>
    <div class="form-row" style="border-bottom:none;">
      <span class="form-icon">📥</span><span class="form-label">Restore</span>
      <label for="restore-settings-file" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">⬆️ Upload</label>
      <input type="file" id="restore-settings-file" accept=".json" style="display:none;" onchange="restoreBackup(this)">
    </div>
    <div class="form-row" style="border-bottom:none;margin-top:4px;">
      <span class="form-icon">🎬</span><span class="form-label">Intro Tour</span>
      <div style="display:flex;gap:6px;">
        <button onclick="showOnboarding()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 12px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">▶ Slides</button>
        <button onclick="startCoachTour()" style="background:var(--primary-light);border:none;border-radius:8px;padding:8px 12px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--primary);">🎯 Coach</button>
      </div>
    </div>
  </div>

  <!-- PIN Lock — COMMENTED OUT, RE-ENABLE LATER -->
  <!-- 
  === PIN LOCK SETTINGS UI — Uncomment to re-enable ===
  <div class="settings-card">
    <div class="settings-title">🔒 App Lock</div>
    <div class="form-row">
      <span class="form-icon">🔑</span>
      <div style="flex:1;">
        <div style="font-weight:800;font-size:0.9em;color:var(--text-dark);">PIN Lock</div>
        <div style="font-size:0.76em;color:var(--text-light);font-weight:600;margin-top:2px;" id="pin-status-label">Not set up</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="pin-toggle-btn" onclick="handlePinToggle()">Set PIN</button>
        <button id="pin-change-btn" onclick="showChangePIN()" style="display:none;">Change</button>
      </div>
    </div>
  </div>
  === END PIN LOCK SETTINGS === -->

  <!-- Currency -->
  <div class="settings-card">
    <div class="settings-title">💱 Currency</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">All amounts display in your chosen currency symbol.</p>
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="font-weight:900;font-size:1.1em;" id="settings-curr-display">🇺🇸 USD — $</div>
        <div style="font-size:0.78em;color:var(--text-light);margin-top:2px;" id="settings-curr-name">US Dollar</div>
      </div>
      <button onclick="openCurrencyPicker('settings')" style="background:var(--yellow);border:none;border-radius:10px;padding:10px 18px;font-family:Nunito,sans-serif;font-weight:900;font-size:0.88em;cursor:pointer;">Change</button>
    </div>
  </div>

  <!-- FX Exchange Rates -->
  <div class="settings-card">
    <div class="settings-title">💱 Exchange Rates <span id="fx-override-badge" style="display:none;background:#F0FFF4;color:#10B981;font-size:0.65em;border-radius:8px;padding:2px 8px;font-weight:800;margin-left:6px;vertical-align:middle;">✏️ Custom</span></div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Rates used to convert your multi-currency assets &amp; transactions to <span id="fx-base-label">USD</span>. Override any rate if the built-in estimate is off.</p>
    <div id="fx-rates-list"></div>
    <div style="margin-top:10px;font-size:0.72em;color:var(--text-light);font-weight:600;">
      💡 Rates shown as: 1 USD = N units. Only currencies found in your data appear here.
    </div>
  </div>

  <!-- Home Spending Cards Manager -->
  <div class="settings-card">
    <div class="settings-title">🏠 Home Spending Cards</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which category cards appear on your home screen. Toggle ✓ to show/hide, ✕ to permanently remove.</p>
    <div class="home-card-grid" id="home-card-grid"></div>
    <div style="margin-top:10px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;">ADD CUSTOM CARD</div>
      <div class="home-card-emoji-pick" id="home-card-emoji-row"></div>
      <div class="home-card-add-row">
        <input type="text" class="cat-add-input" id="home-card-name-input" placeholder="Card name (e.g. Groceries)">
        <button class="cat-add-btn" onclick="addHomeCard()">+ Add</button>
      </div>
    </div>
  </div>

  <!-- Investment Cards Manager -->
  <div class="settings-card">
    <div class="settings-title">📈 Home Investment Cards</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which investment cards appear on the Investing tab. Toggle ✓ to show/hide, ✕ to remove. Add custom cards like PF, NPS, FD, etc.</p>
    <div class="home-card-grid" id="inv-card-grid"></div>
    <div style="margin-top:10px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;">ADD CUSTOM INVESTMENT CARD</div>
      <div style="font-size:0.75em;color:var(--text-light);font-weight:600;margin-bottom:8px;">Pick an emoji, name your card, choose how it tracks (contributions like PF/VPF/FD, or units like ETF)</div>
      <div class="home-card-emoji-pick" id="inv-card-emoji-row"></div>
      <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;">
        <input type="text" class="cat-add-input" id="inv-card-name-input" placeholder="Card name (e.g. PF/VPF, NPS, FD)" style="flex:2;min-width:140px;">
        <select id="inv-card-template" class="cat-add-input" style="flex:1;min-width:110px;">
          <option value="General">💰 Contribution</option>
          <option value="ETF/MF">📊 Units × NAV</option>
          <option value="Stocks">📈 Shares × Price</option>
          <option value="Crypto">🪙 Coins × Price</option>
          <option value="Metals">🥇 Weight × Cost</option>
          <option value="Real Estate">🏡 Property</option>
        </select>
      </div>
      <button class="cat-add-btn" style="width:100%;" onclick="addInvCard()">+ Add Investment Card</button>
    </div>
  </div>

  <!-- Category Manager -->
  <div class="settings-card">
    <div class="settings-title">🏷️ Manage Categories</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Customize subcategories used in Quick Add. Tap ✕ to remove, or add your own below.</p>
    <div class="cat-mgr-tabs" id="cat-mgr-tabs">
      <button class="cat-mgr-tab active" onclick="showCatMgrTab('expense',this)">💸 Expense</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('income',this)">💵 Income</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('investment',this)">📈 Invest</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('debt',this)">📉 Debt</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('given',this)">🤝 Given</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('additional',this)">🎁 Additional</button>
    </div>
    <div class="cat-pills-wrap" id="cat-pills-wrap"></div>
    <div class="cat-add-row">
      <input type="text" class="cat-add-input" id="cat-add-input" placeholder="New category name..." onkeydown="if(event.key==='Enter')addCustomCat()">
      <button class="cat-add-btn" onclick="addCustomCat()">+ Add</button>
    </div>
  </div>

  <!-- Net Worth Account Types -->
  <div class="settings-card" id="settings-nw-card">
    <div class="settings-title">💎 Net Worth Account Types</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which types appear in the Add Account picker. Toggle ✓ to show/hide, ✕ to remove custom types.</p>
    <div class="home-card-grid" id="nw-type-visibility-grid"></div>
    <div style="margin-top:12px;border-top:1px solid #F0F0F0;padding-top:12px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Add Custom Type</div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <div id="nw-type-emoji-row" style="display:flex;gap:4px;flex-wrap:wrap;"></div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <input type="text" id="nw-type-name-input" class="cat-add-input" placeholder="e.g. Auto Loan, Other Asset" style="flex:1;">
        <label style="display:flex;align-items:center;gap:4px;font-size:0.8em;font-weight:700;cursor:pointer;">
          <input type="checkbox" id="nw-type-is-liab"> Liability
        </label>
        <button class="cat-add-btn" onclick="addCustomNWType()">+ Add</button>
      </div>
    </div>
  </div>

  <!-- Theme Selector -->
  <div class="settings-card">
    <div class="settings-title">🎨 App Theme</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:14px;">Pick a vibe! Each theme adds fun decorations and colors.</p>
    <div class="theme-grid">
      <div class="theme-card default active-theme" id="theme-default" onclick="setTheme('default')">
        <div class="tc-preview">☀️💰</div>
        <div class="tc-name">Classic MoneyFlow</div>
        <div class="tc-desc">The original warm & sunny look</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card looney" id="theme-looney" onclick="setTheme('looney')">
        <div class="tc-preview">🐰🦆😜</div>
        <div class="tc-name">Looney Tunes!</div>
        <div class="tc-desc">Wabbit season for your wallet</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card jungle" id="theme-jungle" onclick="setTheme('jungle')">
        <div class="tc-preview">🐒🌿🦜</div>
        <div class="tc-name">Jungle Vibes</div>
        <div class="tc-desc">Go bananas with your budget!</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card space" id="theme-space" onclick="setTheme('space')">
        <div class="tc-preview">🚀⭐🌙</div>
        <div class="tc-name">Space Explorer</div>
        <div class="tc-desc">Finance at warp speed</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card ocean" id="theme-ocean" onclick="setTheme('ocean')">
        <div class="tc-preview">🐠🌊🐚</div>
        <div class="tc-name">Deep Ocean</div>
        <div class="tc-desc">Dive deep into your finances</div>
        <div class="tc-active-badge">✓</div>
      </div>
    </div>
  </div>


</div>

<!-- FAB BACKDROP -->
<div class="fab-backdrop" id="fab-backdrop" onclick="closeFabMenu()"></div>

<!-- FAB LAUNCHER MENU -->
<div class="fab-menu" id="fab-menu">
  <div class="fab-menu-item" id="fmi-investment">
    <div class="fab-menu-label">📈 Investment</div>
    <button class="fab-menu-btn" style="background:#7C3AED;color:white;" onclick="closeFabMenu();openQuickAdd('investment',null)">📈</button>
  </div>
  <div class="fab-menu-item" id="fmi-income">
    <div class="fab-menu-label">💵 Income</div>
    <button class="fab-menu-btn" style="background:#10B981;color:white;" onclick="closeFabMenu();openQuickAdd('income',null)">💵</button>
  </div>
  <div class="fab-menu-item" id="fmi-expense">
    <div class="fab-menu-label">💸 Expense</div>
    <button class="fab-menu-btn" style="background:#EF4444;color:white;" onclick="closeFabMenu();openQuickAdd('expense',null)">💸</button>
  </div>
</div>

<!-- FLOATING ADD BUTTON -->
<button class="fab-add" id="fab-add-btn" onclick="toggleFabMenu()" title="Add Transaction">＋</button>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <button class="nav-item active" onclick="switchScreen('home',this)"><div class="nav-icon">🏠</div><span>Home</span></button>
  <button class="nav-item" onclick="switchScreen('tx',this)"><div class="nav-icon">📋</div><span>Txns</span></button>
  <button class="nav-item" onclick="switchScreen('budget',this)"><div class="nav-icon">🎯</div><span>Budget</span></button>
  <button class="nav-item" onclick="switchScreen('networth',this)"><div class="nav-icon">💎</div><span>Net Worth</span></button>
  <button class="nav-item" onclick="switchScreen('import',this)"><div class="nav-icon">📥</div><span>Import</span></button>
</div>

<!-- ══════════════ BUDGET MODULE ══════════════ -->
<div class="screen" id="screen-budget">
  <!-- Module Tabs -->
  <div class="budget-module-tabs">
    <button class="bm-tab active" id="btab-overview" onclick="setBudgetTab('overview',this)">📊 Overview</button>
    <button class="bm-tab" id="btab-expenses" onclick="setBudgetTab('expenses',this)">💸 Expenses</button>
    <button class="bm-tab" id="btab-savings" onclick="setBudgetTab('savings',this)">💰 Savings</button>
    <button class="bm-tab" id="btab-goals" onclick="setBudgetTab('goals',this)">🎯 Goals</button>
  </div>

  <!-- Budget Month Nav -->
  <div class="period-nav" style="margin-bottom:12px;">
    <button onclick="budgetChangeMonth(-1)">‹</button>
    <div class="period-label" id="budget-month-label">February 2026</div>
    <button onclick="budgetChangeMonth(1)">›</button>
  </div>

  <!-- OVERVIEW TAB -->
  <div id="bsec-overview" class="budget-section">
    <!-- Hero card: Total left + dual line chart -->
    <div class="budget-hero-card" id="bh-card">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:2px;">
        <div class="bh-title" id="bh-title">TOTAL BUDGETED</div>
        <div class="bh-view-toggle">
          <button class="bh-view-btn active" id="bh-btn-month" onclick="setBudgetViewMode('month')">Month</button>
          <button class="bh-view-btn" id="bh-btn-year" onclick="setBudgetViewMode('year')">Year</button>
        </div>
      </div>
      <div class="bh-amount" id="bh-amount">$0</div>
      <div class="bh-sub" id="bh-sub"></div>
      <div class="bh-chart-wrap"><canvas id="budget-overview-chart"></canvas></div>
      <div class="bh-dual-lines">
        <div class="bh-line-block">
          <div class="bh-line-label">Expenses</div>
          <div class="bh-line-val" id="bh-exp-val">$0</div>
          <div class="bh-line-sub" id="bh-exp-sub"></div>
        </div>
        <div class="bh-line-block">
          <div class="bh-line-label">Savings</div>
          <div class="bh-line-val" id="bh-sav-val">$0</div>
          <div class="bh-line-sub" id="bh-sav-sub"></div>
        </div>
      </div>
    </div>

    <!-- Category bubbles — split by type -->
    <div id="budget-cats-wrapper">
      <div class="bcat-group-label" id="bcat-label-exp" style="display:none;">
        <span class="bcat-group-pill exp">💸 Expenses</span>
      </div>
      <div class="budget-cats-scroll" id="budget-cats-bubbles-exp"></div>
      <div class="bcat-group-label" id="bcat-label-sav" style="display:none;">
        <span class="bcat-group-pill sav">💰 Savings</span>
      </div>
      <div class="budget-cats-scroll" id="budget-cats-bubbles-sav"></div>
    </div>
  </div>

  <!-- EXPENSES GOALS TAB -->
  <div id="bsec-expenses" class="budget-section" style="display:none;">
    <!-- Category detail view (shown when a category is clicked) -->
    <div class="bcat-detail-view" id="bcat-detail-expenses">
      <button class="bcd-back-btn" onclick="closeBudgetCatDetail('expenses')">← Back</button>
      <div class="bcd-header">
        <div class="bcd-icon" id="bcd-exp-icon"></div>
        <div class="bcd-name" id="bcd-exp-name"></div>
        <div class="bcd-spent" id="bcd-exp-spent"></div>
      </div>
      <div class="bcd-chart-card">
        <div class="bcd-chart-title"><span>Last 12 Months</span></div>
        <div class="bcd-chart-outer">
          <div class="bcd-chart-wrap"><canvas id="bcd-exp-chart"></canvas></div>
          <div class="bcd-budget-chip" id="bcd-exp-chip" onclick="activateBudgetChip('expense')">
            <span class="bcd-chip-label" id="bcd-exp-chip-label">$0</span>
            <span class="bcd-chip-pencil">✏️</span>
            <input class="bcd-chip-input" id="bcd-exp-chip-input" type="number" step="1"
              onblur="saveBudgetChip('expense')"
              onkeydown="if(event.key==='Enter')saveBudgetChip('expense');if(event.key==='Escape')cancelBudgetChip('expense');">
          </div>
        </div>
      </div>
      <div class="bcd-metrics" id="bcd-exp-metrics"></div>
      <div class="bcd-txns-section">
        <div class="bcd-txns-title"><span id="bcd-exp-txn-month">Transactions</span></div>
        <div id="bcd-exp-txns"></div>
      </div>
    </div>
    <!-- Goals list -->
    <div id="blist-expenses">
      <div class="budget-goals-section">
        <div class="bgs-header">
          <div class="bgs-title">💸 Expense Budgets</div>
          <button class="bgs-add-btn" onclick="openEditBudgetPopup(null,'expense')">+ Add</button>
        </div>
        <div id="budget-exp-goals"></div>
      </div>
    </div>
  </div>

  <!-- SAVINGS GOALS TAB -->
  <div id="bsec-savings" class="budget-section" style="display:none;">
    <div class="bcat-detail-view" id="bcat-detail-savings">
      <button class="bcd-back-btn" onclick="closeBudgetCatDetail('savings')">← Back</button>
      <div class="bcd-header">
        <div class="bcd-icon" id="bcd-sav-icon"></div>
        <div class="bcd-name" id="bcd-sav-name"></div>
        <div class="bcd-spent" id="bcd-sav-spent"></div>
      </div>
      <div class="bcd-chart-card">
        <div class="bcd-chart-title"><span>Last 12 Months</span></div>
        <div class="bcd-chart-outer">
          <div class="bcd-chart-wrap"><canvas id="bcd-sav-chart"></canvas></div>
          <div class="bcd-budget-chip" id="bcd-sav-chip" onclick="activateBudgetChip('savings')">
            <span class="bcd-chip-label" id="bcd-sav-chip-label">$0</span>
            <span class="bcd-chip-pencil">✏️</span>
            <input class="bcd-chip-input" id="bcd-sav-chip-input" type="number" step="1"
              onblur="saveBudgetChip('savings')"
              onkeydown="if(event.key==='Enter')saveBudgetChip('savings');if(event.key==='Escape')cancelBudgetChip('savings');">
          </div>
        </div>
      </div>
      <div class="bcd-metrics" id="bcd-sav-metrics"></div>
      <div class="bcd-txns-section">
        <div class="bcd-txns-title"><span id="bcd-sav-txn-month">Transactions</span></div>
        <div id="bcd-sav-txns"></div>
      </div>
    </div>
    <div id="blist-savings">
      <div class="budget-goals-section">
        <div class="bgs-header">
          <div class="bgs-title">💰 Savings Goals</div>
          <button class="bgs-add-btn" onclick="openEditBudgetPopup(null,'savings')">+ Add</button>
        </div>
        <div id="budget-sav-goals"></div>
      </div>
    </div>
  </div>
</div>

<!-- ── GOALS PANEL (outside all bsec, inside screen-budget via JS control) ── -->
<div id="blist-goals" style="display:none;position:fixed;top:0;left:0;right:0;bottom:60px;overflow-y:auto;background:#FAF8F5;z-index:50;padding:16px 16px 96px;">
  <!-- Top bar -->
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <button onclick="closeGoalsPanelBack()" style="background:#F0F0F0;border:none;border-radius:10px;padding:8px 14px;font-weight:800;font-size:0.85em;cursor:pointer;">← Back</button>
    <div style="font-weight:900;font-size:1.05em;color:var(--text-dark);">🎯 Goals</div>
    <div style="width:70px;"></div>
  </div>
  <!-- Active / Achieved tabs -->
  <div style="display:flex;gap:8px;margin-bottom:14px;" id="goals-tab-bar">
    <button id="gtab-active" onclick="setGoalsTab('active')"
      style="flex:1;padding:9px 0;border:none;border-radius:12px;background:var(--yellow);color:var(--text-dark);font-family:Nunito,sans-serif;font-weight:900;font-size:0.85em;cursor:pointer;">
      🎯 Active <span id="gtab-active-count" style="background:rgba(0,0,0,0.12);border-radius:20px;padding:1px 7px;font-size:0.85em;margin-left:4px;">0</span>
    </button>
    <button id="gtab-achieved" onclick="setGoalsTab('achieved')"
      style="flex:1;padding:9px 0;border:none;border-radius:12px;background:#F0F0F0;color:var(--text-med);font-family:Nunito,sans-serif;font-weight:900;font-size:0.85em;cursor:pointer;">
      🏆 Achieved <span id="gtab-achieved-count" style="background:rgba(0,0,0,0.10);border-radius:20px;padding:1px 7px;font-size:0.85em;margin-left:4px;">0</span>
    </button>
  </div>
  <div id="goals-list-grid"></div>
</div>
<!-- Goals FAB — yellow to match main FAB for visual consistency -->
<button id="goals-fab-btn" onclick="openGoalSheet(null)"
  style="display:none;position:fixed;bottom:80px;right:20px;width:56px;height:56px;
         border-radius:50%;background:var(--yellow);color:var(--text-dark);border:none;font-size:1.8em;
         font-weight:900;box-shadow:0 4px 20px rgba(245,200,66,0.55);cursor:pointer;z-index:300;
         align-items:center;justify-content:center;line-height:1;
         animation:fabPulse 2.8s ease-in-out infinite;">＋</button>

<!-- GOAL BOTTOM SHEET -->
<div id="goal-sheet-overlay" onclick="closeGoalSheet()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:299;"></div>
<div id="goal-sheet" style="display:none;position:fixed;bottom:0;left:0;right:0;background:white;border-radius:20px 20px 0 0;padding:20px 16px 36px;z-index:300;box-shadow:0 -4px 30px rgba(0,0,0,0.2);max-height:88vh;overflow-y:auto;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <div style="font-weight:900;font-size:1em;color:var(--text-dark);" id="goal-sheet-title">New Goal</div>
    <button onclick="closeGoalSheet()" style="background:#F0F0F0;border:none;border-radius:50%;width:32px;height:32px;font-size:1.1em;cursor:pointer;">✕</button>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Goal Type</div>
      <select class="nw-sheet-select" id="gs-goaltype" onchange="toggleGoalTypeFields()">
        <option value="grow">📈 Grow (build toward target)</option>
        <option value="reduce">📉 Reduce (pay down liability)</option>
      </select>
    </div>
  </div>
  <!-- Start Balance — only shown for reduce goals -->
  <div class="nw-sheet-row" id="gs-startbal-row" style="display:none;">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Starting Balance (when you began tracking)</div>
      <input class="nw-sheet-input" id="gs-startbal" type="number" placeholder="e.g. 25000 (original loan balance)" step="any" oninput="updateGoalPreview()">
    </div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Goal Name</div>
      <input class="nw-sheet-input" id="gs-name" type="text" placeholder="e.g. Emergency Fund, Gold 1500g">
    </div>
  </div>
  <!-- Icon picker row (full width, below name) -->
  <div class="nw-sheet-field">
    <div class="nw-sheet-label">Icon <span style="font-weight:600;color:var(--text-light);text-transform:none;letter-spacing:0;">— tap to pick</span></div>
    <input type="hidden" id="gs-icon" value="🎯">
    <div id="gs-icon-grid" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Target Amount</div>
      <input class="nw-sheet-input" id="gs-target" type="number" placeholder="1000000" step="any" oninput="updateGoalPreview()">
    </div>
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Unit</div>
      <select class="nw-sheet-select" id="gs-unit">
        <option value="currency">$ (Currency)</option>
        <option value="grams">Grams (g)</option>
        <option value="kg">Kilograms (kg)</option>
        <option value="count">Count</option>
        <option value="sqft">Sq. Ft / Area (Real Estate)</option>
      </select>
    </div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Currency (if currency unit)</div>
      <select class="nw-sheet-select" id="gs-currency" onchange="updateGoalPreview()">
        <option value="USD">USD $</option>
        <option value="INR">INR ₹</option>
        <option value="EUR">EUR €</option>
        <option value="GBP">GBP £</option>
        <option value="AED">AED د.إ</option>
        <option value="SAR">SAR ﷼</option>
        <option value="CAD">CAD C$</option>
        <option value="AUD">AUD A$</option>
        <option value="SGD">SGD S$</option>
        <option value="JPY">JPY ¥</option>
        <option value="CNY">CNY ¥</option>
      </select>
    </div>
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Target Date (optional)</div>
      <input class="nw-sheet-input" id="gs-date" type="month">
    </div>
  </div>
  <div class="nw-sheet-field">
    <div class="nw-sheet-label">Description (optional)</div>
    <input class="nw-sheet-input" id="gs-desc" type="text" placeholder="e.g. Kids college fund">
  </div>
  <div class="nw-sheet-field">
    <div class="nw-sheet-label" id="gs-picker-label">Map NW Accounts to this Goal</div>
    <div style="font-size:0.72em;color:var(--text-light);font-weight:600;margin-bottom:8px;" id="gs-picker-hint">Search and select accounts — grouped by type. Combined value counts as current progress.</div>
    <input type="text" class="gap-search" id="gap-search-input" placeholder="🔍  Search accounts..." oninput="filterGoalPicker(this.value)">
    <div id="gs-account-picker" style="max-height:260px;overflow-y:auto;border:1.5px solid #EEE;border-radius:12px;padding:8px;background:white;"></div>
  </div>
  <!-- Live progress preview -->
  <div class="gap-preview-bar" id="gs-preview" style="display:none;">
    <div class="gap-preview-label">📊 Progress Preview</div>
    <div class="gap-preview-track"><div class="gap-preview-fill" id="gap-preview-fill" style="width:0%;"></div></div>
    <div class="gap-preview-nums">
      <span id="gap-preview-current" style="color:var(--primary);">—</span>
      <span id="gap-preview-pct" style="color:var(--primary);">0%</span>
      <span id="gap-preview-target" style="color:var(--text-med);">of —</span>
    </div>
  </div>
  <button id="gs-save-btn" onclick="saveGoal()" style="width:100%;background:var(--primary);color:white;border:none;border-radius:14px;padding:16px;font-weight:900;font-size:1.05em;cursor:pointer;margin-top:14px;box-shadow:0 4px 18px rgba(30,42,110,0.35);letter-spacing:0.2px;">🎯 Add Goal</button>
  <input type="hidden" id="gs-editing-id">
</div>

<!-- ══════════════ NET WORTH ══════════════ -->
<div class="screen" id="screen-networth">
  <!-- ── Hero ── -->
  <div class="nw-hero">
    <div class="nw-hero-label">💎 Total Net Worth</div>
    <div class="nw-hero-amount" id="nw-total">$0</div>
    <div class="nw-hero-change" id="nw-change"></div>
    <div class="nw-hero-bars">
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Assets</div>
        <div class="nw-hero-bar-val" id="nw-assets-hero">$0</div>
      </div>
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Liabilities</div>
        <div class="nw-hero-bar-val" id="nw-liab-hero">$0</div>
      </div>
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Debt Ratio</div>
        <div class="nw-hero-bar-val" id="nw-debt-ratio">0%</div>
        <div class="nw-debt-badge" id="nw-debt-badge"></div>
      </div>
    </div>
  </div>

  <!-- ── CTA Buttons ── -->
  <div class="nw-cta-row">
    <button class="nw-btn-snapshot" onclick="saveNWSnapshot()">📸 Save Snapshot</button>
    <button class="nw-btn-add" onclick="openNWSheet()">+ Add Account</button>
  </div>

  <!-- ── Insights Cards ── -->
  <div id="nw-insights-list"></div>

  <!-- ── Trend + Snapshots Card ── -->
  <div class="nw-trend-card" id="nw-chart-card" style="display:none;">
    <div class="nw-trend-header">
      <div class="nw-trend-title">📈 Net Worth Trend</div>
      <div class="nw-trend-badge" id="nw-snap-count">0 Snapshots</div>
    </div>
    <div class="nw-chart-wrap"><canvas id="nw-trend-chart"></canvas></div>
    <div class="nw-snaps-label">Recent Snapshots</div>
    <div id="nw-snapshots-list"></div>
  </div>

  <!-- ── Asset Allocation ── -->
  <div class="nw-alloc-card" id="nw-alloc-card" style="display:none;">
    <div class="nw-alloc-title">Asset Allocation</div>
    <!-- Stacked bar -->
    <div id="nw-alloc-stacked-bar" style="display:flex;height:22px;border-radius:11px;overflow:hidden;margin-bottom:14px;gap:2px;"></div>
    <!-- Total -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div style="font-size:0.75em;font-weight:700;color:var(--text-light);">Total Assets</div>
      <div style="font-weight:900;font-size:1em;color:var(--text-dark);" id="nw-alloc-total">$0</div>
    </div>
    <!-- Allocation rows -->
    <div id="nw-donut-legend"></div>
  </div>

  <!-- ── ASSETS section ── -->
  <div class="nw-group-header">
    <div class="nw-group-label">💰 Assets</div>
    <div class="nw-group-total" id="nw-assets-total" style="color:#10B981;"></div>
  </div>

  <div class="nw-section" id="nw-sec-checking">
    <div class="nw-section-header" onclick="toggleNWSection('checking')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#EBF5FF;">🏦</div>
        <div><div class="nw-section-name">Checking</div><div class="nw-section-sub" id="nw-sub-checking">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-checking" style="color:#4A9EFF;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-checking">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-checking">
      <button class="nw-section-add" onclick="openNWSheet('checking')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-savings_acc">
    <div class="nw-section-header" onclick="toggleNWSection('savings_acc')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#E8FDF5;">💵</div>
        <div><div class="nw-section-name">Savings</div><div class="nw-section-sub" id="nw-sub-savings_acc">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-savings_acc" style="color:#10B981;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-savings_acc">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-savings_acc">
      <button class="nw-section-add" onclick="openNWSheet('savings_acc')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-brokerage">
    <div class="nw-section-header" onclick="toggleNWSection('brokerage')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F0EBFF;">📈</div>
        <div><div class="nw-section-name">Investments &amp; Brokerage</div><div class="nw-section-sub" id="nw-sub-brokerage">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-brokerage" style="color:#7C3AED;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-brokerage">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-brokerage">
      <button class="nw-section-add" onclick="openNWSheet('brokerage')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-retirement">
    <div class="nw-section-header" onclick="toggleNWSection('retirement')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFFBE8;">🏛️</div>
        <div><div class="nw-section-name">Retirement</div><div class="nw-section-sub" id="nw-sub-retirement">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-retirement" style="color:#7C3AED;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-retirement">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-retirement">
      <button class="nw-section-add" onclick="openNWSheet('retirement')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-bonds_fd">
    <div class="nw-section-header" onclick="toggleNWSection('bonds_fd')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF7E8;">📋</div>
        <div><div class="nw-section-name">Bonds &amp; Fixed Income</div><div class="nw-section-sub" id="nw-sub-bonds_fd">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-bonds_fd" style="color:#F59E0B;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-bonds_fd">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-bonds_fd">
      <button class="nw-section-add" onclick="openNWSheet('bonds_fd')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-metals">
    <div class="nw-section-header" onclick="toggleNWSection('metals')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF8E1;">🥇</div>
        <div><div class="nw-section-name">Precious Metals</div><div class="nw-section-sub" id="nw-sub-metals">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-metals" style="color:#C8900A;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-metals">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-metals">
      <button class="nw-section-add" onclick="openNWSheet('metals')" style="margin-top:8px;">+ Add Entry</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-realestate">
    <div class="nw-section-header" onclick="toggleNWSection('realestate')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#E8F9EF;">🏡</div>
        <div><div class="nw-section-name">Real Estate</div><div class="nw-section-sub" id="nw-sub-realestate">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-realestate" style="color:#F97316;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-realestate">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-realestate">
      <button class="nw-section-add" onclick="openNWSheet('realestate')" style="margin-top:8px;">+ Add Property</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-cash">
    <div class="nw-section-header" onclick="toggleNWSection('cash')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F0FFF0;">💴</div>
        <div><div class="nw-section-name">Cash &amp; Wallet</div><div class="nw-section-sub" id="nw-sub-cash">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-cash" style="color:#84CC16;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-cash">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-cash">
      <button class="nw-section-add" onclick="openNWSheet('cash')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <!-- ── CUSTOM ASSET TYPES (dynamically injected) ── -->
  <div id="nw-custom-sections-assets"></div>

  <!-- ── LIABILITIES ── -->
  <div class="nw-group-header" style="margin-top:8px;">
    <div class="nw-group-label">📉 Liabilities</div>
    <div class="nw-group-total" id="nw-liab-total" style="color:#EF4444;"></div>
  </div>

  <div class="nw-section" id="nw-sec-credit_card">
    <div class="nw-section-header" onclick="toggleNWSection('credit_card')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF0F0;">💳</div>
        <div><div class="nw-section-name">Credit Cards</div><div class="nw-section-sub" id="nw-sub-credit_card">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-credit_card" style="color:#EF4444;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-credit_card">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-credit_card">
      <button class="nw-section-add" onclick="openNWSheet('credit_card')" style="margin-top:8px;">+ Add Card</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-loan">
    <div class="nw-section-header" onclick="toggleNWSection('loan')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF4EE;">🏠</div>
        <div><div class="nw-section-name">Loans / Mortgage</div><div class="nw-section-sub" id="nw-sub-loan">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-loan" style="color:#F97316;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-loan">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-loan">
      <button class="nw-section-add" onclick="openNWSheet('loan')" style="margin-top:8px;">+ Add Loan</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-other_liability">
    <div class="nw-section-header" onclick="toggleNWSection('other_liability')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F5F0FF;">📉</div>
        <div><div class="nw-section-name">Other Liabilities</div><div class="nw-section-sub" id="nw-sub-other_liability">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-other_liability" style="color:#8B5CF6;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-other_liability">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-other_liability">
      <button class="nw-section-add" onclick="openNWSheet('other_liability')" style="margin-top:8px;">+ Add Liability</button>
    </div>
  </div>

  <!-- ── CUSTOM LIABILITY TYPES (dynamically injected) ── -->
  <div id="nw-custom-sections-liab"></div>

<!-- ══ NW Account Sheet ══ -->
<div class="nw-sheet-overlay" id="nw-sheet-overlay" onclick="closeNWSheet()"></div>
<div class="nw-sheet" id="nw-sheet">
  <div class="nw-sheet-handle"></div>

  <!-- Phase 1: Type picker -->
  <div id="nws-phase-pick">
    <div class="nw-sheet-title">+ Add Account</div>
    <div class="nws-section-label">Account Type</div>
    <div class="nws-type-grid" id="nws-type-grid"></div>
  </div>

  <!-- Phase 2: Form (hidden until type chosen) -->
  <div id="nws-phase-form" style="display:none;">
    <!-- Selected type banner -->
    <div class="nws-selected-banner" id="nws-banner">
      <div class="nws-selected-left">
        <span class="nws-selected-icon" id="nws-banner-icon"></span>
        <span class="nws-selected-name" id="nws-banner-name"></span>
      </div>
      <span class="nws-type-badge" id="nws-banner-badge"></span>
    </div>

    <!-- Dynamic form fields -->
    <div id="nw-sheet-body"></div>

    <!-- Save + Cancel -->
    <button class="nw-sheet-save" onclick="saveNWAccount()" style="background:var(--yellow);border:none;border-radius:14px;padding:16px;width:100%;font-family:Nunito,sans-serif;font-weight:900;font-size:1em;cursor:pointer;margin-top:8px;">
      ✅ Save
    </button>
    <button onclick="closeNWSheet()" style="width:100%;background:none;border:none;font-family:Nunito,sans-serif;font-weight:800;font-size:0.88em;color:var(--text-light);cursor:pointer;padding:12px;margin-top:4px;">
      Cancel
    </button>
  </div>
</div>

</div><!-- /screen-networth -->

<!-- ══════════════ IMPORT HUB ══════════════ -->
<div class="screen" id="screen-import">
  <div style="margin-bottom:8px;">
    <div style="font-size:1.1em;font-weight:900;color:var(--text-dark);">📥 Import Hub</div>
    <div style="font-size:0.78em;color:var(--text-light);font-weight:600;margin-top:2px;">Bring your Excel history into MoneyFlow</div>
  </div>

  <!-- Tabs -->
  <div class="import-tabs">
    <button class="import-tab active" onclick="setImportTab('transactions',this)">💸 Transactions</button>
    <button class="import-tab" onclick="setImportTab('given',this)">🤝 Given to Others</button>
    <button class="import-tab" onclick="setImportTab('metals',this)">🥇 Metals</button>
    <button class="import-tab" onclick="setImportTab('realestate',this)">🏡 Real Estate</button>
    <button class="import-tab" onclick="setImportTab('reset',this)">🗑️ Reset</button>
  </div>

  <!-- ── TRANSACTIONS ── -->
  <div class="import-section active" id="isec-transactions">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="itx-step1">
      <div class="import-card">
        <div class="import-card-title">Step 1 — Upload Your Excel</div>
        <div class="import-card-sub">Supports Expenses, Income, and Investments sheets. Upload one file at a time. Expected columns: Date, Category, Amount, and optionally Description/Store/Month.</div>
        <div class="import-drop-zone" id="itx-dropzone" onclick="document.getElementById('itx-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'transactions')">
          <div class="import-drop-icon">📂</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV — Expenses, Income, or Investments</div>
        </div>
        <input type="file" id="itx-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'transactions')">
        <!-- Type selector -->
        <div style="font-size:0.78em;font-weight:800;color:var(--text-light);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px;">This file contains:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:4px;">
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="expense" checked> 💸 Expenses</label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="income"> 💵 Income</label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="investment"> 📈 Investments</label>
        </div>
      </div>
    </div>

    <!-- Step 2: Map columns -->
    <div class="import-step" id="itx-step2">
      <div class="import-card">
        <div class="import-card-title">Step 2 — Map Columns</div>
        <div class="import-card-sub" id="itx-map-sub">Match your Excel columns to the right fields.</div>
        <div class="import-col-map" id="itx-col-map"></div>
        <!-- Preview -->
        <div style="font-size:0.78em;font-weight:800;color:var(--text-light);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px;">Preview (first 5 rows)</div>
        <div style="overflow-x:auto;"><table class="import-preview-table" id="itx-preview-table"></table></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetImportStep('transactions')">← Back</button>
          <button class="import-btn" onclick="goToImportStep('transactions','step3')">Review Categories →</button>
        </div>
      </div>
    </div>

    <!-- Step 3: Category review -->
    <div class="import-step" id="itx-step3">
      <div class="import-card">
        <div class="import-card-title">Step 3 — Review Categories</div>
        <div class="import-card-sub">We found possible duplicates or inconsistencies. Review each and choose to merge or keep separate.</div>
        <div id="itx-cat-review"></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="import-btn secondary" onclick="goToImportStep('transactions','step2')">← Back</button>
          <button class="import-btn" onclick="goToImportStep('transactions','step4')">Preview Import →</button>
        </div>
      </div>
    </div>

    <!-- Step 4: Final preview + confirm -->
    <div class="import-step" id="itx-step4">
      <div class="import-card">
        <div class="import-card-title">Step 4 — Confirm Import</div>
        <div class="import-summary-grid" id="itx-summary-grid"></div>
        <div style="overflow-x:auto;max-height:300px;overflow-y:auto;"><table class="import-preview-table" id="itx-final-table"></table></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="import-btn secondary" onclick="goToImportStep('transactions','step3')">← Back</button>
          <button class="import-btn" onclick="confirmImport('transactions')" style="background:#10B981;color:white;">✅ Import Now</button>
        </div>
      </div>
    </div>

    <!-- Step 5: Done -->
    <div class="import-step" id="itx-step5">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="itx-done-title">Import Complete!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="itx-done-sub"></div>
        <button class="import-btn" onclick="resetImportStep('transactions')">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── GIVEN TO OTHERS ── -->
  <div class="import-section" id="isec-given">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="igiv-step1">
      <div class="import-card">
        <div class="import-card-title">🤝 Given to Others — Upload</div>
        <div class="import-card-sub">Expected columns: Date, Category (person name), Amount, Description.</div>
        <div class="import-drop-zone" onclick="document.getElementById('igiven-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'given')">
          <div class="import-drop-icon">🤝</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="igiven-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'given')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="igiv-step2">
      <div class="import-card">
        <div class="import-card-title">🤝 Preview & Confirm</div>
        <div id="igiven-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="igiven-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetGivenImport()">← Back</button>
          <button class="import-btn" onclick="confirmGivenImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="igiv-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="igiv-done-title">Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="igiv-done-sub"></div>
        <button class="import-btn" onclick="resetGivenImport()">Import Another File</button>
      </div>
    </div>

    <!-- Ledger view (always visible) -->
    <div class="import-card" id="given-ledger-card">
      <div class="import-card-title">Outstanding Balances</div>
      <div id="given-ledger-list"></div>
    </div>
  </div>

  <!-- ── METALS ── -->
  <div class="import-section" id="isec-metals">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="imet-step1">
      <div class="import-card">
        <div class="import-card-title">🥇 Precious Metals — Upload</div>
        <div class="import-card-sub">Upload your metals file. Expected columns: Metal/Type, Purity, Occasion, Item/Name, Weight (grams or oz), Date.</div>
        <div class="import-drop-zone" onclick="document.getElementById('imetals-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'metals')">
          <div class="import-drop-icon">🥇</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="imetals-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'metals')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="imet-step2">
      <div class="import-card">
        <div class="import-card-title">🥇 Preview & Confirm</div>
        <div id="imetals-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="imetals-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetMetalsImport()">← Back</button>
          <button class="import-btn" onclick="confirmMetalsImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="imet-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="imet-done-title">Metals Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="imet-done-sub"></div>
        <button class="import-btn" onclick="resetMetalsImport()">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── REAL ESTATE ── -->
  <div class="import-section" id="isec-realestate">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="ire-step1">
      <div class="import-card">
        <div class="import-card-title">🏡 Real Estate — Upload</div>
        <div class="import-card-sub">Expected columns: Date, Country, Currency, Purchase Value, Description, Area, Current Value.</div>
        <div class="import-drop-zone" onclick="document.getElementById('ire-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'realestate')">
          <div class="import-drop-icon">🏡</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="ire-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'realestate')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="ire-step2">
      <div class="import-card">
        <div class="import-card-title">🏡 Preview & Confirm</div>
        <div id="ire-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="ire-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetREImport()">← Back</button>
          <button class="import-btn" onclick="confirmREImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="ire-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="ire-done-title">Properties Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="ire-done-sub"></div>
        <button class="import-btn" onclick="resetREImport()">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── RESET ── -->
  <div class="import-section" id="isec-reset">

    <!-- Delete by month -->
    <div class="import-card">
      <div class="import-card-title">📅 Delete Month Data</div>
      <div class="import-card-sub">Remove all transactions for a specific month. Useful for clearing test data or a bad import — without wiping everything.</div>
      <div id="months-list" style="margin-top:4px;"></div>
    </div>

    <!-- What's stored summary -->
    <div class="import-card">
      <div class="import-card-title">📊 What's Currently Stored</div>
      <div id="reset-data-summary"></div>
    </div>

    <!-- Clear individual datasets -->
    <div class="import-card">
      <div class="import-card-title">🧹 Clear Specific Data</div>
      <div class="import-card-sub">Remove only one type of imported data — your transactions stay safe.</div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🥇 Metals Holdings</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-metals-count">—</div>
          </div>
          <button onclick="clearDataset('metals')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🤝 Given to Others</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-given-count">—</div>
          </div>
          <button onclick="clearDataset('given')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🏡 Real Estate Assets</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-re-count">—</div>
          </div>
          <button onclick="clearDataset('realestate')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">💎 Net Worth Accounts</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-nw-count">—</div>
          </div>
          <button onclick="clearDataset('networth')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
      </div>
    </div>

    <!-- Nuclear option -->
    <div class="import-card" style="border:1.5px solid #FFDDDD;">
      <div class="import-card-title" style="color:var(--expenses);">⚠️ Reset All Data</div>
      <div class="import-card-sub">Permanently deletes ALL transactions, investments, metals, real estate, budgets and snapshots. Cannot be undone. Use only to start completely fresh.</div>
      <button class="import-btn danger" onclick="confirmResetAll()">🗑️ Delete Everything & Start Fresh</button>
    </div>

  </div>
</div>

<!-- EDIT BUDGET POPUP (bottom sheet) -->
<div class="edit-budget-popup" id="edit-budget-popup">
  <div class="popup-backdrop" onclick="closeEditBudgetPopup()"></div>
  <div class="edit-budget-sheet">
    <div class="ebp-handle"></div>
    <div class="ebp-title" id="ebp-title">📋 Budget Settings</div>
    <div class="ebp-emoji-row" id="ebp-emoji-row"></div>
    <div class="ebp-field">
      <label>Category Name</label>
      <input type="text" id="ebp-name" placeholder="e.g. Groceries, Pottery Class">
    </div>
    <div class="ebp-field">
      <label>Type</label>
      <select id="ebp-type">
        <option value="expense">💸 Expense Budget</option>
        <option value="savings">💰 Savings Goal</option>
      </select>
    </div>
    <div class="ebp-field">
      <label>Monthly Budget / Goal Amount ($)</label>
      <input type="number" id="ebp-amount" placeholder="0.00" step="0.01" min="0">
    </div>
    <div class="ebp-field" id="ebp-linked-cats-field">
      <label>Linked Transaction Categories (comma-separated)</label>
      <input type="text" id="ebp-linked-cats" placeholder="e.g. FastFood, Restaurants">
    </div>
    <div class="ebp-actions">
      <button class="ebp-save-btn" onclick="saveEditedBudget()">✅ Save</button>
      <button class="ebp-del-btn" id="ebp-del-btn" onclick="deleteEditedBudget()" style="display:none;">🗑️</button>
    </div>
  </div>
</div>

<!-- ══ MODALS ══ -->
<div class="modal-overlay" id="add-account-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Add Account</div>
      <button class="modal-close" onclick="closeModal('add-account-modal')">✕</button>
    </div>
    <div class="add-form">
      <div class="form-row"><span class="form-label">Name</span><input type="text" class="form-input" id="acc-name-input" placeholder="Account name"></div>
      <div class="form-row"><span class="form-label">Type</span><select class="form-select" id="acc-type-input"><option>Debit</option><option>Credit</option><option>Cash</option><option>Investment</option></select></div>
      <div class="form-row" style="border-bottom:none;"><span class="form-label">Balance</span><input type="number" class="form-input" id="acc-balance-input" placeholder="0"></div>
    </div>
    <button onclick="saveAccount()" style="width:100%;background:var(--yellow);border:none;border-radius:var(--radius-sm);padding:16px;font-family:Nunito;font-weight:900;color:var(--text-dark);cursor:pointer;margin-top:8px;">Save Account</button>
  </div>
</div>

<!-- QUICK ADD POPUP (for home screen category icons) -->
<div class="modal-overlay" id="quick-add-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="qa-modal-title">➕ Quick Add</div>
      <button class="modal-close" onclick="closeModal('quick-add-modal')">✕</button>
    </div>
    <!-- Type selector -->
    <div class="qa-type-row" id="qa-type-row">
      <div class="qa-type-chip active" onclick="qaSetType('expense',this)">💸 Expense</div>
      <div class="qa-type-chip" onclick="qaSetType('income',this)">💵 Income</div>
      <div class="qa-type-chip" onclick="qaSetType('investment',this)">📈 Investment</div>
      <div class="qa-type-chip" onclick="qaSetType('debt',this)">📉 Debt</div>
      <div class="qa-type-chip" onclick="qaSetType('given',this)">🤝 Given</div>
      <div class="qa-type-chip" onclick="qaSetType('additional',this)">🎁 Additional</div>
    </div>
    <!-- Amount display -->
    <div class="qa-amount-row">
      <span class="qa-currency-sym">$</span>
      <input type="text" class="qa-amount-input" id="qa-amount-display" value="0" readonly>
    </div>
    <!-- Sub-category pills -->
    <div class="qa-sub-cats" id="qa-sub-cats"></div>
    <!-- Fields -->
    <div class="qa-fields-row">
      <div class="qa-field">
        <label>Date</label>
        <input type="date" id="qa-date-input">
      </div>
      <div class="qa-field">
        <label>Note</label>
        <input type="text" id="qa-note-input" placeholder="Optional note...">
      </div>
    </div>
    <!-- Metal extra fields — only shown when investment category is a metal -->
    <div id="qa-metal-fields" style="display:none;">
      <div style="background:linear-gradient(135deg,#FFF8E1,#FFF3C4);border-radius:14px;padding:12px 14px;margin:0 0 10px;">
        <div style="font-size:0.72em;font-weight:900;color:#A07800;text-transform:uppercase;letter-spacing:0.4px;margin-bottom:10px;">🥇 Metal Purchase Details</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">WEIGHT</div>
            <input type="number" id="qa-metal-grams" placeholder="1.0" step="0.001" min="0"
              style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 10px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
          </div>
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">UNIT</div>
            <select id="qa-metal-unit" style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 6px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
              <option value="g">grams</option>
              <option value="oz">oz</option>
            </select>
          </div>
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">TYPE</div>
            <select id="qa-metal-type" style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 6px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
              <option value="gold">Gold</option>
              <option value="silver">Silver</option>
              <option value="platinum">Platinum</option>
            </select>
          </div>
        </div>
        <div style="font-size:0.68em;color:#A07800;font-weight:700;margin-top:8px;line-height:1.5;">
          💡 Records <strong>this month's purchase</strong> for budget tracking. Your total holdings in Net Worth are separate — update them there when you want a snapshot.
        </div>
      </div>
    </div>
    <!-- Numpad -->
    <div class="qa-numpad" id="qa-numpad"></div>
  </div>
</div>

<!-- ══ INVESTMENT QUICK-ADD MODAL ══ -->
<div class="modal-overlay" id="inv-quick-modal">
  <div class="modal" style="max-height:90vh;overflow-y:auto;">
    <div class="modal-header">
      <div class="modal-title" id="inv-modal-title">📈 Add Investment</div>
      <button class="modal-close" onclick="closeModal('inv-quick-modal')">✕</button>
    </div>
    <!-- Type tabs -->
    <div class="inv-type-tabs" id="inv-type-tabs">
      <button class="inv-type-chip active" style="background:#4A9EFF;color:white;" onclick="setInvModalType('Stocks','Stocks',this,'#4A9EFF')">📊 Stocks</button>
      <button class="inv-type-chip" onclick="setInvModalType('Crypto','Crypto',this,'#F59E0B')">🪙 Crypto</button>
      <button class="inv-type-chip" onclick="setInvModalType('Metals','Metals',this,'#C8900A')">🥇 Metals</button>
      <button class="inv-type-chip" onclick="setInvModalType('Real Estate','Real Estate',this,'#10B981')">🏡 Real Estate</button>
      <button class="inv-type-chip" onclick="setInvModalType('ETF/MF','ETF/MF',this,'#7C3AED')">🗂 ETF / MF</button>
    </div>
    <!-- Dynamic fields -->
    <div id="inv-modal-fields"></div>
    <!-- Auto-computed total -->
    <div class="inv-total-pill" id="inv-total-pill" style="display:none;">
      <span class="inv-total-pill-label" id="inv-total-pill-label">💰 Computed Total Value</span>
      <span class="inv-total-pill-val" id="inv-computed-total">$0</span>
    </div>
    <!-- Date + Currency row -->
    <div class="inv-fields-grid" style="margin-bottom:14px;">
      <div class="inv-field-box">
        <label>📅 Date</label>
        <input type="date" class="inv-field-input" id="inv-modal-date">
      </div>
      <div class="inv-field-box">
        <label>🌍 Currency</label>
        <button onclick="openCurrencyPicker('inv')" class="inv-field-input" style="text-align:left;cursor:pointer;display:flex;align-items:center;gap:6px;" id="inv-curr-btn">
          <span id="inv-curr-flag">🇺🇸</span><span id="inv-curr-label">USD — $</span>
        </button>
      </div>
    </div>
    <!-- Note -->
    <div class="inv-field-box full" style="margin-bottom:16px;">
      <label>📝 Notes</label>
      <input type="text" class="inv-field-input" id="inv-modal-note" placeholder="Optional notes...">
    </div>
    <button class="inv-save-btn" onclick="saveInvEntry()">✅ Save Investment</button>
  </div>
</div>

<!-- ══ CURRENCY PICKER MODAL ══ -->
<div class="modal-overlay" id="currency-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">🌍 Select Currency</div>
      <button class="modal-close" onclick="closeModal('currency-modal')">✕</button>
    </div>
    <input type="text" class="curr-search" id="curr-search-input" placeholder="Search country or currency..." oninput="filterCurrencies(this.value)">
    <div class="curr-list" id="curr-list"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- Sync status bar -->
<div id="sync-status-bar" style="
  display:none;position:fixed;top:0;left:0;right:0;z-index:200;
  padding:4px 16px;font-size:0.72em;font-weight:700;
  text-align:center;transition:all 0.3s;
" id="sync-bar"></div>

<datalist id="catlist"></datalist>

<script>
// MoneyFi — Protected Application Code
// © 2026 MoneyFi. All rights reserved.
(function(){
var _0x=['Ci8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBTVEFURQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKY29uc3QgU1RPUkFHRV9LRVkgPSAnZmluYW5jZURhdGEnOwpsZXQgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVkpKSB8fCB7fTsKLy8gUmVzdG9yZSBjdXN0b20gTlcgdHlwZXMgaW50byBydW50aW1lIE5XX1RZUEVTIG9iamVjdApzZXRUaW1lb3V0KCgpID0+IHsKICAoZGF0YS5fbndDdXN0b21UeXBlcyB8fCBbXSkuZm9yRWFjaChjID0+IHsKICAgIE5XX1RZUEVTW2Mua2V5XSA9IHsgbGFiZWw6IGMubGFiZWwsIGVtb2ppOiBjLmVtb2ppIHx8ICfwn4+mJywgY29sb3I6ICcjNkI3MjgwJywgaXNMaWFiOiBjLmlzTGlhYiB8fCBmYWxzZSB9OwogIH0pOwp9LCAwKTsKbGV0IGN1cnJlbnRBZGRUeXBlID0gJ2V4cGVuc2UnOwpsZXQgY3VycmVudEFtb3VudFN0ciA9ICcnOwpsZXQgc2VsZWN0ZWRTdWJDYXQgPSAnJzsKbGV0IHZpZXdNb250aCA9IGdldEN1cnJlbnRNb250aEtleSgpOwpsZXQgY3VycmVudFBlcmlvZCA9ICdtb250aCc7CmxldCBzZWxlY3RlZERheSA9IG51bGw7CmxldCBjaGFydHMgPSB7fTsKbGV0IGN1cnJlbnRNZXRhbCA9ICdnb2xkJzsKbGV0IGFkZFBhbmVsT3BlbiA9IGZhbHNlOwpsZXQgY3VycmVudEludmVzdEZpbHRlciA9ICdBbGwnOwpsZXQgdHhGaWx0ZXIgPSAnYWxsJzsKbGV0IGRhdGFTb3J0U3RhdGUgPSB7fTsKbGV0IHFhVHlwZSA9ICdleHBlbnNlJzsKbGV0IHFhQW1vdW50U3RyID0gJyc7CmxldCBxYVN1YkNhdCA9ICcnOwpsZXQgcWFQcmVzZWxlY3RUeXBlID0gbnVsbDsKbGV0IHFhUHJlc2VsZWN0U3ViQ2F0ID0gbnVsbDsKbGV0IGN1cnJlbnRUaGVtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtZl90aGVtZScpIHx8ICdkZWZhdWx0JzsKLy8gSG9tZSB0YWIgc3RhdGUKbGV0IGhvbWVUYWIgPSAnc3BlbmRpbmcnOwovLyBJbnZlc3RtZW50IG1vZGFsIHN0YXRlCmxldCBpbnZNb2RhbFR5cGUgPSAnU3RvY2tzJzsKbGV0IGludk1vZGFsVGVtcGxhdGUgPSAnU3RvY2tzJzsKbGV0IGludkN1cnJlbmN5VGFyZ2V0ID0gJ2ludic7IC8vIHdoaWNoIGNvbnRleHQgb3BlbmVkIGN1cnJlbmN5IHBpY2tlcgovLyBDdXJyZW5jeSBzdGF0ZSDigJQgcGVyc2lzdGVkIHNlcGFyYXRlbHkgZm9yIGZhc3QgaW5pdApsZXQgY3VycmVudEN1cnJlbmN5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWZfY3VycmVuY3knKSB8fCAnbnVsbCcpIHx8IHtjb2RlOidVU0QnLHN5bWJvbDonJCcsbmFtZTonVVMgRG9sbGFyJyxmbGFnOifwn4e68J+HuCcsY291bnRyeTonVW5pdGVkIFN0YXRlcyd9OwoKZnVuY3Rpb24gc2F2ZUN1cnJlbmN5KGMpIHsKICBjdXJyZW50Q3VycmVuY3kgPSBjOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtZl9jdXJyZW5jeScsIEpTT04uc3RyaW5naWZ5KGMpKTsKICAvLyBQZXJzaXN0IGN1cnJlbmN5IHByZWZlcmVuY2UgaW4gRmlyZWJhc2UgdG9vCiAgaWYgKHdpbmRvdy5fZmJVc2VyICYmIHdpbmRvdy5fZmJEYikgewogICAgY29uc3QgdWlkID0gd2luZG93Ll9mYlVzZXIudWlkOwogICAgd2luZG93Ll9mYkRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZG9jKHVpZCkKICAgICAgLnNldCh7IGN1cnJlbmN5OiBjIH0sIHsgbWVyZ2U6IHRydWUgfSkKICAgICAgLmNhdGNoKGUgPT4gY29uc29sZS53YXJuKCdDdXJyZW5jeSBzeW5jIGZhaWxlZDonLCBlKSk7CiAgfQp9CmZ1bmN0aW9uIHN5bSgpIHsgcmV0dXJuIGN1cnJlbnRDdXJyZW5jeS5zeW1ib2w7IH0KCi8vIOKUgOKUgCBBcHByb3hpbWF0ZSBGWCByYXRlcyByZWxhdGl2ZSB0byBVU0QgKHVwZGF0ZWQgcGVyaW9kaWNhbGx5IGJ5IHVzZXIgdmlhIFNldHRpbmdzIGlmIG5lZWRlZCkKLy8gVmFsdWVzID0gMSBVU0Qg4oaSIE4gdW5pdHMgb2YgdGhhdCBjdXJyZW5jeQpjb25zdCBGWF9VU0RfQkFTRSA9IHsKICBVU0Q6MSwgRVVSOjAuOTIsIEdCUDowLjc5LCBJTlI6ODMuNSwgQUVEOjMuNjcsIFNBUjozLjc1LAogIENBRDoxLjM2LCBBVUQ6MS41MywgSlBZOjE0OSwgQ05ZOjcuMjQsIFNHRDoxLjM0LCBDSEY6MC44OSwKICBNWVI6NC43MiwgSEtEOjcuODIsIE5aRDoxLjYzLCBLV0Q6MC4zMSwgUUFSOjMuNjQsIE9NUjowLjM4LAogIFBLUjoyNzgsIEJEVDoxMTAsIExLUjozMTAsIE5QUjoxMzMsIE1YTjoxNy4xLCBCUkw6NC45NywKICBaQVI6MTguNiwgTkdOOjE1NTAsIEtFUzoxMjksIEVHUDo0OC41LCBUUlk6MzIuMiwgUlVCOjkxLAogIFNFSzoxMC40LCBOT0s6MTAuNiwgREtLOjYuODgsIElEUjoxNTcwMCwgUEhQOjU1LjgsIFRIQjozNSwKICBWTkQ6MjQ1MDAsIEtSVzoxMzIwLAp9OwoKLy8gQ29udmVydCBhbiBhbW91bnQgZnJvbSBlbnRyeUN1cnJlbmN5IHRvIGRpc3BsYXlDdXJyZW5jeQpmdW5jdGlvbiBjb252ZXJ0QW10KGFtb3VudCwgZW50cnlDdXJyZW5jeUNvZGUpIHsKICBpZighZW50cnlDdXJyZW5jeUNvZGUgfHwgZW50cnlDdXJyZW5jeUNvZGUgPT09IGN1cnJlbnRDdXJyZW5jeS5jb2RlKSByZXR1cm4gTnVtYmVyKGFtb3VudHx8MCk7CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fZnhPdmVycmlkZXMgfHwge307CiAgY29uc3QgZnJvbVJhdGUgPSBvdmVycmlkZXNbZW50cnlDdXJyZW5jeUNvZGVdID8/IEZYX1VTRF9CQVNFW2VudHJ5Q3VycmVuY3lDb2RlXSA/PyAxOyAgIC8vIDEgVVNEIOKGkiBOIGVudHJ5IHVuaXRzCiAgY29uc3QgdG9SYXRlICAgPSBvdmVycmlkZXNbY3VycmVudEN1cnJlbmN5LmNvZGVdID8/IEZYX1VTRF9CQVNFW2N1cnJlbnRDdXJyZW5jeS5jb2RlXSA/PyAxOyAvLyAxIFVTRCDihpIgTiBkaXNwbGF5IHVuaXRzCiAgLy8gYW1vdW50IC8gZnJvbVJhdGUgPSBVU0QgdmFsdWUg4oaSICogdG9SYXRlID0gZGlzcGxheSB2YWx1ZQogIHJldHVybiAoTnVtYmVyKGFtb3VudHx8MCkgLyBmcm9tUmF0ZSkgKiB0b1JhdGU7Cn0KCi8vIFdyYXBwZXI6IGZvcm1hdCBhbiBhbW91bnQgcmVzcGVjdGluZyBpdHMgc3RvcmVkIGN1cnJlbmN5CmZ1bmN0aW9uIGZtdENvbnZlcnRlZChhbW91bnQsIGVudHJ5Q3VycmVuY3lDb2RlKSB7CiAgcmV0dXJuIHN5bSgpICsgTWF0aC5hYnMoY29udmVydEFtdChhbW91bnQsIGVudHJ5Q3VycmVuY3lDb2RlKSkudG9Mb2NhbGVTdHJpbmcodW5kZWZpbmVkLHttaW5pbXVtRnJhY3Rpb25EaWdpdHM6MCxtYXhpbXVtRnJhY3Rpb25EaWdpdHM6MH0pOwp9CmZ1bmN0aW9uIGZtdENvbnZlcnRlZEZ1bGwoYW1vdW50LCBlbnRyeUN1cnJlbmN5Q29kZSkgewogIHJldHVybiBzeW0oKSArIE1hdGguYWJzKGNvbnZlcnRBbXQoYW1vdW50LCBlbnRyeUN1cnJlbmN5Q29kZSkpLnRvTG9jYWxlU3RyaW5nKHVuZGVmaW5lZCx7bWluaW11bUZyYWN0aW9uRGlnaXRzOjIsbWF4aW11bUZyYWN0aW9uRGlnaXRzOjJ9KTsKfQoKY29uc3QgY29tbW9uQ2F0ZWdvcmllcyA9IFsKICAnS1AtUEMxJywnS1AtUEMyJywnU0stUEMxJywnU0stUEMyJywnU0stUEMzJywnUEtELVNIT1BTJywKICAnR3JvY2VyaWVzJywnRmFzdEZvb2QnLCdHYXMnLCdVdGlsaXR5JywnVC1Nb2JpbGUnLCdJbnN1cmFuY2UnLAogICdPbmVHb2xkJywnT25lU2lsdmVyJywnRmlkZWxpdHknLCdSb2Jpbmhvb2QnLCdXZWJ1bGwnLCdNRicsCiAgJ1BhcmVudHMnLCdIZWFsdGggQ2FyZScsJ0VudGVydGFpbm1lbnQnLCdBdXRvJywnR2lmdHMnLCdSZXR1cm4nLCdSZWZ1bmQnLCdDcmVkaXQnCl07CmNvbnN0IGNhdExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2F0bGlzdCcpOwpjb21tb25DYXRlZ29yaWVzLmZvckVhY2goYyA9PiB7IGNvbnN0IG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsgby52YWx1ZSA9IGM7IGNhdExpc3QuYXBwZW5kQ2hpbGQobyk7IH0pOwoKLy8gU3BlbmRpbmcgY2F0ZWdvcmllcyBvbiBob21lIChubyBEZWJ0LCBubyBJbnZlc3RtZW50KQpjb25zdCBERUZBVUxUX1NQRU5EX0NBUkRTID0gWwogIHsga2V5Oidmb29kJywgICAgICAgbGFiZWw6J0Zvb2QgJiBEcmluaycsICAgIGljb246J/CfjZQnLCBjb2xvcjonI0ZGNkIzNScsIGNsczonZm9vZCcsICAgICAgIHN1YmNhdHM6WydCcmVha2Zhc3QnLCdMdW5jaCcsJ0Rpbm5lcicsJ1NuYWNrcycsJ0NvZmZlZScsJ0dyb2NlcmllcycsJ0Zhc3RGb29kJ10gfSwKICB7IGtleTondHJhbnNwb3J0JywgIGxhYmVsOidUcmFuc3BvcnRhdGlvbicsICBpY29uOifwn5qMJywgY29sb3I6JyM0QTlFRkYnLCBjbHM6J3RyYW5zcG9ydCcsICBzdWJjYXRzOlsnVHJhbnNwb3J0JywnVWJlcicsJ0dhcycsJ0F1dG8nXSB9LAogIHsga2V5Oidob3VzaW5nJywgICAgbGFiZWw6J0hvdXNpbmcnLCAgICAgICAgIGljb246J/Cfj6AnLCBjb2xvcjonI0ZGOEM0MicsIGNsczonaG91c2luZycsICAgIHN1YmNhdHM6WydFbGVjdHJpYycsJ0ludGVybmV0JywnVXRpbGl0eScsJ1JlbnQnLCdNb3J0Z2FnZSddIH0sCiAgeyBrZXk6J2hlYWx0aCcsICAgICBsYWJlbDonSGVhbHRoJywgICAgICAgICAgaWNvbjon8J+SiicsIGNvbG9yOicjNEVDREM0JywgY2xzOidoZWFsdGgnLCAgICAgc3ViY2F0czpbJ0hlYWx0aCcsJ0RlbnRhbCcsJ01lZGljaW5lJywnRG9jdG9yJ10gfSwKICB7IGtleTonc2hvcHBpbmcnLCAgIGxhYmVsOidTaG9wcGluZycsICAgICAgICBpY29uOifwn5uN77iPJywgY29sb3I6JyNGRjQ3NTcnLCBjbHM6J3Nob3BwaW5nJywgICBzdWJjYXRzOlsnU2hvcHBpbmcnLCdDbG90aGluZycsJ0Nvc21ldGljcycsJ0VsZWN0cm9uaWNzJ10gfSwKICB7IGtleTonZ3JvY2VyaWVzJywgIGxhYmVsOidHcm9jZXJpZXMnLCAgICAgICBpY29uOifwn5uSJywgY29sb3I6JyMxMEI5ODEnLCBjbHM6J2ludmVzdCcsICAgICBzdWJjYXRzOlsnR3JvY2VyaWVzJywnU3VwZXJtYXJrZXQnLCdWZWdldGFibGVzJywnRnJ1aXRzJ10gfSwKICB7IGtleTonZ2l2aW5nJywgICAgIGxhYmVsOidHaXZpbmcnLCAgICAgICAgICBpY29uOifinaTvuI8nLCBjb2xvcjonI0ZGNkI5RCcsIGNsczonZ2l2aW5nJywgICAgIHN1YmNhdHM6WydQYXJlbnRzJywnRmFtaWx5JywnRnJpZW5kJywnQ2hhcml0eSddIH0sCiAgeyBrZXk6J290aGVyJywgICAgICBsYWJlbDonQWRkaXRpb25hbCcsICAgICAgaWNvbjon8J+OgScsIGNvbG9yOicjNjRCNUY2JywgY2xzOidvdGhlci1jYXQnLCAgc3ViY2F0czpbJ0VudGVydGFpbm1lbnQnLCdUcmF2ZWwnLCdJbnN1cmFuY2UnLCdPdGhlciddIH0sCl07CgpmdW5jdGlvbiBnZXRIb21lU3BlbmRDYXJkcygpIHsKICBpZighZGF0YS5faG9tZVNwZW5kQ2FyZHMpIHJldHVybiBERUZBVUxUX1NQRU5EX0NBUkRTLm1hcChjPT4oey4uLmMsdmlzaWJsZTp0cnVlfSkpOwogIHJldHVybiBkYXRhLl9ob21lU3BlbmRDYXJkczsKfQpmdW5jdGlvbiBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpIHsgZGF0YS5faG9tZVNwZW5kQ2FyZHM9Y2FyZHM7IHNhdmUoKTsgfQoKLy8gTWFpbnRhaW4gYmFja3dhcmRzLWNvbXBhdGlibGUgc3BlbmRDYXRDb25maWcKY29uc3Qgc3BlbmRDYXRDb25maWcgPSBERUZBVUxUX1NQRU5EX0NBUkRTOwpjb25zdCBjYXRDb25maWcgPSBbCiAgLi4uREVGQVVMVF9TUEVORF9DQVJEUywKICB7IGtleTonaW52ZXN0JywgbGFiZWw6J0ludmVzdG1lbnQnLCBpY29uOifwn5OIJywgY2xzOidpbnZlc3QnLCBjb2xvcjonIzdCREE4RicgfSwKICB7IGtleTonZGVidCcsICAgbGFiZWw6J0RlYnQnLCAgICAgICBpY29uOifwn5OJJywgY2xzOidkZWJ0LWNhdCcs','IGNvbG9yOicjOEI1Q0Y2JyB9LApdOwoKY29uc3QgREVGQVVMVF9DQVRTID0gewogIGV4cGVuc2U6ICAgIFsnQnJlYWtmYXN0JywnTHVuY2gnLCdEaW5uZXInLCdTbmFja3MnLCdDb2ZmZWUnLCdHcm9jZXJpZXMnLCdGYXN0Rm9vZCcsJ1RyYW5zcG9ydCcsJ1ViZXInLCdHYXMnLCdIZWFsdGgnLCdEZW50YWwnLCdTaG9wcGluZycsJ0Nsb3RoaW5nJywnQ29zbWV0aWNzJywnRWxlY3RyaWMnLCdVdGlsaXR5JywnUGhvbmUnLCdJbnRlcm5ldCddLAogIGluY29tZTogICAgIFsnU2FsYXJ5JywnRnJlZWxhbmNlJywnQm9udXMnLCdJbnRlcmVzdCcsJ0RpdmlkZW5kJywnR2lmdCcsJ1JldHVybicsJ1JlZnVuZCcsJ090aGVyJ10sCiAgaW52ZXN0bWVudDogWydTdG9ja3MnLCdFVEYnLCdDcnlwdG8nLCdHb2xkJywnU2lsdmVyJywnUmVhbCBFc3RhdGUnLCc0MDFrJywnSVJBJywnTXV0dWFsIEZ1bmQnLCdPdGhlciddLAogIGRlYnQ6ICAgICAgIFsnQ3JlZGl0IENhcmQnLCdMb2FuJywnTW9ydGdhZ2UnLCdNZWRpY2FsJywnT3RoZXInXSwKICBnaXZlbjogICAgICBbJ1BhcmVudHMnLCdGYW1pbHknLCdGcmllbmQnLCdDaGFyaXR5JywnT3RoZXInXSwKICBhZGRpdGlvbmFsOiBbJ0VudGVydGFpbm1lbnQnLCdUcmF2ZWwnLCdBdXRvJywnSW5zdXJhbmNlJywnU3Vic2NyaXB0aW9uJywnT3RoZXInXQp9OwoKZnVuY3Rpb24gZ2V0Q3VzdG9tQ2F0cygpIHsKICBpZiAoIWRhdGEuX2N1c3RvbUNhdHMpIGRhdGEuX2N1c3RvbUNhdHMgPSB7fTsKICByZXR1cm4gZGF0YS5fY3VzdG9tQ2F0czsKfQoKZnVuY3Rpb24gZ2V0Q2F0c0ZvclR5cGUodHlwZSkgewogIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogIC8vIElmIHVzZXIgaGFzIGV2ZXIgY3VzdG9taXplZCB0aGlzIHR5cGUsIHVzZSB0aGVpciBsaXN0OyBvdGhlcndpc2UgZGVmYXVsdHMKICByZXR1cm4gKGNjW3R5cGVdICYmIGNjW3R5cGVdLmxlbmd0aCA+IDApID8gY2NbdHlwZV0gOiAoREVGQVVMVF9DQVRTW3R5cGVdIHx8IFtdKTsKfQoKY29uc3Qgc3ViQ2F0c0J5VHlwZSA9IG5ldyBQcm94eSh7fSwgewogIGdldChfLCB0eXBlKSB7IHJldHVybiBnZXRDYXRzRm9yVHlwZSh0eXBlKTsgfQp9KTsKCi8vIOKUgOKUgCBDYXRlZ29yeSBNYW5hZ2VyIHN0YXRlCmxldCBjYXRNZ3JUeXBlID0gJ2V4cGVuc2UnOwoKZnVuY3Rpb24gc2hvd0NhdE1nclRhYih0eXBlLCBidG4pIHsKICBjYXRNZ3JUeXBlID0gdHlwZTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2F0LW1nci10YWInKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHJlbmRlckNhdFBpbGxzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNhdFBpbGxzKCkgewogIGNvbnN0IGNhdHMgPSBnZXRDYXRzRm9yVHlwZShjYXRNZ3JUeXBlKTsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdC1waWxscy13cmFwJyk7CiAgaWYgKCF3cmFwKSByZXR1cm47CiAgd3JhcC5pbm5lckhUTUwgPSBjYXRzLm1hcCgoYywgaSkgPT4gYAogICAgPGRpdiBjbGFzcz0iY2F0LXBpbGwiPgogICAgICA8c3Bhbj4ke2N9PC9zcGFuPgogICAgICA8YnV0dG9uIGNsYXNzPSJjYXQtcGlsbC1kZWwiIG9uY2xpY2s9InJlbW92ZUN1c3RvbUNhdCgke2l9KSIgdGl0bGU9IlJlbW92ZSI+4pyVPC9idXR0b24+CiAgICA8L2Rpdj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gYWRkQ3VzdG9tQ2F0KCkgewogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdC1hZGQtaW5wdXQnKTsKICBjb25zdCBuYW1lID0gKGlucHV0LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgaWYgKCFuYW1lKSB7IHNob3dUb2FzdCgnRW50ZXIgYSBjYXRlZ29yeSBuYW1lIOKdjCcpOyByZXR1cm47IH0KICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICAvLyBJbml0aWFsaXplIGZyb20gZGVmYXVsdHMgaWYgbm90IHlldCBjdXN0b21pemVkCiAgaWYgKCFjY1tjYXRNZ3JUeXBlXSkgY2NbY2F0TWdyVHlwZV0gPSBbLi4uKERFRkFVTFRfQ0FUU1tjYXRNZ3JUeXBlXSB8fCBbXSldOwogIGlmIChjY1tjYXRNZ3JUeXBlXS5pbmNsdWRlcyhuYW1lKSkgeyBzaG93VG9hc3QoJ0NhdGVnb3J5IGFscmVhZHkgZXhpc3RzIOKaoO+4jycpOyByZXR1cm47IH0KICBjY1tjYXRNZ3JUeXBlXS5wdXNoKG5hbWUpOwogIHNhdmUoKTsKICBpbnB1dC52YWx1ZSA9ICcnOwogIHJlbmRlckNhdFBpbGxzKCk7CiAgc2hvd1RvYXN0KCfinIUgQ2F0ZWdvcnkgYWRkZWQhJyk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUN1c3RvbUNhdChpZHgpIHsKICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICBpZiAoIWNjW2NhdE1nclR5cGVdKSBjY1tjYXRNZ3JUeXBlXSA9IFsuLi4oREVGQVVMVF9DQVRTW2NhdE1nclR5cGVdIHx8IFtdKV07CiAgY29uc3QgY2F0ID0gY2NbY2F0TWdyVHlwZV1baWR4XTsKICBpZiAoIWNvbmZpcm0oYFJlbW92ZSAiJHtjYXR9IiBmcm9tICR7Y2F0TWdyVHlwZX0gY2F0ZWdvcmllcz9gKSkgcmV0dXJuOwogIGNjW2NhdE1nclR5cGVdLnNwbGljZShpZHgsIDEpOwogIHNhdmUoKTsKICByZW5kZXJDYXRQaWxscygpOwogIHNob3dUb2FzdCgnQ2F0ZWdvcnkgcmVtb3ZlZCcpOwp9CgovLyBQdXJpdHkgbXVsdGlwbGllcnMgKGZyYWN0aW9uIG9mIHB1cmUgbWV0YWwpCmNvbnN0IFBVUklUWV9NVUxUID0gewogIC8vIEdvbGQgKEthcmF0KQogICcyNEsnOiAxLjAsICcyM0snOiAwLjk1ODMsICcyMksnOiAwLjkxNjcsICcyMUsnOiAwLjg3NSwgJzE4Syc6IDAuNzUsCiAgJzE0Syc6IDAuNTgzMywgJzEwSyc6IDAuNDE2NywgJzlLJzogMC4zNzUsCiAgLy8gRmluZSAvIG1pbGxlc2ltYWwgKGdvbGQsIHNpbHZlciwgcGxhdGludW0gYWxsIHVzZSB0aGVzZSkKICAnOTk5JzogMS4wLCAnOTk5IEZJTkUnOiAxLjAsICc5OTkgRmluZSc6IDEuMCwKICAnOTk1JzogMC45OTUsICc5OTAnOiAwLjk5LCAnOTc1JzogMC45NzUsCiAgJzk1MCc6IDAuOTUsICc5MjUnOiAwLjkyNSwgJzkwMCc6IDAuOSwgJzg1MCc6IDAuODUsICc4MDAnOiAwLjgsCiAgLy8gU2lsdmVyLXNwZWNpZmljIGFsaWFzZXMKICAnOTk5IFNpbHZlcic6IDEuMCwgJzkyNSBTaWx2ZXInOiAwLjkyNSwgJ1N0ZXJsaW5nJzogMC45MjUsCiAgLy8gUGxhdGludW0tc3BlY2lmaWMgYWxpYXNlcwogICdQdDk5OSc6IDEuMCwgJ1B0OTUwJzogMC45NSwgJ1B0OTAwJzogMC45LCAnUHQ4NTAnOiAwLjg1LAogICc5NTAgUHQnOiAwLjk1LCAnOTAwIFB0JzogMC45LAp9OwoKLy8gTm9ybWFsaXplIHB1cml0eSBzdHJpbmcgc28gIjIyayIgbWF0Y2hlcyAiMjJLIiwgIlBUOTUwIiBtYXRjaGVzICJQdDk1MCIsIGV0Yy4KZnVuY3Rpb24gbm9ybWFsaXplUHVyaXR5KHB1cml0eSkgewogIGlmICghcHVyaXR5KSByZXR1cm4gJyc7CiAgY29uc3QgcyA9IFN0cmluZyhwdXJpdHkpLnRyaW0oKTsKICAvLyBLYXJhdDogMjJrIOKGkiAyMksKICBjb25zdCBrTWF0Y2ggPSBzLm1hdGNoKC9eKFxkKylccypba0tdJC8pOwogIGlmIChrTWF0Y2gpIHJldHVybiBrTWF0Y2hbMV0gKyAnSyc7CiAgLy8gUHQgcHJlZml4OiBQVDk1MCwgcHQ5NTAsIFB0OTUwIOKGkiBQdDk1MAogIGNvbnN0IHB0TWF0Y2ggPSBzLm1hdGNoKC9eW1BwXVtUdF1ccyooXGQrKSQvKTsKICBpZiAocHRNYXRjaCkgcmV0dXJuICdQdCcgKyBwdE1hdGNoWzFdOwogIC8vICI5NTAgUFQiIOKGkiAiOTUwIFB0IgogIGNvbnN0IHB0U3VmZml4ID0gcy5tYXRjaCgvXihcZCspXHMqW1BwXVtUdF0kLyk7CiAgaWYgKHB0U3VmZml4KSByZXR1cm4gcHRTdWZmaXhbMV0gKyAnIFB0JzsKICAvLyBOdW1lcmljIG9ubHk6IDk1MCDihpIgJzk1MCcKICBjb25zdCBudW1NYXRjaCA9IHMubWF0Y2goL14oXGQrKSQvKTsKICBpZiAobnVtTWF0Y2gpIHJldHVybiBudW1NYXRjaFsxXTsKICAvLyBUcnkgdXBwZXJjYXNlL3RpdGxlLWNhc2UgbWF0Y2gKICByZXR1cm4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7Cn0KCmZ1bmN0aW9uIGdldFB1cml0eU11bHQocHVyaXR5KSB7CiAgaWYgKCFwdXJpdHkpIHJldHVybiAxLjA7CiAgY29uc3Qgbm9ybSA9IG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpOwogIC8vIERpcmVjdCBtYXRjaAogIGlmIChQVVJJVFlfTVVMVFtub3JtXSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gUFVSSVRZX01VTFRbbm9ybV07CiAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBmYWxsYmFjawogIGNvbnN0IHVwcGVyID0gbm9ybS50b1VwcGVyQ2FzZSgpOwogIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyhQVVJJVFlfTVVMVCkpIHsKICAgIGlmIChrLnRvVXBwZXJDYXNlKCkgPT09IHVwcGVyKSByZXR1cm4gUFVSSVRZX01VTFRba107CiAgfQogIHJldHVybiBudWxsOyAvLyB1bmtub3duIHB1cml0eQp9CgpmdW5jdGlvbiBnZXRQcmljZUZvck1ldGFsKG1ldGFsVHlwZSwgcHVyaXR5KSB7CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlcyB8fCB7fTsKICBjb25zdCBiYXNlS2V5ID0gbWV0YWxUeXBlOwogIC8vIENoZWNrIGZvciBhIHB1cml0eS1zcGVjaWZpYyBvdmVycmlkZSBmaXJzdAogIGNvbnN0IHB1cml0eUtleSA9IHB1cml0eSA/IChtZXRhbFR5cGUgKyAnfCcgKyBub3JtYWxpemVQdXJpdHkocHVyaXR5KSkgOiBudWxsOwogIGlmIChwdXJpdHlLZXkgJiYgb3ZlcnJpZGVzW3B1cml0eUtleV0gIT09IHVuZGVmaW5lZCkgcmV0dXJuIG92ZXJyaWRlc1twdXJpdHlLZXldOwogIC8vIEZhbGwgYmFjayB0byBiYXNlICgyNEsgLyBGaW5lKSBwcmljZSBmb3IgdGhpcyBtZXRhbAogIGNvbnN0IGJhc2UgPSBvdmVycmlkZXNbYmFzZUtleV0gIT09IHVuZGVmaW5lZCA/IG92ZXJyaWRlc1tiYXNlS2V5XSA6IChNRVRBTF9DT05GSUdbbWV0YWxUeXBlXT8ucHJpY2VQZXJHcmFtIHx8IDApOwogIGlmICghcHVyaXR5KSByZXR1cm4gYmFzZTsKICBjb25zdCBtdWx0ID0gZ2V0UHVyaXR5TXVsdChwdXJpdHkpOwogIHJldHVybiBtdWx0ICE9PSBudWxsID8gYmFzZSAqIG11bHQgOiBiYXNlOyAvLyB1bmtub3duIHB1cml0eSDihpIgdXNlIGJhc2UgKGZpbmUpIHByaWNlCn0KCmNvbnN0IE1FVEFMX0NPTkZJRyA9IHsKICBnb2xkOiAgICAgeyBsYWJlbDonR29sZCcsICAgICBlbW9qaTon8J+lhycsIHByaWNlUGVyR3JhbTogOTYuNTAsICBoaW50OicyNEsgcHVyZSBnb2xkIOKJiCAkOTYuNTAvZy4gMjJLIOKJiCAkODguNDIvZywgMThLIOKJiCAkNzIuMzgvZy4gVXNlIOKcj++4jyBFZGl0IHRvIHNldCBsaXZlIHByaWNlLicgfSwKICBzaWx2ZXI6ICAgeyBsYWJlbDonU2lsdmVyJywgICBlbW9qaTon8J+liCcsIHByaWNlUGVyR3JhbTogMS4wMywgICBoaW50Oic5OTkgRmluZSBzaWx2ZXIg4omIICQxLjAzL2cuIDkyNSBTdGVybGluZyDiiYggJDAuOTUvZywgOTAwIENvaW4g4omIICQwLjkzL2cuJyB9LAogIHBsYXRpbnVtOiB7IGxhYmVsOidQbGF0aW51bScsIGVtb2ppOifwn5S3JywgcHJpY2VQZXJHcmFtOiAzMC41MCwgIGhpbnQ6J1B0OTk5IOKJiCAkMzAuNTAvZy4gUHQ5NTAg4omIICQyOC45OC9nLiBVc2Ug4pyP77iPIEVkaXQgdG8gc2V0IGN1cnJlbnQgcHJpY2Ug4oCUIHBlci1wdXJpdHkgb3ZlcnJpZGVzIHN1cHBvcnRlZC4nIH0sCn07CgpmdW5jdGlvbiB1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUobWV0YWxUeXBlLCBwcmljZSwgcHVyaXR5KSB7CiAgaWYgKCFkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzKSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzID0ge307CiAgY29uc3Qga2V5ID0gcHVyaXR5ID8gKG1ldGFsVHlwZSArICd8JyArIG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpKSA6IG1ldGFsVHlwZTsKICBjb25zdCBwID0gcGFyc2VGbG9hdChwcmljZSk7CiAgaWYgKCFwIHx8IHAgPD0gMCkgeyBkZWxldGUgZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc1trZXldOyB9CiAgZWxzZSB7IGRhdGEuX21ldGFsUHJpY2VPdmVycmlkZXNba2V5XSA9IHA7IH0KICBzYXZlKCk7CiAgcmVuZGVyTWV0','YWxzKCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICByZW5kZXJQdXJpdHlQcmljZXMobWV0YWxUeXBlKTsKICBzaG93VG9hc3QoJ+KchSBQcmljZSB1cGRhdGVkIOKAlCBOZXQgV29ydGggcmVjYWxjdWxhdGVkIScpOwp9CgpmdW5jdGlvbiByZXNldE1ldGFsUHJpY2VPdmVycmlkZShtZXRhbFR5cGUsIHB1cml0eSkgewogIGlmICghZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlcykgcmV0dXJuOwogIGlmIChwdXJpdHkpIHsKICAgIGRlbGV0ZSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzW21ldGFsVHlwZSArICd8JyArIG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpXTsKICB9IGVsc2UgewogICAgLy8gUmVzZXQgYmFzZSBBTkQgYWxsIHB1cml0eSBvdmVycmlkZXMgZm9yIHRoaXMgbWV0YWwKICAgIGNvbnN0IHByZWZpeCA9IG1ldGFsVHlwZSArICd8JzsKICAgIE9iamVjdC5rZXlzKGRhdGEuX21ldGFsUHJpY2VPdmVycmlkZXMpLmZvckVhY2goayA9PiB7CiAgICAgIGlmIChrID09PSBtZXRhbFR5cGUgfHwgay5zdGFydHNXaXRoKHByZWZpeCkpIGRlbGV0ZSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzW2tdOwogICAgfSk7CiAgfQogIHNhdmUoKTsgcmVuZGVyTWV0YWxzKCk7IHJlbmRlck5ldFdvcnRoKCk7CiAgcmVuZGVyUHVyaXR5UHJpY2VzKG1ldGFsVHlwZSk7CiAgc2hvd1RvYXN0KCdQcmljZSByZXNldCB0byBkZWZhdWx0Jyk7Cn0KCmZ1bmN0aW9uIGdldE1ldGFsQmFzZVByaWNlKG1ldGFsVHlwZSkgewogIHJldHVybiAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW21ldGFsVHlwZV0gIT09IHVuZGVmaW5lZAogICAgPyAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW21ldGFsVHlwZV0KICAgIDogKE1FVEFMX0NPTkZJR1ttZXRhbFR5cGVdPy5wcmljZVBlckdyYW0gfHwgMCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBIRUxQRVJTCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBnZXRDdXJyZW50TW9udGhLZXkoKSB7IGNvbnN0IG49bmV3IERhdGUoKTsgcmV0dXJuIGAke24uZ2V0RnVsbFllYXIoKX0tJHsobi5nZXRNb250aCgpKzEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpfWA7IH0KZnVuY3Rpb24gZ2V0TW9udGhLZXkoZGF0ZVN0cikgeyBpZighZGF0ZVN0cikgcmV0dXJuIG51bGw7IGNvbnN0IGR0PW5ldyBEYXRlKGRhdGVTdHIpOyBpZihpc05hTihkdC5nZXRUaW1lKCkpKSByZXR1cm4gbnVsbDsgcmV0dXJuIGAke2R0LmdldEZ1bGxZZWFyKCl9LSR7U3RyaW5nKGR0LmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7IH0KZnVuY3Rpb24gZ2V0RGlzcGxheU1vbnRoKGtleSkgeyBpZigha2V5KSByZXR1cm4gJyc7IGNvbnN0W3ksbV09a2V5LnNwbGl0KCctJyk7IHJldHVybiBbJ0phbicsJ0ZlYicsJ01hcicsJ0FwcicsJ01heScsJ0p1bicsJ0p1bCcsJ0F1ZycsJ1NlcCcsJ09jdCcsJ05vdicsJ0RlYyddW3BhcnNlSW50KG0pLTFdKycgJyt5OyB9CmZ1bmN0aW9uIGdldEZ1bGxEaXNwbGF5TW9udGgoa2V5KSB7IGlmKCFrZXkpIHJldHVybiAnJzsgY29uc3RbeSxtXT1rZXkuc3BsaXQoJy0nKTsgcmV0dXJuIFsnSmFudWFyeScsJ0ZlYnJ1YXJ5JywnTWFyY2gnLCdBcHJpbCcsJ01heScsJ0p1bmUnLCdKdWx5JywnQXVndXN0JywnU2VwdGVtYmVyJywnT2N0b2JlcicsJ05vdmVtYmVyJywnRGVjZW1iZXInXVtwYXJzZUludChtKS0xXSsnICcreTsgfQpmdW5jdGlvbiBub3JtYWxpemVEYXRlKHJhdykgeyBpZighcmF3KSByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07IGxldCBzdHI9U3RyaW5nKHJhdykudHJpbSgpOyBpZih0eXBlb2YgcmF3PT09J251bWJlcicmJnJhdz4zMDAwMCl7Y29uc3QgZD1NYXRoLmZsb29yKHJhdy0yNTU2OSk7cmV0dXJuIG5ldyBEYXRlKGQqODY0MDAqMTAwMCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO30gaWYoL15cZHs0fS1cZHsyfS1cZHsyfSQvLnRlc3Qoc3RyKSkgcmV0dXJuIHN0cjsgY29uc3QgZHQ9bmV3IERhdGUoc3RyKTsgaWYoIWlzTmFOKGR0LmdldFRpbWUoKSkpIHJldHVybiBkdC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07IHJldHVybiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsgfQpmdW5jdGlvbiBlbnN1cmVNb250aChrZXkpIHsgaWYoIWRhdGFba2V5XSkgZGF0YVtrZXldPXtpbmNvbWU6W10sZXhwZW5zZXM6W10saW52ZXN0bWVudHM6W10sYWRkaXRpb25hbDpbXSxyZWFsRXN0YXRlOltdLG1ldGFsczpbXSxnaXZlblRvT3RoZXJzOltdLGRlYnRzOltdfTsgfQpmdW5jdGlvbiBzYXZlKCkgewogIC8vIEFsd2F5cyBrZWVwIGxvY2FsU3RvcmFnZSBhcyBvZmZsaW5lIGJhY2t1cAogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgLy8gU3luYyB0byBGaXJlYmFzZSBpZiBsb2dnZWQgaW4KICBmaXJlYmFzZVNhdmUoKTsKfQpmdW5jdGlvbiBmbXQobikgeyByZXR1cm4gc3ltKCkrTWF0aC5hYnMoTnVtYmVyKG4pKS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQse21pbmltdW1GcmFjdGlvbkRpZ2l0czowLG1heGltdW1GcmFjdGlvbkRpZ2l0czowfSk7IH0KZnVuY3Rpb24gZm10RnVsbChuKSB7IHJldHVybiBzeW0oKStNYXRoLmFicyhOdW1iZXIobikpLnRvTG9jYWxlU3RyaW5nKHVuZGVmaW5lZCx7bWluaW11bUZyYWN0aW9uRGlnaXRzOjIsbWF4aW11bUZyYWN0aW9uRGlnaXRzOjJ9KTsgfQpmdW5jdGlvbiBnZXRDdXJyZW5jeVN5bWJvbChjdXJyZW5jeT0nVVNEJykgeyByZXR1cm4geydVU0QnOickJywnSU5SJzon4oK5JywnRVVSJzon4oKsJywnR0JQJzonwqMnLCdBRUQnOifYry7YpScsJ0NBRCc6J0MkJywnQVVEJzonQSQnfVsoY3VycmVuY3l8fCdVU0QnKS50b1VwcGVyQ2FzZSgpXXx8KGN1cnJlbmN5fHwnVVNEJykrJyAnOyB9CmZ1bmN0aW9uIGdldENvbXBhY3ROdW0obnVtKSB7IGlmKCFudW0pcmV0dXJuJzAnOyBpZihudW0+PTEwMDAwMDAwKXJldHVybihudW0vMTAwMDAwMDApLnRvRml4ZWQoMikrJ0NyJzsgaWYobnVtPj0xMDAwMDApcmV0dXJuKG51bS8xMDAwMDApLnRvRml4ZWQoMikrJ0wnOyBpZihudW0+PTEwMDApcmV0dXJuKG51bS8xMDAwKS50b0ZpeGVkKDEpKydrJzsgcmV0dXJuIG51bS50b0xvY2FsZVN0cmluZygpOyB9CmZ1bmN0aW9uIHNob3dUb2FzdChtc2csIGR1cj0yNTAwKSB7IGNvbnN0IHQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0Jyk7IHQudGV4dENvbnRlbnQ9bXNnOyB0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsgc2V0VGltZW91dCgoKT0+dC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JyksZHVyKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFRIRU1FIFNZU1RFTQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gc2V0VGhlbWUodGhlbWUpIHsKICAvLyBSZW1vdmUgYWxsIHRoZW1lIGNsYXNzZXMKICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3RoZW1lLWxvb25leScsJ3RoZW1lLWp1bmdsZScsJ3RoZW1lLXNwYWNlJywndGhlbWUtb2NlYW4nKTsKICBpZih0aGVtZSAhPT0gJ2RlZmF1bHQnKSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3RoZW1lLScrdGhlbWUpOwogIGN1cnJlbnRUaGVtZSA9IHRoZW1lOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtZl90aGVtZScsIHRoZW1lKTsKICAvLyBVcGRhdGUgYWN0aXZlIGJhZGdlIGluIHNldHRpbmdzCiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRoZW1lLWNhcmQnKS5mb3JFYWNoKGMgPT4gYy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUtdGhlbWUnKSk7CiAgY29uc3QgdGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWUtJyt0aGVtZSk7CiAgaWYodGMpIHRjLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS10aGVtZScpOwogIHNob3dUb2FzdCgn8J+OqCBUaGVtZSBhcHBsaWVkIScpOwp9CgpmdW5jdGlvbiBhcHBseVN0b3JlZFRoZW1lKCkgewogIGNvbnN0IHQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWZfdGhlbWUnKSB8fCAnZGVmYXVsdCc7CiAgc2V0VGhlbWUodCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBUSU1FIFBFUklPRCBOQVZJR0FUSU9OCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBzZXRQZXJpb2QocGVyaW9kLCBidG4pIHsKICBjdXJyZW50UGVyaW9kID0gcGVyaW9kOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZXJpb2QtdGFiJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlclBlcmlvZERldGFpbCgpOwogIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gY2hhbmdlUGVyaW9kKGRpcikgewogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICdtb250aCcpIHsKICAgIGNvbnN0IFt5LG1dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICBjb25zdCBkdCA9IG5ldyBEYXRlKHksIG0tMStkaXIsIDEpOwogICAgdmlld01vbnRoID0gYCR7ZHQuZ2V0RnVsbFllYXIoKX0tJHsoZHQuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsJzAnKX1gOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAneWVhcicpIHsKICAgIGNvbnN0IFt5LG1dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICBjb25zdCBkdCA9IG5ldyBEYXRlKHkrZGlyLCBtLTEsIDEpOwogICAgdmlld01vbnRoID0gYCR7ZHQuZ2V0RnVsbFllYXIoKX0tJHsoZHQuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsJzAnKX1gOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAnd2VlaycpIHsKICAgIGNvbnN0IGQgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBkLnNldERhdGUoZC5nZXREYXRlKCkgKyBkaXIqNyk7CiAgICBzZWxlY3RlZERheSA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgdmlld01vbnRoID0gZ2V0TW9udGhLZXkoc2VsZWN0ZWREYXkpOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5ID8g','bmV3IERhdGUoc2VsZWN0ZWREYXkrJ1QwMDowMDowMCcpIDogbmV3IERhdGUoKTsKICAgIGQuc2V0RGF0ZShkLmdldERhdGUoKSArIGRpcik7CiAgICBzZWxlY3RlZERheSA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgdmlld01vbnRoID0gZ2V0TW9udGhLZXkoc2VsZWN0ZWREYXkpOwogIH0KICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlclBlcmlvZERldGFpbCgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BiYXItbW9udGgnKS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIHJlbmRlckhvbWUoKTsKICByZW5kZXJUcmFuc2FjdGlvbnMoKTsKfQoKZnVuY3Rpb24gdXBkYXRlUGVyaW9kTGFiZWwoKSB7CiAgY29uc3QgbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtbW9udGgtbGFiZWwnKTsKICBjb25zdCB0b3BiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BiYXItbW9udGgnKTsKICBpZihjdXJyZW50UGVyaW9kID09PSAnbW9udGgnKSB7CiAgICBsYmwudGV4dENvbnRlbnQgPSBnZXRGdWxsRGlzcGxheU1vbnRoKHZpZXdNb250aCk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAneWVhcicpIHsKICAgIGNvbnN0IFt5XSA9IHZpZXdNb250aC5zcGxpdCgnLScpOwogICAgbGJsLnRleHRDb250ZW50ID0gJ1llYXIgJyArIHk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9IHk7CiAgfSBlbHNlIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd3ZWVrJykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5ID8gbmV3IERhdGUoc2VsZWN0ZWREYXkrJ1QwMDowMDowMCcpIDogbmV3IERhdGUoKTsKICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoZCk7IHN0YXJ0LnNldERhdGUoZC5nZXREYXRlKCkgLSBkLmdldERheSgpKTsKICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKHN0YXJ0KTsgZW5kLnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgNik7CiAgICBjb25zdCBmbXQyID0gZHQgPT4gZHQudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycse21vbnRoOidzaG9ydCcsZGF5OidudW1lcmljJ30pOwogICAgbGJsLnRleHRDb250ZW50ID0gZm10MihzdGFydCkrJyDigJMgJytmbXQyKGVuZCk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9ICdXZWVrJzsKICB9IGVsc2UgaWYoY3VycmVudFBlcmlvZCA9PT0gJ2RheScpIHsKICAgIGNvbnN0IGQgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBsYmwudGV4dENvbnRlbnQgPSBkLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHt3ZWVrZGF5Oidsb25nJyxtb250aDonbG9uZycsZGF5OidudW1lcmljJ30pOwogICAgdG9wYmFkZ2UudGV4dENvbnRlbnQgPSBkLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYyd9KTsKICB9Cn0KCmZ1bmN0aW9uIHJlbmRlclBlcmlvZERldGFpbCgpIHsKICBjb25zdCBkZXRhaWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyaW9kLWRldGFpbCcpOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd3ZWVrJyB8fCBjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgZGV0YWlsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgIC8vIFNob3cgNyBkYXlzIG9mIGN1cnJlbnQgd2VlawogICAgY29uc3QgYW5jaG9yID0gc2VsZWN0ZWREYXkgPyBuZXcgRGF0ZShzZWxlY3RlZERheSsnVDAwOjAwOjAwJykgOiBuZXcgRGF0ZSgpOwogICAgY29uc3Qgd2Vla1N0YXJ0ID0gbmV3IERhdGUoYW5jaG9yKTsKICAgIHdlZWtTdGFydC5zZXREYXRlKGFuY2hvci5nZXREYXRlKCkgLSBhbmNob3IuZ2V0RGF5KCkpOwogICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgIGNvbnN0IGRheU5hbWVzID0gWydTdScsJ01vJywnVHUnLCdXZScsJ1RoJywnRnInLCdTYSddOwogICAgZGV0YWlsLmlubmVySFRNTCA9IEFycmF5LmZyb20oe2xlbmd0aDo3fSkubWFwKChfLGkpID0+IHsKICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHdlZWtTdGFydCk7IGQuc2V0RGF0ZSh3ZWVrU3RhcnQuZ2V0RGF0ZSgpK2kpOwogICAgICBjb25zdCBkcyA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICBjb25zdCBpc1RvZGF5ID0gZHMgPT09IHRvZGF5OwogICAgICBjb25zdCBpc1NlbCA9IGRzID09PSBzZWxlY3RlZERheTsKICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJkYXktY2hpcCAke2lzVG9kYXk/J3RvZGF5JzonJ30gJHtpc1NlbD8nc2VsZWN0ZWQnOicnfSIgb25jbGljaz0ic2VsZWN0RGF5KCcke2RzfScpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJkYy1kYXkiPiR7ZGF5TmFtZXNbaV19PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZGMtbnVtIj4ke2QuZ2V0RGF0ZSgpfTwvZGl2PgogICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CiAgfSBlbHNlIHsKICAgIGRldGFpbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgfQp9CgpmdW5jdGlvbiBzZWxlY3REYXkoZGF0ZVN0cikgewogIHNlbGVjdGVkRGF5ID0gZGF0ZVN0cjsKICB2aWV3TW9udGggPSBnZXRNb250aEtleShkYXRlU3RyKTsKICByZW5kZXJQZXJpb2REZXRhaWwoKTsKICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gdG9nZ2xlUGVyaW9kVmlldygpIHsKICAvLyBDbGlja2luZyB0aGUgYmFkZ2UgY3ljbGVzIHRocm91Z2ggcGVyaW9kcwogIGNvbnN0IHBlcmlvZHMgPSBbJ21vbnRoJywnd2VlaycsJ2RheScsJ3llYXInXTsKICBjb25zdCBuZXh0ID0gcGVyaW9kc1socGVyaW9kcy5pbmRleE9mKGN1cnJlbnRQZXJpb2QpKzEpICUgcGVyaW9kcy5sZW5ndGhdOwogIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVyaW9kLXRhYicpOwogIHRhYnMuZm9yRWFjaCh0ID0+IHsgaWYodC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpID09PSBuZXh0KSBzZXRQZXJpb2QobmV4dCx0KTsgfSk7Cn0KCi8vIEdldCBlbnRyaWVzIGZpbHRlcmVkIGJ5IGN1cnJlbnQgcGVyaW9kCmZ1bmN0aW9uIGdldFBlcmlvZEVudHJpZXMobW9udGhEYXRhLCB0eXBlKSB7CiAgY29uc3QgZW50cmllcyA9IChtb250aERhdGFbdHlwZV0gfHwgW10pOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICdtb250aCcgfHwgY3VycmVudFBlcmlvZCA9PT0gJ3llYXInKSByZXR1cm4gZW50cmllczsKICBpZihjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgcmV0dXJuIGVudHJpZXMuZmlsdGVyKGUgPT4gZS5kYXRlID09PSBkKTsKICB9CiAgaWYoY3VycmVudFBlcmlvZCA9PT0gJ3dlZWsnKSB7CiAgICBjb25zdCBhbmNob3IgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBjb25zdCB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShhbmNob3IpOyB3ZWVrU3RhcnQuc2V0RGF0ZShhbmNob3IuZ2V0RGF0ZSgpLWFuY2hvci5nZXREYXkoKSk7CiAgICBjb25zdCB3ZWVrRW5kID0gbmV3IERhdGUod2Vla1N0YXJ0KTsgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkrNik7CiAgICBjb25zdCB3cyA9IHdlZWtTdGFydC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICBjb25zdCB3ZSA9IHdlZWtFbmQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgcmV0dXJuIGVudHJpZXMuZmlsdGVyKGUgPT4gZS5kYXRlID49IHdzICYmIGUuZGF0ZSA8PSB3ZSk7CiAgfQogIHJldHVybiBlbnRyaWVzOwp9CgpmdW5jdGlvbiBnZXRZZWFyRW50cmllcyh0eXBlKSB7CiAgY29uc3QgW3ldID0gdmlld01vbnRoLnNwbGl0KCctJyk7CiAgbGV0IGFsbCA9IFtdOwogIE9iamVjdC5rZXlzKGRhdGEpLmZpbHRlcihrID0+IGsuc3RhcnRzV2l0aCh5KyctJykgJiYgIWsuc3RhcnRzV2l0aCgnXycpKS5mb3JFYWNoKGsgPT4gewogICAgYWxsID0gYWxsLmNvbmNhdChkYXRhW2tdW3R5cGVdIHx8IFtdKTsKICB9KTsKICByZXR1cm4gYWxsOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSE9NRQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gc2V0SG9tZVRhYih0YWIpIHsKICBob21lVGFiID0gdGFiOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ob21lLXRhYi1idG4nKS5mb3JFYWNoKGI9PmIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdodGFiLScrdGFiKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaG9tZS1zZWN0aW9uJykuZm9yRWFjaChzPT5zLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHNlYy0nK3RhYikuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgcmVuZGVySG9tZSgpOwp9CgpmdW5jdGlvbiByZW5kZXJIb21lKCkgewogIGVuc3VyZU1vbnRoKHZpZXdNb250aCk7CiAgY29uc3QgbSA9IGRhdGFbdmlld01vbnRoXTsKCiAgbGV0IGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzLCBhZGRpdGlvbmFsOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd5ZWFyJykgewogICAgZXhwZW5zZXMgPSBnZXRZZWFyRW50cmllcygnZXhwZW5zZXMnKTsKICAgIGluY29tZSA9IGdldFllYXJFbnRyaWVzKCdpbmNvbWUnKTsKICAgIGludmVzdG1lbnRzID0gZ2V0WWVhckVudHJpZXMoJ2ludmVzdG1lbnRzJyk7CiAgICBhZGRpdGlvbmFsID0gZ2V0WWVhckVudHJpZXMoJ2FkZGl0aW9uYWwnKTsKICB9IGVsc2UgewogICAgZXhwZW5zZXMgPSBnZXRQZXJpb2RFbnRyaWVzKG0sICdleHBlbnNlcycpOwogICAgaW5jb21lID0gZ2V0UGVyaW9kRW50cmllcyhtLCAnaW5jb21lJyk7CiAgICBpbnZlc3RtZW50cyA9IGdldFBlcmlvZEVudHJpZXMobSwgJ2ludmVzdG1lbnRzJyk7CiAgICBhZGRpdGlvbmFsID0gZ2V0UGVyaW9kRW50cmllcyhtLCAnYWRkaXRpb25hbCcpOwogIH0KCiAgaWYoaG9tZVRhYiA9PT0gJ3NwZW5kaW5nJykgewogICAgY29uc3QgdG90YWxFeHAgPSBleHBlbnNlcy5yZWR1Y2UoKHMscik9PnMrY29udmVydEFtdChyLmFtb3VudCxyLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IHRvdGFsQWRkID0gYWRkaXRpb25hbC5yZWR1Y2UoKHMscik9PnMrY29udmVydEFtdChyLmFtb3VudCxyLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IHRvdGFsSW5jID0gaW5jb21lLnJlZHVjZSgocyxyKT0+cytjb252ZXJ0QW10KHIuYW1vdW50LHIuY3VycmVuY3kpLDApOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtc3BlbmRpbmcnKS50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEV4cCt0b3RhbEFkZCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1pbmNvbWUnKS50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEluYyk7CgogICAgY29uc3Qgc2FsYXJ5ID0gaW5jb21lLmZpbHRlcihlPT5bJ1NhbGFyeScsJ0ZyZWVsYW5jZScsJ0JvbnVzJ10uaW5jbHVkZXMoZS5jYXRlZ29yeSkpLnJlZHVjZSgocyxlKT0+cytjb252ZXJ0QW10KGUuYW1vdW50LGUuY3VycmVu','Y3kpLDApOwogICAgY29uc3QgZ2lmdHMgID0gaW5jb21lLmZpbHRlcihlPT5bJ0dpZnQnLCdHaWZ0cyddLmluY2x1ZGVzKGUuY2F0ZWdvcnkpKS5yZWR1Y2UoKHMsZSk9PnMrY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IG90aGVySW5jID0gaW5jb21lLmZpbHRlcihlPT4hWydTYWxhcnknLCdGcmVlbGFuY2UnLCdCb251cycsJ0dpZnQnLCdHaWZ0cyddLmluY2x1ZGVzKGUuY2F0ZWdvcnkpKS5yZWR1Y2UoKHMsZSk9PnMrY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KSwwKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLXNhbGFyeScpLnRleHRDb250ZW50ID0gZm10KHNhbGFyeSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1naWZ0cycpLnRleHRDb250ZW50ICA9IGZtdChnaWZ0cyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1vdGhlci1pbmNvbWUnKS50ZXh0Q29udGVudCA9IGZtdChvdGhlckluYyk7CgogICAgLy8gRHluYW1pYyBob21lIHNwZW5kIGNhcmRzCiAgICBjb25zdCBjYXJkcyA9IGdldEhvbWVTcGVuZENhcmRzKCkuZmlsdGVyKGM9PmMudmlzaWJsZSE9PWZhbHNlKTsKICAgIGNvbnN0IGFsbEV4cCA9IHRvdGFsRXhwICsgdG90YWxBZGQ7CiAgICBjb25zdCBjYXRUb3RhbHMgPSB7fTsKICAgIGV4cGVuc2VzLmZvckVhY2goZT0+e2NhdFRvdGFsc1tlLmNhdGVnb3J5XT0oY2F0VG90YWxzW2UuY2F0ZWdvcnldfHwwKStjb252ZXJ0QW10KGUuYW1vdW50LGUuY3VycmVuY3kpO30pOwogICAgYWRkaXRpb25hbC5mb3JFYWNoKGU9PntjYXRUb3RhbHNbJ0FkZGl0aW9uYWwnXT0oY2F0VG90YWxzWydBZGRpdGlvbmFsJ118fDApK2NvbnZlcnRBbXQoZS5hbW91bnQsZS5jdXJyZW5jeSk7fSk7CgogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtZ3JpZCcpOwogICAgZ3JpZC5pbm5lckhUTUwgPSBjYXJkcy5tYXAoY2FyZD0+ewogICAgICBjb25zdCBzdWJjYXRzID0gY2FyZC5zdWJjYXRzfHxbXTsKICAgICAgLy8gVXNlIHN1YmNhdHMgaWYgZGVmaW5lZCwgZWxzZSBmYWxsIGJhY2sgdG8gY2FyZC5sYWJlbCDigJQgbmV2ZXIgYWRkIGJvdGggKGF2b2lkcyBkb3VibGUtY291bnQpCiAgICAgIGNvbnN0IGFtdCA9IHN1YmNhdHMubGVuZ3RoID4gMAogICAgICAgID8gc3ViY2F0cy5yZWR1Y2UoKHMsc2MpPT5zKyhjYXRUb3RhbHNbc2NdfHwwKSwwKQogICAgICAgIDogKGNhdFRvdGFsc1tjYXJkLmxhYmVsXXx8MCk7CiAgICAgIGNvbnN0IHBjdCA9IGFsbEV4cD4wID8gTWF0aC5taW4oYW10L2FsbEV4cCoxMDAsMTAwKSA6IDA7CiAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iYnVkZ2V0LWNhcmQgJHtjYXJkLmNsc3x8J290aGVyLWNhdCd9IiBvbmNsaWNrPSJvcGVuUXVpY2tBZGQoJ2V4cGVuc2UnLCcke3N1YmNhdHNbMF18fGNhcmQubGFiZWx9JykiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1pY29uIiBzdHlsZT0iYmFja2dyb3VuZDoke2NhcmQuY29sb3J9MjI7Ij4ke2NhcmQuaWNvbn08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXQtbmFtZSI+JHtjYXJkLmxhYmVsfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1hbW91bnQiPiR7Zm10KGFtdCl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2F0LWJhciI+PGRpdiBjbGFzcz0iY2F0LWJhci1maWxsIiBzdHlsZT0id2lkdGg6JHtwY3R9JTtiYWNrZ3JvdW5kOiR7Y2FyZC5jb2xvcn07Ij48L2Rpdj48L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogIH0gZWxzZSB7CiAgICByZW5kZXJJbnZlc3RIb21lKGludmVzdG1lbnRzKTsKICB9CiAgcmVuZGVySG9tZUluc2lnaHRzKGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzKTsKICByZW5kZXJTZXR0aW5ncygpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSE9NRSBJTlNJR0hUUwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKbGV0IGluc2lnaHRzT3BlbiA9IGZhbHNlOwoKZnVuY3Rpb24gdG9nZ2xlSW5zaWdodHMoKSB7CiAgaW5zaWdodHNPcGVuID0gIWluc2lnaHRzT3BlbjsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMtYm9keScpLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nLCBpbnNpZ2h0c09wZW4pOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnNpZ2h0cy10b2dnbGUtYXJyb3cnKS5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJywgaW5zaWdodHNPcGVuKTsKfQoKZnVuY3Rpb24gcmVuZGVySG9tZUluc2lnaHRzKGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzKSB7CiAgY29uc3Qga3BpU3RyaXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMta3BpLXN0cmlwJyk7CiAgY29uc3QgY2hpcHNFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMtY2hpcHMnKTsKICBpZiAoIWtwaVN0cmlwIHx8ICFjaGlwc0VsKSByZXR1cm47CgogIGNvbnN0IHRvdGFsRXhwID0gZXhwZW5zZXMucmVkdWNlKChzLGUpID0+IHMgKyBjb252ZXJ0QW10KGUuYW1vdW50LCBlLmN1cnJlbmN5KSwgMCk7CiAgY29uc3QgdG90YWxJbmMgPSBpbmNvbWUucmVkdWNlKChzLGUpICAgPT4gcyArIGNvbnZlcnRBbXQoZS5hbW91bnQsIGUuY3VycmVuY3kpLCAwKTsKICBjb25zdCB0b3RhbEludiA9IGludmVzdG1lbnRzLnJlZHVjZSgocyxlKSA9PiBzICsgY29udmVydEFtdChlLmFtb3VudCwgZS5jdXJyZW5jeSksIDApOwogIGNvbnN0IG5ldCA9IHRvdGFsSW5jIC0gdG90YWxFeHA7CiAgY29uc3Qgc2F2aW5nc1JhdGUgPSB0b3RhbEluYyA+IDAgPyAoKHRvdGFsSW5jIC0gdG90YWxFeHApIC8gdG90YWxJbmMgKiAxMDApIDogMDsKCiAgLy8g4pSA4pSAIEtQSSBzdHJpcCAoMyBhbHdheXMtdmlzaWJsZSBudW1iZXJzKSDilIDilIAKICBjb25zdCBrcGlzID0gWwogICAgeyB2YWw6IGZtdChuZXQpLCAgbGFiZWw6IG5ldCA+PSAwID8gJ05ldCBTYXZlZCcgOiAnTmV0IERlZmljaXQnLCBjb2xvcjogbmV0ID49IDAgPyAndmFyKC0taW5jb21lKScgOiAndmFyKC0tZXhwZW5zZXMpJyB9LAogICAgeyB2YWw6IHNhdmluZ3NSYXRlLnRvRml4ZWQoMCkgKyAnJScsIGxhYmVsOiAnU2F2aW5ncyBSYXRlJywgY29sb3I6IHNhdmluZ3NSYXRlID49IDIwID8gJ3ZhcigtLWluY29tZSknIDogc2F2aW5nc1JhdGUgPj0gMTAgPyAnI0Y1OUUwQicgOiAndmFyKC0tZXhwZW5zZXMpJyB9LAogICAgeyB2YWw6IGZtdCh0b3RhbEludiksIGxhYmVsOiAnSW52ZXN0ZWQnLCBjb2xvcjogJyM3QzNBRUQnIH0sCiAgXTsKICBrcGlTdHJpcC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iaW5zaWdodHMta3BpLXJvdyI+JHsKICAgIGtwaXMubWFwKGsgPT4gYDxkaXYgY2xhc3M9Imluc2lnaHRzLWtwaSI+CiAgICAgIDxkaXYgY2xhc3M9ImlrcGktdmFsIiBzdHlsZT0iY29sb3I6JHtrLmNvbG9yfTsiPiR7ay52YWx9PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImlrcGktbGFiZWwiPiR7ay5sYWJlbH08L2Rpdj4KICAgIDwvZGl2PmApLmpvaW4oJycpCiAgfTwvZGl2PmA7CgogIC8vIOKUgOKUgCBDb21wdXRlIGNoaXBzIOKUgOKUgAogIGNvbnN0IGNoaXBzID0gW107CgogIC8vIDEuIFRvcCBzcGVuZGluZyBjYXRlZ29yeQogIGNvbnN0IGNhdFRvdGFscyA9IHt9OwogIGV4cGVuc2VzLmZvckVhY2goZSA9PiB7IGNhdFRvdGFsc1tlLmNhdGVnb3J5XSA9IChjYXRUb3RhbHNbZS5jYXRlZ29yeV18fDApICsgY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KTsgfSk7CiAgY29uc3QgdG9wQ2F0cyA9IE9iamVjdC5lbnRyaWVzKGNhdFRvdGFscykuc29ydCgoYSxiKSA9PiBiWzFdLWFbMV0pOwogIGlmICh0b3BDYXRzLmxlbmd0aCA+IDApIHsKICAgIGNvbnN0IFt0b3BDYXQsIHRvcEFtdF0gPSB0b3BDYXRzWzBdOwogICAgY29uc3QgcGN0ID0gdG90YWxFeHAgPiAwID8gKHRvcEFtdC90b3RhbEV4cCoxMDApLnRvRml4ZWQoMCkgOiAwOwogICAgY2hpcHMucHVzaCh7IHR5cGU6IHBjdCA+IDMwID8gJ3dhcm4nIDogJ25ldXRyYWwnLCBpY29uOiAn8J+PhicsIHRpdGxlOiBgQmlnZ2VzdCBzcGVuZDogJHt0b3BDYXR9YCwgc3ViOiBgJHtmbXQodG9wQW10KX0g4oCUICR7cGN0fSUgb2YgdG90YWwgc3BlbmRpbmcgdGhpcyBwZXJpb2RgIH0pOwogIH0KCiAgLy8gMi4gU2F2aW5ncyByYXRlIHZlcmRpY3QKICBpZiAodG90YWxJbmMgPiAwKSB7CiAgICBpZiAoc2F2aW5nc1JhdGUgPj0gMjApIGNoaXBzLnB1c2goeyB0eXBlOidnb29kJywgIGljb246J/CfjJ8nLCB0aXRsZTonR3JlYXQgc2F2aW5ncyByYXRlIScsIHN1YjpgWW91J3JlIHNhdmluZyAke3NhdmluZ3NSYXRlLnRvRml4ZWQoMCl9JSBvZiBpbmNvbWUg4oCUIGFib3ZlIHRoZSAyMCUgYmVuY2htYXJrYCB9KTsKICAgIGVsc2UgaWYgKHNhdmluZ3NSYXRlID49IDEwKSBjaGlwcy5wdXNoKHsgdHlwZTond2FybicsICBpY29uOifwn5KbJywgdGl0bGU6J0RlY2VudCBzYXZpbmdzIHJhdGUnLCBzdWI6YCR7c2F2aW5nc1JhdGUudG9GaXhlZCgwKX0lIHNhdmVkIOKAlCBhaW0gZm9yIDIwJSB0byBidWlsZCB3ZWFsdGggZmFzdGVyYCB9KTsKICAgIGVsc2UgaWYgKHNhdmluZ3NSYXRlID4gMCkgICBjaGlwcy5wdXNoKHsgdHlwZTonYWxlcnQnLCBpY29uOifimqDvuI8nLCB0aXRsZTonTG93IHNhdmluZ3MgcmF0ZScsIHN1YjpgT25seSAke3NhdmluZ3NSYXRlLnRvRml4ZWQoMCl9JSBzYXZlZCB0aGlzIHBlcmlvZCDigJQgcmV2aWV3IHRvcCBzcGVuZGluZyBjYXRlZ29yaWVzYCB9KTsKICAgIGVsc2UgaWYgKG5ldCA8IDApICAgICAgICAgICBjaGlwcy5wdXNoKHsgdHlwZTonYWxlcnQnLCBpY29uOifwn5qoJywgdGl0bGU6J1NwZW5kaW5nIGV4Y2VlZHMgaW5jb21lJywgc3ViOmAke2ZtdChNYXRoLmFicyhuZXQpKX0gbW9yZSBzcGVudCB0aGFuIGVhcm5lZCDigJQgcmV2aWV3IHlvdXIgYnVkZ2V0YCB9KTsKICB9CgogIC8vIDMuIEludmVzdG1lbnQgZGlzY2lwbGluZQogIGlmICh0b3RhbEluYyA+IDApIHsKICAgIGNvbnN0IGludlJhdGUgPSAodG90YWxJbnYgLyB0b3RhbEluYyAqIDEwMCk7CiAgICBpZiAoaW52UmF0ZSA+PSAxNSkgY2hpcHMucHVzaCh7IHR5cGU6J2dvb2QnLCAgIGljb246J/Cfk4gnLCB0aXRsZTonU3Ryb25nIGludmVzdG1lbnQgaGFiaXQnLCBzdWI6YCR7aW52UmF0ZS50b0ZpeGVkKDApfSUgb2YgaW5jb21lIGdvaW5nIHRvIGludmVzdG1lbnRzIOKAlCBleGNlbGxlbnQgZGlzY2lwbGluZWAgfSk7CiAgICBlbHNlIGlmIChpbnZSYXRlID4gMCkgY2hpcHMucHVzaCh7IHR5cGU6J25ldXRyYWwnLCBpY29uOifwn5OKJywgdGl0bGU6YCR7aW52UmF0ZS50b0ZpeGVkKDApfSUgaW52ZXN0ZWRgLCBzdWI6YCR7Zm10KHRvdGFsSW52KX0gaW52ZXN0ZWQgdGhpcyBwZXJpb2Qg4oCUIGNvbnNpZGVyIGluY3JlYXNpbmcgdG8gMTUlK2AgfSk7CiAgICBlbHNlIGNoaXBzLnB1c2goeyB0eXBlOiduZXV0cmFsJywgaWNvbjon8J+SoScsIHRpdGxlOidObyBpbnZlc3RtZW50cyB0aGlzIHBlcmlvZCcsIHN1YjonQ29uc2lkZXIgYWxsb2NhdGluZyBhIHBvcnRpb24gb2YgaW5jb21lIHRvIGludmVzdG1lbnRzJyB9KTsKICB9CgogIC8vIDQuIEJ1ZGdldCBnb2FsIGNoZWNrIOKAlCBmaW5kIG1vc3Qgb3Zlci1idWRnZXQgY2F0ZWdvcnkKICBjb25zdCBleHBHb2FscyA9IGdldEJ1ZGdldEdvYWxzKCdleHBlbnNlJyk7CiAgaWYgKGV4cEdvYWxzLmxlbmd0','aCA+IDAgJiYgY3VycmVudFBlcmlvZCAhPT0gJ3llYXInKSB7CiAgICBjb25zdCBvdmVyQnVkZ2V0ID0gZXhwR29hbHMubWFwKGcgPT4gewogICAgICBjb25zdCBhY3R1YWwgPSBnZXRCdWRnZXRBY3R1YWwoZywgdmlld01vbnRoKTsKICAgICAgY29uc3QgYnVkZ2V0ID0gTnVtYmVyKGcuYW1vdW50IHx8IDApOwogICAgICByZXR1cm4geyBuYW1lOiBnLm5hbWUsIG92ZXI6IGFjdHVhbCAtIGJ1ZGdldCwgcGN0OiBidWRnZXQgPiAwID8gYWN0dWFsL2J1ZGdldCoxMDAgOiAwIH07CiAgICB9KS5maWx0ZXIoZyA9PiBnLm92ZXIgPiAwKS5zb3J0KChhLGIpID0+IGIucGN0IC0gYS5wY3QpOwogICAgaWYgKG92ZXJCdWRnZXQubGVuZ3RoID4gMCkgewogICAgICBjb25zdCB3b3JzdCA9IG92ZXJCdWRnZXRbMF07CiAgICAgIGNoaXBzLnB1c2goeyB0eXBlOidhbGVydCcsIGljb246J/Cfjq8nLCB0aXRsZTpgJHt3b3JzdC5uYW1lfSBvdmVyIGJ1ZGdldGAsIHN1YjpgJHtmbXQod29yc3Qub3Zlcil9IG92ZXIgbGltaXQg4oCUICR7d29yc3QucGN0LnRvRml4ZWQoMCl9JSBvZiBidWRnZXQgdXNlZGAgfSk7CiAgICB9IGVsc2UgaWYgKGV4cEdvYWxzLmxlbmd0aCA+IDApIHsKICAgICAgY2hpcHMucHVzaCh7IHR5cGU6J2dvb2QnLCBpY29uOifinIUnLCB0aXRsZTonQWxsIGNhdGVnb3JpZXMgd2l0aGluIGJ1ZGdldCcsIHN1YjonR3JlYXQgam9iIHN0YXlpbmcgb24gdHJhY2sgdGhpcyBwZXJpb2QhJyB9KTsKICAgIH0KICB9CgogIC8vIDUuIEJpZ2dlc3Qgc2luZ2xlIGRheSAobW9udGgvd2VlayBtb2RlIG9ubHkpCiAgaWYgKGN1cnJlbnRQZXJpb2QgIT09ICd5ZWFyJykgewogICAgY29uc3QgZGF5VG90YWxzID0ge307CiAgICBleHBlbnNlcy5mb3JFYWNoKGUgPT4gewogICAgICBjb25zdCBkID0gKGUuZGF0ZXx8JycpLnN1YnN0cmluZygwLDEwKTsKICAgICAgaWYgKGQpIGRheVRvdGFsc1tkXSA9IChkYXlUb3RhbHNbZF18fDApICsgY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KTsKICAgIH0pOwogICAgY29uc3QgZGF5RW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGRheVRvdGFscykuc29ydCgoYSxiKSA9PiBiWzFdLWFbMV0pOwogICAgaWYgKGRheUVudHJpZXMubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBbYmlnRGF5LCBiaWdBbXRdID0gZGF5RW50cmllc1swXTsKICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKGJpZ0RheSsnVDAwOjAwOjAwJyk7CiAgICAgIGNvbnN0IGxhYmVsID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnfSk7CiAgICAgIGNoaXBzLnB1c2goeyB0eXBlOiBiaWdBbXQgPiB0b3RhbEV4cCAqIDAuMjUgPyAnd2FybicgOiAnbmV1dHJhbCcsIGljb246J/Cfk4UnLCB0aXRsZTpgQmlnZ2VzdCBzcGVuZCBkYXk6ICR7bGFiZWx9YCwgc3ViOmAke2ZtdChiaWdBbXQpfSBzcGVudCDigJQgJHt0b3RhbEV4cD4wPyhiaWdBbXQvdG90YWxFeHAqMTAwKS50b0ZpeGVkKDApOjB9JSBvZiBtb250aGx5IHRvdGFsIGluIG9uZSBkYXlgIH0pOwogICAgfQogIH0KCiAgLy8gNi4gTm8tc3BlbmQgLyBsb3ctc3BlbmQgZW5jb3VyYWdlbWVudAogIGlmICh0b3RhbEV4cCA9PT0gMCAmJiB0b3RhbEluYyA9PT0gMCkgewogICAgY2hpcHMucHVzaCh7IHR5cGU6J25ldXRyYWwnLCBpY29uOifwn4yxJywgdGl0bGU6J05vIGRhdGEgeWV0IGZvciB0aGlzIHBlcmlvZCcsIHN1YjonQWRkIHRyYW5zYWN0aW9ucyBvciBpbXBvcnQgeW91ciBFeGNlbCBmaWxlcyBmcm9tIHRoZSBJbXBvcnQgdGFiJyB9KTsKICB9CgogIGNoaXBzRWwuaW5uZXJIVE1MID0gY2hpcHMubWFwKGMgPT4gYAogICAgPGRpdiBjbGFzcz0iaW5zaWdodC1jaGlwICR7Yy50eXBlfSI+CiAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC1pY29uIj4ke2MuaWNvbn08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW5zaWdodC1jaGlwLXRleHQiPgogICAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC10aXRsZSI+JHtjLnRpdGxlfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC1zdWIiPiR7Yy5zdWJ9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YCkuam9pbignJyk7Cn0KY29uc3QgREVGQVVMVF9JTlZfQ0FSRFMgPSBbCiAgeyBrZXk6J1N0b2NrcycsICAgICAgbGFiZWw6J1N0b2NrcycsICAgICAgICAgIGljb246J/Cfk4onLCBjb2xvcjonIzRBOUVGRicsIGJnOicjRUVGNUZGJywgZmllbGRUZW1wbGF0ZTonU3RvY2tzJywgICAgICB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonQ3J5cHRvJywgICAgICBsYWJlbDonQ3J5cHRvJywgICAgICAgICAgaWNvbjon8J+qmScsIGNvbG9yOicjRjU5RTBCJywgYmc6JyNGRkZCRUUnLCBmaWVsZFRlbXBsYXRlOidDcnlwdG8nLCAgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidNZXRhbHMnLCAgICAgIGxhYmVsOidNZXRhbHMnLCAgICAgICAgICBpY29uOifwn6WHJywgY29sb3I6JyNDODkwMEEnLCBiZzonI0ZGRjhFMCcsIGZpZWxkVGVtcGxhdGU6J01ldGFscycsICAgICAgdmlzaWJsZTp0cnVlIH0sCiAgeyBrZXk6J1JlYWwgRXN0YXRlJywgbGFiZWw6J1JlYWwgRXN0YXRlJywgICAgIGljb246J/Cfj6EnLCBjb2xvcjonIzEwQjk4MScsIGJnOicjRjBGQkYzJywgZmllbGRUZW1wbGF0ZTonUmVhbCBFc3RhdGUnLCB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonRVRGL01GJywgICAgICBsYWJlbDonRVRGIC8gTUYnLCAgICAgICAgaWNvbjon8J+XgicsIGNvbG9yOicjN0MzQUVEJywgYmc6JyNGM0VFRkYnLCBmaWVsZFRlbXBsYXRlOidFVEYvTUYnLCAgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidQRi9WUEYnLCAgICAgIGxhYmVsOidQRiAvIFZQRicsICAgICAgICBpY29uOifwn4+b77iPJywgY29sb3I6JyMwRUE1RTknLCBiZzonI0UwRjJGRScsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTp0cnVlIH0sCiAgeyBrZXk6J05QUycsICAgICAgICAgbGFiZWw6J05QUycsICAgICAgICAgICAgIGljb246J/Cfp5MnLCBjb2xvcjonIzhCNUNGNicsIGJnOicjRjNFRUZGJywgZmllbGRUZW1wbGF0ZTonR2VuZXJhbCcsICAgICB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonUFBGJywgICAgICAgICBsYWJlbDonUFBGJywgICAgICAgICAgICAgaWNvbjon8J+TricsIGNvbG9yOicjMDU5NjY5JywgYmc6JyNFQ0ZERjUnLCBmaWVsZFRlbXBsYXRlOidHZW5lcmFsJywgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidGRCcsICAgICAgICAgIGxhYmVsOidGaXhlZCBEZXBvc2l0JywgICBpY29uOifwn4+mJywgY29sb3I6JyNEOTc3MDYnLCBiZzonI0ZGRkJFQicsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTpmYWxzZSB9LAogIHsga2V5OidJbnN1cmFuY2UnLCAgIGxhYmVsOidJbnN1cmFuY2UnLCAgICAgICBpY29uOifwn5uh77iPJywgY29sb3I6JyNEQzI2MjYnLCBiZzonI0ZFRjJGMicsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTpmYWxzZSB9LApdOwoKLy8gSU5WX0NBVFMga2VwdCBhcyBhbiBhbGlhcyBmb3IgYW55IGxlZ2FjeSByZWFkcwpjb25zdCBJTlZfQ0FUUyA9IERFRkFVTFRfSU5WX0NBUkRTOwoKLy8gR2VuZXJhbCBmaWVsZCB0ZW1wbGF0ZSBmb3Igc2F2aW5ncy9jb250cmlidXRpb24tc3R5bGUgaW52ZXN0bWVudHMgKFBGLCBOUFMsIEZEIGV0Yy4pCmNvbnN0IElOVl9GSUVMRFNfR0VORVJBTCA9IFsKICB7aWQ6J2ludi1zY2hlbWUnLCAgIGxhYmVsOidTY2hlbWUgLyBBY2NvdW50JywgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIFZQRiwgTlBTIFRpZXItMScsICBmdWxsOnRydWV9LAogIHtpZDonaW52LWNvbnRyaWInLCAgbGFiZWw6J0NvbnRyaWJ1dGlvbicsICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogIHtpZDonaW52LXRvdGFsLWFjYycsbGFiZWw6J1RvdGFsIEFjY3VtdWxhdGVkJywgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwIChvcHRpb25hbCknLCAgICAgICAgZnVsbDpmYWxzZX0sCiAge2lkOidpbnYtcmF0ZScsICAgICBsYWJlbDonSW50ZXJlc3QgLyBSZXR1cm4gJScsdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6J2UuZy4gOC4yNScsICAgICAgICAgICAgIGZ1bGw6ZmFsc2V9LAogIHtpZDonaW52LW1hdHVyaXR5JywgbGFiZWw6J01hdHVyaXR5IC8gVGFyZ2V0IERhdGUnLHR5cGU6J3RleHQnLHBsYWNlaG9sZGVyOidlLmcuIDIwMzUnLCAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKXTsKCmZ1bmN0aW9uIGdldEhvbWVJbnZDYXJkcygpIHsKICBpZighZGF0YS5faG9tZUludkNhcmRzKSByZXR1cm4gREVGQVVMVF9JTlZfQ0FSRFMubWFwKGM9Pih7Li4uY30pKTsKICByZXR1cm4gZGF0YS5faG9tZUludkNhcmRzOwp9CmZ1bmN0aW9uIHNhdmVIb21lSW52Q2FyZHMoY2FyZHMpIHsgZGF0YS5faG9tZUludkNhcmRzID0gY2FyZHM7IHNhdmUoKTsgfQoKZnVuY3Rpb24gcmVuZGVySW52ZXN0SG9tZShpbnZlc3RtZW50cykgewogIC8vIEhvbWUgaW52ZXN0bWVudCBjYXJkcyBzaG93IE9OTFkgbW9udGhseSBjYXNoLWZsb3cgdHJhbnNhY3Rpb25zICh3aGF0IHlvdSBpbnZlc3RlZCB0aGlzIG1vbnRoKS4KICAvLyBkYXRhLl9tZXRhbHMgYW5kIGRhdGEuX253QWNjb3VudHMgYXJlIE5ldCBXb3J0aCBob2xkaW5ncyDigJQgdGhleSBORVZFUiBhcHBlYXIgaGVyZS4KICBsZXQgaW52QWxsID0gaW52ZXN0bWVudHMgfHwgW107CgogIGNvbnN0IHRvdGFscyA9IHt9OwogIGludkFsbC5mb3JFYWNoKGludj0+ewogICAgY29uc3QgdHlwZSA9IGludi5pbnZlc3RUeXBlfHxpbnYuY2F0ZWdvcnl8fCdTdG9ja3MnOwogICAgdG90YWxzW3R5cGVdPSh0b3RhbHNbdHlwZV18fDApK2NvbnZlcnRBbXQoaW52LmFtb3VudCwgaW52LmN1cnJlbmN5KTsKICB9KTsKICAvLyBOb3RlOiBkYXRhLl9pbnZlc3RtZW50cyAocG9ydGZvbGlvIHBvc2l0aW9ucykgYWxzbyBleGNsdWRlZCBmcm9tIG1vbnRobHkgdG90YWwg4oCUCiAgLy8gcG9ydGZvbGlvIHZhbHVlIOKJoCBhbW91bnQgaW52ZXN0ZWQgdGhpcyBtb250aC4KCiAgY29uc3QgZ3JhbmRUb3RhbCA9IE9iamVjdC52YWx1ZXModG90YWxzKS5yZWR1Y2UoKHMsdik9PnMrdiwwKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1pbnZlc3QtdG90YWwnKS50ZXh0Q29udGVudCA9IGZtdChncmFuZFRvdGFsKTsKCiAgLy8gVXNlIGR5bmFtaWMgY2FyZHMKICBjb25zdCBjYXJkcyA9IGdldEhvbWVJbnZDYXJkcygpLmZpbHRlcihjPT5jLnZpc2libGUhPT1mYWxzZSk7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtY2F0LWdyaWQnKTsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcChjYXJkPT57CiAgICBjb25zdCBhbXQgPSB0b3RhbHNbY2FyZC5rZXldfHwwOwogICAgY29uc3QgcGN0ID0gZ3JhbmRUb3RhbD4wP01hdGgubWluKGFtdC9ncmFuZFRvdGFsKjEwMCwxMDApOjA7CiAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImludmVzdC1jYXQtY2FyZCIgc3R5bGU9ImJhY2tncm91bmQ6JHtjYXJkLmJnfHwnI0Y4RjhGOCd9OyIgb25jbGljaz0iY2xvc2VGYWJNZW51KCk7b3BlblF1aWNrQWRkKCdpbnZlc3RtZW50JywnJHtjYXJkLmtleX0nKSI+CiAgICAgIDxkaXYgY2xhc3M9Imludi1jYXJkLWljb24iIHN0eWxlPSJiYWNrZ3JvdW5kOiR7Y2FyZC5jb2xvcn0yMjsiPiR7Y2FyZC5pY29ufTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbnYtY2FyZC1sYWJlbCI+JHtjYXJkLmxhYmVsfHxjYXJkLmtleX08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW52LWNhcmQtYW10Ij4ke2ZtdChhbXQpfTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbnYtY2FyZC11bml0cyI+JHthbXQ+MD8nVGFwIHRvIGFkZCBtb3JlJzonVGFwIHRvIHN0YXJ0IHRyYWNraW5nJ308L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW52','LWNhcmQtYmFyIj48ZGl2IGNsYXNzPSJpbnYtY2FyZC1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiR7cGN0fSU7YmFja2dyb3VuZDoke2NhcmQuY29sb3J9OyI+PC9kaXY+PC9kaXY+CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpICsKICBgPGRpdiBzdHlsZT0iZ3JpZC1jb2x1bW46c3BhbiAyO2JhY2tncm91bmQ6dmFyKC0td2hpdGUpO2JvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTtib3gtc2hhZG93OnZhcigtLWNhcmQtc2hhZG93KTtwYWRkaW5nOjE0cHg7dGV4dC1hbGlnbjpjZW50ZXI7Y3Vyc29yOnBvaW50ZXI7IiBvbmNsaWNrPSJzd2l0Y2hTY3JlZW4oJ25ldHdvcnRoJyxkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LWl0ZW06bnRoLWNoaWxkKDQpJykpIj4KICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOWVtO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPvCfko4gVmlldyBOZXQgV29ydGgg4oaSPC9zcGFuPgogIDwvZGl2PmA7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBRVUlDSyBBREQgUE9QVVAgKEggcmVxdWlyZW1lbnQg4oCUIHBvcHVwIGluc3RlYWQgb2YgVFhOIHBhZ2UpCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBvcGVuUXVpY2tBZGQodHlwZSwgc3ViQ2F0KSB7CiAgcWFUeXBlID0gdHlwZSB8fCAnZXhwZW5zZSc7CiAgcWFBbW91bnRTdHIgPSAnJzsKICBxYVByZXNlbGVjdFN1YkNhdCA9IHN1YkNhdCB8fCBudWxsOwoKICAvLyBTZXQgdHlwZSBjaGlwcwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5xYS10eXBlLWNoaXAnKS5mb3JFYWNoKGMgPT4gYy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgY29uc3QgY2hpcCA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucWEtdHlwZS1jaGlwJyldLmZpbmQoYyA9PiBjLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModHlwZSkpOwogIGlmKGNoaXApIGNoaXAuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogIC8vIFJlc2V0IGFtb3VudAogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1hbW91bnQtZGlzcGxheScpLnZhbHVlID0gJzAnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1kYXRlLWlucHV0JykudmFsdWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbm90ZS1pbnB1dCcpLnZhbHVlID0gJyc7CiAgY29uc3QgX21nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLWdyYW1zJyk7IGlmIChfbWcpIF9tZy52YWx1ZSA9ICcnOwogIGNvbnN0IF9tZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1maWVsZHMnKTsgaWYgKF9tZikgX21mLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogIHFhUmVuZGVyU3ViQ2F0cygpOwogIHFhUmVuZGVyTnVtcGFkKCk7CgogIC8vIFNldCB0aXRsZQogIGNvbnN0IGljb25zID0geyBleHBlbnNlOifwn5K4JywgaW5jb21lOifwn5K1JywgaW52ZXN0bWVudDon8J+TiCcsIGRlYnQ6J/Cfk4knLCBnaXZlbjon8J+knScsIGFkZGl0aW9uYWw6J/CfjoEnIH07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSAoaWNvbnNbdHlwZV18fCfinpUnKSArICcgUXVpY2sgQWRkICcgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0eXBlLnNsaWNlKDEpKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aWNrLWFkZC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKfQoKZnVuY3Rpb24gcWFTZXRUeXBlKHR5cGUsIGVsKSB7CiAgcWFUeXBlID0gdHlwZTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucWEtdHlwZS1jaGlwJykuZm9yRWFjaChjID0+IGMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHFhUHJlc2VsZWN0U3ViQ2F0ID0gbnVsbDsKICBxYVJlbmRlclN1YkNhdHMoKTsKICBjb25zdCBpY29ucyA9IHsgZXhwZW5zZTon8J+SuCcsIGluY29tZTon8J+StScsIGludmVzdG1lbnQ6J/Cfk4gnLCBkZWJ0Oifwn5OJJywgZ2l2ZW46J/CfpJ0nLCBhZGRpdGlvbmFsOifwn46BJyB9OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tb2RhbC10aXRsZScpLnRleHRDb250ZW50ID0gKGljb25zW3R5cGVdfHwn4p6VJykgKyAnIFF1aWNrIEFkZCAnICsgKHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrdHlwZS5zbGljZSgxKSk7CiAgX3FhVG9nZ2xlTWV0YWxGaWVsZHMoKTsKfQoKbGV0IHFhRGVsZXRlTW9kZSA9IGZhbHNlOwoKZnVuY3Rpb24gcWFSZW5kZXJTdWJDYXRzKCkgewogIHFhRGVsZXRlTW9kZSA9IGZhbHNlOwogIGNvbnN0IGNhdHMgPSBnZXRDYXRzRm9yVHlwZShxYVR5cGUpOwogIHFhU3ViQ2F0ID0gcWFQcmVzZWxlY3RTdWJDYXQgfHwgY2F0c1swXSB8fCAnJzsKICBpZihxYVByZXNlbGVjdFN1YkNhdCAmJiAhY2F0cy5pbmNsdWRlcyhxYVByZXNlbGVjdFN1YkNhdCkpIHsKICAgIHFhU3ViQ2F0ID0gY2F0c1swXSB8fCAnJzsKICB9CiAgX3JlbmRlclFhUGlsbHMoY2F0cyk7Cn0KCmZ1bmN0aW9uIF9yZW5kZXJRYVBpbGxzKGNhdHMpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtc3ViLWNhdHMnKTsKICAvLyBSZWd1bGFyIHBpbGxzCiAgY29uc3QgcGlsbHNIdG1sID0gY2F0cy5tYXAoKGMsaSkgPT4gewogICAgY29uc3QgaXNBY3RpdmUgPSBjID09PSBxYVN1YkNhdDsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0icWEtc3ViLXBpbGwgJHtpc0FjdGl2ZT8nYWN0aXZlJzonJ30gJHtxYURlbGV0ZU1vZGU/J2RlbGV0ZS1tb2RlJzonJ30iCiAgICAgIG9uY2xpY2s9ImlmKCFxYURlbGV0ZU1vZGUpcWFTZWxlY3RTdWIoJyR7Y30nLHRoaXMpIgogICAgICBvbmNvbnRleHRtZW51PSJldmVudC5wcmV2ZW50RGVmYXVsdCgpO3FhVG9nZ2xlRGVsZXRlTW9kZSgpIgogICAgICB0aXRsZT0iJHtxYURlbGV0ZU1vZGU/J3RhcCDinJUgdG8gcmVtb3ZlJzonaG9sZCB0byBtYW5hZ2UnfSI+CiAgICAgICR7Y30KICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtcGlsbC1kZWwiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO3FhUmVtb3ZlQ2F0KCR7aX0pIj7inJU8L2J1dHRvbj4KICAgIDwvZGl2PmA7CiAgfSkuam9pbignJyk7CiAgLy8gQWRkIHBpbGwgb3IgZG9uZSBidXR0b24KICBjb25zdCBhY3Rpb25QaWxsID0gcWFEZWxldGVNb2RlCiAgICA/IGA8ZGl2IGNsYXNzPSJxYS1zdWItcGlsbCIgc3R5bGU9ImJhY2tncm91bmQ6I0ZGRjBGMDtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ym9yZGVyLWNvbG9yOiNGRkNDQ0M7IiBvbmNsaWNrPSJxYVRvZ2dsZURlbGV0ZU1vZGUoKSI+4pyUIERvbmU8L2Rpdj5gCiAgICA6IGA8ZGl2IGNsYXNzPSJxYS1zdWItcGlsbCIgc3R5bGU9ImJhY2tncm91bmQ6dmFyKC0teWVsbG93LWxpZ2h0KTtib3JkZXItY29sb3I6dmFyKC0teWVsbG93KTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO2ZvbnQtd2VpZ2h0OjkwMDsiIG9uY2xpY2s9InFhU2hvd0FkZElucHV0KCkiPu+8iyBBZGQ8L2Rpdj5gOwogIGNvbnRhaW5lci5pbm5lckhUTUwgPSBwaWxsc0h0bWwgKyBhY3Rpb25QaWxsOwp9CgpmdW5jdGlvbiBxYVRvZ2dsZURlbGV0ZU1vZGUoKSB7CiAgcWFEZWxldGVNb2RlID0gIXFhRGVsZXRlTW9kZTsKICBfcmVuZGVyUWFQaWxscyhnZXRDYXRzRm9yVHlwZShxYVR5cGUpKTsKfQoKZnVuY3Rpb24gcWFSZW1vdmVDYXQoaWR4KSB7CiAgY29uc3QgY2F0cyA9IGdldENhdHNGb3JUeXBlKHFhVHlwZSk7CiAgY29uc3QgY2F0ID0gY2F0c1tpZHhdOwogIGlmKCFjYXQpIHJldHVybjsKICAvLyBJbml0aWFsaXplIGN1c3RvbSBpZiBuZWVkZWQKICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICBpZighY2NbcWFUeXBlXSkgY2NbcWFUeXBlXSA9IFsuLi4oREVGQVVMVF9DQVRTW3FhVHlwZV18fFtdKV07CiAgY2NbcWFUeXBlXS5zcGxpY2UoaWR4LCAxKTsKICBpZihxYVN1YkNhdCA9PT0gY2F0KSBxYVN1YkNhdCA9IGNjW3FhVHlwZV1bMF0gfHwgJyc7CiAgc2F2ZSgpOwogIF9yZW5kZXJRYVBpbGxzKGNjW3FhVHlwZV0pOwogIHJlbmRlckNhdFBpbGxzKCk7IC8vIHN5bmMgc2V0dGluZ3MgdmlldwogIHNob3dUb2FzdChgIiR7Y2F0fSIgcmVtb3ZlZGApOwp9CgpmdW5jdGlvbiBxYVNob3dBZGRJbnB1dCgpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtc3ViLWNhdHMnKTsKICAvLyBBcHBlbmQgaW5saW5lIGlucHV0IGFmdGVyIGV4aXN0aW5nIHBpbGxzCiAgY29uc3QgZXhpc3RpbmcgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnFhLXN1Yi1waWxsJyk7CiAgZXhpc3RpbmcuZm9yRWFjaChwID0+IHAuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgcm93LnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTpmbGV4O2dhcDo2cHg7d2lkdGg6MTAwJTttYXJnaW4tdG9wOjRweDsnOwogIHJvdy5pbm5lckhUTUwgPSBgCiAgICA8aW5wdXQgaWQ9InFhLW5ldy1jYXQtaW5wdXQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJDYXRlZ29yeSBuYW1lLi4uIgogICAgICBzdHlsZT0iZmxleDoxO2JvcmRlcjoxLjVweCBzb2xpZCB2YXIoLS15ZWxsb3cpO2JvcmRlci1yYWRpdXM6MTBweDtwYWRkaW5nOjdweCAxMHB4O2ZvbnQtZmFtaWx5Ok51bml0byxzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7b3V0bGluZTpub25lOyIKICAgICAgb25rZXlkb3duPSJpZihldmVudC5rZXk9PT0nRW50ZXInKXFhQ29uZmlybUFkZENhdCgpIj4KICAgIDxidXR0b24gb25jbGljaz0icWFDb25maXJtQWRkQ2F0KCkiIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLXllbGxvdyk7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6N3B4IDE0cHg7Zm9udC1mYW1pbHk6TnVuaXRvLHNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjg1ZW07Y3Vyc29yOnBvaW50ZXI7Ij5BZGQ8L2J1dHRvbj4KICAgIDxidXR0b24gb25jbGljaz0icWFSZW5kZXJTdWJDYXRzKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6N3B4IDEycHg7Zm9udC1mYW1pbHk6TnVuaXRvLHNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg1ZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+Q2FuY2VsPC9idXR0b24+CiAgYDsKICBjb250YWluZXIuYXBwZW5kQ2hpbGQocm93KTsKICBzZXRUaW1lb3V0KCgpPT5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbmV3LWNhdC1pbnB1dCcpPy5mb2N1cygpLCA1MCk7Cn0KCmZ1bmN0aW9uIHFhQ29uZmlybUFkZENhdCgpIHsKICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1uZXctY2F0LWlucHV0Jyk7CiAgY29uc3QgbmFtZSA9IChpbnB1dD8udmFsdWV8fCcnKS50cmltKCk7CiAgaWYoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIG5hbWUg4p2MJyk7IHJldHVybjsgfQogIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogIGlmKCFjY1txYVR5cGVdKSBjY1txYVR5cGVd','ID0gWy4uLihERUZBVUxUX0NBVFNbcWFUeXBlXXx8W10pXTsKICBpZihjY1txYVR5cGVdLmluY2x1ZGVzKG5hbWUpKSB7IHNob3dUb2FzdCgnQWxyZWFkeSBleGlzdHMg4pqg77iPJyk7IHJldHVybjsgfQogIGNjW3FhVHlwZV0ucHVzaChuYW1lKTsKICBxYVN1YkNhdCA9IG5hbWU7CiAgc2F2ZSgpOwogIHFhUmVuZGVyU3ViQ2F0cygpOwogIHJlbmRlckNhdFBpbGxzKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGFkZGVkIWApOwp9Cgpjb25zdCBfTUVUQUxfQ0FUUyA9IFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJywnbWV0YWxzJywncHJlY2lvdXMnXTsKZnVuY3Rpb24gX3FhVG9nZ2xlTWV0YWxGaWVsZHMoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtZmllbGRzJyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IHNob3cgPSBxYVR5cGUgPT09ICdpbnZlc3RtZW50JyAmJiBfTUVUQUxfQ0FUUy5zb21lKG0gPT4gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhtKSk7CiAgZWwuc3R5bGUuZGlzcGxheSA9IHNob3cgPyAnYmxvY2snIDogJ25vbmUnOwogIGlmIChzaG93KSB7CiAgICAvLyBBdXRvLXNlbGVjdCBtZXRhbCB0eXBlIHRvIG1hdGNoIHRoZSBjaG9zZW4gc3ViLWNhdGVnb3J5IHBpbGwKICAgIGNvbnN0IG10ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLXR5cGUnKTsKICAgIGlmIChtdCkgewogICAgICBjb25zdCBzID0gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKTsKICAgICAgbXQudmFsdWUgPSBzLmluY2x1ZGVzKCdzaWx2ZXInKSA/ICdzaWx2ZXInIDogcy5pbmNsdWRlcygncGxhdGludW0nKSA/ICdwbGF0aW51bScgOiAnZ29sZCc7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBxYVNlbGVjdFN1YihjYXQsIGVsKSB7CiAgcWFTdWJDYXQgPSBjYXQ7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnFhLXN1Yi1waWxsJykuZm9yRWFjaChwID0+IHAuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIF9xYVRvZ2dsZU1ldGFsRmllbGRzKCk7Cn0KCmZ1bmN0aW9uIHFhUmVuZGVyTnVtcGFkKCkgewogIGNvbnN0IGtleXMgPSBbJzEnLCcyJywnMycsJzQnLCc1JywnNicsJzcnLCc4JywnOScsJy4nLCAgJzAnLCfijKsnXTsKICBjb25zdCBjbHMgICA9IFsnJywnJywnJywnJywnJywnJywnJywnJywnJywncWEtZG90JywnJywncWEtZGVsJ107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW51bXBhZCcpLmlubmVySFRNTCA9IGtleXMubWFwKChrLGkpID0+CiAgICBgPGJ1dHRvbiBjbGFzcz0icWEta2V5ICR7Y2xzW2ldfSIgb25jbGljaz0icWFOdW1wcmVzcygnJHtrfScpIj4ke2t9PC9idXR0b24+YAogICkuam9pbignJykgKyBgPGJ1dHRvbiBjbGFzcz0icWEta2V5IHFhLXNhdmUiIHN0eWxlPSJncmlkLWNvbHVtbjpzcGFuIDM7IiBvbmNsaWNrPSJxYVNhdmUoKSI+4pyFIFNhdmUgRW50cnk8L2J1dHRvbj5gOwp9CgpmdW5jdGlvbiBxYU51bXByZXNzKGtleSkgewogIGlmKGtleSA9PT0gJ+KMqycpIHsKICAgIHFhQW1vdW50U3RyID0gcWFBbW91bnRTdHIuc2xpY2UoMCwtMSk7CiAgfSBlbHNlIHsKICAgIGlmKHFhQW1vdW50U3RyLmluY2x1ZGVzKCcuJykgJiYga2V5ID09PSAnLicpIHJldHVybjsKICAgIGlmKHFhQW1vdW50U3RyLmxlbmd0aCA+PSAxMCkgcmV0dXJuOwogICAgcWFBbW91bnRTdHIgKz0ga2V5OwogIH0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtYW1vdW50LWRpc3BsYXknKS52YWx1ZSA9IHFhQW1vdW50U3RyIHx8ICcwJzsKfQoKZnVuY3Rpb24gcWFTYXZlKCkgewogIGNvbnN0IGFtb3VudCA9IHBhcnNlRmxvYXQocWFBbW91bnRTdHIpOwogIGlmKCFhbW91bnQgfHwgYW1vdW50IDw9IDApIHsgc2hvd1RvYXN0KCdFbnRlciBhbiBhbW91bnQg4p2MJyk7IHJldHVybjsgfQogIGNvbnN0IGRhdGUgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtZGF0ZS1pbnB1dCcpLnZhbHVlIHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGNvbnN0IG5vdGUgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbm90ZS1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBtb250aEtleSA9IGdldE1vbnRoS2V5KGRhdGUpIHx8IGdldEN1cnJlbnRNb250aEtleSgpOwogIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsKCiAgY29uc3QgZW50cnkgPSB7IGRhdGU6IG5vcm1hbGl6ZURhdGUoZGF0ZSksIGNhdGVnb3J5OiBxYVN1YkNhdHx8J090aGVyJywgYW1vdW50LCBkZXNjcmlwdGlvbjogbm90ZSwgY3VycmVuY3k6IGN1cnJlbnRDdXJyZW5jeS5jb2RlIH07CgogIC8vIElmIHRoaXMgaXMgYSBtZXRhbCBwdXJjaGFzZSwgYXR0YWNoIGdyYW1zIHNvIHRoZSB0cmFuc2FjdGlvbiBjYXJyaWVzIGZ1bGwgY29udGV4dAogIGNvbnN0IGlzTWV0YWwgPSBxYVR5cGUgPT09ICdpbnZlc3RtZW50JyAmJiBfTUVUQUxfQ0FUUy5zb21lKG0gPT4gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhtKSk7CiAgaWYgKGlzTWV0YWwpIHsKICAgIGNvbnN0IGdyYW1zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtZ3JhbXMnKTsKICAgIGNvbnN0IHVuaXRFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtdW5pdCcpOwogICAgY29uc3QgdHlwZUVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC10eXBlJyk7CiAgICBjb25zdCByYXdHcmFtcyA9IHBhcnNlRmxvYXQoZ3JhbXNFbD8udmFsdWUpIHx8IDA7CiAgICBjb25zdCB1bml0ICAgICA9IHVuaXRFbD8udmFsdWUgfHwgJ2cnOwogICAgY29uc3QgZ3JhbXMgICAgPSB1bml0ID09PSAnb3onID8gcmF3R3JhbXMgKiAzMS4xMDM1IDogcmF3R3JhbXM7CiAgICBpZiAoZ3JhbXMgPiAwKSB7CiAgICAgIGVudHJ5Lm1ldGFsR3JhbXMgPSBwYXJzZUZsb2F0KGdyYW1zLnRvRml4ZWQoNCkpOwogICAgICBlbnRyeS5tZXRhbFR5cGUgID0gdHlwZUVsPy52YWx1ZSB8fCAnZ29sZCc7CiAgICB9CiAgfQoKICBjb25zdCB0eXBlTWFwID0ge2V4cGVuc2U6J2V4cGVuc2VzJyxpbmNvbWU6J2luY29tZScsaW52ZXN0bWVudDonaW52ZXN0bWVudHMnLGRlYnQ6J2RlYnRzJyxnaXZlbjonZ2l2ZW5Ub090aGVycycsYWRkaXRpb25hbDonYWRkaXRpb25hbCd9OwogIGRhdGFbbW9udGhLZXldW3R5cGVNYXBbcWFUeXBlXV0ucHVzaChlbnRyeSk7CiAgc2F2ZSgpOwoKICAvLyBCdWlsZCB0b2FzdCBtZXNzYWdlCiAgbGV0IHRvYXN0TXNnID0gJ+KchSBTYXZlZCEnOwogIGlmIChpc01ldGFsICYmIGVudHJ5Lm1ldGFsR3JhbXMpIHsKICAgIGNvbnN0IG1jID0gTUVUQUxfQ09ORklHW2VudHJ5Lm1ldGFsVHlwZV0gfHwgTUVUQUxfQ09ORklHWydnb2xkJ107CiAgICB0b2FzdE1zZyA9IGAke21jLmVtb2ppfSAke2VudHJ5Lm1ldGFsR3JhbXMudG9GaXhlZCgyKX1nICR7ZW50cnkubWV0YWxUeXBlfSDCtyAke2ZtdChhbW91bnQpfSByZWNvcmRlZGA7CiAgfQoKICBxYUFtb3VudFN0ciA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1hbW91bnQtZGlzcGxheScpLnZhbHVlID0gJzAnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1ub3RlLWlucHV0JykudmFsdWUgPSAnJzsKICBjb25zdCBfbWcyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLWdyYW1zJyk7IGlmIChfbWcyKSBfbWcyLnZhbHVlID0gJyc7CiAgY29uc3QgX21mMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1maWVsZHMnKTsgaWYgKF9tZjIpIF9tZjIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBzaG93VG9hc3QodG9hc3RNc2cpOwogIGlmKG1vbnRoS2V5ID09PSB2aWV3TW9udGgpIHJlbmRlckhvbWUoKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElOVkVTVE1FTlQgUVVJQ0stQUREIE1PREFMCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApjb25zdCBJTlZfRklFTERTID0gewogICdTdG9ja3MnOiBbCiAgICB7aWQ6J2ludi10aWNrZXInLCAgbGFiZWw6J1RpY2tlciAvIE5hbWUnLCAgICB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBBQVBMLCBGWEFJWCcsIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtc2hhcmVzJywgIGxhYmVsOidTaGFyZXMnLCAgICAgICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi1hdmdjb3N0JywgbGFiZWw6J0F2ZyBDb3N0IC8gU2hhcmUnLCAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAnLCAgICAgICAgICAgICAgZnVsbDpmYWxzZSwgY2FsYzp0cnVlfSwKICAgIHtpZDonaW52LWN1cnByaWNlJyxsYWJlbDonQ3VycmVudCBQcmljZScsICAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LWJyb2tlcicsICBsYWJlbDonQnJva2VyIC8gUGxhdGZvcm0nLCB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBGaWRlbGl0eScsICAgICBmdWxsOnRydWV9LAogIF0sCiAgJ0NyeXB0byc6IFsKICAgIHtpZDonaW52LWNvaW4nLCAgICBsYWJlbDonQ29pbiAvIFRva2VuJywgICAgICB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBCVEMsIEVUSCcsICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXVuaXRzJywgICBsYWJlbDonVW5pdHMgLyBRdHknLCAgICAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMDAwMDAnLCAgICAgICAgICAgZnVsbDpmYWxzZSwgY2FsYzp0cnVlfSwKICAgIHtpZDonaW52LWJ1eXByaWNlJyxsYWJlbDonQnV5IFByaWNlIC8gVW5pdCcsICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VycHJpY2UnLGxhYmVsOidDdXJyZW50IFByaWNlJywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtZXhjaGFuZ2UnLGxhYmVsOidFeGNoYW5nZScsICAgICAgICAgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIENvaW5iYXNlJywgICAgICBmdWxsOnRydWV9LAogIF0sCiAgJ01ldGFscyc6IFsKICAgIHtpZDonaW52LW1ldGFsJywgICBsYWJlbDonTWV0YWwgVHlwZScsICAgICAgICB0eXBlOidzZWxlY3QnLCBvcHRpb25zOlsnR29sZCcsJ1NpbHZlcicsJ1BsYXRpbnVtJywnUGFsbGFkaXVtJywnT3RoZXInXSwgZnVsbDpmYWxzZX0sCiAgICB7aWQ6J2ludi11bml0JywgICAgbGFiZWw6J1VuaXQnLCAgICAgICAgICAgICAgdHlwZTonc2VsZWN0Jywgb3B0aW9uczpbJ2dyYW1zJywnb3onLCd0b2xhJ10sICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtcXR5JywgICAgIGxhYmVsOidRdWFudGl0eScsICAgICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtYXZnY29zdCcsIGxhYmVsOidBdmcgQ29zdCAvIHVuaXQnLCAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1','bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi1wdXJpdHknLCAgbGFiZWw6J1B1cml0eSAvIEZvcm0nLCAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gMjJLLCA5OTksIENvaW4nLGZ1bGw6dHJ1ZX0sCiAgXSwKICAnUmVhbCBFc3RhdGUnOiBbCiAgICB7aWQ6J2ludi1wcm9wbmFtZScsbGFiZWw6J1Byb3BlcnR5IE5hbWUnLCAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gRG93bnRvd24gQXB0JywgIGZ1bGw6dHJ1ZX0sCiAgICB7aWQ6J2ludi1jb3VudHJ5JywgbGFiZWw6J0NvdW50cnknLCAgICAgICAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gVVNBLCBJbmRpYScsICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtcHVyY2hhc2UnLGxhYmVsOidQdXJjaGFzZSBWYWx1ZScsICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VycmVudCcsIGxhYmVsOidDdXJyZW50IFZhbHVlJywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LWFyZWEnLCAgICBsYWJlbDonQXJlYSAoc3FmdC9zcW0pJywgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMCcsICAgICAgICAgICAgICAgICAgZnVsbDpmYWxzZX0sCiAgXSwKICAnRVRGL01GJzogWwogICAge2lkOidpbnYtZnVuZCcsICAgIGxhYmVsOidGdW5kIE5hbWUnLCAgICAgICAgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIFZUU0FYLCBOSUZUWTUwJyxmdWxsOnRydWV9LAogICAge2lkOidpbnYtdW5pdHMnLCAgIGxhYmVsOidVbml0cyAvIFNoYXJlcycsICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtbmF2JywgICAgIGxhYmVsOidBdmcgTkFWIC8gQnV5JywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VybmF2JywgIGxhYmVsOidDdXJyZW50IE5BVicsICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXBsYXRmb3JtJyxsYWJlbDonQnJva2VyIC8gUGxhdGZvcm0nLCB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBWYW5ndWFyZCcsICAgICAgZnVsbDp0cnVlfSwKICBdLAogICdHZW5lcmFsJzogWwogICAge2lkOidpbnYtc2NoZW1lJywgICBsYWJlbDonU2NoZW1lIC8gQWNjb3VudCBOYW1lJywgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gVlBGLCBOUFMgVGllci0xLCBGRCcsIGZ1bGw6dHJ1ZX0sCiAgICB7aWQ6J2ludi1jb250cmliJywgIGxhYmVsOidBbW91bnQgSW52ZXN0ZWQnLCAgICAgICAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAnLCAgICAgICAgICAgICAgICAgICAgIGZ1bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi10b3RhbC1hY2MnLGxhYmVsOidUb3RhbCBBY2N1bXVsYXRlZCcsICAgICAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAgKG9wdGlvbmFsKScsICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXJhdGUnLCAgICAgbGFiZWw6J0ludGVyZXN0IC8gUmV0dXJuICUnLCAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonZS5nLiA4LjI1JywgICAgICAgICAgICAgICAgZnVsbDpmYWxzZX0sCiAgICB7aWQ6J2ludi1tYXR1cml0eScsIGxhYmVsOidNYXR1cml0eSAvIFRhcmdldCcsICAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gMjAzNSBvciA1IHllYXJzJywgICAgIGZ1bGw6ZmFsc2V9LAogIF0sCn07CgpsZXQgaW52RmllbGRDdXJyZW5jeSA9IHsuLi5jdXJyZW50Q3VycmVuY3l9OwoKZnVuY3Rpb24gb3Blbkludk1vZGFsKHR5cGUpIHsKICBpbnZNb2RhbFR5cGUgPSB0eXBlIHx8ICdTdG9ja3MnOwogIGludkZpZWxkQ3VycmVuY3kgPSB7Li4uY3VycmVudEN1cnJlbmN5fTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LW1vZGFsLWRhdGUnKS52YWx1ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtbm90ZScpLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jb21wdXRlZC10b3RhbCcpLnRleHRDb250ZW50ID0gc3ltKCkrJzAnOwogIHVwZGF0ZUludkN1cnJCdG4oKTsKICAvLyBSZWJ1aWxkIHRhYnMgZnJvbSBsaXZlIGNhcmQgbGlzdAogIF9yZWJ1aWxkSW52TW9kYWxUYWJzKHR5cGUpOwogIHJlbmRlckludkZpZWxkcygpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtcXVpY2stbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7Cn0KCmZ1bmN0aW9uIF9yZWJ1aWxkSW52TW9kYWxUYWJzKGFjdGl2ZUtleSkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCkuZmlsdGVyKGM9PmMudmlzaWJsZSE9PWZhbHNlKTsKICBjb25zdCB0YWJzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXR5cGUtdGFicycpOwogIGlmKCF0YWJzRWwpIHJldHVybjsKICB0YWJzRWwuaW5uZXJIVE1MID0gY2FyZHMubWFwKGNhcmQ9PnsKICAgIGNvbnN0IGlzQWN0aXZlID0gY2FyZC5rZXkgPT09IGFjdGl2ZUtleTsKICAgIGNvbnN0IHRlbXBsYXRlID0gY2FyZC5maWVsZFRlbXBsYXRlfHwnR2VuZXJhbCc7CiAgICBjb25zdCBiZyA9IGlzQWN0aXZlID8gY2FyZC5jb2xvciA6ICcnOwogICAgY29uc3QgY29sID0gaXNBY3RpdmUgPyAnd2hpdGUnIDogJyc7CiAgICByZXR1cm4gYDxidXR0b24gY2xhc3M9Imludi10eXBlLWNoaXAgJHtpc0FjdGl2ZT8nYWN0aXZlJzonJ30iIAogICAgICBzdHlsZT0iYmFja2dyb3VuZDoke2JnfTtjb2xvcjoke2NvbH07IgogICAgICBvbmNsaWNrPSJzZXRJbnZNb2RhbFR5cGUoJyR7Y2FyZC5rZXl9JywnJHt0ZW1wbGF0ZX0nLHRoaXMsJyR7Y2FyZC5jb2xvcn0nKSIKICAgID4ke2NhcmQuaWNvbn0gJHtjYXJkLmxhYmVsfHxjYXJkLmtleX08L2J1dHRvbj5gOwogIH0pLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBzZXRJbnZNb2RhbFR5cGUoa2V5LCB0ZW1wbGF0ZSwgYnRuLCBjb2xvcikgewogIGludk1vZGFsVHlwZSA9IGtleTsKICBpbnZNb2RhbFRlbXBsYXRlID0gKHR5cGVvZiB0ZW1wbGF0ZSA9PT0gJ3N0cmluZycgPyB0ZW1wbGF0ZSA6IG51bGwpIHx8ICdHZW5lcmFsJzsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW52LXR5cGUtY2hpcCcpLmZvckVhY2goYz0+e2MuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7Yy5zdHlsZS5iYWNrZ3JvdW5kPScnO2Muc3R5bGUuY29sb3I9Jyc7fSk7CiAgaWYoYnRuICYmIGJ0bi5jbGFzc0xpc3QpIHsKICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3J8fCcjNEE5RUZGJzsKICAgIGJ0bi5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CiAgfQogIHJlbmRlckludkZpZWxkcygpOwp9CgpmdW5jdGlvbiByZW5kZXJJbnZGaWVsZHMoKSB7CiAgLy8gRGV0ZXJtaW5lIHdoaWNoIGZpZWxkIHRlbXBsYXRlIHRvIHVzZQogIGNvbnN0IGNhcmQgPSBnZXRIb21lSW52Q2FyZHMoKS5maW5kKGM9PmMua2V5PT09aW52TW9kYWxUeXBlKTsKICBjb25zdCB0ZW1wbGF0ZSA9IGNhcmQ/LmZpZWxkVGVtcGxhdGUgfHwgaW52TW9kYWxUZW1wbGF0ZSB8fCAoSU5WX0ZJRUxEU1tpbnZNb2RhbFR5cGVdID8gaW52TW9kYWxUeXBlIDogJ0dlbmVyYWwnKTsKICBjb25zdCBmaWVsZHMgPSBJTlZfRklFTERTW3RlbXBsYXRlXSB8fCBJTlZfRklFTERTWydHZW5lcmFsJ107CiAgY29uc3QgaHRtbCA9IGA8ZGl2IGNsYXNzPSJpbnYtZmllbGRzLWdyaWQiPgogICAgJHtmaWVsZHMubWFwKGY9PnsKICAgICAgY29uc3QgaW5wdXQgPSBmLnR5cGU9PT0nc2VsZWN0JwogICAgICAgID8gYDxzZWxlY3QgY2xhc3M9Imludi1maWVsZC1zZWxlY3QiIGlkPSIke2YuaWR9IiBvbmNoYW5nZT0iY2FsY0ludlRvdGFsKCkiPiR7KGYub3B0aW9uc3x8W10pLm1hcChvPT5gPG9wdGlvbj4ke299PC9vcHRpb24+YCkuam9pbignJyl9PC9zZWxlY3Q+YAogICAgICAgIDogYDxpbnB1dCB0eXBlPSIke2YudHlwZX0iIGNsYXNzPSJpbnYtZmllbGQtaW5wdXQiIGlkPSIke2YuaWR9IiBwbGFjZWhvbGRlcj0iJHtmLnBsYWNlaG9sZGVyfHwnJ30iIHN0ZXA9ImFueSIgb25pbnB1dD0iY2FsY0ludlRvdGFsKCkiPmA7CiAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaW52LWZpZWxkLWJveCR7Zi5mdWxsPycgZnVsbCc6Jyd9Ij5gKwogICAgICAgICAgICAgYDxsYWJlbD4ke2YubGFiZWx9PC9sYWJlbD4ke2lucHV0fTwvZGl2PmA7CiAgICB9KS5qb2luKCcnKX0KICA8L2Rpdj5gOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtZmllbGRzJykuaW5uZXJIVE1MID0gaHRtbDsKICBjb25zdCBoYXNDYWxjID0gZmllbGRzLnNvbWUoZj0+Zi5jYWxjKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXRvdGFsLXBpbGwnKS5zdHlsZS5kaXNwbGF5ID0gaGFzQ2FsYyA/ICcnIDogJ25vbmUnOwogIGNhbGNJbnZUb3RhbCgpOwp9CgpmdW5jdGlvbiBjYWxjSW52VG90YWwoKSB7CiAgY29uc3QgY2FyZCA9IGdldEhvbWVJbnZDYXJkcygpLmZpbmQoYz0+Yy5rZXk9PT1pbnZNb2RhbFR5cGUpOwogIGNvbnN0IHRlbXBsYXRlID0gY2FyZD8uZmllbGRUZW1wbGF0ZSB8fCBpbnZNb2RhbFRlbXBsYXRlIHx8IGludk1vZGFsVHlwZTsKICBsZXQgdG90YWwgPSAwOwogIGxldCBsYWJlbCA9ICdDb21wdXRlZCBUb3RhbCBWYWx1ZSc7CiAgY29uc3QgZyA9IGlkID0+IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpPy52YWx1ZXx8JzAnKXx8MDsKICBpZih0ZW1wbGF0ZT09PSdTdG9ja3MnKSAgICAgICB7IHRvdGFsID0gZygnaW52LXNoYXJlcycpICAqIGcoJ2ludi1hdmdjb3N0Jyk7IH0KICBlbHNlIGlmKHRlbXBsYXRlPT09J0NyeXB0bycpICB7IHRvdGFsID0gZygnaW52LXVuaXRzJykgICAqIGcoJ2ludi1idXlwcmljZScpOyB9CiAgZWxzZSBpZih0ZW1wbGF0ZT09PSdNZXRhbHMnKSAgeyB0b3RhbCA9IGcoJ2ludi1xdHknKSAgICAgKiBnKCdpbnYtYXZnY29zdCcpOyB9CiAgZWxzZSBpZih0ZW1wbGF0ZT09PSdSZWFsIEVzdGF0ZScpIHsKICAgIGNvbnN0IGN1ciA9IGcoJ2ludi1jdXJyZW50JyksIHB1ciA9IGcoJ2ludi1wdXJjaGFzZScpOwogICAgaWYoY3VyID4gMCkgeyB0b3RhbCA9IGN1cjsgbGFiZWwgPSAn8J+TiCBDdXJyZW50IE1hcmtldCBWYWx1ZSc7IH0KICAgIGVsc2UgICAgICAgIHsgdG90YWwgPSBwdXI7IGxhYmVsID0gJ/Cfj7fvuI8gUHVyY2hhc2UgVmFsdWUgKG5vIGN1cnJlbnQgZ2l2ZW4pJzsgfQogIH0KICBlbHNlIGlmKHRlbXBsYXRlPT09J0VURi9NRicpICB7IHRvdGFsID0gZygnaW52LXVuaXRzJykgICAqIGcoJ2ludi1uYXYnKTsgfQogIGVsc2UgaWYodGVtcGxhdGU9PT0nR2VuZXJhbCcpIHsgdG90YWwgPSBnKCdpbnYtY29udHJpYicpOyB9CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi10b3RhbC1waWxsLWxhYmVsJykudGV4dENvbnRlbnQgPSAn8J+SsCAnICsgbGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jb21wdXRlZC10b3RhbCcpLnRleHRDb250ZW50ID0gaW52RmllbGRDdXJyZW5jeS5zeW1ib2wrdG90YWwudG9GaXhlZCgyKTsKfQoKZnVuY3Rpb24gc2F2ZUludkVudHJ5KCkgewogIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LW1vZGFsLWRhdGUnKS52YWx1ZXx8bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylb','MF07CiAgY29uc3Qgbm90ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtbm90ZScpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBnID0gaWQgPT4gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk/LnZhbHVlfHwnMCcpfHwwOwogIGNvbnN0IHMgPSBpZCA9PiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpPy52YWx1ZXx8JycpLnRyaW0oKTsKICBjb25zdCBjYXJkID0gZ2V0SG9tZUludkNhcmRzKCkuZmluZChjPT5jLmtleT09PWludk1vZGFsVHlwZSk7CiAgY29uc3QgdGVtcGxhdGUgPSBjYXJkPy5maWVsZFRlbXBsYXRlIHx8IGludk1vZGFsVGVtcGxhdGUgfHwgKElOVl9GSUVMRFNbaW52TW9kYWxUeXBlXSA/IGludk1vZGFsVHlwZSA6ICdHZW5lcmFsJyk7CiAgbGV0IGFtb3VudD0wLCBlbnRyeT17fTsKCiAgaWYodGVtcGxhdGU9PT0nU3RvY2tzJykgewogICAgY29uc3Qgc2hhcmVzPWcoJ2ludi1zaGFyZXMnKSxhdmdjb3N0PWcoJ2ludi1hdmdjb3N0JyksY3VycHJpY2U9ZygnaW52LWN1cnByaWNlJyksdGlja2VyPXMoJ2ludi10aWNrZXInKTsKICAgIGlmKCF0aWNrZXJ8fCFzaGFyZXN8fCFhdmdjb3N0KXtzaG93VG9hc3QoJ0ZpbGwgVGlja2VyLCBTaGFyZXMgJiBDb3N0IOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9c2hhcmVzKmF2Z2Nvc3Q7CiAgICBlbnRyeT17dGlja2VyLHNoYXJlcyxhdmdDb3N0OmF2Z2Nvc3QsY3VycmVudFByaWNlOmN1cnByaWNlLGJyb2tlcjpzKCdpbnYtYnJva2VyJyl9OwogIH0gZWxzZSBpZih0ZW1wbGF0ZT09PSdDcnlwdG8nKSB7CiAgICBjb25zdCB1bml0cz1nKCdpbnYtdW5pdHMnKSxidXk9ZygnaW52LWJ1eXByaWNlJyksY29pbj1zKCdpbnYtY29pbicpOwogICAgaWYoIWNvaW58fCF1bml0c3x8IWJ1eSl7c2hvd1RvYXN0KCdGaWxsIENvaW4sIFVuaXRzICYgQnV5IFByaWNlIOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9dW5pdHMqYnV5OwogICAgZW50cnk9e2NvaW4sdW5pdHMsYnV5UHJpY2U6YnV5LGN1cnJlbnRQcmljZTpnKCdpbnYtY3VycHJpY2UnKSxleGNoYW5nZTpzKCdpbnYtZXhjaGFuZ2UnKX07CiAgfSBlbHNlIGlmKHRlbXBsYXRlPT09J01ldGFscycpIHsKICAgIGNvbnN0IHF0eT1nKCdpbnYtcXR5JyksY29zdD1nKCdpbnYtYXZnY29zdCcpOwogICAgaWYoIXF0eXx8IWNvc3Qpe3Nob3dUb2FzdCgnRmlsbCBRdWFudGl0eSAmIEF2ZyBDb3N0IOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9cXR5KmNvc3Q7CiAgICBjb25zdCBtZXRhbD1zKCdpbnYtbWV0YWwnKXx8J0dvbGQnLCB1bml0PXMoJ2ludi11bml0Jyl8fCdncmFtcyc7CiAgICBlbnRyeT17bWV0YWwscXR5LHVuaXQsYXZnQ29zdFBlclVuaXQ6Y29zdCxwdXJpdHk6cygnaW52LXB1cml0eScpfTsKICAgIGlmKCFkYXRhLl9tZXRhbHMpIGRhdGEuX21ldGFscz1bXTsKICAgIGRhdGEuX21ldGFscy5wdXNoKHttZXRhbFR5cGU6bWV0YWwudG9Mb3dlckNhc2UoKSxuYW1lOm1ldGFsLGdyYW1zOnVuaXQ9PT0nb3onP3F0eSozMS4xMDM1OnF0eSxwcmljZTpjb3N0LGRhdGUsZm9ybTonQmFyJyxub3Rlczpub3RlLHB1cml0eTpzKCdpbnYtcHVyaXR5Jyl9KTsKICB9IGVsc2UgaWYodGVtcGxhdGU9PT0nUmVhbCBFc3RhdGUnKSB7CiAgICBjb25zdCBwdj1nKCdpbnYtcHVyY2hhc2UnKTsKICAgIGlmKCFwdil7c2hvd1RvYXN0KCdFbnRlciBQdXJjaGFzZSBWYWx1ZSDinYwnKTtyZXR1cm47fQogICAgY29uc3QgY3Y9ZygnaW52LWN1cnJlbnQnKTsKICAgIGFtb3VudCA9IGN2ID4gMCA/IGN2IDogcHY7ICAgLy8gcHJlZmVyIGN1cnJlbnQgbWFya2V0IHZhbHVlLCBmYWxsYmFjayB0byBwdXJjaGFzZQogICAgZW50cnk9e3Byb3BlcnR5TmFtZTpzKCdpbnYtcHJvcG5hbWUnKSxjb3VudHJ5OnMoJ2ludi1jb3VudHJ5JykscHVyY2hhc2VWYWx1ZTpwdixjdXJyZW50VmFsdWU6Y3Z8fHB2LGFyZWE6ZygnaW52LWFyZWEnKX07CiAgfSBlbHNlIGlmKHRlbXBsYXRlPT09J0VURi9NRicpIHsKICAgIGNvbnN0IHVuaXRzPWcoJ2ludi11bml0cycpLG5hdj1nKCdpbnYtbmF2Jyk7CiAgICBpZighdW5pdHN8fCFuYXYpe3Nob3dUb2FzdCgnRmlsbCBVbml0cyAmIE5BViDinYwnKTtyZXR1cm47fQogICAgYW1vdW50PXVuaXRzKm5hdjsKICAgIGVudHJ5PXtmdW5kTmFtZTpzKCdpbnYtZnVuZCcpLHVuaXRzLGF2Z05BVjpuYXYsY3VycmVudE5BVjpnKCdpbnYtY3VybmF2JykscGxhdGZvcm06cygnaW52LXBsYXRmb3JtJyl9OwogIH0gZWxzZSB7CiAgICAvLyBHZW5lcmFsIHRlbXBsYXRlIChQRi9WUEYsIE5QUywgUFBGLCBGRCwgSW5zdXJhbmNlLCBjdXN0b20pCiAgICBjb25zdCBjb250cmliPWcoJ2ludi1jb250cmliJyk7CiAgICBpZighY29udHJpYil7c2hvd1RvYXN0KCdFbnRlciB0aGUgYW1vdW50IGludmVzdGVkIOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9Y29udHJpYjsKICAgIGVudHJ5PXtzY2hlbWU6cygnaW52LXNjaGVtZScpLHRvdGFsQWNjdW11bGF0ZWQ6ZygnaW52LXRvdGFsLWFjYycpLHJhdGU6ZygnaW52LXJhdGUnKSxtYXR1cml0eTpzKCdpbnYtbWF0dXJpdHknKX07CiAgfQoKICBjb25zdCBtb250aEtleSA9IGdldE1vbnRoS2V5KGRhdGUpfHxnZXRDdXJyZW50TW9udGhLZXkoKTsKICBlbnN1cmVNb250aChtb250aEtleSk7CiAgZGF0YVttb250aEtleV0uaW52ZXN0bWVudHMucHVzaCh7CiAgICBkYXRlOm5vcm1hbGl6ZURhdGUoZGF0ZSksIGNhdGVnb3J5Omludk1vZGFsVHlwZSwgaW52ZXN0VHlwZTppbnZNb2RhbFR5cGUsCiAgICBhbW91bnQsIGRlc2NyaXB0aW9uOm5vdGV8fHMoJ2ludi1zY2hlbWUnKXx8cygnaW52LXRpY2tlcicpfHxzKCdpbnYtZnVuZCcpfHxzKCdpbnYtY29pbicpfHwnJywKICAgIGN1cnJlbmN5OmludkZpZWxkQ3VycmVuY3kuY29kZSwgLi4uZW50cnkKICB9KTsKICBzYXZlKCk7IGNsb3NlTW9kYWwoJ2ludi1xdWljay1tb2RhbCcpOyByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgJHtjYXJkPy5sYWJlbHx8aW52TW9kYWxUeXBlfSBlbnRyeSBzYXZlZCFgKTsKfQoKZnVuY3Rpb24gdXBkYXRlSW52Q3VyckJ0bigpIHsKICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWN1cnItYnRuJyk7CiAgaWYoIWJ0bikgcmV0dXJuOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY3Vyci1mbGFnJykudGV4dENvbnRlbnQgPSBpbnZGaWVsZEN1cnJlbmN5LmZsYWd8fCfwn4yNJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWN1cnItbGFiZWwnKS50ZXh0Q29udGVudCA9IGAke2ludkZpZWxkQ3VycmVuY3kuY29kZX0g4oCUICR7aW52RmllbGRDdXJyZW5jeS5zeW1ib2x9YDsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENVUlJFTkNZIFBJQ0tFUgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKY29uc3QgQ1VSUkVOQ0lFUyA9IFsKICB7Y29kZTonVVNEJyxzeW1ib2w6JyQnLCAgbmFtZTonVVMgRG9sbGFyJywgICAgICAgZmxhZzon8J+HuvCfh7gnLGNvdW50cnk6J1VuaXRlZCBTdGF0ZXMnfSwKICB7Y29kZTonRVVSJyxzeW1ib2w6J+KCrCcsICBuYW1lOidFdXJvJywgICAgICAgICAgICAgZmxhZzon8J+HqvCfh7onLGNvdW50cnk6J0V1cm9wZSd9LAogIHtjb2RlOidHQlAnLHN5bWJvbDonwqMnLCAgbmFtZTonQnJpdGlzaCBQb3VuZCcsICAgIGZsYWc6J/Cfh6zwn4enJyxjb3VudHJ5OidVbml0ZWQgS2luZ2RvbSd9LAogIHtjb2RlOidJTlInLHN5bWJvbDon4oK5JywgIG5hbWU6J0luZGlhbiBSdXBlZScsICAgICBmbGFnOifwn4eu8J+HsycsY291bnRyeTonSW5kaWEnfSwKICB7Y29kZTonQUVEJyxzeW1ib2w6J9ivLtilJyxuYW1lOidVQUUgRGlyaGFtJywgICAgICAgZmxhZzon8J+HpvCfh6onLGNvdW50cnk6J1VBRSd9LAogIHtjb2RlOidTQVInLHN5bWJvbDon77e8JywgIG5hbWU6J1NhdWRpIFJpeWFsJywgICAgICBmbGFnOifwn4e48J+HpicsY291bnRyeTonU2F1ZGkgQXJhYmlhJ30sCiAge2NvZGU6J0NBRCcsc3ltYm9sOidDJCcsIG5hbWU6J0NhbmFkaWFuIERvbGxhcicsICBmbGFnOifwn4eo8J+HpicsY291bnRyeTonQ2FuYWRhJ30sCiAge2NvZGU6J0FVRCcsc3ltYm9sOidBJCcsIG5hbWU6J0F1c3RyYWxpYW4gRG9sbGFyJyxmbGFnOifwn4em8J+HuicsY291bnRyeTonQXVzdHJhbGlhJ30sCiAge2NvZGU6J0pQWScsc3ltYm9sOifCpScsICBuYW1lOidKYXBhbmVzZSBZZW4nLCAgICAgZmxhZzon8J+Hr/Cfh7UnLGNvdW50cnk6J0phcGFuJ30sCiAge2NvZGU6J0NOWScsc3ltYm9sOifCpScsICBuYW1lOidDaGluZXNlIFl1YW4nLCAgICAgZmxhZzon8J+HqPCfh7MnLGNvdW50cnk6J0NoaW5hJ30sCiAge2NvZGU6J1NHRCcsc3ltYm9sOidTJCcsIG5hbWU6J1NpbmdhcG9yZSBEb2xsYXInLCBmbGFnOifwn4e48J+HrCcsY291bnRyeTonU2luZ2Fwb3JlJ30sCiAge2NvZGU6J0NIRicsc3ltYm9sOidGcicsIG5hbWU6J1N3aXNzIEZyYW5jJywgICAgICBmbGFnOifwn4eo8J+HrScsY291bnRyeTonU3dpdHplcmxhbmQnfSwKICB7Y29kZTonTVlSJyxzeW1ib2w6J1JNJywgbmFtZTonTWFsYXlzaWFuIFJpbmdnaXQnLGZsYWc6J/Cfh7Lwn4e+Jyxjb3VudHJ5OidNYWxheXNpYSd9LAogIHtjb2RlOidIS0QnLHN5bWJvbDonSEskJyxuYW1lOidIb25nIEtvbmcgRG9sbGFyJywgZmxhZzon8J+HrfCfh7AnLGNvdW50cnk6J0hvbmcgS29uZyd9LAogIHtjb2RlOidOWkQnLHN5bWJvbDonTlokJyxuYW1lOidOZXcgWmVhbGFuZCBEb2xsYXInLGZsYWc6J/Cfh7Pwn4e/Jyxjb3VudHJ5OidOZXcgWmVhbGFuZCd9LAogIHtjb2RlOidLV0QnLHN5bWJvbDonS0QnLCBuYW1lOidLdXdhaXRpIERpbmFyJywgICAgZmxhZzon8J+HsPCfh7wnLGNvdW50cnk6J0t1d2FpdCd9LAogIHtjb2RlOidRQVInLHN5bWJvbDonUVInLCBuYW1lOidRYXRhcmkgUml5YWwnLCAgICAgZmxhZzon8J+HtvCfh6YnLGNvdW50cnk6J1FhdGFyJ30sCiAge2NvZGU6J09NUicsc3ltYm9sOifYsS7YuS4nLG5hbWU6J09tYW5pIFJpYWwnLCAgICAgIGZsYWc6J/Cfh7Twn4eyJyxjb3VudHJ5OidPbWFuJ30sCiAge2NvZGU6J1BLUicsc3ltYm9sOifigqgnLCAgbmFtZTonUGFraXN0YW5pIFJ1cGVlJywgIGZsYWc6J/Cfh7Xwn4ewJyxjb3VudHJ5OidQYWtpc3Rhbid9LAogIHtjb2RlOidCRFQnLHN5bWJvbDon4KezJywgIG5hbWU6J0JhbmdsYWRlc2hpIFRha2EnLCBmbGFnOifwn4en8J+HqScsY291bnRyeTonQmFuZ2xhZGVzaCd9LAogIHtjb2RlOidMS1InLHN5bWJvbDon4oKoJywgIG5hbWU6J1NyaSBMYW5rYW4gUnVwZWUnLCBmbGFnOifwn4ex8J+HsCcsY291bnRyeTonU3JpIExhbmthJ30sCiAge2NvZGU6J05QUicsc3ltYm9sOifigqgnLCAgbmFtZTonTmVwYWxlc2UgUnVwZWUnLCAgIGZsYWc6J/Cfh7Pwn4e1Jyxjb3VudHJ5OidOZXBhbCd9LAogIHtjb2RlOidNWE4nLHN5bWJvbDonJCcsICBuYW1lOidNZXhpY2FuIFBlc28nLCAgICAgZmxhZzon8J+HsvCfh70nLGNvdW50cnk6J01leGljbyd9LAogIHtjb2RlOidCUkwnLHN5bWJvbDonUiQnLCBuYW1lOidCcmF6aWxpYW4gUmVhbCcsICAgZmxhZzon8J+Hp/Cfh7cnLGNvdW50cnk6J0JyYXppbCd9LAogIHtjb2RlOidaQVInLHN5bWJvbDonUicsICBuYW1lOidTb3V0aCBBZnJpY2FuIFJhbmQnLGZsYWc6J/Cfh7/wn4emJyxjb3VudHJ5OidTb3V0aCBBZnJpY2EnfSwKICB7Y29kZTonTkdOJyxzeW1ib2w6J+KCpicsICBuYW1lOidOaWdl','cmlhbiBOYWlyYScsICAgZmxhZzon8J+Hs/Cfh6wnLGNvdW50cnk6J05pZ2VyaWEnfSwKICB7Y29kZTonS0VTJyxzeW1ib2w6J0tTaCcsbmFtZTonS2VueWFuIFNoaWxsaW5nJywgIGZsYWc6J/Cfh7Dwn4eqJyxjb3VudHJ5OidLZW55YSd9LAogIHtjb2RlOidFR1AnLHN5bWJvbDonRcKjJywgbmFtZTonRWd5cHRpYW4gUG91bmQnLCAgIGZsYWc6J/Cfh6rwn4esJyxjb3VudHJ5OidFZ3lwdCd9LAogIHtjb2RlOidUUlknLHN5bWJvbDon4oK6JywgIG5hbWU6J1R1cmtpc2ggTGlyYScsICAgICBmbGFnOifwn4e58J+HtycsY291bnRyeTonVHVya2V5J30sCiAge2NvZGU6J1JVQicsc3ltYm9sOifigr0nLCAgbmFtZTonUnVzc2lhbiBSdWJsZScsICAgIGZsYWc6J/Cfh7fwn4e6Jyxjb3VudHJ5OidSdXNzaWEnfSwKICB7Y29kZTonU0VLJyxzeW1ib2w6J2tyJywgbmFtZTonU3dlZGlzaCBLcm9uYScsICAgIGZsYWc6J/Cfh7jwn4eqJyxjb3VudHJ5OidTd2VkZW4nfSwKICB7Y29kZTonTk9LJyxzeW1ib2w6J2tyJywgbmFtZTonTm9yd2VnaWFuIEtyb25lJywgIGZsYWc6J/Cfh7Pwn4e0Jyxjb3VudHJ5OidOb3J3YXknfSwKICB7Y29kZTonREtLJyxzeW1ib2w6J2tyJywgbmFtZTonRGFuaXNoIEtyb25lJywgICAgIGZsYWc6J/Cfh6nwn4ewJyxjb3VudHJ5OidEZW5tYXJrJ30sCiAge2NvZGU6J0lEUicsc3ltYm9sOidScCcsIG5hbWU6J0luZG9uZXNpYW4gUnVwaWFoJyxmbGFnOifwn4eu8J+HqScsY291bnRyeTonSW5kb25lc2lhJ30sCiAge2NvZGU6J1BIUCcsc3ltYm9sOifigrEnLCAgbmFtZTonUGhpbGlwcGluZSBQZXNvJywgIGZsYWc6J/Cfh7Xwn4etJyxjb3VudHJ5OidQaGlsaXBwaW5lcyd9LAogIHtjb2RlOidUSEInLHN5bWJvbDon4Li/JywgIG5hbWU6J1RoYWkgQmFodCcsICAgICAgICBmbGFnOifwn4e58J+HrScsY291bnRyeTonVGhhaWxhbmQnfSwKICB7Y29kZTonVk5EJyxzeW1ib2w6J+KCqycsICBuYW1lOidWaWV0bmFtZXNlIERvbmcnLCAgZmxhZzon8J+Hu/Cfh7MnLGNvdW50cnk6J1ZpZXRuYW0nfSwKICB7Y29kZTonS1JXJyxzeW1ib2w6J+KCqScsICBuYW1lOidTb3V0aCBLb3JlYW4gV29uJywgZmxhZzon8J+HsPCfh7cnLGNvdW50cnk6J1NvdXRoIEtvcmVhJ30sCl07CgpmdW5jdGlvbiBvcGVuQ3VycmVuY3lQaWNrZXIoY29udGV4dCkgewogIGludkN1cnJlbmN5VGFyZ2V0ID0gY29udGV4dDsKICBmaWx0ZXJDdXJyZW5jaWVzKCcnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vyci1zZWFyY2gtaW5wdXQnKS52YWx1ZSA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW5jeS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKfQoKZnVuY3Rpb24gZmlsdGVyQ3VycmVuY2llcyhxdWVyeSkgewogIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IGZpbHRlcmVkID0gcSA/IENVUlJFTkNJRVMuZmlsdGVyKGM9PmMubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpfHxjLmNvZGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKXx8Yy5jb3VudHJ5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocSkpIDogQ1VSUkVOQ0lFUzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vyci1saXN0JykuaW5uZXJIVE1MID0gZmlsdGVyZWQubWFwKGM9PmAKICAgIDxkaXYgY2xhc3M9ImN1cnItaXRlbSAke2MuY29kZT09PWN1cnJlbnRDdXJyZW5jeS5jb2RlPydhY3RpdmUnOicnfSIgb25jbGljaz0ic2VsZWN0Q3VycmVuY3koJyR7Yy5jb2RlfScpIj4KICAgICAgPHNwYW4gY2xhc3M9ImN1cnItZmxhZyI+JHtjLmZsYWd9PC9zcGFuPgogICAgICA8ZGl2IGNsYXNzPSJjdXJyLWluZm8iPgogICAgICAgIDxkaXYgY2xhc3M9ImN1cnItbmFtZSI+JHtjLm5hbWV9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY3Vyci1jb3VudHJ5Ij4ke2MuY291bnRyeX08L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxzcGFuIGNsYXNzPSJjdXJyLWNvZGUiPiR7Yy5jb2RlfTwvc3Bhbj4KICAgICAgPHNwYW4gY2xhc3M9ImN1cnItc3ltYm9sIj4ke2Muc3ltYm9sfTwvc3Bhbj4KICAgIDwvZGl2PmApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBzZWxlY3RDdXJyZW5jeShjb2RlKSB7CiAgY29uc3QgYyA9IENVUlJFTkNJRVMuZmluZCh4PT54LmNvZGU9PT1jb2RlKTsKICBpZighYykgcmV0dXJuOwogIGlmKGludkN1cnJlbmN5VGFyZ2V0PT09J2ludicpIHsKICAgIGludkZpZWxkQ3VycmVuY3kgPSBjOwogICAgdXBkYXRlSW52Q3VyckJ0bigpOwogICAgY2FsY0ludlRvdGFsKCk7CiAgfSBlbHNlIHsKICAgIHNhdmVDdXJyZW5jeShjKTsKICAgIHJlbmRlckhvbWUoKTsgcmVuZGVyU2V0dGluZ3MoKTsKICB9CiAgY2xvc2VNb2RhbCgnY3VycmVuY3ktbW9kYWwnKTsKICBzaG93VG9hc3QoYCR7Yy5mbGFnfSBDdXJyZW5jeSBzZXQgdG8gJHtjLmNvZGV9YCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBGWCBSQVRFIE9WRVJSSURFIE1PRFVMRQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCi8vIFNjYW4gYWxsIGRhdGEgdG8gZmluZCBldmVyeSBjdXJyZW5jeSBjb2RlIGFjdHVhbGx5IGluIHVzZQpmdW5jdGlvbiBnZXRBY3RpdmVDdXJyZW5jaWVzKCkgewogIGNvbnN0IGZvdW5kID0gbmV3IFNldCgpOwogIC8vIE5XIGFjY291bnRzCiAgKGRhdGEuX253QWNjb3VudHMgfHwgW10pLmZvckVhY2goYSA9PiB7IGlmIChhLmN1cnJlbmN5KSBmb3VuZC5hZGQoYS5jdXJyZW5jeS50b1VwcGVyQ2FzZSgpKTsgfSk7CiAgLy8gTWV0YWxzCiAgKGRhdGEuX21ldGFscyB8fCBbXSkuZm9yRWFjaChtID0+IHsgaWYgKG0uY3VycmVuY3kpIGZvdW5kLmFkZChtLmN1cnJlbmN5LnRvVXBwZXJDYXNlKCkpOyB9KTsKICAvLyBSZWFsIGVzdGF0ZQogIChkYXRhLl9yZWFsRXN0YXRlIHx8IFtdKS5mb3JFYWNoKHAgPT4geyBpZiAocC5jdXJyZW5jeSkgZm91bmQuYWRkKHAuY3VycmVuY3kudG9VcHBlckNhc2UoKSk7IH0pOwogIC8vIE1vbnRobHkgdHJhbnNhY3Rpb25zCiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXkgPT4gewogICAgaWYgKCEvXlxkezR9LVxkezJ9JC8udGVzdChrZXkpKSByZXR1cm47CiAgICBjb25zdCBtbyA9IGRhdGFba2V5XTsKICAgIFsnaW5jb21lJywnZXhwZW5zZXMnLCdpbnZlc3RtZW50cycsJ2FkZGl0aW9uYWwnLCdtZXRhbHMnLCdkZWJ0cyddLmZvckVhY2goY2F0ID0+IHsKICAgICAgKG1vW2NhdF0gfHwgW10pLmZvckVhY2goZSA9PiB7IGlmIChlLmN1cnJlbmN5KSBmb3VuZC5hZGQoZS5jdXJyZW5jeS50b1VwcGVyQ2FzZSgpKTsgfSk7CiAgICB9KTsKICAgIChtby5yZWFsRXN0YXRlIHx8IFtdKS5mb3JFYWNoKGUgPT4geyBpZiAoZS5jdXJyZW5jeSkgZm91bmQuYWRkKGUuY3VycmVuY3kudG9VcHBlckNhc2UoKSk7IH0pOwogIH0pOwogIC8vIEFsd2F5cyByZW1vdmUgZGlzcGxheSBjdXJyZW5jeSDigJQgbm8gY29udmVyc2lvbiBuZWVkZWQgZm9yIHRoYXQKICBmb3VuZC5kZWxldGUoY3VycmVudEN1cnJlbmN5LmNvZGUudG9VcHBlckNhc2UoKSk7CiAgLy8gQWRkIGRpc3BsYXkgY3VycmVuY3kncyBvd24gcmF0ZSBlbnRyeSBvbmx5IGlmIGl0J3Mgbm90IFVTRCAoc28gdXNlciBjYW4gc2VlIGl0KQogIHJldHVybiBbLi4uZm91bmRdLnNvcnQoKTsKfQoKZnVuY3Rpb24gcmVuZGVyRlhSYXRlc1BhbmVsKCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LXJhdGVzLWxpc3QnKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fZnhPdmVycmlkZXMgfHwge307CiAgY29uc3QgZGlzcGxheUNvZGUgPSBjdXJyZW50Q3VycmVuY3kuY29kZS50b1VwcGVyQ2FzZSgpOwogIGNvbnN0IGFjdGl2ZUN1cnJlbmNpZXMgPSBnZXRBY3RpdmVDdXJyZW5jaWVzKCk7CgogIC8vIFVwZGF0ZSBiYXNlIGxhYmVsIGFuZCBiYWRnZQogIGNvbnN0IGJhc2VMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmeC1iYXNlLWxhYmVsJyk7CiAgaWYgKGJhc2VMYWJlbCkgYmFzZUxhYmVsLnRleHRDb250ZW50ID0gZGlzcGxheUNvZGU7CiAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZngtb3ZlcnJpZGUtYmFkZ2UnKTsKICBpZiAoYmFkZ2UpIGJhZGdlLnN0eWxlLmRpc3BsYXkgPSBPYmplY3Qua2V5cyhvdmVycmlkZXMpLmxlbmd0aCA+IDAgPyAnJyA6ICdub25lJzsKCiAgaWYgKGFjdGl2ZUN1cnJlbmNpZXMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuODJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxNnB4OyI+CiAgICAgIE5vIGZvcmVpZ24tY3VycmVuY3kgZGF0YSBmb3VuZCB5ZXQuIEFkZCBhc3NldHMgb3IgdHJhbnNhY3Rpb25zIGluIG90aGVyIGN1cnJlbmNpZXMgYW5kIHRoZXknbGwgYXBwZWFyIGhlcmUuCiAgICA8L2Rpdj5gOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3Qgcm93cyA9IGFjdGl2ZUN1cnJlbmNpZXMubWFwKGNvZGUgPT4gewogICAgY29uc3QgYnVpbHRJbiA9IEZYX1VTRF9CQVNFW2NvZGVdOwogICAgY29uc3Qgb3ZlcnJpZGUgPSBvdmVycmlkZXNbY29kZV07CiAgICBjb25zdCBlZmZlY3RpdmUgPSBvdmVycmlkZSAhPT0gdW5kZWZpbmVkID8gb3ZlcnJpZGUgOiAoYnVpbHRJbiB8fCBudWxsKTsKICAgIC8vIFJhdGUgc2hvd24gYXMgIjEgVVNEID0gWCBmb3JlaWduIiDigJQgY29udmVydCB0byAiMSBmb3JlaWduID0gWSBkaXNwbGF5Q3VycmVuY3kiIGZvciBpbnR1aXRpdmUgcmVhZGluZwogICAgY29uc3QgZGlzcGxheVJhdGUgPSBGWF9VU0RfQkFTRVtkaXNwbGF5Q29kZV0gfHwgMTsKICAgIGNvbnN0IGVmZmVjdGl2ZURpc3BsYXkgPSBlZmZlY3RpdmUgPyAoZGlzcGxheVJhdGUgLyBlZmZlY3RpdmUpIDogbnVsbDsKICAgIGNvbnN0IGJ1aWx0SW5EaXNwbGF5ICA9IGJ1aWx0SW4gICA/IChkaXNwbGF5UmF0ZSAvIGJ1aWx0SW4pICAgOiBudWxsOwogICAgY29uc3QgaGFzT3ZlcnJpZGUgPSBvdmVycmlkZSAhPT0gdW5kZWZpbmVkOwogICAgY29uc3QgdW5rbm93blJhdGUgPSBlZmZlY3RpdmUgPT09IG51bGw7CiAgICBjb25zdCBjSW5mbyA9IENVUlJFTkNJRVMuZmluZChjID0+IGMuY29kZSA9PT0gY29kZSkgfHwgeyBmbGFnOiAn8J+MkCcsIG5hbWU6IGNvZGUgfTsKCiAgICByZXR1cm4gYDxkaXYgc3R5bGU9ImJvcmRlci1ib3R0b206MXB4IHNvbGlkICNGNUY1RjU7cGFkZGluZzoxMHB4IDA7IiBpZD0iZngtcm93LSR7Y29kZX0iPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2dhcDo4cHg7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7ZmxleDoxO21pbi13aWR0aDowOyI+CiAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEuMmVtOyI+JHtjSW5mby5mbGFnfHwn8J+MkCd9PC9zcGFuPgogICAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg4ZW07Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTsiPiR7Y29kZX0KICAgICAgICAgICAgICAke2hhc092ZXJyaWRlID8gYDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEZGRjQ7Y29sb3I6IzEwQjk4MTtmb250','LXNpemU6MC43ZW07Ym9yZGVyLXJhZGl1czo2cHg7cGFkZGluZzoxcHggNnB4O21hcmdpbi1sZWZ0OjRweDsiPuKcj++4jyBDdXN0b208L3NwYW4+YCA6ICcnfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7Ij4ke2NJbmZvLm5hbWV8fCcnfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtmbGV4LXNocmluazowOyI+CiAgICAgICAgICAke3Vua25vd25SYXRlCiAgICAgICAgICAgID8gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Y29sb3I6I0VGNDQ0NDtmb250LXdlaWdodDo3MDA7Ij5SYXRlIHVua25vd248L2Rpdj5gCiAgICAgICAgICAgIDogYDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45MmVtO2NvbG9yOnZhcigtLXByaW1hcnkpOyI+MSAke2NvZGV9ID0gJHtlZmZlY3RpdmVEaXNwbGF5LnRvRml4ZWQoNCl9ICR7ZGlzcGxheUNvZGV9PC9kaXY+CiAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NjAwOyI+MSBVU0QgPSAke2VmZmVjdGl2ZS50b0ZpeGVkKDQpfSAke2NvZGV9PC9kaXY+YAogICAgICAgICAgfQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NHB4O2ZsZXgtc2hyaW5rOjA7Ij4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0ib3BlbkZYT3ZlcnJpZGUoJyR7Y29kZX0nKSIKICAgICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjRweCA5cHg7Zm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Y3Vyc29yOnBvaW50ZXI7Ij7inI/vuI8gU2V0PC9idXR0b24+CiAgICAgICAgICAke2hhc092ZXJyaWRlID8gYDxidXR0b24gb25jbGljaz0icmVzZXRGWE92ZXJyaWRlKCcke2NvZGV9JykiCiAgICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo0cHggOHB4O2ZvbnQtc2l6ZTowLjcyZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOiNFRjQ0NDQ7Y3Vyc29yOnBvaW50ZXI7Ij7inJU8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8IS0tIElubGluZSBlZGl0IHBhbmVsIChoaWRkZW4gYnkgZGVmYXVsdCkgLS0+CiAgICAgIDxkaXYgaWQ9ImZ4LWVkaXQtJHtjb2RlfSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjhweDtiYWNrZ3JvdW5kOiNGOEY4Rjg7Ym9yZGVyLXJhZGl1czo5cHg7cGFkZGluZzoxMHB4IDEycHg7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO21hcmdpbi1ib3R0b206NnB4OyI+U2V0IHJhdGUgZm9yICR7Y29kZX06PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo2cHg7bWFyZ2luLWJvdHRvbTo2cHg7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MTsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC42OGVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjcwMDttYXJnaW4tYm90dG9tOjNweDsiPjEgVVNEID0gPyAke2NvZGV9PC9kaXY+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJmeC1pbnB1dC11c2QtJHtjb2RlfSIgc3RlcD0iMC4wMDAxIiBwbGFjZWhvbGRlcj0iJHtlZmZlY3RpdmUgPyBlZmZlY3RpdmUudG9GaXhlZCg0KSA6ICdlLmcuIDgzLjUnfSIKICAgICAgICAgICAgICBzdHlsZT0id2lkdGg6MTAwJTtib3JkZXI6MS41cHggc29saWQgI0RERDtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjZweCA4cHg7Zm9udC1zaXplOjAuODhlbTtmb250LXdlaWdodDo3MDA7IgogICAgICAgICAgICAgIG9uaW5wdXQ9InN5bmNGWElucHV0cygnJHtjb2RlfScsJ3VzZCcpIgogICAgICAgICAgICAgIHZhbHVlPSIke2VmZmVjdGl2ZSA/IGVmZmVjdGl2ZS50b0ZpeGVkKDQpIDogJyd9Ij4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxOyI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi1ib3R0b206M3B4OyI+MSAke2NvZGV9ID0gPyAke2Rpc3BsYXlDb2RlfTwvZGl2PgogICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iZngtaW5wdXQtZGlzcC0ke2NvZGV9IiBzdGVwPSIwLjAwMDEiIHBsYWNlaG9sZGVyPSIke2VmZmVjdGl2ZURpc3BsYXkgPyBlZmZlY3RpdmVEaXNwbGF5LnRvRml4ZWQoNCkgOiAnJ30iCiAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOjEwMCU7Ym9yZGVyOjEuNXB4IHNvbGlkICNEREQ7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo2cHggOHB4O2ZvbnQtc2l6ZTowLjg4ZW07Zm9udC13ZWlnaHQ6NzAwOyIKICAgICAgICAgICAgICBvbmlucHV0PSJzeW5jRlhJbnB1dHMoJyR7Y29kZX0nLCdkaXNwJykiCiAgICAgICAgICAgICAgdmFsdWU9IiR7ZWZmZWN0aXZlRGlzcGxheSA/IGVmZmVjdGl2ZURpc3BsYXkudG9GaXhlZCg0KSA6ICcnfSI+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICAke2J1aWx0SW4gPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tYm90dG9tOjZweDsiPkJ1aWx0LWluIGRlZmF1bHQ6IDEgVVNEID0gJHtidWlsdElufSAke2NvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4OyI+CiAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImFwcGx5RlhPdmVycmlkZSgnJHtjb2RlfScpIgogICAgICAgICAgICBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6IzEwQjk4MTtjb2xvcjp3aGl0ZTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjdweDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODJlbTtjdXJzb3I6cG9pbnRlcjsiPuKckyBBcHBseTwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjbG9zZUZYRWRpdCgnJHtjb2RlfScpIgogICAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDojRUVFO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6N3B4IDEycHg7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKCiAgZWwuaW5uZXJIVE1MID0gcm93cyB8fCBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuODJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxNnB4OyI+Tm8gZm9yZWlnbiBjdXJyZW5jaWVzIGluIHVzZSB5ZXQuPC9kaXY+YDsKfQoKZnVuY3Rpb24gb3BlbkZYT3ZlcnJpZGUoY29kZSkgewogIC8vIENsb3NlIGFueSBvdGhlciBvcGVuIHBhbmVscyBmaXJzdAogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tpZF49ImZ4LWVkaXQtIl0nKS5mb3JFYWNoKHAgPT4gcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKTsKICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmeC1lZGl0LScgKyBjb2RlKTsKICBpZiAocGFuZWwpIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnJzsKfQoKZnVuY3Rpb24gY2xvc2VGWEVkaXQoY29kZSkgewogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWVkaXQtJyArIGNvZGUpOwogIGlmIChwYW5lbCkgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gc3luY0ZYSW5wdXRzKGNvZGUsIGNoYW5nZWQpIHsKICBjb25zdCBkaXNwQ29kZSA9IGN1cnJlbnRDdXJyZW5jeS5jb2RlLnRvVXBwZXJDYXNlKCk7CiAgY29uc3QgZGlzcFJhdGUgPSBGWF9VU0RfQkFTRVtkaXNwQ29kZV0gfHwgMTsKICBjb25zdCB1c2RJbnB1dCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZngtaW5wdXQtdXNkLScgICsgY29kZSk7CiAgY29uc3QgZGlzcElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWlucHV0LWRpc3AtJyArIGNvZGUpOwogIGlmICghdXNkSW5wdXQgfHwgIWRpc3BJbnB1dCkgcmV0dXJuOwogIGlmIChjaGFuZ2VkID09PSAndXNkJykgewogICAgY29uc3QgdXNkVmFsID0gcGFyc2VGbG9hdCh1c2RJbnB1dC52YWx1ZSk7CiAgICBpZiAodXNkVmFsID4gMCkgZGlzcElucHV0LnZhbHVlID0gKGRpc3BSYXRlIC8gdXNkVmFsKS50b0ZpeGVkKDYpOwogIH0gZWxzZSB7CiAgICBjb25zdCBkaXNwVmFsID0gcGFyc2VGbG9hdChkaXNwSW5wdXQudmFsdWUpOwogICAgaWYgKGRpc3BWYWwgPiAwKSB1c2RJbnB1dC52YWx1ZSA9IChkaXNwUmF0ZSAvIGRpc3BWYWwpLnRvRml4ZWQoNik7CiAgfQp9CgpmdW5jdGlvbiBhcHBseUZYT3ZlcnJpZGUoY29kZSkgewogIGNvbnN0IHVzZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWlucHV0LXVzZC0nICsgY29kZSk7CiAgY29uc3QgcmF0ZSA9IHBhcnNlRmxvYXQodXNkSW5wdXQ/LnZhbHVlKTsKICBpZiAoIXJhdGUgfHwgcmF0ZSA8PSAwKSB7IHNob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCByYXRlIOKdjCcpOyByZXR1cm47IH0KICBpZiAoIWRhdGEuX2Z4T3ZlcnJpZGVzKSBkYXRhLl9meE92ZXJyaWRlcyA9IHt9OwogIGRhdGEuX2Z4T3ZlcnJpZGVzW2NvZGVdID0gcmF0ZTsKICBzYXZlKCk7CiAgcmVuZGVyRlhSYXRlc1BhbmVsKCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgJHtjb2RlfSByYXRlIHNhdmVkIOKAlCBOZXQgV29ydGggcmVjYWxjdWxhdGVkIWApOwp9CgpmdW5jdGlvbiByZXNldEZYT3ZlcnJpZGUoY29kZSkgewogIGlmICghZGF0YS5fZnhPdmVycmlkZXMpIHJldHVybjsKICBkZWxldGUgZGF0YS5fZnhPdmVycmlkZXNbY29kZV07CiAgc2F2ZSgpOwogIHJlbmRlckZYUmF0ZXNQYW5lbCgpOwogIHJlbmRlck5ldFdvcnRoKCk7CiAgcmVuZGVySG9tZSgpOwogIHNob3dUb2FzdChgJHtjb2RlfSByYXRlIHJlc2V0IHRvIGJ1aWx0LWluIGRlZmF1bHRgKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElOVkVTVE1FTlQgQ0FSRCBNQU5BR0VSCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApjb25zdCBJTlZfRU1PSklfT1BUUyA9IFsn8J+Pm++4jycsJ/Cfp5MnLCfwn5OuJywn8J+PpicsJ/Cfm6HvuI8nLCfwn5OKJywn8J+qmScsJ/CfpYcnLCfwn4+hJywn8J+XgicsJ/CfkrknLCfwn4yQJywn8J+SvCcsJ/Cfjq8nLCfwn4+X77iPJywn8J+TsScsJ/CfjLEnLCfimqEnLCfwn5SRJywn8J+SjicsJ/Cfj4UnLCfwn4yNJywn8J+TiycsJ/Cfj6AnXTsKbGV0IHBpY2tlZEludkVtb2ppID0gJ/Cfj5vvuI8nOwoKZnVuY3Rpb24gcmVuZGVySW52Q2FyZFNldHRpbmdzKCkgewogIGNvbnN0IGNh','cmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY2FyZC1ncmlkJyk7CiAgaWYoIWdyaWQpIHJldHVybjsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcCgoYyxpKSA9PiB7CiAgICBjb25zdCB0ZW1wbGF0ZUxhYmVsID0gYy5maWVsZFRlbXBsYXRlPT09J0dlbmVyYWwnID8gJ/CfkrAnIDogYy5maWVsZFRlbXBsYXRlPT09J0VURi9NRicgPyAn8J+TiicgOiBjLmZpZWxkVGVtcGxhdGU9PT0nTWV0YWxzJyA/ICfwn6WHJyA6IGMuZmllbGRUZW1wbGF0ZT09PSdDcnlwdG8nID8gJ/CfqpknIDogYy5maWVsZFRlbXBsYXRlPT09J1JlYWwgRXN0YXRlJyA/ICfwn4+hJyA6ICfwn5OIJzsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjLmljb259PC9zcGFuPgogICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjA7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJob21lLWNhcmQtaXRlbS1sYWJlbCIgc3R5bGU9IndoaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczsiPiR7Yy5sYWJlbHx8Yy5rZXl9PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNjhlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7Ij4ke3RlbXBsYXRlTGFiZWx9ICR7Yy5maWVsZFRlbXBsYXRlfHwnR2VuZXJhbCd9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlICR7Yy52aXNpYmxlIT09ZmFsc2U/J29uJzonJ30iIG9uY2xpY2s9InRvZ2dsZUludkNhcmQoJHtpfSkiIHRpdGxlPSIke2MudmlzaWJsZSE9PWZhbHNlPydWaXNpYmxlIOKAlCBjbGljayB0byBoaWRlJzonSGlkZGVuIOKAlCBjbGljayB0byBzaG93J30iPgogICAgICAgICR7Yy52aXNpYmxlIT09ZmFsc2U/J+Kckyc6J+KXiyd9CiAgICAgIDwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVJbnZDYXJkKCR7aX0pIiB0aXRsZT0iUmVtb3ZlIiBzdHlsZT0iY29sb3I6dmFyKC0tZXhwZW5zZXMpO2ZvbnQtc2l6ZTowLjhlbTsiPuKclTwvYnV0dG9uPgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKCiAgLy8gRW1vamkgcGlja2VyIHJvdwogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jYXJkLWVtb2ppLXJvdycpOwogIGlmKGVtb2ppUm93KSBlbW9qaVJvdy5pbm5lckhUTUwgPSBJTlZfRU1PSklfT1BUUy5tYXAoZSA9PgogICAgYDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkSW52RW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tJbnZFbW9qaSgnJHtlfScpIj4ke2V9PC9zcGFuPmAKICApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBwaWNrSW52RW1vamkoZSkgeyBwaWNrZWRJbnZFbW9qaSA9IGU7IHJlbmRlckludkNhcmRTZXR0aW5ncygpOyB9CgpmdW5jdGlvbiB0b2dnbGVJbnZDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgY2FyZHNbaWR4XS52aXNpYmxlID0gY2FyZHNbaWR4XS52aXNpYmxlID09PSBmYWxzZSA/IHRydWUgOiBmYWxzZTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICByZW5kZXJJbnZDYXJkU2V0dGluZ3MoKTsKICBpZihob21lVGFiPT09J2ludmVzdCcpIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlSW52Q2FyZChpZHgpIHsKICBjb25zdCBjYXJkcyA9IGdldEhvbWVJbnZDYXJkcygpOwogIGlmKCFjb25maXJtKGBSZW1vdmUgIiR7Y2FyZHNbaWR4XS5sYWJlbHx8Y2FyZHNbaWR4XS5rZXl9IiBpbnZlc3RtZW50IGNhcmQ/YCkpIHJldHVybjsKICBjYXJkcy5zcGxpY2UoaWR4LCAxKTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICByZW5kZXJJbnZDYXJkU2V0dGluZ3MoKTsKICBpZihob21lVGFiPT09J2ludmVzdCcpIHJlbmRlckhvbWUoKTsKICBzaG93VG9hc3QoJ0NhcmQgcmVtb3ZlZCcpOwp9CgpmdW5jdGlvbiBhZGRJbnZDYXJkKCkgewogIGNvbnN0IG5hbWUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jYXJkLW5hbWUtaW5wdXQnKT8udmFsdWV8fCcnKS50cmltKCk7CiAgaWYoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIGNhcmQgbmFtZSDinYwnKTsgcmV0dXJuOyB9CiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhcmQtdGVtcGxhdGUnKT8udmFsdWUgfHwgJ0dlbmVyYWwnOwogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgaWYoY2FyZHMuZmluZChjPT5jLmtleT09PW5hbWV8fGMubGFiZWw9PT1uYW1lKSkgeyBzaG93VG9hc3QoJ0NhcmQgYWxyZWFkeSBleGlzdHMg4pqg77iPJyk7IHJldHVybjsgfQoKICBjb25zdCBpbnZDb2xvcnMgPSBbJyMwRUE1RTknLCcjOEI1Q0Y2JywnIzA1OTY2OScsJyNEOTc3MDYnLCcjREMyNjI2JywnI0VDNDg5OScsJyMxNEI4QTYnLCcjRjk3MzE2JywnIzYzNjZGMScsJyM4NENDMTYnXTsKICBjb25zdCBpbnZCZ3MgICA9IFsnI0UwRjJGRScsJyNGM0VFRkYnLCcjRUNGREY1JywnI0ZGRkJFQicsJyNGRUYyRjInLCcjRkRGMkY4JywnI0YwRkRGQScsJyNGRkY3RUQnLCcjRUVGMkZGJywnI0Y3RkVFNyddOwogIGNvbnN0IGlkeCA9IGNhcmRzLmxlbmd0aCAlIGludkNvbG9ycy5sZW5ndGg7CgogIGNhcmRzLnB1c2goewogICAga2V5OiBuYW1lLAogICAgbGFiZWw6IG5hbWUsCiAgICBpY29uOiBwaWNrZWRJbnZFbW9qaSwKICAgIGNvbG9yOiBpbnZDb2xvcnNbaWR4XSwKICAgIGJnOiBpbnZCZ3NbaWR4XSwKICAgIGZpZWxkVGVtcGxhdGU6IHRlbXBsYXRlLAogICAgdmlzaWJsZTogdHJ1ZSwKICB9KTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhcmQtbmFtZS1pbnB1dCcpLnZhbHVlID0gJyc7CiAgcmVuZGVySW52Q2FyZFNldHRpbmdzKCk7CiAgaWYoaG9tZVRhYj09PSdpbnZlc3QnKSByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGNhcmQgYWRkZWQhYCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBIT01FIENBUkQgTUFOQUdFUiAoU3BlbmRpbmcpCmNvbnN0IEVNT0pJX09QVFMgPSBbJ/CfjZQnLCfwn5uSJywn8J+PoCcsJ/CfmpcnLCfwn5KKJywn8J+OkycsJ+KaoScsJ/CfjIonLCfinIjvuI8nLCfwn46sJywn8J+RlycsJ/CfkoYnLCfwn5C+Jywn8J+nuScsJ/Cfk7EnLCfimJUnLCfwn46uJywn8J+TmicsJ/CfjZUnLCfwn46BJywn8J+SqicsJ/CfjLEnLCfwn5SnJywn8J+OtSddOwpsZXQgcGlja2VkRW1vamkgPSAn8J+bkic7CgpmdW5jdGlvbiByZW5kZXJIb21lQ2FyZFNldHRpbmdzKCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBjb25zdCBncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1ncmlkJyk7CiAgaWYoIWdyaWQpIHJldHVybjsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcCgoYyxpKT0+YAogICAgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjLmljb259PC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0tbGFiZWwiPiR7Yy5sYWJlbH08L3NwYW4+CiAgICAgIDxidXR0b24gY2xhc3M9ImhvbWUtY2FyZC10b2dnbGUgJHtjLnZpc2libGUhPT1mYWxzZT8nb24nOicnfSIgb25jbGljaz0idG9nZ2xlSG9tZUNhcmQoJHtpfSkiIHRpdGxlPSIke2MudmlzaWJsZSE9PWZhbHNlPydWaXNpYmxlJzonSGlkZGVuJ30iPgogICAgICAgICR7Yy52aXNpYmxlIT09ZmFsc2U/J+Kckyc6J+KXiyd9CiAgICAgIDwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVIb21lQ2FyZCgke2l9KSIgdGl0bGU9IlJlbW92ZSIgc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTtmb250LXNpemU6MC44ZW07Ij7inJU8L2J1dHRvbj4KICAgIDwvZGl2PmApLmpvaW4oJycpOwogIC8vIEVtb2ppIHBpY2tlcgogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1lbW9qaS1yb3cnKTsKICBpZihlbW9qaVJvdykgZW1vamlSb3cuaW5uZXJIVE1MID0gRU1PSklfT1BUUy5tYXAoZT0+YDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkRW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tFbW9qaSgnJHtlfScpIj4ke2V9PC9zcGFuPmApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBwaWNrRW1vamkoZSkgeyBwaWNrZWRFbW9qaT1lOyByZW5kZXJIb21lQ2FyZFNldHRpbmdzKCk7IH0KCmZ1bmN0aW9uIHRvZ2dsZUhvbWVDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBjYXJkc1tpZHhdLnZpc2libGUgPSBjYXJkc1tpZHhdLnZpc2libGU9PT1mYWxzZTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUhvbWVDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBpZighY29uZmlybShgUmVtb3ZlICIke2NhcmRzW2lkeF0ubGFiZWx9IiBjYXJkP2ApKSByZXR1cm47CiAgY2FyZHMuc3BsaWNlKGlkeCwxKTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIGFkZEhvbWVDYXJkKCkgewogIGNvbnN0IG5hbWUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1uYW1lLWlucHV0Jyk/LnZhbHVlfHwnJykudHJpbSgpOwogIGlmKCFuYW1lKXtzaG93VG9hc3QoJ0VudGVyIGEgY2FyZCBuYW1lIOKdjCcpO3JldHVybjt9CiAgY29uc3QgY2FyZHMgPSBnZXRIb21lU3BlbmRDYXJkcygpOwogIGNvbnN0IGNvbG9ycz1bJyNGRjZCMzUnLCcjNEE5RUZGJywnI0ZGOEM0MicsJyM0RUNEQzQnLCcjRkY0NzU3JywnIzEwQjk4MScsJyNGRkJFMEInLCcjRkY2QjlEJywnIzY0QjVGNicsJyM3QzNBRUQnXTsKICBjb25zdCBjb2xvciA9IGNvbG9yc1tjYXJkcy5sZW5ndGggJSBjb2xvcnMubGVuZ3RoXTsKICBjYXJkcy5wdXNoKHtrZXk6bmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCdfJyksbGFiZWw6bmFtZSxpY29uOnBpY2tlZEVtb2ppLGNvbG9yLGNsczonb3RoZXItY2F0JyxzdWJjYXRzOltuYW1lXSx2aXNpYmxlOnRydWV9KTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLWNhcmQtbmFtZS1pbnB1dCcpLnZhbHVlPScnOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGNhcmQgYWRkZWQgdG8gaG9tZSFgKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIE5BVklHQVRJT04KLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ','4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHN3aXRjaFNjcmVlbihuYW1lLCBidG4pIHsKICAvLyBBbHdheXMgY2xvc2UgZ29hbHMgb3ZlcmxheSB3aGVuIG5hdmlnYXRpbmcgYXdheQogIGNvbnN0IGdvYWxzT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGlzdC1nb2FscycpOwogIGlmIChnb2Fsc092ZXJsYXkpIGdvYWxzT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGNvbnN0IGdvYWxzRmFiTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWxzLWZhYi1idG4nKTsKICBpZiAoZ29hbHNGYWJOYXYpIGdvYWxzRmFiTmF2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgY2xvc2VHb2FsU2hlZXQoKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NyZWVuJykuZm9yRWFjaChzID0+IHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5uYXYtaXRlbScpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2NyZWVuLSR7bmFtZX1gKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBpZihidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAvLyBTaG93IEZBQiBvbmx5IG9uIHNjcmVlbnMgd2hlcmUgYWRkaW5nIHRyYW5zYWN0aW9ucyBtYWtlcyBzZW5zZQogIGNvbnN0IGZhYlNjcmVlbnMgPSBbJ2hvbWUnLCd0eCcsJ2FkZCddOwogIGNvbnN0IGZhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYWRkLWJ0bicpOwogIGlmKGZhYikgZmFiLnN0eWxlLmRpc3BsYXkgPSBmYWJTY3JlZW5zLmluY2x1ZGVzKG5hbWUpID8gJ2ZsZXgnIDogJ25vbmUnOwogIGlmKG5hbWU9PT0nc3RhdHMnKSByZW5kZXJTdGF0cygpOwogIGlmKG5hbWU9PT0nYWNjb3VudCcpIHJlbmRlckFjY291bnQoKTsKICBpZihuYW1lPT09J3R4JykgcmVuZGVyVHJhbnNhY3Rpb25zKCk7CiAgaWYobmFtZT09PSdob21lJykgcmVuZGVySG9tZSgpOwogIGlmKG5hbWU9PT0nYWRkJykgcmVuZGVyQWRkU2NyZWVuKCk7CiAgaWYobmFtZT09PSdzZXR0aW5ncycpIHJlbmRlclNldHRpbmdzKCk7CiAgaWYobmFtZT09PSdtZXRhbHMnKSByZW5kZXJNZXRhbHMoKTsKICBpZihuYW1lPT09J2ludmVzdCcpIHJlbmRlckludmVzdG1lbnRzKCk7CiAgaWYobmFtZT09PSdkYXRhJykgeyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOyByZW5kZXJEYXRhU2NyZWVuKCk7IH0KICBpZihuYW1lPT09J2J1ZGdldCcpIHsgYnVkZ2V0Vmlld01vbnRoID0gdmlld01vbnRoOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LW1vbnRoLWxhYmVsJykudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgoYnVkZ2V0Vmlld01vbnRoKTsgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7IH0KICBpZihuYW1lPT09J25ldHdvcnRoJykgcmVuZGVyTmV0V29ydGgoKTsKICBpZihuYW1lPT09J2ltcG9ydCcpIHsgc2V0SW1wb3J0VGFiKCd0cmFuc2FjdGlvbnMnLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW1wb3J0LXRhYicpKTsgcmVuZGVyR2l2ZW5MZWRnZXIoKTsgcmVuZGVyUmVzZXRTdW1tYXJ5KCk7IHJlbmRlck1vbnRoc0xpc3QoKTsgfQp9CgpmdW5jdGlvbiBnb1RvU2NyZWVuKG5hbWUpIHsKICBjb25zdCBnb2Fsc092ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmxpc3QtZ29hbHMnKTsKICBpZiAoZ29hbHNPdmVybGF5KSBnb2Fsc092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBjbG9zZUdvYWxTaGVldCgpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY3JlZW4nKS5mb3JFYWNoKHMgPT4gcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm5hdi1pdGVtJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzY3JlZW4tJHtuYW1lfWApLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGlmKG5hbWU9PT0nc2V0dGluZ3MnKSByZW5kZXJTZXR0aW5ncygpOwogIGlmKG5hbWU9PT0nbWV0YWxzJykgcmVuZGVyTWV0YWxzKCk7CiAgaWYobmFtZT09PSdpbnZlc3QnKSByZW5kZXJJbnZlc3RtZW50cygpOwogIGlmKG5hbWU9PT0nbmV0d29ydGgnKSByZW5kZXJOZXRXb3J0aCgpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gVFJBTlNBQ1RJT05TIC8gQ0FMRU5EQVIKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBjYWxTZWxlY3RlZERheSA9IG51bGw7CgoKbGV0IGNhbFZpZXdNb2RlID0gJ2NhbGVuZGFyJzsgLy8gJ2NhbGVuZGFyJyB8ICdsaXN0JwoKZnVuY3Rpb24gc2V0Q2FsVmlldyhtb2RlKSB7CiAgY2FsVmlld01vZGUgPSBtb2RlOwogIGNvbnN0IGNhbEdyaWQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1ncmlkJyk7CiAgY29uc3QgbGlzdFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWxpc3QtdmlldycpOwogIGNvbnN0IGJ0bkNhbCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC12aWV3LWJ0bi1jYWxlbmRhcicpOwogIGNvbnN0IGJ0bkxpc3QgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC12aWV3LWJ0bi1saXN0Jyk7CiAgY29uc3QgYWN0aXZlU3R5bGUgID0gJ2JhY2tncm91bmQ6IzFFMkE2RTtjb2xvcjp3aGl0ZTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjVweCAxMnB4O2ZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6ODAwO2N1cnNvcjpwb2ludGVyOyc7CiAgY29uc3QgaW5hY3RpdmVTdHlsZT0gJ2JhY2tncm91bmQ6I0YwRjBGMDtjb2xvcjp2YXIoLS10ZXh0LW1lZCk7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzo1cHggMTJweDtmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjgwMDtjdXJzb3I6cG9pbnRlcjsnOwogIGlmIChtb2RlID09PSAnY2FsZW5kYXInKSB7CiAgICBpZiAoY2FsR3JpZCkgY2FsR3JpZC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBpZiAobGlzdFZpZXcpIGxpc3RWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoYnRuQ2FsKSAgYnRuQ2FsLnN0eWxlLmNzc1RleHQgID0gYWN0aXZlU3R5bGU7CiAgICBpZiAoYnRuTGlzdCkgYnRuTGlzdC5zdHlsZS5jc3NUZXh0ID0gaW5hY3RpdmVTdHlsZTsKICB9IGVsc2UgewogICAgaWYgKGNhbEdyaWQpIGNhbEdyaWQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGlmIChsaXN0VmlldykgeyBsaXN0Vmlldy5zdHlsZS5kaXNwbGF5ID0gJyc7IHJlbmRlckNhbExpc3RWaWV3KGxpc3RWaWV3KTsgfQogICAgaWYgKGJ0bkNhbCkgIGJ0bkNhbC5zdHlsZS5jc3NUZXh0ICA9IGluYWN0aXZlU3R5bGU7CiAgICBpZiAoYnRuTGlzdCkgYnRuTGlzdC5zdHlsZS5jc3NUZXh0ID0gYWN0aXZlU3R5bGU7CiAgfQp9CgpmdW5jdGlvbiByZW5kZXJDYWxMaXN0Vmlldyhjb250YWluZXIpIHsKICBjb25zdCBbeSwgbW9dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgY29uc3QgbWsgPSB2aWV3TW9udGg7CiAgaWYgKCFkYXRhW21rXSkgeyBjb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6MzBweDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo3MDA7Ij5ObyBkYXRhIGZvciB0aGlzIG1vbnRoPC9kaXY+JzsgcmV0dXJuOyB9CiAgY29uc3QgdG9EaXNwID0gdCA9PiBjb252ZXJ0QW10KHQuYW1vdW50LCB0LmN1cnJlbmN5KTsKICBjb25zdCBleHAgID0gKGRhdGFbbWtdLmV4cGVuc2VzICAgIHx8IFtdKS5tYXAodCA9PiAoey4uLnQsIF90eXBlOidleHBlbnNlJ30pKTsKICBjb25zdCBpbmMgID0gKGRhdGFbbWtdLmluY29tZSAgICAgIHx8IFtdKS5tYXAodCA9PiAoey4uLnQsIF90eXBlOidpbmNvbWUnfSkpOwogIGNvbnN0IGludiAgPSAoZGF0YVtta10uaW52ZXN0bWVudHMgfHwgW10pLm1hcCh0ID0+ICh7Li4udCwgX3R5cGU6J2ludmVzdG1lbnQnfSkpOwogIGNvbnN0IGFkZCAgPSAoZGF0YVtta10uYWRkaXRpb25hbCAgfHwgW10pLm1hcCh0ID0+ICh7Li4udCwgX3R5cGU6J2FkZGl0aW9uYWwnfSkpOwogIGNvbnN0IGFsbCAgPSBbLi4uaW5jLCAuLi5leHAsIC4uLmludiwgLi4uYWRkXS5zb3J0KChhLGIpPT4oYi5kYXRlfHwnJykubG9jYWxlQ29tcGFyZShhLmRhdGV8fCcnKSk7CgogIGNvbnN0IHR5cGVDb2xvcnMgPSB7IGV4cGVuc2U6JyNFRjQ0NDQnLCBpbmNvbWU6JyMxMEI5ODEnLCBpbnZlc3RtZW50OicjN0MzQUVEJywgYWRkaXRpb25hbDonI0Y1OUUwQicgfTsKICBjb25zdCB0eXBlTGFiZWxzID0geyBleHBlbnNlOidFeHBlbnNlJywgaW5jb21lOidJbmNvbWUnLCBpbnZlc3RtZW50OidJbnZlc3QnLCBhZGRpdGlvbmFsOidPdGhlcicgfTsKCiAgLy8gR3JvdXAgYnkgZGF0ZQogIGNvbnN0IGJ5RGF0ZSA9IHt9OwogIGFsbC5mb3JFYWNoKHQgPT4gewogICAgY29uc3QgZCA9IHQuZGF0ZSB8fCAnPyc7CiAgICBpZiAoIWJ5RGF0ZVtkXSkgYnlEYXRlW2RdID0gW107CiAgICBieURhdGVbZF0ucHVzaCh0KTsKICB9KTsKCiAgY29uc3QgZGF0ZUtleXMgPSBPYmplY3Qua2V5cyhieURhdGUpLnNvcnQoKGEsYikgPT4gYi5sb2NhbGVDb21wYXJlKGEpKTsKICBjb25zdCB0b3RhbEluYyA9IGluYy5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsRXhwID0gZXhwLnJlZHVjZSgocyx0KT0+cyt0b0Rpc3AodCksMCk7CiAgY29uc3QgdG90YWxJbnYgPSBpbnYucmVkdWNlKChzLHQpPT5zK3RvRGlzcCh0KSwwKTsKCiAgbGV0IGh0bWwgPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp3aGl0ZTtib3JkZXItcmFkaXVzOjE0cHg7cGFkZGluZzoxMnB4IDE2cHg7bWFyZ2luLWJvdHRvbToxMHB4O2JveC1zaGFkb3c6dmFyKC0tY2FyZC1zaGFkb3cpOyI+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWFyb3VuZDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICA8ZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyI+SW5jb21lPC9kaXY+PGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2NvbG9yOnZhcigtLWluY29tZSk7Ij4ke2ZtdCh0b3RhbEluYyl9PC9kaXY+PC9kaXY+CiAgICAgIDxkaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7Ij5FeHBlbnNlczwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ij4ke2ZtdCh0b3RhbEV4cCl9PC9kaXY+PC9kaXY+CiAgICAgIDxkaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7Ij5JbnZlc3Rpbmc8L2Rpdj48ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Y29sb3I6IzdDM0FFRDsiPiR7Zm10KHRvdGFsSW52KX08L2Rpdj48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7CgogIGRhdGVLZXlz','LmZvckVhY2goZGF0ZSA9PiB7CiAgICBjb25zdCB0eG5zID0gYnlEYXRlW2RhdGVdOwogICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUgKyAnVDAwOjAwOjAwJyk7CiAgICBjb25zdCBkYXlMYWJlbCA9IGQudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycsIHsgd2Vla2RheTonc2hvcnQnLCBtb250aDonc2hvcnQnLCBkYXk6J251bWVyaWMnIH0pOwogICAgY29uc3QgZGF5VG90YWwgPSB0eG5zLnJlZHVjZSgocyx0KSA9PiB7CiAgICAgIGlmICh0Ll90eXBlPT09J2luY29tZScpIHJldHVybiBzICsgdG9EaXNwKHQpOwogICAgICBpZiAodC5fdHlwZT09PSdleHBlbnNlJ3x8dC5fdHlwZT09PSdhZGRpdGlvbmFsJykgcmV0dXJuIHMgLSB0b0Rpc3AodCk7CiAgICAgIHJldHVybiBzOwogICAgfSwgMCk7CiAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjhweDsiPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6NnB4IDEycHg7YmFja2dyb3VuZDojRjhGOEY4O2JvcmRlci1yYWRpdXM6MTBweDttYXJnaW4tYm90dG9tOjRweDsiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MC44MmVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4ke2RheUxhYmVsfTwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC44MmVtO2NvbG9yOiR7ZGF5VG90YWw+PTA/J3ZhcigtLWluY29tZSknOid2YXIoLS1leHBlbnNlcyknfTsiPiR7ZGF5VG90YWw+PTA/JysnOicnfSR7Zm10KE1hdGguYWJzKGRheVRvdGFsKSl9PC9kaXY+CiAgICAgIDwvZGl2PmA7CiAgICB0eG5zLmZvckVhY2godCA9PiB7CiAgICAgIGNvbnN0IGNvbG9yID0gdHlwZUNvbG9yc1t0Ll90eXBlXSB8fCAnIzg4OCc7CiAgICAgIGNvbnN0IGxhYmVsID0gdHlwZUxhYmVsc1t0Ll90eXBlXSB8fCB0Ll90eXBlOwogICAgICBjb25zdCBwcmVmaXggPSB0Ll90eXBlID09PSAnaW5jb21lJyA/ICcrJyA6ICctJzsKICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDtwYWRkaW5nOjdweCAxMnB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNGNUY1RjU7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDo3cHg7aGVpZ2h0OjdweDtib3JkZXItcmFkaXVzOjUwJTtiYWNrZ3JvdW5kOiR7Y29sb3J9O2ZsZXgtc2hyaW5rOjA7Ij48L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjA7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOyI+JHt0LmRlc2NyaXB0aW9ufHx0LmNhdGVnb3J5fHwn4oCUJ308L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjcyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+JHt0LmNhdGVnb3J5fHwnJ30gwrcgJHtsYWJlbH08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuODhlbTtjb2xvcjoke2NvbG9yfTtmbGV4LXNocmluazowOyI+JHtwcmVmaXh9JHtmbXQodG9EaXNwKHQpKX08L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pOwogICAgaHRtbCArPSBgPC9kaXY+YDsKICB9KTsKCiAgaWYgKGRhdGVLZXlzLmxlbmd0aCA9PT0gMCkgaHRtbCArPSBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzozMHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjcwMDsiPk5vIHRyYW5zYWN0aW9ucyB0aGlzIG1vbnRoPC9kaXY+YDsKICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gY2FsQ2hhbmdlTW9udGgoZGlyKSB7CiAgY29uc3QgW3ksbV0gPSB2aWV3TW9udGguc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICBjb25zdCBkID0gbmV3IERhdGUoeSwgbS0xK2RpciwgMSk7CiAgdmlld01vbnRoID0gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7CiAgLy8gUmVmcmVzaCBsaXN0IHZpZXcgaWYgYWN0aXZlCiAgaWYgKGNhbFZpZXdNb2RlID09PSAnbGlzdCcpIHsgY29uc3QgbHY9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1saXN0LXZpZXcnKTsgaWYobHYmJmx2LnN0eWxlLmRpc3BsYXkhPT0nbm9uZScpIHJlbmRlckNhbExpc3RWaWV3KGx2KTsgfQogIGNvbnN0IHRvcGJhck1vbnRoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGJhci1tb250aCcpOwogIGlmKHRvcGJhck1vbnRoKSB0b3BiYXJNb250aC50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIGNhbFNlbGVjdGVkRGF5ID0gbnVsbDsKICByZW5kZXJUcmFuc2FjdGlvbnMoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIGZtdFNob3J0KG4pIHsKICBpZihuID49IDEwMDApIHJldHVybiAobi8xMDAwKS50b0ZpeGVkKDEpKydrJzsKICByZXR1cm4gbi50b0ZpeGVkKDApOwp9CgpmdW5jdGlvbiByZW5kZXJUcmFuc2FjdGlvbnMoKSB7CiAgZW5zdXJlTW9udGgodmlld01vbnRoKTsKICBjb25zdCBtID0gZGF0YVt2aWV3TW9udGhdOwogIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgY29uc3QgW3ksIG1vXSA9IHZpZXdNb250aC5zcGxpdCgnLScpLm1hcChOdW1iZXIpOwoKICBjb25zdCB0aXRsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1tb250aC10aXRsZScpOwogIGlmKHRpdGxlRWwpIHRpdGxlRWwudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgodmlld01vbnRoKTsKCiAgLy8gR2F0aGVyIGFsbCB0cmFuc2FjdGlvbnMg4oCUIG5vcm1hbGl6ZSBkYXRlcyBzbyBZWVlZLU0tRCBtYXRjaGVzIFlZWVktTU0tREQKICBsZXQgYWxsVHggPSBbXTsKICBjb25zdCBwdXNoVHggPSAobGlzdCwgdHlwZSkgPT4gKGxpc3R8fFtdKS5mb3JFYWNoKChlLGkpID0+IHsKICAgIGNvbnN0IG5vcm1EYXRlID0gbm9ybWFsaXplRGF0ZShlLmRhdGUpOyAgIC8vIOKGkCBmaXg6IGFsd2F5cyBwYWRkZWQgWVlZWS1NTS1ERAogICAgYWxsVHgucHVzaCh7Li4uZSwgZGF0ZTogbm9ybURhdGUsIF90eXBlOiB0eXBlLCBfaWR4OiBpfSk7CiAgfSk7CiAgcHVzaFR4KG0uZXhwZW5zZXMsICAgICAgJ2V4cGVuc2UnKTsKICBwdXNoVHgobS5pbmNvbWUsICAgICAgICAnaW5jb21lJyk7CiAgcHVzaFR4KG0uaW52ZXN0bWVudHMsICAgJ2ludmVzdG1lbnQnKTsKICBwdXNoVHgobS5kZWJ0cywgICAgICAgICAnZGVidCcpOwogIHB1c2hUeChtLmdpdmVuVG9PdGhlcnMsICdnaXZlbicpOwogIHB1c2hUeChtLmFkZGl0aW9uYWwsICAgICdhZGRpdGlvbmFsJyk7CgogIC8vIFN1bW1hcnkg4oCUIGNvbnZlcnQgZWFjaCBlbnRyeSB0byBkaXNwbGF5IGN1cnJlbmN5IGJlZm9yZSBzdW1taW5nCiAgY29uc3QgdG9EaXNwID0gdCA9PiBjb252ZXJ0QW10KHQuYW1vdW50LCB0LmN1cnJlbmN5KTsKICBjb25zdCB0b3RhbEluYyAgPSBhbGxUeC5maWx0ZXIodD0+dC5fdHlwZT09PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsRXhwICA9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2V4cGVuc2UnfHx0Ll90eXBlPT09J2FkZGl0aW9uYWwnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsSW52ICA9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2ludmVzdG1lbnQnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsT3RoZXI9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2RlYnQnfHx0Ll90eXBlPT09J2dpdmVuJykucmVkdWNlKChzLHQpPT5zK3RvRGlzcCh0KSwwKTsKICBjb25zdCBzYXZpbmdzICAgPSB0b3RhbEludjsgIC8vICJJbnZlc3RpbmciIHRpbGUgc2hvd3MgaW52ZXN0bWVudHMgYW1vdW50CiAgY29uc3QgbmV0ICAgICAgID0gdG90YWxJbmMgLSB0b3RhbEV4cCAtIHRvdGFsSW52IC0gdG90YWxPdGhlcjsKCiAgY29uc3QgZWxfaW5jICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdG90YWwtaW5jb21lJyk7CiAgY29uc3QgZWxfZXhwICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdG90YWwtZXhwZW5zZScpOwogIGNvbnN0IGVsX3NhdiAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLXRvdGFsLXNhdmluZ3MnKTsKICBjb25zdCBlbF9uZXQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC10b3RhbC1uZXQnKTsKICBpZihlbF9pbmMpIGVsX2luYy50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEluYyk7CiAgaWYoZWxfZXhwKSBlbF9leHAudGV4dENvbnRlbnQgPSBmbXQodG90YWxFeHApOwogIGlmKGVsX3NhdikgeyBlbF9zYXYudGV4dENvbnRlbnQgPSBmbXQoc2F2aW5ncyk7IGVsX3Nhdi5zdHlsZS5jb2xvciA9ICcjN0MzQUVEJzsgfQogIGlmKGVsX25ldCkgewogICAgZWxfbmV0LnRleHRDb250ZW50ID0gKG5ldD49MD8nKyc6Jy0nKSArIGZtdChNYXRoLmFicyhuZXQpKTsKICAgIGVsX25ldC5zdHlsZS5jb2xvciA9IG5ldD49MCA/ICd2YXIoLS1pbmNvbWUpJyA6ICd2YXIoLS1leHBlbnNlcyknOwogIH0KCiAgLy8gR3JvdXAgYnkgbm9ybWFsaXplZCBkYXRlCiAgY29uc3QgYnlEYXRlID0ge307CiAgYWxsVHguZm9yRWFjaCh0ID0+IHsKICAgIGNvbnN0IGQgPSB0LmRhdGV8fCcnOwogICAgaWYoZCkgeyBpZighYnlEYXRlW2RdKSBieURhdGVbZF09W107IGJ5RGF0ZVtkXS5wdXNoKHQpOyB9CiAgfSk7CgogIC8vIEJ1aWxkIGNhbGVuZGFyIGdyaWQKICBjb25zdCBmaXJzdERvdyA9IG5ldyBEYXRlKHksIG1vLTEsIDEpLmdldERheSgpOwogIGNvbnN0IGRheXNJbk1vbnRoID0gbmV3IERhdGUoeSwgbW8sIDApLmdldERhdGUoKTsKICBjb25zdCB0eXBlQ29sb3JzID0gewogICAgZXhwZW5zZTonI0VGNDQ0NCcsIGluY29tZTonIzEwQjk4MScsIGludmVzdG1lbnQ6JyM3QzNBRUQnLAogICAgZGVidDonIzhCNUNGNicsIGdpdmVuOicjRkY2QjlEJywgYWRkaXRpb25hbDonI0Y1OUUwQicKICB9OwoKICBsZXQgY2VsbHMgPSAnJzsKICBmb3IobGV0IGk9MDsgaTxmaXJzdERvdzsgaSsrKSB7CiAgICBjZWxscyArPSBgPGRpdiBjbGFzcz0iY2FsLWNlbGwgZW1wdHkiPjwvZGl2PmA7CiAgfQogIGZvcihsZXQgZD0xOyBkPD1kYXlzSW5Nb250aDsgZCsrKSB7CiAgICBjb25zdCBkYXRlU3RyID0gYCR7dmlld01vbnRofS0ke1N0cmluZyhkKS5wYWRTdGFydCgyLCcwJyl9YDsKICAgIGNvbnN0IHR4cyA9IGJ5RGF0ZVtkYXRlU3RyXSB8fCBbXTsKICAgIGNvbnN0IGlzVG9kYXkgPSBkYXRlU3RyID09PSB0b2RheTsKICAgIGNvbnN0IGlzU2VsICAgPSBkYXRlU3RyID09PSBjYWxTZWxlY3RlZERheTsKICAgIGNvbnN0IGRheUV4cCAgPSB0eHMuZmlsdGVyKHQ9PnQuX3R5cGUhPT0naW5jb21lJykucmVkdWNlKChzLHQpPT5zK2NvbnZlcnRBbXQodC5hbW91bnQsdC5jdXJyZW5jeSksMCk7CiAgICBjb25zdCBkYXlJbmMgID0gdHhzLmZpbHRlcih0PT50Ll90eXBlPT09J2luY29tZScpLnJlZHVjZSgocyx0KT0+cytjb252ZXJ0QW10KHQuYW1vdW50LHQuY3VycmVuY3kpLDApOwogICAgY29uc3QgdW5pcXVlVHlwZXMgPSBbLi4ubmV3IFNldCh0eHMubWFwKHQ9PnQuX3R5cGUpKV0uc2xpY2UoMCw0KTsKICAgIGNvbnN0IGRvdHMgPSB1bmlxdWVUeXBlcy5tYXAodHA9PmA8ZGl2IGNsYXNzPSJjYWwtZG90IiBzdHlsZT0iYmFja2dyb3VuZDoke3R5cGVDb2xvcnNbdHBdfHwnI2NjYyd9OyI+PC9kaXY+YCkuam9pbignJyk7CiAgICBsZXQgYW10SHRtbCA9ICcnOwogICAgaWYodHhzLmxlbmd0','aCA+IDApIHsKICAgICAgY29uc3QgcGFydHMgPSBbXTsKICAgICAgaWYoZGF5RXhwPjApIHBhcnRzLnB1c2goYDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1leHBlbnNlcykiPiR7Zm10U2hvcnQoZGF5RXhwKX08L3NwYW4+YCk7CiAgICAgIGlmKGRheUluYz4wKSBwYXJ0cy5wdXNoKGA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0taW5jb21lKSI+JHtmbXRTaG9ydChkYXlJbmMpfTwvc3Bhbj5gKTsKICAgICAgYW10SHRtbCA9IGA8ZGl2IGNsYXNzPSJjYWwtY2VsbC1hbXQiPiR7cGFydHMuam9pbignPGJyPicpfTwvZGl2PmA7CiAgICB9CiAgICBjZWxscyArPSBgPGRpdiBjbGFzcz0iY2FsLWNlbGwke2lzVG9kYXk/JyB0b2RheSc6Jyd9JHtpc1NlbD8nIHNlbGVjdGVkJzonJ30iIG9uY2xpY2s9ImNhbFNlbGVjdERheSgnJHtkYXRlU3RyfScpIj4KICAgICAgPGRpdiBjbGFzcz0iY2FsLWRheS1udW0iPiR7ZH08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2FsLWRvdHMiPiR7ZG90c308L2Rpdj4KICAgICAgJHthbXRIdG1sfQogICAgPC9kaXY+YDsKICB9CgogIGNvbnN0IGNhbEdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWdyaWQnKTsKICBpZihjYWxHcmlkKSBjYWxHcmlkLmlubmVySFRNTCA9IGNlbGxzOwogIHJlbmRlckNhbERheURldGFpbChhbGxUeCk7Cn0KCmZ1bmN0aW9uIGNhbFNlbGVjdERheShkYXRlU3RyKSB7CiAgY2FsU2VsZWN0ZWREYXkgPSBjYWxTZWxlY3RlZERheSA9PT0gZGF0ZVN0ciA/IG51bGwgOiBkYXRlU3RyOwogIC8vIHNjcm9sbCBkZXRhaWwgaW50byB2aWV3IHNtb290aGx5CiAgaWYoY2FsU2VsZWN0ZWREYXkpIHsKICAgIHNldFRpbWVvdXQoKCk9PnsgY29uc3QgZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1kYXktZGV0YWlsJyk7IGlmKGVsKSBlbC5zY3JvbGxJbnRvVmlldyh7YmVoYXZpb3I6J3Ntb290aCcsYmxvY2s6J25lYXJlc3QnfSk7IH0sIDgwKTsKICB9CiAgcmVuZGVyVHJhbnNhY3Rpb25zKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNhbERheURldGFpbChhbGxUeCkgewogIGNvbnN0IGRldGFpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtZGF5LWRldGFpbCcpOwogIGlmKCFkZXRhaWwpIHJldHVybjsKICBpZighY2FsU2VsZWN0ZWREYXkpIHsgZGV0YWlsLmlubmVySFRNTD0nJzsgcmV0dXJuOyB9CgogIGNvbnN0IGRheVR4ID0gKGFsbFR4fHxbXSkuZmlsdGVyKHQgPT4gdC5kYXRlID09PSBjYWxTZWxlY3RlZERheSk7CiAgbGV0IGQ7IHRyeSB7IGQgPSBuZXcgRGF0ZShjYWxTZWxlY3RlZERheSsnVDAwOjAwOjAwJyk7IH0gY2F0Y2goZSl7IGQgPSBuZXcgRGF0ZSgpOyB9CiAgY29uc3QgZGF0ZUxhYmVsID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7d2Vla2RheTonbG9uZycsbW9udGg6J2xvbmcnLGRheTonbnVtZXJpYyd9KTsKICBjb25zdCBkYXlJbiAgPSBkYXlUeC5maWx0ZXIodD0+dC5fdHlwZT09PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrY29udmVydEFtdCh0LmFtb3VudCx0LmN1cnJlbmN5KSwwKTsKICBjb25zdCBkYXlPdXQgPSBkYXlUeC5maWx0ZXIodD0+dC5fdHlwZSE9PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrY29udmVydEFtdCh0LmFtb3VudCx0LmN1cnJlbmN5KSwwKTsKICBjb25zdCBuZXQgICAgPSBkYXlJbiAtIGRheU91dDsKCiAgaWYoZGF5VHgubGVuZ3RoID09PSAwKSB7CiAgICBkZXRhaWwuaW5uZXJIVE1MPWA8ZGl2IGNsYXNzPSJjYWwtZW1wdHktZGF5Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEuOGVtO21hcmdpbi1ib3R0b206OHB4OyI+8J+XkzwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuOTVlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtkYXRlTGFiZWx9PC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjgyZW07bWFyZ2luLXRvcDo2cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij5ObyB0cmFuc2FjdGlvbnMgcmVjb3JkZWQ8L2Rpdj4KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJvcGVuUXVpY2tBZGQoJ2V4cGVuc2UnLG51bGwpIiBzdHlsZT0ibWFyZ2luLXRvcDoxMnB4O2JhY2tncm91bmQ6dmFyKC0teWVsbG93KTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzo4cHggMThweDtmb250LWZhbWlseTpOdW5pdG8sc2Fucy1zZXJpZjtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODVlbTtjdXJzb3I6cG9pbnRlcjsiPisgQWRkIG9uZTwvYnV0dG9uPgogICAgPC9kaXY+YDsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHR5cGVMYWJlbCA9IHtleHBlbnNlOidFeHBlbnNlJyxpbmNvbWU6J0luY29tZScsaW52ZXN0bWVudDonSW52ZXN0bWVudCcsZGVidDonRGVidCcsZ2l2ZW46J0dpdmVuJyxhZGRpdGlvbmFsOidBZGRpdGlvbmFsJ307CiAgY29uc3QgaWNvbk1hcCAgID0ge2V4cGVuc2U6J/CfkrgnLGluY29tZTon8J+StScsaW52ZXN0bWVudDon8J+TiCcsZGVidDon8J+TiScsZ2l2ZW46J/CfpJ0nLGFkZGl0aW9uYWw6J/CfjoEnfTsKICBjb25zdCBiZ01hcCAgICAgPSB7ZXhwZW5zZTonI0VGNDQ0NDE1JyxpbmNvbWU6JyMxMEI5ODExNScsaW52ZXN0bWVudDonIzdDM0FFRDE1JyxkZWJ0OicjOEI1Q0Y2MTUnLGdpdmVuOicjRkY2QjlEMTUnLGFkZGl0aW9uYWw6JyNGNTlFMEIxNSd9OwogIGNvbnN0IGNvbG9yTWFwICA9IHtleHBlbnNlOicjRUY0NDQ0JyxpbmNvbWU6JyMxMEI5ODEnLGludmVzdG1lbnQ6JyM3QzNBRUQnLGRlYnQ6JyM4QjVDRjYnLGdpdmVuOicjRkY2QjlEJyxhZGRpdGlvbmFsOicjRjU5RTBCJ307CiAgLy8gQW1vdW50czogaW5jb21lIGdyZWVuIHBsYWluLCBldmVyeXRoaW5nIGVsc2UgcmVkIHBsYWluIOKAlCBubyBtaXNsZWFkaW5nIHNpZ25zCiAgY29uc3QgYW10Q29sb3IgID0gdCA9PiB0Ll90eXBlPT09J2luY29tZScgPyAndmFyKC0taW5jb21lKScgOiAndmFyKC0tZXhwZW5zZXMpJzsKCiAgZGV0YWlsLmlubmVySFRNTD1gCiAgICA8IS0tIERheSBzdW1tYXJ5IHN0cmlwIC0tPgogICAgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS13aGl0ZSk7Ym9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMpO2JveC1zaGFkb3c6dmFyKC0tY2FyZC1zaGFkb3cpO3BhZGRpbmc6MTRweCAxNnB4O21hcmdpbi1ib3R0b206MTBweDsiPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi1ib3R0b206MTBweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjFlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtkYXRlTGFiZWx9PC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43NWVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tdG9wOjJweDsiPiR7ZGF5VHgubGVuZ3RofSB0cmFuc2FjdGlvbiR7ZGF5VHgubGVuZ3RoPT09MT8nJzoncyd9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsiPgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7bWFyZ2luLWJvdHRvbToycHg7Ij5ORVQ8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxLjFlbTtmb250LXdlaWdodDo5MDA7Y29sb3I6JHtuZXQ+PTA/J3ZhcigtLWluY29tZSknOid2YXIoLS1leHBlbnNlcyknfTsiPiR7bmV0Pj0wPycrJzon4oiSJ30ke2ZtdChNYXRoLmFicyhuZXQpKX08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6MTBweDsiPgogICAgICAgICR7ZGF5SW4+MD9gPGRpdiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6I0YwRkJGMztib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzo4cHggMTBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLWluY29tZSk7bWFyZ2luLWJvdHRvbToycHg7Ij5JTjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45NWVtO2NvbG9yOnZhcigtLWluY29tZSk7Ij4rJHtmbXQoZGF5SW4pfTwvZGl2PjwvZGl2PmA6Jyd9CiAgICAgICAgJHtkYXlPdXQ+MD9gPGRpdiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6I0ZGRjBGMDtib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzo4cHggMTBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLWV4cGVuc2VzKTttYXJnaW4tYm90dG9tOjJweDsiPk9VVDwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45NWVtO2NvbG9yOnZhcigtLWV4cGVuc2VzKTsiPuKIkiR7Zm10KGRheU91dCl9PC9kaXY+PC9kaXY+YDonJ30KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFRyYW5zYWN0aW9uIHJvd3Mg4oCUIHZpZXcgb25seSwg4pyVIHRvIGRlbGV0ZSAtLT4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Z2FwOjhweDsiPgogICAgICAke2RheVR4Lm1hcCh0PT5gCiAgICAgICAgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS13aGl0ZSk7Ym9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMtc20pO2JveC1zaGFkb3c6MCAycHggMTBweCByZ2JhKDAsMCwwLDAuMDYpO3BhZGRpbmc6MTJweCAxNHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEycHg7Ij4KICAgICAgICAgIDwhLS0gSWNvbiAtLT4KICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOjQycHg7aGVpZ2h0OjQycHg7Ym9yZGVyLXJhZGl1czoxM3B4O2JhY2tncm91bmQ6JHtiZ01hcFt0Ll90eXBlXXx8JyNlZWUnfTtib3JkZXI6MS41cHggc29saWQgJHtjb2xvck1hcFt0Ll90eXBlXXx8JyNjY2MnfTIyO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXNpemU6MS4yZW07ZmxleC1zaHJpbms6MDsiPiR7aWNvbk1hcFt0Ll90eXBlXXx8J/CfkrAnfTwvZGl2PgogICAgICAgICAgPCEtLSBJbmZvIC0tPgogICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxO21pbi13aWR0aDowOyI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDttYXJnaW4tYm90dG9tOjNweDsiPgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOyI+JHt0LmNhdGVnb3J5fHwnT3RoZXInfTwvc3Bhbj4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNjVlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6JHtjb2xvck1hcFt0Ll90eXBlXX07YmFja2dyb3VuZDoke2JnTWFwW3QuX3R5cGVdfTtib3JkZXItcmFkaXVzOjIwcHg7cGFkZGluZzoycHggN3B4O2ZsZXgtc2hyaW5rOjA7Ij4ke3R5cGVMYWJlbFt0Ll90eXBlXXx8dC5fdHlwZX08L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7Ij4ke3QuZGVzY3JpcHRpb258fCfigJQnfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIEFtb3VudCAtLT4KICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7ZmxleC1zaHJpbms6','MDsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MWVtO2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjoke2FtdENvbG9yKHQpfTsiPiR7Zm10Q29udmVydGVkRnVsbCh0LmFtb3VudCx0LmN1cnJlbmN5KX08L2Rpdj4KICAgICAgICAgICAgJHt0LmN1cnJlbmN5JiZ0LmN1cnJlbmN5IT09Y3VycmVudEN1cnJlbmN5LmNvZGU/YDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY1ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+JHt0LmN1cnJlbmN5fSAke051bWJlcih0LmFtb3VudHx8MCkudG9GaXhlZCgyKX08L2Rpdj5gOicnfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIERlbGV0ZSAtLT4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0iY2FsRGVsZXRlVHgoJyR7dmlld01vbnRofScsJyR7dC5fdHlwZX0nLCR7dC5faWR4fSkiIAogICAgICAgICAgICBzdHlsZT0iZmxleC1zaHJpbms6MDtiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7d2lkdGg6MjhweDtoZWlnaHQ6MjhweDtjb2xvcjojRUY0NDQ0O2ZvbnQtc2l6ZTowLjhlbTtjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7Zm9udC13ZWlnaHQ6OTAwOyI+4pyVPC9idXR0b24+CiAgICAgICAgPC9kaXY+YCkuam9pbignJyl9CiAgICA8L2Rpdj4KICBgOwp9CgpmdW5jdGlvbiBjYWxEZWxldGVUeChtb250aEtleSwgdHlwZSwgaWR4KSB7CiAgaWYoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHRyYW5zYWN0aW9uPycpKSByZXR1cm47CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFt0eXBlXV0uc3BsaWNlKGlkeCwxKTsKICBzYXZlKCk7IHJlbmRlclRyYW5zYWN0aW9ucygpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgnVHJhbnNhY3Rpb24gZGVsZXRlZCcpOwp9CgpmdW5jdGlvbiBzZXRUeEZpbHRlcihmaWx0ZXIsIGVsKSB7IC8qIGxlZ2FjeSDigJMgbm8tb3AgaW4gY2FsZW5kYXIgdmlldyAqLyB9CgpmdW5jdGlvbiBkZWxldGVUeChtb250aEtleSwgdHlwZSwgaWR4KSB7CiAgaWYoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHRyYW5zYWN0aW9uPycpKSByZXR1cm47CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFt0eXBlXV0uc3BsaWNlKGlkeCwxKTsKICBzYXZlKCk7IHJlbmRlclRyYW5zYWN0aW9ucygpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgnVHJhbnNhY3Rpb24gZGVsZXRlZCcpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gQUREIFNDUkVFTiAoZnVsbCBzY3JlZW4gYWRkKQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gcmVuZGVyQWRkU2NyZWVuKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtZGF0ZScpLnZhbHVlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgcmVuZGVyTnVtcGFkKCk7IHJlbmRlclN1YkNhdHMoKTsKfQoKZnVuY3Rpb24gc2V0QWRkVHlwZSh0eXBlLCBidG4pIHsKICBjdXJyZW50QWRkVHlwZT10eXBlOyBjdXJyZW50QW1vdW50U3RyPScnOyB1cGRhdGVBbW91bnREaXNwbGF5KCk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFkZC10eXBlLWJ0bicpLmZvckVhY2goYj0+Yi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHJlbmRlclN1YkNhdHMoKTsKfQoKZnVuY3Rpb24gcmVuZGVyU3ViQ2F0cygpIHsKICBjb25zdCBjYXRzPWdldENhdHNGb3JUeXBlKGN1cnJlbnRBZGRUeXBlKTsKICBzZWxlY3RlZFN1YkNhdD1jYXRzWzBdfHwnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ViLWNhdHMtcm93JykuaW5uZXJIVE1MPWNhdHMubWFwKGM9PmA8ZGl2IGNsYXNzPSJzdWItY2F0LXBpbGwgJHtjPT09c2VsZWN0ZWRTdWJDYXQ/J2FjdGl2ZSc6Jyd9IiBvbmNsaWNrPSJzZWxlY3RTdWJDYXQoJyR7Y30nLHRoaXMpIj4ke2N9PC9kaXY+YCkuam9pbignJyk7Cn0KZnVuY3Rpb24gc2VsZWN0U3ViQ2F0KGNhdCxlbCkgeyBzZWxlY3RlZFN1YkNhdD1jYXQ7IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWItY2F0LXBpbGwnKS5mb3JFYWNoKHA9PnAuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOyBlbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgfQoKZnVuY3Rpb24gcmVuZGVyTnVtcGFkKCkgewogIGNvbnN0IGtleXM9Wyc3JywnOCcsJzknLCfijKsnLCc0JywnNScsJzYnLCclJywnMScsJzInLCczJywnw7cnLCckJywnMCcsJy4nLCc9J107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bXBhZC1ncmlkJykuaW5uZXJIVE1MPWtleXMubWFwKGs9PmA8YnV0dG9uIGNsYXNzPSJudW0tYnRuICR7WyfijKsnLCclJywnw7cnXS5pbmNsdWRlcyhrKT8nc3BlY2lhbCc6Jyd9ICR7az09PSc9Jz8nc2F2ZS1idG4nOicnfSIgb25jbGljaz0iaGFuZGxlTnVtcGFkKCcke2t9JykiPiR7a308L2J1dHRvbj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gaGFuZGxlTnVtcGFkKGtleSkgewogIGlmKGtleT09PSfijKsnKXtjdXJyZW50QW1vdW50U3RyPWN1cnJlbnRBbW91bnRTdHIuc2xpY2UoMCwtMSk7fQogIGVsc2UgaWYoa2V5PT09Jz0nKXtzYXZlVHJhbnNhY3Rpb24oKTtyZXR1cm47fQogIGVsc2UgaWYoa2V5PT09JyQnKXtjdXJyZW50QW1vdW50U3RyPScnO30KICBlbHNlIGlmKFsnJScsJ8O3J10uaW5jbHVkZXMoa2V5KSl7fQogIGVsc2V7aWYoY3VycmVudEFtb3VudFN0ci5pbmNsdWRlcygnLicpJiZrZXk9PT0nLicpIHJldHVybjsgaWYoY3VycmVudEFtb3VudFN0ci5sZW5ndGg+PTEwKSByZXR1cm47IGN1cnJlbnRBbW91bnRTdHIrPWtleTt9CiAgdXBkYXRlQW1vdW50RGlzcGxheSgpOwp9CmZ1bmN0aW9uIHVwZGF0ZUFtb3VudERpc3BsYXkoKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtYW1vdW50LWRpc3BsYXknKS50ZXh0Q29udGVudD1jdXJyZW50QW1vdW50U3RyfHwnMCc7IH0KCmZ1bmN0aW9uIHNhdmVUcmFuc2FjdGlvbigpIHsKICBjb25zdCBhbW91bnQ9cGFyc2VGbG9hdChjdXJyZW50QW1vdW50U3RyKTsKICBpZighYW1vdW50fHxhbW91bnQ8PTApe3Nob3dUb2FzdCgnRW50ZXIgYW4gYW1vdW50JywyMDAwKTtyZXR1cm47fQogIGNvbnN0IGRhdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1kYXRlJykudmFsdWV8fG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGNvbnN0IG5vdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1ub3RlJykudmFsdWUudHJpbSgpOwogIGNvbnN0IG1vbnRoS2V5PWdldE1vbnRoS2V5KGRhdGUpfHxnZXRDdXJyZW50TW9udGhLZXkoKTsKICBlbnN1cmVNb250aChtb250aEtleSk7CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgY29uc3QgZW50cnk9e2RhdGU6bm9ybWFsaXplRGF0ZShkYXRlKSxjYXRlZ29yeTpzZWxlY3RlZFN1YkNhdHx8J090aGVyJyxhbW91bnQsZGVzY3JpcHRpb246bm90ZSxjdXJyZW5jeTpjdXJyZW50Q3VycmVuY3kuY29kZX07CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFtjdXJyZW50QWRkVHlwZV1dLnB1c2goZW50cnkpOwogIHNhdmUoKTsgY3VycmVudEFtb3VudFN0cj0nJzsgdXBkYXRlQW1vdW50RGlzcGxheSgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtbm90ZScpLnZhbHVlPScnOwogIHNob3dUb2FzdChgU2F2ZWQhIOKchWApOwogIGlmKG1vbnRoS2V5PT09dmlld01vbnRoKSByZW5kZXJIb21lKCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBBQ0NPVU5UIFNDUkVFTgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gZ2V0QWNjb3VudHNMaXN0KCkgewogIGlmKCFkYXRhLl9hY2NvdW50cykgZGF0YS5fYWNjb3VudHM9W3tpZDonMScsbmFtZTonQ2FzaCcsdHlwZTonQ2FzaCcsYmFsYW5jZToxMDAwfSx7aWQ6JzInLG5hbWU6J1BheXBhbCcsdHlwZTonRGViaXQnLGJhbGFuY2U6MTUwMH0se2lkOiczJyxuYW1lOidCYW5rJyx0eXBlOidEZWJpdCcsYmFsYW5jZTo1MDAwfV07CiAgcmV0dXJuIGRhdGEuX2FjY291bnRzOwp9CmZ1bmN0aW9uIHJlbmRlckFjY291bnQoKSB7CiAgY29uc3QgYWNjb3VudHM9Z2V0QWNjb3VudHNMaXN0KCk7CiAgbGV0IHRvdGFsQXNzZXRzPTAsIHRvdGFsRGVidD0wOwogIGFjY291bnRzLmZvckVhY2goYT0+eyBpZihhLnR5cGU9PT0nQ3JlZGl0JykgdG90YWxEZWJ0Kz1NYXRoLmFicyhOdW1iZXIoYS5iYWxhbmNlfHwwKSk7IGVsc2UgdG90YWxBc3NldHMrPU51bWJlcihhLmJhbGFuY2V8fDApOyB9KTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYW1vdW50JykudGV4dENvbnRlbnQ9Zm10KHRvdGFsQXNzZXRzLXRvdGFsRGVidCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWFzc2V0cycpLnRleHRDb250ZW50PWZtdCh0b3RhbEFzc2V0cyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWxpYWJpbGl0aWVzJykudGV4dENvbnRlbnQ9Jy0nK2ZtdCh0b3RhbERlYnQpOwogIGNvbnN0IGFjY0ljb25zPXtEZWJpdDon8J+PpicsQ2FzaDon8J+StScsSW52ZXN0bWVudDon8J+TiCcsQ3JlZGl0Oifwn5KzJ307CiAgY29uc3QgcmVuZGVyR3JpZD1saXN0PT5saXN0Lm1hcChhPT5gPGRpdiBjbGFzcz0iYWNjb3VudC1jYXJkICR7YS50eXBlPT09J0NyZWRpdCc/J2NyZWRpdCc6Jyd9IiBvbmNsaWNrPSJlZGl0QWNjb3VudCgnJHthLmlkfScpIj48ZGl2IGNsYXNzPSJhY2MtaWNvbiI+JHthY2NJY29uc1thLnR5cGVdfHwn8J+SsCd9PC9kaXY+PGRpdiBjbGFzcz0iYWNjLW5hbWUiPiR7YS5uYW1lfTwvZGl2PjxkaXYgY2xhc3M9ImFjYy1hbW91bnQiPiR7YS50eXBlPT09J0NyZWRpdCc/Jy0nOicnfSR7Zm10KGEuYmFsYW5jZXx8MCl9PC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtYXNzZXRzLWdyaWQnKS5pbm5lckhUTUw9cmVuZGVyR3JpZChhY2NvdW50cy5maWx0ZXIoYT0+YS50eXBlIT09J0NyZWRpdCcpKXx8JzxwIHN0eWxlPSJjb2xv','cjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO3BhZGRpbmc6OHB4OyI+Tm8gYXNzZXRzIHlldDwvcD4nOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWRlYnRzLWdyaWQnKS5pbm5lckhUTUw9cmVuZGVyR3JpZChhY2NvdW50cy5maWx0ZXIoYT0+YS50eXBlPT09J0NyZWRpdCcpKXx8JzxwIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO3BhZGRpbmc6OHB4OyI+Tm8gbGlhYmlsaXRpZXM8L3A+JzsKfQpmdW5jdGlvbiBzaG93QWRkQWNjb3VudE1vZGFsKCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjLW5hbWUtaW5wdXQnKS52YWx1ZT0nJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjYy1iYWxhbmNlLWlucHV0JykudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtYWNjb3VudC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsgfQpmdW5jdGlvbiBzYXZlQWNjb3VudCgpIHsKICBjb25zdCBuYW1lPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2MtbmFtZS1pbnB1dCcpLnZhbHVlLnRyaW0oKSwgdHlwZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjLXR5cGUtaW5wdXQnKS52YWx1ZSwgYmFsYW5jZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2MtYmFsYW5jZS1pbnB1dCcpLnZhbHVlKXx8MDsKICBpZighbmFtZSl7c2hvd1RvYXN0KCdFbnRlciBhY2NvdW50IG5hbWUnKTtyZXR1cm47fQogIGlmKCFkYXRhLl9hY2NvdW50cykgZGF0YS5fYWNjb3VudHM9W107CiAgZGF0YS5fYWNjb3VudHMucHVzaCh7aWQ6RGF0ZS5ub3coKS50b1N0cmluZygpLG5hbWUsdHlwZSxiYWxhbmNlfSk7CiAgc2F2ZSgpOyBjbG9zZU1vZGFsKCdhZGQtYWNjb3VudC1tb2RhbCcpOyByZW5kZXJBY2NvdW50KCk7IHNob3dUb2FzdCgnQWNjb3VudCBhZGRlZCEnKTsKfQpmdW5jdGlvbiBlZGl0QWNjb3VudChpZCkgeyBjb25zdCBhY2M9Z2V0QWNjb3VudHNMaXN0KCkuZmluZChhPT5hLmlkPT09aWQpOyBpZighYWNjKSByZXR1cm47IGNvbnN0IG5iPXByb21wdChgQmFsYW5jZSBmb3IgJHthY2MubmFtZX06YCxhY2MuYmFsYW5jZSk7IGlmKG5iPT09bnVsbCkgcmV0dXJuOyBhY2MuYmFsYW5jZT1wYXJzZUZsb2F0KG5iKXx8MDsgc2F2ZSgpOyByZW5kZXJBY2NvdW50KCk7IH0KZnVuY3Rpb24gY2xvc2VNb2RhbChpZCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOyB9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gREFUQSBTQ1JFRU4KLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0KCkgewogIGNvbnN0IHNlbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKTsKICBjb25zdCBjdXI9c2VsLnZhbHVlOwogIGNvbnN0IGN1cnJlbnRLZXk9Z2V0Q3VycmVudE1vbnRoS2V5KCk7CiAgc2VsLmlubmVySFRNTD0nJzsKICBsZXQgb3B0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOyBvcHQudmFsdWU9Y3VycmVudEtleTsgb3B0LnRleHRDb250ZW50PSdDdXJyZW50OiAnK2dldERpc3BsYXlNb250aChjdXJyZW50S2V5KTsgc2VsLmFwcGVuZENoaWxkKG9wdCk7CiAgT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKGs9PiFrLnN0YXJ0c1dpdGgoJ18nKSYmayE9PWN1cnJlbnRLZXkpLnNvcnQoKGEsYik9PmIubG9jYWxlQ29tcGFyZShhKSkuZm9yRWFjaChrZXk9PnsKICAgIG9wdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsgb3B0LnZhbHVlPWtleTsgb3B0LnRleHRDb250ZW50PWdldERpc3BsYXlNb250aChrZXkpOyBzZWwuYXBwZW5kQ2hpbGQob3B0KTsKICB9KTsKICBpZihjdXImJlsuLi5zZWwub3B0aW9uc10uc29tZShvPT5vLnZhbHVlPT09Y3VyKSkgc2VsLnZhbHVlPWN1cjsgZWxzZSBzZWwudmFsdWU9Y3VycmVudEtleTsKfQoKZnVuY3Rpb24gZ2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSkgewogIGNvbnN0IHNlbGVjdGVkTW9udGg9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7CiAgY29uc3Qgc3RhcnREYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhLWZpbHRlci1zdGFydCcpLnZhbHVlOwogIGNvbnN0IGVuZERhdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtZmlsdGVyLWVuZCcpLnZhbHVlOwogIGNvbnN0IGlzR2xvYmFsPSEhKHN0YXJ0RGF0ZXx8ZW5kRGF0ZSk7CiAgbGV0IGxpc3Q9W107CiAgaWYoaXNHbG9iYWwpewogICAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChtS2V5PT57IGlmKGRhdGFbbUtleV1bdHlwZV0pIGRhdGFbbUtleV1bdHlwZV0uZm9yRWFjaCgoZSxpKT0+bGlzdC5wdXNoKHsuLi5lLF9tb250aDptS2V5LF9pZHg6aX0pKTsgfSk7CiAgfSBlbHNlIHsKICAgIGVuc3VyZU1vbnRoKHNlbGVjdGVkTW9udGgpOwogICAgKGRhdGFbc2VsZWN0ZWRNb250aF1bdHlwZV18fFtdKS5mb3JFYWNoKChlLGkpPT5saXN0LnB1c2goey4uLmUsX21vbnRoOnNlbGVjdGVkTW9udGgsX2lkeDppfSkpOwogIH0KICByZXR1cm4gbGlzdC5maWx0ZXIoZT0+eyBpZighaXNHbG9iYWwpIHJldHVybiB0cnVlOyBpZighZS5kYXRlKSByZXR1cm4gdHJ1ZTsgaWYoc3RhcnREYXRlJiZlLmRhdGU8c3RhcnREYXRlKSByZXR1cm4gZmFsc2U7IGlmKGVuZERhdGUmJmUuZGF0ZT5lbmREYXRlKSByZXR1cm4gZmFsc2U7IHJldHVybiB0cnVlOyB9KTsKfQoKZnVuY3Rpb24gZGF0YVNvcnRFbnRyaWVzKGVudHJpZXMsIHR5cGUpIHsKICBsZXQgY29sPW51bGwsIGRpcj0nYXNjJzsKICBPYmplY3Qua2V5cyhkYXRhU29ydFN0YXRlKS5mb3JFYWNoKGs9PnsgaWYoay5zdGFydHNXaXRoKHR5cGUrJy0nKSl7Y29sPWsuc3BsaXQoJy0nKS5zbGljZSgxKS5qb2luKCctJyk7ZGlyPWRhdGFTb3J0U3RhdGVba107fSB9KTsKICBpZighY29sKSByZXR1cm4gZW50cmllczsKICByZXR1cm4gWy4uLmVudHJpZXNdLnNvcnQoKGEsYik9PnsKICAgIGxldCB2YSx2YjsKICAgIGlmKGNvbD09PSdkYXRlJyl7dmE9bmV3IERhdGUoYS5kYXRlfHwnMTkwMC0wMS0wMScpO3ZiPW5ldyBEYXRlKGIuZGF0ZXx8JzE5MDAtMDEtMDEnKTt9CiAgICBlbHNlIGlmKFsnYW1vdW50Jywnd2VpZ2h0R21zJywncHVyY2hhc2VWYWx1ZScsJ2N1cnJlbnRWYWx1ZSddLmluY2x1ZGVzKGNvbCkpe3ZhPXBhcnNlRmxvYXQoYVtjb2xdfHwwKTt2Yj1wYXJzZUZsb2F0KGJbY29sXXx8MCk7fQogICAgZWxzZXt2YT1TdHJpbmcoYVtjb2xdfHwnJykudG9Mb3dlckNhc2UoKTt2Yj1TdHJpbmcoYltjb2xdfHwnJykudG9Mb3dlckNhc2UoKTt9CiAgICByZXR1cm4gZGlyPT09J2FzYyc/KHZhPnZiPzE6LTEpOih2YTx2Yj8xOi0xKTsKICB9KTsKfQpmdW5jdGlvbiB0b2dnbGVEYXRhU29ydCh0eXBlLCBjb2wpIHsgY29uc3Qgaz1gJHt0eXBlfS0ke2NvbH1gOyBkYXRhU29ydFN0YXRlW2tdPSghZGF0YVNvcnRTdGF0ZVtrXXx8ZGF0YVNvcnRTdGF0ZVtrXT09PSdkZXNjJyk/J2FzYyc6J2Rlc2MnOyByZW5kZXJEYXRhU2NyZWVuKCk7IH0KZnVuY3Rpb24gc29ydEFycm93KHR5cGUsY29sKXtjb25zdCBrPWAke3R5cGV9LSR7Y29sfWA7cmV0dXJuIGRhdGFTb3J0U3RhdGVba109PT0nYXNjJz8nIOKGkSc6ZGF0YVNvcnRTdGF0ZVtrXT09PSdkZXNjJz8nIOKGkyc6JyDihpUnO30KCmZ1bmN0aW9uIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24odHlwZSwgbGFiZWwsIGljb24sIGNvbG9yKSB7CiAgY29uc3Qgc2VsZWN0ZWRNb250aD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKS52YWx1ZTsKICBsZXQgZW50cmllcz1kYXRhU29ydEVudHJpZXMoZ2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSksdHlwZSk7CiAgY29uc3QgdG90YWw9ZW50cmllcy5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKTsKICByZXR1cm4gYDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbiI+CiAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24taGVhZGVyIiBvbmNsaWNrPSJ0aGlzLm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJykiPgogICAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24tdGl0bGUiPiR7aWNvbn0gJHtsYWJlbH0gPHNwYW4gc3R5bGU9ImJhY2tncm91bmQ6I0YwRjBGMDtib3JkZXItcmFkaXVzOjIwcHg7cGFkZGluZzoycHggOHB4O2ZvbnQtc2l6ZTowLjgyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+JHtlbnRyaWVzLmxlbmd0aH08L3NwYW4+PC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7Ij4KICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1zZWN0aW9uLXRvdGFsIiBzdHlsZT0iY29sb3I6JHtjb2xvcn07Ij4kJHt0b3RhbC50b0ZpeGVkKDIpfTwvc3Bhbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uLWJ0biBkYW5nZXIiIG9uY2xpY2s9ImNsZWFyRGF0YVNlY3Rpb24oJyR7c2VsZWN0ZWRNb250aH0nLCcke3R5cGV9Jyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5eR77iPPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4iIG9uY2xpY2s9ImV4cG9ydERhdGFDYXRlZ29yeSgnJHt0eXBlfScpO2V2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyI+8J+TpTwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLWJvZHkiPgogICAgICAke2VudHJpZXMubGVuZ3RoID8gYDxkaXYgY2xhc3M9ImRhdGEtdGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJkYXRhLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+PHRyPgogICAgICAgICAgPHRoIG9uY2xpY2s9InRvZ2dsZURhdGFTb3J0KCcke3R5cGV9JywnZGF0ZScpIj5EYXRlJHtzb3J0QXJyb3codHlwZSwnZGF0ZScpfTwvdGg+CiAgICAgICAgICA8dGggb25jbGljaz0idG9nZ2xlRGF0YVNvcnQoJyR7dHlwZX0nLCdjYXRlZ29yeScpIj5DYXRlZ29yeSR7c29ydEFycm93KHR5cGUsJ2NhdGVnb3J5Jyl9PC90aD4KICAgICAgICAgIDx0aCBvbmNsaWNrPSJ0b2dnbGVEYXRhU29ydCgnJHt0eXBlfScsJ2Ftb3VudCcpIj5BbW91bnQke3NvcnRBcnJvdyh0eXBlLCdhbW91bnQnKX08L3RoPgogICAgICAgICAgPHRoIG9uY2xpY2s9InRvZ2dsZURhdGFTb3J0KCcke3R5cGV9JywnZGVzY3JpcHRpb24nKSI+RGVzY3JpcHRpb24ke3NvcnRBcnJvdyh0eXBlLCdkZXNjcmlwdGlvbicpfTwvdGg+CiAgICAgICAgICA8dGg+QWN0aW9uPC90aD4KICAgICAgICA8L3RyPjwvdGhlYWQ+CiAgICAgICAgPHRib2R5PiR7ZW50cmllcy5tYXAocm93PT5gPHRyPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhU3RhbmRhcmQoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSwnZGF0ZScsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmRhdGV9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVN0YW5kYXJkKCcke3Jvdy5fbW9udGh9JywnJHt0eXBlfScsJHtyb3cuX2lkeH0sJ2NhdGVnb3J5Jyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cuY2F0ZWdvcnl9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRp','dGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVN0YW5kYXJkKCcke3Jvdy5fbW9udGh9JywnJHt0eXBlfScsJHtyb3cuX2lkeH0sJ2Ftb3VudCcsdGhpcy50ZXh0Q29udGVudCkiIHN0eWxlPSJjb2xvcjoke051bWJlcihyb3cuYW1vdW50KTwwPyd2YXIoLS1leHBlbnNlcyknOidpbmhlcml0J307Ij4kJHtOdW1iZXIocm93LmFtb3VudCkudG9GaXhlZCgyKX08L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhU3RhbmRhcmQoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSwnZGVzY3JpcHRpb24nLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5kZXNjcmlwdGlvbnx8Jyd9PC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSkiPsOXPC9idXR0b24+PC90ZD4KICAgICAgICA8L3RyPmApLmpvaW4oJycpfTwvdGJvZHk+CiAgICAgIDwvdGFibGU+PC9kaXY+YCA6ICc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gZW50cmllczwvZGl2Pid9CiAgICAgIDxkaXYgY2xhc3M9InF1aWNrLWFkZC1yb3ciPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1kYXRlLSR7dHlwZX0iIHN0eWxlPSJtaW4td2lkdGg6MTEwcHg7ZmxleDowOyI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGxpc3Q9ImNhdGxpc3QiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWNhdC0ke3R5cGV9IiBwbGFjZWhvbGRlcj0iQ2F0ZWdvcnkiPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWFtdC0ke3R5cGV9IiBwbGFjZWhvbGRlcj0iQW1vdW50IiBzdGVwPSIwLjAxIiBzdHlsZT0ibWF4LXdpZHRoOjExMHB4OyI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWRlc2MtJHt0eXBlfSIgcGxhY2Vob2xkZXI9IkRlc2NyaXB0aW9uIj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJxYS1idG4iIG9uY2xpY2s9ImFkZERhdGFSb3coJyR7c2VsZWN0ZWRNb250aH0nLCcke3R5cGV9JykiPisgQWRkPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtcGFuZWwiPgogICAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1wYW5lbC10aXRsZSI+8J+TpSBJbXBvcnQg4oCUIFBhc3RlOiBkYXRlIGNhdGVnb3J5IGFtb3VudCBkZXNjcmlwdGlvbjwvZGl2PgogICAgICAgIDx0ZXh0YXJlYSBjbGFzcz0icGFzdGUtYXJlYSIgaWQ9InBhc3RlLSR7dHlwZX0iPjwvdGV4dGFyZWE+CiAgICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LWNvbnRyb2xzIj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJwYXJzZVBhc3RlKCcke3NlbGVjdGVkTW9udGh9JywnJHt0eXBlfScpIj5JbXBvcnQgVGV4dDwvYnV0dG9uPgogICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJmaWxlLSR7dHlwZX0iIGFjY2VwdD0iLmNzdiwueGxzeCIgc3R5bGU9ImZvbnQtc2l6ZTowLjgyZW07Ij4KICAgICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJpbXBvcnRGaWxlKCcke3NlbGVjdGVkTW9udGh9JywnJHt0eXBlfScpIj5JbXBvcnQgRmlsZTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHJlbmRlckRhdGFNZXRhbHNTZWN0aW9uKCkgewogIGNvbnN0IHNlbGVjdGVkTW9udGg9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7CiAgbGV0IGVudHJpZXM9Z2V0RGF0YUVmZmVjdGl2ZUVudHJpZXMoJ21ldGFscycpOwogIGNvbnN0IHdlaWdodHM9e307CiAgZW50cmllcy5mb3JFYWNoKGU9PnsgY29uc3QgdD0oZS5tZXRhbFR5cGV8fCdHb2xkJykudHJpbSgpOyB3ZWlnaHRzW3RdPSh3ZWlnaHRzW3RdfHwwKSsoTnVtYmVyKGUud2VpZ2h0R21zKXx8MCk7IH0pOwogIGNvbnN0IHN1bW1hcnk9T2JqZWN0LmtleXMod2VpZ2h0cykubGVuZ3RoP09iamVjdC5lbnRyaWVzKHdlaWdodHMpLm1hcCgoW2ssdl0pPT5gPGI+JHtrfTwvYj46ICR7di50b0ZpeGVkKDIpfWdgKS5qb2luKCcgfCAnKTonTm8gRGF0YSc7CiAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLWhlYWRlciIgb25jbGljaz0idGhpcy5uZXh0RWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpIj4KICAgICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLXRpdGxlIj7wn6WHIE1ldGFscyA8c21hbGwgc3R5bGU9Im9wYWNpdHk6MC43O2ZvbnQtc2l6ZTowLjg1ZW07Ij4oJHtlbnRyaWVzLmxlbmd0aH0pPC9zbWFsbD48L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDsiPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC44ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPiR7c3VtbWFyeX08L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4gZGFuZ2VyIiBvbmNsaWNrPSJjbGVhckRhdGFTZWN0aW9uKCcke3NlbGVjdGVkTW9udGh9JywnbWV0YWxzJyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5eR77iPPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4iIG9uY2xpY2s9ImV4cG9ydERhdGFDYXRlZ29yeSgnbWV0YWxzJyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5OlPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24tYm9keSI+CiAgICAgICR7ZW50cmllcy5sZW5ndGg/YDxkaXYgY2xhc3M9ImRhdGEtdGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJkYXRhLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+PHRyPjx0aD5NZXRhbDwvdGg+PHRoPlB1cml0eTwvdGg+PHRoPk9jY2FzaW9uPC90aD48dGg+SXRlbTwvdGg+PHRoPldlaWdodDwvdGg+PHRoPkFjdGlvbjwvdGg+PC90cj48L3RoZWFkPgogICAgICAgIDx0Ym9keT4ke2VudHJpZXMubWFwKHJvdz0+YDx0cj4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YU1ldGFsKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnbWV0YWxUeXBlJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cubWV0YWxUeXBlfHwnJ308L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhTWV0YWwoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdwdXJpdHknLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5wdXJpdHl8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ29jY2FzaW9uJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cub2NjYXNpb258fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2l0ZW1OYW1lJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cuaXRlbU5hbWV8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ3dlaWdodEdtcycsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LndlaWdodEdtc3x8MH1nPC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCdtZXRhbHMnLCR7cm93Ll9pZHh9KSI+w5c8L2J1dHRvbj48L3RkPgogICAgICAgIDwvdHI+YCkuam9pbignJyl9PC90Ym9keT4KICAgICAgPC90YWJsZT48L2Rpdj5gOic8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gbWV0YWxzPC9kaXY+J30KICAgICAgPGRpdiBjbGFzcz0icXVpY2stYWRkLXJvdyI+CiAgICAgICAgPHNlbGVjdCBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC10eXBlIiBzdHlsZT0ibWF4LXdpZHRoOjEwMHB4OyI+PG9wdGlvbj5Hb2xkPC9vcHRpb24+PG9wdGlvbj5TaWx2ZXI8L29wdGlvbj48b3B0aW9uPlBsYXRpbnVtPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLW1ldGFsLXB1cml0eSIgcGxhY2Vob2xkZXI9IlB1cml0eSI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLW1ldGFsLW9jY2FzaW9uIiBwbGFjZWhvbGRlcj0iT2NjYXNpb24iPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC1pdGVtIiBwbGFjZWhvbGRlcj0iSXRlbSBOYW1lIj4KICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC13ZWlnaHQiIHBsYWNlaG9sZGVyPSJXZWlnaHQgKGcpIiBzdHlsZT0ibWF4LXdpZHRoOjEwMHB4OyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtYnRuIiBvbmNsaWNrPSJhZGREYXRhTWV0YWxSb3coJyR7c2VsZWN0ZWRNb250aH0nKSI+KyBBZGQ8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj5gOwp9CgpmdW5jdGlvbiByZW5kZXJEYXRhUmVhbEVzdGF0ZVNlY3Rpb24oKSB7CiAgY29uc3Qgc2VsZWN0ZWRNb250aD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKS52YWx1ZTsKICBsZXQgZW50cmllcz1nZXREYXRhRWZmZWN0aXZlRW50cmllcygncmVhbEVzdGF0ZScpOwogIGNvbnN0IHRvdGFscz17fTsKICBlbnRyaWVzLmZvckVhY2gocj0+eyBjb25zdCBjPShyLmN1cnJlbmN5fHwnVVNEJykudG9VcHBlckNhc2UoKTsgaWYoIXRvdGFsc1tjXSkgdG90YWxzW2NdPXtwOjAsY3Y6MH07IHRvdGFsc1tjXS5wKz1OdW1iZXIoci5wdXJjaGFzZVZhbHVlfHwwKTsgdG90YWxzW2NdLmN2Kz1OdW1iZXIoci5jdXJyZW50VmFsdWV8fDApOyB9KTsKICBjb25zdCBzdW1tYXJ5PU9iamVjdC5lbnRyaWVzKHRvdGFscykubGVuZ3RoP09iamVjdC5lbnRyaWVzKHRvdGFscykubWFwKChbYyx2XSk9PmA8Yj4ke2N9PC9iPjogSW52ICR7Z2V0Q29tcGFjdE51bSh2LnApfSAvIEN1ciAke2dldENvbXBhY3ROdW0odi5jdil9YCkuam9pbignIHwgJyk6J05vIERhdGEnOwogIHJldHVybiBgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uIj4KICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi1oZWFkZXIiIG9uY2xpY2s9InRoaXMubmV4dEVsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKSI+CiAgICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi10aXRsZSI+8J+PoSBSZWFsIEVzdGF0ZSA8c21hbGwgc3R5bGU9Im9wYWNpdHk6MC43O2ZvbnQtc2l6ZTowLjg1ZW07Ij4oJHtlbnRyaWVzLmxlbmd0aH0pPC9zbWFsbD48L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDsiPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC44ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPiR7c3VtbWFyeX08L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4gZGFuZ2VyIiBvbmNsaWNrPSJjbGVhckRhdGFTZWN0aW9uKCcke3NlbGVjdGVkTW9udGh9Jywn','cmVhbEVzdGF0ZScpO2V2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyI+8J+Xke+4jzwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJleHBvcnREYXRhQ2F0ZWdvcnkoJ3JlYWxFc3RhdGUnKTtldmVudC5zdG9wUHJvcGFnYXRpb24oKTsiPvCfk6U8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi1ib2R5Ij4KICAgICAgJHtlbnRyaWVzLmxlbmd0aD9gPGRpdiBjbGFzcz0iZGF0YS10YWJsZS13cmFwIj48dGFibGUgY2xhc3M9ImRhdGEtdGFibGUiPgogICAgICAgIDx0aGVhZD48dHI+PHRoPkRhdGU8L3RoPjx0aD5Db3VudHJ5PC90aD48dGg+Q3VycmVuY3k8L3RoPjx0aD5QdXJjaGFzZTwvdGg+PHRoPkRlc2NyaXB0aW9uPC90aD48dGg+QXJlYTwvdGg+PHRoPkN1cnJlbnQgVmFsdWU8L3RoPjx0aD5BY3Rpb248L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICA8dGJvZHk+JHtlbnRyaWVzLm1hcChyb3c9Pntjb25zdCBzeW09Z2V0Q3VycmVuY3lTeW1ib2wocm93LmN1cnJlbmN5KTtyZXR1cm5gPHRyPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2RhdGUnLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5kYXRlfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFSZWFsRXN0YXRlKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnY291bnRyeScsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmNvdW50cnl8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFSZWFsRXN0YXRlKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnY3VycmVuY3knLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5jdXJyZW5jeXx8J1VTRCd9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVJlYWxFc3RhdGUoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdwdXJjaGFzZVZhbHVlJyx0aGlzLnRleHRDb250ZW50KSI+JHtzeW19JHtOdW1iZXIocm93LnB1cmNoYXNlVmFsdWV8fDApLnRvTG9jYWxlU3RyaW5nKCl9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVJlYWxFc3RhdGUoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdkZXNjcmlwdGlvbicsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmRlc2NyaXB0aW9ufHwnJ308L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2FyZWFDZW50cycsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmFyZWFDZW50c3x8MH08L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2N1cnJlbnRWYWx1ZScsdGhpcy50ZXh0Q29udGVudCkiPiR7c3ltfSR7TnVtYmVyKHJvdy5jdXJyZW50VmFsdWV8fDApLnRvTG9jYWxlU3RyaW5nKCl9PC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCdyZWFsRXN0YXRlJywke3Jvdy5faWR4fSkiPsOXPC9idXR0b24+PC90ZD4KICAgICAgICA8L3RyPmA7fSkuam9pbignJyl9PC90Ym9keT4KICAgICAgPC90YWJsZT48L2Rpdj5gOic8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gZW50cmllczwvZGl2Pid9CiAgICAgIDxkaXYgY2xhc3M9InF1aWNrLWFkZC1yb3ciPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1kYXRlIiBzdHlsZT0ibWluLXdpZHRoOjExMHB4O2ZsZXg6MDsiPgogICAgICAgIDxzZWxlY3QgY2xhc3M9InFhLWlucHV0IiBpZD0icWEtcmUtY291bnRyeSIgc3R5bGU9Im1heC13aWR0aDo5MHB4OyI+PG9wdGlvbiB2YWx1ZT0iVVMiPlVTPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iSW5kaWEiPkluZGlhPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgPHNlbGVjdCBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1jdXJyZW5jeSIgc3R5bGU9Im1heC13aWR0aDo4MHB4OyI+PG9wdGlvbj5VU0Q8L29wdGlvbj48b3B0aW9uPklOUjwvb3B0aW9uPjwvc2VsZWN0PgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLXJlLXB1cmNoYXNlIiBwbGFjZWhvbGRlcj0iUHVyY2hhc2UgVmFsdWUiPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1kZXNjIiBwbGFjZWhvbGRlcj0iRGVzY3JpcHRpb24iPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLXJlLWFyZWEiIHBsYWNlaG9sZGVyPSJBcmVhIj4KICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1jdXJyZW50IiBwbGFjZWhvbGRlcj0iQ3VycmVudCBWYWx1ZSI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtYnRuIiBvbmNsaWNrPSJhZGREYXRhUmVhbEVzdGF0ZVJvdygnJHtzZWxlY3RlZE1vbnRofScpIj4rIEFkZDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHJlbmRlckRhdGFTY3JlZW4oKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtc2VjdGlvbnMnKS5pbm5lckhUTUw9WwogICAgcmVuZGVyRGF0YVN0YW5kYXJkU2VjdGlvbignaW5jb21lJywnSW5jb21lJywn8J+StScsJyMxMEI5ODEnKSwKICAgIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24oJ2V4cGVuc2VzJywnRXhwZW5zZXMnLCfwn5K4JywnI0VGNDQ0NCcpLAogICAgcmVuZGVyRGF0YVN0YW5kYXJkU2VjdGlvbignaW52ZXN0bWVudHMnLCdJbnZlc3RtZW50cycsJ/Cfko4nLCcjN0MzQUVEJyksCiAgICByZW5kZXJEYXRhUmVhbEVzdGF0ZVNlY3Rpb24oKSwKICAgIHJlbmRlckRhdGFNZXRhbHNTZWN0aW9uKCksCiAgICByZW5kZXJEYXRhU3RhbmRhcmRTZWN0aW9uKCdhZGRpdGlvbmFsJywnQWRkaXRpb25hbCcsJ/CfjoEnLCcjRjU5RTBCJyksCiAgICByZW5kZXJEYXRhU3RhbmRhcmRTZWN0aW9uKCdkZWJ0cycsJ0RlYnRzJywn8J+TiScsJyNFRjQ0NDQnKSwKICAgIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24oJ2dpdmVuVG9PdGhlcnMnLCdHaXZlbiBUbyBPdGhlcnMnLCfwn6SdJywnI0VDNDg5OScpLAogIF0uam9pbignJyk7Cn0KCmZ1bmN0aW9uIGNsZWFyRGF0YUZpbHRlcigpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtZmlsdGVyLXN0YXJ0JykudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhLWZpbHRlci1lbmQnKS52YWx1ZT0nJzsgcmVuZGVyRGF0YVNjcmVlbigpOyB9CmZ1bmN0aW9uIGRlbGV0ZUN1cnJlbnREYXRhTW9udGgoKSB7IGNvbnN0IGs9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7IGlmKCFjb25maXJtKGBEZWxldGUgYWxsIGRhdGEgZm9yICR7a30/YCkpIHJldHVybjsgZGVsZXRlIGRhdGFba107IHNhdmUoKTsgcG9wdWxhdGVEYXRhTW9udGhTZWxlY3QoKTsgcmVuZGVyRGF0YVNjcmVlbigpOyB9CmZ1bmN0aW9uIGNsZWFyRGF0YVNlY3Rpb24obW9udGhLZXksdHlwZSkgeyBpZighY29uZmlybShgQ2xlYXIgYWxsICR7dHlwZX0gZm9yIHRoaXMgdmlldz9gKSkgcmV0dXJuOyBlbnN1cmVNb250aChtb250aEtleSk7IGRhdGFbbW9udGhLZXldW3R5cGVdPVtdOyBzYXZlKCk7IHJlbmRlckRhdGFTY3JlZW4oKTsgfQpmdW5jdGlvbiByZW1vdmVEYXRhRW50cnkobW9udGhLZXksdHlwZSxpZHgpIHsgaWYoIWNvbmZpcm0oJ0RlbGV0ZT8nKSkgcmV0dXJuOyBkYXRhW21vbnRoS2V5XVt0eXBlXS5zcGxpY2UoaWR4LDEpOyBzYXZlKCk7IHJlbmRlckRhdGFTY3JlZW4oKTsgc2hvd1RvYXN0KCdFbnRyeSBkZWxldGVkJyk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YVN0YW5kYXJkKG1vbnRoS2V5LHR5cGUsaWR4LGZpZWxkLHZhbCkgeyBpZihmaWVsZD09PSdkYXRlJykgdmFsPW5vcm1hbGl6ZURhdGUodmFsKTsgaWYoZmllbGQ9PT0nYW1vdW50JykgdmFsPXBhcnNlRmxvYXQodmFsLnJlcGxhY2UoL1teMC05Li1dL2csJycpKXx8MDsgZGF0YVttb250aEtleV1bdHlwZV1baWR4XVtmaWVsZF09dmFsOyBzYXZlKCk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YU1ldGFsKG1vbnRoS2V5LGlkeCxmaWVsZCx2YWwpIHsgaWYoZmllbGQ9PT0nd2VpZ2h0R21zJykgdmFsPXBhcnNlRmxvYXQodmFsLnJlcGxhY2UoL1teMC05Ll0vZywnJykpfHwwOyBkYXRhW21vbnRoS2V5XS5tZXRhbHNbaWR4XVtmaWVsZF09dmFsOyBzYXZlKCk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YVJlYWxFc3RhdGUobW9udGhLZXksaWR4LGZpZWxkLHZhbCkgeyBpZihmaWVsZD09PSdkYXRlJykgdmFsPW5vcm1hbGl6ZURhdGUodmFsKTsgaWYoWydwdXJjaGFzZVZhbHVlJywnY3VycmVudFZhbHVlJywnYXJlYUNlbnRzJ10uaW5jbHVkZXMoZmllbGQpKSB2YWw9cGFyc2VGbG9hdCh2YWwucmVwbGFjZSgvW14wLTkuLV0vZywnJykpfHwwOyBkYXRhW21vbnRoS2V5XS5yZWFsRXN0YXRlW2lkeF1bZmllbGRdPXZhbDsgc2F2ZSgpOyB9CgpmdW5jdGlvbiBhZGREYXRhUm93KG1vbnRoS2V5LHR5cGUpIHsKICBjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWRhdGUtJHt0eXBlfWApLnZhbHVlKSwgY2F0ZWdvcnk9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWNhdC0ke3R5cGV9YCkudmFsdWUudHJpbSgpLCBhbW91bnQ9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcWEtYW10LSR7dHlwZX1gKS52YWx1ZSl8fDAsIGRlc2NyaXB0aW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kZXNjLSR7dHlwZX1gKS52YWx1ZS50cmltKCk7CiAgaWYoIWRhdGV8fCFjYXRlZ29yeSl7c2hvd1RvYXN0KCdEYXRlIGFuZCBDYXRlZ29yeSByZXF1aXJlZCcpO3JldHVybjt9CiAgY29uc3QgdGFyZ2V0TW9udGg9Z2V0TW9udGhLZXkoZGF0ZSl8fG1vbnRoS2V5OyBlbnN1cmVNb250aCh0YXJnZXRNb250aCk7CiAgZGF0YVt0YXJnZXRNb250aF1bdHlwZV0ucHVzaCh7ZGF0ZSxjYXRlZ29yeSxhbW91bnQsZGVzY3JpcHRpb259KTsgc2F2ZSgpOyByZW5kZXJEYXRhU2NyZWVuKCk7IHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0KCk7CiAgaWYodGFyZ2V0TW9udGghPT1tb250aEtleSkgc2hvd1RvYXN0KGDinIUgQWRkZWQgdG8gJHtnZXREaXNwbGF5TW9udGgodGFyZ2V0TW9udGgpfWApOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kYXRlLSR7dHlwZX1gKS52YWx1ZT0nJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWFtdC0ke3R5cGV9YCkudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kZXNjLSR7dHlwZX1gKS52YWx1ZT0nJzsKfQoKZnVuY3Rpb24gYWRkRGF0YU1ldGFsUm93KG1vbnRoS2V5KSB7CiAgY29uc3QgbWV0YWxUeXBlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC10eXBlJykudmFsdWUsIHB1cml0eT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtcHVyaXR5JykudmFsdWUsIG9jY2FzaW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1vY2Nhc2lvbicpLnZhbHVlLCBpdGVtTmFtZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtaXRlbScpLnZhbHVlLCB3ZWlnaHRHbXM9cGFyc2VGbG9h','dChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtd2VpZ2h0JykudmFsdWUpfHwwOwogIGlmKCFpdGVtTmFtZXx8IXdlaWdodEdtcyl7c2hvd1RvYXN0KCdJdGVtIGFuZCBXZWlnaHQgcmVxdWlyZWQnKTtyZXR1cm47fQogIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsgZGF0YVttb250aEtleV0ubWV0YWxzLnB1c2goe21ldGFsVHlwZSxwdXJpdHksb2NjYXNpb24saXRlbU5hbWUsd2VpZ2h0R21zfSk7IHNhdmUoKTsgcmVuZGVyRGF0YVNjcmVlbigpOwp9CgpmdW5jdGlvbiBhZGREYXRhUmVhbEVzdGF0ZVJvdyhtb250aEtleSkgewogIGNvbnN0IGRhdGU9bm9ybWFsaXplRGF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtZGF0ZScpLnZhbHVlKSwgY291bnRyeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtY291bnRyeScpLnZhbHVlLCBjdXJyZW5jeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtY3VycmVuY3knKS52YWx1ZSwgcHVyY2hhc2VWYWx1ZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1yZS1wdXJjaGFzZScpLnZhbHVlKXx8MCwgZGVzY3JpcHRpb249ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLXJlLWRlc2MnKS52YWx1ZSwgYXJlYUNlbnRzPXBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLXJlLWFyZWEnKS52YWx1ZSl8fDAsIGN1cnJlbnRWYWx1ZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1yZS1jdXJyZW50JykudmFsdWUpfHwwOwogIGlmKCFkYXRlfHwhcHVyY2hhc2VWYWx1ZSl7c2hvd1RvYXN0KCdEYXRlIGFuZCBQdXJjaGFzZSBWYWx1ZSByZXF1aXJlZCcpO3JldHVybjt9CiAgY29uc3QgdGFyZ2V0TW9udGg9Z2V0TW9udGhLZXkoZGF0ZSl8fG1vbnRoS2V5OyBlbnN1cmVNb250aCh0YXJnZXRNb250aCk7CiAgZGF0YVt0YXJnZXRNb250aF0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnksY3VycmVuY3kscHVyY2hhc2VWYWx1ZSxkZXNjcmlwdGlvbixhcmVhQ2VudHMsY3VycmVudFZhbHVlfSk7IHNhdmUoKTsgcmVuZGVyRGF0YVNjcmVlbigpOyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gU1RBVFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHJlbmRlclN0YXRzKCkgewogIGNvbnN0IG1vbnRocz1bXTsgZm9yKGxldCBpPTU7aT49MDtpLS0pe2NvbnN0IGR0PW5ldyBEYXRlKCk7ZHQuc2V0TW9udGgoZHQuZ2V0TW9udGgoKS1pKTttb250aHMucHVzaChgJHtkdC5nZXRGdWxsWWVhcigpfS0keyhkdC5nZXRNb250aCgpKzEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpfWApO30KICBjb25zdCBzcGVuZEJ5TW9udGg9bW9udGhzLm1hcChrPT4hZGF0YVtrXT8wOihkYXRhW2tdLmV4cGVuc2VzfHxbXSkucmVkdWNlKChzLHIpPT5zK051bWJlcihyLmFtb3VudHx8MCksMCkrKGRhdGFba10uaW52ZXN0bWVudHN8fFtdKS5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKSsoZGF0YVtrXS5kZWJ0c3x8W10pLnJlZHVjZSgocyxyKT0+cytOdW1iZXIoci5hbW91bnR8fDApLDApKTsKICBjb25zdCBpbmNCeU1vbnRoPW1vbnRocy5tYXAoaz0+IWRhdGFba10/MDooZGF0YVtrXS5pbmNvbWV8fFtdKS5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXQtc3BlbmRpbmctdG90YWwnKS50ZXh0Q29udGVudD1mbXQoc3BlbmRCeU1vbnRoLnJlZHVjZSgocyx2KT0+cyt2LDApKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdC1pbmNvbWUtdG90YWwnKS50ZXh0Q29udGVudD1mbXQoaW5jQnlNb250aC5yZWR1Y2UoKHMsdik9PnMrdiwwKSk7CiAgaWYoY2hhcnRzLnRyZW5kKSBjaGFydHMudHJlbmQuZGVzdHJveSgpOwogIGNvbnN0IHRjPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmVuZENoYXJ0JykuZ2V0Q29udGV4dCgnMmQnKTsKICBjaGFydHMudHJlbmQ9bmV3IENoYXJ0KHRjLHt0eXBlOidsaW5lJyxkYXRhOntsYWJlbHM6bW9udGhzLm1hcChtPT5nZXREaXNwbGF5TW9udGgobSkpLGRhdGFzZXRzOlt7bGFiZWw6J1NwZW5kaW5nJyxkYXRhOnNwZW5kQnlNb250aCxib3JkZXJDb2xvcjonI0VGNDQ0NCcsYmFja2dyb3VuZENvbG9yOidyZ2JhKDIzOSw2OCw2OCwwLjEpJyx0ZW5zaW9uOjAuNCxmaWxsOnRydWUscG9pbnRSYWRpdXM6NCxwb2ludEJhY2tncm91bmRDb2xvcjonI0VGNDQ0NCd9LHtsYWJlbDonSW5jb21lJyxkYXRhOmluY0J5TW9udGgsYm9yZGVyQ29sb3I6JyMxMEI5ODEnLGJhY2tncm91bmRDb2xvcjoncmdiYSgxNiwxODUsMTI5LDAuMSknLHRlbnNpb246MC40LGZpbGw6dHJ1ZSxwb2ludFJhZGl1czo0LHBvaW50QmFja2dyb3VuZENvbG9yOicjMTBCOTgxJ31dfSxvcHRpb25zOntyZXNwb25zaXZlOnRydWUsbWFpbnRhaW5Bc3BlY3RSYXRpbzpmYWxzZSxwbHVnaW5zOntsZWdlbmQ6e2Rpc3BsYXk6ZmFsc2V9fSxzY2FsZXM6e3g6e2dyaWQ6e2Rpc3BsYXk6ZmFsc2V9LHRpY2tzOntmb250OntmYW1pbHk6J051bml0bycsc2l6ZToxMH0sY29sb3I6JyM5QUEwQjInfX0seTp7Z3JpZDp7Y29sb3I6JyNGMEYwRjAnfSx0aWNrczp7Zm9udDp7ZmFtaWx5OidOdW5pdG8nLHNpemU6MTB9LGNvbG9yOicjOUFBMEIyJyxjYWxsYmFjazp2PT4nJCcrdi50b0xvY2FsZVN0cmluZygpfX19fX0pOwogIGNvbnN0IGNhdFRvdGFscz17fTsKICBPYmplY3QudmFsdWVzKGRhdGEpLmZvckVhY2gobT0+e2lmKCFtfHwhbS5leHBlbnNlcykgcmV0dXJuOyBtLmV4cGVuc2VzLmZvckVhY2goZT0+e2NhdFRvdGFsc1tlLmNhdGVnb3J5fHwnT3RoZXInXT0oY2F0VG90YWxzW2UuY2F0ZWdvcnl8fCdPdGhlciddfHwwKStOdW1iZXIoZS5hbW91bnR8fDApO30pO30pOwogIGNvbnN0IHNvcnRlZD1PYmplY3QuZW50cmllcyhjYXRUb3RhbHMpLnNvcnQoKGEsYik9PmJbMV0tYVsxXSkuc2xpY2UoMCw1KTsKICBjb25zdCBncmFuZFRvdGFsPXNvcnRlZC5yZWR1Y2UoKHMsWyx2XSk9PnMrdiwwKTsKICBjb25zdCBkb251dENvbG9ycz1bJyNGRjZCMzUnLCcjRkY4QzQyJywnI0ZGNDc1NycsJyM0QTlFRkYnLCcjRkZCRTBCJ107CiAgaWYoY2hhcnRzLmRvbnV0KSBjaGFydHMuZG9udXQuZGVzdHJveSgpOwogIGNoYXJ0cy5kb251dD1uZXcgQ2hhcnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvbnV0Q2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpLHt0eXBlOidkb3VnaG51dCcsZGF0YTp7ZGF0YXNldHM6W3tkYXRhOnNvcnRlZC5tYXAoKFssdl0pPT52KSxiYWNrZ3JvdW5kQ29sb3I6ZG9udXRDb2xvcnMsYm9yZGVyV2lkdGg6MH1dfSxvcHRpb25zOntyZXNwb25zaXZlOnRydWUsbWFpbnRhaW5Bc3BlY3RSYXRpbzpmYWxzZSxjdXRvdXQ6JzY1JScscGx1Z2luczp7bGVnZW5kOntkaXNwbGF5OmZhbHNlfX19fSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcDUtbGlzdCcpLmlubmVySFRNTD1zb3J0ZWQubWFwKChbY2F0LHZhbF0saSk9PmA8ZGl2IGNsYXNzPSJ0b3AtaXRlbSI+PGRpdiBjbGFzcz0idG9wLWRvdCIgc3R5bGU9ImJhY2tncm91bmQ6JHtkb251dENvbG9yc1tpXX07Ij48L2Rpdj48ZGl2IGNsYXNzPSJ0b3AtbGFiZWwiPiR7Y2F0fTwvZGl2PjxkaXYgY2xhc3M9InRvcC1wY3QiPiR7Z3JhbmRUb3RhbD4wPyh2YWwvZ3JhbmRUb3RhbCoxMDApLnRvRml4ZWQoMSk6MH0lPC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgY29uc3QgY3VyTT1kYXRhW3ZpZXdNb250aF18fHt9OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtYmFycycpLmlubmVySFRNTD1jYXRDb25maWcuZmlsdGVyKGM9PmMua2V5IT09J2ludmVzdCcmJmMua2V5IT09J3NhbGFyeScmJmMua2V5IT09J2RlYnQnJiZjLmtleSE9PSdvdGhlcicpLm1hcChjYXQ9PnsKICAgIGNvbnN0IHNwZW50PSgoY3VyTS5leHBlbnNlc3x8W10pLmZpbHRlcihlPT5lLmNhdGVnb3J5PT09Y2F0LmxhYmVsKS5yZWR1Y2UoKHMsZSk9PnMrTnVtYmVyKGUuYW1vdW50fHwwKSwwKSk7CiAgICBjb25zdCBwY3Q9TWF0aC5taW4oc3BlbnQvMTAwMCoxMDAsMTAwKTsKICAgIHJldHVybiBgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMnB4OyI+PGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi1ib3R0b206NnB4OyI+PGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4OyI+PGRpdiBzdHlsZT0id2lkdGg6MjhweDtoZWlnaHQ6MjhweDtiYWNrZ3JvdW5kOiR7Y2F0LmNvbG9yfTIwO2JvcmRlci1yYWRpdXM6OHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXNpemU6MC45ZW07Ij4ke2NhdC5pY29ufTwvZGl2PjxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjAuODhlbTsiPiR7Y2F0LmxhYmVsfTwvc3Bhbj48L2Rpdj48c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTowLjgyZW07Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+JHtmbXQoc3BlbnQpfSAvICQxMDAwPC9zcGFuPjwvZGl2PjxkaXYgc3R5bGU9ImhlaWdodDo2cHg7YmFja2dyb3VuZDojRjBGMEYwO2JvcmRlci1yYWRpdXM6NHB4O292ZXJmbG93OmhpZGRlbjsiPjxkaXYgc3R5bGU9IndpZHRoOiR7cGN0fSU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDoke2NhdC5jb2xvcn07Ym9yZGVyLXJhZGl1czo0cHg7Ij48L2Rpdj48L2Rpdj48L2Rpdj5gOwogIH0pLmpvaW4oJycpOwogIGNvbnN0IGFjY291bnRzPWdldEFjY291bnRzTGlzdCgpLCBhY2NUeXBlcz17fTsKICBhY2NvdW50cy5mb3JFYWNoKGE9PnthY2NUeXBlc1thLnR5cGVdPShhY2NUeXBlc1thLnR5cGVdfHwwKStNYXRoLmFicyhOdW1iZXIoYS5iYWxhbmNlfHwwKSk7fSk7CiAgY29uc3QgYWNjQ29sb3JzPVsnI0ZGQkUwQicsJyM0QTlFRkYnLCcjRkY2QjM1JywnIzRFQ0RDNCddOwogIGNvbnN0IGFjY0tleXM9T2JqZWN0LmtleXMoYWNjVHlwZXMpLCBhY2NWYWxzPWFjY0tleXMubWFwKGs9PmFjY1R5cGVzW2tdKTsKICBjb25zdCBhY2NUb3RhbD1hY2NWYWxzLnJlZHVjZSgocyx2KT0+cyt2LDApOwogIGlmKGNoYXJ0cy5hY2NvdW50KSBjaGFydHMuYWNjb3VudC5kZXN0cm95KCk7CiAgY2hhcnRzLmFjY291bnQ9bmV3IENoYXJ0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50Q2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpLHt0eXBlOidkb3VnaG51dCcsZGF0YTp7ZGF0YXNldHM6W3tkYXRhOmFjY1ZhbHMsYmFja2dyb3VuZENvbG9yOmFjY0NvbG9ycyxib3JkZXJXaWR0aDowfV19LG9wdGlvbnM6e3Jlc3BvbnNpdmU6ZmFsc2UsY3V0b3V0Oic2MCUnLHBsdWdpbnM6e2xlZ2VuZDp7ZGlzcGxheTpmYWxzZX19fX0pOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWJyZWFrZG93bicpLmlubmVySFRNTD1hY2NLZXlzLm1hcCgoayxpKT0+YDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDttYXJnaW4tYm90dG9tOjhweDtmb250LXNpemU6MC44MmVtO2ZvbnQtd2VpZ2h0OjcwMDsiPjxkaXYgc3R5bGU9IndpZHRoOjEwcHg7aGVpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czo1MCU7YmFja2dyb3VuZDoke2FjY0NvbG9yc1tpXX07ZmxleC1zaHJpbms6MDsiPjwvZGl2','PjxzcGFuPiR7a308L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbWVkKTttYXJnaW4tbGVmdDphdXRvOyI+JHthY2NUb3RhbD4wPyhhY2NWYWxzW2ldL2FjY1RvdGFsKjEwMCkudG9GaXhlZCgxKTowfSU8L3NwYW4+PC9kaXY+YCkuam9pbignJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBTRVRUSU5HUwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8g4pSA4pSAIE5ldCBXb3J0aCBUeXBlIFZpc2liaWxpdHkgKFNldHRpbmdzKSDilIDilIAKY29uc3QgTldfVFlQRV9PUkRFUl9CQVNFID0gWydjaGVja2luZycsJ3NhdmluZ3NfYWNjJywnYnJva2VyYWdlJywncmV0aXJlbWVudCcsJ2JvbmRzX2ZkJywnbWV0YWxzJywncmVhbGVzdGF0ZScsJ2Nhc2gnLCdjcmVkaXRfY2FyZCcsJ2xvYW4nLCdvdGhlcl9saWFiaWxpdHknXTsKY29uc3QgTldfVFlQRV9TSE9SVF9CQVNFID0geyBjaGVja2luZzonQ2hlY2tpbmcnLCBzYXZpbmdzX2FjYzonU2F2aW5ncycsIGJyb2tlcmFnZTonSW52ZXN0bWVudCcsIHJldGlyZW1lbnQ6J1JldGlyZW1lbnQnLCBib25kc19mZDonQm9uZHMvRkQnLCBtZXRhbHM6J01ldGFscycsIHJlYWxlc3RhdGU6J1Byb3BlcnR5JywgY2FzaDonQ2FzaCcsIGNyZWRpdF9jYXJkOidDcmVkaXQgQ2FyZCcsIGxvYW46J0xvYW4nLCBvdGhlcl9saWFiaWxpdHk6J090aGVyIExpYWIuJyB9OwoKZnVuY3Rpb24gZ2V0TldDdXN0b21UeXBlcygpIHsgcmV0dXJuIGRhdGEuX253Q3VzdG9tVHlwZXMgfHwgW107IH0KZnVuY3Rpb24gZ2V0TldUeXBlT3JkZXIoKSB7CiAgY29uc3QgY3VzdG9tID0gZ2V0TldDdXN0b21UeXBlcygpLm1hcChjID0+IGMua2V5KTsKICByZXR1cm4gWy4uLk5XX1RZUEVfT1JERVJfQkFTRSwgLi4uY3VzdG9tXTsKfQpmdW5jdGlvbiBnZXROV1R5cGVTaG9ydCgpIHsKICBjb25zdCBzaG9ydHMgPSB7IC4uLk5XX1RZUEVfU0hPUlRfQkFTRSB9OwogIGdldE5XQ3VzdG9tVHlwZXMoKS5mb3JFYWNoKGMgPT4geyBzaG9ydHNbYy5rZXldID0gYy5sYWJlbDsgfSk7CiAgcmV0dXJuIHNob3J0czsKfQovLyBBbGlhc2VzIHVzZWQgYWNyb3NzIHRoZSBjb2RlYmFzZQpsZXQgTldfVFlQRV9PUkRFUiA9IE5XX1RZUEVfT1JERVJfQkFTRTsKbGV0IE5XX1RZUEVfU0hPUlQgPSBOV19UWVBFX1NIT1JUX0JBU0U7Cgpjb25zdCBOV19UWVBFX0VNT0pJX09QVFMgPSBbJ/Cfj6YnLCfwn4+gJywn8J+alycsJ/CfkrAnLCfwn5OmJywn8J+OkycsJ/CfkrwnLCfwn4+FJywn8J+MkCcsJ/CfkrMnLCfwn4+X77iPJywn8J+Pi++4jycsJ/Cfk7EnLCfwn46oJywn8J+boe+4jyddOwpsZXQgcGlja2VkTldUeXBlRW1vamkgPSAn8J+Ppic7CgpmdW5jdGlvbiBhZGRDdXN0b21OV1R5cGUoKSB7CiAgY29uc3QgbmFtZSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1uYW1lLWlucHV0JykudmFsdWUgfHwgJycpLnRyaW0oKTsKICBjb25zdCBpc0xpYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1pcy1saWFiJykuY2hlY2tlZDsKICBpZiAoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIHR5cGUgbmFtZSDinYwnKTsgcmV0dXJuOyB9CiAgY29uc3Qga2V5ID0gJ2N1c3RvbV8nICsgbmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCdfJykgKyAnXycgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTsKICBjb25zdCBsYWJlbCA9IG5hbWU7CiAgaWYgKCFkYXRhLl9ud0N1c3RvbVR5cGVzKSBkYXRhLl9ud0N1c3RvbVR5cGVzID0gW107CiAgLy8gQWRkIHRvIE5XX1RZUEVTIHJ1bnRpbWUgb2JqZWN0CiAgTldfVFlQRVNba2V5XSA9IHsgbGFiZWwsIGVtb2ppOiBwaWNrZWROV1R5cGVFbW9qaSwgY29sb3I6ICcjNkI3MjgwJywgaXNMaWFiIH07CiAgZGF0YS5fbndDdXN0b21UeXBlcy5wdXNoKHsga2V5LCBsYWJlbCwgZW1vamk6IHBpY2tlZE5XVHlwZUVtb2ppLCBpc0xpYWIgfSk7CiAgLy8gQWRkIHRvIHZpc2liaWxpdHkKICBjb25zdCB2aXMgPSBnZXROV1R5cGVWaXNpYmlsaXR5KCk7CiAgdmlzW2tleV0gPSB0cnVlOwogIHNhdmUoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1uYW1lLWlucHV0JykudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1pcy1saWFiJykuY2hlY2tlZCA9IGZhbHNlOwogIHJlbmRlck5XVHlwZVNldHRpbmdzKCk7CiAgc2hvd1RvYXN0KCfinIUgJyArIGxhYmVsICsgJyB0eXBlIGFkZGVkIScpOwp9CgpmdW5jdGlvbiByZW1vdmVDdXN0b21OV1R5cGUoa2V5KSB7CiAgaWYgKCFjb25maXJtKCdSZW1vdmUgdGhpcyBjdXN0b20gYWNjb3VudCB0eXBlPycpKSByZXR1cm47CiAgZGF0YS5fbndDdXN0b21UeXBlcyA9IChkYXRhLl9ud0N1c3RvbVR5cGVzfHxbXSkuZmlsdGVyKGMgPT4gYy5rZXkgIT09IGtleSk7CiAgY29uc3QgdmlzID0gZ2V0TldUeXBlVmlzaWJpbGl0eSgpOwogIGRlbGV0ZSB2aXNba2V5XTsKICBkZWxldGUgTldfVFlQRVNba2V5XTsKICBzYXZlKCk7CiAgcmVuZGVyTldUeXBlU2V0dGluZ3MoKTsKICBzaG93VG9hc3QoJ1R5cGUgcmVtb3ZlZCcpOwp9CgpmdW5jdGlvbiBnZXROV1R5cGVWaXNpYmlsaXR5KCkgewogIGlmICghZGF0YS5fbndUeXBlVmlzaWJsZSkgewogICAgLy8gRGVmYXVsdDogYWxsIHZpc2libGUKICAgIGRhdGEuX253VHlwZVZpc2libGUgPSB7fTsKICAgIE5XX1RZUEVfT1JERVIuZm9yRWFjaCh0ID0+IHsgZGF0YS5fbndUeXBlVmlzaWJsZVt0XSA9IHRydWU7IH0pOwogIH0KICByZXR1cm4gZGF0YS5fbndUeXBlVmlzaWJsZTsKfQoKZnVuY3Rpb24gcmVuZGVyTldUeXBlU2V0dGluZ3MoKSB7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy10eXBlLXZpc2liaWxpdHktZ3JpZCcpOwogIGlmICghZ3JpZCkgcmV0dXJuOwogIGNvbnN0IHZpcyA9IGdldE5XVHlwZVZpc2liaWxpdHkoKTsKICBjb25zdCBvcmRlciA9IGdldE5XVHlwZU9yZGVyKCk7CiAgY29uc3Qgc2hvcnRzID0gZ2V0TldUeXBlU2hvcnQoKTsKICBjb25zdCBjdXN0b21LZXlzID0gZ2V0TldDdXN0b21UeXBlcygpLm1hcChjID0+IGMua2V5KTsKICBncmlkLmlubmVySFRNTCA9IG9yZGVyLm1hcCh0ID0+IHsKICAgIGNvbnN0IGNmZyA9IE5XX1RZUEVTW3RdOwogICAgaWYgKCFjZmcpIHJldHVybiAnJzsKICAgIGNvbnN0IG9uID0gdmlzW3RdICE9PSBmYWxzZTsKICAgIGNvbnN0IGlzQ3VzdG9tID0gY3VzdG9tS2V5cy5pbmNsdWRlcyh0KTsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjZmcuZW1vaml9PC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0tbGFiZWwiPiR7c2hvcnRzW3RdfHxjZmcubGFiZWx9JHtjZmcuaXNMaWFiPycgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ij5MaWFiPC9zcGFuPic6Jyd9PC9zcGFuPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlICR7b24/J29uJzonJ30iIG9uY2xpY2s9InRvZ2dsZU5XVHlwZSgnJHt0fScpIiB0aXRsZT0iJHtvbj8nVmlzaWJsZSc6J0hpZGRlbid9Ij4KICAgICAgICAke29uPyfinJMnOifil4snfQogICAgICA8L2J1dHRvbj4KICAgICAgJHtpc0N1c3RvbSA/IGA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVDdXN0b21OV1R5cGUoJyR7dH0nKSIgdGl0bGU9IlJlbW92ZSIgc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTtmb250LXNpemU6MC44ZW07Ij7inJU8L2J1dHRvbj5gIDogJyd9CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwogIC8vIEVtb2ppIHBpY2tlcgogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXR5cGUtZW1vamktcm93Jyk7CiAgaWYgKGVtb2ppUm93KSBlbW9qaVJvdy5pbm5lckhUTUwgPSBOV19UWVBFX0VNT0pJX09QVFMubWFwKGUgPT4gYDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkTldUeXBlRW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tlZE5XVHlwZUVtb2ppPScke2V9JztyZW5kZXJOV1R5cGVTZXR0aW5ncygpOyI+JHtlfTwvc3Bhbj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gdG9nZ2xlTldUeXBlKHR5cGUpIHsKICBjb25zdCB2aXMgPSBnZXROV1R5cGVWaXNpYmlsaXR5KCk7CiAgdmlzW3R5cGVdID0gdmlzW3R5cGVdID09PSBmYWxzZTsgLy8gdG9nZ2xlCiAgc2F2ZSgpOwogIHJlbmRlck5XVHlwZVNldHRpbmdzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlclNldHRpbmdzKCkgewogIGNvbnN0IG1vbnRocz1PYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoaz0+IWsuc3RhcnRzV2l0aCgnXycpKS5zb3J0KChhLGIpPT5iLmxvY2FsZUNvbXBhcmUoYSkpOwoKICAvLyBUaGVtZSBiYWRnZQogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50aGVtZS1jYXJkJykuZm9yRWFjaChjID0+IGMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlLXRoZW1lJykpOwogIGNvbnN0IHRjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoZW1lLScrY3VycmVudFRoZW1lKTsKICBpZih0YykgdGMuY2xhc3NMaXN0LmFkZCgnYWN0aXZlLXRoZW1lJyk7CiAgLy8gQ3VycmVuY3kgZGlzcGxheQogIGNvbnN0IGNkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldHRpbmdzLWN1cnItZGlzcGxheScpOwogIGNvbnN0IGNuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldHRpbmdzLWN1cnItbmFtZScpOwogIGlmKGNkKSBjZC50ZXh0Q29udGVudCA9IGAke2N1cnJlbnRDdXJyZW5jeS5mbGFnfSAke2N1cnJlbnRDdXJyZW5jeS5jb2RlfSDigJQgJHtjdXJyZW50Q3VycmVuY3kuc3ltYm9sfWA7CiAgaWYoY24pIGNuLnRleHRDb250ZW50ID0gY3VycmVudEN1cnJlbmN5Lm5hbWUgKyAoY3VycmVudEN1cnJlbmN5LmNvdW50cnk/JyDCtyAnK2N1cnJlbnRDdXJyZW5jeS5jb3VudHJ5OicnKTsKICAvLyBIb21lIGNhcmQgbWFuYWdlcgogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICAvLyBJbnZlc3RtZW50IGNhcmQgbWFuYWdlcgogIHJlbmRlckludkNhcmRTZXR0aW5ncygpOwogIC8vIENhdGVnb3J5IHBpbGxzCiAgcmVuZGVyQ2F0UGlsbHMoKTsKICAvLyBOZXQgV29ydGggdHlwZSB2aXNpYmlsaXR5CiAgcmVuZGVyTldUeXBlU2V0dGluZ3MoKTsKICAvLyBGWCByYXRlIG92ZXJyaWRlcyBwYW5lbAogIHJlbmRlckZYUmF0ZXNQYW5lbCgpOwp9CmZ1bmN0aW9uIGRlbGV0ZU1vbnRoKGtleSkgeyBpZighY29uZmlybShgRGVsZXRlIGFsbCBkYXRhIGZvciAke2dldERpc3BsYXlNb250aChrZXkpfT9gKSkgcmV0dXJuOyBkZWxldGUgZGF0YVtrZXldOyBzYXZlKCk7IHJlbmRlckhvbWUoKTsgcmVuZGVyTW9udGhzTGlzdCgpOyByZW5kZXJSZXNldFN1bW1hcnkoKTsgc2hvd1RvYXN0KCfwn5eR77iPICcgKyBnZXREaXNwbGF5TW9udGgoa2V5KSArICcgZGVsZXRlZCcpOyB9CgoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEVYUE9SVCAvIElNUE9SVCAvIEJBQ0tVUAovLyDilZDilZDilZDilZDi','lZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gZG93bmxvYWRCYWNrdXAoKSB7CiAgY29uc3Qgc3RyPSJkYXRhOnRleHQvanNvbjtjaGFyc2V0PXV0Zi04LCIrZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICBjb25zdCBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsgYS5zZXRBdHRyaWJ1dGUoImhyZWYiLHN0cik7IGEuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIm1vbmV5Zmxvd19iYWNrdXBfIituZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwxMCkrIi5qc29uIik7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsgYS5jbGljaygpOyBhLnJlbW92ZSgpOyBzaG93VG9hc3QoJ0JhY2t1cCBkb3dubG9hZGVkIOKchScpOwp9CmZ1bmN0aW9uIHJlc3RvcmVCYWNrdXAoaW5wdXQpIHsKICBjb25zdCBmaWxlPWlucHV0LmZpbGVzWzBdOyBpZighZmlsZSkgcmV0dXJuOwogIGNvbnN0IHJlYWRlcj1uZXcgRmlsZVJlYWRlcigpOwogIHJlYWRlci5vbmxvYWQ9ZT0+eyB0cnl7IGNvbnN0IGltcG9ydGVkPUpTT04ucGFyc2UoZS50YXJnZXQucmVzdWx0KTsgaWYoY29uZmlybSgn4pqg77iPIFRoaXMgd2lsbCBPVkVSV1JJVEUgYWxsIGRhdGEuIENvbnRpbnVlPycpKXsgZGF0YT1pbXBvcnRlZDsgc2F2ZSgpOyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgn4pyFIERhdGEgcmVzdG9yZWQhJyk7IH0gfWNhdGNoKGVycil7c2hvd1RvYXN0KCfinYwgSW52YWxpZCBKU09OJyk7fSB9OwogIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwp9CmZ1bmN0aW9uIGV4cG9ydEFsbERhdGEoKSB7CiAgY29uc3Qgd2I9WExTWC51dGlscy5ib29rX25ldygpOwogIFt7a2V5OidpbmNvbWUnLG5hbWU6J0luY29tZSd9LHtrZXk6J2V4cGVuc2VzJyxuYW1lOidFeHBlbnNlcyd9LHtrZXk6J2ludmVzdG1lbnRzJyxuYW1lOidJbnZlc3RtZW50cyd9LHtrZXk6J3JlYWxFc3RhdGUnLG5hbWU6J1JlYWwgRXN0YXRlJ30se2tleTonbWV0YWxzJyxuYW1lOidNZXRhbHMnfSx7a2V5OidhZGRpdGlvbmFsJyxuYW1lOidBZGRpdGlvbmFsJ30se2tleTonZGVidHMnLG5hbWU6J0RlYnRzJ30se2tleTonZ2l2ZW5Ub090aGVycycsbmFtZTonR2l2ZW4gVG8gT3RoZXJzJ31dLmZvckVhY2goY2F0PT57CiAgICBsZXQgcm93cz1bXTsKICAgIGlmKGNhdC5rZXk9PT0nbWV0YWxzJykgcm93cy5wdXNoKFsnTW9udGgnLCdNZXRhbCcsJ1B1cml0eScsJ09jY2FzaW9uJywnSXRlbScsJ1dlaWdodChnKSddKTsKICAgIGVsc2UgaWYoY2F0LmtleT09PSdyZWFsRXN0YXRlJykgcm93cy5wdXNoKFsnTW9udGgnLCdEYXRlJywnQ291bnRyeScsJ0N1cnJlbmN5JywnUHVyY2hhc2UnLCdEZXNjJywnQXJlYScsJ0N1cnJlbnQnXSk7CiAgICBlbHNlIHJvd3MucHVzaChbJ01vbnRoJywnRGF0ZScsJ0NhdGVnb3J5JywnQW1vdW50JywnRGVzY3JpcHRpb24nXSk7CiAgICBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoaz0+IWsuc3RhcnRzV2l0aCgnXycpKS5zb3J0KCkuZm9yRWFjaChtS2V5PT57CiAgICAgIChkYXRhW21LZXldW2NhdC5rZXldfHxbXSkuZm9yRWFjaChyPT57CiAgICAgICAgY29uc3QgbWw9Z2V0RGlzcGxheU1vbnRoKG1LZXkpOwogICAgICAgIGlmKGNhdC5rZXk9PT0nbWV0YWxzJykgcm93cy5wdXNoKFttbCxyLm1ldGFsVHlwZSxyLnB1cml0eSxyLm9jY2FzaW9uLHIuaXRlbU5hbWUsci53ZWlnaHRHbXNdKTsKICAgICAgICBlbHNlIGlmKGNhdC5rZXk9PT0ncmVhbEVzdGF0ZScpIHJvd3MucHVzaChbbWwsci5kYXRlLHIuY291bnRyeSxyLmN1cnJlbmN5LHIucHVyY2hhc2VWYWx1ZSxyLmRlc2NyaXB0aW9uLHIuYXJlYUNlbnRzLHIuY3VycmVudFZhbHVlXSk7CiAgICAgICAgZWxzZSByb3dzLnB1c2goW21sLHIuZGF0ZSxyLmNhdGVnb3J5LHIuYW1vdW50LHIuZGVzY3JpcHRpb25dKTsKICAgICAgfSk7CiAgICB9KTsKICAgIGlmKHJvd3MubGVuZ3RoPjEpe2NvbnN0IHdzPVhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJvd3MpO1hMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2Isd3MsY2F0Lm5hbWUpO30KICB9KTsKICAvLyBTaGVldDogR2xvYmFsIE1ldGFscyAoX21ldGFscyBhcnJheSkKICBjb25zdCBtZXRhbHNHbG9iYWwgPSBkYXRhLl9tZXRhbHMgfHwgW107CiAgaWYgKG1ldGFsc0dsb2JhbC5sZW5ndGgpIHsKICAgIGNvbnN0IG1Sb3dzID0gW1snTWV0YWwgVHlwZScsJ05hbWUnLCdQdXJpdHknLCdPY2Nhc2lvbicsJ0Zvcm0nLCdXZWlnaHQgKGcpJywnUHJpY2UvZycsJ1ZhbHVlIChVU0QpJywnRGF0ZScsJ05vdGVzJ11dOwogICAgbWV0YWxzR2xvYmFsLmZvckVhY2gobSA9PiB7CiAgICAgIGNvbnN0IGcgPSBOdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgICBjb25zdCBwID0gTnVtYmVyKG0ucHJpY2V8fDApIHx8IChNRVRBTF9DT05GSUdbbS5tZXRhbFR5cGVdfHx7fSkucHJpY2VQZXJHcmFtIHx8IDA7CiAgICAgIG1Sb3dzLnB1c2goW20ubWV0YWxUeXBlfHwnJywgbS5uYW1lfHwnJywgbS5wdXJpdHl8fCcnLCBtLm9jY2FzaW9ufHwnJywgbS5mb3JtfHwnJywgZywgcCwgKGcqcCkudG9GaXhlZCgyKSwgbS5kYXRlfHwnJywgbS5ub3Rlc3x8JyddKTsKICAgIH0pOwogICAgY29uc3QgbVdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQobVJvd3MpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3YiwgbVdzLCAnTWV0YWxzIChQb3J0Zm9saW8pJyk7CiAgfQoKICAvLyBTaGVldDogR2xvYmFsIFJlYWwgRXN0YXRlIChfcmVhbEVzdGF0ZSBhcnJheSkKICBjb25zdCByZUdsb2JhbCA9IGRhdGEuX3JlYWxFc3RhdGUgfHwgW107CiAgaWYgKHJlR2xvYmFsLmxlbmd0aCkgewogICAgY29uc3QgcmVSb3dzID0gW1snRGVzY3JpcHRpb24nLCdDb3VudHJ5JywnQ3VycmVuY3knLCdQdXJjaGFzZSBWYWx1ZScsJ0N1cnJlbnQgVmFsdWUnLCdBcmVhJywnRGF0ZSddXTsKICAgIHJlR2xvYmFsLmZvckVhY2gocCA9PiByZVJvd3MucHVzaChbcC5kZXNjcmlwdGlvbnx8JycsIHAuY291bnRyeXx8JycsIHAuY3VycmVuY3l8fCcnLCBwLnB1cmNoYXNlVmFsdWV8fDAsIHAuY3VycmVudFZhbHVlfHwwLCBwLmFyZWF8fCcnLCBwLmRhdGV8fCcnXSkpOwogICAgY29uc3QgcmVXcyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJlUm93cyk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCByZVdzLCAnUmVhbCBFc3RhdGUgKFBvcnRmb2xpbyknKTsKICB9CgogIC8vIFNoZWV0OiBOVyBBY2NvdW50cyAoX253QWNjb3VudHMpCiAgY29uc3QgbndBY2N0cyA9IGRhdGEuX253QWNjb3VudHMgfHwgW107CiAgaWYgKG53QWNjdHMubGVuZ3RoKSB7CiAgICBjb25zdCBud1Jvd3MgPSBbWydUeXBlJywnTmFtZScsJ0JhbGFuY2UnLCdDdXJyZW5jeScsJ0xhc3QgVXBkYXRlZCcsJ0JhbmsnLCdOb3RlcycsJ1B1cml0eScsJ0dyYW1zJywnUHVyY2hhc2UgVmFsdWUnLCdDb3VudHJ5J11dOwogICAgbndBY2N0cy5mb3JFYWNoKGEgPT4gewogICAgICBjb25zdCBtID0gYS5tZXRhIHx8IHt9OwogICAgICBud1Jvd3MucHVzaChbYS50eXBlfHwnJywgYS5uYW1lfHwnJywgYS5iYWxhbmNlfHwwLCBhLmN1cnJlbmN5fHwnJywgYS5sYXN0VXBkYXRlZHx8JycsIG0uYmFua3x8JycsIG0ubm90ZXN8fCcnLCBtLnB1cml0eXx8JycsIG0uZ3JhbXN8fCcnLCBtLnB1cmNoYXNlVmFsdWV8fCcnLCBtLmNvdW50cnl8fCcnXSk7CiAgICB9KTsKICAgIGNvbnN0IG53V3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChud1Jvd3MpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3YiwgbndXcywgJ05XIEFjY291bnRzJyk7CiAgfQoKICBYTFNYLndyaXRlRmlsZSh3YiwiTW9uZXlGbG93X0NvbXBsZXRlLnhsc3giKTsgc2hvd1RvYXN0KCdFeGNlbCBleHBvcnRlZCDinIUnKTsKfQpmdW5jdGlvbiBleHBvcnREYXRhQ2F0ZWdvcnkodHlwZSkgewogIGNvbnN0IGxpc3Q9Z2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSk7IGlmKCFsaXN0Lmxlbmd0aCl7c2hvd1RvYXN0KCdObyBkYXRhIHRvIGV4cG9ydCcpO3JldHVybjt9CiAgY29uc3QgY2xlYW49bGlzdC5tYXAoKHtfbW9udGgsX2lkeCwuLi5yfSk9PnIpOwogIGNvbnN0IHdiPVhMU1gudXRpbHMuYm9va19uZXcoKTsgY29uc3Qgd3M9WExTWC51dGlscy5qc29uX3RvX3NoZWV0KGNsZWFuKTsgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yix3cyx0eXBlKTsKICBYTFNYLndyaXRlRmlsZSh3YixgJHt0eXBlfV9FeHBvcnQueGxzeGApOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gUEFTVEUgLyBGSUxFIElNUE9SVAovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gcGFyc2VQYXN0ZShtb250aEtleSwgdHlwZSkgewogIGNvbnN0IHRleHQ9KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBwYXN0ZS0ke3R5cGV9YCl8fHt9KS52YWx1ZXx8Jyc7IGlmKCF0ZXh0LnRyaW0oKSkgcmV0dXJuOwogIGlmKHR5cGU9PT0nbWV0YWxzJyl7cGFyc2VNZXRhbHNQYXN0ZShtb250aEtleSx0ZXh0KTtyZXR1cm47fQogIGlmKHR5cGU9PT0ncmVhbEVzdGF0ZScpe3BhcnNlUmVhbEVzdGF0ZVBhc3RlKG1vbnRoS2V5LHRleHQpO3JldHVybjt9CiAgY29uc3QgbGluZXM9dGV4dC50cmltKCkuc3BsaXQoJ1xuJyk7IGxldCBjb3VudD0wOwogIGxpbmVzLmZvckVhY2gobGluZT0+ewogICAgY29uc3QgcGFydHM9bGluZS5yZXBsYWNlKC8sL2csJycpLnNwbGl0KC9ccysvKTsKICAgIGlmKHBhcnRzLmxlbmd0aDwyKSByZXR1cm47CiAgICBjb25zdCBkYXRlSWR4PXBhcnRzLmZpbmRJbmRleChwPT4haXNOYU4oRGF0ZS5wYXJzZShwKSkmJihwLmluY2x1ZGVzKCcvJyl8fHAuaW5jbHVkZXMoJy0nKSkpOwogICAgaWYoZGF0ZUlkeD09PS0xKSByZXR1cm47CiAgICBjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUocGFydHNbZGF0ZUlkeF0pOwogICAgbGV0IGFtdElkeD0tMTsKICAgIGZvcihsZXQgaT1wYXJ0cy5sZW5ndGgtMTtpPj0wO2ktLSl7aWYoaT09PWRhdGVJZHgpY29udGludWU7Y29uc3QgYz1wYXJ0c1tpXS5yZXBsYWNlKC9bJOKCrMKjXS9nLCcnKTtpZighaXNOYU4ocGFyc2VGbG9hdChjKSkmJmlzRmluaXRlKGMpKXthbXRJZHg9aTticmVhazt9fQogICAgaWYoYW10SWR4PT09LTEpIHJldHVybjsKICAgIGNvbnN0IGFtb3VudD1wYXJzZUZsb2F0KHBhcnRzW2FtdElkeF0ucmVwbGFjZSgvWyTigqzCo10vZywnJykpOwogICAgY29uc3QgZGVzYz1wYXJ0cy5maWx0ZXIoKF8saSk9PmkhPT1kYXRlSWR4JiZpIT09YW10SWR4KS5qb2luKCcgJyk7CiAgICBjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8bW9udGhLZXk7IGVuc3VyZU1vbnRoKHRtKTsKICAgIGRhdGFbdG1dW3R5cGVdLnB1c2goe2RhdGUsY2F0ZWdvcnk6J0ltcG9ydGVkJyxhbW91bnQsZGVzY3JpcHRpb246ZGVzY30pOyBjb3VudCsrOwogIH0pOwogIGlmKGNvdW50PjApe3NhdmUoKTtwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpO3JlbmRlckRhdGFTY3JlZW4oKTtzaG93VG9hc3QoYOKchSBQYXJzZWQgJHtjb3VudH0gcm93cyFgKTsoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo','YHBhc3RlLSR7dHlwZX1gKXx8e30pLnZhbHVlPScnO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLiBDaGVjayBmb3JtYXQuJyk7Cn0KZnVuY3Rpb24gcGFyc2VNZXRhbHNQYXN0ZShtb250aEtleSx0ZXh0KXtjb25zdCBsaW5lcz10ZXh0LnRyaW0oKS5zcGxpdCgnXG4nKTtsZXQgY291bnQ9MDtsaW5lcy5mb3JFYWNoKGxpbmU9Pntjb25zdCBwPWxpbmUuc3BsaXQoL1ssXHRdLykubWFwKHM9PnMudHJpbSgpKTtpZihwLmxlbmd0aDw1KXJldHVybjtkYXRhW21vbnRoS2V5XS5tZXRhbHMucHVzaCh7bWV0YWxUeXBlOnBbMF0scHVyaXR5OnBbMV0sb2NjYXNpb246cFsyXSxpdGVtTmFtZTpwWzNdLHdlaWdodEdtczpwYXJzZUZsb2F0KHBbNF0pfHwwfSk7Y291bnQrKzt9KTtpZihjb3VudD4wKXtzYXZlKCk7cmVuZGVyRGF0YVNjcmVlbigpO3Nob3dUb2FzdChg4pyFIFBhcnNlZCAke2NvdW50fSByb3dzIWApO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLicpO30KZnVuY3Rpb24gcGFyc2VSZWFsRXN0YXRlUGFzdGUobW9udGhLZXksdGV4dCl7Y29uc3QgbGluZXM9dGV4dC50cmltKCkuc3BsaXQoJ1xuJyk7bGV0IGNvdW50PTA7bGluZXMuZm9yRWFjaChsaW5lPT57Y29uc3QgcD1saW5lLnNwbGl0KC9bLFx0XS8pLm1hcChzPT5zLnRyaW0oKSk7aWYocC5sZW5ndGg8NClyZXR1cm47Y29uc3QgZGF0ZT1ub3JtYWxpemVEYXRlKHBbMF0pO2NvbnN0IHRtPWdldE1vbnRoS2V5KGRhdGUpfHxtb250aEtleTtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnk6cFsxXSxjdXJyZW5jeTpwWzJdLHB1cmNoYXNlVmFsdWU6cGFyc2VGbG9hdChwWzNdKXx8MCxkZXNjcmlwdGlvbjpwWzRdLGFyZWFDZW50czpwYXJzZUZsb2F0KHBbNV0pfHwwLGN1cnJlbnRWYWx1ZTpwYXJzZUZsb2F0KHBbNl0pfHwwfSk7Y291bnQrKzt9KTtpZihjb3VudD4wKXtzYXZlKCk7cmVuZGVyRGF0YVNjcmVlbigpO3Nob3dUb2FzdChg4pyFIFBhcnNlZCAke2NvdW50fSByb3dzIWApO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLicpO30KCmZ1bmN0aW9uIGltcG9ydEZpbGUobW9udGhLZXksIHR5cGUpIHsKICBjb25zdCBmaT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZmlsZS0ke3R5cGV9YCk7IGlmKCFmaXx8IWZpLmZpbGVzWzBdKXtzaG93VG9hc3QoJ1NlbGVjdCBhIGZpbGUgZmlyc3QnKTtyZXR1cm47fQogIGNvbnN0IGZpbGU9ZmkuZmlsZXNbMF0sIHJlYWRlcj1uZXcgRmlsZVJlYWRlcigpOwogIHJlYWRlci5vbmxvYWQ9ZnVuY3Rpb24oZSl7CiAgICBpZihmaWxlLm5hbWUuZW5kc1dpdGgoJy5jc3YnKSl7UGFwYVBhcnNlLnBhcnNlKGUudGFyZ2V0LnJlc3VsdCx7aGVhZGVyOnRydWUsc2tpcEVtcHR5TGluZXM6dHJ1ZSxjb21wbGV0ZTpyPT5wcm9jZXNzSW1wb3J0Um93cyhyLmRhdGEsbW9udGhLZXksdHlwZSl9KTt9CiAgICBlbHNle2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTtjb25zdCB3Yj1YTFNYLnJlYWQoZCx7dHlwZTonYXJyYXknfSk7Y29uc3Qgd3M9d2IuU2hlZXRzW3diLlNoZWV0TmFtZXNbMF1dO3Byb2Nlc3NJbXBvcnRSb3dzKFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cyx7cmF3OmZhbHNlfSksbW9udGhLZXksdHlwZSk7fQogIH07CiAgaWYoZmlsZS5uYW1lLmVuZHNXaXRoKCcuY3N2JykpIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOyBlbHNlIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsKfQpmdW5jdGlvbiBwcm9jZXNzSW1wb3J0Um93cyhyb3dzLHNlbGVjdGVkTW9udGgsdHlwZSl7CiAgbGV0IGFkZGVkPTA7CiAgcm93cy5mb3JFYWNoKHI9PnsKICAgIGlmKHR5cGU9PT0nbWV0YWxzJyl7Y29uc3Qgdz1wYXJzZUZsb2F0KHIuV2VpZ2h0fHxyLndlaWdodHx8ci5XZWlnaHRHbXN8fHJbJ1dlaWdodCAoZ21zKSddfHwwKTtjb25zdCBpdGVtPXIuSXRlbXx8ci5pdGVtfHxyLkl0ZW1OYW1lfHxyWydJdGVtIE5hbWUnXTtpZih3JiZpdGVtKXtkYXRhW3NlbGVjdGVkTW9udGhdLm1ldGFscy5wdXNoKHttZXRhbFR5cGU6ci5NZXRhbHx8ci5tZXRhbHx8ci5NZXRhbFR5cGV8fCdHb2xkJyxwdXJpdHk6ci5QdXJpdHl8fHIucHVyaXR5fHwnJyxvY2Nhc2lvbjpyLk9jY2FzaW9ufHxyLm9jY2FzaW9ufHwnJyxpdGVtTmFtZTppdGVtLHdlaWdodEdtczp3fSk7YWRkZWQrKzt9cmV0dXJuO30KICAgIGlmKHR5cGU9PT0ncmVhbEVzdGF0ZScpe2NvbnN0IGRhdGU9bm9ybWFsaXplRGF0ZShyLkRhdGV8fHIuZGF0ZSk7Y29uc3QgdmFsPXBhcnNlRmxvYXQoU3RyaW5nKHIuUHVyY2hhc2VWYWx1ZXx8ci5QdXJjaGFzZXx8ci5wdXJjaGFzZVZhbHVlfHxyWydQdXJjaGFzZSBWYWx1ZSddfHwwKS5yZXBsYWNlKC9bXjAtOS4tXS9nLCcnKSk7aWYoZGF0ZSYmdmFsKXtjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8c2VsZWN0ZWRNb250aDtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnk6ci5Db3VudHJ5fHxyLmNvdW50cnl8fCdVUycsY3VycmVuY3k6ci5DdXJyZW5jeXx8ci5jdXJyZW5jeXx8J1VTRCcscHVyY2hhc2VWYWx1ZTp2YWwsZGVzY3JpcHRpb246ci5EZXNjcmlwdGlvbnx8JycsYXJlYUNlbnRzOnBhcnNlRmxvYXQoci5BcmVhfHxyLmFyZWF8fDApLGN1cnJlbnRWYWx1ZTpwYXJzZUZsb2F0KHIuQ3VycmVudFZhbHVlfHxyLmN1cnJlbnRWYWx1ZXx8MCl9KTthZGRlZCsrO31yZXR1cm47fQogICAgY29uc3QgZGF0ZVN0cj1yLkRhdGV8fHIuZGF0ZXx8ci5EQVRFO2NvbnN0IGFtdFN0cj1yLkFtb3VudHx8ci5hbW91bnR8fHIuRGViaXR8fHIuQ3JlZGl0OwogICAgaWYoZGF0ZVN0ciYmYW10U3RyKXtjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUoZGF0ZVN0cik7Y29uc3QgYW1vdW50PXBhcnNlRmxvYXQoU3RyaW5nKGFtdFN0cikucmVwbGFjZSgvW14wLTkuLV0vZywnJykpO2lmKGRhdGUmJiFpc05hTihhbW91bnQpKXtjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8c2VsZWN0ZWRNb250aDtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV1bdHlwZV0ucHVzaCh7ZGF0ZSxjYXRlZ29yeTpyLkNhdGVnb3J5fHwnSW1wb3J0ZWQnLGFtb3VudCxkZXNjcmlwdGlvbjpyLkRlc2NyaXB0aW9ufHwnJ30pO2FkZGVkKys7fX0KICB9KTsKICBpZihhZGRlZD4wKXtzYXZlKCk7cG9wdWxhdGVEYXRhTW9udGhTZWxlY3QoKTtyZW5kZXJEYXRhU2NyZWVuKCk7c2hvd1RvYXN0KGDinIUgSW1wb3J0ZWQgJHthZGRlZH0gcm93cyFgKTt9ZWxzZSBzaG93VG9hc3QoJ05vIHZhbGlkIHJvd3MgZm91bmQuJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBNRVRBTFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIGdldE1ldGFscygpIHsgaWYoIWRhdGEuX21ldGFscykgZGF0YS5fbWV0YWxzPVtdOyByZXR1cm4gZGF0YS5fbWV0YWxzOyB9CmZ1bmN0aW9uIHRvZ2dsZUFkZFBhbmVsKCkgeyBhZGRQYW5lbE9wZW49IWFkZFBhbmVsT3BlbjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWFkZC1wYW5lbC1ib2R5JykuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicsYWRkUGFuZWxPcGVuKTsgY29uc3QgdD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXBhbmVsLXRvZ2dsZScpOyB0LnRleHRDb250ZW50PWFkZFBhbmVsT3Blbj8n4oiSJzonKyc7IHQuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicsYWRkUGFuZWxPcGVuKTsgfQpmdW5jdGlvbiBzaG93TWV0YWxQcmljZUVkaXQoKSB7CiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2Utb3ZlcnJpZGUtcGFuZWwnKTsKICBpZiAoIXBhbmVsKSByZXR1cm47CiAgY29uc3QgaXNWaXNpYmxlID0gcGFuZWwuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnOwogIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSBpc1Zpc2libGUgPyAnbm9uZScgOiAnJzsKICBpZiAoIWlzVmlzaWJsZSkgewogICAgY29uc3QgYmFzZSA9IGdldE1ldGFsQmFzZVByaWNlKGN1cnJlbnRNZXRhbCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2Utb3ZlcnJpZGUtaW5wdXQnKS52YWx1ZSA9IGJhc2UudG9GaXhlZCgyKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1vdmVycmlkZS1sYWJlbCcpLnRleHRDb250ZW50ID0KICAgICAgYFNldCBiYXNlIHByaWNlICgke2N1cnJlbnRNZXRhbCA9PT0gJ2dvbGQnID8gJzI0SyBwdXJlJyA6IGN1cnJlbnRNZXRhbCA9PT0gJ3NpbHZlcicgPyAnOTk5IEZpbmUnIDogJ1B0OTk5J30pICQvZ3JhbSBmb3IgJHtNRVRBTF9DT05GSUdbY3VycmVudE1ldGFsXS5sYWJlbH06YDsKICAgIHJlbmRlclB1cml0eVByaWNlcyhjdXJyZW50TWV0YWwpOwogIH0KfQoKZnVuY3Rpb24gYXBwbHlNZXRhbFByaWNlT3ZlcnJpZGUoKSB7CiAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1vdmVycmlkZS1pbnB1dCcpLnZhbHVlKTsKICBpZiAoIXByaWNlIHx8IHByaWNlIDw9IDApIHsgc2hvd1RvYXN0KCdFbnRlciBhIHZhbGlkIHByaWNlIOKdjCcpOyByZXR1cm47IH0KICB1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUoY3VycmVudE1ldGFsLCBwcmljZSk7IC8vIG5vIHB1cml0eSA9IHNldHMgYmFzZSBwcmljZQogIHJlbmRlclB1cml0eVByaWNlcyhjdXJyZW50TWV0YWwpOwp9CgpmdW5jdGlvbiByZW5kZXJQdXJpdHlQcmljZXMobWV0YWxUeXBlKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHVyaXR5LXByaWNlcycpOwogIGlmICghZWwpIHJldHVybjsKICBjb25zdCBiYXNlID0gZ2V0TWV0YWxCYXNlUHJpY2UobWV0YWxUeXBlKTsKICBjb25zdCBvdmVycmlkZXMgPSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzIHx8IHt9OwoKICBjb25zdCBwdXJpdGllcyA9IG1ldGFsVHlwZSA9PT0gJ2dvbGQnCiAgICA/IFtbJzI0SycsMS4wXSxbJzIySycsMC45MTY3XSxbJzIxSycsMC44NzVdLFsnMThLJywwLjc1XSxbJzE0SycsMC41ODMzXSxbJzEwSycsMC40MTY3XSxbJzlLJywwLjM3NV1dCiAgICA6IG1ldGFsVHlwZSA9PT0gJ3NpbHZlcicKICAgID8gW1snOTk5JywxLjBdLFsnOTk1JywwLjk5NV0sWyc5MjUnLDAuOTI1XSxbJzkwMCcsMC45XSxbJzg1MCcsMC44NV0sWyc4MDAnLDAuOF1dCiAgICA6IFtbJzk5OScsMS4wXSxbJ1B0OTUwJywwLjk1XSxbJ1B0OTAwJywwLjldLFsnUHQ4NTAnLDAuODVdXTsKCiAgY29uc3Qgcm93cyA9IHB1cml0aWVzLm1hcCgoW3AsIG11bHRdKSA9PiB7CiAgICBjb25zdCBwdXJpdHlLZXkgPSBtZXRhbFR5cGUgKyAnfCcgKyBub3JtYWxpemVQdXJpdHkocCk7CiAgICBjb25zdCBoYXNPdmVycmlkZSA9IG92ZXJyaWRlc1twdXJpdHlLZXldICE9PSB1bmRlZmluZWQ7CiAgICBjb25zdCBlZmZlY3RpdmVQcmljZSA9IGhhc092ZXJyaWRlID8gb3ZlcnJpZGVzW3B1cml0eUtleV0gOiAoYmFzZSAqIG11bHQpOwogICAgY29uc3Qgb3ZlcnJpZGVCYWRnZSA9IGhhc092ZXJyaWRlCiAgICAgID8gYDxzcGFuIHN0eWxlPSJjb2xvcjojMTBCOTgxO2ZvbnQtc2l6ZTowLjg1ZW07IiB0aXRsZT0iQ3VzdG9tIHByaWNlIHNldCI+4pyP77iPPC9zcGFuPmAKICAgICAgOiAnJzsKICAgIHJldHVybiBgPHRyIHN0eWxlPSJib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRjBGMEYwOyI+CiAgICAgIDx0ZCBzdHlsZT0icGFkZGlu','Zzo0cHggNnB4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO2ZvbnQtc2l6ZTowLjgyZW07Ij4ke3B9PC90ZD4KICAgICAgPHRkIHN0eWxlPSJwYWRkaW5nOjRweCA2cHg7Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTtmb250LXNpemU6MC43OGVtOyI+JHtoYXNPdmVycmlkZSA/ICcnIDogKG11bHQqMTAwKS50b0ZpeGVkKDEpKyclJ308L3RkPgogICAgICA8dGQgc3R5bGU9InBhZGRpbmc6NHB4IDZweDtmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Zm9udC1zaXplOjAuODhlbTsiPiQke2VmZmVjdGl2ZVByaWNlLnRvRml4ZWQoMil9L2cgJHtvdmVycmlkZUJhZGdlfTwvdGQ+CiAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo0cHggMnB4O3RleHQtYWxpZ246cmlnaHQ7Ij4KICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im9wZW5QdXJpdHlPdmVycmlkZSgnJHttZXRhbFR5cGV9JywnJHtwfScsJHtlZmZlY3RpdmVQcmljZX0pIgogICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtwYWRkaW5nOjJweCA3cHg7Zm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS1wcmltYXJ5KTtjdXJzb3I6cG9pbnRlcjsiPlNldDwvYnV0dG9uPgogICAgICAgICR7aGFzT3ZlcnJpZGUgPyBgPGJ1dHRvbiBvbmNsaWNrPSJ1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUoJyR7bWV0YWxUeXBlfScsMCwnJHtwfScpIgogICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0ZGRjBGMDtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtwYWRkaW5nOjJweCA3cHg7Zm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjojRUY0NDQ0O2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjJweDsiPuKclTwvYnV0dG9uPmAgOiAnJ30KICAgICAgPC90ZD4KICAgIDwvdHI+YDsKICB9KS5qb2luKCcnKTsKCiAgZWwuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTttYXJnaW4tYm90dG9tOjVweDsiPvCfko4gUHJpY2UgYnkgUHVyaXR5IOKAlCB0YXAgPGI+U2V0PC9iPiB0byBvdmVycmlkZSBhbnkgcm93OjwvZGl2PgogICAgPHRhYmxlIHN0eWxlPSJ3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsiPiR7cm93c308L3RhYmxlPgogICAgPGRpdiBpZD0icHVyaXR5LW92ZXJyaWRlLWlubGluZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjhweDtiYWNrZ3JvdW5kOndoaXRlO2JvcmRlcjoxLjVweCBzb2xpZCAjREREO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6OHB4IDEwcHg7Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzVlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTttYXJnaW4tYm90dG9tOjVweDsiIGlkPSJwb2ktbGFiZWwiPlNldCBwcmljZSBmb3Ig4oCUPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4O2FsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJwb2ktaW5wdXQiIHN0ZXA9IjAuMDEiIHBsYWNlaG9sZGVyPSIkL2dyYW0iCiAgICAgICAgICBzdHlsZT0iZmxleDoxO2JvcmRlcjoxLjVweCBzb2xpZCAjREREO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6NXB4IDhweDtmb250LXNpemU6MC45ZW07Zm9udC13ZWlnaHQ6NzAwOyI+CiAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJhcHBseVB1cml0eU92ZXJyaWRlKCkiCiAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDojMTBCOTgxO2NvbG9yOndoaXRlO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6NXB4IDEwcHg7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y3Vyc29yOnBvaW50ZXI7Ij7inJMgU2F2ZTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3B1cml0eS1vdmVycmlkZS1pbmxpbmUnKS5zdHlsZS5kaXNwbGF5PSdub25lJyIKICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kOiNFRUU7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo1cHggMTBweDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODJlbTtjdXJzb3I6cG9pbnRlcjtjb2xvcjp2YXIoLS10ZXh0LW1lZCk7Ij7inJU8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj5gOwp9CgpsZXQgX3BvaU1ldGFsID0gJycsIF9wb2lQdXJpdHkgPSAnJzsKZnVuY3Rpb24gb3BlblB1cml0eU92ZXJyaWRlKG1ldGFsVHlwZSwgcHVyaXR5LCBjdXJyZW50UHJpY2UpIHsKICBfcG9pTWV0YWwgPSBtZXRhbFR5cGU7IF9wb2lQdXJpdHkgPSBwdXJpdHk7CiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHVyaXR5LW92ZXJyaWRlLWlubGluZScpOwogIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1sYWJlbCcpOwogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1pbnB1dCcpOwogIGlmICghcGFuZWwpIHJldHVybjsKICBpZiAobGFiZWwpIGxhYmVsLnRleHRDb250ZW50ID0gYFNldCAkL2dyYW0gZm9yICR7cHVyaXR5fSAke21ldGFsVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSttZXRhbFR5cGUuc2xpY2UoMSl9OmA7CiAgaWYgKGlucHV0KSB7IGlucHV0LnZhbHVlID0gY3VycmVudFByaWNlLnRvRml4ZWQoMik7IGlucHV0LmZvY3VzKCk7IH0KICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJyc7Cn0KZnVuY3Rpb24gYXBwbHlQdXJpdHlPdmVycmlkZSgpIHsKICBjb25zdCBwcmljZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1pbnB1dCcpPy52YWx1ZSk7CiAgaWYgKCFwcmljZSB8fCBwcmljZSA8PSAwKSB7IHNob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCBwcmljZSDinYwnKTsgcmV0dXJuOyB9CiAgdXBkYXRlTWV0YWxQcmljZU92ZXJyaWRlKF9wb2lNZXRhbCwgcHJpY2UsIF9wb2lQdXJpdHkpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwdXJpdHktb3ZlcnJpZGUtaW5saW5lJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gc3dpdGNoTWV0YWwodHlwZSkgewogIGN1cnJlbnRNZXRhbD10eXBlOyBjb25zdCBjZmc9TUVUQUxfQ09ORklHW3R5cGVdOwogIFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJ10uZm9yRWFjaCh0PT5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluaS0nK3QpLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZS1tZXRhbCcsdD09PXR5cGUpKTsKICBjb25zdCBpdz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZGV0YWlsLWljb24nKTsgaXcudGV4dENvbnRlbnQ9Y2ZnLmVtb2ppOyBpdy5jbGFzc05hbWU9J21ldGFsLWRldGFpbC1pY29uLXdyYXAgJyt0eXBlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kZXRhaWwtbmFtZScpLnRleHRDb250ZW50PWNmZy5sYWJlbDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZGV0YWlsLXVzZCcpLmNsYXNzTmFtZT0nbWV0YWwtZGV0YWlsLXVzZCAnK3R5cGU7CiAgY29uc3QgYmFzZVByaWNlID0gZ2V0TWV0YWxCYXNlUHJpY2UodHlwZSk7CiAgY29uc3QgaGFzT3ZlcnJpZGUgPSAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWxpdmUtcHJpY2UnKS50ZXh0Q29udGVudD0nJCcrYmFzZVByaWNlLnRvRml4ZWQoMikrKGhhc092ZXJyaWRlPycg4pyP77iPJzonJyk7CiAgY29uc3QgYmFzZUxhYmVsID0gdHlwZSA9PT0gJ2dvbGQnID8gJyQvZ3JhbSAoMjRLIHB1cmUpJyA6IHR5cGUgPT09ICdzaWx2ZXInID8gJyQvZ3JhbSAoOTk5IEZpbmUpJyA6ICckL2dyYW0gKFB0OTk5KSc7CiAgY29uc3QgYmFzZUxhYmVsRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2UtYmFzZS1sYWJlbCcpOwogIGlmIChiYXNlTGFiZWxFbCkgYmFzZUxhYmVsRWwudGV4dENvbnRlbnQgPSBiYXNlTGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWFkZC1pY29uJykudGV4dENvbnRlbnQ9Y2ZnLmVtb2ppOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1hZGQtbGFiZWwnKS50ZXh0Q29udGVudD1jZmcubGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXNhdmUtYnRuJykudGV4dENvbnRlbnQ9JysgQWRkICcrY2ZnLmxhYmVsKycgRW50cnknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1zYXZlLWJ0bicpLmNsYXNzTmFtZT0nbWV0YWwtc2F2ZS1idG4gJyt0eXBlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1oaW50JykudGV4dENvbnRlbnQ9J/CfkqEgJytjZmcuaGludDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9sZGluZ3MtbGlzdC10aXRsZScpLnRleHRDb250ZW50PWNmZy5lbW9qaSsnICcrY2ZnLmxhYmVsKycgSG9sZGluZ3MnOwogIC8vIENsb3NlIHByaWNlIHBhbmVsIHdoZW4gc3dpdGNoaW5nIG1ldGFscwogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXByaWNlLW92ZXJyaWRlLXBhbmVsJyk7CiAgaWYgKHBhbmVsKSBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIHJlbmRlck1ldGFscygpOwp9CmZ1bmN0aW9uIHJlbmRlck1ldGFscygpIHsKICBjb25zdCBtZXRhbHM9Z2V0TWV0YWxzKCksIGNmZz1NRVRBTF9DT05GSUc7CiAgY29uc3QgdG90YWxzPXt9OwogIC8vIEFsc28gZm9sZCBpbiBOVy1zaGVldCBtZXRhbCBhY2NvdW50cyBzbyBtaW5pLXRpbGVzIHNob3cgY29tYmluZWQgdG90YWxzCiAgY29uc3QgbndNZXRhbEFjY291bnRzID0gKGRhdGEuX253QWNjb3VudHN8fFtdKS5maWx0ZXIoYT0+YS50eXBlPT09J21ldGFscycpOwogIE9iamVjdC5rZXlzKGNmZykuZm9yRWFjaCh0PT57CiAgICBjb25zdCBlbnRyaWVzPW1ldGFscy5maWx0ZXIobT0+bS5tZXRhbFR5cGU9PT10KTsKICAgIGNvbnN0IGdyYW1zPWVudHJpZXMucmVkdWNlKChzLG0pPT5zK051bWJlcihtLmdyYW1zfHxtLndlaWdodEdtc3x8MCksMCk7CiAgICBjb25zdCB1c2Q9ZW50cmllcy5yZWR1Y2UoKHMsbSk9PnsKICAgICAgY29uc3QgZz1OdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgICAvLyBBbHdheXMgdXNlIGxpdmUgcHJpY2UgKG5vdCBzdG9yZWQgcHVyY2hhc2UgcHJpY2UpIHNvIHRvdGFsIG1hdGNoZXMgTmV0V29ydGgKICAgICAgY29uc3QgcHJpY2U9Z2V0UHJpY2VGb3JNZXRhbCh0LCBtLnB1cml0eSk7CiAgICAgIHJldHVybiBzK2cqcHJpY2U7CiAgICB9LDApOwogICAgLy8gQWRkIE5XIG1hbnVhbCBhY2NvdW50cyBmb3IgdGhpcyBtZXRhbCB0eXBlCiAgICBjb25zdCBud0VudHJpZXM9bndNZXRhbEFjY291bnRzLmZpbHRlcihhPT5hLm1ldGEmJmEubWV0YS5tZXRhbFR5cGU9PT10KTsKICAgIGNvbnN0IG53R3JhbXM9bndFbnRyaWVzLnJlZHVjZSgocyxhKT0+cytOdW1iZXIoYS5tZXRhLmdyYW1zfHwwKSwwKTsKICAgIGNvbnN0IG53VXNkPW53RW50cmllcy5yZWR1Y2UoKHMsYSk9PnsKICAgICAgY29uc3QgZz1OdW1iZXIoYS5tZXRhJiZhLm1ldGEuZ3JhbXN8fDApOwogICAgICBjb25zdCBwdXJpdHk9YS5tZXRhJiZhLm1ldGEucHVyaXR5fHwnJzsKICAgICAgLy8gQWx3YXlzIHJlY29tcHV0ZSBmcm9tIGdyYW1zIMOXIGxpdmUgcHJpY2Ugc28gTWV0YWxzIHBhZ2Ugc3RheXMgaW4gc3luYyB3aXRoIE5ldFdvcnRoCiAgICAgIHJldHVybiBzICsgZyAqIGdldFByaWNlRm9yTWV0YWwodCwgcHVyaXR5KTsKICAgIH0sMCk7CiAgICB0b3RhbHNbdF09e2VudHJpZXMsZ3JhbXM6Z3JhbXMrbndHcmFtcyx1c2Q6dXNkK253VXNkLGF2Z0Nvc3Q6KGdyYW1zK253R3JhbXMpPjA/KHVzZCtu','d1VzZCkvKGdyYW1zK253R3JhbXMpOjB9OwogIH0pOwogIGNvbnN0IGdyYW5kVG90YWw9T2JqZWN0LnZhbHVlcyh0b3RhbHMpLnJlZHVjZSgocyx0KT0+cyt0LnVzZCwwKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWxzLWdyYW5kLXRvdGFsJykudGV4dENvbnRlbnQ9Zm10KGdyYW5kVG90YWwpOwogIE9iamVjdC5rZXlzKGNmZykuZm9yRWFjaCh0PT57ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbmktJyt0KyctZ3JhbXMnKS50ZXh0Q29udGVudD10b3RhbHNbdF0uZ3JhbXMudG9GaXhlZCgyKSsnIGcnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW5pLScrdCsnLXVzZCcpLnRleHRDb250ZW50PWZtdCh0b3RhbHNbdF0udXNkKTt9KTsKICBjb25zdCBhY3RpdmU9dG90YWxzW2N1cnJlbnRNZXRhbF0sIGFjPWNmZ1tjdXJyZW50TWV0YWxdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kZXRhaWwtZ3JhbXMnKS50ZXh0Q29udGVudD1hY3RpdmUuZ3JhbXMudG9GaXhlZCgzKSsnIGcgwrcgJysoYWN0aXZlLmdyYW1zLzMxLjEwMzUpLnRvRml4ZWQoMykrJyBveic7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWRldGFpbC11c2QnKS50ZXh0Q29udGVudD1mbXQoYWN0aXZlLnVzZCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXN0YXQtZW50cmllcycpLnRleHRDb250ZW50PWFjdGl2ZS5lbnRyaWVzLmxlbmd0aDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtc3RhdC1veicpLnRleHRDb250ZW50PShhY3RpdmUuZ3JhbXMvMzEuMTAzNSkudG9GaXhlZCgzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtc3RhdC1hdmcnKS50ZXh0Q29udGVudD1hY3RpdmUuYXZnQ29zdD4wPyckJythY3RpdmUuYXZnQ29zdC50b0ZpeGVkKDIpOickMCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbGRpbmdzLWxpc3QtY291bnQnKS50ZXh0Q29udGVudD1hY3RpdmUuZW50cmllcy5sZW5ndGgrKGFjdGl2ZS5lbnRyaWVzLmxlbmd0aD09PTE/JyBlbnRyeSc6JyBlbnRyaWVzJyk7CiAgY29uc3QgaGw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFscy1ob2xkaW5ncy1saXN0Jyk7CiAgaWYoYWN0aXZlLmVudHJpZXMubGVuZ3RoPT09MCl7aGwuaW5uZXJIVE1MPWA8ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eSI+PGRpdiBjbGFzcz0ibWV0YWwtZW1wdHktaWNvbiI+JHthYy5lbW9qaX08L2Rpdj48ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eS10ZXh0Ij5ObyAke2FjLmxhYmVsLnRvTG93ZXJDYXNlKCl9IGVudHJpZXMgeWV0Ljxicj5UYXAgKyBhYm92ZSB0byBhZGQgb25lLjwvZGl2PjwvZGl2PmA7cmV0dXJuO30KICAvLyBDb21iaW5lIF9tZXRhbHMgKyBOVyBhY2NvdW50cyBmb3IgdGhpcyBtZXRhbCB0eXBlCiAgY29uc3QgbndNZXRhbEZvclR5cGUgPSAoZGF0YS5fbndBY2NvdW50c3x8W10pLmZpbHRlcihhPT5hLnR5cGU9PT0nbWV0YWxzJyYmYS5tZXRhJiZhLm1ldGEubWV0YWxUeXBlPT09Y3VycmVudE1ldGFsKTsKICBjb25zdCBhbGxFbnRyaWVzID0gWwogICAgLi4uYWN0aXZlLmVudHJpZXMubWFwKG0gPT4gKHsgLi4ubSwgX3NvdXJjZTogJ3BvcnRmb2xpbycgfSkpLAogICAgLi4ubndNZXRhbEZvclR5cGUubWFwKGEgPT4gKHsKICAgICAgbmFtZTogYS5uYW1lLCBncmFtczogTnVtYmVyKGEubWV0YS5ncmFtc3x8MCksIHByaWNlOiAwLAogICAgICBwdXJpdHk6IGEubWV0YS5wdXJpdHl8fCcnLCBvY2Nhc2lvbjogYS5tZXRhLm9jY2FzaW9ufHwnJywgZm9ybTogYS5tZXRhLmZvcm18fCcnLAogICAgICBkYXRlOiBhLmxhc3RVcGRhdGVkfHwnJywgbm90ZXM6IGEubWV0YS5ub3Rlc3x8JycsIF9zb3VyY2U6ICduZXR3b3J0aCcsIF9ud0lkOiBhLmlkCiAgICB9KSkKICBdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob2xkaW5ncy1saXN0LWNvdW50JykudGV4dENvbnRlbnQgPSBhbGxFbnRyaWVzLmxlbmd0aCArIChhbGxFbnRyaWVzLmxlbmd0aD09PTE/JyBlbnRyeSc6JyBlbnRyaWVzJyk7CiAgaWYoYWxsRW50cmllcy5sZW5ndGg9PT0wKXtobC5pbm5lckhUTUw9YDxkaXYgY2xhc3M9Im1ldGFsLWVtcHR5Ij48ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eS1pY29uIj4ke2FjLmVtb2ppfTwvZGl2PjxkaXYgY2xhc3M9Im1ldGFsLWVtcHR5LXRleHQiPk5vICR7YWMubGFiZWwudG9Mb3dlckNhc2UoKX0gZW50cmllcyB5ZXQuPGJyPlRhcCArIGFib3ZlIHRvIGFkZCBvbmUuPC9kaXY+PC9kaXY+YDtyZXR1cm47fQogIGhsLmlubmVySFRNTD1hbGxFbnRyaWVzLm1hcCgobSxpZHgpPT57CiAgICBjb25zdCBncmFtcz1OdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgY29uc3QgcHVyaXR5ID0gbS5wdXJpdHl8fCcnOwogICAgLy8gQWx3YXlzIHNob3cgbGl2ZSBwcmljZSBwZXIgZ3JhbSAocHVyY2hhc2UgcHJpY2Ugc2hvd24gc2VwYXJhdGVseSBhcyBhdmcgY29zdCkKICAgIGNvbnN0IHByaWNlID0gZ2V0UHJpY2VGb3JNZXRhbChjdXJyZW50TWV0YWwsIHB1cml0eSk7CiAgICBjb25zdCB1c2RWYWw9Z3JhbXMqcHJpY2U7CiAgICBjb25zdCBvej0oZ3JhbXMvMzEuMTAzNSkudG9GaXhlZCgzKTsKICAgIGNvbnN0IHB1cml0eVRhZyA9IHB1cml0eSA/IGA8c3BhbiBzdHlsZT0iYmFja2dyb3VuZDojRjVGNUY1O2JvcmRlci1yYWRpdXM6NXB4O3BhZGRpbmc6MXB4IDZweDtmb250LXNpemU6MC43NWVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjojN0MzQUVEOyI+JHtwdXJpdHl9PC9zcGFuPmAgOiAnJzsKICAgIGNvbnN0IHByaWNlVGFnID0gYDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC43NWVtOyI+JCR7cHJpY2UudG9GaXhlZCgyKX0vZzwvc3Bhbj5gOwogICAgY29uc3Qgc291cmNlVGFnID0gbS5fc291cmNlPT09J25ldHdvcnRoJyA/IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+IMK3IPCfk4ogTlc8L3NwYW4+YCA6ICcnOwogICAgY29uc3QgZGVsQnRuID0gbS5fc291cmNlPT09J25ldHdvcnRoJwogICAgICA/IGA8YnV0dG9uIGNsYXNzPSJtZXRhbC1ob2xkaW5nLWRlbCIgb25jbGljaz0ibmF2aWdhdGVUbygnbmV0d29ydGgnKSIgdGl0bGU9IkVkaXQgaW4gTmV0IFdvcnRoIj7ihpfvuI88L2J1dHRvbj5gCiAgICAgIDogYDxidXR0b24gY2xhc3M9Im1ldGFsLWhvbGRpbmctZGVsIiBvbmNsaWNrPSJkZWxldGVNZXRhbEVudHJ5KCR7bWV0YWxzLmluZGV4T2YobSl9KSI+4pyVPC9idXR0b24+YDsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy1pdGVtIj4KICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy1iYWRnZSAke2N1cnJlbnRNZXRhbH0iPiR7YWMuZW1vaml9PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctbWFpbiI+CiAgICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy10b3AiPgogICAgICAgICAgPHNwYW4gY2xhc3M9Im1ldGFsLWhvbGRpbmctbmFtZS10ZXh0Ij4ke20ubmFtZXx8bS5pdGVtTmFtZXx8J1VubmFtZWQnfTwvc3Bhbj4KICAgICAgICAgICR7cHVyaXR5VGFnfQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctYm90dG9tIj4ke2dyYW1zLnRvRml4ZWQoMil9ZyDCtyAke296fW96ICR7cHJpY2VUYWd9JHttLm9jY2FzaW9uPycgwrcgJyttLm9jY2FzaW9uOicnfSR7bS5ub3Rlcz8nIMK3ICcrbS5ub3RlczonJ30ke3NvdXJjZVRhZ308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctcmlnaHQiPgogICAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctdmFsdWUiPiR7Zm10KHVzZFZhbCl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy13ZWlnaHQiPiR7Z3JhbXMudG9GaXhlZCgyKX0gZzwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgJHtkZWxCdG59CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwp9CmZ1bmN0aW9uIGFkZE1ldGFsRW50cnkoKSB7CiAgY29uc3QgbmFtZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtbmFtZScpLnZhbHVlLnRyaW0oKSwgZ3JhbXM9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZ3JhbXMnKS52YWx1ZSksIHByaWNlPXBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXByaWNlJykudmFsdWUpfHwwLCBkYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kYXRlJykudmFsdWV8fG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLCBmb3JtPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1mb3JtJykudmFsdWUsIG5vdGVzPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1ub3RlcycpLnZhbHVlLnRyaW0oKSwgcHVyaXR5PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wdXJpdHknKS52YWx1ZS50cmltKCksIG9jY2FzaW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1vY2Nhc2lvbicpLnZhbHVlLnRyaW0oKTsKICBpZighbmFtZSl7c2hvd1RvYXN0KCdFbnRlciBhIHNvdXJjZS9uYW1lIOKdjCcpO3JldHVybjt9IGlmKCFncmFtc3x8Z3JhbXM8PTApe3Nob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCB3ZWlnaHQg4p2MJyk7cmV0dXJuO30KICBnZXRNZXRhbHMoKS5wdXNoKHttZXRhbFR5cGU6Y3VycmVudE1ldGFsLG5hbWUsZ3JhbXMscHJpY2U6cHJpY2V8fE1FVEFMX0NPTkZJR1tjdXJyZW50TWV0YWxdLnByaWNlUGVyR3JhbSxkYXRlLGZvcm0sbm90ZXMscHVyaXR5LG9jY2FzaW9ufSk7CiAgc2F2ZSgpOyByZW5kZXJNZXRhbHMoKTsKICBbJ25hbWUnLCdncmFtcycsJ3ByaWNlJywnbm90ZXMnLCdwdXJpdHknLCdvY2Nhc2lvbiddLmZvckVhY2goaWQ9Pnt0cnl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLScraWQpLnZhbHVlPScnO31jYXRjaChlKXt9fSk7CiAgYWRkUGFuZWxPcGVuPWZhbHNlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtYWRkLXBhbmVsLWJvZHknKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcGFuZWwtdG9nZ2xlJykudGV4dENvbnRlbnQ9JysnOwogIHNob3dUb2FzdChNRVRBTF9DT05GSUdbY3VycmVudE1ldGFsXS5lbW9qaSsnICcrTUVUQUxfQ09ORklHW2N1cnJlbnRNZXRhbF0ubGFiZWwrJyBlbnRyeSBhZGRlZCEnKTsKfQpmdW5jdGlvbiBkZWxldGVNZXRhbEVudHJ5KGlkeCkgeyBpZighY29uZmlybSgnRGVsZXRlIHRoaXMgZW50cnk/JykpIHJldHVybjsgZGF0YS5fbWV0YWxzLnNwbGljZShpZHgsMSk7IHNhdmUoKTsgcmVuZGVyTWV0YWxzKCk7IHNob3dUb2FzdCgnRW50cnkgZGVsZXRlZCcpOyB9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSU5WRVNUTUVOVFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIGdldEludmVzdG1lbnRzKCkgeyBpZighZGF0YS5faW52ZXN0bWVudHMpIGRhdGEuX2ludmVzdG1lbnRzPVtdOyByZXR1cm4gZGF0YS5faW52ZXN0bWVudHM7IH0KZnVuY3Rpb24gZmlsdGVySW52ZXN0KGNhdCxidG4pIHsgY3VycmVudEludmVzdEZpbHRlcj1jYXQ7IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnZlc3QtY2F0LXRhYicpLmZvckVhY2goYj0+Yi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7IGJ0','bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgcmVuZGVySW52ZXN0bWVudHMoKTsgfQpmdW5jdGlvbiByZW5kZXJJbnZlc3RtZW50cygpIHsKICBjb25zdCBpbnZlc3RtZW50cz1nZXRJbnZlc3RtZW50cygpOwogIGxldCB0b3RhbENvc3Q9MCwgdG90YWxWYWx1ZT0wOwogIGludmVzdG1lbnRzLmZvckVhY2goaW52PT57dG90YWxDb3N0Kz1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5jb3N0fHwwKTt0b3RhbFZhbHVlKz1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5wcmljZXx8aW52LmNvc3R8fDApO30pOwogIGNvbnN0IHRvdGFsR2Fpbj10b3RhbFZhbHVlLXRvdGFsQ29zdCwgdG90YWxQY3Q9dG90YWxDb3N0PjA/dG90YWxHYWluL3RvdGFsQ29zdCoxMDA6MDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52ZXN0LXRvdGFsLXZhbHVlJykudGV4dENvbnRlbnQ9Zm10KHRvdGFsVmFsdWUpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtY29zdCcpLnRleHRDb250ZW50PWZtdCh0b3RhbENvc3QpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtZ2FpbicpLnRleHRDb250ZW50PSh0b3RhbEdhaW4+PTA/JysnOictJykrZm10KE1hdGguYWJzKHRvdGFsR2FpbikpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtcGN0JykudGV4dENvbnRlbnQ9KHRvdGFsUGN0Pj0wPycrJzonJykrdG90YWxQY3QudG9GaXhlZCgxKSsnJSc7CiAgY29uc3QgZmlsdGVyZWQ9Y3VycmVudEludmVzdEZpbHRlcj09PSdBbGwnP2ludmVzdG1lbnRzOmludmVzdG1lbnRzLmZpbHRlcihpbnY9Pmludi5jYXRlZ29yeT09PWN1cnJlbnRJbnZlc3RGaWx0ZXIpOwogIGNvbnN0IGhsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtaG9sZGluZ3MtbGlzdCcpOwogIGlmKGZpbHRlcmVkLmxlbmd0aD09PTApe2hsLmlubmVySFRNTD1gPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2JhY2tncm91bmQ6dmFyKC0td2hpdGUpO2JvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTtib3gtc2hhZG93OnZhcigtLWNhcmQtc2hhZG93KTsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToyLjVlbTttYXJnaW4tYm90dG9tOjhweDsiPvCfk4o8L2Rpdj48ZGl2IHN0eWxlPSJmb250LXdlaWdodDo3MDA7Ij5ObyBpbnZlc3RtZW50cyR7Y3VycmVudEludmVzdEZpbHRlciE9PSdBbGwnPycgaW4gJytjdXJyZW50SW52ZXN0RmlsdGVyOicnfSB5ZXQ8L2Rpdj48L2Rpdj5gO3JldHVybjt9CiAgY29uc3QgY2F0Q29sb3JzPXtTdG9ja3M6JyM0QTlFRkYnLEVURjonIzEwQjk4MScsQ3J5cHRvOicjRjU5RTBCJyxSZXRpcmVtZW50OicjN0MzQUVEJywnUmVhbCBFc3RhdGUnOicjRkY2QjM1JyxPdGhlcjonIzlBQTBCMid9OwogIGhsLmlubmVySFRNTD1maWx0ZXJlZC5tYXAoaW52PT57Y29uc3QgcmVhbElkeD1pbnZlc3RtZW50cy5pbmRleE9mKGludik7Y29uc3QgY29zdD1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5jb3N0fHwwKTtjb25zdCB2YWw9TnVtYmVyKGludi5zaGFyZXN8fDApKk51bWJlcihpbnYucHJpY2V8fGludi5jb3N0fHwwKTtjb25zdCBnYWluPXZhbC1jb3N0O2NvbnN0IHBjdD1jb3N0PjA/Z2Fpbi9jb3N0KjEwMDowO2NvbnN0IGNvbG9yPWNhdENvbG9yc1tpbnYuY2F0ZWdvcnldfHwnIzlBQTBCMic7cmV0dXJuYDxkaXYgY2xhc3M9ImludmVzdC1ob2xkaW5nLXJvdyI+PGRpdiBjbGFzcz0iaW52ZXN0LXRpY2tlci1iYWRnZSIgc3R5bGU9ImJhY2tncm91bmQ6JHtjb2xvcn0xODtjb2xvcjoke2NvbG9yfTsiPiR7KGludi50aWNrZXJ8fCc/JykudG9VcHBlckNhc2UoKX08L2Rpdj48ZGl2IGNsYXNzPSJpbnZlc3QtaW5mbyI+PGRpdiBjbGFzcz0iaW52ZXN0LW5hbWUiPiR7aW52LnRpY2tlcnx8J0ludmVzdG1lbnQnfTwvZGl2PjxkaXYgY2xhc3M9ImludmVzdC1kZXRhaWwiPiR7aW52LnNoYXJlc30gc2hhcmVzIMK3ICR7aW52LmJyb2tlcnx8Jyd9IMK3ICR7aW52LmNhdGVnb3J5fHwnJ308L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJpbnZlc3QtdmFsdWVzIj48ZGl2IGNsYXNzPSJpbnZlc3QtdmFsdWUiPiR7Zm10KHZhbCl9PC9kaXY+PGRpdiBjbGFzcz0iaW52ZXN0LWdhaW4gJHtnYWluPj0wPyd1cCc6J2Rvd24nfSI+JHtnYWluPj0wPycrJzonLSd9JHtmbXRGdWxsKE1hdGguYWJzKGdhaW4pKX0gKCR7cGN0LnRvRml4ZWQoMSl9JSk8L2Rpdj48L2Rpdj48YnV0dG9uIG9uY2xpY2s9ImRlbGV0ZUludmVzdEVudHJ5KCR7cmVhbElkeH0pIiBzdHlsZT0iYmFja2dyb3VuZDojRkZGMEYwO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6NnB4IDhweDtmb250LXNpemU6MC43NWVtO2NvbG9yOnZhcigtLWV4cGVuc2VzKTtjdXJzb3I6cG9pbnRlcjttYXJnaW4tbGVmdDo4cHg7Ij7inJU8L2J1dHRvbj48L2Rpdj5gO30pLmpvaW4oJycpOwp9CmZ1bmN0aW9uIGFkZEludmVzdEVudHJ5KCkgewogIGNvbnN0IHRpY2tlcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXRpY2tlcicpLnZhbHVlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLCBjYXRlZ29yeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhdCcpLnZhbHVlLCBzaGFyZXM9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXNoYXJlcycpLnZhbHVlKSwgY29zdD1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY29zdCcpLnZhbHVlKSwgcHJpY2U9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXByaWNlJykudmFsdWUpfHxjb3N0LCBkYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtZGF0ZScpLnZhbHVlfHxuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSwgYnJva2VyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtYnJva2VyJykudmFsdWUudHJpbSgpOwogIGlmKCF0aWNrZXJ8fCFzaGFyZXN8fCFjb3N0KXtzaG93VG9hc3QoJ0ZpbGwgaW4gdGlja2VyLCBzaGFyZXMgJiBjb3N0IOKdjCcpO3JldHVybjt9CiAgY29uc3QgaW52ZXN0bWVudHM9Z2V0SW52ZXN0bWVudHMoKTsKICBjb25zdCBleGlzdGluZz1pbnZlc3RtZW50cy5maW5kKGludj0+aW52LnRpY2tlcj09PXRpY2tlciYmaW52LmNhdGVnb3J5PT09Y2F0ZWdvcnkpOwogIGlmKGV4aXN0aW5nKXtpZihjb25maXJtKGAke3RpY2tlcn0gYWxyZWFkeSBleGlzdHMuIEFkZCBtb3JlIHNoYXJlcz9gKSl7Y29uc3QgdHM9TnVtYmVyKGV4aXN0aW5nLnNoYXJlcykrc2hhcmVzO2V4aXN0aW5nLmNvc3Q9KChOdW1iZXIoZXhpc3RpbmcuY29zdCkqTnVtYmVyKGV4aXN0aW5nLnNoYXJlcykrY29zdCpzaGFyZXMpL3RzKS50b0ZpeGVkKDIpO2V4aXN0aW5nLnNoYXJlcz10cy50b0ZpeGVkKDQpO2lmKHByaWNlKSBleGlzdGluZy5wcmljZT1wcmljZS50b0ZpeGVkKDIpO31lbHNlIHJldHVybjt9CiAgZWxzZSBpbnZlc3RtZW50cy5wdXNoKHt0aWNrZXIsY2F0ZWdvcnksc2hhcmVzOnNoYXJlcy50b0ZpeGVkKDQpLGNvc3Q6Y29zdC50b0ZpeGVkKDIpLHByaWNlOnByaWNlLnRvRml4ZWQoMiksZGF0ZSxicm9rZXJ9KTsKICBzYXZlKCk7IHJlbmRlckludmVzdG1lbnRzKCk7CiAgWydpbnYtdGlja2VyJywnaW52LXNoYXJlcycsJ2ludi1jb3N0JywnaW52LXByaWNlJywnaW52LWJyb2tlciddLmZvckVhY2goaWQ9PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS52YWx1ZT0nJyk7CiAgc2hvd1RvYXN0KGDwn5OIICR7dGlja2VyfSBhZGRlZCB0byBwb3J0Zm9saW8hYCk7Cn0KZnVuY3Rpb24gZGVsZXRlSW52ZXN0RW50cnkoaWR4KSB7IGlmKCFjb25maXJtKCdSZW1vdmUgdGhpcyBpbnZlc3RtZW50PycpKSByZXR1cm47IGRhdGEuX2ludmVzdG1lbnRzLnNwbGljZShpZHgsMSk7IHNhdmUoKTsgcmVuZGVySW52ZXN0bWVudHMoKTsgc2hvd1RvYXN0KCdJbnZlc3RtZW50IHJlbW92ZWQnKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFBJTiBMT0NLIOKAlCBDT01NRU5URUQgT1VUIChSRS1FTkFCTEUgTEFURVIpCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovKgo9PT0gUElOIExPQ0sgSkFWQVNDUklQVCDigJQgVW5jb21tZW50IHRoaXMgZW50aXJlIGJsb2NrIHRvIHJlLWVuYWJsZSA9PT0KPT09IEFsc28gdW5jb21tZW50OiBDU1MgYmxvY2ssIEhUTUwgbG9jayBzY3JlZW4gZGl2LCBpbml0TG9ja1NjcmVlbigpIGluIGluaXQgPT09Cgpjb25zdCBQSU5fS0VZID0gJ21mX3Bpbic7CmxldCBwaW5CdWZmZXIgPSAnJywgbG9ja01vZGUgPSAndW5sb2NrJywgc2V0dXBGaXJzdFBpbiA9ICcnLCBsb2NrQXR0ZW1wdHMgPSAwOwpjb25zdCBNQVhfQVRURU1QVFMgPSA1OwpsZXQgbG9ja291dFRpbWVySW50ZXJ2YWwgPSBudWxsOwoKZnVuY3Rpb24gZ2V0U3RvcmVkUElOKCl7IHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShQSU5fS0VZKXx8Jyc7IH0KZnVuY3Rpb24gaGFzUGluKCl7IHJldHVybiAhIWdldFN0b3JlZFBJTigpOyB9CgpmdW5jdGlvbiBpbml0TG9ja1NjcmVlbigpewogIGNvbnN0IGxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2stc2NyZWVuJyk7CiAgaWYoIWxzKSByZXR1cm47CiAgaWYoaGFzUGluKCkpewogICAgbG9ja01vZGUgPSAndW5sb2NrJzsKICAgIGxzLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgfSBlbHNlIHsKICAgIGxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfQp9CgpmdW5jdGlvbiBwaW5QcmVzcyhkaWdpdCl7IC4uLiB9CmZ1bmN0aW9uIHBpbkRlbCgpeyAuLi4gfQpmdW5jdGlvbiBoYW5kbGVQaW5Db21wbGV0ZSgpeyAuLi4gfQpmdW5jdGlvbiB1bmxvY2tBcHAoKXsgLi4uIH0KZnVuY3Rpb24gaGlkZUxvY2tTY3JlZW4oKXsgLi4uIH0KZnVuY3Rpb24gaGFuZGxlUGluVG9nZ2xlKCl7IC4uLiB9CmZ1bmN0aW9uIG9wZW5Mb2NrRm9yU2V0dXAoKXsgLi4uIH0KZnVuY3Rpb24gc2hvd0NoYW5nZVBJTigpeyAuLi4gfQpmdW5jdGlvbiB1cGRhdGVTZXR0aW5nc1BpblVJKCl7IC4uLiB9Ci8vIChmaWxsIGluIHRoZSBmdWxsIGltcGxlbWVudGF0aW9ucyBmcm9tIHRoZSBvcmlnaW5hbCBjb2RlKQoKPT09IEVORCBQSU4gTE9DSyBKQVZBU0NSSVBUID09PQoqLwoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEJVREdFVCBNT0RVTEUKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBidWRnZXRWaWV3TW9udGggPSBnZXRDdXJyZW50TW9udGhLZXkoKTsKbGV0IGN1cnJlbnRCdWRnZXRUYWIgPSAnb3ZlcnZpZXcnOwpsZXQgY3VycmVudEJ1ZGdldENhdERldGFpbCA9IG51bGw7IC8vIHt0eXBlOidleHBlbnNlJ3wnc2F2aW5ncycsIGdvYWxLZXl9CmxldCBlZGl0aW5nQnVkZ2V0S2V5ID0gbnVsbDsgLy8gbnVsbCA9IG5ldywgc3RyaW5nID0gZXhpc3Rpbmcga2V5Cmxl','dCBlZGl0aW5nQnVkZ2V0VHlwZSA9ICdleHBlbnNlJzsKbGV0IHBpY2tlZEJ1ZGdldEVtb2ppID0gJ/CfkrgnOwoKY29uc3QgQlVER0VUX0VNT0pJUyA9IFsn8J+SuCcsJ/Cfm5InLCfwn5qXJywn8J+PoCcsJ/CfkoonLCfwn46tJywn8J+NlCcsJ+KYlScsJ/CfjpMnLCfwn5C+Jywn4pyI77iPJywn8J+RlycsJ/Cfjq4nLCfwn4+L77iPJywn8J+OgScsJ/Cfk7EnLCfimqEnLCfwn5qMJywn8J+SiCcsJ/CfjqonLCfwn4+lJywn8J+PpicsJ/CflKcnLCfwn4yuJywn8J+TmicsJ/CfkJ8nLCfwn4y/Jywn8J+SoScsJ/Cfjq8nLCfwn4+hJywn8J+lhycsJ/CfkrAnLCfwn5OIJywn8J+Pm++4jycsJ/CfjoknLCfwn42VJywn8J+MuicsJ/CfjIonLCfwn462Jywn8J+nmCddOwoKLy8gRGVmYXVsdCBleHBlbnNlIGJ1ZGdldHMgbWF0Y2hpbmcgdGhlIGV4Y2VsIHNuYXBzaG90CmNvbnN0IERFRkFVTFRfRVhQRU5TRV9CVURHRVRTID0gWwogIHtrZXk6J0Zhc3RGb29kJywgICBuYW1lOidGYXN0IEZvb2QnLCAgICBpY29uOifwn42UJywgYW1vdW50OjEwMCwgbGlua2VkQ2F0czpbJ0Zhc3RGb29kJ119LAogIHtrZXk6J0dyb2NlcmllcycsICBuYW1lOidHcm9jZXJpZXMnLCAgICBpY29uOifwn5uSJywgYW1vdW50OjQwMCwgbGlua2VkQ2F0czpbJ0dyb2NlcmllcyddfSwKICB7a2V5OidVdGlsaXR5JywgICAgbmFtZTonVXRpbGl0eScsICAgICAgaWNvbjon4pqhJywgYW1vdW50OjUwMCwgbGlua2VkQ2F0czpbJ1V0aWxpdHknLCdCaWxscyddfSwKICB7a2V5OidBdXRvJywgICAgICAgbmFtZTonQXV0bycsICAgICAgICAgaWNvbjon8J+alycsIGFtb3VudDo5MDAsIGxpbmtlZENhdHM6WydBdXRvJywnR2FzJywnVHJhbnNwb3J0J119LAogIHtrZXk6J01vcnRnYWdlJywgICBuYW1lOidNb3J0Z2FnZScsICAgICBpY29uOifwn4+gJywgYW1vdW50OjIzMTAsIGxpbmtlZENhdHM6WydNb3J0Z2FnZScsJ1JlbnQnLCdIb3VzaW5nJ119LAogIHtrZXk6J1Nob3BwaW5nJywgICBuYW1lOidTaG9wcGluZycsICAgICBpY29uOifwn5GXJywgYW1vdW50OjUwLCAgbGlua2VkQ2F0czpbJ1Nob3BwaW5nJ119LAogIHtrZXk6J0dhcycsICAgICAgICBuYW1lOidHYXMnLCAgICAgICAgICBpY29uOifim70nLCBhbW91bnQ6MTAwLCBsaW5rZWRDYXRzOlsnR2FzJywnRnVlbCddfSwKICB7a2V5OidJbnN1cmFuY2UnLCAgbmFtZTonSW5zdXJhbmNlJywgICAgaWNvbjon8J+boe+4jycsIGFtb3VudDo2Ni42MiwgbGlua2VkQ2F0czpbJ0luc3VyYW5jZSddfSwKICB7a2V5OidUb2xsJywgICAgICAgbmFtZTonVG9sbCcsICAgICAgICAgaWNvbjon8J+ajCcsIGFtb3VudDo0MCwgIGxpbmtlZENhdHM6WydUb2xsJ119LAogIHtrZXk6J1NrYW5kYScsICAgICBuYW1lOidTa2FuZGEnLCAgICAgICBpY29uOifwn46TJywgYW1vdW50OjIwMCwgbGlua2VkQ2F0czpbJ1NrYW5kYScsJ0VkdWNhdGlvbicsJ0tpZHMnXX0sCiAge2tleTonUGFyZW50cycsICAgIG5hbWU6J1BhcmVudHMnLCAgICAgIGljb246J/CfkajigI3wn5Gp4oCN8J+RpicsIGFtb3VudDoyMzAsIGxpbmtlZENhdHM6WydQYXJlbnRzJywnRmFtaWx5J119LAogIHtrZXk6J0hlYWx0aENhcmUnLCBuYW1lOidIZWFsdGggQ2FyZScsICBpY29uOifwn5KKJywgYW1vdW50OjEwMCwgbGlua2VkQ2F0czpbJ0hlYWx0aENhcmUnLCdIZWFsdGgnLCdNZWRpY2FsJ119LAogIHtrZXk6J0VudGVydGFpbm1lbnQnLCBuYW1lOidFbnRlcnRhaW5tZW50JywgaWNvbjon8J+OrScsIGFtb3VudDoyMDAsIGxpbmtlZENhdHM6WydFbnRlcnRhaW5tZW50J119LApdOwoKY29uc3QgREVGQVVMVF9TQVZJTkdTX0JVREdFVFMgPSBbCiAge2tleTonRklEJywgICAgICAgICBuYW1lOidGSUQnLCAgICAgICAgICAgICAgaWNvbjon8J+PpicsIGFtb3VudDo2MjAsIGxpbmtlZENhdHM6WydGSUQnXX0sCiAge2tleTonT25lR29sZCcsICAgICBuYW1lOidPbmUgR29sZCcsICAgICAgICAgIGljb246J/CfpYcnLCBhbW91bnQ6NDAwLCBsaW5rZWRDYXRzOlsnT25lR29sZCcsJ0dvbGQnLCdNZXRhbHMnXX0sCiAge2tleTonT25lU2lsdmVyJywgICBuYW1lOidPbmUgU2lsdmVyJywgICAgICAgIGljb246J/CfpYgnLCBhbW91bnQ6NTAwLCBsaW5rZWRDYXRzOlsnT25lU2lsdmVyJywnU2lsdmVyJ119LAogIHtrZXk6J09uZVBsYXRpbnVtJywgbmFtZTonT25lIFBsYXRpbnVtJywgICAgICBpY29uOifwn5KOJywgYW1vdW50OjIwMCwgbGlua2VkQ2F0czpbJ09uZVBsYXRpbnVtJywnUGxhdGludW0nXX0sCiAge2tleTonTUYnLCAgICAgICAgICBuYW1lOidNdXR1YWwgRnVuZHMnLCAgICAgIGljb246J/Cfk4gnLCBhbW91bnQ6NjAwLCBsaW5rZWRDYXRzOlsnTUYnLCdFVEYvTUYnLCdNdXR1YWwgRnVuZCddfSwKICB7a2V5OidTdG9ja3MnLCAgICAgIG5hbWU6J1N0b2NrcycsICAgICAgICAgICAgaWNvbjon8J+TiicsIGFtb3VudDo3MDAsIGxpbmtlZENhdHM6WydTdG9ja3MnLCdFVEYnXX0sCiAge2tleTonSU5EX1NUT0NLUycsICBuYW1lOidJTkQgU3RvY2tzJywgICAgICAgIGljb246J/CfjJAnLCBhbW91bnQ6MjAwLCBsaW5rZWRDYXRzOlsnSU5EIFNUT0NLUycsJ0lORF9TVE9DS1MnXX0sCiAge2tleTonU0FWSU5HUycsICAgICBuYW1lOidTYXZpbmdzJywgICAgICAgICAgIGljb246J/CfkrAnLCBhbW91bnQ6NDAwLCBsaW5rZWRDYXRzOlsnU0FWSU5HUycsJ1NhdmluZ3MnXX0sCiAge2tleTonQ3J5cHRvJywgICAgICBuYW1lOidDcnlwdG8nLCAgICAgICAgICAgIGljb246J/CfqpknLCBhbW91bnQ6MTAwLCBsaW5rZWRDYXRzOlsnQ3J5cHRvJ119LApdOwoKZnVuY3Rpb24gZ2V0QnVkZ2V0R29hbHModHlwZSkgewogIGNvbnN0IGtleSA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdfc2F2aW5nc0dvYWxzJyA6ICdfZXhwZW5zZUdvYWxzJzsKICBpZiAoIWRhdGFba2V5XSkgewogICAgZGF0YVtrZXldID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gREVGQVVMVF9TQVZJTkdTX0JVREdFVFMubWFwKGcgPT4gKHsuLi5nfSkpIDogREVGQVVMVF9FWFBFTlNFX0JVREdFVFMubWFwKGcgPT4gKHsuLi5nfSkpOwogICAgc2F2ZSgpOwogIH0KICByZXR1cm4gZGF0YVtrZXldOwp9CgoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEdPQUxTIE1PRFVMRSAoRmVhdHVyZSA0KQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gZ2V0R29hbHMoKSB7IHJldHVybiBkYXRhLl9nb2FscyB8fCBbXTsgfQpmdW5jdGlvbiBzYXZlR29hbHMoZ29hbHMpIHsgZGF0YS5fZ29hbHMgPSBnb2Fsczsgc2F2ZSgpOyB9CgpmdW5jdGlvbiBvcGVuR29hbFNoZWV0KGVkaXRJZCkgewogIGNvbnN0IGdvYWxzID0gZ2V0R29hbHMoKTsKICBjb25zdCBnID0gZWRpdElkID8gZ29hbHMuZmluZCh4ID0+IHguaWQgPT09IGVkaXRJZCkgOiBudWxsOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1zaGVldC10aXRsZScpLnRleHRDb250ZW50ID0gZyA/ICfinI/vuI8gRWRpdCBHb2FsJyA6ICfwn46vIE5ldyBHb2FsJzsKICBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXNhdmUtYnRuJyk7CiAgaWYgKHNhdmVCdG4pIHNhdmVCdG4udGV4dENvbnRlbnQgPSBnID8gJ+Kcj++4jyBVcGRhdGUgR29hbCcgOiAn8J+OryBBZGQgR29hbCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLW5hbWUnKS52YWx1ZSAgICA9IGcgPyBnLm5hbWUgOiAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtaWNvbicpLnZhbHVlICAgID0gZyA/IChnLmljb258fCfwn46vJykgOiAn8J+Oryc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXRhcmdldCcpLnZhbHVlICA9IGcgPyBnLnRhcmdldCA6ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy11bml0JykudmFsdWUgICAgPSBnID8gKGcudW5pdHx8J2N1cnJlbmN5JykgOiAnY3VycmVuY3knOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1jdXJyZW5jeScpLnZhbHVlPSBnID8gKGcuY3VycmVuY3l8fCdVU0QnKSA6ICdVU0QnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1kYXRlJykudmFsdWUgICAgPSBnID8gKGcudGFyZ2V0RGF0ZXx8JycpIDogJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWRlc2MnKS52YWx1ZSAgICA9IGcgPyAoZy5kZXNjfHwnJykgOiAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZWRpdGluZy1pZCcpLnZhbHVlID0gZWRpdElkIHx8ICcnOwogIGNvbnN0IGdvYWxUeXBlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZ29hbHR5cGUnKTsKICBpZiAoZ29hbFR5cGVFbCkgZ29hbFR5cGVFbC52YWx1ZSA9IGcgPyAoZy5nb2FsVHlwZXx8J2dyb3cnKSA6ICdncm93JzsKICBjb25zdCBzdGFydEJhbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXN0YXJ0YmFsJyk7CiAgaWYgKHN0YXJ0QmFsRWwpIHN0YXJ0QmFsRWwudmFsdWUgPSBnID8gKGcuc3RhcnRCYWxhbmNlfHwnJykgOiAnJzsKICB0b2dnbGVHb2FsVHlwZUZpZWxkcygpOwoKICAvLyBCdWlsZCBhY2NvdW50IHBpY2tlciBmcm9tIE5XIGFjY291bnRzCiAgYnVpbGRHb2FsQWNjb3VudFBpY2tlcihnID8gKGcubWFwcGVkQWNjb3VudHN8fFtdKSA6IFtdKTsKICAvLyBSZW5kZXIgaWNvbiBwaWNrZXIgd2l0aCBjdXJyZW50IHNlbGVjdGlvbiBoaWdobGlnaHRlZAogIHJlbmRlckdvYWxJY29uUGlja2VyKGcgPyAoZy5pY29ufHwn8J+OrycpIDogJ/Cfjq8nKTsKICB1cGRhdGVHb2FsUHJldmlldygpOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1zaGVldCcpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLXNoZWV0LW92ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKfQoKZnVuY3Rpb24gdG9nZ2xlR29hbFR5cGVGaWVsZHMoKSB7CiAgY29uc3QgZ29hbFR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZ29hbHR5cGUnKT8udmFsdWUgfHwgJ2dyb3cnOwogIGNvbnN0IHN0YXJ0QmFsUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXN0YXJ0YmFsLXJvdycpOwogIGlmIChzdGFydEJhbFJvdykgc3RhcnRCYWxSb3cuc3R5bGUuZGlzcGxheSA9IGdvYWxUeXBlID09PSAncmVkdWNlJyA/ICcnIDogJ25vbmUnOwogIC8vIEZvciByZWR1Y2UgZ29hbHMsIHNob3cgbGlhYmlsaXR5LWZyaWVuZGx5IGxhYmVsIG9uIGFjY291bnQgcGlja2VyCiAgY29uc3QgcGlja2VyTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtcGlja2VyLWxhYmVsJyk7CiAgaWYgKHBpY2tlckxhYmVsKSB7CiAgICBwaWNrZXJMYWJlbC50ZXh0Q29udGVudCA9IGdvYWxUeXBlID09PSAncmVkdWNlJwogICAgICA/ICdNYXAgTGlhYmlsaXR5IEFjY291bnRzIHRvIHRyYWNrIHJlZHVjdGlvbiBwcm9ncmVzcycKICAgICAgOiAnTWFwIE5XIEFjY291bnRzIHRvIHRoaXMgR29hbCc7CiAgfQogIGNvbnN0IHBpY2tlckhpbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtcGlja2VyLWhpbnQnKTsKICBpZiAocGlja2VySGludCkgewogICAgcGlja2VySGludC50ZXh0Q29udGVudCA9IGdvYWxUeXBlID09PSAncmVkdWNlJwogICAgICA/ICdTZWxlY3QgbG9hbi9jcmVkaXQgY2FyZCBhY2NvdW50cy4gUHJvZ3Jlc3MgdHJhY2tzIGFzIHRoZSBiYWxhbmNlIGdvZXMgZG93bi4nCiAgICAgIDogJ1NlYXJjaCBh','bmQgc2VsZWN0IGFjY291bnRzIOKAlCBncm91cGVkIGJ5IHR5cGUuIENvbWJpbmVkIHZhbHVlIGNvdW50cyBhcyBjdXJyZW50IHByb2dyZXNzLic7CiAgfQogIHVwZGF0ZUdvYWxQcmV2aWV3KCk7Cn0KCmZ1bmN0aW9uIGNsb3NlR29hbFNoZWV0KCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2FsLXNoZWV0Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1zaGVldC1vdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gY2xvc2VHb2Fsc1BhbmVsQmFjaygpIHsKICAvLyBHbyBiYWNrIHRvIGJ1ZGdldCBvdmVydmlldwogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsaXN0LWdvYWxzJyk7CiAgY29uc3QgZmFiICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbHMtZmFiLWJ0bicpOwogIGlmIChwYW5lbCkgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBpZiAoZmFiKSAgIGZhYi5zdHlsZS5kaXNwbGF5ICAgPSAnbm9uZSc7CiAgc2V0QnVkZ2V0VGFiKCdvdmVydmlldycsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidGFiLW92ZXJ2aWV3JykpOwp9CgovLyDilIDilIAgSG9sZHMgdGhlIGZ1bGwgYWNjb3VudCBsaXN0IHNvIGZpbHRlciBjYW4gcmUtcmVuZGVyIHdpdGhvdXQgcmVjb21wdXRpbmcKbGV0IF9nYXBBbGxHcm91cHMgPSBbXTsKbGV0IF9nYXBTZWxlY3RlZElkcyA9IG5ldyBTZXQoKTsKCi8vIOKUgOKUgCBHb2FscyBwYW5lbCB0YWIgc3RhdGUg4pSA4pSACmxldCBnb2Fsc1RhYiA9ICdhY3RpdmUnOyAvLyAnYWN0aXZlJyB8ICdhY2hpZXZlZCcKCmNvbnN0IEdPQUxfRU1PSklTID0gWwogICfwn46vJywn8J+PhicsJ/Cfj4UnLCfwn5KwJywn8J+PoCcsJ/CfmpcnLCfwn46TJywn4pyI77iPJywn8J+RqOKAjfCfkanigI3wn5Gn4oCN8J+RpicsJ/Cfj5bvuI8nLAogICfwn5KOJywn8J+lhycsJ/Cfk4gnLCfwn4+b77iPJywn8J+boe+4jycsJ/CfjI0nLCfwn6eTJywn8J+SiicsJ/CfjoknLCfwn5SRJywKICAn8J+Pl++4jycsJ/CfjLEnLCfimqEnLCfwn5OxJywn8J+Pi++4jycsJ/CfjqgnLCfwn5qiJywn8J+MuicsJ/CfjrYnLCfwn5C+JywKXTsKCmZ1bmN0aW9uIHJlbmRlckdvYWxJY29uUGlja2VyKGN1cnJlbnRJY29uKSB7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1pY29uLWdyaWQnKTsKICBpZiAoIWdyaWQpIHJldHVybjsKICBjb25zdCBwaWNrZWQgPSBjdXJyZW50SWNvbiB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtaWNvbicpPy52YWx1ZSB8fCAn8J+Oryc7CiAgZ3JpZC5pbm5lckhUTUwgPSBHT0FMX0VNT0pJUy5tYXAoZSA9PgogICAgYDxkaXYgb25jbGljaz0icGlja0dvYWxJY29uKCcke2V9JykiCiAgICAgIHN0eWxlPSJ3aWR0aDozOHB4O2hlaWdodDozOHB4O2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MnB4IHNvbGlkICR7ZT09PXBpY2tlZD8ndmFyKC0teWVsbG93KSc6J3RyYW5zcGFyZW50J307CiAgICAgICAgICAgICBiYWNrZ3JvdW5kOiR7ZT09PXBpY2tlZD8ndmFyKC0teWVsbG93LWxpZ2h0KSc6J3ZhcigtLWJnKSd9OwogICAgICAgICAgICAgZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2ZvbnQtc2l6ZToxLjJlbTtjdXJzb3I6cG9pbnRlcjt0cmFuc2l0aW9uOmFsbCAwLjE1czsiCiAgICAgIGlkPSJncy1pY29uLW9wdC0ke2UuY29kZVBvaW50QXQoMCl9Ij4ke2V9PC9kaXY+YAogICkuam9pbignJyk7Cn0KCmZ1bmN0aW9uIHBpY2tHb2FsSWNvbihlKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWljb24nKS52YWx1ZSA9IGU7CiAgcmVuZGVyR29hbEljb25QaWNrZXIoZSk7Cn0KCmZ1bmN0aW9uIHNldEdvYWxzVGFiKHRhYikgewogIGdvYWxzVGFiID0gdGFiOwogIGNvbnN0IGFjdGl2ZUJ0biAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0YWItYWN0aXZlJyk7CiAgY29uc3QgYWNoaWV2ZWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3RhYi1hY2hpZXZlZCcpOwogIGlmIChhY3RpdmVCdG4pIHsKICAgIGFjdGl2ZUJ0bi5zdHlsZS5iYWNrZ3JvdW5kICAgPSB0YWIgPT09ICdhY3RpdmUnICAgPyAndmFyKC0teWVsbG93KScgOiAnI0YwRjBGMCc7CiAgICBhY3RpdmVCdG4uc3R5bGUuY29sb3IgICAgICAgID0gdGFiID09PSAnYWN0aXZlJyAgID8gJ3ZhcigtLXRleHQtZGFyayknIDogJ3ZhcigtLXRleHQtbWVkKSc7CiAgfQogIGlmIChhY2hpZXZlZEJ0bikgewogICAgYWNoaWV2ZWRCdG4uc3R5bGUuYmFja2dyb3VuZCA9IHRhYiA9PT0gJ2FjaGlldmVkJyA/ICd2YXIoLS15ZWxsb3cpJyA6ICcjRjBGMEYwJzsKICAgIGFjaGlldmVkQnRuLnN0eWxlLmNvbG9yICAgICAgPSB0YWIgPT09ICdhY2hpZXZlZCcgPyAndmFyKC0tdGV4dC1kYXJrKScgOiAndmFyKC0tdGV4dC1tZWQpJzsKICB9CiAgcmVuZGVyR29hbHNQYW5lbCgpOwp9CgpmdW5jdGlvbiBidWlsZEdvYWxBY2NvdW50UGlja2VyKHNlbGVjdGVkSWRzKSB7CiAgX2dhcFNlbGVjdGVkSWRzID0gbmV3IFNldChzZWxlY3RlZElkcyB8fCBbXSk7CiAgY29uc3QgbncgPSBjb21wdXRlTmV0V29ydGgoKTsKCiAgLy8gQnVpbGQgZ3JvdXBlZCBzdHJ1Y3R1cmUg4oCUIG9uZSBncm91cCBwZXIgTlcgdHlwZQogIF9nYXBBbGxHcm91cHMgPSBbXTsKICBPYmplY3Qua2V5cyhOV19UWVBFUykuZm9yRWFjaCh0ID0+IHsKICAgIGNvbnN0IGNmZyAgID0gTldfVFlQRVNbdF07CiAgICBjb25zdCBncm91cCA9IG53LmJ5VHlwZVt0XTsKICAgIGlmICghZ3JvdXAgfHwgZ3JvdXAuYWNjb3VudHMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgLy8gRm9yIG1ldGFsczogY29uc29saWRhdGUgaW5kaXZpZHVhbCByb3dzIGJ5IG1ldGFsVHlwZStwdXJpdHkgdG8gYXZvaWQgMTkwLXJvdyBmbG9vZHMKICAgIGxldCBhY2NvdW50cyA9IGdyb3VwLmFjY291bnRzOwogICAgaWYgKHQgPT09ICdtZXRhbHMnKSB7CiAgICAgIGNvbnN0IGNvbnNvbGlkYXRlZCA9IHt9OwogICAgICBhY2NvdW50cy5mb3JFYWNoKGEgPT4gewogICAgICAgIGNvbnN0IG1ldGFsICA9IChhLm1ldGEgJiYgYS5tZXRhLm1ldGFsVHlwZSkgfHwgJ2dvbGQnOwogICAgICAgIGNvbnN0IHB1cml0eSA9IChhLm1ldGEgJiYgYS5tZXRhLnB1cml0eSkgICAgfHwgJyc7CiAgICAgICAgY29uc3Qga2V5ICAgID0gbWV0YWwgKyAnfCcgKyBwdXJpdHk7CiAgICAgICAgaWYgKCFjb25zb2xpZGF0ZWRba2V5XSkgewogICAgICAgICAgY29uc29saWRhdGVkW2tleV0gPSB7CiAgICAgICAgICAgIC4uLmEsCiAgICAgICAgICAgIGlkOiAgIGEuaWQsICAgICAgICAgICAgICAgICAgICAgIC8vIGtlZXAgZmlyc3QgaWQgZm9yIHNpbXBsZSBjYXNlcwogICAgICAgICAgICBfaWRzOiBbYS5pZF0sICAgICAgICAgICAgICAgICAgICAvLyBBTEwgaWRzIGluIHRoaXMgZ3JvdXAKICAgICAgICAgICAgbmFtZTogY2ZnLmVtb2ppICsgJyAnICsgbWV0YWwuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBtZXRhbC5zbGljZSgxKSArIChwdXJpdHkgPyAnIMK3ICcgKyBwdXJpdHkgOiAnJyksCiAgICAgICAgICAgIF92YWw6ICBhLl92YWwgfHwgMCwKICAgICAgICAgICAgbWV0YTogeyAuLi5hLm1ldGEgfSwKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGlkYXRlZFtrZXldLl9pZHMucHVzaChhLmlkKTsKICAgICAgICAgIGNvbnNvbGlkYXRlZFtrZXldLl92YWwgICs9IChhLl92YWwgIHx8IDApOwogICAgICAgICAgY29uc29saWRhdGVkW2tleV0ubWV0YS5ncmFtcyA9IChOdW1iZXIoY29uc29saWRhdGVkW2tleV0ubWV0YS5ncmFtcykgfHwgMCkgKyAoTnVtYmVyKGEubWV0YSAmJiBhLm1ldGEuZ3JhbXMpIHx8IDApOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGFjY291bnRzID0gT2JqZWN0LnZhbHVlcyhjb25zb2xpZGF0ZWQpLm1hcChjID0+ICh7CiAgICAgICAgLi4uYywKICAgICAgICBpZDogYy5faWRzWzBdLCAgICAgICAgICAvLyBwcmltYXJ5IGlkIGZvciBzaW5nbGUtYWNjb3VudCBnb2FsIG1hcHBpbmcKICAgICAgICBfYWxsSWRzOiBjLl9pZHMsICAgICAgICAvLyBhbGwgaWRzIHNvIHVzZXIgY2FuIHNlbGVjdCB0aGUgd2hvbGUgZ3JvdXAKICAgICAgfSkpOwogICAgfQoKICAgIGNvbnN0IGdyb3VwVG90YWwgPSBhY2NvdW50cy5yZWR1Y2UoKHMsIGEpID0+IHMgKyAoYS5fdmFsIHx8IDApLCAwKTsKICAgIF9nYXBBbGxHcm91cHMucHVzaCh7IHR5cGU6dCwgY2ZnLCBhY2NvdW50cywgZ3JvdXBUb3RhbCB9KTsKICB9KTsKCiAgaWYgKF9nYXBBbGxHcm91cHMubGVuZ3RoID09PSAwKSB7CiAgICBjb25zdCBwaWNrZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtYWNjb3VudC1waWNrZXInKTsKICAgIGlmIChwaWNrZXIpIHBpY2tlci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iZ2FwLWVtcHR5Ij5ObyBOZXQgV29ydGggYWNjb3VudHMgeWV0IOKAlCBhZGQgdGhlbSBpbiB0aGUgTmV0IFdvcnRoIHNjcmVlbi48L2Rpdj4nOwogICAgcmV0dXJuOwogIH0KICAvLyBDbGVhciBzZWFyY2ggYW5kIHJlbmRlcgogIGNvbnN0IHNlYXJjaElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1zZWFyY2gtaW5wdXQnKTsKICBpZiAoc2VhcmNoSW5wdXQpIHNlYXJjaElucHV0LnZhbHVlID0gJyc7CiAgX3JlbmRlckdhcEdyb3VwcygnJyk7Cn0KCmZ1bmN0aW9uIF9yZW5kZXJHYXBHcm91cHMocXVlcnkpIHsKICBjb25zdCBwaWNrZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtYWNjb3VudC1waWNrZXInKTsKICBpZiAoIXBpY2tlcikgcmV0dXJuOwogIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICBsZXQgaHRtbCA9ICcnOwogIGxldCBhbnlSZXN1bHQgPSBmYWxzZTsKCiAgX2dhcEFsbEdyb3Vwcy5mb3JFYWNoKChncnAsIGdpKSA9PiB7CiAgICBjb25zdCBmaWx0ZXJlZEFjY291bnRzID0gcQogICAgICA/IGdycC5hY2NvdW50cy5maWx0ZXIoYSA9PiBhLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSkKICAgICAgOiBncnAuYWNjb3VudHM7CiAgICBpZiAoZmlsdGVyZWRBY2NvdW50cy5sZW5ndGggPT09IDApIHJldHVybjsKICAgIGFueVJlc3VsdCA9IHRydWU7CgogICAgY29uc3QgZ3JvdXBTZWxlY3RlZENvdW50ID0gZmlsdGVyZWRBY2NvdW50cy5maWx0ZXIoYSA9PiB7CiAgICAgIGNvbnN0IGlkcyA9IGEuX2FsbElkcyB8fCBbYS5pZF07CiAgICAgIHJldHVybiBpZHMuc29tZShpZCA9PiBfZ2FwU2VsZWN0ZWRJZHMuaGFzKGlkKSk7CiAgICB9KS5sZW5ndGg7CiAgICBjb25zdCBhbGxTZWxlY3RlZCA9IGdyb3VwU2VsZWN0ZWRDb3VudCA9PT0gZmlsdGVyZWRBY2NvdW50cy5sZW5ndGg7CiAgICBjb25zdCBncm91cFRvdGFsRm10ID0gZm10KGdycC5ncm91cFRvdGFsKTsKICAgIGNvbnN0IGNvbGxhcHNlSWQgPSAnZ2FwZ3JwXycgKyBnaTsKCiAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJnYXAtZ3JvdXAiPgogICAgICA8ZGl2IGNsYXNzPSJnYXAtZ3JvdXAtaGVhZGVyIiBvbmNsaWNrPSJ0b2dnbGVHYXBHcm91cCgnJHtjb2xsYXBzZUlkfScpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJnYXAtZ3JvdXAtdGl0bGUiPgogICAgICAgICAgPHNwYW4+JHtncnAuY2ZnLmVtb2ppfTwvc3Bhbj4KICAgICAgICAgIDxzcGFuPiR7Z3JwLmNmZy5sYWJlbH08L3NwYW4+CiAgICAgICAgICAke2dyb3VwU2VsZWN0ZWRDb3VudCA+IDAgPyBgPHNwYW4gc3R5bGU9ImJhY2tncm91bmQ6dmFyKC0tcHJpbWFyeSk7Y29sb3I6d2hpdGU7Zm9udC1zaXplOjAuNjVlbTtib3JkZXItcmFkaXVzOjIwcHg7cGFkZGluZzoycHggN3B4OyI+JHtncm91cFNlbGVjdGVkQ291bnR9IHNlbGVjdGVkPC9zcGFuPmAgOiAnJ30KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJnYXAtZ3JvdXAtbWV0YSI+CiAgICAgICAgICA8c3Bh','biBjbGFzcz0iZ2FwLWdyb3VwLXRvdGFsIj4ke2dyb3VwVG90YWxGbXR9PC9zcGFuPgogICAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjc1ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCkiPiR7ZmlsdGVyZWRBY2NvdW50cy5sZW5ndGh9IGFjY3Qke2ZpbHRlcmVkQWNjb3VudHMubGVuZ3RoPT09MT8nJzoncyd9PC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImdhcC1ncm91cC1jaGV2cm9uIG9wZW4iIGlkPSIke2NvbGxhcHNlSWR9X2NoZXYiPuKAujwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImdhcC1ncm91cC1ib2R5IiBpZD0iJHtjb2xsYXBzZUlkfSI+CiAgICAgICAgJHshcSA/IGA8ZGl2IGNsYXNzPSJnYXAtc2VsZWN0LWFsbCIgb25jbGljaz0iZ2FwU2VsZWN0QWxsKCR7Z2l9LCR7YWxsU2VsZWN0ZWR9KSI+CiAgICAgICAgICAke2FsbFNlbGVjdGVkID8gJ+KYkSBEZXNlbGVjdCBhbGwgaW4gZ3JvdXAnIDogJ+KYkCBTZWxlY3QgYWxsIGluIGdyb3VwJ30KICAgICAgICA8L2Rpdj5gIDogJyd9CiAgICAgICAgJHtmaWx0ZXJlZEFjY291bnRzLm1hcCgoYSwgYWkpID0+IHsKICAgICAgICAgIGNvbnN0IGlkcyA9IGEuX2FsbElkcyB8fCBbYS5pZF07CiAgICAgICAgICBjb25zdCBpc0NoZWNrZWQgPSBpZHMuc29tZShpZCA9PiBfZ2FwU2VsZWN0ZWRJZHMuaGFzKGlkKSk7CiAgICAgICAgICBjb25zdCBncmFtcyA9IGEubWV0YSAmJiBhLm1ldGEuZ3JhbXMgPyBOdW1iZXIoYS5tZXRhLmdyYW1zKS50b0ZpeGVkKDEpICsgJ2cnIDogJyc7CiAgICAgICAgICBjb25zdCBveiAgICA9IGEubWV0YSAmJiBhLm1ldGEuZ3JhbXMgPyAoTnVtYmVyKGEubWV0YS5ncmFtcykvMzEuMTAzNSkudG9GaXhlZCgzKSArICcgb3onIDogJyc7CiAgICAgICAgICBjb25zdCBzdWJMaW5lID0gZ3JhbXMgPyBgJHtncmFtc30gwrcgJHtven1gIDogKGEubWV0YSAmJiBhLm1ldGEucHVyaXR5ID8gYS5tZXRhLnB1cml0eSA6ICcnKTsKICAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iZ2FwLWFjYy1yb3cgJHtpc0NoZWNrZWQ/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9ImdhcFRvZ2dsZUFjYygke2dpfSwke2FpfSwnJHtpZHMuam9pbignLCcpfScsdGhpcykiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYXAtYWNjLWNiICR7aXNDaGVja2VkPydjaGVja2VkJzonJ30iIGlkPSJnYXBjYl8ke2dpfV8ke2FpfSI+JHtpc0NoZWNrZWQ/J+Kckyc6Jyd9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MTttaW4td2lkdGg6MDsiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhcC1hY2MtbmFtZSI+JHthLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgJHtzdWJMaW5lID8gYDxkaXYgY2xhc3M9ImdhcC1hY2Mtc3ViIj4ke3N1YkxpbmV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ2FwLWFjYy12YWwiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhcC1hY2MtdmFsLW1haW4iPiR7Zm10KGEuX3ZhbHx8MCl9PC9kaXY+CiAgICAgICAgICAgICAgJHthLmN1cnJlbmN5ICYmIGEuY3VycmVuY3kgIT09IGN1cnJlbnRDdXJyZW5jeS5jb2RlID8gYDxkaXYgY2xhc3M9ImdhcC1hY2MtdmFsLXN1YiI+JHthLmN1cnJlbmN5fTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0pLmpvaW4oJycpfQogICAgICA8L2Rpdj4KICAgIDwvZGl2PmA7CiAgfSk7CgogIHBpY2tlci5pbm5lckhUTUwgPSBhbnlSZXN1bHQgPyBodG1sIDogJzxkaXYgY2xhc3M9ImdhcC1lbXB0eSI+Tm8gYWNjb3VudHMgbWF0Y2ggeW91ciBzZWFyY2g8L2Rpdj4nOwp9CgpmdW5jdGlvbiB0b2dnbGVHYXBHcm91cChpZCkgewogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgY29uc3QgY2hldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgJ19jaGV2Jyk7CiAgaWYgKCFib2R5KSByZXR1cm47CiAgY29uc3QgY29sbGFwc2VkID0gYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKTsKICBpZiAoY2hldikgeyBjaGV2LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nLCAhY29sbGFwc2VkKTsgfQp9CgpmdW5jdGlvbiBnYXBTZWxlY3RBbGwoZ3JvdXBJZHgsIGRlc2VsZWN0TW9kZSkgewogIGNvbnN0IGdycCA9IF9nYXBBbGxHcm91cHNbZ3JvdXBJZHhdOwogIGlmICghZ3JwKSByZXR1cm47CiAgZ3JwLmFjY291bnRzLmZvckVhY2goYSA9PiB7CiAgICBjb25zdCBpZHMgPSBhLl9hbGxJZHMgfHwgW2EuaWRdOwogICAgaWRzLmZvckVhY2goaWQgPT4gZGVzZWxlY3RNb2RlID8gX2dhcFNlbGVjdGVkSWRzLmRlbGV0ZShpZCkgOiBfZ2FwU2VsZWN0ZWRJZHMuYWRkKGlkKSk7CiAgfSk7CiAgX3JlbmRlckdhcEdyb3Vwcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FwLXNlYXJjaC1pbnB1dCcpPy52YWx1ZSB8fCAnJyk7CiAgdXBkYXRlR29hbFByZXZpZXcoKTsKfQoKZnVuY3Rpb24gZ2FwVG9nZ2xlQWNjKGdyb3VwSWR4LCBhY2NJZHgsIGlkc1N0ciwgcm93RWwpIHsKICBjb25zdCBpZHMgPSBpZHNTdHIuc3BsaXQoJywnKTsKICBjb25zdCBpc05vd1NlbGVjdGVkID0gaWRzLnNvbWUoaWQgPT4gX2dhcFNlbGVjdGVkSWRzLmhhcyhpZCkpOwogIGlmIChpc05vd1NlbGVjdGVkKSB7CiAgICBpZHMuZm9yRWFjaChpZCA9PiBfZ2FwU2VsZWN0ZWRJZHMuZGVsZXRlKGlkKSk7CiAgfSBlbHNlIHsKICAgIGlkcy5mb3JFYWNoKGlkID0+IF9nYXBTZWxlY3RlZElkcy5hZGQoaWQpKTsKICB9CiAgLy8gVXBkYXRlIHZpc3VhbCB3aXRob3V0IGZ1bGwgcmUtcmVuZGVyIGZvciBzcGVlZAogIGNvbnN0IGNiID0gcm93RWwucXVlcnlTZWxlY3RvcignLmdhcC1hY2MtY2InKTsKICByb3dFbC5jbGFzc0xpc3QudG9nZ2xlKCdzZWxlY3RlZCcsICFpc05vd1NlbGVjdGVkKTsKICBpZiAoY2IpIHsgY2IuY2xhc3NMaXN0LnRvZ2dsZSgnY2hlY2tlZCcsICFpc05vd1NlbGVjdGVkKTsgY2IudGV4dENvbnRlbnQgPSAhaXNOb3dTZWxlY3RlZCA/ICfinJMnIDogJyc7IH0KICAvLyBVcGRhdGUgZ3JvdXAgc2VsZWN0ZWQgYmFkZ2Ug4oCUIHJlLXJlbmRlciBncm91cCBoZWFkZXIgb25seQogIF9yZW5kZXJHYXBHcm91cHMoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1zZWFyY2gtaW5wdXQnKT8udmFsdWUgfHwgJycpOwogIHVwZGF0ZUdvYWxQcmV2aWV3KCk7Cn0KCmZ1bmN0aW9uIGZpbHRlckdvYWxQaWNrZXIocXVlcnkpIHsKICBfcmVuZGVyR2FwR3JvdXBzKHF1ZXJ5KTsKfQoKZnVuY3Rpb24gZ2V0R29hbENoZWNrZWRJZHMoKSB7CiAgcmV0dXJuIFsuLi5fZ2FwU2VsZWN0ZWRJZHNdOwp9CgpmdW5jdGlvbiB1cGRhdGVHb2FsUHJldmlldygpIHsKICBjb25zdCBzZWxlY3RlZElkcyA9IGdldEdvYWxDaGVja2VkSWRzKCk7CiAgY29uc3QgcmF3VGFyZ2V0ID0gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtdGFyZ2V0JykudmFsdWUpIHx8IDA7CiAgY29uc3QgdW5pdCAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXVuaXQnKS52YWx1ZTsKICBjb25zdCBnb2FsQ3VyICAgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWN1cnJlbmN5Jyk/LnZhbHVlIHx8IGN1cnJlbnRDdXJyZW5jeS5jb2RlKS50b1VwcGVyQ2FzZSgpOwogIGNvbnN0IHByZXZpZXcgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1wcmV2aWV3Jyk7CiAgaWYgKCFwcmV2aWV3KSByZXR1cm47CgogIGlmIChzZWxlY3RlZElkcy5sZW5ndGggPT09IDAgfHwgcmF3VGFyZ2V0ID09PSAwKSB7CiAgICBwcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICByZXR1cm47CiAgfQoKICAvLyBDb252ZXJ0IHRhcmdldCBmcm9tIGdvYWwncyBjdXJyZW5jeSB0byBkaXNwbGF5IGN1cnJlbmN5IChmb3IgYXBwbGVzLXRvLWFwcGxlcyBjb21wYXJpc29uKQogIGNvbnN0IHRhcmdldERpc3BsYXkgPSB1bml0ID09PSAnY3VycmVuY3knID8gY29udmVydEFtdChyYXdUYXJnZXQsIGdvYWxDdXIpIDogcmF3VGFyZ2V0OwogIGNvbnN0IGdvYWxUeXBlICAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZ29hbHR5cGUnKT8udmFsdWUgfHwgJ2dyb3cnOwogIGNvbnN0IGN1cnJlbnQgICAgICAgPSBjb21wdXRlR29hbEN1cnJlbnQoc2VsZWN0ZWRJZHMsIHVuaXQsIGdvYWxUeXBlKTsKICAvLyBGb3IgJ3JlZHVjZScgZ29hbHM6IHByb2dyZXNzID0gaG93IG11Y2ggYmFsYW5jZSBoYXMgZHJvcHBlZCBmcm9tIHN0YXJ0QmFsYW5jZSB0b3dhcmQgdGFyZ2V0CiAgbGV0IHBjdDsKICBpZiAoZ29hbFR5cGUgPT09ICdyZWR1Y2UnKSB7CiAgICBjb25zdCBzdGFydEJhbCA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXN0YXJ0YmFsJyk/LnZhbHVlKSB8fCAwOwogICAgY29uc3QgcmVkdWNlZCAgPSBNYXRoLm1heChzdGFydEJhbCAtIGN1cnJlbnQsIDApOwogICAgY29uc3QgdG90YWxSZWR1Y2UgPSBNYXRoLm1heChzdGFydEJhbCAtIHRhcmdldERpc3BsYXksIDApOwogICAgcGN0ID0gdG90YWxSZWR1Y2UgPiAwID8gTWF0aC5taW4ocmVkdWNlZCAvIHRvdGFsUmVkdWNlICogMTAwLCAxMDApIDogKGN1cnJlbnQgPD0gdGFyZ2V0RGlzcGxheSA/IDEwMCA6IDApOwogIH0gZWxzZSB7CiAgICBwY3QgPSB0YXJnZXREaXNwbGF5ID4gMCA/IE1hdGgubWluKGN1cnJlbnQgLyB0YXJnZXREaXNwbGF5ICogMTAwLCAxMDApIDogMDsKICB9CiAgY29uc3QgdW5pdExhYmVsICAgICA9IHVuaXQgPT09ICdncmFtcycgPyAnZycgOiB1bml0ID09PSAna2cnID8gJ2tnJyA6IHVuaXQgPT09ICdzcWZ0JyA/ICcgc3FmdCcgOiAnJzsKICBjb25zdCBmbXRDdXJyZW50ICAgID0gdW5pdCA9PT0gJ2N1cnJlbmN5JyA/IGZtdChjdXJyZW50KSAgICAgICAgOiBjdXJyZW50LnRvRml4ZWQodW5pdCA9PT0gJ3NxZnQnID8gMCA6IDIpICsgdW5pdExhYmVsOwogIGNvbnN0IGZtdFRhcmdldCAgICAgPSB1bml0ID09PSAnY3VycmVuY3knID8gZm10KHRhcmdldERpc3BsYXkpICA6IHJhd1RhcmdldC50b0ZpeGVkKDApICsgdW5pdExhYmVsOwogIGNvbnN0IGJhckNvbG9yICAgICAgPSBwY3QgPj0gMTAwID8gJyMxMEI5ODEnIDogcGN0ID49IDc1ID8gJyMzQjlFRkYnIDogcGN0ID49IDQwID8gJyNGNTlFMEInIDogJyNFRjQ0NDQnOwogIGNvbnN0IGlzRm9yZWlnbiAgICAgPSB1bml0ID09PSAnY3VycmVuY3knICYmIGdvYWxDdXIgIT09IGN1cnJlbnRDdXJyZW5jeS5jb2RlOwoKICBwcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSAnJzsKICBjb25zdCBmaWxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1wcmV2aWV3LWZpbGwnKTsKICBjb25zdCBjdXIgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1wcmV2aWV3LWN1cnJlbnQnKTsKICBjb25zdCBwY3RFbD0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1wcmV2aWV3LXBjdCcpOwogIGNvbnN0IHRndCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FwLXByZXZpZXctdGFyZ2V0Jyk7CiAgaWYgKGZpbGwpICB7IGZpbGwuc3R5bGUud2lkdGggPSBwY3QudG9GaXhlZCgxKSArICclJzsgZmlsbC5zdHlsZS5iYWNrZ3JvdW5kID0gYmFyQ29sb3I7IH0KICBpZiAoY3VyKSAgIHsKICAgIGN1ci50ZXh0Q29udGVudCA9IGdvYWxUeXBlID09PSAncmVkdWNlJyA/ICdCYWxhbmNlOiAnICsgZm10Q3VycmVudCA6IGZtdEN1cnJlbnQ7CiAgICBjdXIuc3R5bGUuY29sb3IgPSBiYXJDb2xvcjsKICB9CiAgaWYgKHBjdEVsKSB7IHBjdEVsLnRleHRDb250ZW50ID0gcGN0LnRvRml4ZWQoMCkgKyAnJSc7IHBjdEVsLnN0eWxlLmNvbG9yID0gYmFyQ29sb3I7IH0KICBpZiAodGd0KSAgIHsKICAgIHRndC50ZXh0Q29udGVudCA9IGdvYWxUeXBlID09PSAncmVkdWNlJwogICAgICA/IGDihpIgVGFyZ2V0OiAke2ZtdFRhcmdldH1gCiAgICAgIDogaXNGb3JlaWduCiAgICAg','ICAgPyBgb2YgJHtmbXRUYXJnZXR9ICgke2ZtdEdvYWxPcmlnaW5hbChyYXdUYXJnZXQsIGdvYWxDdXIpfSAke2dvYWxDdXJ9KWAKICAgICAgICA6IGBvZiAke2ZtdFRhcmdldH1gOwogIH0KfQoKZnVuY3Rpb24gY29tcHV0ZUdvYWxDdXJyZW50KG1hcHBlZEFjY291bnRJZHMsIHVuaXQsIGdvYWxUeXBlKSB7CiAgY29uc3QgbncgPSBjb21wdXRlTmV0V29ydGgoKTsKICBjb25zdCBhbGxBY2NvdW50cyA9IFtdOwogIE9iamVjdC5rZXlzKE5XX1RZUEVTKS5mb3JFYWNoKHQgPT4gewogICAgY29uc3QgZ3JvdXAgPSBudy5ieVR5cGVbdF07CiAgICBpZiAoZ3JvdXApIGdyb3VwLmFjY291bnRzLmZvckVhY2goYSA9PiBhbGxBY2NvdW50cy5wdXNoKHsgLi4uYSwgX253VHlwZTogdCB9KSk7CiAgfSk7CgogIGxldCB0b3RhbCA9IDA7CiAgbWFwcGVkQWNjb3VudElkcy5mb3JFYWNoKGlkID0+IHsKICAgIGNvbnN0IGFjYyA9IGFsbEFjY291bnRzLmZpbmQoYSA9PiBhLmlkID09PSBpZCk7CiAgICBpZiAoIWFjYykgcmV0dXJuOwogICAgY29uc3QgaXNMaWFiID0gTldfVFlQRVNbYWNjLl9ud1R5cGVdICYmIE5XX1RZUEVTW2FjYy5fbndUeXBlXS5pc0xpYWI7CgogICAgaWYgKHVuaXQgPT09ICdncmFtcycpIHsKICAgICAgdG90YWwgKz0gTnVtYmVyKGFjYy5tZXRhICYmIGFjYy5tZXRhLmdyYW1zIHx8IDApOwogICAgfSBlbHNlIGlmICh1bml0ID09PSAna2cnKSB7CiAgICAgIHRvdGFsICs9IE51bWJlcihhY2MubWV0YSAmJiBhY2MubWV0YS5ncmFtcyB8fCAwKSAvIDEwMDA7CiAgICB9IGVsc2UgaWYgKHVuaXQgPT09ICdjb3VudCcpIHsKICAgICAgdG90YWwgKz0gMTsKICAgIH0gZWxzZSBpZiAodW5pdCA9PT0gJ3NxZnQnKSB7CiAgICAgIC8vIEZvciByZWFsIGVzdGF0ZTogc3VtIGFyZWEgKGFyZWFDZW50cyBmaWVsZCBzdG9yZXMgc3FmdC9hcmVhKQogICAgICB0b3RhbCArPSBOdW1iZXIoYWNjLm1ldGEgJiYgYWNjLm1ldGEuYXJlYSB8fCBhY2MubWV0YSAmJiBhY2MubWV0YS5hcmVhQ2VudHMgfHwgMCk7CiAgICB9IGVsc2UgewogICAgICAvLyBDdXJyZW5jeTogbGlhYmlsaXRpZXMgc3VidHJhY3QgZnJvbSB0b3RhbCAoZm9yIG5ldCB3b3J0aCAvIGdyb3cgZ29hbHMpCiAgICAgIC8vIEZvciAncmVkdWNlJyBnb2Fscywgd2UganVzdCBzdW0gdGhlIHJhdyBsaWFiaWxpdHkgYmFsYW5jZSBkaXJlY3RseQogICAgICBpZiAoZ29hbFR5cGUgPT09ICdyZWR1Y2UnKSB7CiAgICAgICAgdG90YWwgKz0gTnVtYmVyKGFjYy5fdmFsIHx8IDApOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGdyb3cgLyBuZXR3b3J0aDogYXNzZXRzIGFkZCwgbGlhYmlsaXRpZXMgc3VidHJhY3QKICAgICAgICB0b3RhbCArPSBpc0xpYWIgPyAtTnVtYmVyKGFjYy5fdmFsIHx8IDApIDogTnVtYmVyKGFjYy5fdmFsIHx8IDApOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHRvdGFsOwp9CgpmdW5jdGlvbiBzYXZlR29hbCgpIHsKICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLW5hbWUnKS52YWx1ZS50cmltKCk7CiAgY29uc3QgdGFyZ2V0UmF3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXRhcmdldCcpLnZhbHVlOwogIGNvbnN0IHRhcmdldCA9IHBhcnNlRmxvYXQodGFyZ2V0UmF3KTsKICBjb25zdCBnb2FsVHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1nb2FsdHlwZScpPy52YWx1ZSB8fCAnZ3Jvdyc7CiAgaWYgKCFuYW1lKSB7IHNob3dUb2FzdCgnRW50ZXIgYSBnb2FsIG5hbWUg4p2MJyk7IHJldHVybjsgfQogIGlmICh0YXJnZXRSYXcgPT09ICcnIHx8IGlzTmFOKHRhcmdldCkpIHsgc2hvd1RvYXN0KCdFbnRlciBhIHRhcmdldCBhbW91bnQg4p2MJyk7IHJldHVybjsgfQogIGlmIChnb2FsVHlwZSAhPT0gJ3JlZHVjZScgJiYgIXRhcmdldCkgeyBzaG93VG9hc3QoJ0VudGVyIGEgdGFyZ2V0IGFtb3VudCDinYwnKTsgcmV0dXJuOyB9CgogIGNvbnN0IGdvYWxzID0gZ2V0R29hbHMoKTsKICBjb25zdCBlZGl0SWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZWRpdGluZy1pZCcpLnZhbHVlOwogIGNvbnN0IG1hcHBlZEFjY291bnRzID0gWy4uLl9nYXBTZWxlY3RlZElkc107CgogIGNvbnN0IGdvYWwgPSB7CiAgICBpZDogICBlZGl0SWQgfHwgKCdnb2FsXycgKyBEYXRlLm5vdygpKSwKICAgIG5hbWUsCiAgICBpY29uOiAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1pY29uJykudmFsdWUgfHwgJ/Cfjq8nLAogICAgdGFyZ2V0LAogICAgdW5pdDogICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtdW5pdCcpLnZhbHVlLAogICAgY3VycmVuY3k6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1jdXJyZW5jeScpLnZhbHVlLAogICAgdGFyZ2V0RGF0ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWRhdGUnKS52YWx1ZSwKICAgIGRlc2M6ICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWRlc2MnKS52YWx1ZS50cmltKCksCiAgICBnb2FsVHlwZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWdvYWx0eXBlJyk/LnZhbHVlIHx8ICdncm93JywKICAgIHN0YXJ0QmFsYW5jZTogcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3Mtc3RhcnRiYWwnKT8udmFsdWUpIHx8IDAsCiAgICBtYXBwZWRBY2NvdW50cywKICAgIGNyZWF0ZWRBdDogZWRpdElkID8gKGdvYWxzLmZpbmQoZz0+Zy5pZD09PWVkaXRJZCl8fHt9KS5jcmVhdGVkQXQgOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSwKICB9OwoKICBpZiAoZWRpdElkKSB7CiAgICBjb25zdCBpZHggPSBnb2Fscy5maW5kSW5kZXgoZyA9PiBnLmlkID09PSBlZGl0SWQpOwogICAgaWYgKGlkeCA+PSAwKSBnb2Fsc1tpZHhdID0gZ29hbDsgZWxzZSBnb2Fscy5wdXNoKGdvYWwpOwogIH0gZWxzZSB7CiAgICBnb2Fscy5wdXNoKGdvYWwpOwogIH0KCiAgc2F2ZUdvYWxzKGdvYWxzKTsKICBjbG9zZUdvYWxTaGVldCgpOwogIHJlbmRlckdvYWxzUGFuZWwoKTsKICBzaG93VG9hc3QoJ/Cfjq8gR29hbCBzYXZlZCEnKTsKfQoKZnVuY3Rpb24gZGVsZXRlR29hbChpZCkgewogIGlmICghY29uZmlybSgnRGVsZXRlIHRoaXMgZ29hbD8nKSkgcmV0dXJuOwogIGRhdGEuX2dvYWxzID0gZ2V0R29hbHMoKS5maWx0ZXIoZyA9PiBnLmlkICE9PSBpZCk7CiAgc2F2ZSgpOwogIHJlbmRlckdvYWxzUGFuZWwoKTsKICBzaG93VG9hc3QoJ0dvYWwgZGVsZXRlZCcpOwp9CgovLyDilIDilIAgQ29udmVydCBhIGdvYWwncyByYXcgdGFyZ2V0IGFtb3VudCBpbnRvIHRoZSBkaXNwbGF5IGN1cnJlbmN5LgovLyBUaGUgdGFyZ2V0IGlzIHN0b3JlZCBpbiBnLmN1cnJlbmN5IChlLmcuIOKCuTEwLDAwLDAwMCBJTlIpLgovLyBjb21wdXRlR29hbEN1cnJlbnQgcmV0dXJucyB2YWx1ZXMgaW4gdGhlIGRpc3BsYXkgY3VycmVuY3kgKGUuZy4gVVNEKS4KLy8gV2UgbXVzdCBjb252ZXJ0IHRoZSB0YXJnZXQgaW50byBkaXNwbGF5IGN1cnJlbmN5IGJlZm9yZSBjb21wdXRpbmcgdGhlIHJhdGlvLgpmdW5jdGlvbiBnb2FsVGFyZ2V0SW5EaXNwbGF5KGcpIHsKICBpZiAoKGcudW5pdCB8fCAnY3VycmVuY3knKSAhPT0gJ2N1cnJlbmN5JykgcmV0dXJuIE51bWJlcihnLnRhcmdldCB8fCAwKTsKICBjb25zdCBnb2FsQ3VyID0gKGcuY3VycmVuY3kgfHwgY3VycmVudEN1cnJlbmN5LmNvZGUpLnRvVXBwZXJDYXNlKCk7CiAgcmV0dXJuIGNvbnZlcnRBbXQoZy50YXJnZXQgfHwgMCwgZ29hbEN1cik7Cn0KCi8vIEdldCB0aGUgY3VycmVuY3kgc3ltYm9sIGZvciBhIGdvYWwncyBkZWNsYXJlZCBjdXJyZW5jeQpmdW5jdGlvbiBnb2FsQ3VycmVuY3lTeW0oZ29hbEN1cnJlbmN5Q29kZSkgewogIGNvbnN0IGMgPSBDVVJSRU5DSUVTLmZpbmQoeCA9PiB4LmNvZGUgPT09IGdvYWxDdXJyZW5jeUNvZGUpOwogIHJldHVybiBjID8gYy5zeW1ib2wgOiAoZ29hbEN1cnJlbmN5Q29kZSB8fCBzeW0oKSk7Cn0KCi8vIEZvcm1hdCBhIHJhdyBhbW91bnQgaW4gdGhlIGdvYWwncyBvd24gY3VycmVuY3kgKGZvciBkaXNwbGF5IGFzIHRoZSBvcmlnaW5hbCB0YXJnZXQpCmZ1bmN0aW9uIGZtdEdvYWxPcmlnaW5hbChhbW91bnQsIGN1cnJlbmN5Q29kZSkgewogIGNvbnN0IHMgPSBnb2FsQ3VycmVuY3lTeW0oY3VycmVuY3lDb2RlKTsKICByZXR1cm4gcyArIE1hdGgucm91bmQoTnVtYmVyKGFtb3VudCB8fCAwKSkudG9Mb2NhbGVTdHJpbmcoKTsKfQoKZnVuY3Rpb24gcmVuZGVyR29hbHNQYW5lbCgpIHsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2Fscy1saXN0LWdyaWQnKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3QgYWxsR29hbHMgPSBnZXRHb2FscygpOwoKICAvLyBDb21wdXRlIGFjaGlldmVkIHN0YXR1cyBmb3IgZXZlcnkgZ29hbCB1cCBmcm9udAogIGNvbnN0IHRhZ2dlZCA9IGFsbEdvYWxzLm1hcChnID0+IHsKICAgIGNvbnN0IGN1cnJlbnQgICAgICAgPSBjb21wdXRlR29hbEN1cnJlbnQoZy5tYXBwZWRBY2NvdW50cyB8fCBbXSwgZy51bml0IHx8ICdjdXJyZW5jeScsIGcuZ29hbFR5cGUgfHwgJ2dyb3cnKTsKICAgIGNvbnN0IHRhcmdldERpc3BsYXkgPSBnb2FsVGFyZ2V0SW5EaXNwbGF5KGcpOwogICAgbGV0IHBjdDsKICAgIGlmICgoZy5nb2FsVHlwZSB8fCAnZ3JvdycpID09PSAncmVkdWNlJykgewogICAgICBjb25zdCBzdGFydEJhbCA9IE51bWJlcihnLnN0YXJ0QmFsYW5jZSB8fCAwKTsKICAgICAgY29uc3QgcmVkdWNlZCAgPSBNYXRoLm1heChzdGFydEJhbCAtIGN1cnJlbnQsIDApOwogICAgICBjb25zdCB0b3RhbFJlZHVjZSA9IE1hdGgubWF4KHN0YXJ0QmFsIC0gdGFyZ2V0RGlzcGxheSwgMCk7CiAgICAgIHBjdCA9IHRvdGFsUmVkdWNlID4gMCA/IE1hdGgubWluKHJlZHVjZWQgLyB0b3RhbFJlZHVjZSAqIDEwMCwgMTAwKSA6IChjdXJyZW50IDw9IHRhcmdldERpc3BsYXkgPyAxMDAgOiAwKTsKICAgIH0gZWxzZSB7CiAgICAgIHBjdCA9IHRhcmdldERpc3BsYXkgPiAwID8gTWF0aC5taW4oY3VycmVudCAvIHRhcmdldERpc3BsYXkgKiAxMDAsIDEwMCkgOiAwOwogICAgfQogICAgcmV0dXJuIHsgZywgY3VycmVudCwgdGFyZ2V0RGlzcGxheSwgcGN0LCBhY2hpZXZlZDogcGN0ID49IDEwMCB9OwogIH0pOwoKICBjb25zdCBhY3RpdmVMaXN0ICAgPSB0YWdnZWQuZmlsdGVyKHQgPT4gIXQuYWNoaWV2ZWQpOwogIGNvbnN0IGFjaGlldmVkTGlzdCA9IHRhZ2dlZC5maWx0ZXIodCA9PiAgdC5hY2hpZXZlZCk7CgogIC8vIFVwZGF0ZSB0YWIgY291bnQgYmFkZ2VzCiAgY29uc3QgYWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3RhYi1hY3RpdmUtY291bnQnKTsKICBjb25zdCBoYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndGFiLWFjaGlldmVkLWNvdW50Jyk7CiAgaWYgKGFjKSBhYy50ZXh0Q29udGVudCA9IGFjdGl2ZUxpc3QubGVuZ3RoOwogIGlmIChoYykgaGMudGV4dENvbnRlbnQgPSBhY2hpZXZlZExpc3QubGVuZ3RoOwoKICBpZiAoYWxsR29hbHMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4IDIwcHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjIuNWVtO21hcmdpbi1ib3R0b206OHB4OyI+8J+OrzwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuOWVtO21hcmdpbi1ib3R0b206NHB4OyI+Tm8gZ29hbHMgeWV0PC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Ij5UYXAgdGhlIDxzdHJvbmc+77yLPC9zdHJvbmc+IGJ1dHRvbiBiZWxvdyB0byB0cmFjayBmaW5hbmNpYWwgbWlsZXN0b25lczwvZGl2PgogICAgPC9kaXY+YDsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IGxpc3QgPSBnb2Fsc1RhYiA9PT0gJ2FjaGlldmVkJyA/IGFjaGlldmVkTGlzdCA6IGFjdGl2ZUxpc3Q7CgogIGlmIChsaXN0Lmxlbmd0aCA9','PT0gMCkgewogICAgZWwuaW5uZXJIVE1MID0gZ29hbHNUYWIgPT09ICdhY2hpZXZlZCcKICAgICAgPyBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4IDIwcHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij4KICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6Mi41ZW07bWFyZ2luLWJvdHRvbTo4cHg7Ij7wn4+GPC9kaXY+CiAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjllbTttYXJnaW4tYm90dG9tOjRweDsiPk5vIGFjaGlldmVkIGdvYWxzIHlldDwvZGl2PgogICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Ij5LZWVwIGdvaW5nIOKAlCBjb21wbGV0ZWQgZ29hbHMgd2lsbCBhcHBlYXIgaGVyZSE8L2Rpdj4KICAgICAgICAgPC9kaXY+YAogICAgICA6IGA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjQwcHggMjBweDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTsiPgogICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToyLjVlbTttYXJnaW4tYm90dG9tOjhweDsiPvCfjok8L2Rpdj4KICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuOWVtO21hcmdpbi1ib3R0b206NHB4OyI+QWxsIGdvYWxzIGFjaGlldmVkITwvZGl2PgogICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Ij5JbmNyZWRpYmxlIOKAlCBzZXQgbmV3IG9uZXMgd2l0aCB0aGUg77yLIGJ1dHRvbjwvZGl2PgogICAgICAgICA8L2Rpdj5gOwogICAgcmV0dXJuOwogIH0KCiAgZWwuaW5uZXJIVE1MID0gbGlzdC5tYXAoKHsgZywgY3VycmVudCwgdGFyZ2V0RGlzcGxheSwgcGN0LCBhY2hpZXZlZCB9KSA9PiB7CiAgICBjb25zdCB1bml0ICAgICAgICA9IGcudW5pdCB8fCAnY3VycmVuY3knOwogICAgY29uc3QgZ29hbFR5cGUgICAgPSBnLmdvYWxUeXBlIHx8ICdncm93JzsKICAgIGNvbnN0IGdvYWxDdXJDb2RlID0gKGcuY3VycmVuY3kgfHwgY3VycmVudEN1cnJlbmN5LmNvZGUpLnRvVXBwZXJDYXNlKCk7CiAgICBjb25zdCBpc0ZvcmVpZ25DdXIgPSB1bml0ID09PSAnY3VycmVuY3knICYmIGdvYWxDdXJDb2RlICE9PSBjdXJyZW50Q3VycmVuY3kuY29kZTsKICAgIGNvbnN0IGJhckNvbG9yICAgID0gYWNoaWV2ZWQgPyAnIzEwQjk4MScgOiBwY3QgPj0gNzUgPyAnIzNCOUVGRicgOiBwY3QgPj0gNDAgPyAnI0Y1OUUwQicgOiAnI0VGNDQ0NCc7CiAgICBjb25zdCBmbXRWYWwgPSB2ID0+IHVuaXQgPT09ICdjdXJyZW5jeScKICAgICAgPyBmbXQodikKICAgICAgOiB2LnRvRml4ZWQodW5pdCA9PT0gJ2dyYW1zJyA/IDEgOiB1bml0ID09PSAnc3FmdCcgPyAwIDogMikgKyAodW5pdCA9PT0gJ2dyYW1zJyA/ICdnJyA6IHVuaXQgPT09ICdrZycgPyAna2cnIDogdW5pdCA9PT0gJ3NxZnQnID8gJyBzcWZ0JyA6ICcnKTsKICAgIC8vIEZvciByZWR1Y2UgZ29hbHM6IHNob3cgaG93IG11Y2ggaXMgbGVmdCB0byByZWR1Y2UKICAgIGNvbnN0IHJlbWFpbmluZyA9IGdvYWxUeXBlID09PSAncmVkdWNlJwogICAgICA/IE1hdGgubWF4KGN1cnJlbnQgLSB0YXJnZXREaXNwbGF5LCAwKSAgIC8vIHN0aWxsIG93ZSB0aGlzIG11Y2gKICAgICAgOiBNYXRoLm1heCh0YXJnZXREaXNwbGF5IC0gY3VycmVudCwgMCk7ICAvLyBzdGlsbCBuZWVkIHRvIGdyb3cgYnkgdGhpcwogICAgLy8gR29hbCB0eXBlIGJhZGdlCiAgICBjb25zdCBnb2FsVHlwZUJhZGdlID0gZ29hbFR5cGUgPT09ICdyZWR1Y2UnCiAgICAgID8gYDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC42NWVtO2ZvbnQtd2VpZ2h0OjgwMDtiYWNrZ3JvdW5kOiNGRkYwRjA7Y29sb3I6I0VGNDQ0NDtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjJweCA3cHg7bWFyZ2luLWxlZnQ6NHB4OyI+8J+TiSBSZWR1Y2U8L3NwYW4+YAogICAgICA6IGdvYWxUeXBlID09PSAnZ3JvdycgPyAnJyA6ICcnOwogICAgLy8gRm9yIHJlZHVjZTogc2hvdyBjdXJyZW50IGJhbGFuY2UgdnMgdGFyZ2V0IGJhbGFuY2UKICAgIGNvbnN0IHByb2dyZXNzTGFiZWwgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScKICAgICAgPyBgQmFsYW5jZTogJHtmbXRWYWwoY3VycmVudCl9IOKGkiBUYXJnZXQ6ICR7Zm10VmFsKHRhcmdldERpc3BsYXkpfWAKICAgICAgOiBgJHtmbXRWYWwoY3VycmVudCl9IG9mICR7Zm10VmFsKHRhcmdldERpc3BsYXkpfWA7CgogICAgLy8gVGFyZ2V0IGRhdGUgdGFnCiAgICBsZXQgZGF0ZVRhZyA9ICcnOwogICAgaWYgKGcudGFyZ2V0RGF0ZSkgewogICAgICBjb25zdCBkaWZmTXMgICA9IG5ldyBEYXRlKGcudGFyZ2V0RGF0ZSArICctMDEnKSAtIG5ldyBEYXRlKCk7CiAgICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5jZWlsKGRpZmZNcyAvIDg2NDAwMDAwKTsKICAgICAgZGF0ZVRhZyA9IGRpZmZEYXlzID4gMAogICAgICAgID8gYDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOiR7ZGlmZkRheXM8OTA/JyNFRjQ0NDQnOid2YXIoLS10ZXh0LWxpZ2h0KSd9O21hcmdpbi1sZWZ0OjZweDsiPuKPsyAke2RpZmZEYXlzPjYwP01hdGguY2VpbChkaWZmRGF5cy8zMCkrJ21vJzpkaWZmRGF5cysnZCd9PC9zcGFuPmAKICAgICAgICA6IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjojMTBCOTgxO21hcmdpbi1sZWZ0OjZweDsiPuKckyBEZWFkbGluZSBwYXNzZWQ8L3NwYW4+YDsKICAgIH0KCiAgICAvLyBDZWxlYnJhdGlvbiBiYW5uZXIgb25seSBvbiBhY2hpZXZlZCB0YWIKICAgIGNvbnN0IGFjaGlldmVkQmFubmVyID0gYWNoaWV2ZWQgPyBgCiAgICAgIDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6bGluZWFyLWdyYWRpZW50KDEzNWRlZywjMTBCOTgxLCMwNTk2NjkpO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6MTBweDsKICAgICAgICAgICAgICAgICAgcGFkZGluZzoxMHB4IDE0cHg7bWFyZ2luLWJvdHRvbToxMHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7Ij4KICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEuNmVtOyI+8J+Phjwvc3Bhbj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjg4ZW07Ij5Hb2FsIEFjaGlldmVkITwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtvcGFjaXR5OjAuODU7Ij5Zb3UgaGl0ICR7Zm10VmFsKHRhcmdldERpc3BsYXkpfSDigJQgb3V0c3RhbmRpbmcgd29yazwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj5gIDogJyc7CgogICAgcmV0dXJuIGA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOndoaXRlO2JvcmRlci1yYWRpdXM6MTZweDtwYWRkaW5nOjE0cHggMTZweDttYXJnaW4tYm90dG9tOjEwcHg7CiAgICAgICAgYm94LXNoYWRvdzowIDJweCAxMHB4IHJnYmEoMCwwLDAsMC4wNik7Ym9yZGVyOjEuNXB4IHNvbGlkICR7YWNoaWV2ZWQ/JyMxMEI5ODEnOicjRjBGMEYwJ307Ij4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmZsZXgtc3RhcnQ7bWFyZ2luLWJvdHRvbTo4cHg7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXgtd3JhcDp3cmFwO2dhcDo0cHg7ZmxleDoxO21pbi13aWR0aDowOyI+CiAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEuM2VtOyI+JHtnLmljb258fCfwn46vJ308L3NwYW4+CiAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjkyZW07Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTttYXJnaW4tbGVmdDo0cHg7Ij4ke2cubmFtZX08L3NwYW4+CiAgICAgICAgICAke2dvYWxUeXBlQmFkZ2V9CiAgICAgICAgICAke2RhdGVUYWd9CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo2cHg7ZmxleC1zaHJpbms6MDttYXJnaW4tbGVmdDo4cHg7Ij4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0ib3BlbkdvYWxTaGVldCgnJHtnLmlkfScpIiBzdHlsZT0iYmFja2dyb3VuZDojRjBGNEZGO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6NXB4IDlweDtmb250LXNpemU6MC43NWVtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS1wcmltYXJ5KTtjdXJzb3I6cG9pbnRlcjsiPuKcj++4jzwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJkZWxldGVHb2FsKCcke2cuaWR9JykiIHN0eWxlPSJiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzo1cHggOXB4O2ZvbnQtc2l6ZTowLjc1ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLWV4cGVuc2VzKTtjdXJzb3I6cG9pbnRlcjsiPuKclTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgJHtnLmRlc2MgPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzVlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7bWFyZ2luLWJvdHRvbTo4cHg7Ij4ke2cuZGVzY308L2Rpdj5gIDogJyd9CiAgICAgICR7YWNoaWV2ZWRCYW5uZXJ9CiAgICAgICR7aXNGb3JlaWduQ3VyID8gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjcyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTttYXJnaW4tYm90dG9tOjZweDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo1cHg7ZmxleC13cmFwOndyYXA7Ij4KICAgICAgICA8c3Bhbj7wn46vIFRhcmdldDo8L3NwYW4+CiAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtmbXRHb2FsT3JpZ2luYWwoZy50YXJnZXQsIGdvYWxDdXJDb2RlKX08L3NwYW4+CiAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+4omIPC9zcGFuPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Ij4ke2ZtdCh0YXJnZXREaXNwbGF5KX08L3NwYW4+CiAgICAgICAgPHNwYW4gc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtjb2xvcjp2YXIoLS1wcmltYXJ5KTtmb250LXNpemU6MC45ZW07Ym9yZGVyLXJhZGl1czo2cHg7cGFkZGluZzoxcHggNXB4OyI+JHtnb2FsQ3VyQ29kZX0g4oaSICR7Y3VycmVudEN1cnJlbmN5LmNvZGV9PC9zcGFuPgogICAgICA8L2Rpdj5gIDogJyd9CiAgICAgIDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I0Y1RjVGNTtib3JkZXItcmFkaXVzOjIwcHg7aGVpZ2h0OjEwcHg7b3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1ib3R0b206NnB4OyI+CiAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OjEwMCU7d2lkdGg6JHtwY3QudG9GaXhlZCgxKX0lO2JhY2tncm91bmQ6JHtiYXJDb2xvcn07Ym9yZGVyLXJhZGl1czoyMHB4O3RyYW5zaXRpb246d2lkdGggMC41cyBlYXNlOyI+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyOyI+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzVlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+JHtwcm9ncmVzc0xhYmVsfTwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjg4ZW07Zm9udC13ZWlnaHQ6OTAwO2NvbG9yOiR7YmFyQ29sb3J9OyI+JHtwY3QudG9GaXhlZCgwKX0lPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICAkeyFhY2hpZXZlZCA/IGA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43MmVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTttYXJnaW4tdG9wOjNweDsiPiR7Z29hbFR5cGUgPT09ICdyZWR1Y2UnID8gJ1N0aWxsIHRvIHJlZHVjZTogJyArIGZtdFZhbChy','ZW1haW5pbmcpIDogJ1N0aWxsIG5lZWQ6ICcgKyBmbXRWYWwocmVtYWluaW5nKX08L2Rpdj5gIDogJyd9CiAgICAgICR7KGcubWFwcGVkQWNjb3VudHN8fFtdKS5sZW5ndGggPiAwID8gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtmb250LXdlaWdodDo2MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7bWFyZ2luLXRvcDo1cHg7Ym9yZGVyLXRvcDoxcHggc29saWQgI0Y1RjVGNTtwYWRkaW5nLXRvcDo1cHg7Ij7wn5OKICR7Zy5tYXBwZWRBY2NvdW50cy5sZW5ndGh9IGFjY291bnQke2cubWFwcGVkQWNjb3VudHMubGVuZ3RoPjE/J3MnOicnfSBtYXBwZWQ8L2Rpdj5gIDogJyd9CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBidWRnZXRDaGFuZ2VNb250aChkaXIpIHsKICBjb25zdCBbeSwgbV0gPSBidWRnZXRWaWV3TW9udGguc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICBjb25zdCBkID0gbmV3IERhdGUoeSwgbSAtIDEgKyBkaXIsIDEpOwogIGJ1ZGdldFZpZXdNb250aCA9IGAke2QuZ2V0RnVsbFllYXIoKX0tJHtTdHJpbmcoZC5nZXRNb250aCgpKzEpLnBhZFN0YXJ0KDIsJzAnKX1gOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtbW9udGgtbGFiZWwnKS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aChidWRnZXRWaWV3TW9udGgpOwogIHJlbmRlckJ1ZGdldE1vZHVsZSgpOwogIC8vIElmIGRldGFpbCBwYW5lIGlzIG9wZW4sIHJlLXJlbmRlciBpdCBmb3IgdGhlIG5ldyBtb250aAogIGlmIChjdXJyZW50QnVkZ2V0Q2F0RGV0YWlsKSB7CiAgICBjb25zdCB7IHR5cGUsIGdvYWxLZXkgfSA9IGN1cnJlbnRCdWRnZXRDYXREZXRhaWw7CiAgICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKHR5cGUpOwogICAgY29uc3QgZ29hbCAgPSBnb2Fscy5maW5kKGcgPT4gZy5rZXkgPT09IGdvYWxLZXkpOwogICAgaWYgKGdvYWwpIHsKICAgICAgY29uc3QgcHJlZml4ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdicgOiAnZXhwJzsKICAgICAgX3JlbmRlckJ1ZGdldERldGFpbChwcmVmaXgsIGdvYWwsIHR5cGUpOwogICAgfQogIH0KfQoKZnVuY3Rpb24gc2V0QnVkZ2V0VGFiKHRhYiwgZWwpIHsKICBjdXJyZW50QnVkZ2V0VGFiID0gdGFiOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ibS10YWInKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgaWYgKGVsKSBlbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAvLyBIaWRlIGdvYWxzIG92ZXJsYXkgZmlyc3QKICBjb25zdCBnb2Fsc1BhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsaXN0LWdvYWxzJyk7CiAgY29uc3QgZ29hbHNGYWIgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb2Fscy1mYWItYnRuJyk7CiAgaWYgKGdvYWxzUGFuZWwpIGdvYWxzUGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBpZiAoZ29hbHNGYWIpICAgZ29hbHNGYWIuc3R5bGUuZGlzcGxheSAgID0gJ25vbmUnOwogIGlmICh0YWIgPT09ICdnb2FscycpIHsKICAgIC8vIFNob3cgZ29hbHMgYXMgZnVsbCBvdmVybGF5ICsgaXRzIG93biBGQUIKICAgIGlmIChnb2Fsc1BhbmVsKSBnb2Fsc1BhbmVsLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIGlmIChnb2Fsc0ZhYikgICB7IGdvYWxzRmFiLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7IH0KICAgIHJlbmRlckdvYWxzUGFuZWwoKTsKICAgIHJldHVybjsKICB9CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJ1ZGdldC1zZWN0aW9uJykuZm9yRWFjaChzID0+IHMuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgY29uc3Qgc2VjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JzZWMtJyArIHRhYik7CiAgaWYgKHNlYykgc2VjLnN0eWxlLmRpc3BsYXkgPSAnJzsKICByZW5kZXJCdWRnZXRNb2R1bGUoKTsKfQoKLy8gQ29tcHV0ZSBhY3R1YWwgc3BlbnQgZm9yIGEgZ29hbCBpbiBhIGdpdmVuIG1vbnRoCmZ1bmN0aW9uIGdldEJ1ZGdldEFjdHVhbChnb2FsLCBtb250aEtleSkgewogIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsKICBjb25zdCBtID0gZGF0YVttb250aEtleV07CiAgY29uc3QgY2F0cyA9IChnb2FsLmxpbmtlZENhdHMgfHwgW2dvYWwua2V5XSkubWFwKGMgPT4gYy50b0xvd2VyQ2FzZSgpLnRyaW0oKSk7CiAgbGV0IHRvdGFsID0gMDsKICBbJ2V4cGVuc2VzJywgJ2ludmVzdG1lbnRzJywgJ2FkZGl0aW9uYWwnXS5mb3JFYWNoKGxpc3RLZXkgPT4gewogICAgKG1bbGlzdEtleV0gfHwgW10pLmZvckVhY2goZSA9PiB7CiAgICAgIGNvbnN0IGVjID0gKGUuY2F0ZWdvcnkgfHwgJycpLnRvTG93ZXJDYXNlKCkudHJpbSgpOwogICAgICBjb25zdCBlZCA9IChlLmRlc2NyaXB0aW9uIHx8ICcnKS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgaWYgKGNhdHMuc29tZShjID0+IGVjLmluY2x1ZGVzKGMpIHx8IChsaXN0S2V5ID09PSAnaW52ZXN0bWVudHMnICYmIChlZC5pbmNsdWRlcyhjKSB8fCBlYy5pbmNsdWRlcyhjKSkpKSkgewogICAgICAgIHRvdGFsICs9IGNvbnZlcnRBbXQoZS5hbW91bnQsIGUuY3VycmVuY3kpOwogICAgICB9CiAgICB9KTsKICB9KTsKICByZXR1cm4gdG90YWw7Cn0KCi8vIEdldCBsYXN0IDEyIG1vbnRocyBrZXlzCmZ1bmN0aW9uIGdldExhc3QxMk1vbnRocyhmcm9tTW9udGhLZXkpIHsKICBjb25zdCBbeSwgbV0gPSBmcm9tTW9udGhLZXkuc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICBjb25zdCBtb250aHMgPSBbXTsKICBmb3IgKGxldCBpID0gMTE7IGkgPj0gMDsgaS0tKSB7CiAgICBjb25zdCBkID0gbmV3IERhdGUoeSwgbSAtIDEgLSBpLCAxKTsKICAgIG1vbnRocy5wdXNoKGAke2QuZ2V0RnVsbFllYXIoKX0tJHtTdHJpbmcoZC5nZXRNb250aCgpKzEpLnBhZFN0YXJ0KDIsJzAnKX1gKTsKICB9CiAgcmV0dXJuIG1vbnRoczsKfQoKZnVuY3Rpb24gcmVuZGVyQnVkZ2V0TW9kdWxlKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtbW9udGgtbGFiZWwnKS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aChidWRnZXRWaWV3TW9udGgpOwogIGlmIChjdXJyZW50QnVkZ2V0VGFiID09PSAnb3ZlcnZpZXcnKSByZW5kZXJCdWRnZXRPdmVydmlldygpOwogIGVsc2UgaWYgKGN1cnJlbnRCdWRnZXRUYWIgPT09ICdleHBlbnNlcycpIHJlbmRlckJ1ZGdldEdvYWxzTGlzdCgnZXhwZW5zZScpOwogIGVsc2UgaWYgKGN1cnJlbnRCdWRnZXRUYWIgPT09ICdzYXZpbmdzJykgcmVuZGVyQnVkZ2V0R29hbHNMaXN0KCdzYXZpbmdzJyk7Cn0KCmxldCBidWRnZXRWaWV3TW9kZSA9ICdtb250aCc7IC8vICdtb250aCcgfCAneWVhcicKCmZ1bmN0aW9uIHNldEJ1ZGdldFZpZXdNb2RlKG1vZGUpIHsKICBidWRnZXRWaWV3TW9kZSA9IG1vZGU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLWJ0bi1tb250aCcpLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIG1vZGUgPT09ICdtb250aCcpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC1idG4teWVhcicpLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIG1vZGUgPT09ICd5ZWFyJyk7CiAgcmVuZGVyQnVkZ2V0T3ZlcnZpZXcoKTsKfQoKZnVuY3Rpb24gZ2V0WWVhck1vbnRoS2V5cyhtb250aEtleSkgewogIGNvbnN0IHllYXIgPSBtb250aEtleS5zcGxpdCgnLScpWzBdOwogIGNvbnN0IGFsbCA9IFtdOwogIGZvciAobGV0IG0gPSAxOyBtIDw9IDEyOyBtKyspIHsKICAgIGFsbC5wdXNoKGAke3llYXJ9LSR7U3RyaW5nKG0pLnBhZFN0YXJ0KDIsJzAnKX1gKTsKICB9CiAgcmV0dXJuIGFsbDsKfQoKZnVuY3Rpb24gcmVuZGVyQnVkZ2V0T3ZlcnZpZXcoKSB7CiAgY29uc3QgZXhwR29hbHMgPSBnZXRCdWRnZXRHb2FscygnZXhwZW5zZScpOwogIGNvbnN0IHNhdkdvYWxzID0gZ2V0QnVkZ2V0R29hbHMoJ3NhdmluZ3MnKTsKICBjb25zdCBpc1llYXIgPSBidWRnZXRWaWV3TW9kZSA9PT0gJ3llYXInOwogIGNvbnN0IHllYXIgPSBidWRnZXRWaWV3TW9udGguc3BsaXQoJy0nKVswXTsKCiAgLy8g4pSA4pSAIENvbXB1dGUgdG90YWxzIGRlcGVuZGluZyBvbiBtb2RlIOKUgOKUgAogIGxldCB0b3RhbEV4cEJ1ZGdldCwgdG90YWxTYXZCdWRnZXQsIHRvdGFsRXhwQWN0dWFsLCB0b3RhbFNhdkFjdHVhbDsKICBjb25zdCBtb250aGx5RXhwQnVkZ2V0ID0gZXhwR29hbHMucmVkdWNlKChzLCBnKSA9PiBzICsgTnVtYmVyKGcuYW1vdW50IHx8IDApLCAwKTsKICBjb25zdCBtb250aGx5U2F2QnVkZ2V0ID0gc2F2R29hbHMucmVkdWNlKChzLCBnKSA9PiBzICsgTnVtYmVyKGcuYW1vdW50IHx8IDApLCAwKTsKCiAgaWYgKGlzWWVhcikgewogICAgLy8gQW5udWFsaXplZCBidWRnZXQgPSBtb250aGx5IMOXIDEyCiAgICB0b3RhbEV4cEJ1ZGdldCA9IG1vbnRobHlFeHBCdWRnZXQgKiAxMjsKICAgIHRvdGFsU2F2QnVkZ2V0ID0gbW9udGhseVNhdkJ1ZGdldCAqIDEyOwogICAgLy8gWVREIGFjdHVhbHMg4oCUIHN1bSBvbmx5IG1vbnRocyBpbiB0aGlzIHllYXIgVVAgVE8gdGhlIHNlbGVjdGVkL2N1cnJlbnQgbW9udGgKICAgIGNvbnN0IHRvZGF5TWsgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCw3KTsKICAgIGNvbnN0IGNhcE1rID0gYnVkZ2V0Vmlld01vbnRoIDwgdG9kYXlNayA/IGJ1ZGdldFZpZXdNb250aCA6IHRvZGF5TWs7CiAgICBjb25zdCB5ZWFyTW9udGhzID0gZ2V0WWVhck1vbnRoS2V5cyhidWRnZXRWaWV3TW9udGgpLmZpbHRlcihtayA9PiBtayA8PSBjYXBNayk7CiAgICB0b3RhbEV4cEFjdHVhbCA9IHllYXJNb250aHMucmVkdWNlKChzLCBtaykgPT4gcyArIGV4cEdvYWxzLnJlZHVjZSgoc3MsIGcpID0+IHNzICsgZ2V0QnVkZ2V0QWN0dWFsKGcsIG1rKSwgMCksIDApOwogICAgdG90YWxTYXZBY3R1YWwgPSB5ZWFyTW9udGhzLnJlZHVjZSgocywgbWspID0+IHMgKyBzYXZHb2Fscy5yZWR1Y2UoKHNzLCBnKSA9PiBzcyArIGdldEJ1ZGdldEFjdHVhbChnLCBtayksIDApLCAwKTsKICB9IGVsc2UgewogICAgdG90YWxFeHBCdWRnZXQgPSBtb250aGx5RXhwQnVkZ2V0OwogICAgdG90YWxTYXZCdWRnZXQgPSBtb250aGx5U2F2QnVkZ2V0OwogICAgdG90YWxFeHBBY3R1YWwgPSBleHBHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgYnVkZ2V0Vmlld01vbnRoKSwgMCk7CiAgICB0b3RhbFNhdkFjdHVhbCA9IHNhdkdvYWxzLnJlZHVjZSgocywgZykgPT4gcyArIGdldEJ1ZGdldEFjdHVhbChnLCBidWRnZXRWaWV3TW9udGgpLCAwKTsKICB9CgogIGNvbnN0IHRvdGFsQnVkZ2V0ID0gdG90YWxFeHBCdWRnZXQgKyB0b3RhbFNhdkJ1ZGdldDsKICBjb25zdCB0b3RhbExlZnQgPSB0b3RhbEJ1ZGdldCAtIHRvdGFsRXhwQWN0dWFsIC0gdG90YWxTYXZBY3R1YWw7CiAgY29uc3QgaXNPdmVyID0gdG90YWxMZWZ0IDwgMDsKCiAgLy8g4pSA4pSAIEhlcm8gbnVtYmVycyDilIDilIAKICBjb25zdCB5ZWFyQmFkZ2UgPSBpc1llYXIgPyBgPHNwYW4gY2xhc3M9ImJoLXllYXItYmFkZ2UiPiR7eWVhcn08L3NwYW4+YCA6ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC10aXRsZScpLmlubmVySFRNTCA9IChpc1llYXIgPyAnQU5OVUFMIEJVREdFVCcgOiAnVE9UQUwgQlVER0VURUQnKSArIHllYXJCYWRnZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtYW1vdW50JykudGV4dENvbnRlbnQgPSBmbXQoaXNZZWFyID8gdG90YWxFeHBBY3R1YWwgKyB0b3RhbFNhdkFjdHVhbCA6IHRvdGFsQnVkZ2V0KTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtc3ViJykuaW5uZXJIVE1MID0gaXNZZWFyCiAgICA/IGA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij5vZiAke2ZtdCh0b3RhbEJ1ZGdldCl9IGFubnVhbCBnb2FsIMK3IDwvc3Bhbj48c3BhbiBzdHlsZT0iY29sb3I6JHtpc092ZXI/J3ZhcigtLWV4cGVuc2VzKSc6J3ZhcigtLWluY29tZSknfTsiPiR7aXNPdmVyID8gZm10KE1hdGguYWJzKHRvdGFsTGVmdCkp','Kycgb3ZlcicgOiBmbXQodG90YWxMZWZ0KSsnIGxlZnQnfTwvc3Bhbj5gCiAgICA6IGA8c3BhbiBzdHlsZT0iY29sb3I6JHtpc092ZXIgPyAndmFyKC0tZXhwZW5zZXMpJyA6ICd2YXIoLS1pbmNvbWUpJ307Ij4ke2lzT3ZlciA/ICfilrIgJyArIGZtdChNYXRoLmFicyh0b3RhbExlZnQpKSArICcgb3ZlcicgOiAn4pa8ICcgKyBmbXQodG90YWxMZWZ0KSArICcgbGVmdCd9PC9zcGFuPmA7CgogIC8vIOKUgOKUgCBEdWFsIHN0YXQgYmxvY2tzIOKUgOKUgAogIGNvbnN0IGV4cExlZnQgPSB0b3RhbEV4cEJ1ZGdldCAtIHRvdGFsRXhwQWN0dWFsOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC1leHAtdmFsJykudGV4dENvbnRlbnQgPSBmbXQodG90YWxFeHBBY3R1YWwpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC1leHAtdmFsJykuc3R5bGUuY29sb3IgPSBleHBMZWZ0IDwgMCA/ICd2YXIoLS1leHBlbnNlcyknIDogJ3ZhcigtLXRleHQtZGFyayknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC1leHAtc3ViJykuaW5uZXJIVE1MID0gYDxzcGFuIHN0eWxlPSJjb2xvcjoke2V4cExlZnQ8MD8ndmFyKC0tZXhwZW5zZXMpJzondmFyKC0taW5jb21lKSd9OyI+JHtleHBMZWZ0PDAgPyBmbXQoTWF0aC5hYnMoZXhwTGVmdCkpKycgb3ZlcicgOiBmbXQoZXhwTGVmdCkrJyBsZWZ0J308L3NwYW4+PGJyPjxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC45ZW07Ij5vZiAke2ZtdCh0b3RhbEV4cEJ1ZGdldCl9JHtpc1llYXI/JyBhbm51YWwnOicnfTwvc3Bhbj5gOwoKICBjb25zdCBzYXZMZWZ0ID0gdG90YWxTYXZCdWRnZXQgLSB0b3RhbFNhdkFjdHVhbDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtc2F2LXZhbCcpLnRleHRDb250ZW50ID0gZm10KHRvdGFsU2F2QWN0dWFsKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtc2F2LXZhbCcpLnN0eWxlLmNvbG9yID0gc2F2TGVmdCA8IDAgPyAndmFyKC0tZXhwZW5zZXMpJyA6ICd2YXIoLS10ZXh0LWRhcmspJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtc2F2LXN1YicpLmlubmVySFRNTCA9IGA8c3BhbiBzdHlsZT0iY29sb3I6JHtzYXZMZWZ0PDA/J3ZhcigtLWV4cGVuc2VzKSc6J3ZhcigtLWluY29tZSknfTsiPiR7c2F2TGVmdDwwID8gZm10KE1hdGguYWJzKHNhdkxlZnQpKSsnIG92ZXInIDogZm10KHNhdkxlZnQpKycgbGVmdCd9PC9zcGFuPjxicj48c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC1zaXplOjAuOWVtOyI+b2YgJHtmbXQodG90YWxTYXZCdWRnZXQpfSR7aXNZZWFyPycgYW5udWFsJzonJ308L3NwYW4+YDsKCiAgLy8g4pSA4pSAIENoYXJ0IOKUgOKUgAogIGNvbnN0IGNhbnZhc0lkID0gJ2J1ZGdldC1vdmVydmlldy1jaGFydCc7CiAgaWYgKGNoYXJ0c1tjYW52YXNJZF0pIHsgY2hhcnRzW2NhbnZhc0lkXS5kZXN0cm95KCk7IGRlbGV0ZSBjaGFydHNbY2FudmFzSWRdOyB9CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzSWQpOwogIGlmIChjdHgpIHsKICAgIGlmIChpc1llYXIpIHsKICAgICAgLy8gWWVhciB2aWV3OiBncm91cGVkIGJhciBjaGFydCBKYW7igJNEZWMgd2l0aCBleHBlbnNlICsgc2F2aW5ncyBiYXJzIHBlciBtb250aAogICAgICBjb25zdCB5ZWFyTW9udGhzID0gZ2V0WWVhck1vbnRoS2V5cyhidWRnZXRWaWV3TW9udGgpOwogICAgICBjb25zdCBsYWJlbHMgPSB5ZWFyTW9udGhzLm1hcChtayA9PiB7IGNvbnN0IFssbW9dID0gbWsuc3BsaXQoJy0nKTsgcmV0dXJuIFsnSicsJ0YnLCdNJywnQScsJ00nLCdKJywnSicsJ0EnLCdTJywnTycsJ04nLCdEJ11bcGFyc2VJbnQobW8pLTFdOyB9KTsKICAgICAgY29uc3QgZXhwRGF0YSA9IHllYXJNb250aHMubWFwKG1rID0+IGV4cEdvYWxzLnJlZHVjZSgocywgZykgPT4gcyArIGdldEJ1ZGdldEFjdHVhbChnLCBtayksIDApKTsKICAgICAgY29uc3Qgc2F2RGF0YSA9IHllYXJNb250aHMubWFwKG1rID0+IHNhdkdvYWxzLnJlZHVjZSgocywgZykgPT4gcyArIGdldEJ1ZGdldEFjdHVhbChnLCBtayksIDApKTsKICAgICAgY29uc3QgY3VySWR4ID0geWVhck1vbnRocy5pbmRleE9mKGJ1ZGdldFZpZXdNb250aCk7CiAgICAgIGNoYXJ0c1tjYW52YXNJZF0gPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgdHlwZTogJ2JhcicsCiAgICAgICAgZGF0YTogewogICAgICAgICAgbGFiZWxzLAogICAgICAgICAgZGF0YXNldHM6IFsKICAgICAgICAgICAgeyBsYWJlbDogJ0V4cGVuc2VzJywgZGF0YTogZXhwRGF0YSwgYmFja2dyb3VuZENvbG9yOiBleHBEYXRhLm1hcCgoXywgaSkgPT4gaSA9PT0gY3VySWR4ID8gJyNFRjQ0NDQnIDogJyNFRjQ0NDQ2NicpLCBib3JkZXJSYWRpdXM6IDQsIGJhclBlcmNlbnRhZ2U6IDAuNTUsIGNhdGVnb3J5UGVyY2VudGFnZTogMC43NSB9LAogICAgICAgICAgICB7IGxhYmVsOiAnU2F2aW5ncycsICBkYXRhOiBzYXZEYXRhLCBiYWNrZ3JvdW5kQ29sb3I6IHNhdkRhdGEubWFwKChfLCBpKSA9PiBpID09PSBjdXJJZHggPyAnIzEwQjk4MScgOiAnIzEwQjk4MTY2JyksIGJvcmRlclJhZGl1czogNCwgYmFyUGVyY2VudGFnZTogMC41NSwgY2F0ZWdvcnlQZXJjZW50YWdlOiAwLjc1IH0sCiAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLCBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwKICAgICAgICAgIHBsdWdpbnM6IHsgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sIHRvb2x0aXA6IHsgbW9kZTogJ2luZGV4JywgY2FsbGJhY2tzOiB7IGxhYmVsOiBjID0+IGMuZGF0YXNldC5sYWJlbCArICc6ICcgKyBmbXQoYy5yYXcpIH0gfSB9LAogICAgICAgICAgc2NhbGVzOiB7CiAgICAgICAgICAgIHg6IHsgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0aWNrczogeyBmb250OiB7IHNpemU6IDksIGZhbWlseTogJ051bml0bycsIHdlaWdodDogJzcwMCcgfSwgY29sb3I6ICcjOUFBMEIyJyB9IH0sCiAgICAgICAgICAgIHk6IHsgZGlzcGxheTogZmFsc2UgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAvLyBNb250aCB2aWV3OiBkdWFsIGxpbmUgY2hhcnQg4oCUIGxhc3QgMTIgbW9udGhzCiAgICAgIGNvbnN0IG1vbnRoczEyID0gZ2V0TGFzdDEyTW9udGhzKGJ1ZGdldFZpZXdNb250aCk7CiAgICAgIGNvbnN0IGV4cEFjdHVhbHMxMiA9IG1vbnRoczEyLm1hcChtayA9PiBleHBHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgbWspLCAwKSk7CiAgICAgIGNvbnN0IHNhdkFjdHVhbHMxMiA9IG1vbnRoczEyLm1hcChtayA9PiBzYXZHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgbWspLCAwKSk7CiAgICAgIGNvbnN0IGxhYmVsczEyID0gbW9udGhzMTIubWFwKG1rID0+IHsgY29uc3QgWyxtb10gPSBtay5zcGxpdCgnLScpOyByZXR1cm4gWydKYW4nLCdGZWInLCdNYXInLCdBcHInLCdNYXknLCdKdW4nLCdKdWwnLCdBdWcnLCdTZXAnLCdPY3QnLCdOb3YnLCdEZWMnXVtwYXJzZUludChtbyktMV07IH0pOwogICAgICBjaGFydHNbY2FudmFzSWRdID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgIHR5cGU6ICdsaW5lJywKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBsYWJlbHM6IGxhYmVsczEyLAogICAgICAgICAgZGF0YXNldHM6IFsKICAgICAgICAgICAgeyBsYWJlbDogJ0V4cGVuc2UgQWN0dWFsJywgZGF0YTogZXhwQWN0dWFsczEyLCBib3JkZXJDb2xvcjogJyNFRjQ0NDQnLCBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsIGJvcmRlcldpZHRoOiAyLCBwb2ludFJhZGl1czogMiwgdGVuc2lvbjogMC4zIH0sCiAgICAgICAgICAgIHsgbGFiZWw6ICdFeHBlbnNlIEJ1ZGdldCcsIGRhdGE6IG1vbnRoczEyLm1hcCgoKSA9PiBtb250aGx5RXhwQnVkZ2V0KSwgYm9yZGVyQ29sb3I6ICcjRUY0NDQ0NDQnLCBib3JkZXJXaWR0aDogMS41LCBib3JkZXJEYXNoOiBbNCw0XSwgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLCBwb2ludFJhZGl1czogMCB9LAogICAgICAgICAgICB7IGxhYmVsOiAnU2F2aW5ncyBBY3R1YWwnLCBkYXRhOiBzYXZBY3R1YWxzMTIsIGJvcmRlckNvbG9yOiAnIzEwQjk4MScsIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JywgYm9yZGVyV2lkdGg6IDIsIHBvaW50UmFkaXVzOiAyLCB0ZW5zaW9uOiAwLjMgfSwKICAgICAgICAgICAgeyBsYWJlbDogJ1NhdmluZ3MgQnVkZ2V0JywgZGF0YTogbW9udGhzMTIubWFwKCgpID0+IG1vbnRobHlTYXZCdWRnZXQpLCBib3JkZXJDb2xvcjogJyMxMEI5ODE0NCcsIGJvcmRlcldpZHRoOiAxLjUsIGJvcmRlckRhc2g6IFs0LDRdLCBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsIHBvaW50UmFkaXVzOiAwIH0sCiAgICAgICAgICBdCiAgICAgICAgfSwKICAgICAgICBvcHRpb25zOiB7IHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLCBwbHVnaW5zOiB7IGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0b29sdGlwOiB7IG1vZGU6ICdpbmRleCcsIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBjLmRhdGFzZXQubGFiZWwgKyAnOiAnICsgZm10KGMucmF3KSB9IH0gfSwgc2NhbGVzOiB7IHg6IHsgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0aWNrczogeyBmb250OiB7IHNpemU6IDksIGZhbWlseTogJ051bml0bycsIHdlaWdodDogJzcwMCcgfSwgY29sb3I6ICcjOUFBMEIyJyB9IH0sIHk6IHsgZGlzcGxheTogZmFsc2UgfSB9IH0KICAgICAgfSk7CiAgICB9CiAgfQoKICAvLyDilIDilIAgQ2F0ZWdvcnkgYnViYmxlcyDigJQgdHdvIHZpc3VhbGx5IHNlcGFyYXRlZCByb3dzOiDwn5K4IEV4cGVuc2VzICsg8J+SsCBTYXZpbmdzIOKUgOKUgAogIGZ1bmN0aW9uIG1ha2VCdWJibGVIVE1MKGdvYWwsIGd0eXBlKSB7CiAgICBsZXQgYWN0dWFsLCBidWRnZXQ7CiAgICBpZiAoaXNZZWFyKSB7CiAgICAgIGNvbnN0IHRvZGF5TWsyID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsNyk7CiAgICAgIGNvbnN0IGNhcE1rMiA9IGJ1ZGdldFZpZXdNb250aCA8IHRvZGF5TWsyID8gYnVkZ2V0Vmlld01vbnRoIDogdG9kYXlNazI7CiAgICAgIGNvbnN0IHl0ZE1vbnRocyA9IGdldFllYXJNb250aEtleXMoYnVkZ2V0Vmlld01vbnRoKS5maWx0ZXIobWsgPT4gbWsgPD0gY2FwTWsyKTsKICAgICAgYWN0dWFsID0geXRkTW9udGhzLnJlZHVjZSgocywgbWspID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZ29hbCwgbWspLCAwKTsKICAgICAgYnVkZ2V0ID0gTnVtYmVyKGdvYWwuYW1vdW50IHx8IDApICogMTI7CiAgICB9IGVsc2UgewogICAgICBhY3R1YWwgPSBnZXRCdWRnZXRBY3R1YWwoZ29hbCwgYnVkZ2V0Vmlld01vbnRoKTsKICAgICAgYnVkZ2V0ID0gTnVtYmVyKGdvYWwuYW1vdW50IHx8IDApOwogICAgfQogICAgY29uc3QgcGN0ID0gYnVkZ2V0ID4gMCA/IE1hdGgubWluKGFjdHVhbCAvIGJ1ZGdldCwgMSkgOiAwOwogICAgY29uc3QgaXNHb2FsT3ZlciA9IGFjdHVhbCA+IGJ1ZGdldCAmJiBidWRnZXQgPiAwOwogICAgY29uc3QgaXNTYXYgPSBndHlwZSA9PT0gJ3NhdmluZ3MnOwogICAgY29uc3Qgc3RhdHVzQ29sb3IgPSBpc1NhdiA/IChhY3R1YWwgPj0gYnVkZ2V0ID8gJyMxMEI5ODEnIDogJyNGNTlFMEInKSA6IChpc0dvYWxPdmVyID8gJyNFRjQ0NDQnIDogJyMxMEI5ODEnKTsKICAgIGNvbnN0IHRyYWNrQ29sb3IgID0gaXNTYXYgPyAnIzEwQjk4MScgOiAoaXNHb2FsT3ZlciA/ICcjRUY0NDQ0JyA6ICcjMTBCOTgxJyk7CiAgICBjb25zdCBiZ0NvbG9yICAgICA9IGlzU2F2ID8gJyMxMEI5ODEyMCcgOiAoaXNHb2FsT3ZlciA/ICcjRUY0NDQ0MjAnIDogJyMxMEI5ODExOCcpOwogICAgY29uc3QgciA9IDMwOwogICAgY29uc3QgY2lyY3VtZmVyZW5jZSA9IDIgKiBNYXRoLlBJICogcjsKICAg','IGNvbnN0IGRhc2ggPSBwY3QgKiBjaXJjdW1mZXJlbmNlOwogICAgY29uc3QgbGVmdEFtdCA9IGJ1ZGdldCAtIGFjdHVhbDsKICAgIGNvbnN0IHN0YXR1c1RleHQgPSBidWRnZXQgPiAwID8gKGxlZnRBbXQgPCAwID8gZm10KE1hdGguYWJzKGxlZnRBbXQpKSArICcgb3ZlcicgOiBmbXQobGVmdEFtdCkgKyAnIGxlZnQnKSA6IGZtdChhY3R1YWwpOwogICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJiY2F0LWJ1YmJsZSIgb25jbGljaz0ib3BlbkJ1ZGdldENhdERldGFpbCgnJHtndHlwZX0nLCcke2dvYWwua2V5fScpIj4KICAgICAgPGRpdiBjbGFzcz0iYmNhdC1yaW5nIiBzdHlsZT0iYmFja2dyb3VuZDoke2JnQ29sb3J9OyI+CiAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgNzIgNzIiPjxjaXJjbGUgY3g9IjM2IiBjeT0iMzYiIHI9IiR7cn0iIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0U4RThFOCIgc3Ryb2tlLXdpZHRoPSI1Ii8+PGNpcmNsZSBjeD0iMzYiIGN5PSIzNiIgcj0iJHtyfSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIke3RyYWNrQ29sb3J9IiBzdHJva2Utd2lkdGg9IjUiIHN0cm9rZS1kYXNoYXJyYXk9IiR7ZGFzaH0gJHtjaXJjdW1mZXJlbmNlfSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PC9zdmc+CiAgICAgICAgPGRpdiBjbGFzcz0iYmNhdC1pY29uLXdyYXAiPiR7Z29hbC5pY29uIHx8IChpc1NhdiA/ICfwn5KwJyA6ICfwn5K4Jyl9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJiY2F0LW5hbWUiPiR7Z29hbC5uYW1lfTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJiY2F0LXN0YXR1cyIgc3R5bGU9ImNvbG9yOiR7c3RhdHVzQ29sb3J9OyI+JHtzdGF0dXNUZXh0fTwvZGl2PgogICAgPC9kaXY+YDsKICB9CgogIGNvbnN0IGV4cEJ1YmJsZXNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtY2F0cy1idWJibGVzLWV4cCcpOwogIGNvbnN0IHNhdkJ1YmJsZXNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtY2F0cy1idWJibGVzLXNhdicpOwogIGNvbnN0IGV4cExhYmVsRWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiY2F0LWxhYmVsLWV4cCcpOwogIGNvbnN0IHNhdkxhYmVsRWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiY2F0LWxhYmVsLXNhdicpOwoKICBpZiAoZXhwQnViYmxlc0VsKSB7CiAgICBpZiAoZXhwR29hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgIGV4cEJ1YmJsZXNFbC5pbm5lckhUTUwgPSAnJzsKICAgICAgaWYgKGV4cExhYmVsRWwpIGV4cExhYmVsRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChleHBMYWJlbEVsKSBleHBMYWJlbEVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgIGV4cEJ1YmJsZXNFbC5pbm5lckhUTUwgPSBleHBHb2Fscy5tYXAoZyA9PiBtYWtlQnViYmxlSFRNTChnLCAnZXhwZW5zZScpKS5qb2luKCcnKTsKICAgIH0KICB9CgogIGlmIChzYXZCdWJibGVzRWwpIHsKICAgIGlmIChzYXZHb2Fscy5sZW5ndGggPT09IDApIHsKICAgICAgc2F2QnViYmxlc0VsLmlubmVySFRNTCA9ICcnOwogICAgICBpZiAoc2F2TGFiZWxFbCkgc2F2TGFiZWxFbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfSBlbHNlIHsKICAgICAgaWYgKHNhdkxhYmVsRWwpIHNhdkxhYmVsRWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgc2F2QnViYmxlc0VsLmlubmVySFRNTCA9IHNhdkdvYWxzLm1hcChnID0+IG1ha2VCdWJibGVIVE1MKGcsICdzYXZpbmdzJykpLmpvaW4oJycpOwogICAgfQogIH0KfQoKZnVuY3Rpb24gcmVuZGVyQnVkZ2V0R29hbHNMaXN0KHR5cGUpIHsKICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKHR5cGUpOwogIGNvbnN0IGxpc3RJZCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdidWRnZXQtc2F2LWdvYWxzJyA6ICdidWRnZXQtZXhwLWdvYWxzJzsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxpc3RJZCk7CiAgaWYgKCFlbCkgcmV0dXJuOwoKICBpZiAoZ29hbHMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2JhY2tncm91bmQ6dmFyKC0td2hpdGUpO2JvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTtib3gtc2hhZG93OnZhcigtLWNhcmQtc2hhZG93KTsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToyLjVlbTttYXJnaW4tYm90dG9tOjhweDsiPiR7dHlwZSA9PT0gJ3NhdmluZ3MnID8gJ/CfkrAnIDogJ/Cfjq8nfTwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjcwMDsiPk5vICR7dHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdmluZ3MgZ29hbHMnIDogJ2V4cGVuc2UgYnVkZ2V0cyd9IHlldDwvZGl2PjxidXR0b24gb25jbGljaz0ib3BlbkVkaXRCdWRnZXRQb3B1cChudWxsLCcke3R5cGV9JykiIHN0eWxlPSJtYXJnaW4tdG9wOjEycHg7YmFja2dyb3VuZDp2YXIoLS15ZWxsb3cpO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6MTJweDtwYWRkaW5nOjEwcHggMjBweDtmb250LWZhbWlseTpOdW5pdG8sc2Fucy1zZXJpZjtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODVlbTtjdXJzb3I6cG9pbnRlcjsiPisgQWRkIEdvYWw8L2J1dHRvbj48L2Rpdj5gOwogICAgcmV0dXJuOwogIH0KCiAgZWwuaW5uZXJIVE1MID0gZ29hbHMubWFwKGdvYWwgPT4gewogICAgY29uc3QgYWN0dWFsID0gZ2V0QnVkZ2V0QWN0dWFsKGdvYWwsIGJ1ZGdldFZpZXdNb250aCk7CiAgICBjb25zdCBidWRnZXQgPSBOdW1iZXIoZ29hbC5hbW91bnQgfHwgMCk7CiAgICBjb25zdCBwY3QgPSBidWRnZXQgPiAwID8gTWF0aC5taW4oYWN0dWFsIC8gYnVkZ2V0ICogMTAwLCAxMDApIDogMDsKICAgIGNvbnN0IGlzT3ZlciA9IGFjdHVhbCA+IGJ1ZGdldCAmJiBidWRnZXQgPiAwOwogICAgY29uc3QgaXNTYXYgPSB0eXBlID09PSAnc2F2aW5ncyc7CiAgICBjb25zdCBiYXJDb2xvciA9IGlzU2F2ID8gKGFjdHVhbCA+PSBidWRnZXQgPyAnIzEwQjk4MScgOiAnI0Y1OUUwQicpIDogKGlzT3ZlciA/ICcjRUY0NDQ0JyA6ICcjMTBCOTgxJyk7CiAgICBjb25zdCBhbXRDb2xvciA9IGlzU2F2ID8gKGFjdHVhbCA+PSBidWRnZXQgPyAndmFyKC0taW5jb21lKScgOiAndmFyKC0tdGV4dC1kYXJrKScpIDogKGlzT3ZlciA/ICd2YXIoLS1leHBlbnNlcyknIDogJ3ZhcigtLXRleHQtZGFyayknKTsKICAgIGNvbnN0IGxlZnRBbXQgPSBidWRnZXQgLSBhY3R1YWw7CiAgICBjb25zdCBzdGF0dXNMYWJlbCA9IGJ1ZGdldCA+IDAgPyAobGVmdEFtdCA8IDAgPyBmbXQoTWF0aC5hYnMobGVmdEFtdCkpICsgJyBvdmVyJyA6IGZtdChsZWZ0QW10KSArICcgbGVmdCcpIDogJyc7CiAgICBjb25zdCBpY29uQmcgPSBpc1NhdiA/ICcjMTBCOTgxMTgnIDogKGlzT3ZlciA/ICcjRUY0NDQ0MTgnIDogJyMxMEI5ODExOCcpOwoKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iYnVkZ2V0LWdvYWwtcm93Ij4KICAgICAgPGRpdiBjbGFzcz0iYmdyLXRvcCI+CiAgICAgICAgPGRpdiBjbGFzcz0iYmdyLWljb24iIHN0eWxlPSJiYWNrZ3JvdW5kOiR7aWNvbkJnfTsiPiR7Z29hbC5pY29uIHx8ICfwn5K4J308L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJiZ3ItaW5mbyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJiZ3ItbmFtZSI+JHtnb2FsLm5hbWV9PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJiZ3ItdHlwZSI+JHtpc1NhdiA/ICfwn5KwIFNhdmluZ3MgR29hbCcgOiAn8J+SuCBFeHBlbnNlIEJ1ZGdldCd9IMK3ICR7Z2V0RGlzcGxheU1vbnRoKGJ1ZGdldFZpZXdNb250aCl9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYmdyLXJpZ2h0Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9ImJnci1zcGVudCIgc3R5bGU9ImNvbG9yOiR7YW10Q29sb3J9OyI+JHtmbXQoYWN0dWFsKX08L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImJnci1idWRnZXQiPm9mICR7Zm10KGJ1ZGdldCl9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJiZ3ItYmFyIj48ZGl2IGNsYXNzPSJiZ3ItYmFyLWZpbGwiIHN0eWxlPSJ3aWR0aDoke3BjdH0lO2JhY2tncm91bmQ6JHtiYXJDb2xvcn07Ij48L2Rpdj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYmdyLWFjdGlvbnMiPgogICAgICAgIDxidXR0b24gY2xhc3M9ImJnci1hY3Rpb24tYnRuIiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS15ZWxsb3ctbGlnaHQpO2NvbG9yOnZhcigtLXRleHQtZGFyayk7IiBvbmNsaWNrPSJvcGVuQnVkZ2V0Q2F0RGV0YWlsKCcke3R5cGV9JywnJHtnb2FsLmtleX0nKSI+8J+TiiBEZXRhaWxzPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmdyLWFjdGlvbi1idG4iIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEY4RkY7Y29sb3I6IzRBOUVGRjsiIG9uY2xpY2s9Im9wZW5FZGl0QnVkZ2V0UG9wdXAoJyR7Z29hbC5rZXl9JywnJHt0eXBlfScpIj7inI/vuI8gRWRpdDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PmA7CiAgfSkuam9pbignJyk7Cn0KCi8vIFNoYXJlZCBmdW5jdGlvbiB0byAocmUpYnVpbGQgdGhlIGRldGFpbCB2aWV3IGZvciBhIGdpdmVuIGdvYWwKZnVuY3Rpb24gX3JlbmRlckJ1ZGdldERldGFpbChwcmVmaXgsIGdvYWwsIHR5cGUpIHsKICBjb25zdCBhY3R1YWwgID0gZ2V0QnVkZ2V0QWN0dWFsKGdvYWwsIGJ1ZGdldFZpZXdNb250aCk7CiAgY29uc3QgYnVkZ2V0ICA9IE51bWJlcihnb2FsLmFtb3VudCB8fCAwKTsKICBjb25zdCBsZWZ0QW10ID0gYnVkZ2V0IC0gYWN0dWFsOwogIGNvbnN0IGlzT3ZlciAgPSBhY3R1YWwgPiBidWRnZXQgJiYgYnVkZ2V0ID4gMDsKICBjb25zdCBpc1NhdiAgID0gdHlwZSA9PT0gJ3NhdmluZ3MnOwoKICAvLyBIZWFkZXIKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1pY29uYCkudGV4dENvbnRlbnQgID0gZ29hbC5pY29uIHx8IChpc1NhdiA/ICfwn5KwJyA6ICfwn5K4Jyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tbmFtZWApLnRleHRDb250ZW50ICA9IGdvYWwubmFtZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1zcGVudGApLmlubmVySFRNTCAgID0KICAgIGA8c3BhbiBzdHlsZT0iY29sb3I6JHtpc092ZXI/J3ZhcigtLWV4cGVuc2VzKSc6J3ZhcigtLXRleHQtZGFyayknfTsiPiR7Zm10KGFjdHVhbCl9IHNwZW50PC9zcGFuPmAgKwogICAgYCA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij4vICR7Zm10KGJ1ZGdldCl9ICR7aXNTYXY/J2dvYWwnOididWRnZXQnfTwvc3Bhbj5gICsKICAgIGAgwrcgPHNwYW4gc3R5bGU9ImNvbG9yOiR7aXNPdmVyPyd2YXIoLS1leHBlbnNlcyknOid2YXIoLS1pbmNvbWUpJ307Ij4ke2lzT3ZlciA/IGZtdChNYXRoLmFicyhsZWZ0QW10KSkrJyBvdmVyJyA6IGZtdChsZWZ0QW10KSsnIGxlZnQnfTwvc3Bhbj5gOwoKICAvLyBCdWRnZXQgY2hpcCBsYWJlbAogIGNvbnN0IGNoaXBMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LWNoaXAtbGFiZWxgKTsKICBjb25zdCBjaGlwSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1jaGlwLWlucHV0YCk7CiAgaWYgKGNoaXBMYWJlbCkgY2hpcExhYmVsLnRleHRDb250ZW50ID0gZm10KGJ1ZGdldCk7CiAgaWYgKGNoaXBJbnB1dCkgY2hpcElucHV0LnZhbHVlID0gYnVkZ2V0OwoKICAvLyDilIDilIAgQ2hhcnQg4pSA4pSACiAgY29uc3QgbW9udGhzMTIgID0gZ2V0TGFzdDEyTW9udGhzKGJ1ZGdldFZpZXdNb250aCk7CiAgY29uc3QgYWN0dWFsczEyID0gbW9udGhzMTIubWFwKG1rID0+IGdldEJ1ZGdldEFjdHVhbChnb2FsLCBtaykpOwogIGNvbnN0IGxhYmVsczEyICA9IG1vbnRoczEyLm1hcChtayA9PiB7IGNvbnN0IFssbW9dID0gbWsuc3BsaXQoJy0nKTsg','cmV0dXJuIFsnSicsJ0YnLCdNJywnQScsJ00nLCdKJywnSicsJ0EnLCdTJywnTycsJ04nLCdEJ11bcGFyc2VJbnQobW8pLTFdOyB9KTsKICBjb25zdCBjdXJJZHggICAgPSBtb250aHMxMi5pbmRleE9mKGJ1ZGdldFZpZXdNb250aCk7CgogIGNvbnN0IGxpbmVDb2xvciA9IGlzU2F2ID8gJyMxMEI5ODEnIDogJyMxRTJBNkUnOwogIGNvbnN0IGJhckNvbG9ycyA9IGFjdHVhbHMxMi5tYXAoKGEsIGkpID0+IHsKICAgIGlmIChpID09PSBjdXJJZHgpIHJldHVybiBpc1NhdiA/ICcjMTBCOTgxJyA6ICcjM0I0QTlDJzsKICAgIGlmIChidWRnZXQgPiAwKSAgIHJldHVybiBhID4gYnVkZ2V0ID8gJyNFRjQ0NDQnIDogKGlzU2F2ID8gJyMxMEI5ODE5OScgOiAnIzEwQjk4MTk5Jyk7CiAgICByZXR1cm4gJyMxMEI5ODE5OSc7CiAgfSk7CgogIGNvbnN0IGNoYXJ0SWQgPSBgYmNkLSR7cHJlZml4fS1jaGFydGA7CiAgaWYgKGNoYXJ0c1tjaGFydElkXSkgeyBjaGFydHNbY2hhcnRJZF0uZGVzdHJveSgpOyBkZWxldGUgY2hhcnRzW2NoYXJ0SWRdOyB9CiAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2hhcnRJZCk7CiAgaWYgKCFjdHgpIHJldHVybjsKCiAgY2hhcnRzW2NoYXJ0SWRdID0gbmV3IENoYXJ0KGN0eCwgewogICAgdHlwZTogJ2JhcicsCiAgICBkYXRhOiB7CiAgICAgIGxhYmVsczogbGFiZWxzMTIsCiAgICAgIGRhdGFzZXRzOiBbCiAgICAgICAgewogICAgICAgICAgbGFiZWw6ICdTcGVudCcsCiAgICAgICAgICBkYXRhOiBhY3R1YWxzMTIsCiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGJhckNvbG9ycywKICAgICAgICAgIGJvcmRlclJhZGl1czogNiwKICAgICAgICAgIGJhclBlcmNlbnRhZ2U6IDAuNjUsCiAgICAgICAgICBvcmRlcjogMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgbGFiZWw6ICdCdWRnZXQnLAogICAgICAgICAgZGF0YTogbW9udGhzMTIubWFwKCgpID0+IGJ1ZGdldCksCiAgICAgICAgICB0eXBlOiAnbGluZScsCiAgICAgICAgICBib3JkZXJDb2xvcjogbGluZUNvbG9yLAogICAgICAgICAgYm9yZGVyV2lkdGg6IDIuNSwKICAgICAgICAgIGJvcmRlckRhc2g6IFs2LCA0XSwKICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JywKICAgICAgICAgIHBvaW50UmFkaXVzOiAwLAogICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogMCwKICAgICAgICAgIG9yZGVyOiAxLAogICAgICAgICAgLy8gRHJhdyBhIHNvbGlkIGRvdCBhdCB0aGUgcmlnaHRtb3N0IHBvaW50IHRvIGFuY2hvciB0aGUgY2hpcCB2aXN1YWxseQogICAgICAgICAgcG9pbnRSYWRpdXM6IG1vbnRoczEyLm1hcCgoXywgaSkgPT4gaSA9PT0gbW9udGhzMTIubGVuZ3RoIC0gMSA/IDQgOiAwKSwKICAgICAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yOiBsaW5lQ29sb3IKICAgICAgICB9CiAgICAgIF0KICAgIH0sCiAgICBvcHRpb25zOiB7CiAgICAgIHJlc3BvbnNpdmU6IHRydWUsCiAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogICAgICBwbHVnaW5zOiB7CiAgICAgICAgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sCiAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgY2FsbGJhY2tzOiB7CiAgICAgICAgICAgIGxhYmVsOiBjID0+IChjLmRhdGFzZXQubGFiZWwgfHwgJycpICsgJzogJyArIGZtdChOdW1iZXIoYy5yYXcgfHwgMCkpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBzY2FsZXM6IHsKICAgICAgICB4OiB7CiAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sCiAgICAgICAgICB0aWNrczogeyBmb250OiB7IHNpemU6IDksIGZhbWlseTogJ051bml0bycsIHdlaWdodDogJzcwMCcgfSwgY29sb3I6ICcjOUFBMEIyJyB9CiAgICAgICAgfSwKICAgICAgICB5OiB7IGRpc3BsYXk6IGZhbHNlIH0KICAgICAgfQogICAgfQogIH0pOwoKICAvLyDilIDilIAgTWV0cmljcyDilIDilIAKICBjb25zdCB5ZWFyU3RhcnQgID0gYnVkZ2V0Vmlld01vbnRoLnNwbGl0KCctJylbMF07CiAgY29uc3QgeWVhck1vbnRocyA9IE9iamVjdC5rZXlzKGRhdGEpLmZpbHRlcihrID0+IGsuc3RhcnRzV2l0aCh5ZWFyU3RhcnQgKyAnLScpICYmICFrLnN0YXJ0c1dpdGgoJ18nKSk7CiAgY29uc3QgeWVhclRvdGFsICA9IHllYXJNb250aHMucmVkdWNlKChzLCBtaykgPT4gcyArIGdldEJ1ZGdldEFjdHVhbChnb2FsLCBtayksIDApOwogIGNvbnN0IGF2Z1Blck1vbnRoID0geWVhck1vbnRocy5sZW5ndGggPiAwID8geWVhclRvdGFsIC8geWVhck1vbnRocy5sZW5ndGggOiAwOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1tZXRyaWNzYCkuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1jYXJkIj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLWxhYmVsIj5Ub3RhbCAke3llYXJTdGFydH08L2Rpdj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLXZhbCI+JHtmbXQoeWVhclRvdGFsKX08L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtY2FyZCI+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1sYWJlbCI+QXZnIC8gTW9udGg8L2Rpdj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLXZhbCI+JHtmbXQoYXZnUGVyTW9udGgpfTwvZGl2PjwvZGl2PgogICAgPGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1jYXJkIj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLWxhYmVsIj4ke2lzU2F2ID8gJ01vbnRobHkgR29hbCcgOiAnTW9udGhseSBCdWRnZXQnfTwvZGl2PjxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtdmFsIj4ke2ZtdChidWRnZXQpfTwvZGl2PjwvZGl2PgogICAgPGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1jYXJkIj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLWxhYmVsIj4ke2lzT3ZlciA/ICdPdmVyIGJ5JyA6ICdSZW1haW5pbmcnfTwvZGl2PjxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtdmFsIiBzdHlsZT0iY29sb3I6JHtpc092ZXI/J3ZhcigtLWV4cGVuc2VzKSc6J3ZhcigtLWluY29tZSknfTsiPiR7Zm10KE1hdGguYWJzKGxlZnRBbXQpKX08L2Rpdj48L2Rpdj4KICBgOwoKICAvLyDilIDilIAgVHJhbnNhY3Rpb25zIOKUgOKUgAogIGVuc3VyZU1vbnRoKGJ1ZGdldFZpZXdNb250aCk7CiAgY29uc3QgbSAgICA9IGRhdGFbYnVkZ2V0Vmlld01vbnRoXTsKICBjb25zdCBjYXRzID0gKGdvYWwubGlua2VkQ2F0cyB8fCBbZ29hbC5rZXldKS5tYXAoYyA9PiBjLnRvTG93ZXJDYXNlKCkudHJpbSgpKTsKICBsZXQgdHhucyAgID0gW107CiAgWydleHBlbnNlcycsICdpbnZlc3RtZW50cycsICdhZGRpdGlvbmFsJ10uZm9yRWFjaChsaXN0S2V5ID0+IHsKICAgIChtW2xpc3RLZXldIHx8IFtdKS5mb3JFYWNoKGUgPT4gewogICAgICBjb25zdCBlYyA9IChlLmNhdGVnb3J5IHx8ICcnKS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgaWYgKGNhdHMuc29tZShjID0+IGVjLmluY2x1ZGVzKGMpKSkgdHhucy5wdXNoKHsgLi4uZSwgX3R5cGU6IGxpc3RLZXkgfSk7CiAgICB9KTsKICB9KTsKICB0eG5zLnNvcnQoKGEsIGIpID0+IChiLmRhdGUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYS5kYXRlIHx8ICcnKSk7CgogIGNvbnN0IHR4bk1vbnRoTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS10eG4tbW9udGhgKTsKICBpZiAodHhuTW9udGhMYWJlbCkgdHhuTW9udGhMYWJlbC50ZXh0Q29udGVudCA9IGAke2dldERpc3BsYXlNb250aChidWRnZXRWaWV3TW9udGgpfSBUcmFuc2FjdGlvbnMgKCR7dHhucy5sZW5ndGh9KWA7CgogIGNvbnN0IHR4bnNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LXR4bnNgKTsKICBpZiAodHhuc0VsKSB7CiAgICB0eG5zRWwuaW5uZXJIVE1MID0gdHhucy5sZW5ndGggPT09IDAKICAgICAgPyBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoyMHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc2l6ZTowLjg1ZW07Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gdHJhbnNhY3Rpb25zIHRoaXMgbW9udGg8L2Rpdj5gCiAgICAgIDogdHhucy5tYXAodCA9PiB7CiAgICAgICAgICBjb25zdCBkICAgPSB0LmRhdGUgPyBuZXcgRGF0ZSh0LmRhdGUgKyAnVDAwOjAwOjAwJykudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycsIHsgbW9udGg6J3Nob3J0JywgZGF5OidudW1lcmljJyB9KSA6ICcnOwogICAgICAgICAgY29uc3QgYW10ID0gY29udmVydEFtdCh0LmFtb3VudCwgdC5jdXJyZW5jeSk7CiAgICAgICAgICBjb25zdCBhbXRDb2xvciA9IGlzU2F2ID8gJ3ZhcigtLWluY29tZSknIDogJ3ZhcigtLWV4cGVuc2VzKSc7CiAgICAgICAgICBjb25zdCBtZXRhbFRhZyA9IHQubWV0YWxHcmFtcyA/IGAgwrcgJHt0Lm1ldGFsR3JhbXN9ZyAke3QubWV0YWxUeXBlfHwnJ31gIDogJyc7CiAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImJjZC10eC1yb3ciPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiY2QtdHgtaWNvbiIgc3R5bGU9ImJhY2tncm91bmQ6JHtpc1Nhdj8nIzEwQjk4MTE1JzonI0VGNDQ0NDE1J307Ij4ke2dvYWwuaWNvbiB8fCAoaXNTYXY/J/CfkrAnOifwn5K4Jyl9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJjZC10eC1pbmZvIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiY2QtdHgtbmFtZSI+JHt0LmRlc2NyaXB0aW9uIHx8IHQuY2F0ZWdvcnkgfHwgJ1RyYW5zYWN0aW9uJ308L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiY2QtdHgtZGF0ZSI+JHtkfSR7dC5jYXRlZ29yeSA/ICcgwrcgJyArIHQuY2F0ZWdvcnkgOiAnJ30ke21ldGFsVGFnfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmNkLXR4LWFtdCIgc3R5bGU9ImNvbG9yOiR7YW10Q29sb3J9OyI+JHtpc1Nhdj8nKyc6Jy0nfSR7Zm10KGFtdCl9PC9kaXY+CiAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0pLmpvaW4oJycpOwogIH0KfQoKZnVuY3Rpb24gb3BlbkJ1ZGdldENhdERldGFpbCh0eXBlLCBnb2FsS2V5KSB7CiAgY3VycmVudEJ1ZGdldENhdERldGFpbCA9IHsgdHlwZSwgZ29hbEtleSB9OwogIGNvbnN0IGdvYWxzID0gZ2V0QnVkZ2V0R29hbHModHlwZSk7CiAgY29uc3QgZ29hbCAgPSBnb2Fscy5maW5kKGcgPT4gZy5rZXkgPT09IGdvYWxLZXkpOwogIGlmICghZ29hbCkgcmV0dXJuOwoKICAvLyBTd2l0Y2ggdGFiCiAgaWYgKHR5cGUgPT09ICdzYXZpbmdzJyAmJiBjdXJyZW50QnVkZ2V0VGFiICE9PSAnc2F2aW5ncycpIHsKICAgIHNldEJ1ZGdldFRhYignc2F2aW5ncycsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidGFiLXNhdmluZ3MnKSk7CiAgfSBlbHNlIGlmICh0eXBlID09PSAnZXhwZW5zZScgJiYgY3VycmVudEJ1ZGdldFRhYiAhPT0gJ2V4cGVuc2VzJykgewogICAgc2V0QnVkZ2V0VGFiKCdleHBlbnNlcycsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidGFiLWV4cGVuc2VzJykpOwogIH0KCiAgY29uc3QgcHJlZml4ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdicgOiAnZXhwJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNhdC1kZXRhaWwtJHt0eXBlID09PSAnc2F2aW5ncycgPyAnc2F2aW5ncycgOiAnZXhwZW5zZXMnfWApLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmxpc3QtJHt0eXBlID09PSAnc2F2aW5ncycgPyAnc2F2aW5ncycgOiAnZXhwZW5zZXMnfWApLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogIF9yZW5kZXJCdWRnZXREZXRhaWwocHJlZml4LCBnb2FsLCB0eXBlKTsKfQoKZnVuY3Rpb24gY2xvc2VCdWRnZXRDYXREZXRhaWwodHlwZSkgewogIGN1cnJlbnRCdWRnZXRDYXREZXRhaWwgPSBudWxsOwogIGNvbnN0IGRldGFpbElkID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ2JjYXQtZGV0YWlsLXNhdmluZ3MnIDogJ2JjYXQtZGV0YWlsLWV4cGVuc2VzJzsKICBjb25zdCBsaXN0SWQgICA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdibGlzdC1zYXZp','bmdzJyA6ICdibGlzdC1leHBlbnNlcyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGV0YWlsSWQpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0SWQpLnN0eWxlLmRpc3BsYXkgPSAnJzsKfQoKLy8g4pSA4pSAIEJ1ZGdldCBjaGlwOiBjbGljayB0byBlZGl0IGlubGluZSDilIDilIAKZnVuY3Rpb24gYWN0aXZhdGVCdWRnZXRDaGlwKHR5cGUpIHsKICBjb25zdCBwcmVmaXggPSB0eXBlID09PSAnc2F2aW5ncycgPyAnc2F2JyA6ICdleHAnOwogIGNvbnN0IGNoaXAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LWNoaXBgKTsKICBjb25zdCBpbnB1dCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1jaGlwLWlucHV0YCk7CiAgaWYgKCFjaGlwIHx8IGNoaXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdlZGl0aW5nJykpIHJldHVybjsKICBjaGlwLmNsYXNzTGlzdC5hZGQoJ2VkaXRpbmcnKTsKICBpbnB1dC5mb2N1cygpOwogIGlucHV0LnNlbGVjdCgpOwp9CgpmdW5jdGlvbiBzYXZlQnVkZ2V0Q2hpcCh0eXBlKSB7CiAgY29uc3QgcHJlZml4ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdicgOiAnZXhwJzsKICBjb25zdCBjaGlwICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1jaGlwYCk7CiAgY29uc3QgaW5wdXQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tY2hpcC1pbnB1dGApOwogIGlmICghY2hpcCB8fCAhY2hpcC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXRpbmcnKSkgcmV0dXJuOwoKICBjb25zdCBuZXdBbXQgPSBwYXJzZUZsb2F0KGlucHV0LnZhbHVlKTsKICBpZiAoaXNOYU4obmV3QW10KSB8fCBuZXdBbXQgPCAwKSB7IGNhbmNlbEJ1ZGdldENoaXAodHlwZSk7IHJldHVybjsgfQoKICAvLyBTYXZlIHRvIGRhdGEKICBjb25zdCBkZXQgID0gY3VycmVudEJ1ZGdldENhdERldGFpbDsKICBpZiAoIWRldCkgeyBjYW5jZWxCdWRnZXRDaGlwKHR5cGUpOyByZXR1cm47IH0KICBjb25zdCBzdG9yYWdlS2V5ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ19zYXZpbmdzR29hbHMnIDogJ19leHBlbnNlR29hbHMnOwogIGNvbnN0IGdvYWxzID0gZGF0YVtzdG9yYWdlS2V5XSB8fCBbXTsKICBjb25zdCBnb2FsICA9IGdvYWxzLmZpbmQoZyA9PiBnLmtleSA9PT0gZGV0LmdvYWxLZXkpOwogIGlmIChnb2FsKSB7CiAgICBnb2FsLmFtb3VudCA9IG5ld0FtdDsKICAgIHNhdmUoKTsKICAgIHNob3dUb2FzdChg4pyFIEJ1ZGdldCB1cGRhdGVkIHRvICR7Zm10KG5ld0FtdCl9YCk7CiAgICAvLyBSZS1yZW5kZXIgZXZlcnl0aGluZwogICAgY2hpcC5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0aW5nJyk7CiAgICBfcmVuZGVyQnVkZ2V0RGV0YWlsKHByZWZpeCwgZ29hbCwgdHlwZSk7CiAgICByZW5kZXJCdWRnZXRNb2R1bGUoKTsgLy8gcmVmcmVzaCBidWJibGVzICYgaGVybyB0b28KICB9IGVsc2UgewogICAgY2FuY2VsQnVkZ2V0Q2hpcCh0eXBlKTsKICB9Cn0KCmZ1bmN0aW9uIGNhbmNlbEJ1ZGdldENoaXAodHlwZSkgewogIGNvbnN0IHByZWZpeCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdzYXYnIDogJ2V4cCc7CiAgY29uc3QgY2hpcCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tY2hpcGApOwogIGlmIChjaGlwKSBjaGlwLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRpbmcnKTsKfQoKLy8gRWRpdCBCdWRnZXQgUG9wdXAKY29uc3QgQlVER0VUX0VNT0pJX1BBTkVMX09QVFMgPSBbJ/CfkrgnLCfwn5uSJywn8J+alycsJ/Cfj6AnLCfwn5KKJywn8J+OrScsJ/CfjZQnLCfimJUnLCfwn46TJywn8J+QvicsJ+KciO+4jycsJ/CfkZcnLCfwn46uJywn8J+Pi++4jycsJ/CfjoEnLCfwn5OxJywn4pqhJywn8J+ajCcsJ/CfkrAnLCfwn5OIJywn8J+lhycsJ/Cfj6YnLCfwn4yKJywn8J+OryddOwoKZnVuY3Rpb24gb3BlbkVkaXRCdWRnZXRQb3B1cChnb2FsS2V5LCBmb3JjZVR5cGUpIHsKICBlZGl0aW5nQnVkZ2V0S2V5ID0gZ29hbEtleSB8fCBudWxsOwogIGVkaXRpbmdCdWRnZXRUeXBlID0gZm9yY2VUeXBlIHx8IGN1cnJlbnRCdWRnZXRUYWIgPT09ICdzYXZpbmdzJyA/ICdzYXZpbmdzJyA6ICdleHBlbnNlJzsKICBpZiAoZm9yY2VUeXBlKSBlZGl0aW5nQnVkZ2V0VHlwZSA9IGZvcmNlVHlwZTsKCiAgY29uc3QgcG9wdXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1idWRnZXQtcG9wdXAnKTsKICBjb25zdCBkZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWRlbC1idG4nKTsKCiAgLy8gUmVuZGVyIGVtb2ppIHJvdwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtZW1vamktcm93JykuaW5uZXJIVE1MID0gQlVER0VUX0VNT0pJX1BBTkVMX09QVFMubWFwKGUgPT4KICAgIGA8ZGl2IGNsYXNzPSJlYnAtZW1vamktb3B0ICR7ZSA9PT0gcGlja2VkQnVkZ2V0RW1vamkgPyAncGlja2VkJyA6ICcnfSIgb25jbGljaz0icGlja0J1ZGdldEVtb2ppKCcke2V9JykiPiR7ZX08L2Rpdj5gCiAgKS5qb2luKCcnKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC10eXBlJykudmFsdWUgPSBlZGl0aW5nQnVkZ2V0VHlwZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLXRpdGxlJykudGV4dENvbnRlbnQgPSBnb2FsS2V5ID8gJ+Kcj++4jyBFZGl0IEJ1ZGdldCBHb2FsJyA6ICfinpUgQWRkIEJ1ZGdldCBHb2FsJzsKCiAgaWYgKGdvYWxLZXkpIHsKICAgIGNvbnN0IGdvYWxzID0gZ2V0QnVkZ2V0R29hbHMoZWRpdGluZ0J1ZGdldFR5cGUpOwogICAgY29uc3QgZ29hbCA9IGdvYWxzLmZpbmQoZyA9PiBnLmtleSA9PT0gZ29hbEtleSk7CiAgICBpZiAoZ29hbCkgewogICAgICBwaWNrZWRCdWRnZXRFbW9qaSA9IGdvYWwuaWNvbiB8fCAn8J+SuCc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbmFtZScpLnZhbHVlID0gZ29hbC5uYW1lIHx8IGdvYWwua2V5OwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWFtb3VudCcpLnZhbHVlID0gZ29hbC5hbW91bnQgfHwgJyc7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbGlua2VkLWNhdHMnKS52YWx1ZSA9IChnb2FsLmxpbmtlZENhdHMgfHwgW10pLmpvaW4oJywgJyk7CiAgICAgIGRlbEJ0bi5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICB9CiAgfSBlbHNlIHsKICAgIHBpY2tlZEJ1ZGdldEVtb2ppID0gJ/CfkrgnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1uYW1lJykudmFsdWUgPSAnJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtYW1vdW50JykudmFsdWUgPSAnJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbGlua2VkLWNhdHMnKS52YWx1ZSA9ICcnOwogICAgZGVsQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfQoKICAvLyBSZS1yZW5kZXIgZW1vamkgcm93IHdpdGggc2VsZWN0aW9uCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1lbW9qaS1yb3cnKS5pbm5lckhUTUwgPSBCVURHRVRfRU1PSklfUEFORUxfT1BUUy5tYXAoZSA9PgogICAgYDxkaXYgY2xhc3M9ImVicC1lbW9qaS1vcHQgJHtlID09PSBwaWNrZWRCdWRnZXRFbW9qaSA/ICdwaWNrZWQnIDogJyd9IiBvbmNsaWNrPSJwaWNrQnVkZ2V0RW1vamkoJyR7ZX0nKSI+JHtlfTwvZGl2PmAKICApLmpvaW4oJycpOwoKICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7Cn0KCmZ1bmN0aW9uIHBpY2tCdWRnZXRFbW9qaShlKSB7CiAgcGlja2VkQnVkZ2V0RW1vamkgPSBlOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lYnAtZW1vamktb3B0JykuZm9yRWFjaChlbCA9PiBlbC5jbGFzc0xpc3QucmVtb3ZlKCdwaWNrZWQnKSk7CiAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3BpY2tlZCcpOwp9CgpmdW5jdGlvbiBjbG9zZUVkaXRCdWRnZXRQb3B1cCgpIHsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdC1idWRnZXQtcG9wdXAnKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7Cn0KCmZ1bmN0aW9uIHNhdmVFZGl0ZWRCdWRnZXQoKSB7CiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbmFtZScpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBhbW91bnQgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtYW1vdW50JykudmFsdWUpIHx8IDA7CiAgY29uc3QgdHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtdHlwZScpLnZhbHVlOwogIGNvbnN0IGxpbmtlZENhdHNSYXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWxpbmtlZC1jYXRzJykudmFsdWUudHJpbSgpOwogIGNvbnN0IGxpbmtlZENhdHMgPSBsaW5rZWRDYXRzUmF3ID8gbGlua2VkQ2F0c1Jhdy5zcGxpdCgnLCcpLm1hcChjID0+IGMudHJpbSgpKS5maWx0ZXIoQm9vbGVhbikgOiBbbmFtZV07CgogIGlmICghbmFtZSkgeyBzaG93VG9hc3QoJ0VudGVyIGEgbmFtZSDinYwnKTsgcmV0dXJuOyB9CiAgaWYgKCFhbW91bnQpIHsgc2hvd1RvYXN0KCdFbnRlciBhIGJ1ZGdldCBhbW91bnQg4p2MJyk7IHJldHVybjsgfQoKICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKHR5cGUpOwogIGNvbnN0IGtleSA9IGVkaXRpbmdCdWRnZXRLZXkgfHwgbmFtZS5yZXBsYWNlKC9ccysvZywgJ18nKTsKCiAgaWYgKGVkaXRpbmdCdWRnZXRLZXkpIHsKICAgIGNvbnN0IGlkeCA9IGdvYWxzLmZpbmRJbmRleChnID0+IGcua2V5ID09PSBlZGl0aW5nQnVkZ2V0S2V5KTsKICAgIGlmIChpZHggPj0gMCkgewogICAgICBnb2Fsc1tpZHhdID0gey4uLmdvYWxzW2lkeF0sIG5hbWUsIGFtb3VudCwgaWNvbjogcGlja2VkQnVkZ2V0RW1vamksIGxpbmtlZENhdHN9OwogICAgfQogIH0gZWxzZSB7CiAgICBnb2Fscy5wdXNoKHtrZXksIG5hbWUsIGljb246IHBpY2tlZEJ1ZGdldEVtb2ppLCBhbW91bnQsIGxpbmtlZENhdHN9KTsKICB9CgogIGNvbnN0IHN0b3JhZ2VLZXkgPSB0eXBlID09PSAnc2F2aW5ncycgPyAnX3NhdmluZ3NHb2FscycgOiAnX2V4cGVuc2VHb2Fscyc7CiAgZGF0YVtzdG9yYWdlS2V5XSA9IGdvYWxzOwogIHNhdmUoKTsKICBjbG9zZUVkaXRCdWRnZXRQb3B1cCgpOwogIHJlbmRlckJ1ZGdldE1vZHVsZSgpOwogIHNob3dUb2FzdChg4pyFICIke25hbWV9IiAke2VkaXRpbmdCdWRnZXRLZXkgPyAndXBkYXRlZCcgOiAnYWRkZWQnfSFgKTsKfQoKZnVuY3Rpb24gZGVsZXRlRWRpdGVkQnVkZ2V0KCkgewogIGlmICghZWRpdGluZ0J1ZGdldEtleSkgcmV0dXJuOwogIGNvbnN0IHR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLXR5cGUnKS52YWx1ZTsKICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKHR5cGUpOwogIGNvbnN0IGdvYWwgPSBnb2Fscy5maW5kKGcgPT4gZy5rZXkgPT09IGVkaXRpbmdCdWRnZXRLZXkpOwogIGlmICghZ29hbCkgcmV0dXJuOwogIGlmICghY29uZmlybShgRGVsZXRlICIke2dvYWwubmFtZX0iP2ApKSByZXR1cm47CiAgY29uc3Qgc3RvcmFnZUtleSA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdfc2F2aW5nc0dvYWxzJyA6ICdfZXhwZW5zZUdvYWxzJzsKICBkYXRhW3N0b3JhZ2VLZXldID0gZ29hbHMuZmlsdGVyKGcgPT4gZy5rZXkgIT09IGVkaXRpbmdCdWRnZXRLZXkpOwogIHNhdmUoKTsKICBjbG9zZUVkaXRCdWRnZXRQb3B1cCgpOwogIGNsb3NlQnVkZ2V0Q2F0RGV0YWlsKHR5cGUpOwogIHJlbmRlckJ1ZGdldE1vZHVsZSgpOwogIHNob3dUb2FzdChg8J+Xke+4jyAiJHtnb2FsLm5hbWV9IiByZW1vdmVkYCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBGQUIgU01BUlQgTEFVTkNIRVIKLy8g','4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBmYWJPcGVuID0gZmFsc2U7CgpmdW5jdGlvbiB0b2dnbGVGYWJNZW51KCkgewogIGZhYk9wZW4gPyBjbG9zZUZhYk1lbnUoKSA6IG9wZW5GYWJNZW51KCk7Cn0KCmZ1bmN0aW9uIG9wZW5GYWJNZW51KCkgewogIGZhYk9wZW4gPSB0cnVlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYWRkLWJ0bicpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLWJhY2tkcm9wJykuY2xhc3NMaXN0LmFkZCgnb3BlbicpOwogIC8vIFN0YWdnZXIgaXRlbXMgaW4gcmV2ZXJzZSBzbyBib3R0b20gaXRlbSBhcHBlYXJzIGZpcnN0CiAgWydmbWktZXhwZW5zZScsJ2ZtaS1pbmNvbWUnLCdmbWktaW52ZXN0bWVudCddLmZvckVhY2goKGlkLCBpKSA9PiB7CiAgICBzZXRUaW1lb3V0KCgpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyksIGkgKiA0MCk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGNsb3NlRmFiTWVudSgpIHsKICBmYWJPcGVuID0gZmFsc2U7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1hZGQtYnRuJykuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYmFja2Ryb3AnKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZhYi1tZW51LWl0ZW0nKS5mb3JFYWNoKGVsID0+IGVsLmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKSk7Cn0KCi8vIENsb3NlIEZBQiB3aGVuIFF1aWNrIEFkZCBvcGVucwpjb25zdCBfb3JpZ09wZW5RdWlja0FkZCA9IG9wZW5RdWlja0FkZDsKLy8gKGNsb3NlRmFiTWVudSBpcyBjYWxsZWQgaW5saW5lIG9uIGVhY2ggbWVudSBidXR0b24gY2xpY2sg4oCUIG5vIHdyYXAgbmVlZGVkKQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIE5FVCBXT1JUSCBNT0RVTEUg4oCUIEFjY291bnQtYmFzZWQgc3lzdGVtCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoKY29uc3QgTldfVFlQRVMgPSB7CiAgY2hlY2tpbmc6ICAgICAgICB7IGxhYmVsOidDaGVja2luZyBBY2NvdW50JywgICAgICAgZW1vamk6J/Cfj6YnLCBjb2xvcjonIzRBOUVGRicsICAgaXNMaWFiOmZhbHNlIH0sCiAgc2F2aW5nc19hY2M6ICAgICB7IGxhYmVsOidTYXZpbmdzIEFjY291bnQnLCAgICAgICAgZW1vamk6J/CfkrUnLCBjb2xvcjonIzEwQjk4MScsICAgaXNMaWFiOmZhbHNlIH0sCiAgYnJva2VyYWdlOiAgICAgICB7IGxhYmVsOidCcm9rZXJhZ2UgLyBJbnZlc3RtZW50JywgZW1vamk6J/Cfk4gnLCBjb2xvcjonIzdDM0FFRCcsICAgaXNMaWFiOmZhbHNlIH0sCiAgcmV0aXJlbWVudDogICAgICB7IGxhYmVsOidSZXRpcmVtZW50IEFjY291bnQnLCAgICAgZW1vamk6J/Cfj5vvuI8nLCBjb2xvcjonI0Y1OUUwQicsICAgaXNMaWFiOmZhbHNlIH0sCiAgYm9uZHNfZmQ6ICAgICAgICB7IGxhYmVsOidCb25kIC8gRkQgLyBDRCcsICAgICAgICAgZW1vamk6J/Cfk4snLCBjb2xvcjonIzA2QjZENCcsICAgaXNMaWFiOmZhbHNlIH0sCiAgbWV0YWxzOiAgICAgICAgICB7IGxhYmVsOidQcmVjaW91cyBNZXRhbHMnLCAgICAgICAgZW1vamk6J/CfpYcnLCBjb2xvcjonI0M4OTAwQScsICAgaXNMaWFiOmZhbHNlIH0sCiAgcmVhbGVzdGF0ZTogICAgICB7IGxhYmVsOidSZWFsIEVzdGF0ZScsICAgICAgICAgICAgZW1vamk6J/Cfj6EnLCBjb2xvcjonIzEwQjk4MScsICAgaXNMaWFiOmZhbHNlIH0sCiAgY2FzaDogICAgICAgICAgICB7IGxhYmVsOidDYXNoIC8gV2FsbGV0JywgICAgICAgICAgZW1vamk6J/CfkrQnLCBjb2xvcjonIzg0Q0MxNicsICAgaXNMaWFiOmZhbHNlIH0sCiAgY3JlZGl0X2NhcmQ6ICAgICB7IGxhYmVsOidDcmVkaXQgQ2FyZCcsICAgICAgICAgICAgZW1vamk6J/CfkrMnLCBjb2xvcjonI0VGNDQ0NCcsICAgaXNMaWFiOnRydWUgIH0sCiAgbG9hbjogICAgICAgICAgICB7IGxhYmVsOidMb2FuIC8gTW9ydGdhZ2UnLCAgICAgICAgZW1vamk6J/Cfj6AnLCBjb2xvcjonI0Y5NzMxNicsICAgaXNMaWFiOnRydWUgIH0sCiAgb3RoZXJfbGlhYmlsaXR5OiB7IGxhYmVsOidPdGhlciBMaWFiaWxpdHknLCAgICAgICAgZW1vamk6J/Cfk4knLCBjb2xvcjonIzhCNUNGNicsICAgaXNMaWFiOnRydWUgIH0sCn07Cgpjb25zdCBSRVRJUkVfU1VCVFlQRVMgPSBbJzQwMWsnLCc0MDNiJywnSVJBJywnUm90aCBJUkEnLCdQUEYnLCdFUEYnLCdOUFMnLCdPdGhlciddOwoKZnVuY3Rpb24gZ2V0TldBY2NvdW50cygpIHsKICBpZiAoIWRhdGEuX253QWNjb3VudHMpIGRhdGEuX253QWNjb3VudHMgPSBbXTsKICByZXR1cm4gZGF0YS5fbndBY2NvdW50czsKfQoKZnVuY3Rpb24gZ2V0TldTbmFwc2hvdHMoKSB7CiAgaWYgKCFkYXRhLl9ud1NuYXBzaG90cykgZGF0YS5fbndTbmFwc2hvdHMgPSBbXTsKICByZXR1cm4gZGF0YS5fbndTbmFwc2hvdHM7Cn0KCmZ1bmN0aW9uIGdldFJlYWxFc3RhdGVBc3NldHMoKSB7CiAgaWYgKCFkYXRhLl9yZWFsRXN0YXRlKSBkYXRhLl9yZWFsRXN0YXRlID0gW107CiAgcmV0dXJuIGRhdGEuX3JlYWxFc3RhdGU7Cn0KCmNvbnN0IElOUl9UT19VU0QgPSAwLjAxMjsKCi8vIOKUgOKUgCBDb252ZXJ0IGFjY291bnQgYmFsYW5jZSB0byBkaXNwbGF5IGN1cnJlbmN5IOKUgOKUgApmdW5jdGlvbiBud0NvbnZlcnQoYmFsYW5jZSwgY3VycmVuY3kpIHsKICBjb25zdCBiID0gTnVtYmVyKGJhbGFuY2UgfHwgMCk7CiAgY29uc3QgYyA9IChjdXJyZW5jeSB8fCBjdXJyZW50Q3VycmVuY3kuY29kZSkudG9VcHBlckNhc2UoKTsKICBpZiAoYyA9PT0gY3VycmVudEN1cnJlbmN5LmNvZGUpIHJldHVybiBiOwogIC8vIFVzZSBleGlzdGluZyBjb252ZXJ0QW10IGhlbHBlciB2aWEgYSBmYWtlIGVudHJ5CiAgcmV0dXJuIGNvbnZlcnRBbXQoYiwgYyk7Cn0KCi8vIOKUgOKUgCBDb21wdXRlIG5ldCB3b3J0aCBmcm9tIGFjY291bnRzIOKUgOKUgApmdW5jdGlvbiBjb21wdXRlTmV0V29ydGgoKSB7CiAgY29uc3QgYWNjb3VudHMgPSBnZXROV0FjY291bnRzKCk7CiAgY29uc3QgYnlUeXBlID0ge307CiAgbGV0IHRvdGFsQXNzZXRzID0gMCwgbGlhYlRvdGFsID0gMDsKCiAgLy8gQWxzbyBwdWxsIG1ldGFscyBmcm9tIGltcG9ydCBkYXRhIGFzIHJlYWQtb25seSByZWZlcmVuY2Ug4oCUIG9uZSByb3cgcGVyIGVudHJ5CiAgY29uc3QgbWV0YWxzRnJvbUltcG9ydCA9IChkYXRhLl9tZXRhbHMgfHwgW10pLm1hcCgobSwgaWR4KSA9PiB7CiAgICBjb25zdCBtYyA9IE1FVEFMX0NPTkZJR1ttLm1ldGFsVHlwZV0gfHwgTUVUQUxfQ09ORklHWydnb2xkJ107CiAgICBjb25zdCBncmFtcyA9IE51bWJlcihtLmdyYW1zIHx8IG0ud2VpZ2h0R21zIHx8IDApOwogICAgY29uc3QgcHJpY2UgPSBOdW1iZXIobS5wcmljZSB8fCAwKSB8fCBnZXRQcmljZUZvck1ldGFsKG0ubWV0YWxUeXBlfHwnZ29sZCcsIG0ucHVyaXR5KTsKICAgIGNvbnN0IHZhbCA9IGdyYW1zICogcHJpY2U7CiAgICBjb25zdCBveiA9IChncmFtcyAvIDMxLjEwMzUpLnRvRml4ZWQoMyk7CiAgICAvLyBCdWlsZCBhIGRlc2NyaXB0aXZlIG5hbWU6ICJHb2xkIMK3IDIySyDCtyBCYW5nbGUiIG9yIGp1c3QgIkdvbGQgwrcgMTBnIgogICAgY29uc3QgbmFtZVBhcnRzID0gW21jLmVtb2ppICsgJyAnICsgKChtLm1ldGFsVHlwZXx8J2dvbGQnKS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSsobS5tZXRhbFR5cGV8fCdnb2xkJykuc2xpY2UoMSkpXTsKICAgIGlmIChtLnB1cml0eSkgICBuYW1lUGFydHMucHVzaChtLnB1cml0eSk7CiAgICBpZiAobS5vY2Nhc2lvbikgbmFtZVBhcnRzLnB1c2gobS5vY2Nhc2lvbik7CiAgICBpZiAoIW0ucHVyaXR5ICYmICFtLm9jY2FzaW9uICYmIG0ubmFtZSAmJiBtLm5hbWUgIT09IG0ubWV0YWxUeXBlKSBuYW1lUGFydHMucHVzaChtLm5hbWUpOwogICAgcmV0dXJuIHsKICAgICAgaWQ6ICdpbXBvcnRfbWV0YWxfJyArIGlkeCwKICAgICAgbmFtZTogbmFtZVBhcnRzLmpvaW4oJyDCtyAnKSwKICAgICAgYmFsYW5jZTogdmFsLAogICAgICBjdXJyZW5jeTogJ1VTRCcsCiAgICAgIGxhc3RVcGRhdGVkOiBtLmRhdGUgfHwgJycsCiAgICAgIF9pbXBvcnRlZDogdHJ1ZSwKICAgICAgdHlwZTogJ21ldGFscycsCiAgICAgIG1ldGE6IHsKICAgICAgICBncmFtcywKICAgICAgICBveiwKICAgICAgICBtZXRhbFR5cGU6IG0ubWV0YWxUeXBlLAogICAgICAgIHB1cml0eTogbS5wdXJpdHkgfHwgJycsCiAgICAgICAgb2NjYXNpb246IG0ub2NjYXNpb24gfHwgJycsCiAgICAgICAgZm9ybTogbS5mb3JtIHx8ICcnLAogICAgICAgIG5vdGVzOiBtLm5vdGVzIHx8ICcnLAogICAgICAgIG9yaWdpbmFsTmFtZTogbS5uYW1lIHx8ICcnCiAgICAgIH0KICAgIH07CiAgfSk7CgogIC8vIEFsc28gcHVsbCByZWFsIGVzdGF0ZSBmcm9tIGltcG9ydCBkYXRhIGFzIHJlYWQtb25seSByZWZlcmVuY2UKICBjb25zdCByZUZyb21JbXBvcnQgPSAoZGF0YS5fcmVhbEVzdGF0ZSB8fCBbXSkubWFwKChwLCBpZHgpID0+IHsKICAgIGNvbnN0IGN2ID0gTnVtYmVyKHAuY3VycmVudFZhbHVlIHx8IHAucHVyY2hhc2VWYWx1ZSB8fCAwKTsKICAgIGNvbnN0IGN1cnIgPSAocC5jdXJyZW5jeSB8fCAnVVNEJykudG9VcHBlckNhc2UoKTsKICAgIGNvbnN0IHZhbCA9IGN1cnIgPT09ICdJTlInID8gY3YgKiAoSU5SX1RPX1VTRHx8MC4wMTIpIDogbndDb252ZXJ0KGN2LCBjdXJyKTsKICAgIGNvbnN0IG5hbWVQYXJ0cyA9IFsn8J+PoScsIHAuZGVzY3JpcHRpb24gfHwgJ1Byb3BlcnR5J107CiAgICBpZiAocC5jb3VudHJ5ICYmIHAuY291bnRyeSAhPT0gJ1VTJykgbmFtZVBhcnRzLnB1c2gocC5jb3VudHJ5KTsKICAgIHJldHVybiB7CiAgICAgIGlkOiAnaW1wb3J0X3JlXycgKyBpZHgsCiAgICAgIG5hbWU6IG5hbWVQYXJ0cy5qb2luKCcgJyksCiAgICAgIGJhbGFuY2U6IHZhbCwKICAgICAgY3VycmVuY3k6IGN1cnIsCiAgICAgIGxhc3RVcGRhdGVkOiBwLmRhdGUgfHwgJycsCiAgICAgIF9pbXBvcnRlZDogdHJ1ZSwKICAgICAgdHlwZTogJ3JlYWxlc3RhdGUnLAogICAgICBtZXRhOiB7CiAgICAgICAgcHVyY2hhc2VWYWx1ZTogcC5wdXJjaGFzZVZhbHVlLAogICAgICAgIGNvdW50cnk6IHAuY291bnRyeSwKICAgICAgICBhcmVhOiBwLmFyZWEsCiAgICAgICAgZGVzY3JpcHRpb246IHAuZGVzY3JpcHRpb24KICAgICAgfQogICAgfTsKICB9KTsKCiAgY29uc3QgYWxsQWNjb3VudHMgPSBbLi4uYWNjb3VudHMsIC4uLm1ldGFsc0Zyb21JbXBvcnQsIC4uLnJlRnJvbUltcG9ydF07CgogIE9iamVjdC5rZXlzKE5XX1RZUEVTKS5mb3JFYWNoKHQgPT4geyBieVR5cGVbdF0gPSB7IHRvdGFsOiAwLCBhY2NvdW50czogW10gfTsgfSk7CgogIGFsbEFjY291bnRzLmZvckVhY2goYWNjID0+IHsKICAgIGNvbnN0IHQgPSBhY2MudHlwZTsKICAgIGlmICghYnlUeXBlW3RdKSByZXR1cm47CiAgICBsZXQgdmFsID0gbndDb252ZXJ0KGFjYy5iYWxhbmNlLCBhY2MuY3VycmVuY3kpOwogICAgLy8gRm9yIG1ldGFscyB0eXBlLCBhdXRvLWNhbGMgZnJvbSBncmFtcyB1c2luZyBwdXJp','dHktYXdhcmUgcHJpY2luZwogICAgaWYgKHQgPT09ICdtZXRhbHMnICYmIGFjYy5tZXRhICYmIGFjYy5tZXRhLmdyYW1zKSB7CiAgICAgIGNvbnN0IG1ldGFsVHlwZSA9IGFjYy5tZXRhLm1ldGFsVHlwZSB8fCAnZ29sZCc7CiAgICAgIGNvbnN0IHB1cml0eSAgICA9IGFjYy5tZXRhLnB1cml0eSB8fCAnJzsKICAgICAgY29uc3QgY2FsY1ByaWNlID0gZ2V0UHJpY2VGb3JNZXRhbChtZXRhbFR5cGUsIHB1cml0eSk7CiAgICAgIGNvbnN0IGNhbGNWYWwgICA9IE51bWJlcihhY2MubWV0YS5ncmFtcykgKiBjYWxjUHJpY2U7CiAgICAgIC8vIFVzZSBjYWxjdWxhdGVkIHZhbHVlIGlmIG5vIGV4cGxpY2l0IGJhbGFuY2UsIG9yIGlmIGV4cGxpY2l0IGJhbGFuY2UgaXMgMAogICAgICBpZiAoIU51bWJlcihhY2MuYmFsYW5jZSkgfHwgYWNjLl9pbXBvcnRlZCkgdmFsID0gY2FsY1ZhbDsKICAgICAgZWxzZSB2YWwgPSBNYXRoLm1heChOdW1iZXIoYWNjLmJhbGFuY2UpIHx8IDAsIGNhbGNWYWwpOyAvLyB0YWtlIHRoZSBzdG9yZWQgYmFsYW5jZSBpZiBleHBsaWNpdGx5IHNldCBhbmQgPiAwCiAgICB9CiAgICBieVR5cGVbdF0udG90YWwgKz0gdmFsOwogICAgYnlUeXBlW3RdLmFjY291bnRzLnB1c2goeyAuLi5hY2MsIF92YWw6IHZhbCB9KTsKICAgIGlmIChOV19UWVBFU1t0XS5pc0xpYWIpIGxpYWJUb3RhbCArPSB2YWw7CiAgICBlbHNlIHRvdGFsQXNzZXRzICs9IHZhbDsKICB9KTsKCiAgY29uc3QgbmV0V29ydGggPSB0b3RhbEFzc2V0cyAtIGxpYWJUb3RhbDsKICBjb25zdCBkZWJ0UmF0aW8gPSB0b3RhbEFzc2V0cyA+IDAgPyBsaWFiVG90YWwgLyB0b3RhbEFzc2V0cyA6IDA7CiAgcmV0dXJuIHsgbmV0V29ydGgsIHRvdGFsQXNzZXRzLCBsaWFiVG90YWwsIGRlYnRSYXRpbywgYnlUeXBlIH07Cn0KCi8vIOKUgOKUgCBSZW5kZXIgTmV0IFdvcnRoIOKUgOKUgAoKZnVuY3Rpb24gYnVpbGROV01ldGFsc0JvZHkoYWNjb3VudHMsIGNmZywgYWRkQnRuTGFiZWwpIHsKICAvLyBHcm91cCBieSBtZXRhbFR5cGUgZmlyc3QsIHRoZW4gYnkgcHVyaXR5IHdpdGhpbiBlYWNoIHR5cGUKICBjb25zdCBNRVRBTF9PUkRFUiA9IFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJ107CiAgY29uc3QgTUVUQUxfTEFCRUxTID0geyBnb2xkOifwn6WHIEdvbGQnLCBzaWx2ZXI6J/CfpYggU2lsdmVyJywgcGxhdGludW06J/CflJggUGxhdGludW0nIH07CgogIC8vIEJ1Y2tldCBhY2NvdW50cwogIGNvbnN0IGJ5TWV0YWwgPSB7fTsKICBNRVRBTF9PUkRFUi5mb3JFYWNoKG10ID0+IHsgYnlNZXRhbFttdF0gPSBbXTsgfSk7CiAgYWNjb3VudHMuZm9yRWFjaChhY2MgPT4gewogICAgY29uc3QgbXQgPSAoYWNjLm1ldGEgJiYgYWNjLm1ldGEubWV0YWxUeXBlKSB8fCAnZ29sZCc7CiAgICBpZiAoIWJ5TWV0YWxbbXRdKSBieU1ldGFsW210XSA9IFtdOwogICAgYnlNZXRhbFttdF0ucHVzaChhY2MpOwogIH0pOwoKICBsZXQgaHRtbCA9ICcnOwoKICBNRVRBTF9PUkRFUi5mb3JFYWNoKG10ID0+IHsKICAgIGNvbnN0IGl0ZW1zID0gYnlNZXRhbFttdF07CiAgICBpZiAoIWl0ZW1zLmxlbmd0aCkgcmV0dXJuOwoKICAgIGNvbnN0IG1ldGFsVG90YWwgPSBpdGVtcy5yZWR1Y2UoKHMsIGEpID0+IHMgKyAoYS5fdmFsIHx8IDApLCAwKTsKICAgIGNvbnN0IG1ldGFsR3JhbXMgPSBpdGVtcy5yZWR1Y2UoKHMsIGEpID0+IHMgKyBOdW1iZXIoKGEubWV0YSAmJiBhLm1ldGEuZ3JhbXMpIHx8IDApLCAwKTsKCiAgICAvLyBNZXRhbCB0eXBlIGhlYWRlciByb3cKICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzoxMHB4IDAgNHB4O2JvcmRlci1ib3R0b206MnB4IHNvbGlkICNGMEYwRjA7Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjk1ZW07Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTsiPiR7TUVUQUxfTEFCRUxTW210XSB8fCBtdH08L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45NWVtO2NvbG9yOiR7Y2ZnLmNvbG9yfTsiPiR7Zm10KG1ldGFsVG90YWwpfTwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjcyZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+JHttZXRhbEdyYW1zLnRvRml4ZWQoMil9ZyDCtyAkeyhtZXRhbEdyYW1zLzMxLjEwMzUpLnRvRml4ZWQoMyl9IG96PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YDsKCiAgICAvLyBHcm91cCBieSBwdXJpdHkgd2l0aGluIHRoaXMgbWV0YWwgdHlwZQogICAgY29uc3QgYnlQdXJpdHkgPSB7fTsKICAgIGl0ZW1zLmZvckVhY2goYWNjID0+IHsKICAgICAgY29uc3QgcHVyaXR5ID0gKGFjYy5tZXRhICYmIGFjYy5tZXRhLnB1cml0eSkgfHwgJ090aGVyJzsKICAgICAgaWYgKCFieVB1cml0eVtwdXJpdHldKSBieVB1cml0eVtwdXJpdHldID0gW107CiAgICAgIGJ5UHVyaXR5W3B1cml0eV0ucHVzaChhY2MpOwogICAgfSk7CgogICAgT2JqZWN0LmtleXMoYnlQdXJpdHkpLmZvckVhY2gocHVyaXR5ID0+IHsKICAgICAgY29uc3QgcEl0ZW1zID0gYnlQdXJpdHlbcHVyaXR5XTsKICAgICAgY29uc3QgcFRvdGFsICA9IHBJdGVtcy5yZWR1Y2UoKHMsIGEpID0+IHMgKyAoYS5fdmFsIHx8IDApLCAwKTsKICAgICAgY29uc3QgcEdyYW1zICA9IHBJdGVtcy5yZWR1Y2UoKHMsIGEpID0+IHMgKyBOdW1iZXIoKGEubWV0YSAmJiBhLm1ldGEuZ3JhbXMpIHx8IDApLCAwKTsKICAgICAgY29uc3QgcE96ICAgICA9IChwR3JhbXMgLyAzMS4xMDM1KS50b0ZpeGVkKDMpOwoKICAgICAgLy8gUHVyaXR5IHN1Ymdyb3VwIGhlYWRlciDigJQgY29sbGFwc2libGUKICAgICAgY29uc3QgcENvbGxhcHNlSWQgPSBgbnctbWV0YWwtZ3JwLSR7bXR9LSR7cHVyaXR5LnJlcGxhY2UoL1xzKy9nLCcnKX1gOwogICAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6N3B4IDAgNHB4IDEycHg7Ym9yZGVyLWJvdHRvbToxcHggZGFzaGVkICNFRUVFRUU7Y3Vyc29yOnBvaW50ZXI7IiBvbmNsaWNrPSJ0b2dnbGVOV01ldGFsR3JvdXAoJyR7cENvbGxhcHNlSWR9JykiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MC44MmVtO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPgogICAgICAgICAgPHNwYW4gaWQ9IiR7cENvbGxhcHNlSWR9LWNoZXYiIHN0eWxlPSJkaXNwbGF5OmlubGluZS1ibG9jazt0cmFuc2l0aW9uOnRyYW5zZm9ybSAwLjJzO21hcmdpbi1yaWdodDo0cHg7Ij7ilr48L3NwYW4+JHtwdXJpdHl9CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsiPgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y29sb3I6JHtjZmcuY29sb3J9OyI+JHtmbXQocFRvdGFsKX08L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo3MDA7Ij4ke3BHcmFtcy50b0ZpeGVkKDIpfWcgwrcgJHtwT3p9IG96PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PmA7CiAgICAgIGh0bWwgKz0gYDxkaXYgaWQ9IiR7cENvbGxhcHNlSWR9IiBjbGFzcz0ibnctbWV0YWwtZ3JwLWJvZHkiPmA7CgogICAgICAvLyBJbmRpdmlkdWFsIGl0ZW1zCiAgICAgIHBJdGVtcy5mb3JFYWNoKGFjYyA9PiB7CiAgICAgICAgY29uc3QgZyA9IE51bWJlcigoYWNjLm1ldGEgJiYgYWNjLm1ldGEuZ3JhbXMpIHx8IDApOwogICAgICAgIGNvbnN0IG96ID0gKGcgLyAzMS4xMDM1KS50b0ZpeGVkKDMpOwogICAgICAgIC8vIE5hbWU6IG9jY2FzaW9uIMK3IGl0ZW0gbmFtZSAoc3RyaXAgcmVkdW5kYW50IG1ldGFsK3B1cml0eSBwcmVmaXggZnJvbSBkaXNwbGF5IG5hbWUpCiAgICAgICAgY29uc3Qgb2NjYXNpb24gPSAoYWNjLm1ldGEgJiYgYWNjLm1ldGEub2NjYXNpb24pIHx8ICcnOwogICAgICAgIGNvbnN0IG9yaWdpbmFsTmFtZSA9IChhY2MubWV0YSAmJiBhY2MubWV0YS5vcmlnaW5hbE5hbWUpIHx8ICcnOwogICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gb2NjYXNpb24KICAgICAgICAgID8gKG9yaWdpbmFsTmFtZSAmJiBvcmlnaW5hbE5hbWUudG9Mb3dlckNhc2UoKSAhPT0gbXQgPyBvY2Nhc2lvbiArICcgwrcgJyArIG9yaWdpbmFsTmFtZSA6IG9jY2FzaW9uKQogICAgICAgICAgOiAob3JpZ2luYWxOYW1lICYmIG9yaWdpbmFsTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBtdCA/IG9yaWdpbmFsTmFtZSA6IGFjYy5uYW1lKTsKICAgICAgICBjb25zdCBkYXRlU3RyID0gYWNjLmxhc3RVcGRhdGVkID8gbmV3IERhdGUoYWNjLmxhc3RVcGRhdGVkKydUMDA6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnLHllYXI6JzItZGlnaXQnfSkgOiAnJzsKICAgICAgICBjb25zdCBlZGl0QnRuID0gYWNjLl9pbXBvcnRlZCA/ICcnIDogYDxidXR0b24gY2xhc3M9Im53LWFjY291bnQtYnRuIiBvbmNsaWNrPSJvcGVuTldTaGVldCgnbWV0YWxzJywnJHthY2MuaWR9JykiPuKcj++4jzwvYnV0dG9uPjxidXR0b24gY2xhc3M9Im53LWFjY291bnQtYnRuIGRlbCIgb25jbGljaz0iZGVsZXRlTldBY2NvdW50KCcke2FjYy5pZH0nKSI+4pyVPC9idXR0b24+YDsKCiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1yb3ciIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MjRweDsiPgogICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1sZWZ0Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1uYW1lIiBzdHlsZT0iZm9udC1zaXplOjAuODdlbTsiPiR7ZGlzcGxheU5hbWUgfHwgJ+KAlCd9PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtbWV0YSI+JHtnLnRvRml4ZWQoMil9ZyDCtyAke296fSBveiR7ZGF0ZVN0cj8nIMK3ICcrZGF0ZVN0cjonJ30ke2FjYy5faW1wb3J0ZWQ/JyDCtyDwn5OlJzonJ308L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1yaWdodCI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC12YWwiIHN0eWxlPSJjb2xvcjoke2NmZy5jb2xvcn07Zm9udC1zaXplOjAuOWVtOyI+JHtmbXQoYWNjLl92YWwpfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1hY3Rpb25zIj4ke2VkaXRCdG59PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj5gOwogICAgICB9KTsKICAgICAgaHRtbCArPSBgPC9kaXY+YDsgLy8gY2xvc2UgbnctbWV0YWwtZ3JwLWJvZHkKICAgIH0pOwogIH0pO2A8ZGl2IHN0eWxlPSJwYWRkaW5nLXRvcDo4cHg7Ij48YnV0dG9uIGNsYXNzPSJudy1zZWN0aW9uLWFkZCIgb25jbGljaz0ib3Blbk5XU2hlZXQoJ21ldGFscycpIj4ke2FkZEJ0bkxhYmVsfTwvYnV0dG9uPjwvZGl2PmA7CiAgcmV0dXJuIGh0bWw7Cn0KCmZ1bmN0aW9uIHJlbmRlck5ldFdvcnRoKCkgewogIGNvbnN0IG53ID0gY29tcHV0ZU5ldFdvcnRoKCk7CgogIC8vIOKUgOKUgCBIZXJvIOKUgOKUgAogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy10b3RhbCcpLnRleHRDb250ZW50ID0gZm10KG53Lm5ldFdvcnRoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdG90YWwnKS5zdHlsZS5jb2xvciA9IG53Lm5ldFdvcnRoIDwgMCA/ICcjRkY2QjZCJyA6ICd3aGl0ZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWFzc2V0cy1oZXJvJykudGV4dENvbnRlbnQgPSBmbXQobncudG90YWxB','c3NldHMpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1saWFiLWhlcm8nKS50ZXh0Q29udGVudCAgID0gZm10KG53LmxpYWJUb3RhbCk7CiAgY29uc3QgZHJQY3QgPSAobncuZGVidFJhdGlvICogMTAwKS50b0ZpeGVkKDEpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1kZWJ0LXJhdGlvJykudGV4dENvbnRlbnQgPSBkclBjdCArICclJzsKICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1kZWJ0LWJhZGdlJyk7CiAgaWYgKG53LmRlYnRSYXRpbyA8IDAuMikgICAgICB7IGJhZGdlLnRleHRDb250ZW50ID0gJ+KXjyBIZWFsdGh5JzsgIGJhZGdlLnN0eWxlLmJhY2tncm91bmQgPSAnIzEwQjk4MTMwJzsgYmFkZ2Uuc3R5bGUuY29sb3IgPSAnIzEwQjk4MSc7IH0KICBlbHNlIGlmIChudy5kZWJ0UmF0aW8gPCAwLjQpIHsgYmFkZ2UudGV4dENvbnRlbnQgPSAn4pePIE1vZGVyYXRlJzsgYmFkZ2Uuc3R5bGUuYmFja2dyb3VuZCA9ICcjRjU5RTBCMzAnOyBiYWRnZS5zdHlsZS5jb2xvciA9ICcjRjU5RTBCJzsgfQogIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgIHsgYmFkZ2UudGV4dENvbnRlbnQgPSAn4pePIEhpZ2gnOyAgICAgYmFkZ2Uuc3R5bGUuYmFja2dyb3VuZCA9ICcjRUY0NDQ0MzAnOyBiYWRnZS5zdHlsZS5jb2xvciA9ICcjRUY0NDQ0JzsgfQoKICAvLyBDaGFuZ2Ugc2luY2UgRklSU1Qgc25hcHNob3QKICBjb25zdCBzbmFwcyA9IGdldE5XU25hcHNob3RzKCk7CiAgY29uc3QgY2hhbmdlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctY2hhbmdlJyk7CiAgaWYgKHNuYXBzLmxlbmd0aCA+PSAxKSB7CiAgICBjb25zdCBmaXJzdCA9IHNuYXBzWzBdLnZhbHVlOwogICAgY29uc3QgZGlmZiAgPSBudy5uZXRXb3J0aCAtIGZpcnN0OwogICAgY29uc3QgcGN0ICAgPSBmaXJzdCAhPT0gMCA/IChkaWZmIC8gTWF0aC5hYnMoZmlyc3QpICogMTAwKS50b0ZpeGVkKDEpIDogMDsKICAgIGNvbnN0IGNvbG9yID0gZGlmZiA+PSAwID8gJyM4NkVGQUMnIDogJyNGQ0E1QTUnOwogICAgY29uc3QgYXJyb3cgPSBkaWZmID49IDAgPyAn4payJyA6ICfilrwnOwogICAgY2hhbmdlRWwuaW5uZXJIVE1MID0gYDxzcGFuIHN0eWxlPSJjb2xvcjoke2NvbG9yfTsiPiR7YXJyb3d9ICR7Zm10KE1hdGguYWJzKGRpZmYpKX0gKCR7cGN0fSUpPC9zcGFuPiA8c3BhbiBzdHlsZT0ib3BhY2l0eTowLjY7Zm9udC1zaXplOjAuOWVtOyI+c2luY2UgZmlyc3Qgc25hcHNob3Q8L3NwYW4+YDsKICB9IGVsc2UgewogICAgY2hhbmdlRWwuaW5uZXJIVE1MID0gYDxzcGFuIHN0eWxlPSJvcGFjaXR5OjAuNjtmb250LXNpemU6MC44OGVtOyI+U2F2ZSBhIHNuYXBzaG90IHRvIHRyYWNrIGNoYW5nZXMgb3ZlciB0aW1lPC9zcGFuPmA7CiAgfQoKICAvLyBHcm91cCB0b3RhbHMgaW4gaGVhZGVyCiAgY29uc3QgYXNzZXRzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYXNzZXRzLXRvdGFsJyk7CiAgY29uc3QgbGlhYkVsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctbGlhYi10b3RhbCcpOwogIGlmIChhc3NldHNFbCkgYXNzZXRzRWwudGV4dENvbnRlbnQgPSBmbXQobncudG90YWxBc3NldHMpOwogIGlmIChsaWFiRWwpICAgbGlhYkVsLnRleHRDb250ZW50ICAgPSBmbXQobncubGlhYlRvdGFsKTsKCiAgLy8g4pSA4pSAIEluc2lnaHRzIGNhcmRzIOKUgOKUgAogIHJlbmRlck5XSW5zaWdodHMobncpOwoKICAvLyDilIDilIAgVHJlbmQgKyBTbmFwc2hvdHMg4pSA4pSACiAgY29uc3QgY2hhcnRDYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWNoYXJ0LWNhcmQnKTsKICBjb25zdCBzbmFwQ291bnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zbmFwLWNvdW50Jyk7CiAgaWYgKHNuYXBzLmxlbmd0aCA+PSAxKSB7CiAgICBjaGFydENhcmQuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgaWYgKHNuYXBDb3VudEVsKSBzbmFwQ291bnRFbC50ZXh0Q29udGVudCA9IHNuYXBzLmxlbmd0aCArICcgU25hcHNob3QnICsgKHNuYXBzLmxlbmd0aCAhPT0gMSA/ICdzJyA6ICcnKTsKICAgIC8vIFRyZW5kIGxpbmUgY2hhcnQKICAgIGNvbnN0IGNhbnZhc0lkID0gJ253LXRyZW5kLWNoYXJ0JzsKICAgIGlmIChjaGFydHNbY2FudmFzSWRdKSB7IGNoYXJ0c1tjYW52YXNJZF0uZGVzdHJveSgpOyBkZWxldGUgY2hhcnRzW2NhbnZhc0lkXTsgfQogICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzSWQpOwogICAgaWYgKGN0eCAmJiBzbmFwcy5sZW5ndGggPj0gMikgewogICAgICBjaGFydHNbY2FudmFzSWRdID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgIHR5cGU6ICdsaW5lJywKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBsYWJlbHM6IHNuYXBzLm1hcChzID0+IHsKICAgICAgICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHMuZGF0ZSsnVDAwOjAwOjAwJyk7CiAgICAgICAgICAgIHJldHVybiBkLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYyd9KTsKICAgICAgICAgIH0pLAogICAgICAgICAgZGF0YXNldHM6IFt7CiAgICAgICAgICAgIGRhdGE6IHNuYXBzLm1hcChzID0+IHMudmFsdWUpLAogICAgICAgICAgICBib3JkZXJDb2xvcjogJyNDODkwMEEnLAogICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDI0NSwyMDAsNjYsMC4xMiknLAogICAgICAgICAgICBib3JkZXJXaWR0aDogMi41LAogICAgICAgICAgICBwb2ludFJhZGl1czogNSwKICAgICAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6ICcjRjVDODQyJywKICAgICAgICAgICAgcG9pbnRCb3JkZXJDb2xvcjogJ3doaXRlJywKICAgICAgICAgICAgcG9pbnRCb3JkZXJXaWR0aDogMiwKICAgICAgICAgICAgZmlsbDogdHJ1ZSwKICAgICAgICAgICAgdGVuc2lvbjogMC4zNQogICAgICAgICAgfV0KICAgICAgICB9LAogICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLAogICAgICAgICAgcGx1Z2luczogeyBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdG9vbHRpcDogeyBjYWxsYmFja3M6IHsgbGFiZWw6IGMgPT4gZm10KGMucmF3KSB9IH0gfSwKICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICB4OiB7IGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGlja3M6IHsgZm9udDogeyBzaXplOiA5LCBmYW1pbHk6J051bml0bycsIHdlaWdodDonNzAwJyB9LCBjb2xvcjonIzlBQTBCMicgfSB9LAogICAgICAgICAgICB5OiB7IGRpc3BsYXk6IGZhbHNlIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLy8gU25hcHNob3QgbGlzdCB3aXRoIHByb2dyZXNzIGJhcnMKICAgIGNvbnN0IHNuYXBMaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctc25hcHNob3RzLWxpc3QnKTsKICAgIGlmIChzbmFwTGlzdEVsKSB7CiAgICAgIGNvbnN0IG1heFZhbCA9IE1hdGgubWF4KC4uLnNuYXBzLm1hcChzID0+IHMudmFsdWUpLCAxKTsKICAgICAgc25hcExpc3RFbC5pbm5lckhUTUwgPSBzbmFwcy5tYXAoKHMsIGkpID0+IHsKICAgICAgICBjb25zdCBkID0gbmV3IERhdGUocy5kYXRlKydUMDA6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnLHllYXI6JzItZGlnaXQnfSk7CiAgICAgICAgY29uc3QgcGN0ID0gKHMudmFsdWUgLyBtYXhWYWwgKiAxMDApLnRvRml4ZWQoMCk7CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJudy1zbmFwLXJvdyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1zbmFwLWRhdGUiPiR7ZH08L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LXNuYXAtYmFyLXdyYXAiPjxkaXYgY2xhc3M9Im53LXNuYXAtYmFyLWZpbGwiIHN0eWxlPSJ3aWR0aDoke3BjdH0lOyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1zbmFwLXZhbCI+JHtmbXQocy52YWx1ZSl9PC9kaXY+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJudy1zbmFwLWRlbCIgb25jbGljaz0iZGVsZXRlTldTbmFwc2hvdCgke2l9KSIgdGl0bGU9IkRlbGV0ZSI+w5c8L2J1dHRvbj4KICAgICAgICA8L2Rpdj5gOwogICAgICB9KS5qb2luKCcnKTsKICAgIH0KICB9IGVsc2UgewogICAgY2hhcnRDYXJkLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfQoKICAvLyDilIDilIAgQXNzZXQgQWxsb2NhdGlvbiBkb251dCDilIDilIAKICByZW5kZXJOV0RvbnV0KG53KTsKCiAgLy8g4pSA4pSAIEFjY291bnQgU2VjdGlvbnMg4pSA4pSACiAgT2JqZWN0LmtleXMoTldfVFlQRVMpLmZvckVhY2godCA9PiB7CiAgICBjb25zdCBjZmcgICAgPSBOV19UWVBFU1t0XTsKICAgIGNvbnN0IGdyb3VwICA9IG53LmJ5VHlwZVt0XTsKICAgIGNvbnN0IHZhbEVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy12YWwtJyt0KTsKICAgIGNvbnN0IHN1YkVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zdWItJyt0KTsKICAgIGNvbnN0IGJvZHlFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1ib2R5LScrdCk7CiAgICBpZiAoIXZhbEVsIHx8ICFib2R5RWwpIHJldHVybjsKCiAgICB2YWxFbC50ZXh0Q29udGVudCA9IGZtdChncm91cC50b3RhbCk7CiAgICBjb25zdCBjbnQgPSBncm91cC5hY2NvdW50cy5sZW5ndGg7CiAgICBpZiAoc3ViRWwpIHsKICAgICAgaWYgKGNudCA9PT0gMCkgc3ViRWwudGV4dENvbnRlbnQgPSAnTm8gYWNjb3VudHMgeWV0JzsKICAgICAgZWxzZSBzdWJFbC50ZXh0Q29udGVudCA9IGNudCArICcgYWNjb3VudCcgKyAoY250ICE9PSAxID8gJ3MnIDogJycpOwogICAgfQoKICAgIGNvbnN0IGFkZEJ0bkxhYmVsID0gdCA9PT0gJ21ldGFscycgPyAnKyBBZGQgRW50cnknIDogdCA9PT0gJ3JlYWxlc3RhdGUnID8gJysgQWRkIFByb3BlcnR5JyA6IHQgPT09ICdjcmVkaXRfY2FyZCcgPyAnKyBBZGQgQ2FyZCcgOiB0ID09PSAnbG9hbicgPyAnKyBBZGQgTG9hbicgOiAnKyBBZGQgQWNjb3VudCc7CgogICAgaWYgKGNudCA9PT0gMCkgewogICAgICBib2R5RWwuaW5uZXJIVE1MID0gYDxidXR0b24gY2xhc3M9Im53LXNlY3Rpb24tYWRkIiBvbmNsaWNrPSJvcGVuTldTaGVldCgnJHt0fScpIiBzdHlsZT0ibWFyZ2luLXRvcDo4cHg7Ij4ke2FkZEJ0bkxhYmVsfTwvYnV0dG9uPmA7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBzZWN0aW9uVG90YWwgPSBncm91cC50b3RhbDsKCiAgICBpZiAodCA9PT0gJ21ldGFscycpIHsKICAgICAgLy8g4pSA4pSAIEdyb3VwZWQgaGllcmFyY2h5OiBNZXRhbCBUeXBlIOKGkiBQdXJpdHkg4oaSIEl0ZW1zIOKUgOKUgAogICAgICBib2R5RWwuaW5uZXJIVE1MID0gYnVpbGROV01ldGFsc0JvZHkoZ3JvdXAuYWNjb3VudHMsIGNmZywgYWRkQnRuTGFiZWwpOwogICAgfSBlbHNlIHsKICAgICAgYm9keUVsLmlubmVySFRNTCA9IGdyb3VwLmFjY291bnRzLm1hcChhY2MgPT4gewogICAgICAgIGNvbnN0IHBjdCAgICAgPSBzZWN0aW9uVG90YWwgPiAwID8gTWF0aC5taW4oYWNjLl92YWwgLyBzZWN0aW9uVG90YWwsIDEpIDogMDsKICAgICAgICBjb25zdCBkYXRlU3RyID0gYWNjLmxhc3RVcGRhdGVkID8gbmV3IERhdGUoYWNjLmxhc3RVcGRhdGVkKydUMDA6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnfSkgOiAnJzsKICAgICAgICBjb25zdCBtZXRhTGluZSA9IGJ1aWxkQWNjb3VudE1ldGFMaW5lKGFjYyk7CiAgICAgICAgY29uc3QgaXNMaWFiICAgPSBjZmcuaXNMaWFiOwogICAgICAgIGNvbnN0IHZhbENvbG9yID0gaXNMaWFiID8gJ3ZhcigtLWV4cGVuc2VzKScgOiBjZmcuY29sb3I7CiAgICAgICAgY29uc3QgZWRpdEJ0biAgPSBhY2MuX2ltcG9ydGVkID8gJycgOiBgPGJ1dHRvbiBjbGFzcz0ibnctYWNjb3VudC1idG4iIG9uY2xpY2s9Im9wZW5OV1NoZWV0','KCcke2FjYy50eXBlfScsJyR7YWNjLmlkfScpIj7inI/vuI88L2J1dHRvbj48YnV0dG9uIGNsYXNzPSJudy1hY2NvdW50LWJ0biBkZWwiIG9uY2xpY2s9ImRlbGV0ZU5XQWNjb3VudCgnJHthY2MuaWR9JykiPuKclTwvYnV0dG9uPmA7CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXJvdyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWxlZnQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LW5hbWUiPiR7YWNjLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICR7bWV0YUxpbmUgPyBgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1tZXRhIj4ke21ldGFMaW5lfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1iYXItd3JhcCI+PGRpdiBjbGFzcz0ibnctYWNjb3VudC1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiR7KHBjdCoxMDApLnRvRml4ZWQoMCl9JTtiYWNrZ3JvdW5kOiR7Y2ZnLmNvbG9yfTsiPjwvZGl2PjwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXJpZ2h0Ij4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXZhbCIgc3R5bGU9ImNvbG9yOiR7dmFsQ29sb3J9OyI+JHtmbXQoYWNjLl92YWwpfTwvZGl2PgogICAgICAgICAgICAgICR7ZGF0ZVN0ciA/IGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXVwZGF0ZWQiPlVwZGF0ZWQgJHtkYXRlU3RyfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtYWN0aW9ucyI+JHtlZGl0QnRufTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+YDsKICAgICAgfSkuam9pbignJykgKyBgPGRpdiBzdHlsZT0icGFkZGluZy10b3A6OHB4OyI+PGJ1dHRvbiBjbGFzcz0ibnctc2VjdGlvbi1hZGQiIG9uY2xpY2s9Im9wZW5OV1NoZWV0KCcke3R9JykiPiR7YWRkQnRuTGFiZWx9PC9idXR0b24+PC9kaXY+YDsKICAgIH0KICB9KTsKCiAgLy8g4pSA4pSAIFJlbmRlciBjdXN0b20gdHlwZSBzZWN0aW9ucyAobm90IGluIHN0YXRpYyBIVE1MKSDilIDilIAKICBjb25zdCBjdXN0b21UeXBlcyA9IChkYXRhLl9ud0N1c3RvbVR5cGVzIHx8IFtdKTsKICBjb25zdCBjdXN0b21Bc3NldEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWN1c3RvbS1zZWN0aW9ucy1hc3NldHMnKTsKICBjb25zdCBjdXN0b21MaWFiRWwgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWN1c3RvbS1zZWN0aW9ucy1saWFiJyk7CiAgaWYgKGN1c3RvbUFzc2V0RWwpIGN1c3RvbUFzc2V0RWwuaW5uZXJIVE1MID0gJyc7CiAgaWYgKGN1c3RvbUxpYWJFbCkgIGN1c3RvbUxpYWJFbC5pbm5lckhUTUwgID0gJyc7CgogIGN1c3RvbVR5cGVzLmZvckVhY2goY3QgPT4gewogICAgY29uc3QgdCA9IGN0LmtleTsKICAgIGNvbnN0IGNmZyA9IE5XX1RZUEVTW3RdOwogICAgaWYgKCFjZmcpIHJldHVybjsKICAgIGNvbnN0IGdyb3VwID0gbncuYnlUeXBlW3RdIHx8IHsgdG90YWw6IDAsIGFjY291bnRzOiBbXSB9OwogICAgY29uc3QgY29udGFpbmVyID0gY2ZnLmlzTGlhYiA/IGN1c3RvbUxpYWJFbCA6IGN1c3RvbUFzc2V0RWw7CiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgIGNvbnN0IGNudCA9IGdyb3VwLmFjY291bnRzLmxlbmd0aDsKICAgIGNvbnN0IGFkZEJ0bkxhYmVsID0gJysgQWRkIEFjY291bnQnOwoKICAgIC8vIEJ1aWxkIHNlY3Rpb24gSFRNTAogICAgY29uc3Qgc2VjSWQgICAgPSAnbnctc2VjLScgKyB0OwogICAgY29uc3QgYm9keUlkICAgPSAnbnctYm9keS0nICsgdDsKICAgIGNvbnN0IHZhbElkICAgID0gJ253LXZhbC0nICsgdDsKICAgIGNvbnN0IHN1YklkICAgID0gJ253LXN1Yi0nICsgdDsKICAgIGNvbnN0IGNoZXZJZCAgID0gJ253LWNoZXYtJyArIHQ7CgogICAgLy8gQ2hlY2sgaWYgZWxlbWVudCBhbHJlYWR5IGV4aXN0cyAocmUtcmVuZGVyKQogICAgbGV0IHNlY0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VjSWQpOwogICAgaWYgKCFzZWNFbCkgewogICAgICBzZWNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBzZWNFbC5jbGFzc05hbWUgPSAnbnctc2VjdGlvbic7CiAgICAgIHNlY0VsLmlkID0gc2VjSWQ7CiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzZWNFbCk7CiAgICB9CgogICAgY29uc3QgdmFsQ29sb3IgPSBjZmcuaXNMaWFiID8gJ3ZhcigtLWV4cGVuc2VzKScgOiAoY2ZnLmNvbG9yIHx8ICcjNkI3MjgwJyk7CiAgICBjb25zdCBzZWN0aW9uVG90YWwgPSBncm91cC50b3RhbDsKCiAgICAvLyBCdWlsZCBib2R5IHJvd3MKICAgIGxldCBib2R5SFRNTCA9ICcnOwogICAgaWYgKGNudCA9PT0gMCkgewogICAgICBib2R5SFRNTCA9IGA8YnV0dG9uIGNsYXNzPSJudy1zZWN0aW9uLWFkZCIgb25jbGljaz0ib3Blbk5XU2hlZXQoJyR7dH0nKSIgc3R5bGU9Im1hcmdpbi10b3A6OHB4OyI+JHthZGRCdG5MYWJlbH08L2J1dHRvbj5gOwogICAgfSBlbHNlIHsKICAgICAgYm9keUhUTUwgPSBncm91cC5hY2NvdW50cy5tYXAoYWNjID0+IHsKICAgICAgICBjb25zdCBwY3QgICAgID0gc2VjdGlvblRvdGFsID4gMCA/IE1hdGgubWluKGFjYy5fdmFsIC8gc2VjdGlvblRvdGFsLCAxKSA6IDA7CiAgICAgICAgY29uc3QgZGF0ZVN0ciA9IGFjYy5sYXN0VXBkYXRlZCA/IG5ldyBEYXRlKGFjYy5sYXN0VXBkYXRlZCsnVDAwOjAwOjAwJykudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycse21vbnRoOidzaG9ydCcsZGF5OidudW1lcmljJ30pIDogJyc7CiAgICAgICAgY29uc3QgbWV0YUxpbmUgPSBidWlsZEFjY291bnRNZXRhTGluZShhY2MpOwogICAgICAgIGNvbnN0IGlzTGlhYiAgID0gY2ZnLmlzTGlhYjsKICAgICAgICBjb25zdCB2YWxDb2xvckFjYyA9IGlzTGlhYiA/ICd2YXIoLS1leHBlbnNlcyknIDogdmFsQ29sb3I7CiAgICAgICAgY29uc3QgZWRpdEJ0biAgPSBhY2MuX2ltcG9ydGVkID8gJycgOiBgPGJ1dHRvbiBjbGFzcz0ibnctYWNjb3VudC1idG4iIG9uY2xpY2s9Im9wZW5OV1NoZWV0KCcke2FjYy50eXBlfScsJyR7YWNjLmlkfScpIj7inI/vuI88L2J1dHRvbj48YnV0dG9uIGNsYXNzPSJudy1hY2NvdW50LWJ0biBkZWwiIG9uY2xpY2s9ImRlbGV0ZU5XQWNjb3VudCgnJHthY2MuaWR9JykiPuKclTwvYnV0dG9uPmA7CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXJvdyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWxlZnQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LW5hbWUiPiR7YWNjLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICR7bWV0YUxpbmUgPyBgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1tZXRhIj4ke21ldGFMaW5lfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1iYXItd3JhcCI+PGRpdiBjbGFzcz0ibnctYWNjb3VudC1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiR7KHBjdCoxMDApLnRvRml4ZWQoMCl9JTtiYWNrZ3JvdW5kOiR7dmFsQ29sb3J9OyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtcmlnaHQiPgogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtdmFsIiBzdHlsZT0iY29sb3I6JHt2YWxDb2xvckFjY307Ij4ke2ZtdChhY2MuX3ZhbCl9PC9kaXY+CiAgICAgICAgICAgICAgJHtkYXRlU3RyID8gYDxkaXYgY2xhc3M9Im53LWFjY291bnQtdXBkYXRlZCI+VXBkYXRlZCAke2RhdGVTdHJ9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1hY3Rpb25zIj4ke2VkaXRCdG59PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj5gOwogICAgICB9KS5qb2luKCcnKSArIGA8ZGl2IHN0eWxlPSJwYWRkaW5nLXRvcDo4cHg7Ij48YnV0dG9uIGNsYXNzPSJudy1zZWN0aW9uLWFkZCIgb25jbGljaz0ib3Blbk5XU2hlZXQoJyR7dH0nKSI+JHthZGRCdG5MYWJlbH08L2J1dHRvbj48L2Rpdj5gOwogICAgfQoKICAgIHNlY0VsLmlubmVySFRNTCA9IGAKICAgICAgPGRpdiBjbGFzcz0ibnctc2VjdGlvbi1oZWFkZXIiIG9uY2xpY2s9InRvZ2dsZU5XU2VjdGlvbignJHt0fScpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLWxlZnQiPgogICAgICAgICAgPGRpdiBjbGFzcz0ibnctc2VjdGlvbi1pY29uIj4ke2NmZy5lbW9qaX08L2Rpdj4KICAgICAgICAgIDxkaXY+PGRpdiBjbGFzcz0ibnctc2VjdGlvbi1uYW1lIj4ke2NmZy5sYWJlbH08L2Rpdj48ZGl2IGNsYXNzPSJudy1zZWN0aW9uLXN1YiIgaWQ9IiR7c3ViSWR9Ij4ke2NudCA9PT0gMCA/ICdObyBhY2NvdW50cyB5ZXQnIDogY250ICsgJyBhY2NvdW50JyArIChjbnQgIT09IDEgPyAncycgOiAnJyl9PC9kaXY+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibnctc2VjdGlvbi1yaWdodCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLXZhbCIgaWQ9IiR7dmFsSWR9IiBzdHlsZT0iY29sb3I6JHt2YWxDb2xvcn07Ij4ke2ZtdChncm91cC50b3RhbCl9PC9kaXY+CiAgICAgICAgICA8c3BhbiBjbGFzcz0ibnctc2VjdGlvbi1jaGV2cm9uIiBpZD0iJHtjaGV2SWR9Ij7ilrw8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLWJvZHkiIGlkPSIke2JvZHlJZH0iPiR7Ym9keUhUTUx9PC9kaXY+YDsKICB9KTsKfQoKZnVuY3Rpb24gZGVsZXRlTldTbmFwc2hvdChpZHgpIHsKICBjb25zdCBzbmFwcyA9IGdldE5XU25hcHNob3RzKCk7CiAgaWYgKCFjb25maXJtKCdEZWxldGUgdGhpcyBzbmFwc2hvdD8nKSkgcmV0dXJuOwogIHNuYXBzLnNwbGljZShpZHgsIDEpOwogIHNhdmUoKTsKICByZW5kZXJOZXRXb3J0aCgpOwogIHNob3dUb2FzdCgnU25hcHNob3QgZGVsZXRlZCcpOwp9CgoKZnVuY3Rpb24gYnVpbGRBY2NvdW50TWV0YUxpbmUoYWNjKSB7CiAgY29uc3QgcGFydHMgPSBbXTsKICBjb25zdCBtID0gYWNjLm1ldGEgfHwge307CiAgaWYgKGFjYy50eXBlID09PSAncmV0aXJlbWVudCcgJiYgbS5zdWJ0eXBlKSBwYXJ0cy5wdXNoKG0uc3VidHlwZSk7CiAgaWYgKG0ueXRkQ29udHJpYnV0aW9uKSBwYXJ0cy5wdXNoKCdZVEQ6ICcgKyBmbXQobS55dGRDb250cmlidXRpb24pKTsKICBpZiAoYWNjLnR5cGUgPT09ICdjcmVkaXRfY2FyZCcpIHsKICAgIGlmIChtLmxpbWl0KSBwYXJ0cy5wdXNoKCdMaW1pdDogJyArIGZtdChtLmxpbWl0KSk7CiAgICBpZiAobS5hcHIpIHBhcnRzLnB1c2goJ0FQUjogJyArIG0uYXByICsgJyUnKTsKICAgIGlmIChtLmxpbWl0ICYmIGFjYy5iYWxhbmNlKSB7CiAgICAgIGNvbnN0IHV0aWwgPSBNYXRoLm1pbihOdW1iZXIoYWNjLmJhbGFuY2UpL051bWJlcihtLmxpbWl0KSoxMDAsMTAwKS50b0ZpeGVkKDApOwogICAgICBwYXJ0cy5wdXNoKCdVdGlsaXphdGlvbjogJyArIHV0aWwgKyAnJScpOwogICAgfQogIH0KICBpZiAoYWNjLnR5cGUgPT09ICdsb2FuJyAmJiBtLmludGVyZXN0UmF0ZSkgcGFydHMucHVzaCgnUmF0ZTogJyArIG0uaW50ZXJlc3RSYXRlICsgJyUnKTsKICBpZiAoYWNjLnR5cGUgPT09ICdib25kc19mZCcpIHsKICAgIGlmIChtLmludGVyZXN0UmF0ZSkgcGFydHMucHVzaCgnUmF0ZTogJyArIG0uaW50ZXJlc3RSYXRlICsgJyUnKTsKICAgIGlmIChtLm1hdHVyaXR5RGF0ZSkgcGFydHMucHVzaCgnTWF0dXJlczogJyArIG0ubWF0dXJpdHlEYXRlKTsKICB9CiAgaWYgKGFjYy50eXBlID09PSAnbWV0YWxzJyAmJiBhY2MubWV0YSkgewogICAgY29uc3QgZyA9IE51bWJlcihhY2MubWV0YS5ncmFtcyB8fCAwKTsKICAgIGlmIChnID4gMCkgewogICAgICBjb25zdCBveiA9IChnIC8gMzEuMTAzNSkudG9GaXhl','ZCgzKTsKICAgICAgcGFydHMucHVzaChnLnRvRml4ZWQoMikgKyAnZyAoJyArIG96ICsgJyBveiknKTsKICAgIH0KICAgIGlmIChhY2MubWV0YS5wdXJpdHkpICAgcGFydHMucHVzaChhY2MubWV0YS5wdXJpdHkpOwogICAgaWYgKGFjYy5tZXRhLm9jY2FzaW9uKSBwYXJ0cy5wdXNoKGFjYy5tZXRhLm9jY2FzaW9uKTsKICAgIGlmIChhY2MubWV0YS5mb3JtICYmIGFjYy5tZXRhLmZvcm0gIT09ICdKZXdlbHJ5JykgcGFydHMucHVzaChhY2MubWV0YS5mb3JtKTsKICAgIGlmIChhY2MubWV0YS5vcmlnaW5hbE5hbWUgJiYgYWNjLm1ldGEub3JpZ2luYWxOYW1lICE9PSBhY2MubWV0YS5tZXRhbFR5cGUpIHBhcnRzLnB1c2goYWNjLm1ldGEub3JpZ2luYWxOYW1lKTsKICB9CiAgaWYgKG0uYmFuaykgcGFydHMucHVzaChtLmJhbmspOwogIGlmIChtLmxhc3Q0KSBwYXJ0cy5wdXNoKCfCt8K3wrfCtycgKyBtLmxhc3Q0KTsKICBpZiAobS5ub3RlcykgcGFydHMucHVzaChtLm5vdGVzKTsKICBpZiAoYWNjLmN1cnJlbmN5ICYmIGFjYy5jdXJyZW5jeSAhPT0gY3VycmVudEN1cnJlbmN5LmNvZGUpIHBhcnRzLnB1c2goYWNjLmN1cnJlbmN5KTsKICBpZiAoYWNjLnR5cGUgPT09ICdyZWFsZXN0YXRlJyAmJiBhY2MubWV0YSkgewogICAgaWYgKGFjYy5tZXRhLmFyZWEpICAgICAgICAgIHBhcnRzLnB1c2goYWNjLm1ldGEuYXJlYSk7CiAgICBpZiAoYWNjLm1ldGEuY291bnRyeSkgICAgICAgcGFydHMucHVzaChhY2MubWV0YS5jb3VudHJ5KTsKICAgIGlmIChhY2MubWV0YS5wdXJjaGFzZVZhbHVlKSBwYXJ0cy5wdXNoKCdQdXJjaGFzZWQ6ICcgKyBmbXQoYWNjLm1ldGEucHVyY2hhc2VWYWx1ZSkpOwogIH0KICBpZiAoYWNjLl9pbXBvcnRlZCkgcGFydHMucHVzaCgn8J+TpSBpbXBvcnRlZCcpOwogIHJldHVybiBwYXJ0cy5qb2luKCcgwrcgJyk7Cn0KCmZ1bmN0aW9uIHJlbmRlck5XSW5zaWdodHMobncpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctaW5zaWdodHMtbGlzdCcpOwogIGlmICghY29udGFpbmVyKSByZXR1cm47CgogIGNvbnN0IGNhcmRzID0gW107CiAgY29uc3QgdG9kYXlNayA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDcpOwogIGxldCBtb250aGx5RXhwID0gMDsKICBpZiAoZGF0YVt0b2RheU1rXSkgKGRhdGFbdG9kYXlNa10uZXhwZW5zZXN8fFtdKS5mb3JFYWNoKGUgPT4gbW9udGhseUV4cCArPSBud0NvbnZlcnQoZS5hbW91bnQsIGUuY3VycmVuY3kpKTsKCiAgLy8gMS4gRGVidCByYXRpbwogIGNvbnN0IGRyUGN0ID0gKG53LmRlYnRSYXRpbyAqIDEwMCkudG9GaXhlZCgwKTsKICBpZiAobncubGlhYlRvdGFsID4gMCkgewogICAgY29uc3QgaXNIaWdoID0gbncuZGVidFJhdGlvID4gMC40LCBpc01vZCA9IG53LmRlYnRSYXRpbyA+IDAuMjsKICAgIGNhcmRzLnB1c2goewogICAgICBpY29uOiBpc0hpZ2ggPyAn8J+UtCcgOiBpc01vZCA/ICfwn5KbJyA6ICfinIUnLAogICAgICBpY29uQmc6IGlzSGlnaCA/ICcjRkZFRUVFJyA6IGlzTW9kID8gJyNGRkZCRTgnIDogJyNFOEZERjUnLAogICAgICBib3JkZXI6IGlzSGlnaCA/ICcjRUY0NDQ0JyA6IGlzTW9kID8gJyNGNTlFMEInIDogJyMxMEI5ODEnLAogICAgICB0aXRsZTogYERlYnQgcmF0aW8gYXQgJHtkclBjdH0lYCwKICAgICAgc3ViOiBpc0hpZ2ggPyAnQ29uc2lkZXIgcGF5aW5nIGRvd24gZGVidCB0byByZWR1Y2UgZmluYW5jaWFsIHJpc2suJyA6IGlzTW9kID8gJ01hbmFnZWFibGUgYnV0IHdvcnRoIG1vbml0b3JpbmcuIEFpbSB0byBnZXQgdGhpcyBiZWxvdyAzMCUgb3ZlciB0aW1lLicgOiAnRXhjZWxsZW50ISBZb3VyIGRlYnQgaXMgd2VsbCB1bmRlciBjb250cm9sLicKICAgIH0pOwogIH0KCiAgLy8gMi4gRW1lcmdlbmN5IGZ1bmQKICBjb25zdCBsaXF1aWQgPSAobncuYnlUeXBlLmNoZWNraW5nPy50b3RhbHx8MCkgKyAobncuYnlUeXBlLnNhdmluZ3NfYWNjPy50b3RhbHx8MCkgKyAobncuYnlUeXBlLmNhc2g/LnRvdGFsfHwwKTsKICBpZiAobW9udGhseUV4cCA+IDApIHsKICAgIGNvbnN0IG1vbnRocyA9IGxpcXVpZCAvIG1vbnRobHlFeHA7CiAgICBjb25zdCBpc0dvb2QgPSBtb250aHMgPj0gMzsKICAgIGNhcmRzLnB1c2goewogICAgICBpY29uOiBpc0dvb2QgPyAn8J+boe+4jycgOiAn8J+GmCcsCiAgICAgIGljb25CZzogaXNHb29kID8gJyNFOEY1RkYnIDogJyNGRkVFRUUnLAogICAgICBib3JkZXI6IGlzR29vZCA/ICcjNEE5RUZGJyA6ICcjRUY0NDQ0JywKICAgICAgdGl0bGU6IGlzR29vZCA/IGAke21vbnRocy50b0ZpeGVkKDEpfSBtb250aHMgZW1lcmdlbmN5IGZ1bmRgIDogJ0xvdyBlbWVyZ2VuY3kgZnVuZCcsCiAgICAgIHN1YjogYCR7Zm10KGxpcXVpZCl9IGluIGxpcXVpZCBhY2NvdW50cy4gQWltIGZvciAz4oCTNiBtb250aHMgb2YgZXhwZW5zZXMgYXMgYSBzYWZldHkgbmV0LmAKICAgIH0pOwogIH0KCiAgLy8gMy4gSW52ZXN0bWVudCBhbGxvY2F0aW9uCiAgY29uc3QgaW52ZXN0VmFsID0gKG53LmJ5VHlwZS5icm9rZXJhZ2U/LnRvdGFsfHwwKSArIChudy5ieVR5cGUucmV0aXJlbWVudD8udG90YWx8fDApICsgKG53LmJ5VHlwZS5ib25kc19mZD8udG90YWx8fDApICsgKG53LmJ5VHlwZS5tZXRhbHM/LnRvdGFsfHwwKTsKICBpZiAobncudG90YWxBc3NldHMgPiAwKSB7CiAgICBjb25zdCBpbnZQY3QgPSAoaW52ZXN0VmFsIC8gbncudG90YWxBc3NldHMgKiAxMDApLnRvRml4ZWQoMCk7CiAgICBjYXJkcy5wdXNoKHsKICAgICAgaWNvbjogJ/Cfk4onLAogICAgICBpY29uQmc6ICcjRjBFQkZGJywKICAgICAgYm9yZGVyOiAnIzdDM0FFRCcsCiAgICAgIHRpdGxlOiBgJHtpbnZQY3R9JSBvZiBhc3NldHMgaW52ZXN0ZWRgLAogICAgICBzdWI6IGAke2ZtdChpbnZlc3RWYWwpfSBpbiBpbnZlc3RtZW50cywgcmV0aXJlbWVudCwgYm9uZHMgJiBtZXRhbHMuYAogICAgfSk7CiAgfQoKICAvLyA0LiBSZWFsIGVzdGF0ZSBjb25jZW50cmF0aW9uCiAgY29uc3QgcmVWYWwgPSBudy5ieVR5cGUucmVhbGVzdGF0ZT8udG90YWwgfHwgMDsKICBpZiAocmVWYWwgPiAwICYmIG53LnRvdGFsQXNzZXRzID4gMCkgewogICAgY29uc3QgcmVQY3QgPSAocmVWYWwgLyBudy50b3RhbEFzc2V0cyAqIDEwMCkudG9GaXhlZCgwKTsKICAgIGNhcmRzLnB1c2goewogICAgICBpY29uOiAn8J+PoScsCiAgICAgIGljb25CZzogJyNFOEZERjUnLAogICAgICBib3JkZXI6ICcjRjk3MzE2JywKICAgICAgdGl0bGU6IGBSZWFsIGVzdGF0ZTogJHtyZVBjdH0lIG9mIGFzc2V0c2AsCiAgICAgIHN1YjogYCR7Zm10KHJlVmFsKX0gaW4gcHJvcGVydHkuJHtyZVBjdCA+IDcwID8gJyBDb25zaWRlciBkaXZlcnNpZnlpbmcgaW50byBvdGhlciBhc3NldCBjbGFzc2VzLicgOiAnIEdvb2QgZGl2ZXJzaWZpY2F0aW9uIGFjcm9zcyBhc3NldCB0eXBlcy4nfWAKICAgIH0pOwogIH0KCiAgLy8gNS4gTmV0IHdvcnRoIHBvc2l0aXZlCiAgaWYgKG53Lm5ldFdvcnRoID4gMCkgewogICAgY2FyZHMucHVzaCh7CiAgICAgIGljb246ICfwn5KqJywKICAgICAgaWNvbkJnOiAnI0U4RkRGNScsCiAgICAgIGJvcmRlcjogJyMxMEI5ODEnLAogICAgICB0aXRsZTogYFBvc2l0aXZlIG5ldCB3b3J0aDogJHtmbXQobncubmV0V29ydGgpfWAsCiAgICAgIHN1YjogJ1lvdXIgYXNzZXRzIGV4Y2VlZCB5b3VyIGxpYWJpbGl0aWVzIOKAlCBrZWVwIGJ1aWxkaW5nIScKICAgIH0pOwogIH0KCiAgY29udGFpbmVyLmlubmVySFRNTCA9IGNhcmRzLm1hcChjID0+IGAKICAgIDxkaXYgY2xhc3M9Im53LWluc2lnaHQtY2FyZCIgc3R5bGU9ImJvcmRlci1sZWZ0LWNvbG9yOiR7Yy5ib3JkZXJ9OyI+CiAgICAgIDxkaXYgY2xhc3M9Im53LWluc2lnaHQtaWNvbi13cmFwIiBzdHlsZT0iYmFja2dyb3VuZDoke2MuaWNvbkJnfTsiPiR7Yy5pY29ufTwvZGl2PgogICAgICA8ZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im53LWluc2lnaHQtdGl0bGUiPiR7Yy50aXRsZX08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJudy1pbnNpZ2h0LXN1YiI+JHtjLnN1Yn08L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj5gKS5qb2luKCcnKTsKfQoKCmZ1bmN0aW9uIHJlbmRlck5XRG9udXQobncpIHsKICBjb25zdCBhbGxvY0NhcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYWxsb2MtY2FyZCcpOwogIGNvbnN0IGxlZ2VuZEVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1kb251dC1sZWdlbmQnKTsKICBjb25zdCBiYXJFbCAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYWxsb2Mtc3RhY2tlZC1iYXInKTsKICBjb25zdCB0b3RhbEVsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYWxsb2MtdG90YWwnKTsKCiAgY29uc3QgVFlQRV9DT0xPUlMgPSB7CiAgICByZWFsZXN0YXRlOiAnI0Y5NzMxNicsIHJldGlyZW1lbnQ6ICcjN0MzQUVEJywgYnJva2VyYWdlOiAnIzhCNUNGNicsCiAgICBzYXZpbmdzX2FjYzogJyMxMEI5ODEnLCBib25kc19mZDogJyNGNTlFMEInLCBjaGVja2luZzogJyMzQjlFRkYnLAogICAgbWV0YWxzOiAnI0M4OTAwQScsIGNhc2g6ICcjODRDQzE2JwogIH07CiAgY29uc3QgVFlQRV9MQUJFTFMgPSB7CiAgICByZWFsZXN0YXRlOiAnUmVhbCBFc3RhdGUnLCByZXRpcmVtZW50OiAnUmV0aXJlbWVudCcsIGJyb2tlcmFnZTogJ0ludmVzdG1lbnQnLAogICAgc2F2aW5nc19hY2M6ICdTYXZpbmdzJywgYm9uZHNfZmQ6ICdCb25kcy9GRCcsIGNoZWNraW5nOiAnQ2hlY2tpbmcnLAogICAgbWV0YWxzOiAnUHJlY2lvdXMgTWV0YWxzJywgY2FzaDogJ0Nhc2gnCiAgfTsKICAvLyBJbmNsdWRlIGN1c3RvbSB0eXBlcwogIChkYXRhLl9ud0N1c3RvbVR5cGVzfHxbXSkuZm9yRWFjaChjID0+IHsKICAgIFRZUEVfTEFCRUxTW2Mua2V5XSA9IGMubGFiZWw7CiAgICBUWVBFX0NPTE9SU1tjLmtleV0gPSBjLmNvbG9yIHx8ICcjNkI3MjgwJzsKICB9KTsKCiAgY29uc3Qgc2VnbWVudHMgPSBbXTsKICBPYmplY3Qua2V5cyhOV19UWVBFUykuZm9yRWFjaCh0ID0+IHsKICAgIGlmIChOV19UWVBFU1t0XS5pc0xpYWIpIHJldHVybjsKICAgIGNvbnN0IHZhbCA9IG53LmJ5VHlwZVt0XT8udG90YWwgfHwgMDsKICAgIGlmICh2YWwgPiAwKSB7CiAgICAgIGNvbnN0IGxhYmVsID0gVFlQRV9MQUJFTFNbdF0gfHwgTldfVFlQRVNbdF0/LmxhYmVsIHx8IHQ7CiAgICAgIHNlZ21lbnRzLnB1c2goeyB0eXBlOiB0LCB2YWwsIGNvbG9yOiBUWVBFX0NPTE9SU1t0XSB8fCAnIzlBQTBCMicsIGxhYmVsIH0pOwogICAgfQogIH0pOwogIHNlZ21lbnRzLnNvcnQoKGEsIGIpID0+IGIudmFsIC0gYS52YWwpOwoKICBpZiAoc2VnbWVudHMubGVuZ3RoID09PSAwKSB7IGlmIChhbGxvY0NhcmQpIGFsbG9jQ2FyZC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyByZXR1cm47IH0KICBpZiAoYWxsb2NDYXJkKSBhbGxvY0NhcmQuc3R5bGUuZGlzcGxheSA9ICcnOwoKICBpZiAodG90YWxFbCkgdG90YWxFbC50ZXh0Q29udGVudCA9IGZtdChudy50b3RhbEFzc2V0cyk7CgogIC8vIFN0YWNrZWQgaG9yaXpvbnRhbCBiYXIKICBpZiAoYmFyRWwpIHsKICAgIGJhckVsLmlubmVySFRNTCA9IHNlZ21lbnRzLm1hcChzID0+IHsKICAgICAgY29uc3QgcGN0ID0gbncudG90YWxBc3NldHMgPiAwID8gKHMudmFsIC8gbncudG90YWxBc3NldHMgKiAxMDApIDogMDsKICAgICAgcmV0dXJuIGA8ZGl2IHN0eWxlPSJmbGV4OiR7cGN0fTtiYWNrZ3JvdW5kOiR7cy5jb2xvcn07bWluLXdpZHRoOiR7cGN0ID4gMSA/ICc0cHgnIDogJzAnfTt0cmFuc2l0aW9uOmZsZXggMC40cyBlYXNlOyIgdGl0bGU9IiR7cy5sYWJlbH06ICR7Zm10KHMudmFsKX0gKCR7cGN0LnRvRml4ZWQoMCl9JSkiPjwvZGl2PmA7CiAgICB9KS5qb2luKCcnKTsKICB9CgogIC8vIExlZ2VuZCBhcyBjbGVhbiByb3dzCiAgaWYgKGxlZ2VuZEVsKSB7CiAgICBsZWdlbmRFbC5pbm5lckhUTUwgPSBzZWdtZW50cy5tYXAocyA9PiB7CiAgICAgIGNvbnN0IHBjdCA9','IG53LnRvdGFsQXNzZXRzID4gMCA/IChzLnZhbCAvIG53LnRvdGFsQXNzZXRzICogMTAwKS50b0ZpeGVkKDEpIDogJzAnOwogICAgICBjb25zdCBiYXJXaWR0aCA9IE1hdGgubWluKHBhcnNlRmxvYXQocGN0KSwgMTAwKTsKICAgICAgcmV0dXJuIGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjlweDsiPgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7bWFyZ2luLWJvdHRvbTozcHg7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjdweDsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDoxMHB4O2hlaWdodDoxMHB4O2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQ6JHtzLmNvbG9yfTtmbGV4LXNocmluazowOyI+PC9kaXY+CiAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtzLmxhYmVsfTwvc3Bhbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDoxMHB4O2FsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij4ke3BjdH0lPC9zcGFuPgogICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNzhlbTtmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTttaW4td2lkdGg6NjBweDt0ZXh0LWFsaWduOnJpZ2h0OyI+JHtmbXQocy52YWwpfTwvc3Bhbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDo0cHg7YmFja2dyb3VuZDojRjBGMEYwO2JvcmRlci1yYWRpdXM6MnB4OyI+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJoZWlnaHQ6MTAwJTt3aWR0aDoke2JhcldpZHRofSU7YmFja2dyb3VuZDoke3MuY29sb3J9O2JvcmRlci1yYWRpdXM6MnB4O3RyYW5zaXRpb246d2lkdGggMC40cyBlYXNlOyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PmA7CiAgICB9KS5qb2luKCcnKTsKICB9Cn0KCgpmdW5jdGlvbiB0b2dnbGVOV01ldGFsR3JvdXAoaWQpIHsKICBjb25zdCBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogIGNvbnN0IGNoZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArICctY2hldicpOwogIGlmICghYm9keSkgcmV0dXJuOwogIGNvbnN0IGNvbGxhcHNlZCA9IGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJyk7CiAgaWYgKGNoZXYpIGNoZXYuc3R5bGUudHJhbnNmb3JtID0gY29sbGFwc2VkID8gJ3JvdGF0ZSgtOTBkZWcpJyA6ICcnOwp9CgpmdW5jdGlvbiB0b2dnbGVOV1NlY3Rpb24obmFtZSkgewogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYm9keS0nK25hbWUpOwogIGNvbnN0IGNoZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctY2hldi0nK25hbWUpOwogIGlmIChib2R5KSBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTsKICBpZiAoY2hldikgY2hldi5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJyk7Cn0KCmZ1bmN0aW9uIHNhdmVOV1NuYXBzaG90KCkgewogIGNvbnN0IG53ID0gY29tcHV0ZU5ldFdvcnRoKCk7CiAgY29uc3Qgc25hcHMgPSBnZXROV1NuYXBzaG90cygpOwogIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgLy8gRG9uJ3QgZHVwbGljYXRlIHNhbWUtZGF5IHNuYXBzaG90LCB1cGRhdGUgaXQKICBjb25zdCBleGlzdGluZyA9IHNuYXBzLmZpbmQocyA9PiBzLmRhdGUgPT09IHRvZGF5KTsKICBpZiAoZXhpc3RpbmcpIHsgZXhpc3RpbmcudmFsdWUgPSBudy5uZXRXb3J0aDsgfQogIGVsc2UgeyBzbmFwcy5wdXNoKHsgZGF0ZTogdG9kYXksIHZhbHVlOiBudy5uZXRXb3J0aCB9KTsgfQogIHNhdmUoKTsKICByZW5kZXJOZXRXb3J0aCgpOwogIHNob3dUb2FzdCgn8J+TuCBTbmFwc2hvdCBzYXZlZDogJyArIGZtdChudy5uZXRXb3J0aCkpOwp9CgpmdW5jdGlvbiBfbndzQnVpbGRUeXBlUGlja2VyKCkgewogIGNvbnN0IHZpcyA9IGdldE5XVHlwZVZpc2liaWxpdHkoKTsKICBjb25zdCB2aXNpYmxlVHlwZXMgPSBnZXROV1R5cGVPcmRlcigpLmZpbHRlcih0ID0+IHZpc1t0XSAhPT0gZmFsc2UpOwogIGNvbnN0IGdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXR5cGUtZ3JpZCcpOwogIGlmICghZ3JpZCkgcmV0dXJuOwogIGlmICghdmlzaWJsZVR5cGVzLmxlbmd0aCkgewogICAgZ3JpZC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iZ3JpZC1jb2x1bW46MS8tMTt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO3BhZGRpbmc6MjBweCAwOyI+QWxsIGFjY291bnQgdHlwZXMgYXJlIGhpZGRlbi48YnI+RW5hYmxlIHRoZW0gaW4gU2V0dGluZ3Mg4oaSIE5ldCBXb3J0aCBBY2NvdW50IFR5cGVzLjwvZGl2Pic7CiAgICByZXR1cm47CiAgfQogIGdyaWQuaW5uZXJIVE1MID0gdmlzaWJsZVR5cGVzLm1hcCh0ID0+IHsKICAgIGNvbnN0IGNmZyA9IE5XX1RZUEVTW3RdOwogICAgY29uc3Qgc2VsID0gdCA9PT0gbndTaGVldFR5cGU7CiAgICByZXR1cm4gYDxkaXYgY2xhc3M9Im53cy10eXBlLXRpbGUke3NlbD8nIHNlbGVjdGVkJzonJ30iIG9uY2xpY2s9Il9ud3NTZWxlY3RUeXBlKCcke3R9JyxldmVudCkiPgogICAgICA8ZGl2IGNsYXNzPSJud3MtdHlwZS10aWxlLWljb24iPiR7Y2ZnLmVtb2ppfTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJud3MtdHlwZS10aWxlLW5hbWUiPiR7Z2V0TldUeXBlU2hvcnQoKVt0XXx8Y2ZnLmxhYmVsfTwvZGl2PgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gX253c1NlbGVjdFR5cGUodHlwZSwgZXYpIHsKICBud1NoZWV0VHlwZSA9IHR5cGU7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm53cy10eXBlLXRpbGUnKS5mb3JFYWNoKHQgPT4gdC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpKTsKICBpZiAoZXYgJiYgZXYuY3VycmVudFRhcmdldCkgZXYuY3VycmVudFRhcmdldC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogIF9ud3NTaG93Rm9ybSgpOwp9CgpmdW5jdGlvbiBfbndzU2hvd0Zvcm0oKSB7CiAgY29uc3QgdHlwZSA9IG53U2hlZXRUeXBlOwogIGNvbnN0IGNmZyA9IE5XX1RZUEVTW3R5cGVdOwogIGlmICghY2ZnKSByZXR1cm47CiAgY29uc3QgZXhpc3RpbmcgPSBud1NoZWV0RWRpdElkID8gKGRhdGEuX253QWNjb3VudHN8fFtdKS5maW5kKGE9PmEuaWQ9PT1ud1NoZWV0RWRpdElkKSA6IG51bGw7CiAgY29uc3QgbSA9IGV4aXN0aW5nID8gKGV4aXN0aW5nLm1ldGF8fHt9KSA6IHt9OwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXBoYXNlLXBpY2snKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcGhhc2UtZm9ybScpLnN0eWxlLmRpc3BsYXkgPSAnJzsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1iYW5uZXItaWNvbicpLnRleHRDb250ZW50ID0gY2ZnLmVtb2ppOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtYmFubmVyLW5hbWUnKS50ZXh0Q29udGVudCA9IGNmZy5sYWJlbDsKICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtYmFubmVyLWJhZGdlJyk7CiAgYmFkZ2UudGV4dENvbnRlbnQgPSBjZmcuaXNMaWFiID8gJ0xJQUJJTElUWScgOiAnQVNTRVQnOwogIGJhZGdlLmNsYXNzTmFtZSAgID0gJ253cy10eXBlLWJhZGdlICcgKyAoY2ZnLmlzTGlhYiA/ICdsaWFiJyA6ICdhc3NldCcpOwoKICBfbndzQnVpbGRGb3JtKHR5cGUsIGV4aXN0aW5nLCBtKTsKfQoKZnVuY3Rpb24gb3Blbk5XU2hlZXQodHlwZSwgZWRpdElkKSB7CiAgbndTaGVldFR5cGUgICA9IHR5cGUgfHwgbnVsbDsKICBud1NoZWV0RWRpdElkID0gZWRpdElkIHx8IG51bGw7CiAgY29uc3QgcGhhc2VQaWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1waGFzZS1waWNrJyk7CiAgY29uc3QgcGhhc2VGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1waGFzZS1mb3JtJyk7CgogIGlmICh0eXBlKSB7CiAgICAvLyBEaXJlY3QgY2FsbCBmcm9tIHNlY3Rpb24gYnV0dG9uIOKAlCBza2lwIHBpY2tlciwgc2hvdyBmb3JtIGltbWVkaWF0ZWx5CiAgICBwaGFzZVBpY2suc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIHBoYXNlRm9ybS5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBfbndzU2hvd0Zvcm0oKTsKICB9IGVsc2UgewogICAgLy8gIisgQWRkIEFjY291bnQiIENUQSDigJQgc2hvdyB0eXBlIHBpY2tlciBmaXJzdCwgbm8gdHlwZSBwcmUtc2VsZWN0ZWQKICAgIHBoYXNlUGljay5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBwaGFzZUZvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIF9ud3NCdWlsZFR5cGVQaWNrZXIoKTsKICB9CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zaGVldC1vdmVybGF5JykuY2xhc3NMaXN0LmFkZCgnb3BlbicpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zaGVldCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctc2hlZXQnKS5zY3JvbGxUb3AgPSAwOwp9CgpmdW5jdGlvbiBfbndzQnVpbGRGb3JtKHR5cGUsIGV4aXN0aW5nLCBtKSB7CiAgbGV0IGV4dHJhRmllbGRzID0gJyc7CiAgaWYgKHR5cGUgPT09ICdyZXRpcmVtZW50JykgewogICAgY29uc3Qgb3B0cyA9IFJFVElSRV9TVUJUWVBFUy5tYXAocyA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtzfSIgJHsobS5zdWJ0eXBlPT09cyk/J3NlbGVjdGVkJzonJ30+JHtzfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+QWNjb3VudCBTdWJ0eXBlPC9kaXY+PHNlbGVjdCBjbGFzcz0ibnctc2hlZXQtc2VsZWN0IiBpZD0ibndzLXN1YnR5cGUiPiR7b3B0c308L3NlbGVjdD48L2Rpdj5gOwogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+WVREIENvbnRyaWJ1dGlvbjwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MteXRkIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIwIiB2YWx1ZT0iJHttLnl0ZENvbnRyaWJ1dGlvbnx8Jyd9Ij48L2Rpdj5gOwogIH0KICBpZiAodHlwZSA9PT0gJ2NyZWRpdF9jYXJkJykgewogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5DcmVkaXQgTGltaXQ8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWxpbWl0IiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSI1MDAwIiB2YWx1ZT0iJHttLmxpbWl0fHwnJ30iPjwvZGl2PjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+QVBSICU8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWFwciIgdHlwZT0ibnVtYmVyIiBwbGFjZWhvbGRlcj0iMTkuOTkiIHN0ZXA9IjAuMDEiIHZhbHVlPSIke20uYXByfHwnJ30iPjwvZGl2PjwvZGl2PmA7CiAgfQogIGlmICh0eXBlID09PSAnbG9hbicpIHsKICAgIGV4dHJhRmllbGRzICs9IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1yb3ciPjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+SW50ZXJlc3QgUmF0ZSAlPC9kaXY+PGlucHV0','IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1yYXRlIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSI2LjUiIHN0ZXA9IjAuMDEiIHZhbHVlPSIke20uaW50ZXJlc3RSYXRlfHwnJ30iPjwvZGl2PjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+TW9udGhseSBQYXltZW50PC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1tcGF5IiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIwIiB2YWx1ZT0iJHttLm1vbnRobHlQYXltZW50fHwnJ30iPjwvZGl2PjwvZGl2PmA7CiAgfQogIGlmICh0eXBlID09PSAnYm9uZHNfZmQnKSB7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPkludGVyZXN0IFJhdGUgJTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtcmF0ZSIgdHlwZT0ibnVtYmVyIiBwbGFjZWhvbGRlcj0iNS4wIiBzdGVwPSIwLjAxIiB2YWx1ZT0iJHttLmludGVyZXN0UmF0ZXx8Jyd9Ij48L2Rpdj48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPk1hdHVyaXR5IERhdGU8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLW1hdHVyaXR5IiB0eXBlPSJkYXRlIiB2YWx1ZT0iJHttLm1hdHVyaXR5RGF0ZXx8Jyd9Ij48L2Rpdj48L2Rpdj5gOwogIH0KICBpZiAodHlwZSA9PT0gJ21ldGFscycpIHsKICAgIGNvbnN0IG1ldGFsVHlwZXMgPSBbJ2dvbGQnLCdzaWx2ZXInLCdwbGF0aW51bSddOwogICAgY29uc3QgbU9wdHMgPSBtZXRhbFR5cGVzLm1hcChtdCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHttdH0iICR7KG0ubWV0YWxUeXBlPT09bXQpPydzZWxlY3RlZCc6Jyd9PiR7bXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrbXQuc2xpY2UoMSl9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICBjb25zdCBwdXJpdHlPcHRzID0gWycyNEsnLCcyMksnLCcyMUsnLCcxOEsnLCcxNEsnLCcxMEsnLCc5OTkgRmluZScsJzkyNSBTaWx2ZXInLCc4NTAnLCdPdGhlciddLm1hcChwPT5gPG9wdGlvbiB2YWx1ZT0iJHtwfSIgJHsobS5wdXJpdHk9PT1wKT8nc2VsZWN0ZWQnOicnfT4ke3B9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICBjb25zdCB1bml0T3B0cyA9IFsnZycsJ296J10ubWFwKHU9PmA8b3B0aW9uIHZhbHVlPSIke3V9IiAkeygobS53ZWlnaHRVbml0fHwnZycpPT09dSk/J3NlbGVjdGVkJzonJ30+JHt1fTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5NZXRhbCBUeXBlPC9kaXY+PHNlbGVjdCBjbGFzcz0ibnctc2hlZXQtc2VsZWN0IiBpZD0ibndzLW1ldGFsdHlwZSI+JHttT3B0c308L3NlbGVjdD48L2Rpdj48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPlB1cml0eTwvZGl2PjxzZWxlY3QgY2xhc3M9Im53LXNoZWV0LXNlbGVjdCIgaWQ9Im53cy1wdXJpdHkiPiR7cHVyaXR5T3B0c308L3NlbGVjdD48L2Rpdj48L2Rpdj5gOwogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiIHN0eWxlPSJmbGV4OjI7Ij48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+V2VpZ2h0PC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1ncmFtcyIgdHlwZT0ibnVtYmVyIiBwbGFjZWhvbGRlcj0iMTAiIHN0ZXA9IjAuMDAxIiB2YWx1ZT0iJHttLmdyYW1zfHwnJ30iPjwvZGl2PjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+VW5pdDwvZGl2PjxzZWxlY3QgY2xhc3M9Im53LXNoZWV0LXNlbGVjdCIgaWQ9Im53cy13ZWlnaHR1bml0Ij4ke3VuaXRPcHRzfTwvc2VsZWN0PjwvZGl2PjwvZGl2PmA7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5QcmljZSBwZXIgZ3JhbSAoJHtjdXJyZW50Q3VycmVuY3kuY29kZX0pPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1wcmljZXBlcmdyYW0iIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9ImF1dG8iIHN0ZXA9IjAuMDEiIHZhbHVlPSIke20ucHJpY2VQZXJHcmFtfHwnJ30iPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTttYXJnaW4tdG9wOjRweDsiPkxlYXZlIGJsYW5rIHRvIGF1dG8tdXNlIGxpdmUgcHJpY2UgZnJvbSBNZXRhbHMgbW9kdWxlPC9kaXY+PC9kaXY+YDsKICAgIGV4dHJhRmllbGRzICs9IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1tZXRhIj7wn5KhIElmIG96IHNlbGVjdGVkLCB3ZWlnaHQgaXMgY29udmVydGVkIHRvIGdyYW1zIGF1dG9tYXRpY2FsbHkgb24gc2F2ZTwvZGl2PmA7CiAgfQoKICBjb25zdCBjdXJyZW5jaWVzID0gWydVU0QnLCdJTlInLCdFVVInLCdHQlAnLCdBRUQnLCdDQUQnLCdBVUQnLCdTR0QnXTsKICBjb25zdCBjdXJyT3B0cyA9IGN1cnJlbmNpZXMubWFwKGMgPT4gYDxvcHRpb24gdmFsdWU9IiR7Y30iICR7KGV4aXN0aW5nID8gZXhpc3RpbmcuY3VycmVuY3kgOiBjdXJyZW50Q3VycmVuY3kuY29kZSk9PT1jPydzZWxlY3RlZCc6Jyd9PiR7Y308L29wdGlvbj5gKS5qb2luKCcnKTsKCiAgY29uc3QgaXNMaWFiID0gTldfVFlQRVNbdHlwZV0uaXNMaWFiOwogIGNvbnN0IGJhbExhYmVsID0gaXNMaWFiID8gJ091dHN0YW5kaW5nIEJhbGFuY2UnIDogJ0N1cnJlbnQgQmFsYW5jZSc7CiAgY29uc3Qgc2hvd0JhbGFuY2UgPSB0eXBlICE9PSAnbWV0YWxzJzsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNoZWV0LWJvZHknKS5pbm5lckhUTUwgPSBgCiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+CiAgICAgIDxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5MYXN0IFVwZGF0ZWQ8L2Rpdj4KICAgICAgPGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1kYXRlIiB0eXBlPSJkYXRlIiB2YWx1ZT0iJHtleGlzdGluZyA/IGV4aXN0aW5nLmxhc3RVcGRhdGVkIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19Ij4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPgogICAgICA8ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+TmFtZTwvZGl2PgogICAgICA8aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLW5hbWUiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJlLmcuIENoYXNlIENoZWNraW5nIiB2YWx1ZT0iJHtleGlzdGluZyA/IGV4aXN0aW5nLm5hbWUgOiAnJ30iPgogICAgPC9kaXY+CiAgICAke3R5cGUgIT09ICdtZXRhbHMnICYmIHR5cGUgIT09ICdyZWFsZXN0YXRlJyA/IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkJhbmsgLyBJbnN0aXR1dGlvbjwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtYmFuayIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9ImUuZy4gQ2hhc2UsIEJvZkEsIFNCSSIgdmFsdWU9IiR7bS5iYW5rfHwnJ30iPjwvZGl2PmAgOiAnJ30KICAgICR7dHlwZSA9PT0gJ3JlYWxlc3RhdGUnID8gYAogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5Db3VudHJ5PC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1yZS1jb3VudHJ5IiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iZS5nLiBVUywgSU4sIEFFIiB2YWx1ZT0iJHttLmNvdW50cnl8fCcnfSI+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+Q3VycmVuY3k8L2Rpdj48c2VsZWN0IGNsYXNzPSJudy1zaGVldC1zZWxlY3QiIGlkPSJud3MtY3VycmVuY3kiPiR7Y3Vyck9wdHN9PC9zZWxlY3Q+PC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+CiAgICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+UHVyY2hhc2UgVmFsdWU8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXJlLXB2IiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIwIiBzdGVwPSIwLjAxIiB2YWx1ZT0iJHttLnB1cmNoYXNlVmFsdWV8fCcnfSI+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+Q3VycmVudCBWYWx1ZTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtYmFsYW5jZSIgdHlwZT0ibnVtYmVyIiBwbGFjZWhvbGRlcj0iMCIgc3RlcD0iMC4wMSIgdmFsdWU9IiR7ZXhpc3RpbmcgPyBleGlzdGluZy5iYWxhbmNlIDogKG0uY3VycmVudFZhbHVlfHwnJyl9Ij48L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5BcmVhIChzcSBmdCAvIHNxIG0pPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1yZS1hcmVhIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iZS5nLiAxMjAwIHNxZnQiIHZhbHVlPSIke20uYXJlYXx8Jyd9Ij48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5QdXJjaGFzZSBEYXRlPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1kYXRlIiB0eXBlPSJkYXRlIiB2YWx1ZT0iJHtleGlzdGluZyA/IGV4aXN0aW5nLmxhc3RVcGRhdGVkIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19Ij48L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5EZXNjcmlwdGlvbiAvIEFkZHJlc3M8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXJlLWRlc2MiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJlLmcuIDNCUiBBcGFydG1lbnQsIE1haW4gU3QiIHZhbHVlPSIke20uZGVzY3JpcHRpb258fCcnfSI+PC9kaXY+CiAgICBgIDogYCR7c2hvd0JhbGFuY2UgPyBgCiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+CiAgICAgIDxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5DdXJyZW50IEJhbGFuY2U8L2Rpdj4KICAgICAgPGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1iYWxhbmNlIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIwLjAwIiBzdGVwPSIwLjAxIiB2YWx1ZT0iJHtleGlzdGluZyA/IGV4aXN0aW5nLmJhbGFuY2UgOiAnJ30iPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1yb3ciPgogICAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkN1cnJlbmN5PC9kaXY+PHNlbGVjdCBjbGFzcz0ibnctc2hlZXQtc2VsZWN0IiBpZD0ibndzLWN1cnJlbmN5Ij4ke2N1cnJPcHRzfTwvc2VsZWN0PjwvZGl2PgogICAgICAkeyh0eXBlID09PSAnY2hlY2tpbmcnIHx8IHR5cGUgPT09ICdzYXZpbmdzX2FjYycgfHwgdHlwZSA9PT0gJ2NyZWRpdF9jYXJkJykgPyBgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xh','c3M9Im53cy1zZWN0aW9uLWxhYmVsIj5BY2NvdW50ICMgKExhc3QgNCk8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWFjY3Q0IiB0eXBlPSJ0ZXh0IiBtYXhsZW5ndGg9IjQiIHBsYWNlaG9sZGVyPSIxMjM0IiB2YWx1ZT0iJHttLmxhc3Q0fHwnJ30iPjwvZGl2PmAgOiAnJ30KICAgIDwvZGl2PmAgOiAnJ31gfQogICAgJHtleHRyYUZpZWxkc30KICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj4KICAgICAgPGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPk5vdGVzPC9kaXY+CiAgICAgIDxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3Mtbm90ZXMiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJPcHRpb25hbCIgdmFsdWU9IiR7bS5ub3Rlc3x8Jyd9Ij4KICAgIDwvZGl2PgogIGA7Cn0KCgpmdW5jdGlvbiBkZWxldGVOV0FjY291bnQoaWQpIHsKICBpZiAoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIGFjY291bnQ/JykpIHJldHVybjsKICBpZiAoIWRhdGEuX253QWNjb3VudHMpIHJldHVybjsKICBkYXRhLl9ud0FjY291bnRzID0gZGF0YS5fbndBY2NvdW50cy5maWx0ZXIoYSA9PiBhLmlkICE9PSBpZCk7CiAgc2F2ZSgpOwogIHJlbmRlck5ldFdvcnRoKCk7CiAgc2hvd1RvYXN0KCdBY2NvdW50IGRlbGV0ZWQnKTsKfQoKZnVuY3Rpb24gY2xvc2VOV1NoZWV0KCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zaGVldC1vdmVybGF5JykuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zaGVldCcpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsKICAvLyBSZXNldCBmb3IgbmV4dCBvcGVuCiAgc2V0VGltZW91dCgoKSA9PiB7CiAgICBjb25zdCBwaWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1waGFzZS1waWNrJyk7CiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1waGFzZS1mb3JtJyk7CiAgICBpZiAocGljaykgcGljay5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBpZiAoZm9ybSkgZm9ybS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgbndTaGVldFR5cGUgPSBudWxsOwogICAgbndTaGVldEVkaXRJZCA9IG51bGw7CiAgfSwgMzIwKTsgLy8gYWZ0ZXIgc2xpZGUtZG93biBhbmltYXRpb24KfQoKZnVuY3Rpb24gc2F2ZU5XQWNjb3VudCgpIHsKICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1uYW1lJyk/LnZhbHVlPy50cmltKCk7CiAgaWYgKCFuYW1lKSB7IHNob3dUb2FzdCgn4pqg77iPIEFjY291bnQgbmFtZSByZXF1aXJlZCcpOyByZXR1cm47IH0KCiAgY29uc3QgdHlwZSA9IG53U2hlZXRUeXBlOwogIGNvbnN0IG1ldGEgPSB7fTsKICBsZXQgYmFsYW5jZSA9IDA7CiAgbGV0IGN1cnJlbmN5ID0gY3VycmVudEN1cnJlbmN5LmNvZGU7CgogIGNvbnN0IGJhbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1iYWxhbmNlJyk7CiAgaWYgKGJhbEVsKSBiYWxhbmNlID0gTnVtYmVyKGJhbEVsLnZhbHVlIHx8IDApOwogIGNvbnN0IGN1cnJFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtY3VycmVuY3knKTsKICBpZiAoY3VyckVsKSBjdXJyZW5jeSA9IGN1cnJFbC52YWx1ZTsKCiAgLy8gRXh0cmEgbWV0YSDigJQgYWx3YXlzIHRyeSByZWFkaW5nIGFsbCBwb3NzaWJsZSBmaWVsZHMKICBjb25zdCBzdWJ0eXBlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXN1YnR5cGUnKTsKICBpZiAoc3VidHlwZUVsKSBtZXRhLnN1YnR5cGUgPSBzdWJ0eXBlRWwudmFsdWU7CiAgY29uc3QgeXRkRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXl0ZCcpOwogIGlmICh5dGRFbCAmJiB5dGRFbC52YWx1ZSkgbWV0YS55dGRDb250cmlidXRpb24gPSBOdW1iZXIoeXRkRWwudmFsdWUpOwogIGNvbnN0IGxpbWl0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWxpbWl0Jyk7CiAgaWYgKGxpbWl0RWwgJiYgbGltaXRFbC52YWx1ZSkgbWV0YS5saW1pdCA9IE51bWJlcihsaW1pdEVsLnZhbHVlKTsKICBjb25zdCBhcHJFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtYXByJyk7CiAgaWYgKGFwckVsICYmIGFwckVsLnZhbHVlKSBtZXRhLmFwciA9IE51bWJlcihhcHJFbC52YWx1ZSk7CiAgY29uc3QgcmF0ZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1yYXRlJyk7CiAgaWYgKHJhdGVFbCAmJiByYXRlRWwudmFsdWUpIG1ldGEuaW50ZXJlc3RSYXRlID0gTnVtYmVyKHJhdGVFbC52YWx1ZSk7CiAgY29uc3QgbXBheUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1tcGF5Jyk7CiAgaWYgKG1wYXlFbCAmJiBtcGF5RWwudmFsdWUpIG1ldGEubW9udGhseVBheW1lbnQgPSBOdW1iZXIobXBheUVsLnZhbHVlKTsKICBjb25zdCBtYXRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtbWF0dXJpdHknKTsKICBpZiAobWF0RWwgJiYgbWF0RWwudmFsdWUpIG1ldGEubWF0dXJpdHlEYXRlID0gbWF0RWwudmFsdWU7CiAgY29uc3QgbXRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtbWV0YWx0eXBlJyk7CiAgaWYgKG10RWwpIG1ldGEubWV0YWxUeXBlID0gbXRFbC52YWx1ZTsKICBjb25zdCBncmFtc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1ncmFtcycpOwogIGNvbnN0IHVuaXRFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXdlaWdodHVuaXQnKTsKICBpZiAoZ3JhbXNFbCAmJiBncmFtc0VsLnZhbHVlKSB7CiAgICBjb25zdCByYXdXZWlnaHQgPSBOdW1iZXIoZ3JhbXNFbC52YWx1ZSk7CiAgICBjb25zdCBpc096ID0gdW5pdEVsICYmIHVuaXRFbC52YWx1ZSA9PT0gJ296JzsKICAgIG1ldGEuZ3JhbXMgPSBpc096ID8gcmF3V2VpZ2h0ICogMzEuMTAzNSA6IHJhd1dlaWdodDsKICAgIG1ldGEud2VpZ2h0VW5pdCA9IGlzT3ogPyAnb3onIDogJ2cnOwogICAgbWV0YS53ZWlnaHREaXNwbGF5ID0gcmF3V2VpZ2h0OyAvLyBvcmlnaW5hbCBpbnB1dCB2YWx1ZQogIH0KICBjb25zdCBwcGdFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcHJpY2VwZXJncmFtJyk7CiAgaWYgKHBwZ0VsICYmIHBwZ0VsLnZhbHVlKSBtZXRhLnByaWNlUGVyR3JhbSA9IE51bWJlcihwcGdFbC52YWx1ZSk7CiAgY29uc3QgcHVyaXR5RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXB1cml0eScpOwogIGlmIChwdXJpdHlFbCAmJiBwdXJpdHlFbC52YWx1ZSkgbWV0YS5wdXJpdHkgPSBwdXJpdHlFbC52YWx1ZTsKICAvLyBSZWFsIGVzdGF0ZSBzcGVjaWZpYyBmaWVsZHMKICBjb25zdCByZVB2RWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcmUtcHYnKTsKICBjb25zdCByZURlc2NFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcmUtZGVzYycpOwogIGNvbnN0IHJlQXJlYUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1yZS1hcmVhJyk7CiAgY29uc3QgcmVDb3VudHJ5RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXJlLWNvdW50cnknKTsKICBpZiAocmVQdkVsICYmIHJlUHZFbC52YWx1ZSkgICAgIG1ldGEucHVyY2hhc2VWYWx1ZSA9IE51bWJlcihyZVB2RWwudmFsdWUpOwogIGlmIChyZURlc2NFbCAmJiByZURlc2NFbC52YWx1ZSkgbWV0YS5kZXNjcmlwdGlvbiAgID0gcmVEZXNjRWwudmFsdWUudHJpbSgpOwogIGlmIChyZUFyZWFFbCAmJiByZUFyZWFFbC52YWx1ZSkgbWV0YS5hcmVhICAgICAgICAgID0gcmVBcmVhRWwudmFsdWUudHJpbSgpOwogIGlmIChyZUNvdW50cnlFbCAmJiByZUNvdW50cnlFbC52YWx1ZSkgbWV0YS5jb3VudHJ5ID0gcmVDb3VudHJ5RWwudmFsdWUudHJpbSgpOwogIC8vIE5ldyBmaWVsZHMKICBjb25zdCBiYW5rRWwgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1iYW5rJyk7CiAgaWYgKGJhbmtFbCAmJiBiYW5rRWwudmFsdWUpIG1ldGEuYmFuayA9IGJhbmtFbC52YWx1ZS50cmltKCk7CiAgY29uc3QgYWNjdDRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtYWNjdDQnKTsKICBpZiAoYWNjdDRFbCAmJiBhY2N0NEVsLnZhbHVlKSBtZXRhLmxhc3Q0ID0gYWNjdDRFbC52YWx1ZS50cmltKCk7CiAgY29uc3Qgbm90ZXNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3Mtbm90ZXMnKTsKICBpZiAobm90ZXNFbCAmJiBub3Rlc0VsLnZhbHVlKSBtZXRhLm5vdGVzID0gbm90ZXNFbC52YWx1ZS50cmltKCk7CiAgY29uc3QgZGF0ZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1kYXRlJyk7CiAgY29uc3QgbGFzdFVwZGF0ZWQgPSBkYXRlRWwgPyBkYXRlRWwudmFsdWUgOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKCiAgaWYgKCFkYXRhLl9ud0FjY291bnRzKSBkYXRhLl9ud0FjY291bnRzID0gW107CiAgaWYgKG53U2hlZXRFZGl0SWQpIHsKICAgIGNvbnN0IGlkeCA9IGRhdGEuX253QWNjb3VudHMuZmluZEluZGV4KGEgPT4gYS5pZCA9PT0gbndTaGVldEVkaXRJZCk7CiAgICBpZiAoaWR4ID49IDApIGRhdGEuX253QWNjb3VudHNbaWR4XSA9IHsgLi4uZGF0YS5fbndBY2NvdW50c1tpZHhdLCBuYW1lLCB0eXBlLCBiYWxhbmNlLCBjdXJyZW5jeSwgbGFzdFVwZGF0ZWQsIG1ldGEgfTsKICB9IGVsc2UgewogICAgY29uc3QgaWQgPSAnbndhXycgKyBEYXRlLm5vdygpICsgJ18nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiw2KTsKICAgIGRhdGEuX253QWNjb3VudHMucHVzaCh7IGlkLCBuYW1lLCB0eXBlLCBiYWxhbmNlLCBjdXJyZW5jeSwgbGFzdFVwZGF0ZWQsIG1ldGEgfSk7CiAgfQoKICBzYXZlKCk7CiAgY2xvc2VOV1NoZWV0KCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICBzaG93VG9hc3QoJ+KchSBBY2NvdW50IHNhdmVkJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBJTVBPUlQgSFVCCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApsZXQgaW1wb3J0U3RhdGUgPSB7CiAgdHJhbnNhY3Rpb25zOiB7IHJvd3M6IFtdLCBoZWFkZXJzOiBbXSwgdHlwZTogJ2V4cGVuc2UnLCBjb2xNYXA6IHt9LCBjYXRNZXJnZXM6IHt9IH0sCiAgZ2l2ZW46IHsgcm93czogW10sIGhlYWRlcnM6IFtdIH0sCiAgbWV0YWxzOiB7IHJvd3M6IFtdLCBoZWFkZXJzOiBbXSB9LAogIHJlYWxlc3RhdGU6IHsgcm93czogW10sIGhlYWRlcnM6IFtdIH0sCn07CgpmdW5jdGlvbiBzZXRJbXBvcnRUYWIodGFiLCBlbCkgewogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbXBvcnQtdGFiJykuZm9yRWFjaCh0ID0+IHQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbXBvcnQtc2VjdGlvbicpLmZvckVhY2gocyA9PiBzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICBpZiAoZWwpIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGNvbnN0IHNlYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpc2VjLScgKyB0YWIpOwogIGlmIChzZWMpIHNlYy5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBpZiAodGFiID09PSAnZ2l2ZW4nKSByZW5kZXJHaXZlbkxlZGdlcigpOwogIGlmICh0YWIgPT09ICdyZXNldCcpIHsgcmVuZGVyUmVzZXRTdW1tYXJ5KCk7IHJlbmRlck1vbnRoc0xpc3QoKTsgfQp9CgpmdW5jdGlvbiBoYW5kbGVJbXBvcnREcm9wKGV2','ZW50LCB0eXBlKSB7CiAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW1wb3J0LWRyb3Atem9uZScpLmZvckVhY2goeiA9PiB6LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdvdmVyJykpOwogIGNvbnN0IGZpbGUgPSBldmVudC5kYXRhVHJhbnNmZXIuZmlsZXNbMF07CiAgaWYgKGZpbGUpIHByb2Nlc3NJbXBvcnRGaWxlKGZpbGUsIHR5cGUpOwp9CgpmdW5jdGlvbiBoYW5kbGVJbXBvcnRGaWxlKGlucHV0LCB0eXBlKSB7CiAgY29uc3QgZmlsZSA9IGlucHV0LmZpbGVzWzBdOwogIGlmIChmaWxlKSBwcm9jZXNzSW1wb3J0RmlsZShmaWxlLCB0eXBlKTsKICBpbnB1dC52YWx1ZSA9ICcnOwp9CgpmdW5jdGlvbiBwcm9jZXNzSW1wb3J0RmlsZShmaWxlLCB0eXBlKSB7CiAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICByZWFkZXIub25sb2FkID0gZSA9PiB7CiAgICB0cnkgewogICAgICBjb25zdCB3YiA9IFhMU1gucmVhZChlLnRhcmdldC5yZXN1bHQsIHsgdHlwZTogJ2FycmF5JywgY2VsbERhdGVzOiB0cnVlIH0pOwogICAgICBjb25zdCB3cyA9IHdiLlNoZWV0c1t3Yi5TaGVldE5hbWVzWzBdXTsKICAgICAgY29uc3QgcmF3Um93cyA9IFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cywgeyBoZWFkZXI6IDEsIHJhdzogZmFsc2UsIGRhdGVORjogJ3l5eXktbW0tZGQnIH0pOwogICAgICBpZiAocmF3Um93cy5sZW5ndGggPCAyKSB7IHNob3dUb2FzdCgnRmlsZSBhcHBlYXJzIGVtcHR5IOKdjCcpOyByZXR1cm47IH0KICAgICAgY29uc3QgaGVhZGVycyA9IChyYXdSb3dzWzBdIHx8IFtdKS5tYXAoaCA9PiBTdHJpbmcoaCB8fCAnJykudHJpbSgpKTsKICAgICAgY29uc3Qgcm93cyA9IHJhd1Jvd3Muc2xpY2UoMSkuZmlsdGVyKHIgPT4gci5zb21lKGMgPT4gYyAhPT0gbnVsbCAmJiBjICE9PSB1bmRlZmluZWQgJiYgU3RyaW5nKGMpLnRyaW0oKSAhPT0gJycpKTsKICAgICAgaW1wb3J0U3RhdGVbdHlwZV0gPSB7IC4uLmltcG9ydFN0YXRlW3R5cGVdLCByb3dzLCBoZWFkZXJzIH07CiAgICAgIHNob3dUb2FzdChg4pyFIExvYWRlZCAke3Jvd3MubGVuZ3RofSByb3dzYCk7CiAgICAgIGlmICh0eXBlID09PSAndHJhbnNhY3Rpb25zJykgYnVpbGRUeENvbE1hcChoZWFkZXJzLCByb3dzKTsKICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2dpdmVuJykgICAgICBzaG93R2l2ZW5QcmV2aWV3KHJvd3MsIGhlYWRlcnMpOwogICAgICBlbHNlIGlmICh0eXBlID09PSAnbWV0YWxzJykgICAgIHNob3dNZXRhbHNQcmV2aWV3KHJvd3MsIGhlYWRlcnMpOwogICAgICBlbHNlIGlmICh0eXBlID09PSAncmVhbGVzdGF0ZScpIHNob3dSRVByZXZpZXcocm93cywgaGVhZGVycyk7CiAgICB9IGNhdGNoKGVycikgeyBzaG93VG9hc3QoJ0Vycm9yIHJlYWRpbmcgZmlsZSDinYwgJyArIGVyci5tZXNzYWdlKTsgfQogIH07CiAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOwp9CgovLyDilIDilIAgVFJBTlNBQ1RJT05TIElNUE9SVEVSIOKUgOKUgApmdW5jdGlvbiBidWlsZFR4Q29sTWFwKGhlYWRlcnMsIHJvd3MpIHsKICAvLyBTbWFydCBhdXRvLWRldGVjdAogIGNvbnN0IGZpbmQgPSAoa2V5d29yZHMpID0+IGhlYWRlcnMuZmluZEluZGV4KGggPT4ga2V5d29yZHMuc29tZShrID0+IGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrKSkpOwogIGNvbnN0IGNvbE1hcCA9IHsKICAgIGRhdGU6ICAgICBmaW5kKFsnZGF0ZSddKSwKICAgIGNhdGVnb3J5OiBmaW5kKFsnY2F0ZWdvcnknLCdjYXQnLCd0eXBlJ10pLAogICAgYW1vdW50OiAgIGZpbmQoWydhbW91bnQnLCdhbXQnLCdzdW0nLCd2YWx1ZSddKSwKICAgIGRlc2NyaXB0aW9uOiBmaW5kKFsnZGVzY3JpcHRpb24nLCdkZXNjJywnc3RvcmUnLCdub3RlJywnbWVyY2hhbnQnXSksCiAgICBtb250aDogICAgZmluZChbJ21vbnRoJ10pLAogIH07CiAgaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zLmNvbE1hcCA9IGNvbE1hcDsKCiAgLy8gQnVpbGQgY29sIG1hcCBVSQogIGNvbnN0IGZpZWxkcyA9IFsKICAgIHsga2V5OiAnZGF0ZScsIGxhYmVsOiAn8J+ThSBEYXRlJywgcmVxdWlyZWQ6IHRydWUgfSwKICAgIHsga2V5OiAnY2F0ZWdvcnknLCBsYWJlbDogJ/Cfj7fvuI8gQ2F0ZWdvcnknLCByZXF1aXJlZDogdHJ1ZSB9LAogICAgeyBrZXk6ICdhbW91bnQnLCBsYWJlbDogJ/CfkrIgQW1vdW50JywgcmVxdWlyZWQ6IHRydWUgfSwKICAgIHsga2V5OiAnZGVzY3JpcHRpb24nLCBsYWJlbDogJ/Cfk50gRGVzY3JpcHRpb24nLCByZXF1aXJlZDogZmFsc2UgfSwKICBdOwogIGNvbnN0IHR4VHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9Iml0eC10eXBlIl06Y2hlY2tlZCcpPy52YWx1ZSB8fCAnZXhwZW5zZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0eC1tYXAtc3ViJykudGV4dENvbnRlbnQgPSBgTWFwcGluZyAke3Jvd3MubGVuZ3RofSByb3dzIGZyb20geW91ciAke3R4VHlwZX0gZmlsZS5gOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LWNvbC1tYXAnKS5pbm5lckhUTUwgPSBmaWVsZHMubWFwKGYgPT4gYAogICAgPGRpdiBjbGFzcz0iaW1wb3J0LWNvbC1yb3ciPgogICAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtY29sLWZpZWxkIj4ke2YubGFiZWx9JHtmLnJlcXVpcmVkPycgKic6Jyd9PC9kaXY+CiAgICAgIDxzZWxlY3QgY2xhc3M9ImltcG9ydC1jb2wtc2VsZWN0IiBpZD0iaW1hcC0ke2Yua2V5fSIgb25jaGFuZ2U9InVwZGF0ZVR4UHJldmlldygpIj4KICAgICAgICA8b3B0aW9uIHZhbHVlPSItMSI+4oCUIHNraXAg4oCUPC9vcHRpb24+CiAgICAgICAgJHtoZWFkZXJzLm1hcCgoaCxpKSA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtpfSIgJHtjb2xNYXBbZi5rZXldPT09aT8nc2VsZWN0ZWQnOicnfT4ke2h9PC9vcHRpb24+YCkuam9pbignJyl9CiAgICAgIDwvc2VsZWN0PgogICAgPC9kaXY+CiAgYCkuam9pbignJyk7CgogIHVwZGF0ZVR4UHJldmlldygpOwogIGdvVG9JbXBvcnRTdGVwKCd0cmFuc2FjdGlvbnMnLCAnc3RlcDInKTsKfQoKZnVuY3Rpb24gdXBkYXRlVHhQcmV2aWV3KCkgewogIGNvbnN0IHsgcm93cywgaGVhZGVycyB9ID0gaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zOwogIGNvbnN0IGdldENvbCA9IGtleSA9PiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaW1hcC0ke2tleX1gKT8udmFsdWUgPz8gJy0xJyk7CiAgY29uc3QgcHJldmlldyA9IHJvd3Muc2xpY2UoMCwgNSkubWFwKHJvdyA9PiAoewogICAgRGF0ZTogcm93W2dldENvbCgnZGF0ZScpXSB8fCAnJywKICAgIENhdGVnb3J5OiByb3dbZ2V0Q29sKCdjYXRlZ29yeScpXSB8fCAnJywKICAgIEFtb3VudDogcm93W2dldENvbCgnYW1vdW50JyldIHx8ICcnLAogICAgRGVzY3JpcHRpb246IHJvd1tnZXRDb2woJ2Rlc2NyaXB0aW9uJyldIHx8ICcnLAogIH0pKTsKICBjb25zdCB0YmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LXByZXZpZXctdGFibGUnKTsKICBpZiAoIXRibCkgcmV0dXJuOwogIGNvbnN0IGNvbHMgPSBbJ0RhdGUnLCdDYXRlZ29yeScsJ0Ftb3VudCcsJ0Rlc2NyaXB0aW9uJ107CiAgdGJsLmlubmVySFRNTCA9IGA8dGhlYWQ+PHRyPiR7Y29scy5tYXAoYz0+YDx0aD4ke2N9PC90aD5gKS5qb2luKCcnKX08L3RyPjwvdGhlYWQ+PHRib2R5PiR7CiAgICBwcmV2aWV3Lm1hcChyID0+IGA8dHI+JHtjb2xzLm1hcChjPT5gPHRkPiR7cltjXX08L3RkPmApLmpvaW4oJycpfTwvdHI+YCkuam9pbignJykKICB9PC90Ym9keT5gOwp9CgpmdW5jdGlvbiBnb1RvSW1wb3J0U3RlcCh0eXBlLCBzdGVwKSB7CiAgaWYgKHR5cGUgPT09ICd0cmFuc2FjdGlvbnMnKSB7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjaXNlYy10cmFuc2FjdGlvbnMgLmltcG9ydC1zdGVwJykuZm9yRWFjaChzID0+IHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaXR4LSR7c3RlcH1gKTsKICAgIGlmIChlbCkgZWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICBpZiAoc3RlcCA9PT0gJ3N0ZXAzJykgYnVpbGRDYXRSZXZpZXcoKTsKICAgIGlmIChzdGVwID09PSAnc3RlcDQnKSBidWlsZEZpbmFsUHJldmlldygpOwogIH0KfQoKZnVuY3Rpb24gYnVpbGRDYXRSZXZpZXcoKSB7CiAgY29uc3QgeyByb3dzLCBoZWFkZXJzLCBjYXRNZXJnZXMgfSA9IGltcG9ydFN0YXRlLnRyYW5zYWN0aW9uczsKICBjb25zdCBnZXRDb2wgPSBrZXkgPT4gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGltYXAtJHtrZXl9YCk/LnZhbHVlID8/ICctMScpOwogIGNvbnN0IGNhdENvbCA9IGdldENvbCgnY2F0ZWdvcnknKTsKICBpZiAoY2F0Q29sIDwgMCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LWNhdC1yZXZpZXcnKS5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC1zaXplOjAuODVlbTsiPk5vIGNhdGVnb3J5IGNvbHVtbiBzZWxlY3RlZC48L2Rpdj4nOyByZXR1cm47IH0KCiAgY29uc3QgcmF3Q2F0cyA9IFsuLi5uZXcgU2V0KHJvd3MubWFwKHIgPT4gU3RyaW5nKHJbY2F0Q29sXSB8fCAnJykudHJpbSgpKS5maWx0ZXIoQm9vbGVhbikpXS5zb3J0KCk7CgogIC8vIERldGVjdCBuZWFyLWR1cGxpY2F0ZXM6IHRyaW0sIGxvd2VyY2FzZSwgcmVtb3ZlIHRyYWlsaW5nIHNwYWNlcwogIGNvbnN0IGdyb3VwcyA9IHt9OwogIHJhd0NhdHMuZm9yRWFjaChjYXQgPT4gewogICAgY29uc3Qgbm9ybSA9IGNhdC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCAnICcpLnRyaW0oKTsKICAgIGlmICghZ3JvdXBzW25vcm1dKSBncm91cHNbbm9ybV0gPSBbXTsKICAgIGdyb3Vwc1tub3JtXS5wdXNoKGNhdCk7CiAgfSk7CgogIC8vIEZsYWcgZ3JvdXBzIHdpdGggbXVsdGlwbGUgcmF3IHZhbHVlcyBhcyBkdXBsaWNhdGVzCiAgY29uc3QgZHVwcyA9IE9iamVjdC5lbnRyaWVzKGdyb3VwcykuZmlsdGVyKChbLGNhdHNdKSA9PiBjYXRzLmxlbmd0aCA+IDEpOwogIGNvbnN0IHNpbmdsZXMgPSBPYmplY3QuZW50cmllcyhncm91cHMpLmZpbHRlcigoWyxjYXRzXSkgPT4gY2F0cy5sZW5ndGggPT09IDEpOwoKICBsZXQgaHRtbCA9ICcnOwogIGlmIChkdXBzLmxlbmd0aCA9PT0gMCkgewogICAgaHRtbCA9IGA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEZCRjM7Ym9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMtc20pO3BhZGRpbmc6MTJweDtjb2xvcjojMTBCOTgxO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtO21hcmdpbi1ib3R0b206MTJweDsiPuKchSBObyBkdXBsaWNhdGUgY2F0ZWdvcmllcyBkZXRlY3RlZCDigJQgJHtyYXdDYXRzLmxlbmd0aH0gdW5pcXVlIGNhdGVnb3JpZXMgZm91bmQ8L2Rpdj5gOwogIH0gZWxzZSB7CiAgICBodG1sID0gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi1ib3R0b206MTBweDsiPiR7ZHVwcy5sZW5ndGh9IHBvc3NpYmxlIGR1cGxpY2F0ZShzKSBmb3VuZCDigJQgcmV2aWV3IGFuZCBjaG9vc2UgYWN0aW9uOjwvZGl2PmA7CiAgICBkdXBzLmZvckVhY2goKFtub3JtLCBjYXRzXSkgPT4gewogICAgICBjb25zdCBpc01lcmdlZCA9IGNhdE1lcmdlc1tub3JtXSAhPT0gdW5kZWZpbmVkOwogICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJjYXQtcmV2aWV3LWl0ZW0iPgogICAgICAgIDxzcGFuIGNsYXNzPSJjYXQtcmV2aWV3LWZsYWcgZHVwIj7imqDvuI8gRHVwbGljYXRlPC9zcGFuPgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1yZXZpZXctbmFtZXMiPiR7Y2F0cy5tYXAoYz0+YCIke2N9ImApLmpvaW4oJyArICcpfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1yZXZpZXctYWN0aW9uIj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImNhdC1tZXJnZS1idG4gJHtpc01lcmdlZCYmY2F0TWVyZ2VzW25vcm1dPT09','Y2F0c1swXT8nYWN0aXZlJzonJ30iIG9uY2xpY2s9InNldENhdE1lcmdlKCcke25vcm19JywnJHtjYXRzWzBdLnJlcGxhY2UoLycvZywiXFwnIil9JykiPk1lcmdlIOKGkiAiJHtjYXRzWzBdfSI8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImNhdC1rZWVwLWJ0biIgb25jbGljaz0ic2V0Q2F0S2VlcCgnJHtub3JtfScpIj5LZWVwIHNlcGFyYXRlPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PmA7CiAgICB9KTsKICB9CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtY2F0LXJldmlldycpLmlubmVySFRNTCA9IGh0bWw7Cn0KCmZ1bmN0aW9uIHNldENhdE1lcmdlKG5vcm0sIGNhbm9uaWNhbCkgewogIGltcG9ydFN0YXRlLnRyYW5zYWN0aW9ucy5jYXRNZXJnZXNbbm9ybV0gPSBjYW5vbmljYWw7CiAgYnVpbGRDYXRSZXZpZXcoKTsKICBzaG93VG9hc3QoYE1lcmdlZCDihpIgIiR7Y2Fub25pY2FsfSJgKTsKfQoKZnVuY3Rpb24gc2V0Q2F0S2VlcChub3JtKSB7CiAgZGVsZXRlIGltcG9ydFN0YXRlLnRyYW5zYWN0aW9ucy5jYXRNZXJnZXNbbm9ybV07CiAgYnVpbGRDYXRSZXZpZXcoKTsKfQoKZnVuY3Rpb24gYnVpbGRGaW5hbFByZXZpZXcoKSB7CiAgY29uc3QgcmVjb3JkcyA9IGJ1aWxkVHhSZWNvcmRzKCk7CiAgY29uc3QgbW9udGhDb3VudHMgPSB7fTsKICByZWNvcmRzLmZvckVhY2gociA9PiB7IG1vbnRoQ291bnRzW3IuX21vbnRoXSA9IChtb250aENvdW50c1tyLl9tb250aF18fDApKzE7IH0pOwogIGNvbnN0IHRvdGFsQW10ID0gcmVjb3Jkcy5yZWR1Y2UoKHMscik9PnMrci5hbW91bnQsMCk7CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtc3VtbWFyeS1ncmlkJykuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4ke3JlY29yZHMubGVuZ3RofTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+VHJhbnNhY3Rpb25zPC9kaXY+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtc3VtbWFyeS1ib3giPjxkaXYgY2xhc3M9ImlzYi1udW0iPiR7T2JqZWN0LmtleXMobW9udGhDb3VudHMpLmxlbmd0aH08L2Rpdj48ZGl2IGNsYXNzPSJpc2ItbGFiZWwiPk1vbnRoczwvZGl2PjwvZGl2PgogICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4ke2ZtdCh0b3RhbEFtdCl9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5Ub3RhbDwvZGl2PjwvZGl2PgogIGA7CgogIGNvbnN0IHByZXZpZXcgPSByZWNvcmRzLnNsaWNlKDAsIDIwKTsKICBjb25zdCB0YmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LWZpbmFsLXRhYmxlJyk7CiAgdGJsLmlubmVySFRNTCA9IGA8dGhlYWQ+PHRyPjx0aD5EYXRlPC90aD48dGg+Q2F0ZWdvcnk8L3RoPjx0aD5BbW91bnQ8L3RoPjx0aD5EZXNjcmlwdGlvbjwvdGg+PC90cj48L3RoZWFkPjx0Ym9keT4kewogICAgcHJldmlldy5tYXAocj0+YDx0cj48dGQ+JHtyLmRhdGV9PC90ZD48dGQ+JHtyLmNhdGVnb3J5fTwvdGQ+PHRkPiR7Zm10KHIuYW1vdW50KX08L3RkPjx0ZD4ke3IuZGVzY3JpcHRpb258fCcnfTwvdGQ+PC90cj5gKS5qb2luKCcnKQogIH0ke3JlY29yZHMubGVuZ3RoPjIwP2A8dHI+PHRkIGNvbHNwYW49IjQiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXN0eWxlOml0YWxpYzsiPi4uLiBhbmQgJHtyZWNvcmRzLmxlbmd0aC0yMH0gbW9yZTwvdGQ+PC90cj5gOicnfTwvdGJvZHk+YDsKfQoKZnVuY3Rpb24gYnVpbGRUeFJlY29yZHMoKSB7CiAgY29uc3QgeyByb3dzLCBjYXRNZXJnZXMgfSA9IGltcG9ydFN0YXRlLnRyYW5zYWN0aW9uczsKICBjb25zdCBnZXRDb2wgPSBrZXkgPT4gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGltYXAtJHtrZXl9YCk/LnZhbHVlID8/ICctMScpOwogIGNvbnN0IGRhdGVDb2wgPSBnZXRDb2woJ2RhdGUnKSwgY2F0Q29sID0gZ2V0Q29sKCdjYXRlZ29yeScpLCBhbXRDb2wgPSBnZXRDb2woJ2Ftb3VudCcpLCBkZXNjQ29sID0gZ2V0Q29sKCdkZXNjcmlwdGlvbicpOwogIGNvbnN0IHR4VHlwZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9Iml0eC10eXBlIl06Y2hlY2tlZCcpPy52YWx1ZSB8fCAnZXhwZW5zZSc7CiAgY29uc3QgcmVjb3JkcyA9IFtdOwoKICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgIGNvbnN0IHJhd0RhdGUgPSBTdHJpbmcocm93W2RhdGVDb2xdIHx8ICcnKS50cmltKCk7CiAgICBsZXQgZGF0ZVN0ciA9ICcnOwogICAgaWYgKHJhd0RhdGUpIHsKICAgICAgLy8gSGFuZGxlIEV4Y2VsIGRhdGUgZm9ybWF0cwogICAgICBjb25zdCBkID0gbmV3IERhdGUocmF3RGF0ZSk7CiAgICAgIGlmICghaXNOYU4oZCkpIGRhdGVTdHIgPSBkLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgICAgZWxzZSBkYXRlU3RyID0gcmF3RGF0ZS5zdWJzdHJpbmcoMCwxMCk7CiAgICB9CiAgICBpZiAoIWRhdGVTdHIgfHwgZGF0ZVN0ciA9PT0gJ05hTi1hTi1hTicpIHJldHVybjsKCiAgICBjb25zdCBtb250aEtleSA9IGRhdGVTdHIuc3Vic3RyaW5nKDAsNyk7CiAgICBsZXQgcmF3Q2F0ID0gU3RyaW5nKHJvd1tjYXRDb2xdIHx8ICcnKS50cmltKCk7CiAgICBjb25zdCBub3JtID0gcmF3Q2F0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXHMrL2csJyAnKS50cmltKCk7CiAgICBpZiAoY2F0TWVyZ2VzW25vcm1dKSByYXdDYXQgPSBjYXRNZXJnZXNbbm9ybV07CgogICAgY29uc3QgcmF3QW10ID0gU3RyaW5nKHJvd1thbXRDb2xdIHx8ICcwJykucmVwbGFjZSgvWyQsXS9nLCcnKTsKICAgIGNvbnN0IGFtb3VudCA9IE1hdGguYWJzKHBhcnNlRmxvYXQocmF3QW10KSB8fCAwKTsKICAgIGlmICghYW1vdW50ICYmICFyYXdDYXQpIHJldHVybjsKCiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGRlc2NDb2wgPj0gMCA/IFN0cmluZyhyb3dbZGVzY0NvbF0gfHwgJycpLnRyaW0oKSA6ICcnOwogICAgcmVjb3Jkcy5wdXNoKHsgZGF0ZTogZGF0ZVN0ciwgY2F0ZWdvcnk6IHJhd0NhdCwgYW1vdW50LCBkZXNjcmlwdGlvbiwgX21vbnRoOiBtb250aEtleSwgX3R5cGU6IHR4VHlwZSB9KTsKICB9KTsKICByZXR1cm4gcmVjb3JkczsKfQoKZnVuY3Rpb24gY29uZmlybUltcG9ydCh0eXBlKSB7CiAgaWYgKHR5cGUgIT09ICd0cmFuc2FjdGlvbnMnKSByZXR1cm47CiAgY29uc3QgcmVjb3JkcyA9IGJ1aWxkVHhSZWNvcmRzKCk7CiAgaWYgKHJlY29yZHMubGVuZ3RoID09PSAwKSB7IHNob3dUb2FzdCgnTm8gdmFsaWQgcmVjb3JkcyB0byBpbXBvcnQg4p2MJyk7IHJldHVybjsgfQoKICBjb25zdCB0eXBlTWFwID0geyBleHBlbnNlOiAnZXhwZW5zZXMnLCBpbmNvbWU6ICdpbmNvbWUnLCBpbnZlc3RtZW50OiAnaW52ZXN0bWVudHMnIH07CiAgbGV0IGltcG9ydGVkID0gMDsKCiAgcmVjb3Jkcy5mb3JFYWNoKHIgPT4gewogICAgZW5zdXJlTW9udGgoci5fbW9udGgpOwogICAgY29uc3QgbGlzdEtleSA9IHR5cGVNYXBbci5fdHlwZV0gfHwgJ2V4cGVuc2VzJzsKICAgIGNvbnN0IGVudHJ5ID0geyBkYXRlOiByLmRhdGUsIGNhdGVnb3J5OiByLmNhdGVnb3J5LCBhbW91bnQ6IHIuYW1vdW50LCBkZXNjcmlwdGlvbjogci5kZXNjcmlwdGlvbiwgY3VycmVuY3k6IGN1cnJlbnRDdXJyZW5jeS5jb2RlIH07CiAgICBkYXRhW3IuX21vbnRoXVtsaXN0S2V5XS5wdXNoKGVudHJ5KTsKICAgIGltcG9ydGVkKys7CiAgfSk7CgogIHNhdmUoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LWRvbmUtdGl0bGUnKS50ZXh0Q29udGVudCA9IGBJbXBvcnQgQ29tcGxldGUhIPCfjolgOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtZG9uZS1zdWInKS50ZXh0Q29udGVudCA9IGAke2ltcG9ydGVkfSB0cmFuc2FjdGlvbnMgbG9hZGVkIGFjcm9zcyAke25ldyBTZXQocmVjb3Jkcy5tYXAocj0+ci5fbW9udGgpKS5zaXplfSBtb250aHNgOwogIGdvVG9JbXBvcnRTdGVwKCd0cmFuc2FjdGlvbnMnLCAnc3RlcDUnKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgJHtpbXBvcnRlZH0gdHJhbnNhY3Rpb25zIGltcG9ydGVkIWApOwp9CgpmdW5jdGlvbiByZXNldEltcG9ydFN0ZXAodHlwZSkgewogIGlmICh0eXBlID09PSAndHJhbnNhY3Rpb25zJykgewogICAgaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zID0geyByb3dzOiBbXSwgaGVhZGVyczogW10sIHR5cGU6ICdleHBlbnNlJywgY29sTWFwOiB7fSwgY2F0TWVyZ2VzOiB7fSB9OwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2lzZWMtdHJhbnNhY3Rpb25zIC5pbXBvcnQtc3RlcCcpLmZvckVhY2gocyA9PiBzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtc3RlcDEnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICB9Cn0KCi8vIOKUgOKUgCBHSVZFTiBUTyBPVEhFUlMg4pSA4pSACmZ1bmN0aW9uIHByb2Nlc3NHaXZlbkltcG9ydChyb3dzLCBoZWFkZXJzKSB7CiAgY29uc3QgZmluZCA9IGt3cyA9PiBoZWFkZXJzLmZpbmRJbmRleChoID0+IGt3cy5zb21lKGsgPT4gaC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGspKSk7CiAgY29uc3QgZGF0ZUNvbCA9IGZpbmQoWydkYXRlJ10pLCBjYXRDb2wgPSBmaW5kKFsnY2F0ZWdvcnknLCdwZXJzb24nLCduYW1lJ10pLCBhbXRDb2wgPSBmaW5kKFsnYW1vdW50JywnYW10J10pLCBkZXNjQ29sID0gZmluZChbJ2Rlc2MnLCdub3RlJ10pOwoKICBpZiAoZGF0ZUNvbCA8IDAgfHwgY2F0Q29sIDwgMCB8fCBhbXRDb2wgPCAwKSB7IHNob3dUb2FzdCgnQ291bGQgbm90IGRldGVjdCByZXF1aXJlZCBjb2x1bW5zIOKdjCcpOyByZXR1cm47IH0KCiAgbGV0IGltcG9ydGVkID0gMDsKICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgIGNvbnN0IHJhd0RhdGUgPSBTdHJpbmcocm93W2RhdGVDb2xdfHwnJykudHJpbSgpOwogICAgY29uc3QgZCA9IG5ldyBEYXRlKHJhd0RhdGUpOwogICAgaWYgKGlzTmFOKGQpKSByZXR1cm47CiAgICBjb25zdCBkYXRlU3RyID0gZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICBjb25zdCBtb250aEtleSA9IGRhdGVTdHIuc3Vic3RyaW5nKDAsNyk7CiAgICBlbnN1cmVNb250aChtb250aEtleSk7CiAgICBjb25zdCBhbW91bnQgPSBNYXRoLmFicyhwYXJzZUZsb2F0KFN0cmluZyhyb3dbYW10Q29sXXx8JzAnKS5yZXBsYWNlKC9bJCxdL2csJycpKXx8MCk7CiAgICBpZiAoIWFtb3VudCkgcmV0dXJuOwogICAgY29uc3QgZW50cnkgPSB7IGRhdGU6IGRhdGVTdHIsIGNhdGVnb3J5OiBTdHJpbmcocm93W2NhdENvbF18fCcnKS50cmltKCksIGFtb3VudCwgZGVzY3JpcHRpb246IGRlc2NDb2w+PTA/U3RyaW5nKHJvd1tkZXNjQ29sXXx8JycpLnRyaW0oKTonJywgY3VycmVuY3k6IGN1cnJlbnRDdXJyZW5jeS5jb2RlIH07CiAgICBpZiAoIWRhdGFbbW9udGhLZXldLmdpdmVuVG9PdGhlcnMpIGRhdGFbbW9udGhLZXldLmdpdmVuVG9PdGhlcnMgPSBbXTsKICAgIGRhdGFbbW9udGhLZXldLmdpdmVuVG9PdGhlcnMucHVzaChlbnRyeSk7CiAgICBpbXBvcnRlZCsrOwogIH0pOwoKICBzYXZlKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckdpdmVuTGVkZ2VyKCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dpdmVuLWxlZGdlci1saXN0Jyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IGJhbGFuY2VzID0ge307CiAgT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKGs9PiFrLnN0YXJ0c1dpdGgoJ18nKSkuZm9yRWFjaChtaz0+ewogICAgKGRhdGFbbWtdLmdpdmVuVG9PdGhlcnN8fFtdKS5mb3JFYWNoKGU9PnsKICAgICAgYmFsYW5jZXNbZS5jYXRlZ29yeV0gPSAoYmFsYW5jZXNbZS5jYXRlZ29yeV18fDApICsgY29udmVydEFtdChlLmFtb3VudCwgZS5jdXJyZW5jeSk7CiAgICB9KTsKICB9KTsKICBjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJp','ZXMoYmFsYW5jZXMpOwogIGlmICghZW50cmllcy5sZW5ndGgpIHsgZWwuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc2l6ZTowLjgyZW07cGFkZGluZzo4cHggMDsiPk5vIGdpdmVuLXRvLW90aGVycyBkYXRhIHlldDwvZGl2Pic7IHJldHVybjsgfQogIGNvbnN0IHRvdGFsID0gZW50cmllcy5yZWR1Y2UoKHMsWyx2XSk9PnMrdiwwKTsKICBlbC5pbm5lckhUTUwgPSBlbnRyaWVzLnNvcnQoKGEsYik9PmJbMV0tYVsxXSkubWFwKChbbmFtZSwgdmFsXSkgPT4KICAgIGA8ZGl2IGNsYXNzPSJnaXZlbi1sZWRnZXItcm93Ij48ZGl2PjxkaXYgY2xhc3M9ImdpdmVuLXBlcnNvbiI+JHtuYW1lfTwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7Ij5PdXRzdGFuZGluZzwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9ImdpdmVuLXRvdGFsIj4ke2ZtdCh2YWwpfTwvZGl2PjwvZGl2PmAKICApLmpvaW4oJycpICsgYDxkaXYgc3R5bGU9ImJvcmRlci10b3A6MnB4IHNvbGlkIHZhcigtLXllbGxvdyk7bWFyZ2luLXRvcDo4cHg7cGFkZGluZy10b3A6OHB4O2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbjtmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOTJlbTsiPjxzcGFuPlRvdGFsPC9zcGFuPjxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ij4ke2ZtdCh0b3RhbCl9PC9zcGFuPjwvZGl2PmA7Cn0KCi8vIOKUgOKUgCBNRVRBTFMgSU1QT1JURVIg4pSA4pSACgovLyDilIDilIAgUHJldmlldyBoZWxwZXJzIGZvciBNZXRhbHMgLyBHaXZlbiAvIFJFIGltcG9ydHMg4pSA4pSACgpsZXQgX21ldGFsc1ByZXZpZXdSb3dzID0gW10sIF9tZXRhbHNQcmV2aWV3SGVhZGVycyA9IFtdOwpsZXQgX2dpdmVuUHJldmlld1Jvd3MgID0gW10sIF9naXZlblByZXZpZXdIZWFkZXJzICA9IFtdOwpsZXQgX3JlUHJldmlld1Jvd3MgICAgID0gW10sIF9yZVByZXZpZXdIZWFkZXJzICAgICA9IFtdOwoKZnVuY3Rpb24gX2J1aWxkUHJldmlld1RhYmxlKGhlYWRlcnMsIHJvd3MsIG1heFJvd3M9NSkgewogIGNvbnN0IGRpc3BsYXkgPSByb3dzLnNsaWNlKDAsIG1heFJvd3MpOwogIGNvbnN0IHRoID0gaGVhZGVycy5tYXAoaD0+YDx0aCBzdHlsZT0icGFkZGluZzo2cHggMTBweDtiYWNrZ3JvdW5kOiNGMEYwRjA7Zm9udC1zaXplOjAuNzVlbTtmb250LXdlaWdodDo4MDA7d2hpdGUtc3BhY2U6bm93cmFwOyI+JHtofTwvdGg+YCkuam9pbignJyk7CiAgY29uc3QgdHJzID0gZGlzcGxheS5tYXAocj0+Jzx0cj4nK2hlYWRlcnMubWFwKChfLGkpPT5gPHRkIHN0eWxlPSJwYWRkaW5nOjVweCAxMHB4O2ZvbnQtc2l6ZTowLjc4ZW07Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0YwRjBGMDsiPiR7cltpXXx8Jyd9PC90ZD5gKS5qb2luKCcnKSsnPC90cj4nKS5qb2luKCcnKTsKICByZXR1cm4gYDx0YWJsZSBzdHlsZT0iYm9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlO3dpZHRoOjEwMCU7Ij48dGhlYWQ+PHRyPiR7dGh9PC90cj48L3RoZWFkPjx0Ym9keT4ke3Ryc308L3Rib2R5PjwvdGFibGU+YDsKfQoKZnVuY3Rpb24gc2hvd01ldGFsc1ByZXZpZXcocm93cywgaGVhZGVycykgewogIF9tZXRhbHNQcmV2aWV3Um93cyA9IHJvd3M7IF9tZXRhbHNQcmV2aWV3SGVhZGVycyA9IGhlYWRlcnM7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtc3RlcDEnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1zdGVwMicpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0YWxzLXByZXZpZXctdGFibGUtd3JhcCcpLmlubmVySFRNTCA9IF9idWlsZFByZXZpZXdUYWJsZShoZWFkZXJzLCByb3dzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldGFscy1zdW1tYXJ5JykuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I0YwRkJGMztib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzoxMHB4IDE0cHg7Y29sb3I6IzEwQjk4MTtmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjAuODVlbTsiPiR7cm93cy5sZW5ndGh9IHJvd3MgZGV0ZWN0ZWQgwrcgUmV2aWV3IGFib3ZlIHRoZW4gY29uZmlybTwvZGl2PmA7Cn0KZnVuY3Rpb24gcmVzZXRNZXRhbHNJbXBvcnQoKSB7CiAgX21ldGFsc1ByZXZpZXdSb3dzPVtdOyBfbWV0YWxzUHJldmlld0hlYWRlcnM9W107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtc3RlcDEnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1zdGVwMicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LXN0ZXAzJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7Cn0KZnVuY3Rpb24gY29uZmlybU1ldGFsc0ltcG9ydCgpIHsKICBjb25zdCBiZWZvcmUgPSAoZGF0YS5fbWV0YWxzfHxbXSkubGVuZ3RoOwogIHByb2Nlc3NNZXRhbHNJbXBvcnQoX21ldGFsc1ByZXZpZXdSb3dzLCBfbWV0YWxzUHJldmlld0hlYWRlcnMpOwogIGNvbnN0IGFmdGVyID0gKGRhdGEuX21ldGFsc3x8W10pLmxlbmd0aDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1zdGVwMicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LXN0ZXAzJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtZG9uZS10aXRsZScpLnRleHRDb250ZW50ID0gKGFmdGVyLWJlZm9yZSkgKyAnIE1ldGFscyBJbXBvcnRlZCEnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LWRvbmUtc3ViJykudGV4dENvbnRlbnQgPSAnVG90YWw6ICcgKyAoZGF0YS5fbWV0YWxzfHxbXSkubGVuZ3RoICsgJyBlbnRyaWVzIGluIHBvcnRmb2xpbyc7CiAgX21ldGFsc1ByZXZpZXdSb3dzPVtdOyBfbWV0YWxzUHJldmlld0hlYWRlcnM9W107Cn0KCmZ1bmN0aW9uIHNob3dHaXZlblByZXZpZXcocm93cywgaGVhZGVycykgewogIF9naXZlblByZXZpZXdSb3dzID0gcm93czsgX2dpdmVuUHJldmlld0hlYWRlcnMgPSBoZWFkZXJzOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LXN0ZXAxJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtc3RlcDInKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdmVuLXByZXZpZXctdGFibGUtd3JhcCcpLmlubmVySFRNTCA9IF9idWlsZFByZXZpZXdUYWJsZShoZWFkZXJzLCByb3dzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdmVuLXN1bW1hcnknKS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDojRjBGQkYzO2JvcmRlci1yYWRpdXM6MTBweDtwYWRkaW5nOjEwcHggMTRweDtjb2xvcjojMTBCOTgxO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtOyI+JHtyb3dzLmxlbmd0aH0gcm93cyBkZXRlY3RlZCDCtyBSZXZpZXcgYWJvdmUgdGhlbiBjb25maXJtPC9kaXY+YDsKfQpmdW5jdGlvbiByZXNldEdpdmVuSW1wb3J0KCkgewogIF9naXZlblByZXZpZXdSb3dzPVtdOyBfZ2l2ZW5QcmV2aWV3SGVhZGVycz1bXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdi1zdGVwMScpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtc3RlcDMnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKfQpmdW5jdGlvbiBjb25maXJtR2l2ZW5JbXBvcnQoKSB7CiAgLy8gQ291bnQgcm93cyB0aGF0IHdpbGwgYmUgaW1wb3J0ZWQgKG5vbi1lbXB0eSB2YWxpZCByb3dzKQogIGNvbnN0IGFkZGVkID0gX2dpdmVuUHJldmlld1Jvd3MuZmlsdGVyKHIgPT4gciAmJiByLmxlbmd0aCA+IDApLmxlbmd0aDsKICBwcm9jZXNzR2l2ZW5JbXBvcnQoX2dpdmVuUHJldmlld1Jvd3MsIF9naXZlblByZXZpZXdIZWFkZXJzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdi1zdGVwMicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LXN0ZXAzJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtZG9uZS10aXRsZScpLnRleHRDb250ZW50ID0gYWRkZWQgKyAnIFJlY29yZHMgSW1wb3J0ZWQhIPCfjoknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LWRvbmUtc3ViJykudGV4dENvbnRlbnQgPSAnWW91ciBHaXZlbiB0byBPdGhlcnMgbGVkZ2VyIGhhcyBiZWVuIHVwZGF0ZWQnOwogIF9naXZlblByZXZpZXdSb3dzPVtdOyBfZ2l2ZW5QcmV2aWV3SGVhZGVycz1bXTsKICByZW5kZXJHaXZlbkxlZGdlcigpOwogIHNob3dUb2FzdCgn4pyFICcgKyBhZGRlZCArICcgR2l2ZW4gdG8gT3RoZXJzIGltcG9ydGVkIScpOwp9CgpmdW5jdGlvbiBzaG93UkVQcmV2aWV3KHJvd3MsIGhlYWRlcnMpIHsKICBfcmVQcmV2aWV3Um93cyA9IHJvd3M7IF9yZVByZXZpZXdIZWFkZXJzID0gaGVhZGVyczsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLXN0ZXAxJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdGVwMicpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtcHJldmlldy10YWJsZS13cmFwJykuaW5uZXJIVE1MID0gX2J1aWxkUHJldmlld1RhYmxlKGhlYWRlcnMsIHJvd3MpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtc3VtbWFyeScpLmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEZCRjM7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6MTBweCAxNHB4O2NvbG9yOiMxMEI5ODE7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTowLjg1ZW07Ij4ke3Jvd3MubGVuZ3RofSBwcm9wZXJ0aWVzIGRldGVjdGVkIMK3IFJldmlldyBhYm92ZSB0aGVuIGNvbmZpcm08L2Rpdj5gOwp9CmZ1bmN0aW9uIHJlc2V0UkVJbXBvcnQoKSB7CiAgX3JlUHJldmlld1Jvd3M9W107IF9yZVByZXZpZXdIZWFkZXJzPVtdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtc3RlcDEnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdGVwMycpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwp9CmZ1bmN0aW9uIGNvbmZpcm1SRUltcG9ydCgpIHsKICBjb25zdCByZUJlZm9yZSA9ICgoZGF0YS5fcmVhbEVzdGF0ZSl8fFtdKS5sZW5ndGg7CiAgcHJvY2Vzc1JFSW1wb3J0KF9yZVByZXZpZXdSb3dzLCBfcmVQcmV2aWV3SGVhZGVycyk7CiAgY29uc3QgcmVBZnRlciA9ICgoZGF0YS5fcmVhbEVzdGF0ZSl8fFtdKS5sZW5ndGg7CiAgY29uc3QgYWRkZWQgPSByZUFmdGVyIC0gcmVCZWZvcmU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdGVwMicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtc3RlcDMnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLWRvbmUtdGl0bGUnKS50ZXh0Q29udGVudCA9IGFkZGVkICsgJyBQcm9wZXJ0aWVzIEltcG9ydGVkISDwn46JJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLWRvbmUtc3ViJykudGV4dENvbnRlbnQgPSAnVG90YWw6ICcgKyByZUFmdGVyICsgJyByZWFsIGVzdGF0ZSBl','bnRyaWVzJzsKICBfcmVQcmV2aWV3Um93cz1bXTsgX3JlUHJldmlld0hlYWRlcnM9W107CiAgc2hvd1RvYXN0KCfinIUgJyArIGFkZGVkICsgJyBwcm9wZXJ0aWVzIGltcG9ydGVkIScpOwp9CgpmdW5jdGlvbiBwcm9jZXNzTWV0YWxzSW1wb3J0KHJvd3MsIGhlYWRlcnMpIHsKICBjb25zdCBmaW5kID0ga3dzID0+IGhlYWRlcnMuZmluZEluZGV4KGggPT4ga3dzLnNvbWUoayA9PiBoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaykpKTsKICBjb25zdCBtZXRhbENvbCA9IGZpbmQoWydtZXRhbCddKSwgcHVyaXR5Q29sID0gZmluZChbJ3B1cml0eSddKSwgb2NjYXNpb25Db2wgPSBmaW5kKFsnb2NjYXNpb24nXSksIGl0ZW1Db2wgPSBmaW5kKFsnaXRlbScsJ25hbWUnXSksIHdlaWdodENvbCA9IGZpbmQoWyd3ZWlnaHQnLCdncmFtcycsJ2dyYW0nLCd3dCddKTsKCiAgaWYgKG1ldGFsQ29sIDwgMCB8fCB3ZWlnaHRDb2wgPCAwKSB7IHNob3dUb2FzdCgnQ291bGQgbm90IGRldGVjdCBNZXRhbCBhbmQgV2VpZ2h0IGNvbHVtbnMg4p2MJyk7IHJldHVybjsgfQoKICBsZXQgaW1wb3J0ZWQgPSAwOwogIGlmICghZGF0YS5fbWV0YWxzKSBkYXRhLl9tZXRhbHMgPSBbXTsKICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgIGNvbnN0IG1ldGFsUmF3ID0gU3RyaW5nKHJvd1ttZXRhbENvbF18fCcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgIGNvbnN0IG1ldGFsVHlwZSA9IG1ldGFsUmF3LmluY2x1ZGVzKCdnb2xkJykgPyAnZ29sZCcgOiBtZXRhbFJhdy5pbmNsdWRlcygnc2lsdmVyJykgPyAnc2lsdmVyJyA6IG1ldGFsUmF3LmluY2x1ZGVzKCdwbGF0aW51bScpID8gJ3BsYXRpbnVtJyA6ICdnb2xkJzsKICAgIGNvbnN0IGdyYW1zID0gcGFyc2VGbG9hdChTdHJpbmcocm93W3dlaWdodENvbF18fCcwJykucmVwbGFjZSgvW15cZC5dL2csJycpKXx8MDsKICAgIGlmICghZ3JhbXMpIHJldHVybjsKICAgIGRhdGEuX21ldGFscy5wdXNoKHsKICAgICAgbWV0YWxUeXBlLAogICAgICBuYW1lOiBpdGVtQ29sID49IDAgPyBTdHJpbmcocm93W2l0ZW1Db2xdfHwnJykudHJpbSgpIDogbWV0YWxUeXBlLAogICAgICBncmFtcywKICAgICAgcHJpY2U6IE1FVEFMX0NPTkZJR1ttZXRhbFR5cGVdPy5wcmljZVBlckdyYW0gfHwgMCwKICAgICAgZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sCiAgICAgIGZvcm06ICdKZXdlbHJ5JywKICAgICAgcHVyaXR5OiBwdXJpdHlDb2wgPj0gMCA/IFN0cmluZyhyb3dbcHVyaXR5Q29sXXx8JycpLnRyaW0oKSA6ICcnLAogICAgICBvY2Nhc2lvbjogb2NjYXNpb25Db2wgPj0gMCA/IFN0cmluZyhyb3dbb2NjYXNpb25Db2xdfHwnJykudHJpbSgpIDogJycsCiAgICB9KTsKICAgIGltcG9ydGVkKys7CiAgfSk7CgogIHNhdmUoKTsKfQoKLy8g4pSA4pSAIFJFQUwgRVNUQVRFIElNUE9SVEVSIOKUgOKUgApmdW5jdGlvbiBwcm9jZXNzUkVJbXBvcnQocm93cywgaGVhZGVycykgewogIGNvbnN0IGZpbmQgPSBrd3MgPT4gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBrd3Muc29tZShrID0+IGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrKSkpOwogIGNvbnN0IGRhdGVDb2wgPSBmaW5kKFsnZGF0ZSddKSwgY291bnRyeUNvbCA9IGZpbmQoWydjb3VudHJ5J10pLCBjdXJyZW5jeUNvbCA9IGZpbmQoWydjdXJyZW5jeScsJ2N1cnInXSksCiAgICAgICAgcHZDb2wgPSBmaW5kKFsncHVyY2hhc2UnXSksIGRlc2NDb2wgPSBmaW5kKFsnZGVzYycsJ2Rlc2NyaXB0aW9uJ10pLCBhcmVhQ29sID0gZmluZChbJ2FyZWEnXSksCiAgICAgICAgY3ZDb2wgPSBmaW5kKFsnY3VycmVudCddKTsKCiAgbGV0IGltcG9ydGVkID0gMDsKICBjb25zdCByZUFzc2V0cyA9IGdldFJlYWxFc3RhdGVBc3NldHMoKTsKICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgIGNvbnN0IGRlc2MgPSBkZXNjQ29sID49IDAgPyBTdHJpbmcocm93W2Rlc2NDb2xdfHwnJykudHJpbSgpIDogJyc7CiAgICBjb25zdCBwdiA9IHBhcnNlRmxvYXQoU3RyaW5nKHJvd1twdkNvbD49MD9wdkNvbDowXXx8JzAnKS5yZXBsYWNlKC9bXlxkLl0vZywnJykpfHwwOwogICAgaWYgKCFwdiAmJiAhZGVzYykgcmV0dXJuOwogICAgY29uc3QgcmF3RGF0ZSA9IGRhdGVDb2wgPj0gMCA/IFN0cmluZyhyb3dbZGF0ZUNvbF18fCcnKSA6ICcnOwogICAgY29uc3QgZCA9IG5ldyBEYXRlKHJhd0RhdGUpOwogICAgY29uc3QgZGF0ZVN0ciA9ICFpc05hTihkKSA/IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICByZUFzc2V0cy5wdXNoKHsKICAgICAgZGF0ZTogZGF0ZVN0ciwKICAgICAgY291bnRyeTogY291bnRyeUNvbCA+PSAwID8gU3RyaW5nKHJvd1tjb3VudHJ5Q29sXXx8JycpLnRyaW0oKSA6ICdVUycsCiAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeUNvbCA+PSAwID8gU3RyaW5nKHJvd1tjdXJyZW5jeUNvbF18fCdVU0QnKS50cmltKCkudG9VcHBlckNhc2UoKSA6ICdVU0QnLAogICAgICBwdXJjaGFzZVZhbHVlOiBwdiwKICAgICAgY3VycmVudFZhbHVlOiBjdkNvbCA+PSAwID8gcGFyc2VGbG9hdChTdHJpbmcocm93W2N2Q29sXXx8JzAnKS5yZXBsYWNlKC9bXlxkLl0vZywnJykpfHxwdiA6IHB2LAogICAgICBkZXNjcmlwdGlvbjogZGVzYywKICAgICAgYXJlYTogYXJlYUNvbCA+PSAwID8gU3RyaW5nKHJvd1thcmVhQ29sXXx8JycpLnRyaW0oKSA6ICcnLAogICAgfSk7CiAgICBpbXBvcnRlZCsrOwogIH0pOwoKICBkYXRhLl9yZWFsRXN0YXRlID0gcmVBc3NldHM7CiAgc2F2ZSgpOwogIHNhdmUoKTsKfQoKLy8g4pSA4pSAIFJFU0VUIOKUgOKUgApmdW5jdGlvbiByZW5kZXJSZXNldFN1bW1hcnkoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXQtZGF0YS1zdW1tYXJ5Jyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IG1vbnRoS2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpLmZpbHRlcihrID0+ICFrLnN0YXJ0c1dpdGgoJ18nKSk7CiAgbGV0IHRvdGFsVHggPSAwOwogIG1vbnRoS2V5cy5mb3JFYWNoKG1rID0+IHsKICAgIFsnZXhwZW5zZXMnLCdpbmNvbWUnLCdpbnZlc3RtZW50cycsJ2RlYnRzJywnZ2l2ZW5Ub090aGVycycsJ2FkZGl0aW9uYWwnXS5mb3JFYWNoKHQgPT4gewogICAgICB0b3RhbFR4ICs9IChkYXRhW21rXVt0XXx8W10pLmxlbmd0aDsKICAgIH0pOwogIH0pOwogIGVsLmlubmVySFRNTCA9IGAKICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDFmcjtnYXA6OHB4OyI+CiAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1zdW1tYXJ5LWJveCI+PGRpdiBjbGFzcz0iaXNiLW51bSI+JHt0b3RhbFR4fTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+VHJhbnNhY3Rpb25zPC9kaXY+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1zdW1tYXJ5LWJveCI+PGRpdiBjbGFzcz0iaXNiLW51bSI+JHttb250aEtleXMubGVuZ3RofTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+TW9udGhzPC9kaXY+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1zdW1tYXJ5LWJveCI+PGRpdiBjbGFzcz0iaXNiLW51bSI+JHsoZGF0YS5fbWV0YWxzfHxbXSkubGVuZ3RofTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+TWV0YWwgSXRlbXM8L2Rpdj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4keyhkYXRhLl9yZWFsRXN0YXRlfHxbXSkubGVuZ3RofTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+UHJvcGVydGllczwvZGl2PjwvZGl2PgogICAgPC9kaXY+CiAgYDsKICAvLyBVcGRhdGUgc3BlY2lmaWMgZGF0YXNldCBjb3VudHMKICBjb25zdCBtZXRhbHNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldC1tZXRhbHMtY291bnQnKTsKICBpZiAobWV0YWxzRWwpIG1ldGFsc0VsLnRleHRDb250ZW50ID0gKGRhdGEuX21ldGFsc3x8W10pLmxlbmd0aCArICcgZW50cmllcyc7CiAgY29uc3QgZ2l2ZW5FbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldC1naXZlbi1jb3VudCcpOwogIGlmIChnaXZlbkVsKSBnaXZlbkVsLnRleHRDb250ZW50ID0gKGRhdGEuX2dpdmVufHxbXSkubGVuZ3RoICsgJyByZWNvcmRzJzsKICBjb25zdCByZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LXJlLWNvdW50Jyk7CiAgaWYgKHJlRWwpIHJlRWwudGV4dENvbnRlbnQgPSAoKGRhdGEuX3JlYWxFc3RhdGV8fHt9KS5hc3NldHN8fFtdKS5sZW5ndGggKyAnIHByb3BlcnRpZXMnOwogIGNvbnN0IG53RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXQtbnctY291bnQnKTsKICBpZiAobndFbCkgbndFbC50ZXh0Q29udGVudCA9IChkYXRhLl9ud0FjY291bnRzfHxbXSkubGVuZ3RoICsgJyBhY2NvdW50cyc7Cn0KCmZ1bmN0aW9uIHJlbmRlck1vbnRoc0xpc3QoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9udGhzLWxpc3QnKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3QgbW9udGhLZXlzID0gT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKGsgPT4gIWsuc3RhcnRzV2l0aCgnXycpICYmIC9eXGR7NH0tXGR7Mn0kLy50ZXN0KGspKS5zb3J0KCkucmV2ZXJzZSgpOwogIGlmICghbW9udGhLZXlzLmxlbmd0aCkgeyBlbC5pbm5lckhUTUwgPSAnPHAgc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc2l6ZTowLjg1ZW07cGFkZGluZzo0cHggMDsiPk5vIG1vbnRoIGRhdGEgeWV0LjwvcD4nOyByZXR1cm47IH0KCiAgLy8gR3JvdXAgYnkgeWVhcgogIGNvbnN0IGJ5WWVhciA9IHt9OwogIG1vbnRoS2V5cy5mb3JFYWNoKG1rID0+IHsgY29uc3QgeXIgPSBtay5zcGxpdCgnLScpWzBdOyBpZiAoIWJ5WWVhclt5cl0pIGJ5WWVhclt5cl09W107IGJ5WWVhclt5cl0ucHVzaChtayk7IH0pOwogIGNvbnN0IHllYXJzID0gT2JqZWN0LmtleXMoYnlZZWFyKS5zb3J0KCkucmV2ZXJzZSgpOwoKICBlbC5pbm5lckhUTUwgPSB5ZWFycy5tYXAoeXIgPT4gewogICAgY29uc3QgbWtzID0gYnlZZWFyW3lyXTsKICAgIGNvbnN0IHlySW5jID0gbWtzLnJlZHVjZSgocyxtayk9PnMrKGRhdGFbbWtdPy5pbmNvbWV8fFtdKS5yZWR1Y2UoKHNpLGUpPT5zaStOdW1iZXIoZS5hbW91bnR8fDApLDApLDApOwogICAgY29uc3QgeXJFeHAgPSBta3MucmVkdWNlKChzLG1rKT0+cysoZGF0YVtta10/LmV4cGVuc2VzfHxbXSkucmVkdWNlKChzaSxlKT0+c2krTnVtYmVyKGUuYW1vdW50fHwwKSwwKSwwKTsKICAgIGNvbnN0IHlyVHggID0gbWtzLnJlZHVjZSgocyxtayk9Pntjb25zdCBtPWRhdGFbbWtdfHx7fTtyZXR1cm4gcysobS5leHBlbnNlc3x8W10pLmxlbmd0aCsobS5pbmNvbWV8fFtdKS5sZW5ndGgrKG0uaW52ZXN0bWVudHN8fFtdKS5sZW5ndGg7fSwwKTsKICAgIGNvbnN0IGNvbElkID0gJ3Jlc2V0LXlyLScgKyB5cjsKCiAgICBjb25zdCBtb250aFJvd3MgPSBta3MubWFwKG1rID0+IHsKICAgICAgY29uc3QgbSA9IGRhdGFbbWtdIHx8IHt9OwogICAgICBjb25zdCB0eENvdW50ID0gKG0uZXhwZW5zZXN8fFtdKS5sZW5ndGggKyAobS5pbmNvbWV8fFtdKS5sZW5ndGggKyAobS5pbnZlc3RtZW50c3x8W10pLmxlbmd0aDsKICAgICAgY29uc3QgaW5jID0gKG0uaW5jb21lfHxbXSkucmVkdWNlKChzLGUpPT5zK051bWJlcihlLmFtb3VudHx8MCksMCk7CiAgICAgIGNvbnN0IGV4cCA9IChtLmV4cGVuc2VzfHxbXSkucmVkdWNlKChzLGUpPT5zK051bWJlcihlLmFtb3VudHx8MCksMCk7CiAgICAgIHJldHVybiBgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjlweCAxNHB4IDlweCAyMHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNGNUY1RjU7Ij4KICAgICAgICA8ZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtm','b250LXNpemU6MC44NWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4ke2dldERpc3BsYXlNb250aChtayl9PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDsiPiR7dHhDb3VudH0gdHhucyDCtyA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0taW5jb21lKTsiPiske2ZtdChpbmMpfTwvc3Bhbj4gwrcgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTsiPi0ke2ZtdChleHApfTwvc3Bhbj48L2Rpdj48L2Rpdj4KICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImRlbGV0ZU1vbnRoKCcke21rfScpIiBzdHlsZT0iYmFja2dyb3VuZDojRkZGMEYwO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6OXB4O3BhZGRpbmc6NXB4IDEwcHg7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjc1ZW07Y29sb3I6dmFyKC0tZXhwZW5zZXMpO2N1cnNvcjpwb2ludGVyO2ZsZXgtc2hyaW5rOjA7Ij7wn5eR77iPPC9idXR0b24+CiAgICAgIDwvZGl2PmA7CiAgICB9KS5qb2luKCcnKTsKCiAgICByZXR1cm4gYDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206NnB4O2JvcmRlcjoxcHggc29saWQgI0VFRTtib3JkZXItcmFkaXVzOjEycHg7b3ZlcmZsb3c6aGlkZGVuOyI+CiAgICAgIDxkaXYgb25jbGljaz0idG9nZ2xlUmVzZXRZZWFyKCcke2NvbElkfScpIiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjExcHggMTRweDtiYWNrZ3JvdW5kOiNGOEY4Rjg7Y3Vyc29yOnBvaW50ZXI7Ij4KICAgICAgICA8ZGl2PjxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOTJlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHt5cn08L3NwYW4+CiAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7bWFyZ2luLWxlZnQ6OHB4OyI+JHtta3MubGVuZ3RofSBtb250aHMgwrcgJHt5clR4fSB0eG5zPC9zcGFuPjwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7Zm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo3MDA7Ij4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWluY29tZSk7Ij4rJHtmbXQoeXJJbmMpfTwvc3Bhbj4gPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTsiPi0ke2ZtdCh5ckV4cCl9PC9zcGFuPjwvZGl2PgogICAgICAgICAgPHNwYW4gaWQ9IiR7Y29sSWR9LWNoZXYiIHN0eWxlPSJmb250LXNpemU6MC44ZW07dHJhbnNpdGlvbjp0cmFuc2Zvcm0gMC4yczsiPuKWvjwvc3Bhbj48L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgaWQ9IiR7Y29sSWR9IiBzdHlsZT0ibWF4LWhlaWdodDoxMjAwcHg7b3ZlcmZsb3c6aGlkZGVuO3RyYW5zaXRpb246bWF4LWhlaWdodCAwLjNzIGVhc2U7Ij4ke21vbnRoUm93c308L2Rpdj4KICAgIDwvZGl2PmA7CiAgfSkuam9pbignJyk7Cn0KCmZ1bmN0aW9uIHRvZ2dsZVJlc2V0WWVhcihpZCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogIGNvbnN0IGNoZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArICctY2hldicpOwogIGlmICghZWwpIHJldHVybjsKICBjb25zdCBpc09wZW4gPSBlbC5zdHlsZS5tYXhIZWlnaHQgIT09ICcwcHgnOwogIGVsLnN0eWxlLm1heEhlaWdodCA9IGlzT3BlbiA/ICcwcHgnIDogJzEyMDBweCc7CiAgaWYgKGNoZXYpIGNoZXYuc3R5bGUudHJhbnNmb3JtID0gaXNPcGVuID8gJ3JvdGF0ZSgtOTBkZWcpJyA6ICcnOwp9CgpmdW5jdGlvbiBjbGVhckRhdGFzZXQodHlwZSkgewogIGNvbnN0IGxhYmVscyA9IHsgbWV0YWxzOidNZXRhbHMgSG9sZGluZ3MnLCBnaXZlbjonR2l2ZW4gdG8gT3RoZXJzJywgcmVhbGVzdGF0ZTonUmVhbCBFc3RhdGUgQXNzZXRzJywgbmV0d29ydGg6J05ldCBXb3J0aCBBY2NvdW50cycgfTsKICBpZiAoIWNvbmZpcm0oYENsZWFyIGFsbCAke2xhYmVsc1t0eXBlXXx8dHlwZX0gZGF0YT8gWW91ciB0cmFuc2FjdGlvbnMgd2lsbCBOT1QgYmUgYWZmZWN0ZWQuYCkpIHJldHVybjsKICBpZiAodHlwZSA9PT0gJ21ldGFscycpICAgICB7IGRhdGEuX21ldGFscyA9IFtdOyB9CiAgaWYgKHR5cGUgPT09ICdnaXZlbicpICAgICAgeyBkYXRhLl9naXZlbiA9IFtdOyB9CiAgaWYgKHR5cGUgPT09ICdyZWFsZXN0YXRlJykgeyBpZiAoZGF0YS5fcmVhbEVzdGF0ZSkgZGF0YS5fcmVhbEVzdGF0ZS5hc3NldHMgPSBbXTsgfQogIGlmICh0eXBlID09PSAnbmV0d29ydGgnKSAgIHsgZGF0YS5fbndBY2NvdW50cyA9IFtdOyB9CiAgc2F2ZSgpOwogIHJlbmRlclJlc2V0U3VtbWFyeSgpOwogIHJlbmRlck1vbnRoc0xpc3QoKTsKICBpZiAodHlwZSA9PT0gJ21ldGFscycpICAgICB7IHRyeSB7IHJlbmRlck1ldGFscygpOyB9IGNhdGNoKGUpe30gfQogIGlmICh0eXBlID09PSAnbmV0d29ydGgnKSAgIHsgdHJ5IHsgcmVuZGVyTmV0V29ydGgoKTsgfSBjYXRjaChlKXt9IH0KICBzaG93VG9hc3QoJ/Cfp7kgJyArIChsYWJlbHNbdHlwZV18fHR5cGUpICsgJyBjbGVhcmVkJyk7Cn0KCmZ1bmN0aW9uIGNvbmZpcm1SZXNldEFsbCgpIHsKICBpZiAoIWNvbmZpcm0oJ+KaoO+4jyBUaGlzIHdpbGwgZGVsZXRlIEFMTCBkYXRhIHBlcm1hbmVudGx5LiBBcmUgeW91IHN1cmU/JykpIHJldHVybjsKICBpZiAoIWNvbmZpcm0oJ/CfmqggRmluYWwgY29uZmlybWF0aW9uIOKAlCBkZWxldGUgZXZlcnl0aGluZz8nKSkgcmV0dXJuOwogIGNvbnN0IGtlZXBLZXlzID0gWydfY3VycmVuY3knLCdfaG9tZVNwZW5kQ2FyZHMnLCdfaG9tZUludkNhcmRzJywnX2N1c3RvbUNhdHMnLCdfZXhwZW5zZUdvYWxzJywnX3NhdmluZ3NHb2FscyddOwogIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2goayA9PiB7IGlmICgha2VlcEtleXMuaW5jbHVkZXMoaykpIGRlbGV0ZSBkYXRhW2tdOyB9KTsKICBzYXZlKCk7CiAgcmVuZGVyUmVzZXRTdW1tYXJ5KCk7CiAgcmVuZGVySG9tZSgpOwogIHNob3dUb2FzdCgn8J+Xke+4jyBBbGwgdHJhbnNhY3Rpb24gZGF0YSBjbGVhcmVkJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBPTkJPQVJESU5HIOKAlCBJbnRybyBzbGlkZXMgKyBDb2FjaCBtYXJrcwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKY29uc3QgT0JfU0VFTl9LRVkgPSAnbWZfb25ib2FyZGluZ19zZWVuJzsKbGV0IG9iQ3VycmVudFNsaWRlID0gMDsKY29uc3QgT0JfVE9UQUwgPSA1OwoKZnVuY3Rpb24gc2hvd09uYm9hcmRpbmcoKSB7CiAgb2JDdXJyZW50U2xpZGUgPSAwOwogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb25ib2FyZGluZy1vdmVybGF5Jyk7CiAgaWYgKCFvdmVybGF5KSByZXR1cm47CiAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRpbmcnKTsKICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgb2JHb1RvKDApOwp9CgpmdW5jdGlvbiBkaXNtaXNzT25ib2FyZGluZygpIHsKICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29uYm9hcmRpbmctb3ZlcmxheScpOwogIGlmICghb3ZlcmxheSkgcmV0dXJuOwogIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnaGlkaW5nJyk7CiAgc2V0VGltZW91dCgoKSA9PiB7CiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGluZycpOwogICAgLy8gQWZ0ZXIgaW50cm8gc2xpZGVzLCBsYXVuY2ggdGhlIGNvYWNoIG1hcmtzIHRvdXIKICAgIHN0YXJ0Q29hY2hUb3VyKCk7CiAgfSwgNjAwKTsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShPQl9TRUVOX0tFWSwgJzEnKTsKfQoKZnVuY3Rpb24gb2JHb1RvKGlkeCkgewogIG9iQ3VycmVudFNsaWRlID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaWR4LCBPQl9UT1RBTCAtIDEpKTsKICBjb25zdCB0cmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvYi10cmFjaycpOwogIGlmICh0cmFjaykgdHJhY2suc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7b2JDdXJyZW50U2xpZGUgKiAxMDB9dncpYDsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcub2ItZG90JykuZm9yRWFjaCgoZCwgaSkgPT4gZC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBpID09PSBvYkN1cnJlbnRTbGlkZSkpOwogIC8vIFJlLXRyaWdnZXIgYW5pbWF0aW9ucwogIGNvbnN0IHNsaWRlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vYi1zbGlkZScpOwogIHNsaWRlcy5mb3JFYWNoKChzLCBpKSA9PiB7CiAgICBpZiAoaSAhPT0gb2JDdXJyZW50U2xpZGUpIHJldHVybjsKICAgIFsnLm9iLXNsaWRlLWFydCcsJy5vYi1zbGlkZS10aXRsZScsJy5vYi1zbGlkZS1kZXNjJ10uZm9yRWFjaChzZWwgPT4gewogICAgICBjb25zdCBlbCA9IHMucXVlcnlTZWxlY3RvcihzZWwpOwogICAgICBpZiAoIWVsKSByZXR1cm47CiAgICAgIGVsLnN0eWxlLmFuaW1hdGlvbiA9ICdub25lJzsgZWwub2Zmc2V0SGVpZ2h0OyBlbC5zdHlsZS5hbmltYXRpb24gPSAnJzsKICAgIH0pOwogIH0pOwogIGNvbnN0IG5leHRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb2ItbmV4dC1idG4nKTsKICBjb25zdCBza2lwQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29iLXNraXAtYnRuJyk7CiAgaWYgKG5leHRCdG4pIG5leHRCdG4udGV4dENvbnRlbnQgPSBvYkN1cnJlbnRTbGlkZSA9PT0gT0JfVE9UQUwgLSAxID8gIlN0YXJ0IFRvdXIg8J+OryIgOiAnTmV4dCDihpInOwogIGlmIChza2lwQnRuKSBza2lwQnRuLnN0eWxlLmRpc3BsYXkgPSBvYkN1cnJlbnRTbGlkZSA9PT0gT0JfVE9UQUwgLSAxID8gJ25vbmUnIDogJyc7Cn0KCmZ1bmN0aW9uIG9iTmV4dCgpIHsKICBpZiAob2JDdXJyZW50U2xpZGUgPCBPQl9UT1RBTCAtIDEpIG9iR29UbyhvYkN1cnJlbnRTbGlkZSArIDEpOwogIGVsc2UgZGlzbWlzc09uYm9hcmRpbmcoKTsKfQoKLy8gU3dpcGUgc3VwcG9ydCBmb3IgaW50cm8gc2xpZGVzCihmdW5jdGlvbigpIHsKICBsZXQgc3ggPSAwLCBzeSA9IDA7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGUgPT4gewogICAgY29uc3Qgb3YgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb25ib2FyZGluZy1vdmVybGF5Jyk7CiAgICBpZiAoIW92IHx8IG92LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgcmV0dXJuOwogICAgc3ggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDsgc3kgPSBlLnRvdWNoZXNbMF0uY2xpZW50WTsKICB9LCB7IHBhc3NpdmU6IHRydWUgfSk7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBlID0+IHsKICAgIGNvbnN0IG92ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29uYm9hcmRpbmctb3ZlcmxheScpOwogICAgaWYgKCFvdiB8fCBvdi5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScpIHJldHVybjsKICAgIGNvbnN0IGR4ID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRYIC0gc3g7CiAgICBjb25zdCBkeSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSAtIHN5OwogICAgaWYgKE1hdGguYWJzKGR4KSA+IE1hdGguYWJzKGR5KSAm','JiBNYXRoLmFicyhkeCkgPiA0MCkKICAgICAgZHggPCAwID8gb2JHb1RvKG9iQ3VycmVudFNsaWRlICsgMSkgOiBvYkdvVG8ob2JDdXJyZW50U2xpZGUgLSAxKTsKICB9LCB7IHBhc3NpdmU6IHRydWUgfSk7Cn0pKCk7CgovLyDilIDilIAgQ09BQ0ggTUFSS1Mg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACi8vIEVhY2ggc3RlcDogeyBzY3JlZW4sIGVsZW1lbnRJZCwgdGl0bGUsIGRlc2MsIHRhZywgYXJyb3cgfQovLyBzY3JlZW4gPSB3aGljaCBzY3JlZW4gdG8gc3dpdGNoIHRvIGJlZm9yZSBzaG93aW5nCi8vIGFycm93ICA9ICd1cCcgfCAnZG93bicgfCAncmlnaHQnIChkaXJlY3Rpb24gb2YgdG9vbHRpcCBhcnJvdyByZWxhdGl2ZSB0byB0b29sdGlwKQpjb25zdCBDT0FDSF9TVEVQUyA9IFsKICB7CiAgICBzY3JlZW46ICdob21lJywKICAgIGVsZW1lbnRJZDogJ2ZhYi1hZGQtYnRuJywKICAgIHRhZzogJ1F1aWNrIEFkZCDCtyBTdGVwIDEgb2YgOScsCiAgICB0aXRsZTogJ+KelSBUaGUgQWRkIEJ1dHRvbicsCiAgICBkZXNjOiAnVGhpcyBnb2xkZW4g77yLIGJ1dHRvbiBpcyB5b3VyIGZhc3Rlc3Qgd2F5IGluLiBUYXAgaXQgZnJvbSBhbnkgc2NyZWVuIHRvIGxvZyBhbiBleHBlbnNlLCBpbmNvbWUsIG9yIGludmVzdG1lbnQgaW4gc2Vjb25kcy4nLAogICAgYXJyb3c6ICdkb3duJwogIH0sCiAgewogICAgc2NyZWVuOiAnaG9tZScsCiAgICBlbGVtZW50SWQ6ICdmbWktZXhwZW5zZScsCiAgICB0YWc6ICdRdWljayBBZGQgwrcgU3RlcCAyIG9mIDknLAogICAgdGl0bGU6ICfwn5K4IExvZyBhbiBFeHBlbnNlJywKICAgIGRlc2M6ICdUYXAg8J+SuCBFeHBlbnNlIHRvIHJlY29yZCBzcGVuZGluZy4gUGljayBhIGNhdGVnb3J5LCBlbnRlciB0aGUgYW1vdW50IGFuZCBkZXNjcmlwdGlvbiDigJQgZG9uZSBpbiB1bmRlciAxMCBzZWNvbmRzLicsCiAgICBhcnJvdzogJ3JpZ2h0JywKICAgIHByZUFjdGlvbjogKCkgPT4gewogICAgICBjb25zdCBtZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1tZW51Jyk7CiAgICAgIGNvbnN0IGZhYiAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLWFkZC1idG4nKTsKICAgICAgaWYgKGZhYiAmJiAoIW1lbnUgfHwgIW1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVuJykpKSBmYWIuY2xpY2soKTsKICAgIH0KICB9LAogIHsKICAgIHNjcmVlbjogJ2J1ZGdldCcsCiAgICBlbGVtZW50SWQ6ICdidGFiLWdvYWxzJywKICAgIHRhZzogJ0J1ZGdldCAmIEdvYWxzIMK3IFN0ZXAgMyBvZiA5JywKICAgIHRpdGxlOiAn8J+OryBHb2FscyBUYWInLAogICAgZGVzYzogJ1N3aXRjaCB0byBHb2FscyBoZXJlIHRvIHNldCBmaW5hbmNpYWwgbWlsZXN0b25lcyDigJQgc2F2ZSBmb3IgYSBob3VzZSwgcGF5IG9mZiBhIGxvYW4sIGJ1aWxkIGFuIGVtZXJnZW5jeSBmdW5kLicsCiAgICBhcnJvdzogJ2Rvd24nLAogICAgcHJlQWN0aW9uOiAoKSA9PiB7CiAgICAgIC8vIENsb3NlIGZhYiBtZW51IGlmIG9wZW4KICAgICAgY29uc3QgbWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItbWVudScpOwogICAgICBjb25zdCBmYWIgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1hZGQtYnRuJyk7CiAgICAgIGlmIChmYWIgJiYgbWVudSAmJiBtZW51LmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSBmYWIuY2xpY2soKTsKICAgICAgc3dpdGNoU2NyZWVuKCdidWRnZXQnLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LWl0ZW06bnRoLWNoaWxkKDMpJykpOwogICAgfQogIH0sCiAgewogICAgc2NyZWVuOiAnYnVkZ2V0JywKICAgIGVsZW1lbnRJZDogJ2dvYWxzLWZhYi1idG4nLAogICAgdGFnOiAnQnVkZ2V0ICYgR29hbHMgwrcgU3RlcCA0IG9mIDknLAogICAgdGl0bGU6ICfvvIsgQWRkIGEgR29hbCcsCiAgICBkZXNjOiAnVGFwIHRoaXMgdG8gY3JlYXRlIGEgbmV3IGdvYWwuIENob29zZSBHcm93IChidWlsZCBzYXZpbmdzKSBvciBSZWR1Y2UgKHBheSBkb3duIGRlYnQpLiBNYXAgeW91ciBhY2NvdW50cyB0byB0cmFjayBwcm9ncmVzcyBhdXRvbWF0aWNhbGx5LicsCiAgICBhcnJvdzogJ3VwJywKICAgIHByZUFjdGlvbjogKCkgPT4gewogICAgICBzZXRCdWRnZXRUYWIoJ2dvYWxzJywgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0YWItZ29hbHMnKSk7CiAgICB9CiAgfSwKICB7CiAgICBzY3JlZW46ICduZXR3b3J0aCcsCiAgICBlbGVtZW50SWQ6ICdudy10b3RhbCcsCiAgICB0YWc6ICdOZXQgV29ydGggwrcgU3RlcCA1IG9mIDknLAogICAgdGl0bGU6ICfwn5KOIFlvdXIgTmV0IFdvcnRoJywKICAgIGRlc2M6ICdUaGlzIGlzIHRoZSBiaWcgbnVtYmVyIOKAlCB0b3RhbCBhc3NldHMgbWludXMgdG90YWwgbGlhYmlsaXRpZXMuIEl0IHVwZGF0ZXMgbGl2ZSBhcyB5b3UgYWRkIGFjY291bnRzIGFuZCB0cmFuc2FjdGlvbnMuJywKICAgIGFycm93OiAnZG93bicsCiAgICBwcmVBY3Rpb246ICgpID0+IHsKICAgICAgc3dpdGNoU2NyZWVuKCduZXR3b3J0aCcsIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXYtaXRlbTpudGgtY2hpbGQoNCknKSk7CiAgICB9CiAgfSwKICB7CiAgICBzY3JlZW46ICduZXR3b3J0aCcsCiAgICAvLyBUYXJnZXQgdGhlIGFsd2F5cy12aXNpYmxlIHNlY3Rpb24gaGVhZGVyLCBub3QgdGhlIGNvbGxhcHNpYmxlIGJvZHkKICAgIGVsZW1lbnRJZDogJ253LXNlYy1jaGVja2luZycsCiAgICB0YWc6ICdOZXQgV29ydGggwrcgU3RlcCA2IG9mIDknLAogICAgdGl0bGU6ICfwn4+mIEFkZCBBY2NvdW50cycsCiAgICBkZXNjOiAnVGFwIGFueSByb3cgdG8gZXhwYW5kIGl0LCB0aGVuIHRhcCAiKyBBZGQgQWNjb3VudCIgaW5zaWRlLiBBZGQgY2hlY2tpbmcsIHNhdmluZ3MsIHJlYWwgZXN0YXRlLCBsb2FucyDigJQgZWFjaCBjYXRlZ29yeSBzdGF5cyBvcmdhbmlzZWQuJywKICAgIGFycm93OiAndXAnLAogICAgLy8gTm8gcHJlQWN0aW9uIG5lZWRlZCDigJQgYWxyZWFkeSBvbiBuZXR3b3J0aCBzY3JlZW4KICB9LAogIHsKICAgIHNjcmVlbjogJ21ldGFscycsCiAgICBlbGVtZW50SWQ6ICdtaW5pLWdvbGQnLAogICAgdGFnOiAnTWV0YWxzIMK3IFN0ZXAgNyBvZiA5JywKICAgIHRpdGxlOiAn8J+lhyBHb2xkLCBTaWx2ZXIgJiBQbGF0aW51bScsCiAgICBkZXNjOiAnU3dpdGNoIGJldHdlZW4gbWV0YWxzIHVzaW5nIHRoZXNlIGNhcmRzLiBFYWNoIHNob3dzIHlvdXIgdG90YWwgd2VpZ2h0IGFuZCBjdXJyZW50IGVzdGltYXRlZCB2YWx1ZSBiYXNlZCBvbiB5b3VyIHNldCBwcmljZXMuJywKICAgIGFycm93OiAnZG93bicsCiAgICBwcmVBY3Rpb246ICgpID0+IHsgZ29Ub1NjcmVlbignbWV0YWxzJyk7IH0KICB9LAogIHsKICAgIHNjcmVlbjogJ21ldGFscycsCiAgICBlbGVtZW50SWQ6ICdtZXRhbC1saXZlLXByaWNlJywKICAgIHRhZzogJ01ldGFscyDCtyBTdGVwIDggb2YgOScsCiAgICB0aXRsZTogJ+Kcj++4jyBTZXQgWW91ciBPd24gUHJpY2UnLAogICAgZGVzYzogJ1RhcCBFZGl0IG5leHQgdG8gdGhpcyBwcmljZSB0byBvdmVycmlkZSBpdC4gWW91IGNhbiBzZXQgYSBiYXNlIHJhdGUgQU5EIGEgc3BlY2lmaWMgcHJpY2UgcGVyIHB1cml0eSDigJQgMjJLIHZzIDI0SyBnb2xkIHdpbGwgZGlmZmVyLicsCiAgICBhcnJvdzogJ2Rvd24nCiAgfSwKICB7CiAgICBzY3JlZW46ICdzZXR0aW5ncycsCiAgICBlbGVtZW50SWQ6ICdmeC1yYXRlcy1saXN0JywKICAgIHRhZzogJ1NldHRpbmdzIMK3IFN0ZXAgOSBvZiA5JywKICAgIHRpdGxlOiAn8J+SsSBGWCBSYXRlIE92ZXJyaWRlcycsCiAgICBkZXNjOiAnRXZlcnkgZm9yZWlnbiBjdXJyZW5jeSBpbiB5b3VyIGRhdGEgYXBwZWFycyBoZXJlLiBUYXAg4pyP77iPIFNldCBvbiBhbnkgcm93IHRvIGNvcnJlY3QgdGhlIHJhdGUg4oCUIGFsbCB5b3VyIHZhbHVhdGlvbnMgdXBkYXRlIGluc3RhbnRseS4nLAogICAgYXJyb3c6ICd1cCcsCiAgICBwcmVBY3Rpb246ICgpID0+IHsgZ29Ub1NjcmVlbignc2V0dGluZ3MnKTsgfQogIH0KXTsKCmxldCBjb2FjaFN0ZXAgPSAwOwpsZXQgX2NvYWNoUmVzaXplT2JzID0gbnVsbDsKCmZ1bmN0aW9uIHN0YXJ0Q29hY2hUb3VyKCkgewogIGNvYWNoU3RlcCA9IDA7CiAgc2hvd0NvYWNoU3RlcCgwKTsKfQoKZnVuY3Rpb24gc2hvd0NvYWNoU3RlcChpZHgpIHsKICBpZiAoaWR4IDwgMCB8fCBpZHggPj0gQ09BQ0hfU1RFUFMubGVuZ3RoKSB7IGVuZENvYWNoVG91cigpOyByZXR1cm47IH0KICBjb2FjaFN0ZXAgPSBpZHg7CiAgY29uc3Qgc3RlcCA9IENPQUNIX1NURVBTW2lkeF07CgogIC8vIFJ1biBhbnkgcHJlLWFjdGlvbiAoc2NyZWVuIHN3aXRjaCwgb3BlbiBtZW51IGV0YykKICBpZiAoc3RlcC5wcmVBY3Rpb24pIHsKICAgIHRyeSB7IHN0ZXAucHJlQWN0aW9uKCk7IH0gY2F0Y2goZSkge30KICB9CgogIC8vIFNtYWxsIGRlbGF5IHNvIHNjcmVlbiByZW5kZXJzIGJlZm9yZSB3ZSBtZWFzdXJlCiAgc2V0VGltZW91dCgoKSA9PiBfcmVuZGVyQ29hY2hTdGVwKHN0ZXAsIGlkeCksIHN0ZXAucHJlQWN0aW9uID8gMzIwIDogNjApOwp9CgpmdW5jdGlvbiBfcmVuZGVyQ29hY2hTdGVwKHN0ZXAsIGlkeCkgewogIGNvbnN0IHRhcmdldEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3RlcC5lbGVtZW50SWQpOwogIGNvbnN0IG92ZXJsYXkgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLW92ZXJsYXknKTsKICBjb25zdCBzdmcgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1zdmcnKTsKICBjb25zdCB0b29sdGlwICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC10b29sdGlwJyk7CiAgY29uc3QgcHVsc2UgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtcHVsc2UnKTsKICBpZiAoIW92ZXJsYXkgfHwgIXN2ZyB8fCAhdG9vbHRpcCkgcmV0dXJuOwoKICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogIGNvbnN0IFcgPSB3aW5kb3cuaW5uZXJXaWR0aDsKICBjb25zdCBIID0gd2luZG93LmlubmVySGVpZ2h0OwoKICAvLyBHZXQgdGFyZ2V0IHJlY3Qg4oCUIHNjcm9sbCBpdCBpbnRvIHZpZXcgZmlyc3QKICBsZXQgciA9IG51bGw7CiAgaWYgKHRhcmdldEVsKSB7CiAgICB0YXJnZXRFbC5zY3JvbGxJbnRvVmlldyh7IGJsb2NrOiAnbmVhcmVzdCcsIGlubGluZTogJ25lYXJlc3QnIH0pOwogICAgciA9IHRhcmdldEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgLy8gSWYgcmVjdCBpcyB6ZXJvLXNpemUgb3IgZnVsbHkgb2ZmIHNjcmVlbiwgdHJlYXQgYXMgbm8gdGFyZ2V0CiAgICBpZiAoci53aWR0aCA8IDIgfHwgci5oZWlnaHQgPCAyIHx8IHIuYm90dG9tIDwgMCB8fCByLnRvcCA+IEgpIHIgPSBudWxsOwogIH0KCiAgaWYgKCFyKSB7CiAgICBfZHJhd0NvYWNoTm9UYXJnZXQoc3RlcCwgaWR4KTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHBhZCAgPSAxMDsKICBjb25zdCByeCAgID0gTWF0aC5tYXgoMCwgci5sZWZ0IC0gcGFkKTsKICBjb25zdCByeSAgID0gTWF0aC5tYXgoMCwgci50b3AgIC0gcGFkKTsKICBjb25zdCBydyAgID0gTWF0aC5tYXgoNjAsIHIud2lkdGggICsgcGFkICogMik7CiAgY29uc3QgcmggICA9IE1hdGgubWF4KDQ0LCByLmhlaWdodCArIHBhZCAqIDIpOwogIGNvbnN0IHJyYWQgPSAxMjsKCiAgLy8gRHJhdyBTVkcgZGltIG1hc2sgd2l0aCBjdXRvdXQKICBzdmcuaW5uZXJIVE1MID0gYAogICAgPGRlZnM+CiAgICAgIDxtYXNrIGlkPSJjbSI+CiAgICAgICAgPHJlY3Qgd2lkdGg9IiR7V30iIGhlaWdodD0iJHtIfSIgZmlsbD0id2hpdGUiLz4KICAgICAgICA8cmVjdCB4PSIke3J4fSIgeT0iJHtyeX0iIHdpZHRoPSIke3J3fSIgaGVpZ2h0PSIke3JofSIgcng9IiR7cnJhZH0iIGZpbGw9ImJsYWNr','Ii8+CiAgICAgIDwvbWFzaz4KICAgIDwvZGVmcz4KICAgIDxyZWN0IHdpZHRoPSIke1d9IiBoZWlnaHQ9IiR7SH0iIGZpbGw9InJnYmEoMTAsMTQsNDAsMC44MikiIG1hc2s9InVybCgjY20pIi8+CiAgYDsKCiAgLy8gUHVsc2UgcmluZwogIHB1bHNlLnN0eWxlLmNzc1RleHQgPSBgCiAgICBkaXNwbGF5OmJsb2NrOyBsZWZ0OiR7cnh9cHg7IHRvcDoke3J5fXB4OwogICAgd2lkdGg6JHtyd31weDsgaGVpZ2h0OiR7cmh9cHg7IGJvcmRlci1yYWRpdXM6JHtycmFkfXB4OwogIGA7CgogIC8vIEJ1aWxkIHRvb2x0aXAgSFRNTAogIGNvbnN0IGlzTGFzdCA9IGlkeCA9PT0gQ09BQ0hfU1RFUFMubGVuZ3RoIC0gMTsKICB0b29sdGlwLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImNvYWNoLWFycm93ICR7c3RlcC5hcnJvdyB8fCAnZG93bid9Ij48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvYWNoLXN0ZXAtdGFnIj4ke3N0ZXAudGFnfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtdGl0bGUiPiR7c3RlcC50aXRsZX08L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvYWNoLWRlc2MiPiR7c3RlcC5kZXNjfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtYnRuLXJvdyI+CiAgICAgICR7aWR4ID4gMCA/IGA8YnV0dG9uIGNsYXNzPSJjb2FjaC1wcmV2LWJ0biIgb25jbGljaz0ic2hvd0NvYWNoU3RlcCgke2lkeC0xfSkiPuKAuSBCYWNrPC9idXR0b24+YCA6ICcnfQogICAgICA8YnV0dG9uIGNsYXNzPSJjb2FjaC1uZXh0LWJ0biIgb25jbGljaz0iJHtpc0xhc3QgPyAnZW5kQ29hY2hUb3VyKCknIDogYHNob3dDb2FjaFN0ZXAoJHtpZHgrMX0pYH0iPgogICAgICAgICR7aXNMYXN0ID8gJ/CfjokgRG9uZSEnIDogJ05leHQg4oaSJ30KICAgICAgPC9idXR0b24+CiAgICAgICR7IWlzTGFzdCA/IGA8YnV0dG9uIGNsYXNzPSJjb2FjaC1za2lwLWJ0biIgb25jbGljaz0iZW5kQ29hY2hUb3VyKCkiPlNraXAgYWxsPC9idXR0b24+YCA6ICcnfQogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC1wcm9ncmVzcyI+JHtpZHggKyAxfSAvICR7Q09BQ0hfU1RFUFMubGVuZ3RofTwvZGl2PgogIGA7CiAgdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAvLyBFbnN1cmUgdG9vbHRpcCBpcyBhbHdheXMgYWJvdmUgU1ZHIGFuZCBpbnRlcmFjdGl2ZQogIHRvb2x0aXAuc3R5bGUuekluZGV4ICA9ICcxMDAwMCc7CiAgdG9vbHRpcC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2FsbCc7CgogIC8vIFBvc2l0aW9uIHRvb2x0aXAg4oCUIG1lYXN1cmUgaGVpZ2h0IGZpcnN0CiAgY29uc3QgVFcgID0gMjY4OwogIGNvbnN0IGdhcCA9IDE0OwogIHRvb2x0aXAuc3R5bGUubGVmdCA9ICcxMHB4JzsKICB0b29sdGlwLnN0eWxlLnRvcCAgPSAnLTk5OTlweCc7CiAgY29uc3QgVEggPSB0b29sdGlwLm9mZnNldEhlaWdodCB8fCAxNzA7CgogIC8vIENlbnRyZSBob3Jpem9udGFsbHkgb24gdGFyZ2V0LCBjbGFtcGVkIHRvIHNjcmVlbiBlZGdlcwogIGxldCB0eCA9IHJ4ICsgcncgLyAyIC0gVFcgLyAyOwogIHR4ID0gTWF0aC5tYXgoMTAsIE1hdGgubWluKHR4LCBXIC0gVFcgLSAxMCkpOwoKICAvLyBQcmVmZXIgYWJvdmUsIGZhbGxiYWNrIGJlbG93LCBmYWxsYmFjayBjZW50cmUKICBsZXQgdHksIGFycm93RGlyOwogIGNvbnN0IHNwYWNlQWJvdmUgPSByeSAtIGdhcDsKICBjb25zdCBzcGFjZUJlbG93ID0gSCAtIChyeSArIHJoKSAtIGdhcDsKCiAgaWYgKHNwYWNlQWJvdmUgPj0gVEggKyAxMCkgewogICAgdHkgPSByeSAtIFRIIC0gZ2FwOwogICAgYXJyb3dEaXIgPSAnZG93bic7CiAgfSBlbHNlIGlmIChzcGFjZUJlbG93ID49IFRIICsgMTApIHsKICAgIHR5ID0gcnkgKyByaCArIGdhcDsKICAgIGFycm93RGlyID0gJ3VwJzsKICB9IGVsc2UgewogICAgdHkgPSBNYXRoLm1heCgxMCwgSCAvIDIgLSBUSCAvIDIpOwogICAgYXJyb3dEaXIgPSBzdGVwLmFycm93IHx8ICdkb3duJzsKICB9CgogIC8vIENsYW1wIHZlcnRpY2FsbHkgc28gdG9vbHRpcCBuZXZlciBoaWRlcyB1bmRlciBib3R0b20gbmF2CiAgdHkgPSBNYXRoLm1heCg4LCBNYXRoLm1pbih0eSwgSCAtIFRIIC0gNzApKTsKCiAgY29uc3QgYXJyb3dFbCA9IHRvb2x0aXAucXVlcnlTZWxlY3RvcignLmNvYWNoLWFycm93Jyk7CiAgaWYgKGFycm93RWwpIGFycm93RWwuY2xhc3NOYW1lID0gYGNvYWNoLWFycm93ICR7YXJyb3dEaXJ9YDsKCiAgdG9vbHRpcC5zdHlsZS5sZWZ0ID0gdHggKyAncHgnOwogIHRvb2x0aXAuc3R5bGUudG9wICA9IHR5ICsgJ3B4JzsKCiAgLy8gUmUtdHJpZ2dlciBwb3AgYW5pbWF0aW9uCiAgdG9vbHRpcC5zdHlsZS5hbmltYXRpb24gPSAnbm9uZSc7CiAgdG9vbHRpcC5vZmZzZXRIZWlnaHQ7CiAgdG9vbHRpcC5zdHlsZS5hbmltYXRpb24gPSAnY29hY2hQb3AgMC4zcyBjdWJpYy1iZXppZXIoMC4zNCwxLjU2LDAuNjQsMSkgYm90aCc7Cn0KCmZ1bmN0aW9uIF9kcmF3Q29hY2hOb1RhcmdldChzdGVwLCBpZHgpIHsKICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLW92ZXJsYXknKTsKICBjb25zdCBzdmcgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLXN2ZycpOwogIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtdG9vbHRpcCcpOwogIGNvbnN0IHB1bHNlICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtcHVsc2UnKTsKICBjb25zdCBXID0gd2luZG93LmlubmVyV2lkdGgsIEggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgaWYgKHN2Zykgc3ZnLmlubmVySFRNTCA9IGA8cmVjdCB3aWR0aD0iJHtXfSIgaGVpZ2h0PSIke0h9IiBmaWxsPSJyZ2JhKDEwLDE0LDQwLDAuODIpIi8+YDsKICBpZiAocHVsc2UpIHB1bHNlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgaWYgKG92ZXJsYXkpIHsgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgfQogIGlmICghdG9vbHRpcCkgcmV0dXJuOwogIGNvbnN0IGlzTGFzdCA9IGlkeCA9PT0gQ09BQ0hfU1RFUFMubGVuZ3RoIC0gMTsKICB0b29sdGlwLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImNvYWNoLXN0ZXAtdGFnIj4ke3N0ZXAudGFnfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtdGl0bGUiPiR7c3RlcC50aXRsZX08L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvYWNoLWRlc2MiPiR7c3RlcC5kZXNjfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtYnRuLXJvdyI+CiAgICAgICR7aWR4ID4gMCA/IGA8YnV0dG9uIGNsYXNzPSJjb2FjaC1wcmV2LWJ0biIgb25jbGljaz0ic2hvd0NvYWNoU3RlcCgke2lkeC0xfSkiPuKAuSBCYWNrPC9idXR0b24+YCA6ICcnfQogICAgICA8YnV0dG9uIGNsYXNzPSJjb2FjaC1uZXh0LWJ0biIgb25jbGljaz0iJHtpc0xhc3QgPyAnZW5kQ29hY2hUb3VyKCknIDogYHNob3dDb2FjaFN0ZXAoJHtpZHgrMX0pYH0iPgogICAgICAgICR7aXNMYXN0ID8gJ/CfjokgRG9uZSEnIDogJ05leHQg4oaSJ30KICAgICAgPC9idXR0b24+CiAgICAgICR7IWlzTGFzdCA/IGA8YnV0dG9uIGNsYXNzPSJjb2FjaC1za2lwLWJ0biIgb25jbGljaz0iZW5kQ29hY2hUb3VyKCkiPlNraXAgYWxsPC9idXR0b24+YCA6ICcnfQogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC1wcm9ncmVzcyI+JHtpZHggKyAxfSAvICR7Q09BQ0hfU1RFUFMubGVuZ3RofTwvZGl2PgogIGA7CiAgdG9vbHRpcC5zdHlsZS5kaXNwbGF5ICAgICAgPSAnYmxvY2snOwogIHRvb2x0aXAuc3R5bGUuekluZGV4ICAgICAgID0gJzEwMDAwJzsKICB0b29sdGlwLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYWxsJzsKICBjb25zdCBUVyA9IDI2ODsKICB0b29sdGlwLnN0eWxlLmxlZnQgPSBNYXRoLm1heCgxMCwgVy8yIC0gVFcvMikgKyAncHgnOwogIHRvb2x0aXAuc3R5bGUudG9wICA9ICctOTk5OXB4JzsKICBjb25zdCBUSCA9IHRvb2x0aXAub2Zmc2V0SGVpZ2h0IHx8IDE3MDsKICB0b29sdGlwLnN0eWxlLnRvcCAgPSBNYXRoLm1heCgxMCwgSC8yIC0gVEgvMikgKyAncHgnOwogIHRvb2x0aXAuc3R5bGUuYW5pbWF0aW9uID0gJ25vbmUnOwogIHRvb2x0aXAub2Zmc2V0SGVpZ2h0OwogIHRvb2x0aXAuc3R5bGUuYW5pbWF0aW9uID0gJ2NvYWNoUG9wIDAuM3MgY3ViaWMtYmV6aWVyKDAuMzQsMS41NiwwLjY0LDEpIGJvdGgnOwp9CgpmdW5jdGlvbiBlbmRDb2FjaFRvdXIoKSB7CiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1vdmVybGF5Jyk7CiAgY29uc3QgcHVsc2UgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1wdWxzZScpOwogIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtdG9vbHRpcCcpOwogIGNvbnN0IHN2ZyAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtc3ZnJyk7CiAgLy8gQ2xlYXIgU1ZHIGRpbSBtYXNrIHNvIG5vdGhpbmcgYmxvY2tzIHRvdWNoZXMgZXZlbiBicmllZmx5CiAgaWYgKHN2ZykgICAgIHN2Zy5pbm5lckhUTUwgPSAnJzsKICBpZiAocHVsc2UpICAgeyBwdWxzZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9CiAgaWYgKHRvb2x0aXApIHsgdG9vbHRpcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB0b29sdGlwLmlubmVySFRNTCA9ICcnOyB9CiAgaWYgKG92ZXJsYXkpIHsKICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICBvdmVybGF5LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7CiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfQogIC8vIENsb3NlIGZhYiBtZW51IGlmIG9wZW4KICB0cnkgewogICAgY29uc3QgbWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItbWVudScpOwogICAgaWYgKG1lbnUgJiYgbWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLWFkZC1idG4nKT8uY2xpY2soKTsKICAgIH0KICB9IGNhdGNoKGUpIHt9CiAgLy8gUmV0dXJuIHRvIGhvbWUKICBzd2l0Y2hTY3JlZW4oJ2hvbWUnLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LWl0ZW06Zmlyc3QtY2hpbGQnKSk7CiAgc2hvd1RvYXN0KCfwn46vIFRvdXIgY29tcGxldGUg4oCUIHlvdVwncmUgcmVhZHkhJyk7Cn0KCi8vIOKUgOKUgCBJTklUCgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGJhci1tb250aCcpLnRleHRDb250ZW50ID0gZ2V0RGlzcGxheU1vbnRoKHZpZXdNb250aCk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kYXRlJykudmFsdWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1kYXRlJykudmFsdWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKCi8vIEFwcGx5IHN0b3JlZCB0aGVtZQphcHBseVN0b3JlZFRoZW1lKCk7CgovLyBJbml0IHBlcmlvZApzZWxlY3RlZERheSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwp1cGRhdGVQZXJpb2RMYWJlbCgpOwoKLy8gUmVuZGVyIGhvbWUKcmVuZGVySG9tZSgpOwoKLy8gU2hvdyBvbmJvYXJkaW5nIG9uIGZpcnN0IGV2ZXIgbG9hZAppZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKE9CX1NFRU5fS0VZKSkgewogIHNob3dPbmJvYXJkaW5nKCk7Cn0KCi8vIFBJTiBMb2NrOiBESVNBQkxFRCDigJQgdW5jb21tZW50IGluaXRMb2NrU2NyZWVuKCkgYmVsb3cgdG8gcmUtZW5hYmxlCi8vIGluaXRMb2NrU2NyZWVuKCk7CgovLyDilZDilZDilZDi','lZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gRklSRUJBU0UgU1lOQyBFTkdJTkUKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpjb25zdCBGSVJFQkFTRV9DT05GSUcgPSB7CiAgYXBpS2V5OiAiQUl6YVN5Q3hNN1VoQUw3UURtMXJsQ1Jrbl91cFZ4TndCWEg1X1U0IiwKICBhdXRoRG9tYWluOiAibW9uZXlmaS03NTkyOS5maXJlYmFzZWFwcC5jb20iLAogIHByb2plY3RJZDogIm1vbmV5ZmktNzU5MjkiLAogIHN0b3JhZ2VCdWNrZXQ6ICJtb25leWZpLTc1OTI5LmZpcmViYXNlc3RvcmFnZS5hcHAiLAogIG1lc3NhZ2luZ1NlbmRlcklkOiAiNDU3Mzc4Mzk3Mjk3IiwKICBhcHBJZDogIjE6NDU3Mzc4Mzk3Mjk3OndlYjo0Mzk0NGZlNDhhZDI4YjIxOWEyZmQwIgp9OwoKLy8g4pSA4pSAIEluaXQgRmlyZWJhc2Ug4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZpcmViYXNlLmluaXRpYWxpemVBcHAoRklSRUJBU0VfQ09ORklHKTsKY29uc3QgX2F1dGggPSBmaXJlYmFzZS5hdXRoKCk7CmNvbnN0IF9kYiAgID0gZmlyZWJhc2UuZmlyZXN0b3JlKCk7CndpbmRvdy5fZmJEYiA9IF9kYjsKd2luZG93Ll9mYlVzZXIgPSBudWxsOwoKLy8g4pSA4pSAIFN5bmMgc3RhdHVzIFVJIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApmdW5jdGlvbiBzaG93U3luY1N0YXR1cyhtc2csIGNvbG9yPScjMTBCOTgxJywgZHVyYXRpb249MjUwMCkgewogIGNvbnN0IGJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXN0YXR1cy1iYXInKTsKICBpZiAoIWJhcikgcmV0dXJuOwogIGJhci50ZXh0Q29udGVudCA9IG1zZzsKICBiYXIuc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogIGJhci5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CiAgYmFyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIGNsZWFyVGltZW91dChiYXIuX2hpZGVUaW1lcik7CiAgaWYgKGR1cmF0aW9uID4gMCkgewogICAgYmFyLl9oaWRlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsgYmFyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0sIGR1cmF0aW9uKTsKICB9Cn0KCi8vIOKUgOKUgCBGaXJlYmFzZSBTYXZlOiBjaHVua2VkIHRvIHN0YXkgdW5kZXIgMU1CIEZpcmVzdG9yZSBsaW1pdCDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKbGV0IF9zYXZlVGltZXIgPSBudWxsOwpmdW5jdGlvbiBmaXJlYmFzZVNhdmUoKSB7CiAgaWYgKCF3aW5kb3cuX2ZiVXNlcikgcmV0dXJuOwogIC8vIERlYm91bmNlOiB3YWl0IDEuNXMgYWZ0ZXIgbGFzdCBzYXZlIGNhbGwgYmVmb3JlIHdyaXRpbmcgdG8gRmlyZXN0b3JlCiAgY2xlYXJUaW1lb3V0KF9zYXZlVGltZXIpOwogIF9zYXZlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IF9kb0ZpcmViYXNlU2F2ZSgpLCAxNTAwKTsKfQoKZnVuY3Rpb24gX2RvRmlyZWJhc2VTYXZlKCkgewogIGlmICghd2luZG93Ll9mYlVzZXIpIHJldHVybjsKICBjb25zdCB1aWQgPSB3aW5kb3cuX2ZiVXNlci51aWQ7CiAgc2hvd1N5bmNTdGF0dXMoJ+KYge+4jyBTYXZpbmcuLi4nLCAnIzNCOUVGRicsIDApOwoKICAvLyBTcGxpdCBkYXRhIGludG8gY2h1bmtzIHRvIHN0YXkgd2VsbCB1bmRlciBGaXJlc3RvcmUgMU1CIGRvYyBsaW1pdAogIC8vIENodW5rIDE6IG1haW4gZGF0YSAodHJhbnNhY3Rpb25zLCBidWRnZXRzLCBnb2Fscywgc2V0dGluZ3MpCiAgLy8gQ2h1bmsgMjogaGVhdnkgYXJyYXlzIChtZXRhbHMsIE5XIGFjY291bnRzLCBpbnZlc3RtZW50cykKICBjb25zdCBjaHVuazEgPSB7fTsKICBjb25zdCBjaHVuazIgPSB7fTsKCiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrID0+IHsKICAgIGNvbnN0IGhlYXZ5ID0gWydfbWV0YWxzJywnX253QWNjb3VudHMnLCdfcmVhbEVzdGF0ZSddOwogICAgaWYgKGhlYXZ5LmluY2x1ZGVzKGspKSBjaHVuazJba10gPSBkYXRhW2tdOwogICAgZWxzZSBjaHVuazFba10gPSBkYXRhW2tdOwogIH0pOwoKICBjb25zdCB1c2VyUmVmID0gX2RiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZG9jKHVpZCk7CiAgY29uc3QgYmF0Y2ggPSBfZGIuYmF0Y2goKTsKICBiYXRjaC5zZXQodXNlclJlZi5jb2xsZWN0aW9uKCdhcHBEYXRhJykuZG9jKCdtYWluJyksCiAgICB7IC4uLmNodW5rMSwgX3NhdmVkQXQ6IGZpcmViYXNlLmZpcmVzdG9yZS5GaWVsZFZhbHVlLnNlcnZlclRpbWVzdGFtcCgpIH0pOwogIGJhdGNoLnNldCh1c2VyUmVmLmNvbGxlY3Rpb24oJ2FwcERhdGEnKS5kb2MoJ2Fzc2V0cycpLAogICAgeyAuLi5jaHVuazIsIF9zYXZlZEF0OiBmaXJlYmFzZS5maXJlc3RvcmUuRmllbGRWYWx1ZS5zZXJ2ZXJUaW1lc3RhbXAoKSB9KTsKCiAgYmF0Y2guY29tbWl0KCkKICAgIC50aGVuKCgpID0+IHNob3dTeW5jU3RhdHVzKCfinIUgU3luY2VkJywgJyMxMEI5ODEnLCAyMDAwKSkKICAgIC5jYXRjaChlcnIgPT4gewogICAgICBjb25zb2xlLmVycm9yKCdGaXJlYmFzZSBzYXZlIGVycm9yOicsIGVycik7CiAgICAgIHNob3dTeW5jU3RhdHVzKCfimqDvuI8gU3luYyBmYWlsZWQg4oCUIHNhdmVkIGxvY2FsbHknLCAnI0Y1OUUwQicsIDMwMDApOwogICAgfSk7Cn0KCi8vIOKUgOKUgCBGaXJlYmFzZSBMb2FkOiBtZXJnZSBjaHVua3MgYmFjayBpbnRvIGRhdGEg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmFzeW5jIGZ1bmN0aW9uIGZpcmViYXNlTG9hZCh1aWQpIHsKICBzaG93U3luY1N0YXR1cygn4piB77iPIExvYWRpbmcgeW91ciBkYXRhLi4uJywgJyMzQjlFRkYnLCAwKTsKICB0cnkgewogICAgY29uc3QgdXNlclJlZiA9IF9kYi5jb2xsZWN0aW9uKCd1c2VycycpLmRvYyh1aWQpOwogICAgY29uc3QgW21haW5TbmFwLCBhc3NldHNTbmFwXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgdXNlclJlZi5jb2xsZWN0aW9uKCdhcHBEYXRhJykuZG9jKCdtYWluJykuZ2V0KCksCiAgICAgIHVzZXJSZWYuY29sbGVjdGlvbignYXBwRGF0YScpLmRvYygnYXNzZXRzJykuZ2V0KCkKICAgIF0pOwoKICAgIGNvbnN0IG1haW5EYXRhICAgPSBtYWluU25hcC5leGlzdHMgICA/IG1haW5TbmFwLmRhdGEoKSAgIDoge307CiAgICBjb25zdCBhc3NldHNEYXRhID0gYXNzZXRzU25hcC5leGlzdHMgPyBhc3NldHNTbmFwLmRhdGEoKSA6IHt9OwoKICAgIC8vIFJlbW92ZSBGaXJlc3RvcmUgbWV0YWRhdGEgZmllbGRzCiAgICBkZWxldGUgbWFpbkRhdGEuX3NhdmVkQXQ7CiAgICBkZWxldGUgYXNzZXRzRGF0YS5fc2F2ZWRBdDsKCiAgICBjb25zdCBtZXJnZWQgPSB7IC4uLm1haW5EYXRhLCAuLi5hc3NldHNEYXRhIH07CgogICAgaWYgKE9iamVjdC5rZXlzKG1lcmdlZCkubGVuZ3RoID4gMCkgewogICAgICAvLyBDbG91ZCBkYXRhIGV4aXN0cyDigJQgbWVyZ2Ugd2l0aCBsb2NhbCAoY2xvdWQgd2lucyBmb3IgY29uZmxpY3RzKQogICAgICBkYXRhID0geyAuLi5kYXRhLCAuLi5tZXJnZWQgfTsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgc2hvd1N5bmNTdGF0dXMoJ+KchSBEYXRhIGxvYWRlZCBmcm9tIGNsb3VkJywgJyMxMEI5ODEnLCAyNTAwKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIE5vIGNsb3VkIGRhdGEgeWV0IOKAlCBwdXNoIGxvY2FsIGRhdGEgdG8gY2xvdWQKICAgICAgc2hvd1N5bmNTdGF0dXMoJ+KYge+4jyBGaXJzdCBzeW5jIOKAlCB1cGxvYWRpbmcgbG9jYWwgZGF0YS4uLicsICcjM0I5RUZGJywgMCk7CiAgICAgIGZpcmViYXNlU2F2ZSgpOwogICAgfQoKICAgIC8vIFJlc3RvcmUgY3VzdG9tIE5XIHR5cGVzCiAgICAoZGF0YS5fbndDdXN0b21UeXBlcyB8fCBbXSkuZm9yRWFjaChjID0+IHsKICAgICAgTldfVFlQRVNbYy5rZXldID0geyBsYWJlbDogYy5sYWJlbCwgZW1vamk6IGMuZW1vaml8fCfwn4+mJywgY29sb3I6JyM2QjcyODAnLCBpc0xpYWI6IGMuaXNMaWFifHxmYWxzZSB9OwogICAgfSk7CgogICAgLy8gUmUtcmVuZGVyIGV2ZXJ5dGhpbmcgd2l0aCBjbG91ZCBkYXRhCiAgICBhcHBseVN0b3JlZFRoZW1lKCk7CiAgICByZW5kZXJIb21lKCk7CiAgICBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCAmJiBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOwoKICB9IGNhdGNoIChlcnIpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ0ZpcmViYXNlIGxvYWQgZXJyb3I6JywgZXJyKTsKICAgIHNob3dTeW5jU3RhdHVzKCfimqDvuI8gQ291bGQgbm90IGxvYWQgY2xvdWQgZGF0YSDigJQgdXNpbmcgbG9jYWwnLCAnI0Y1OUUwQicsIDMwMDApOwogIH0KfQoKLy8g4pSA4pSAIFJlYWwtdGltZSBsaXN0ZW5lcjogdXBkYXRlIFVJIHdoZW4gYW5vdGhlciBkZXZpY2Ugc2F2ZXMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmxldCBfdW5zdWJzY3JpYmVMaXN0ZW5lciA9IG51bGw7CmZ1bmN0aW9uIHN0YXJ0UmVhbHRpbWVTeW5jKHVpZCkgewogIGlmIChfdW5zdWJzY3JpYmVMaXN0ZW5lcikgX3Vuc3Vic2NyaWJlTGlzdGVuZXIoKTsKICBjb25zdCBtYWluUmVmID0gX2RiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZG9jKHVpZCkuY29sbGVjdGlvbignYXBwRGF0YScpLmRvYygnbWFpbicpOwogIF91bnN1YnNjcmliZUxpc3RlbmVyID0gbWFpblJlZi5vblNuYXBzaG90KHNuYXAgPT4gewogICAgaWYgKCFzbmFwLmV4aXN0cyB8fCBzbmFwLm1ldGFkYXRhLmhhc1BlbmRpbmdXcml0ZXMpIHJldHVybjsKICAgIC8vIEFub3RoZXIgZGV2aWNlIHVwZGF0ZWQgZGF0YSDigJQgcmVsb2FkIHNpbGVudGx5CiAgICBmaXJlYmFzZUxvYWQodWlkKS50aGVuKCgpID0+IHsKICAgICAgc2hvd1N5bmNTdGF0dXMoJ/CflIQgVXBkYXRlZCBmcm9tIGFub3RoZXIgZGV2aWNlJywgJyM4QjVDRjYnLCAyNTAwKTsKICAgIH0pOwogIH0sIGVyciA9PiBjb25zb2xlLndhcm4oJ1JlYWx0aW1lIHN5bmMgZXJyb3I6JywgZXJyKSk7Cn0KCi8vIOKUgOKUgCBBdXRoIHN0YXRlIGhhbmRsZXIg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIHNpZ25JbldpdGhHb29nbGUoKSB7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvb2dsZS1zaWduaW4tYnRuJyk7CiAgY29uc3Qgc3RhdHVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tc3RhdHVzJyk7CiAgaWYgKGJ0bikgYnRuLmRpc2FibGVkID0gdHJ1ZTsKICBpZiAoc3RhdHVzRWwpIHN0YXR1c0VsLnRleHRDb250ZW50ID0gJ1JlZGlyZWN0aW5nIHRvIEdvb2dsZS4uLic7CgogIGNvbnN0IHByb3ZpZGVyID0gbmV3IGZpcmViYXNlLmF1dGguR29vZ2xlQXV0aFByb3ZpZGVyKCk7CiAgLy8gVXNlIHJlZGlyZWN0IChub3QgcG9wdXApIOKAlCByZXF1aXJlZCBmb3IgaVBob25lIFBXQSAvIFNhZmFyaQogIF9hdXRoLnNpZ25JbldpdGhSZWRpcmVjdChwcm92aWRlcikKICAgIC5jYXRj','aChlcnIgPT4gewogICAgICBjb25zb2xlLmVycm9yKCdTaWduIGluIGVycm9yOicsIGVycik7CiAgICAgIGlmIChidG4pIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICBpZiAoc3RhdHVzRWwpIHN0YXR1c0VsLnRleHRDb250ZW50ID0gJ1NpZ24gaW4gZmFpbGVkIOKAlCBwbGVhc2UgdHJ5IGFnYWluJzsKICAgIH0pOwp9CgovLyDilIDilIAgUmVkaXJlY3QgcmVzdWx0IGdhdGUg4oCUIGVuc3VyZXMgb25BdXRoU3RhdGVDaGFuZ2VkIHdhaXRzIGZvciByZWRpcmVjdCDilIDilIAKbGV0IF9yZWRpcmVjdEhhbmRsZWQgPSBmYWxzZTsKY29uc3QgX3JlZGlyZWN0UHJvbWlzZSA9IF9hdXRoLmdldFJlZGlyZWN0UmVzdWx0KCkKICAudGhlbihyZXN1bHQgPT4gewogICAgX3JlZGlyZWN0SGFuZGxlZCA9IHRydWU7CiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC51c2VyKSB7CiAgICAgIGNvbnN0IHN0YXR1c0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXN0YXR1cycpOwogICAgICBpZiAoc3RhdHVzRWwpIHN0YXR1c0VsLnRleHRDb250ZW50ID0gJ1NpZ25pbmcgeW91IGluLi4uJzsKICAgIH0KICB9KQogIC5jYXRjaChlcnIgPT4gewogICAgX3JlZGlyZWN0SGFuZGxlZCA9IHRydWU7CiAgICAvLyBTaWxlbmNlICdQYXJhbXMgYXJlIG5vdCBzZXQnIOKAlCB0aGlzIGp1c3QgbWVhbnMgbm8gcmVkaXJlY3Qgd2FzIGluIHByb2dyZXNzCiAgICBpZiAoZXJyICYmIGVyci5tZXNzYWdlICYmIChlcnIubWVzc2FnZS5pbmNsdWRlcygnUGFyYW1zIGFyZSBub3Qgc2V0JykgfHwgZXJyLmNvZGUgPT09ICdhdXRoL25vLWF1dGgtZXZlbnQnKSkgcmV0dXJuOwogICAgY29uc29sZS5lcnJvcignUmVkaXJlY3QgcmVzdWx0IGVycm9yOicsIGVycik7CiAgICBjb25zdCBzdGF0dXNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dpbi1zdGF0dXMnKTsKICAgIGlmIChzdGF0dXNFbCkgc3RhdHVzRWwudGV4dENvbnRlbnQgPSAnU2lnbiBpbiBmYWlsZWQg4oCUIHBsZWFzZSB0cnkgYWdhaW4nOwogICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvb2dsZS1zaWduaW4tYnRuJyk7CiAgICBpZiAoYnRuKSBidG4uZGlzYWJsZWQgPSBmYWxzZTsKICB9KTsKCmZ1bmN0aW9uIHNpZ25PdXQoKSB7CiAgaWYgKF91bnN1YnNjcmliZUxpc3RlbmVyKSBfdW5zdWJzY3JpYmVMaXN0ZW5lcigpOwogIF9hdXRoLnNpZ25PdXQoKS50aGVuKCgpID0+IHsKICAgIHdpbmRvdy5fZmJVc2VyID0gbnVsbDsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JlZW4tbG9naW4nKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgc2hvd1RvYXN0KCfwn5GLIFNpZ25lZCBvdXQnKTsKICB9KTsKfQoKLy8g4pSA4pSAIEF1dGggc3RhdGUgY2hhbmdlIOKAlCB3YWl0cyBmb3IgcmVkaXJlY3QgdG8gY29tcGxldGUgZmlyc3Qg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACl9hdXRoLm9uQXV0aFN0YXRlQ2hhbmdlZChhc3luYyB1c2VyID0+IHsKICAvLyBXYWl0IGZvciBnZXRSZWRpcmVjdFJlc3VsdCB0byBmaW5pc2ggYmVmb3JlIGFjdGluZwogIGF3YWl0IF9yZWRpcmVjdFByb21pc2U7CgogIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1sb2dpbicpOwoKICBpZiAodXNlcikgewogICAgLy8g4pSA4pSAIEFsbG93bGlzdCBjaGVjayDigJQgb25seSBwZXJtaXR0ZWQgZW1haWxzIGNhbiBhY2Nlc3Mg4pSA4pSACiAgICBjb25zdCBBTExPV0VEX0VNQUlMUyA9IFsKICAgICAgJ3BucmFnaHVraXNob3JlQGdtYWlsLmNvbScsCiAgICAgICdzd2F0aGlraXNob3JlMTJAZ21haWwuY29tJywKICAgICAgJ3NrYW5kYS5wZW51anVyaUBnbWFpbC5jb20nLAogICAgICAnc3VqYTgxQGdtYWlsLmNvbScsCiAgICAgICdjaGFybGVzYWtsQGdtYWlsLmNvbScsCiAgICAgICduYXJhc2ltaGEubmVvQGdtYWlsLmNvbScsCiAgICAgICdwaW5nMnJ1cGVzaEBnbWFpbC5jb20nLAogICAgICAnc3VuaWwudm9sZGVtb3J0QGdtYWlsLmNvbScKICAgIF07CgogICAgaWYgKCFBTExPV0VEX0VNQUlMUy5pbmNsdWRlcyh1c2VyLmVtYWlsLnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgIC8vIE5vdCBhdXRob3Jpc2VkIOKAlCBzaWduIG91dCBhbmQgc2hvdyBhY2Nlc3MgZGVuaWVkCiAgICAgIF9hdXRoLnNpZ25PdXQoKTsKICAgICAgY29uc3QgbG9naW5TY3JlZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyZWVuLWxvZ2luJyk7CiAgICAgIGlmIChsb2dpblNjcmVlbikgewogICAgICAgIGxvZ2luU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgY29uc3Qgc3RhdHVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tc3RhdHVzJyk7CiAgICAgICAgaWYgKHN0YXR1c0VsKSB7CiAgICAgICAgICBzdGF0dXNFbC5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOiNFRjQ0NDQ7Zm9udC13ZWlnaHQ6ODAwOyI+4puUIEFjY2VzcyBkZW5pZWQ8L3NwYW4+PGJyPgogICAgICAgICAgICA8c3BhbiBzdHlsZT0iY29sb3I6Izk5OTsiPiR7dXNlci5lbWFpbH0gaXMgbm90IGF1dGhvcmlzZWQuPGJyPkNvbnRhY3QgdGhlIGFwcCBvd25lci48L3NwYW4+YDsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvb2dsZS1zaWduaW4tYnRuJyk7CiAgICAgICAgaWYgKGJ0bikgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgLy8g4pSA4pSAIEVuZCBhbGxvd2xpc3QgY2hlY2sg4pSA4pSACgogICAgLy8gVXNlciBpcyBzaWduZWQgaW4KICAgIHdpbmRvdy5fZmJVc2VyID0gdXNlcjsKICAgIHdpbmRvdy5fZmJEYiAgID0gX2RiOwoKICAgIC8vIEhpZGUgbG9naW4gc2NyZWVuCiAgICBpZiAobG9naW5TY3JlZW4pIGxvZ2luU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgLy8gVXBkYXRlIHVzZXIgZGlzcGxheSBpbiBzZXR0aW5ncyBpZiBlbGVtZW50IGV4aXN0cwogICAgY29uc3QgdXNlckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpcmViYXNlLXVzZXItZGlzcGxheScpOwogICAgaWYgKHVzZXJFbCkgewogICAgICB1c2VyRWwudGV4dENvbnRlbnQgPSB1c2VyLmRpc3BsYXlOYW1lIHx8IHVzZXIuZW1haWw7CiAgICB9CiAgICBjb25zdCB1c2VyQXZhdGFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpcmViYXNlLXVzZXItYXZhdGFyJyk7CiAgICBpZiAodXNlckF2YXRhciAmJiB1c2VyLnBob3RvVVJMKSB7CiAgICAgIHVzZXJBdmF0YXIuc3JjID0gdXNlci5waG90b1VSTDsKICAgICAgdXNlckF2YXRhci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIH0KCiAgICAvLyBMb2FkIGRhdGEgZnJvbSBjbG91ZCwgdGhlbiBzdGFydCByZWFsLXRpbWUgc3luYwogICAgYXdhaXQgZmlyZWJhc2VMb2FkKHVzZXIudWlkKTsKICAgIHN0YXJ0UmVhbHRpbWVTeW5jKHVzZXIudWlkKTsKCiAgfSBlbHNlIHsKICAgIC8vIE5vdCBzaWduZWQgaW4g4oCUIHNob3cgbG9naW4gc2NyZWVuCiAgICB3aW5kb3cuX2ZiVXNlciA9IG51bGw7CiAgICBpZiAobG9naW5TY3JlZW4pIGxvZ2luU2NyZWVuLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICBpZiAoX3Vuc3Vic2NyaWJlTGlzdGVuZXIpIF91bnN1YnNjcmliZUxpc3RlbmVyKCk7CiAgfQp9KTsKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEVORCBGSVJFQkFTRSBTWU5DIEVOR0lORQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCg=='];
var _src=_0x.join('');
var _dec=atob(_src);
var _fn=new Function(_dec);
_fn();
})();
</script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('[MoneyFi] SW registered:', reg.scope))
          .catch(err => console.warn('[MoneyFi] SW failed:', err));
      });
    }
  </script>
</body>
</html
<!-- ═══════════════════════════════ LOGIN SCREEN ═══════════════════════════════ -->
<div id="screen-login" style="
  position:fixed;inset:0;z-index:9999;
  background:linear-gradient(145deg,#0F1B4C 0%,#1E2A6E 50%,#2D3F8F 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:32px;font-family:'Nunito',sans-serif;
">
  <!-- Logo -->
  <div style="margin-bottom:8px;font-size:3.5em;">💰</div>
  <div style="font-size:2em;font-weight:900;color:white;letter-spacing:-0.5px;margin-bottom:4px;">MoneyFi</div>
  <div style="font-size:0.85em;color:rgba(255,255,255,0.6);font-weight:600;margin-bottom:48px;letter-spacing:1px;text-transform:uppercase;">Personal Finance</div>

  <!-- Card -->
  <div style="
    background:white;border-radius:24px;padding:32px 28px;
    width:100%;max-width:340px;box-shadow:0 20px 60px rgba(0,0,0,0.35);
    text-align:center;
  ">
    <div style="font-size:1.1em;font-weight:900;color:#1E2A6E;margin-bottom:6px;">Welcome back</div>
    <div style="font-size:0.82em;color:#888;font-weight:600;margin-bottom:24px;">Sign in to sync your data across all devices</div>

    <!-- Google Sign-In Button -->
    <button id="google-signin-btn" onclick="signInWithGoogle()" style="
      width:100%;padding:14px 20px;
      border:2px solid #E8E8E8;border-radius:14px;
      background:white;cursor:pointer;
      display:flex;align-items:center;justify-content:center;gap:12px;
      font-size:0.95em;font-weight:800;color:#1E2A6E;
      transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.08);
    "
    onmouseover="this.style.background='#F8F9FF';this.style.borderColor='#1E2A6E'"
    onmouseout="this.style.background='white';this.style.borderColor='#E8E8E8'"
    >
      <svg width="20" height="20" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.35-8.16 2.35-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
        <path fill="none" d="M0 0h48v48H0z"/>
      </svg>
      Continue with Google
    </button>

    <div style="margin-top:20px;padding-top:16px;border-top:1px solid #F0F0F0;">
      <div id="login-status" style="font-size:0.78em;color:#AAA;font-weight:600;">
        Securely synced with Firebase
      </div>
    </div>
  </div>

  <!-- Footer note -->
  <div style="margin-top:28px;font-size:0.74em;color:rgba(255,255,255,0.4);text-align:center;max-width:280px;line-height:1.5;">
    Your data is encrypted and stored in your personal Firebase account. No one else can access it.
  </div>
</div>
<!-- ══════════════════════════════════════════════════════════════════════════ -->

>