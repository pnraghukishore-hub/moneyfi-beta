<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ═══ PWA: MoneyFi ═══ -->
  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="MoneyFi">
  <meta name="theme-color" content="#1E2A6E">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <!-- ══════════════════════ -->
  <!-- ═══ Firebase SDKs ═══ -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <!-- ═══════════════════ -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoneyFi – Personal Finance</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #FFF9E6;
      --bg-cream: #FFFBF0;
      --yellow: #F5C842;
      --yellow-light: #FFF0B0;
      --blue-circle: #3B4A9C;
      --text-dark: #2D3250;
      --text-med: #5A6070;
      --text-light: #9AA0B2;
      --white: #FFFFFF;
      --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
      --card-shadow-hover: 0 8px 30px rgba(0,0,0,0.13);
      --radius: 20px;
      --radius-sm: 12px;
      --food: #FF6B35;
      --transport: #4A9EFF;
      --housing: #FF8C42;
      --health: #4ECDC4;
      --shopping: #FF4757;
      --membership: #FFBE0B;
      --giving: #FF6B9D;
      --income: #10B981;
      --expenses: #EF4444;
      --debt: #8B5CF6;
      --gold: #C8900A;
      --silver: #6E7A8A;
      --platinum: #4A5C6E;
      --portfolio: #7C3AED;
      --portfolio-light: #F3EEFF;
      --primary: #1E2A6E;
      --primary-light: #F0F4FF;

      /* Theme background variables (overridable by themes) */
      --theme-bg-main: #FFF9E6;
      --theme-overlay: none;
      --theme-card-extra: none;
    }

    /* ══ THEMES ══ */
    body.theme-looney { 
      --bg: #FFF0F5; --bg-cream: #FFF8FB; 
      background: #FFF0F5 !important;
    }
    body.theme-jungle { 
      --bg: #E8F5E9; --bg-cream: #F1F8E9; 
      background: #E8F5E9 !important;
    }
    body.theme-space { 
      --bg: #0D0D1A; --bg-cream: #12122A;
      --text-dark: #E8E8FF; --text-med: #A0A8CC; --text-light: #6070A0;
      --white: #1A1A30;
      background: #0D0D1A !important;
    }
    body.theme-ocean { 
      --bg: #E0F4FF; --bg-cream: #ECF9FF;
      background: #E0F4FF !important;
    }

    body { font-family: 'Nunito', sans-serif; background: var(--bg); color: var(--text-dark); min-height: 100vh; position: relative; overflow-x: hidden; }

    /* Theme decorations */
    .theme-deco { position: fixed; pointer-events: none; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-looney .theme-deco.looney-deco { opacity: 1; }
    body.theme-jungle .theme-deco.jungle-deco { opacity: 1; }
    body.theme-space .theme-deco.space-deco { opacity: 1; }
    body.theme-ocean .theme-deco.ocean-deco { opacity: 1; }

    /* ── TOP BAR ── */
    .topbar { background: var(--bg); padding: 16px 20px 0; display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 10; }
    .topbar-title { font-size: 1.3em; font-weight: 900; color: var(--text-dark); }
    .topbar-badge { background: var(--yellow); color: var(--text-dark); font-weight: 800; font-size: 0.8em; padding: 4px 12px; border-radius: 20px; cursor: pointer; }
    /* Quick-access icon buttons in topbar - fixed positioning replaced with flex in topbar */
    .topbar-icons { display: flex; align-items: center; gap: 6px; }
    .topbar-icon-btn { background: var(--white); border: none; border-radius: 50%; width: 34px; height: 34px; font-size: 1em; cursor: pointer; box-shadow: var(--card-shadow); display: flex; align-items: center; justify-content: center; transition: transform 0.2s; flex-shrink: 0; }
    .topbar-icon-btn:hover { transform: scale(1.1); }

    /* ── BOTTOM NAV ── */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--white); display: flex; justify-content: space-around; align-items: center; padding: 10px 0 18px; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 100; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; color: var(--text-light); font-size: 0.68em; font-weight: 700; transition: color 0.2s; background: none; border: none; padding: 0 10px; }
    .nav-item .nav-icon { font-size: 1.4em; }
    .nav-item.active { color: var(--yellow); }
    .nav-item.active .nav-icon { background: var(--yellow); color: white; width: 38px; height: 38px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.05em; }
    /* Floating add button */
    /* Floating add button + launcher */
    .fab-add { position: fixed; bottom: 72px; right: 20px; width: 56px; height: 56px; background: var(--yellow); border-radius: 50%; border: none; font-size: 1.8em; font-weight: 900; cursor: pointer; box-shadow: 0 4px 20px rgba(245,200,66,0.55); z-index: 200; display: flex; align-items: center; justify-content: center; transition: transform 0.25s, box-shadow 0.2s; animation: fabPulse 2.8s ease-in-out infinite; color: var(--text-dark); line-height: 1; }
    .fab-add:hover { transform: scale(1.12); box-shadow: 0 8px 28px rgba(245,200,66,0.7); animation: none; }
    .fab-add.open { transform: rotate(45deg); animation: none; box-shadow: 0 8px 28px rgba(245,200,66,0.7); }
    @keyframes fabPulse { 0%,100%{box-shadow:0 4px 20px rgba(245,200,66,0.55)} 50%{box-shadow:0 4px 30px rgba(245,200,66,0.85),0 0 0 8px rgba(245,200,66,0.15)} }
    @keyframes goalsFabPulse { 0%,100%{box-shadow:0 4px 20px rgba(30,42,110,0.45)} 50%{box-shadow:0 6px 28px rgba(30,42,110,0.7),0 0 0 8px rgba(30,42,110,0.12)} }
    /* Launcher menu */
    .fab-menu { position: fixed; bottom: 138px; right: 16px; display: flex; flex-direction: column; gap: 10px; z-index: 199; pointer-events: none; }
    .fab-menu-item { display: flex; align-items: center; gap: 10px; justify-content: flex-end; opacity: 0; transform: translateY(16px) scale(0.9); transition: opacity 0.2s, transform 0.2s; pointer-events: none; }
    .fab-menu-item.visible { opacity: 1; transform: translateY(0) scale(1); pointer-events: all; }
    .fab-menu-item:nth-child(1).visible { transition-delay: 0.05s; }
    .fab-menu-item:nth-child(2).visible { transition-delay: 0.02s; }
    .fab-menu-item:nth-child(3).visible { transition-delay: 0s; }
    .fab-menu-label { background: var(--white); color: var(--text-dark); font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; padding: 6px 12px; border-radius: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.12); white-space: nowrap; }
    .fab-menu-btn { width: 44px; height: 44px; border-radius: 50%; border: none; font-size: 1.2em; cursor: pointer; box-shadow: 0 3px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    /* Backdrop */
    .fab-backdrop { position: fixed; inset: 0; z-index: 198; display: none; }
    .fab-backdrop.open { display: block; }

    /* ── SCREENS ── */
    .screen { display: none; padding: 16px 20px 100px; position: relative; z-index: 1; }
    .screen.active { display: block; }

    /* ── TIME PERIOD SELECTOR (innovative calendar strip) ── */
    .time-period-bar { display: flex; background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin: 12px 0 16px; overflow: hidden; }
    .period-tab { flex: 1; padding: 10px 4px; border: none; background: none; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.78em; color: var(--text-light); cursor: pointer; transition: all 0.2s; text-align: center; }
    .period-tab.active { background: var(--yellow); color: var(--text-dark); border-radius: var(--radius-sm); margin: 3px; }
    .period-nav { display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 16px; }
    .period-nav button { background: none; border: none; font-size: 1.3em; cursor: pointer; color: var(--text-med); padding: 4px 8px; border-radius: 8px; transition: background 0.15s; }
    .period-nav button:hover { background: rgba(0,0,0,0.06); }
    .period-nav .period-label { font-size: 1em; font-weight: 800; color: var(--text-dark); min-width: 180px; text-align: center; }

    /* Day/Week detail row - shows mini days */
    .period-detail { display: none; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 12px; padding: 0 2px; }
    .period-detail::-webkit-scrollbar { display: none; }
    .period-detail.show { display: flex; }
    .day-chip { flex-shrink: 0; background: var(--white); border-radius: 10px; padding: 8px 10px; text-align: center; min-width: 44px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
    .day-chip.today { border-color: var(--yellow); background: var(--yellow-light); }
    .day-chip.selected { background: var(--yellow); }
    .day-chip .dc-day { font-size: 0.65em; font-weight: 800; color: var(--text-light); text-transform: uppercase; }
    .day-chip .dc-num { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .day-chip.selected .dc-day, .day-chip.selected .dc-num { color: var(--text-dark); }

    /* ── HOME ── */
    .spending-hero { text-align: center; padding: 4px 0 16px; }
    .spending-label { color: var(--text-med); font-size: 0.9em; font-weight: 600; }
    .spending-amount { font-size: 2.8em; font-weight: 900; color: var(--text-dark); margin: 4px 0; }

    /* Income Section on Home */
    .home-income-section { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .home-income-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .home-income-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .home-income-total { font-size: 1.1em; font-weight: 900; color: var(--income); }
    .income-sub-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .income-sub-card { background: #F0FBF3; border-radius: var(--radius-sm); padding: 14px 10px; text-align: center; cursor: pointer; transition: transform 0.2s; }
    .income-sub-card:hover { transform: translateY(-2px); }
    .income-sub-card .isc-icon { font-size: 1.5em; margin-bottom: 6px; }
    .income-sub-card .isc-name { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-bottom: 4px; }
    .income-sub-card .isc-amount { font-size: 1em; font-weight: 900; color: var(--income); }

    .budget-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
    .budget-card { background: var(--white); border-radius: var(--radius); padding: 16px 12px 14px; text-align: center; box-shadow: var(--card-shadow); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .budget-card:hover { transform: translateY(-2px); box-shadow: var(--card-shadow-hover); }
    .budget-card .cat-icon { width: 48px; height: 48px; border-radius: 14px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.4em; }
    .budget-card .cat-name { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-bottom: 4px; }
    .budget-card .cat-amount { font-size: 1.05em; font-weight: 900; color: var(--text-dark); }
    .budget-card .cat-bar { height: 3px; background: #F0F0F0; border-radius: 4px; margin-top: 10px; overflow: hidden; }
    .budget-card .cat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; }
    .budget-card.food { background: #FFF3EE; } .budget-card.food .cat-icon { background: #FFE0D3; }
    .budget-card.transport { background: #EEF5FF; } .budget-card.transport .cat-icon { background: #D6EAFF; }
    .budget-card.housing { background: #FFF5EE; } .budget-card.housing .cat-icon { background: #FFE5CC; }
    .budget-card.health { background: #F0FAFA; } .budget-card.health .cat-icon { background: #D0F0EE; }
    .budget-card.shopping { background: #FFF0F0; } .budget-card.shopping .cat-icon { background: #FFD6D6; }
    .budget-card.membership { background: #FFFBEE; } .budget-card.membership .cat-icon { background: #FFF0C0; }
    .budget-card.giving { background: #FFF0F7; } .budget-card.giving .cat-icon { background: #FFD6EA; }
    .budget-card.invest { background: #F0FBF3; } .budget-card.invest .cat-icon { background: #C6F0D0; }
    .budget-card.debt-cat { background: #F5F0FF; } .budget-card.debt-cat .cat-icon { background: #E0D5FF; }
    .budget-card.other-cat { background: #F5F8FF; } .budget-card.other-cat .cat-icon { background: #D8E5FF; }

    /* ── TRANSACTIONS ── */
    .search-bar { background: var(--white); border-radius: var(--radius-sm); padding: 12px 16px; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; box-shadow: var(--card-shadow); }
    .search-bar input { border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.95em; color: var(--text-dark); flex: 1; outline: none; }
    .search-bar input::placeholder { color: var(--text-light); }

    .filter-row { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
    .filter-chip { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 6px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.78em; color: var(--text-med); cursor: pointer; box-shadow: var(--card-shadow); white-space: nowrap; transition: all 0.2s; }
    .filter-chip.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }
    .date-filter-input { background: var(--white); border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 7px 10px; font-family: 'Nunito', sans-serif; font-size: 0.8em; font-weight: 700; color: var(--text-dark); outline: none; }
    .date-filter-input:focus { border-color: var(--yellow); }

    .tx-date-group { margin-bottom: 16px; }
    .tx-date-label { font-size: 0.82em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; padding: 0 4px; display: flex; justify-content: space-between; }
    .tx-row { background: var(--white); border-radius: var(--radius-sm); padding: 12px 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.15s; }
    .tx-row:hover { transform: translateX(4px); }
    .tx-icon { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; flex-shrink: 0; }
    .tx-info { flex: 1; }
    .tx-cat { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .tx-sub { font-size: 0.78em; color: var(--text-light); font-weight: 600; margin-top: 2px; }
    .tx-amount { font-weight: 900; font-size: 1em; }
    .tx-amount.expense { color: var(--expenses); }
    .tx-amount.income-c { color: var(--income); }
    .tx-amount.invest-c { color: var(--portfolio); }
    .tx-time { font-size: 0.72em; color: var(--text-light); margin-top: 2px; text-align: right; }

    /* ── CATEGORY MANAGER ── */
    .cat-mgr-tabs { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:14px; }
    .cat-mgr-tab { background:#F0F0F0; border:none; border-radius:20px; padding:6px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; color:var(--text-med); cursor:pointer; transition:all 0.2s; }
    .cat-mgr-tab.active { background:var(--yellow); color:var(--text-dark); }
    .cat-pills-wrap { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px; min-height:36px; }
    .cat-pill { display:flex; align-items:center; gap:5px; background:var(--bg-cream); border:1.5px solid #E8E8E8; border-radius:20px; padding:6px 10px 6px 12px; font-size:0.8em; font-weight:700; color:var(--text-dark); }
    .cat-pill-del { background:none; border:none; cursor:pointer; color:var(--text-light); font-size:0.85em; font-weight:900; line-height:1; padding:0; transition:color 0.15s; }
    .cat-pill-del:hover { color:var(--expenses); }
    .cat-add-row { display:flex; gap:8px; align-items:center; }
    .cat-add-input { flex:1; border:1.5px solid #E8E8E8; border-radius:10px; padding:9px 12px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; background:var(--white); }
    .cat-add-input:focus { border-color:var(--yellow); }
    .cat-add-btn { background:var(--yellow); border:none; border-radius:10px; padding:9px 16px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.88em; cursor:pointer; color:var(--text-dark); white-space:nowrap; }
    .cat-add-btn:hover { background:#e8b900; }
    /* Quick-add subcats with delete on hold */
    .qa-sub-pill { position:relative; }
    .qa-sub-pill .qa-pill-del { display:none; position:absolute; top:-6px; right:-6px; background:var(--expenses); color:white; border:none; border-radius:50%; width:16px; height:16px; font-size:0.6em; font-weight:900; cursor:pointer; align-items:center; justify-content:center; line-height:1; padding:0; }
    .qa-sub-pill.delete-mode .qa-pill-del { display:flex; }

    /* ── CALENDAR MODULE ── */
    .cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
    .cal-month-title { font-size:1.25em; font-weight:900; color:var(--text-dark); }
    .cal-nav-btn { background:var(--white); border:none; border-radius:12px; width:38px; height:38px; font-size:1.4em; color:var(--text-dark); cursor:pointer; box-shadow:var(--card-shadow); display:flex; align-items:center; justify-content:center; font-weight:900; transition:background 0.15s; line-height:1; }
    .cal-nav-btn:hover { background:var(--yellow); }
    .cal-summary { display:flex; background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:14px 10px; margin-bottom:14px; align-items:center; justify-content:space-around; }
    .cal-sum-item { text-align:center; }
    .cal-sum-label { font-size:0.68em; font-weight:800; color:var(--text-light); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.4px; }
    .cal-sum-val { font-size:1.05em; font-weight:900; }
    .cal-sum-item.income .cal-sum-val { color:var(--income); }
    .cal-sum-item.expense .cal-sum-val { color:var(--expenses); }
    .cal-sum-item.savings .cal-sum-val { color:#7C3AED; }
    .cal-sum-item.net .cal-sum-val { color:var(--text-dark); }
    .cal-sum-divider { width:1px; height:32px; background:#F0F0F0; }
    .cal-grid-wrap { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); overflow:hidden; margin-bottom:14px; }
    .cal-dow-row { display:grid; grid-template-columns:repeat(7,1fr); padding:10px 0 8px; border-bottom:1px solid #F5F5F5; }
    .cal-dow { text-align:center; font-size:0.7em; font-weight:900; color:var(--text-light); letter-spacing:0.3px; }
    .cal-grid { display:grid; grid-template-columns:repeat(7,1fr); }
    .cal-cell { border-right:1px solid #F5F5F5; border-bottom:1px solid #F5F5F5; padding:6px 3px 5px; min-height:70px; cursor:pointer; transition:background 0.15s; display:flex; flex-direction:column; align-items:center; }
    .cal-cell:nth-child(7n) { border-right:none; }
    .cal-cell:hover:not(.empty) { background:#FAFAFA; }
    .cal-cell.empty { cursor:default; }
    .cal-cell.today .cal-day-num { background:var(--yellow); color:var(--text-dark); }
    .cal-cell.selected { background:var(--yellow-light); }
    .cal-cell.selected .cal-day-num { background:var(--yellow); }
    .cal-day-num { width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8em; font-weight:800; color:var(--text-dark); margin-bottom:4px; transition:background 0.15s; }
    .cal-dots { display:flex; gap:2px; flex-wrap:wrap; justify-content:center; margin-bottom:3px; min-height:8px; }
    .cal-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; }
    .cal-cell-amt { font-size:0.58em; font-weight:900; line-height:1.3; text-align:center; }
    .cal-detail-header { font-size:0.82em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; padding:0 4px; display:flex; justify-content:space-between; align-items:center; }
    .cal-detail-header .cal-det-right { display:flex; gap:8px; }
    .cal-empty-day { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:24px; text-align:center; color:var(--text-light); }

    /* ── HOME TABS (Spending / Investment) ── */
    .home-tab-bar { display:flex; background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); margin-bottom:16px; padding:4px; gap:4px; }
    .home-tab-btn { flex:1; padding:11px 8px; border:none; border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:900; font-size:0.88em; cursor:pointer; background:none; color:var(--text-light); transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:5px; }
    .home-tab-btn.active { background:var(--yellow); color:var(--text-dark); box-shadow:0 2px 10px rgba(245,200,66,0.4); }
    .home-section { display:none; }
    .home-section.active { display:block; }

    /* ── INVESTMENT HOME GRID ── */
    .invest-home-hero { text-align:center; padding:4px 0 16px; }
    .invest-home-hero-label { font-size:0.88em; font-weight:700; color:var(--text-med); }
    .invest-home-hero-amt { font-size:2.6em; font-weight:900; color:var(--text-dark); margin:4px 0; }
    .invest-cat-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-bottom:16px; }
    .invest-cat-card { background:var(--white); border-radius:var(--radius); padding:16px; box-shadow:var(--card-shadow); cursor:pointer; transition:transform 0.2s,box-shadow 0.2s; }
    .invest-cat-card:hover { transform:translateY(-2px); box-shadow:var(--card-shadow-hover); }
    .inv-card-icon { width:46px; height:46px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:1.35em; margin-bottom:10px; }
    .inv-card-label { font-size:0.72em; font-weight:800; color:var(--text-med); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.3px; }
    .inv-card-amt { font-size:1.08em; font-weight:900; color:var(--text-dark); }
    .inv-card-units { font-size:0.72em; color:var(--text-light); font-weight:600; margin-top:3px; }
    .inv-card-bar { height:3px; background:#F0F0F0; border-radius:4px; margin-top:10px; overflow:hidden; }
    .inv-card-bar-fill { height:100%; border-radius:4px; transition:width 0.6s; }

    /* ── INVESTMENT QUICK-ADD MODAL ── */
    .inv-type-tabs { display:flex; gap:6px; overflow-x:auto; scrollbar-width:none; margin-bottom:16px; padding-bottom:2px; }
    .inv-type-tabs::-webkit-scrollbar { display:none; }
    .inv-type-chip { flex-shrink:0; border:none; border-radius:20px; padding:7px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; cursor:pointer; background:#F0F0F0; color:var(--text-med); transition:all 0.2s; }
    .inv-type-chip.active { color:white; }
    .inv-fields-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:14px; }
    .inv-field-box { display:flex; flex-direction:column; gap:5px; }
    .inv-field-box.full { grid-column:span 2; }
    .inv-field-box label { font-size:0.7em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; }
    .inv-field-input, .inv-field-select { border:1.5px solid #EEE; border-radius:10px; padding:9px 10px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; background:var(--white); width:100%; }
    .inv-field-input:focus, .inv-field-select:focus { border-color:#7C3AED; }
    .inv-total-pill { background:#F3EEFF; border-radius:12px; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
    .inv-total-pill-label { font-size:0.75em; font-weight:900; color:#7C3AED; }
    .inv-total-pill-val { font-size:1.2em; font-weight:900; color:#7C3AED; }
    .inv-save-btn { width:100%; background:#7C3AED; border:none; border-radius:var(--radius-sm); padding:16px; font-family:'Nunito',sans-serif; font-weight:900; font-size:1em; color:white; cursor:pointer; transition:background 0.2s; }
    .inv-save-btn:hover { background:#6D28D9; }

    /* ── CURRENCY PICKER ── */
    .curr-search { width:100%; border:1.5px solid #EEE; border-radius:10px; padding:10px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; margin-bottom:8px; box-sizing:border-box; }
    .curr-search:focus { border-color:var(--yellow); }
    .curr-list { max-height:300px; overflow-y:auto; }
    .curr-item { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:10px; cursor:pointer; transition:background 0.15s; }
    .curr-item:hover { background:#F5F5F5; }
    .curr-item.active { background:var(--yellow-light); }
    .curr-flag { font-size:1.3em; width:28px; text-align:center; flex-shrink:0; }
    .curr-info { flex:1; }
    .curr-name { font-weight:800; font-size:0.88em; color:var(--text-dark); }
    .curr-country { font-size:0.72em; color:var(--text-light); font-weight:600; }
    .curr-code { font-weight:900; font-size:0.88em; color:var(--text-med); }
    .curr-symbol { font-size:1em; font-weight:900; color:var(--text-dark); min-width:20px; text-align:right; }

    /* ── HOME CARD MANAGER (Settings) ── */
    .home-card-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:14px; }
    .home-card-item { display:flex; align-items:center; gap:8px; background:#F8F8F8; border-radius:10px; padding:8px 10px; }
    .home-card-item-icon { font-size:1.1em; }
    .home-card-item-label { flex:1; font-weight:800; font-size:0.82em; color:var(--text-dark); }
    .home-card-toggle { background:none; border:none; cursor:pointer; font-size:1em; padding:0; color:var(--text-light); transition:color 0.15s; font-weight:900; }
    .home-card-toggle.on { color:var(--income); }
    .home-card-add-row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:4px; }
    .home-card-emoji-pick { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:8px; }
    .emoji-opt { font-size:1.2em; cursor:pointer; padding:4px; border-radius:6px; transition:background 0.15s; }
    .emoji-opt:hover, .emoji-opt.selected { background:var(--yellow-light); }

    /* ── STATS ── */
    .chart-card { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .chart-title { font-weight: 800; font-size: 0.9em; color: var(--text-med); margin-bottom: 14px; }
    .chart-container { position: relative; height: 200px; }
    .spending-tops { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .top-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .top-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .top-label { flex: 1; font-weight: 700; font-size: 0.9em; color: var(--text-dark); }
    .top-pct { font-weight: 800; font-size: 0.85em; color: var(--text-med); }

    /* ── ACCOUNT ── */
    .networth-card { background: var(--white); border-radius: var(--radius); padding: 24px; text-align: center; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .nw-label { color: var(--text-light); font-size: 0.85em; font-weight: 700; margin-bottom: 8px; }
    .nw-amount { font-size: 2.5em; font-weight: 900; color: var(--text-dark); }
    .nw-sub { display: flex; justify-content: center; gap: 24px; margin-top: 12px; flex-wrap: wrap; }
    .nw-sub-item { font-size: 0.82em; font-weight: 700; color: var(--text-med); }
    .nw-sub-item span { color: var(--text-dark); display: block; font-size: 1.15em; }
    .account-section-title { font-weight: 900; font-size: 0.9em; color: var(--text-med); margin-bottom: 12px; letter-spacing: 0.3px; }
    .account-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
    .account-card { background: var(--white); border-radius: var(--radius-sm); padding: 14px 10px; text-align: center; box-shadow: var(--card-shadow); cursor: pointer; }
    .account-card .acc-icon { font-size: 1.6em; margin-bottom: 6px; }
    .account-card .acc-name { font-size: 0.72em; font-weight: 700; color: var(--text-light); margin-bottom: 4px; }
    .account-card .acc-amount { font-size: 0.95em; font-weight: 900; color: var(--text-dark); }
    .account-card.credit .acc-amount { color: var(--expenses); }

    /* ── ADD SCREEN ── */
    .add-type-toggle { display: flex; background: var(--white); border-radius: var(--radius-sm); padding: 4px; gap: 4px; box-shadow: var(--card-shadow); margin-bottom: 16px; overflow-x: auto; }
    .add-type-btn { flex: 1; padding: 10px 8px; border: none; border-radius: 10px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; cursor: pointer; background: none; color: var(--text-light); white-space: nowrap; transition: all 0.2s; }
    .add-type-btn.active { background: var(--yellow); color: var(--text-dark); box-shadow: 0 2px 8px rgba(245,200,66,0.4); }

    .amount-display { background: var(--white); border-radius: var(--radius); padding: 30px 20px; text-align: center; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .amount-display .amount-num { font-size: 3em; font-weight: 900; color: var(--text-dark); letter-spacing: -2px; }
    .amount-display .amount-cur { color: var(--text-light); font-size: 0.5em; vertical-align: super; }

    .sub-cats { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-bottom: 16px; scrollbar-width: none; }
    .sub-cats::-webkit-scrollbar { display: none; }
    .sub-cat-pill { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 6px 14px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.82em; color: var(--text-med); cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .sub-cat-pill.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }

    .add-form { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .form-row { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid #F5F5F5; }
    .form-row:last-child { border-bottom: none; }
    .form-icon { font-size: 1.2em; width: 28px; text-align: center; }
    .form-label { font-weight: 700; color: var(--text-med); font-size: 0.88em; min-width: 80px; }
    .form-input { flex: 1; border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.92em; font-weight: 700; color: var(--text-dark); text-align: right; outline: none; }
    .form-input::placeholder { color: var(--text-light); }
    .form-select { border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 0.92em; font-weight: 700; color: var(--text-dark); text-align: right; outline: none; cursor: pointer; flex: 1; direction: rtl; }

    .numpad { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .numpad-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .num-btn { background: #F8F8F8; border: none; border-radius: 12px; padding: 16px 8px; font-family: 'Nunito', sans-serif; font-size: 1.1em; font-weight: 800; color: var(--text-dark); cursor: pointer; transition: background 0.15s; text-align: center; }
    .num-btn:hover { background: #F0F0F0; }
    .num-btn.special { color: var(--text-med); font-size: 0.9em; }
    .num-btn.save-btn { background: var(--yellow); color: var(--text-dark); font-weight: 900; font-size: 1em; }
    .num-btn.save-btn:hover { background: #E8B800; }

    /* ── DATA SCREEN ── */
    .data-controls { background: var(--white); border-radius: var(--radius); padding: 16px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .data-controls-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 10px; }
    .data-controls-row:last-child { margin-bottom: 0; }
    .data-label { font-size: 0.82em; font-weight: 800; color: var(--text-med); }

    .data-section { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; overflow: hidden; }
    .data-section-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 18px; cursor: pointer; border-bottom: 1px solid #F5F5F5; gap: 10px; flex-wrap: wrap; }
    .data-section-title { display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .data-section-total { font-size: 0.85em; font-weight: 700; }
    .data-section-actions { display: flex; gap: 6px; }
    .data-section-body { display: none; }
    .data-section-body.open { display: block; }

    .data-table-wrap { overflow-x: auto; }
    .data-table { width: 100%; border-collapse: collapse; min-width: 480px; }
    .data-table th { background: #F8F8F8; padding: 10px 10px; text-align: left; font-size: 0.78em; font-weight: 800; color: var(--text-med); text-transform: uppercase; letter-spacing: 0.4px; cursor: pointer; user-select: none; white-space: nowrap; }
    .data-table th:hover { background: var(--yellow-light); color: var(--text-dark); }
    .data-table td { padding: 10px 10px; border-bottom: 1px solid #F8F8F8; font-size: 0.88em; font-weight: 600; color: var(--text-dark); }
    .data-table td[contenteditable="true"]:hover { background: rgba(245,200,66,0.08); outline: 1px solid var(--yellow); cursor: text; }
    .data-table td[contenteditable="true"]:focus { background: var(--yellow-light); outline: 2px solid var(--yellow); }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: #FAFAFA; }
    .del-btn-sm { background: #FFF0F0; border: none; border-radius: 8px; padding: 4px 8px; font-size: 0.82em; color: var(--expenses); cursor: pointer; font-weight: 700; }
    .del-btn-sm:hover { background: var(--expenses); color: white; }
    .icon-btn { background: var(--white); border: 1.5px solid #EEE; border-radius: 8px; padding: 6px 10px; font-size: 0.78em; font-weight: 800; color: var(--text-med); cursor: pointer; }
    .icon-btn:hover { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }
    .icon-btn.danger:hover { border-color: var(--expenses); background: #FFF0F0; color: var(--expenses); }

    .quick-add-row { display: flex; gap: 8px; padding: 14px 16px; border-top: 1px solid #F5F5F5; flex-wrap: wrap; align-items: center; background: #FAFAFA; }
    .qa-input { background: var(--white); border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 8px 12px; font-family: 'Nunito', sans-serif; font-size: 0.85em; font-weight: 700; color: var(--text-dark); outline: none; flex: 1; min-width: 80px; }
    .qa-input:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .qa-input::placeholder { color: var(--text-light); font-weight: 600; }
    .qa-btn { background: var(--yellow); border: none; border-radius: var(--radius-sm); padding: 8px 14px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.85em; color: var(--text-dark); cursor: pointer; white-space: nowrap; }
    .qa-btn:hover { background: #E8B800; }

    .import-panel { padding: 14px 16px; border-top: 1px solid #F5F5F5; }
    .import-panel-title { font-size: 0.78em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 8px; }
    .paste-area { width: 100%; height: 90px; background: #F8F8F8; border: 1.5px solid #EEE; border-radius: var(--radius-sm); padding: 10px 12px; font-family: monospace; font-size: 0.82em; color: var(--text-dark); resize: vertical; outline: none; }
    .paste-area:focus { border-color: var(--yellow); }
    .import-controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }

    /* ── METALS ── */
    .metals-portfolio-bar { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .metals-portfolio-title { font-size: 0.78em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 8px; }
    .metals-portfolio-total { font-size: 2.2em; font-weight: 900; color: var(--text-dark); margin-bottom: 16px; }
    .metals-mini-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .metals-mini-card { border-radius: var(--radius-sm); padding: 12px 10px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .metals-mini-card:hover { transform: translateY(-2px); box-shadow: var(--card-shadow-hover); }
    .metals-mini-card.active-metal { box-shadow: 0 0 0 2.5px var(--text-dark); }
    .metals-mini-card.gold-card { background: linear-gradient(145deg, #FFF3C4, #FFE580); }
    .metals-mini-card.silver-card { background: linear-gradient(145deg, #E8EDF2, #D0D8E0); }
    .metals-mini-card.platinum-card { background: linear-gradient(145deg, #DDE5EC, #C5D2DC); }
    .metals-mini-icon { font-size: 1.6em; margin-bottom: 6px; }
    .metals-mini-name { font-size: 0.72em; font-weight: 800; color: var(--text-med); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.4px; }
    .metals-mini-grams { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metals-mini-usd { font-size: 0.72em; font-weight: 700; color: var(--text-med); margin-top: 2px; }

    .metal-detail-header { display: flex; align-items: center; gap: 14px; padding: 18px 20px; background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; }
    .metal-detail-icon-wrap { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.8em; flex-shrink: 0; }
    .metal-detail-icon-wrap.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
    .metal-detail-icon-wrap.silver { background: linear-gradient(135deg, #C0C0C0, #8A9BA8); }
    .metal-detail-icon-wrap.platinum { background: linear-gradient(135deg, #8FA4B2, #4A6070); }
    .metal-detail-info { flex: 1; }
    .metal-detail-name { font-size: 1.1em; font-weight: 900; color: var(--text-dark); }
    .metal-detail-grams { font-size: 0.82em; font-weight: 700; color: var(--text-med); margin-top: 3px; }
    .metal-detail-usd { font-size: 1.4em; font-weight: 900; margin-top: 2px; }
    .metal-detail-usd.gold { color: #C8900A; } .metal-detail-usd.silver { color: #6E7A8A; } .metal-detail-usd.platinum { color: #4A5C6E; }
    .metal-stat-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 14px; }
    .metal-stat-box { background: var(--white); border-radius: var(--radius-sm); padding: 12px; text-align: center; box-shadow: var(--card-shadow); }
    .metal-stat-box-val { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metal-stat-box-lbl { font-size: 0.7em; font-weight: 700; color: var(--text-light); margin-top: 3px; text-transform: uppercase; }
    .metal-add-panel { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); margin-bottom: 14px; overflow: hidden; }
    .metal-add-panel-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; cursor: pointer; user-select: none; }
    .metal-add-panel-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); display: flex; align-items: center; gap: 8px; }
    .metal-add-panel-toggle { font-size: 1.2em; color: var(--text-light); transition: transform 0.2s; }
    .metal-add-panel-body { display: none; padding: 0 20px 20px; border-top: 1px solid #F0F0F0; }
    .metal-add-panel-body.open { display: block; }
    .metal-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 14px 0; }
    .metal-form-field { display: flex; flex-direction: column; gap: 5px; }
    .metal-form-field label { font-size: 0.72em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .metal-form-field input, .metal-form-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.88em; color: var(--text-dark); outline: none; width: 100%; }
    .metal-form-field input:focus, .metal-form-field select:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .metal-form-field.full { grid-column: span 2; }
    .metal-save-btn { width: 100%; border: none; border-radius: var(--radius-sm); padding: 14px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.95em; color: white; cursor: pointer; }
    .metal-save-btn.gold { background: linear-gradient(135deg, #C8900A, #F5C842); }
    .metal-save-btn.silver { background: linear-gradient(135deg, #6E7A8A, #9BA8B5); }
    .metal-save-btn.platinum { background: linear-gradient(135deg, #4A5C6E, #6B8FA6); }
    .metal-holdings-card { background: var(--white); border-radius: var(--radius); box-shadow: var(--card-shadow); overflow: hidden; margin-bottom: 16px; }
    .metal-holdings-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid #F5F5F5; }
    .metal-holdings-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); }
    .metal-holdings-count { font-size: 0.78em; font-weight: 700; color: var(--text-light); background: #F5F5F5; padding: 4px 10px; border-radius: 20px; }
    .metal-holding-item { display: flex; align-items: center; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #F8F8F8; }
    .metal-holding-item:last-child { border-bottom: none; }
    .metal-holding-badge { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; flex-shrink: 0; }
    .metal-holding-badge.gold { background: linear-gradient(135deg, #FFE080, #FFD700); }
    .metal-holding-badge.silver { background: linear-gradient(135deg, #D8E0E8, #B0BBC5); }
    .metal-holding-badge.platinum { background: linear-gradient(135deg, #C0CDD6, #8A9FAD); }
    .metal-holding-main { flex: 1; min-width: 0; }
    .metal-holding-top { display: flex; align-items: center; gap: 8px; }
    .metal-holding-name-text { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .metal-holding-form-chip { font-size: 0.68em; font-weight: 800; padding: 2px 7px; border-radius: 6px; background: #F0F0F0; color: var(--text-med); }
    .metal-holding-bottom { font-size: 0.76em; font-weight: 600; color: var(--text-light); margin-top: 3px; }
    .metal-holding-right { text-align: right; flex-shrink: 0; }
    .metal-holding-value { font-size: 1em; font-weight: 900; color: var(--text-dark); }
    .metal-holding-weight { font-size: 0.76em; font-weight: 700; color: var(--text-light); margin-top: 2px; }
    .metal-holding-del { background: none; border: none; color: #DDD; font-size: 1em; cursor: pointer; padding: 4px; border-radius: 6px; }
    .metal-holding-del:hover { color: var(--expenses); background: #FFF0F0; }
    .metal-empty { text-align: center; padding: 40px 20px; color: var(--text-light); }
    .metal-empty-icon { font-size: 2.5em; margin-bottom: 10px; opacity: 0.5; }
    .metal-empty-text { font-weight: 700; font-size: 0.9em; }

    /* ── INVESTMENTS ── */
    .invest-hero { background: linear-gradient(135deg, #7C3AED 0%, #A855F7 60%, #C084FC 100%); border-radius: var(--radius); padding: 24px; margin-bottom: 16px; position: relative; overflow: hidden; }
    .invest-hero-label { color: rgba(255,255,255,0.85); font-size: 0.85em; font-weight: 700; margin-bottom: 6px; }
    .invest-hero-value { color: #fff; font-size: 2.4em; font-weight: 900; }
    .invest-hero-stats { display: flex; gap: 12px; margin-top: 14px; flex-wrap: wrap; }
    .invest-hero-stat { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 10px 14px; }
    .invest-hero-stat-val { color: #fff; font-weight: 900; font-size: 1em; }
    .invest-hero-stat-lbl { color: rgba(255,255,255,0.75); font-size: 0.72em; font-weight: 700; margin-top: 2px; }
    .invest-deco { position: absolute; right: -10px; top: -10px; font-size: 5em; opacity: 0.1; }
    .invest-cat-tabs { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-bottom: 16px; scrollbar-width: none; }
    .invest-cat-tabs::-webkit-scrollbar { display: none; }
    .invest-cat-tab { background: var(--white); border: 2px solid transparent; border-radius: 20px; padding: 8px 16px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.82em; color: var(--text-med); cursor: pointer; white-space: nowrap; box-shadow: var(--card-shadow); }
    .invest-cat-tab.active { border-color: var(--portfolio); background: var(--portfolio-light); color: var(--portfolio); }
    .invest-holding-row { background: var(--white); border-radius: var(--radius-sm); padding: 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; box-shadow: var(--card-shadow); cursor: pointer; }
    .invest-holding-row:hover { transform: translateX(4px); }
    .invest-ticker-badge { background: var(--portfolio-light); color: var(--portfolio); border-radius: 10px; padding: 8px 10px; font-weight: 900; font-size: 0.85em; min-width: 56px; text-align: center; flex-shrink: 0; }
    .invest-info { flex: 1; }
    .invest-name { font-weight: 800; font-size: 0.9em; color: var(--text-dark); }
    .invest-detail { font-size: 0.78em; color: var(--text-light); font-weight: 600; margin-top: 2px; }
    .invest-values { text-align: right; }
    .invest-value { font-weight: 900; font-size: 1em; color: var(--text-dark); }
    .invest-gain { font-size: 0.78em; font-weight: 700; margin-top: 2px; }
    .invest-gain.up { color: var(--income); } .invest-gain.down { color: var(--expenses); }
    .invest-entry-card { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .invest-entry-title { font-weight: 900; font-size: 0.95em; color: var(--text-dark); margin-bottom: 14px; }
    .inv-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
    .inv-field { display: flex; flex-direction: column; gap: 5px; }
    .inv-field label { font-size: 0.72em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .inv-field input, .inv-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.88em; color: var(--text-dark); outline: none; width: 100%; }
    .inv-field input:focus, .inv-field select:focus { border-color: var(--portfolio); background: var(--portfolio-light); }
    .inv-field.full { grid-column: span 2; }
    .add-invest-btn { width: 100%; background: var(--portfolio); border: none; border-radius: var(--radius-sm); padding: 16px; font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 0.95em; color: white; cursor: pointer; margin-top: 4px; }

    /* ── MODAL (shared) ── */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 200; backdrop-filter: blur(4px); }
    .modal-overlay.open { display: flex; align-items: flex-end; }
    .modal { background: var(--white); border-radius: 24px 24px 0 0; padding: 24px 20px; width: 100%; max-height: 92vh; overflow-y: auto; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-title { font-size: 1.1em; font-weight: 900; color: var(--text-dark); }
    .modal-close { background: #F0F0F0; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 1em; color: var(--text-med); display: flex; align-items: center; justify-content: center; }

    /* ── QUICK ADD POPUP ── */
    #quick-add-modal .modal { padding-bottom: 32px; }
    .qa-type-row { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 14px; }
    .qa-type-row::-webkit-scrollbar { display: none; }
    .qa-type-chip { flex-shrink: 0; padding: 8px 14px; border: 2px solid transparent; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.8em; background: #F5F5F5; color: var(--text-med); cursor: pointer; transition: all 0.2s; }
    .qa-type-chip.active { background: var(--yellow); color: var(--text-dark); border-color: var(--yellow); }

    .qa-amount-row { display: flex; align-items: center; background: #F8F8F8; border-radius: var(--radius-sm); padding: 12px 16px; margin-bottom: 14px; }
    .qa-currency-sym { font-size: 1.2em; font-weight: 900; color: var(--text-light); margin-right: 6px; }
    .qa-amount-input { flex: 1; border: none; background: none; font-family: 'Nunito', sans-serif; font-size: 2em; font-weight: 900; color: var(--text-dark); outline: none; width: 100%; }

    .qa-sub-cats { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; margin-bottom: 12px; padding-bottom: 2px; }
    .qa-sub-cats::-webkit-scrollbar { display: none; }
    .qa-sub-pill { flex-shrink: 0; padding: 6px 12px; border: 2px solid #EEE; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.78em; color: var(--text-med); cursor: pointer; background: var(--white); transition: all 0.15s; }
    .qa-sub-pill.active { border-color: var(--yellow); background: var(--yellow-light); color: var(--text-dark); }

    .qa-fields-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .qa-field { display: flex; flex-direction: column; gap: 4px; }
    .qa-field label { font-size: 0.7em; font-weight: 800; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.4px; }
    .qa-field input, .qa-field select { background: #F8F8F8; border: 1.5px solid #EEE; border-radius: 10px; padding: 10px 12px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.85em; color: var(--text-dark); outline: none; }
    .qa-field input:focus, .qa-field select:focus { border-color: var(--yellow); background: var(--yellow-light); }
    .qa-field.full { grid-column: span 2; }

    .qa-numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 14px; }
    .qa-key { background: #F5F5F5; border: none; border-radius: 12px; padding: 14px 8px; font-family: 'Nunito', sans-serif; font-size: 1.2em; font-weight: 800; color: var(--text-dark); cursor: pointer; transition: all 0.12s; text-align: center; -webkit-tap-highlight-color: transparent; }
    .qa-key:active { background: #E8E8E8; transform: scale(0.94); }
    .qa-key.qa-del { font-size: 1em; color: var(--text-med); }
    .qa-key.qa-dot { font-size: 1.3em; }
    .qa-key.qa-save { background: var(--yellow); color: var(--text-dark); font-size: 0.9em; font-weight: 900; }
    .qa-key.qa-save:active { background: #E8B800; }

    /* ══ SETTINGS ══ */
    .settings-card { background: var(--white); border-radius: var(--radius); padding: 24px; box-shadow: var(--card-shadow); margin-bottom: 16px; }
    .settings-title { font-weight: 900; font-size: 1.05em; color: var(--text-dark); margin-bottom: 16px; }

    /* Theme Selector */
    .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .theme-card { border-radius: var(--radius-sm); padding: 14px 12px; cursor: pointer; border: 2.5px solid transparent; transition: all 0.2s; position: relative; overflow: hidden; }
    .theme-card.active-theme { border-color: var(--text-dark); }
    .theme-card .tc-preview { font-size: 2em; margin-bottom: 6px; line-height: 1; }
    .theme-card .tc-name { font-size: 0.82em; font-weight: 800; color: var(--text-dark); }
    .theme-card .tc-desc { font-size: 0.7em; font-weight: 600; color: var(--text-med); margin-top: 2px; }
    .theme-card .tc-active-badge { position: absolute; top: 8px; right: 8px; background: var(--yellow); border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 0.65em; }
    .theme-card.active-theme .tc-active-badge { display: flex; }

    /* Theme: Looney Toons */
    .theme-card.looney { background: linear-gradient(135deg, #FFE8F0, #FFC8E8); }
    /* Theme: Jungle */
    .theme-card.jungle { background: linear-gradient(135deg, #E8F5E9, #C8E6C9); }
    /* Theme: Space */
    .theme-card.space { background: linear-gradient(135deg, #1A1A40, #2D1B69); }
    .theme-card.space .tc-name, .theme-card.space .tc-desc { color: #C8C8FF; }
    /* Theme: Ocean */
    .theme-card.ocean { background: linear-gradient(135deg, #E0F4FF, #B3E5FC); }
    /* Theme: Default */
    .theme-card.default { background: linear-gradient(135deg, #FFF9E6, #FFF0B0); }

    /* ── FLOATING THEME ELEMENTS ── */
    /* Looney Tunes characters */
    .looney-char { position: fixed; pointer-events: none; font-size: 2.5em; animation: floatBounce 3s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-looney .looney-char { opacity: 0.35; }
    @keyframes floatBounce { 0%,100%{transform:translateY(0) rotate(-5deg)} 50%{transform:translateY(-12px) rotate(5deg)} }

    /* Jungle elements */
    .jungle-leaf { position: fixed; pointer-events: none; font-size: 2em; animation: leafSway 4s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-jungle .jungle-leaf { opacity: 0.3; }
    @keyframes leafSway { 0%,100%{transform:rotate(-8deg) scale(1)} 50%{transform:rotate(8deg) scale(1.05)} }

    /* Space elements */
    .space-star { position: fixed; pointer-events: none; font-size: 1.2em; animation: twinkle 2s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-space .space-star { opacity: 0.5; }
    @keyframes twinkle { 0%,100%{opacity:0.3;transform:scale(1)} 50%{opacity:0.8;transform:scale(1.2)} }

    /* Ocean elements */
    .ocean-wave { position: fixed; pointer-events: none; font-size: 2em; animation: waveFloat 5s ease-in-out infinite; z-index: 0; opacity: 0; transition: opacity 0.5s; }
    body.theme-ocean .ocean-wave { opacity: 0.25; }
    @keyframes waveFloat { 0%,100%{transform:translateX(0) rotate(0deg)} 50%{transform:translateX(15px) rotate(10deg)} }

    /* ── DECORATIVE ── */
    .deco-circle { position: fixed; border-radius: 50%; pointer-events: none; z-index: 0; }
    .deco-yellow { background: var(--yellow); }
    .deco-blue { background: var(--blue-circle); }

    /* ── TOAST ── */
    .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px); background: var(--text-dark); color: white; padding: 12px 20px; border-radius: 30px; font-weight: 700; font-size: 0.85em; z-index: 999; opacity: 0; transition: all 0.3s; white-space: nowrap; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .positive { color: var(--income); } .negative { color: var(--expenses); }

    /* ══ BUDGET MODULE ══ */
    .budget-module-tabs { display:flex; gap:8px; margin-bottom:16px; }
    .bm-tab { flex:1; padding:10px 8px; border:none; background:var(--white); border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:800; font-size:0.82em; color:var(--text-light); cursor:pointer; box-shadow:var(--card-shadow); transition:all 0.2s; }
    .bm-tab.active { background:var(--yellow); color:var(--text-dark); }

    /* Overview Hero Card */
    .budget-hero-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; margin-bottom:16px; position:relative; overflow:hidden; }
    .budget-hero-card::before { content:''; position:absolute; top:-30px; right:-30px; width:140px; height:140px; border-radius:50%; background:var(--yellow); opacity:0.12; pointer-events:none; }
    .bh-title { font-size:0.78em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
    .bh-amount { font-size:2.4em; font-weight:900; color:var(--text-dark); line-height:1.1; }
    .bh-sub { font-size:0.85em; font-weight:700; margin-top:2px; }
    .bh-dual-lines { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px; }
    .bh-line-block { background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; }
    .bh-line-label { font-size:0.68em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:4px; }
    .bh-line-val { font-size:1em; font-weight:900; }
    .bh-line-sub { font-size:0.72em; font-weight:700; margin-top:2px; }
    .bh-chart-wrap { height:80px; margin:14px 0 4px; position:relative; }
    .bh-view-toggle { display:inline-flex; background:#F0F0F0; border-radius:20px; padding:3px; margin-bottom:10px; }
    .bh-view-btn { border:none; background:none; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.75em; color:var(--text-light); padding:5px 14px; border-radius:16px; cursor:pointer; transition:all 0.2s; }
    .bh-view-btn.active { background:var(--white); color:var(--text-dark); box-shadow:0 1px 4px rgba(0,0,0,0.12); }
    .bh-year-badge { display:inline-block; background:var(--yellow-light); color:var(--text-dark); font-size:0.68em; font-weight:900; padding:2px 7px; border-radius:10px; margin-left:4px; vertical-align:middle; }

    /* Category Bubbles Group Labels */
    #budget-cats-wrapper { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:14px 16px 10px; margin-bottom:16px; }
    .bcat-group-label { display:flex; align-items:center; margin:0 0 8px 0; }
    .bcat-group-label:not(:first-child) { margin-top:14px; padding-top:14px; border-top:1px solid #F0F0F0; }
    .bcat-group-pill { display:inline-flex; align-items:center; gap:5px; font-size:0.72em; font-weight:900; padding:4px 12px; border-radius:20px; letter-spacing:0.3px; }
    .bcat-group-pill.exp { background:#EF444412; color:#EF4444; border:1px solid #EF444430; }
    .bcat-group-pill.sav { background:#10B98112; color:#10B981; border:1px solid #10B98130; }

    /* Category Bubbles Row */
    .budget-cats-scroll { display:flex; gap:12px; overflow-x:auto; scrollbar-width:none; margin-bottom:2px; padding:2px 0 8px 0; }
    .budget-cats-scroll::-webkit-scrollbar { display:none; }
    .bcat-bubble { flex-shrink:0; display:flex; flex-direction:column; align-items:center; gap:5px; cursor:pointer; transition:transform 0.15s; }
    .bcat-bubble:active { transform:scale(0.93); }
    .bcat-ring { width:72px; height:72px; border-radius:50%; position:relative; display:flex; align-items:center; justify-content:center; }
    .bcat-ring svg { position:absolute; top:0; left:0; width:100%; height:100%; transform:rotate(-90deg); }
    .bcat-icon-wrap { width:56px; height:56px; border-radius:50%; background:var(--white); display:flex; align-items:center; justify-content:center; font-size:1.5em; z-index:1; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
    .bcat-name { font-size:0.67em; font-weight:800; color:var(--text-med); text-align:center; max-width:72px; line-height:1.2; }
    .bcat-status { font-size:0.67em; font-weight:900; text-align:center; }

    /* Goals Table */
    .budget-goals-section { margin-bottom:20px; }
    .bgs-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .bgs-title { font-weight:900; font-size:0.95em; color:var(--text-dark); }
    .bgs-add-btn { background:var(--yellow); border:none; border-radius:10px; padding:7px 14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.82em; cursor:pointer; transition:background 0.15s; }
    .bgs-add-btn:hover { background:#e8b900; }
    .budget-goal-row { background:var(--white); border-radius:var(--radius-sm); box-shadow:var(--card-shadow); padding:14px 16px; margin-bottom:8px; cursor:pointer; transition:transform 0.15s; }
    .budget-goal-row:hover { transform:translateX(3px); }
    .bgr-top { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .bgr-icon { width:38px; height:38px; border-radius:11px; display:flex; align-items:center; justify-content:center; font-size:1.1em; flex-shrink:0; }
    .bgr-info { flex:1; }
    .bgr-name { font-weight:900; font-size:0.9em; color:var(--text-dark); }
    .bgr-type { font-size:0.68em; font-weight:700; color:var(--text-light); margin-top:1px; }
    .bgr-right { text-align:right; }
    .bgr-spent { font-weight:900; font-size:0.95em; }
    .bgr-budget { font-size:0.72em; font-weight:700; color:var(--text-light); margin-top:1px; }
    .bgr-bar { height:4px; background:#F0F0F0; border-radius:4px; overflow:hidden; }
    .bgr-bar-fill { height:100%; border-radius:4px; transition:width 0.6s ease; }
    .bgr-actions { display:flex; gap:6px; margin-top:8px; }
    .bgr-action-btn { flex:1; padding:6px 8px; border:none; border-radius:8px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; transition:all 0.15s; }

    /* Category Detail View */
    .bcat-detail-view { display:none; }
    .bcat-detail-view.open { display:block; }
    .bcd-back-btn { background:var(--white); border:none; border-radius:var(--radius-sm); padding:8px 14px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.82em; cursor:pointer; box-shadow:var(--card-shadow); display:inline-flex; align-items:center; gap:6px; margin-bottom:14px; color:var(--text-dark); }
    .bcd-header { text-align:center; padding:8px 0 16px; }
    .bcd-icon { font-size:2.2em; margin-bottom:6px; }
    .bcd-name { font-size:1.4em; font-weight:900; color:var(--text-dark); }
    .bcd-spent { font-size:1.1em; font-weight:700; margin-top:4px; }
    .bcd-chart-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:16px; margin-bottom:16px; }
    .bcd-chart-title { font-size:0.78em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; }
    .bcd-chart-outer { position:relative; }
    .bcd-chart-wrap { height:180px; position:relative; }
    /* Floating budget chip — sits on the right end of the budget line */
    .bcd-budget-chip { position:absolute; right:0; top:50%; transform:translateY(-80%); display:flex; align-items:center; gap:5px; background:#1E2A6E; color:white; border-radius:20px; padding:5px 10px 5px 12px; cursor:pointer; box-shadow:0 2px 10px rgba(0,0,0,0.25); transition:all 0.18s; z-index:10; user-select:none; }
    .bcd-budget-chip:hover { background:#2D3EA8; box-shadow:0 4px 16px rgba(0,0,0,0.3); }
    .bcd-budget-chip.editing { background:var(--white); padding:3px 3px 3px 10px; box-shadow:0 4px 20px rgba(0,0,0,0.18); border:2px solid var(--yellow); }
    .bcd-chip-label { font-size:0.88em; font-weight:900; letter-spacing:0.3px; white-space:nowrap; }
    .bcd-chip-pencil { font-size:0.7em; opacity:0.75; }
    .bcd-budget-chip.editing .bcd-chip-label { display:none; }
    .bcd-budget-chip.editing .bcd-chip-pencil { display:none; }
    .bcd-chip-input { display:none; width:80px; background:transparent; border:none; outline:none; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.92em; color:var(--text-dark); padding:4px 0; }
    .bcd-budget-chip.editing .bcd-chip-input { display:block; }
    .budget-line-indicator { position:absolute; right:0; top:0; bottom:0; display:flex; align-items:center; pointer-events:none; }
    .bcd-metrics { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px; }
    .bcd-metric-card { background:var(--white); border-radius:var(--radius-sm); box-shadow:var(--card-shadow); padding:14px 12px; text-align:center; }
    .bcd-metric-label { font-size:0.68em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; margin-bottom:4px; }
    .bcd-metric-val { font-size:1.15em; font-weight:900; color:var(--text-dark); }
    .bcd-txns-section { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:16px; }
    .bcd-txns-title { font-weight:900; font-size:0.9em; color:var(--text-dark); margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; }
    .bcd-tx-row { display:flex; align-items:center; gap:10px; padding:9px 0; border-bottom:1px solid #F5F5F5; }
    .bcd-tx-row:last-child { border-bottom:none; }
    .bcd-tx-icon { width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:0.9em; flex-shrink:0; }
    .bcd-tx-info { flex:1; min-width:0; }
    .bcd-tx-name { font-weight:800; font-size:0.85em; color:var(--text-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .bcd-tx-date { font-size:0.7em; color:var(--text-light); font-weight:600; margin-top:1px; }
    .bcd-tx-amt { font-weight:900; font-size:0.9em; color:var(--expenses); flex-shrink:0; }

    /* Edit Budget Popup */
    .edit-budget-popup { position:fixed; inset:0; z-index:500; display:flex; align-items:flex-end; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.25s; }
    .edit-budget-popup.open { opacity:1; pointer-events:all; }
    .edit-budget-popup .popup-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.35); }
    .edit-budget-sheet { background:var(--white); border-radius:24px 24px 0 0; padding:20px 20px 32px; position:relative; z-index:1; width:100%; max-width:480px; transform:translateY(30px); transition:transform 0.3s ease; box-shadow:0 -8px 40px rgba(0,0,0,0.15); }
    .edit-budget-popup.open .edit-budget-sheet { transform:translateY(0); }
    .ebp-handle { width:36px; height:4px; background:#E0E0E0; border-radius:4px; margin:0 auto 16px; }
    .ebp-title { font-size:1.1em; font-weight:900; color:var(--text-dark); margin-bottom:16px; }
    .ebp-field { margin-bottom:12px; }
    .ebp-field label { font-size:0.72em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.4px; display:block; margin-bottom:4px; }
    .ebp-field input, .ebp-field select { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:12px; padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.95em; color:var(--text-dark); outline:none; }
    .ebp-field input:focus, .ebp-field select:focus { border-color:var(--yellow); background:var(--yellow-light); }
    .ebp-emoji-row { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:12px; }
    .ebp-emoji-opt { width:36px; height:36px; border-radius:10px; border:2px solid transparent; background:var(--bg); display:flex; align-items:center; justify-content:center; font-size:1.1em; cursor:pointer; transition:all 0.15s; }
    .ebp-emoji-opt.picked { border-color:var(--yellow); background:var(--yellow-light); }
    .ebp-actions { display:flex; gap:8px; margin-top:6px; }
    .ebp-save-btn { flex:1; background:var(--yellow); border:none; border-radius:12px; padding:14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); }
    .ebp-del-btn { background:#FFF0F0; border:none; border-radius:12px; padding:14px 18px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--expenses); }

    /* ══ NET WORTH MODULE ══ */
    /* ══ NET WORTH — HERO ══ */
    .nw-hero { background:linear-gradient(155deg,#1B1F5E 0%,#2D1B69 50%,#3D1A6E 100%); border-radius:20px; padding:28px 22px 24px; margin-bottom:16px; color:white; position:relative; overflow:hidden; }
    .nw-hero::before { content:''; position:absolute; top:-60px; right:-60px; width:220px; height:220px; border-radius:50%; background:rgba(255,255,255,0.05); pointer-events:none; }
    .nw-hero::after  { content:''; position:absolute; bottom:-70px; left:-40px; width:190px; height:190px; border-radius:50%; background:rgba(100,80,200,0.12); pointer-events:none; }
    .nw-hero-label { font-size:0.72em; font-weight:800; opacity:0.65; text-transform:uppercase; letter-spacing:0.8px; margin-bottom:6px; }
    .nw-hero-amount { font-size:3em; font-weight:900; line-height:1.05; letter-spacing:-1px; }
    .nw-hero-change { font-size:0.82em; font-weight:700; margin-top:6px; opacity:0.9; display:flex; align-items:center; gap:4px; }
    .nw-hero-bars { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-top:18px; }
    .nw-hero-bar-block { background:rgba(255,255,255,0.10); backdrop-filter:blur(4px); border-radius:14px; padding:12px 10px; border:1px solid rgba(255,255,255,0.08); }
    .nw-hero-bar-label { font-size:0.58em; font-weight:800; opacity:0.6; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:4px; }
    .nw-hero-bar-val { font-size:0.92em; font-weight:900; }
    .nw-debt-badge { display:inline-block; font-size:0.62em; font-weight:900; padding:2px 7px; border-radius:10px; margin-top:4px; }
    /* ══ CTA BUTTONS ══ */
    .nw-cta-row { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px; }
    .nw-btn-snapshot { background:var(--yellow); border:none; border-radius:14px; padding:14px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--text-dark); display:flex; align-items:center; justify-content:center; gap:6px; transition:background 0.15s; }
    .nw-btn-snapshot:hover { background:#e8b900; }
    .nw-btn-add { background:transparent; border:2px solid var(--yellow); border-radius:14px; padding:14px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.9em; cursor:pointer; color:var(--text-dark); display:flex; align-items:center; justify-content:center; gap:6px; transition:all 0.15s; }
    .nw-btn-add:hover { background:var(--yellow-light); }
    /* ══ INSIGHTS CARDS ══ */
    .nw-insight-card { background:var(--white); border-radius:14px; box-shadow:var(--card-shadow); padding:14px 16px; margin-bottom:10px; display:flex; align-items:flex-start; gap:12px; border-left:4px solid; }
    .nw-insight-icon-wrap { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:1.2em; flex-shrink:0; }
    .nw-insight-title { font-weight:900; font-size:0.88em; color:var(--text-dark); margin-bottom:3px; }
    .nw-insight-sub   { font-size:0.75em; font-weight:600; color:var(--text-med); line-height:1.4; }
    /* ══ TREND CARD ══ */
    .nw-trend-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:18px; margin-bottom:14px; }
    .nw-trend-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
    .nw-trend-title { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; }
    .nw-trend-badge { font-size:0.72em; font-weight:900; color:var(--text-light); background:#F5F5F5; padding:3px 10px; border-radius:20px; }
    .nw-chart-wrap { height:130px; margin-bottom:16px; }
    .nw-snaps-label { font-size:0.7em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; }
    .nw-snap-row { display:flex; align-items:center; gap:10px; padding:7px 0; border-bottom:1px solid #F8F8F8; }
    .nw-snap-row:last-child { border-bottom:none; }
    .nw-snap-date { font-size:0.75em; font-weight:700; color:var(--text-light); width:76px; flex-shrink:0; }
    .nw-snap-bar-wrap { flex:1; height:8px; background:#F0F0F0; border-radius:6px; overflow:hidden; }
    .nw-snap-bar-fill { height:100%; border-radius:6px; background:linear-gradient(90deg,#3B4A9C,#7C3AED); transition:width 0.6s; }
    .nw-snap-val { font-size:0.82em; font-weight:900; color:var(--text-dark); width:72px; text-align:right; flex-shrink:0; }
    .nw-snap-del { background:none; border:none; font-size:0.85em; color:#CCC; cursor:pointer; padding:0 2px; flex-shrink:0; }
    .nw-snap-del:hover { color:#EF4444; }
    /* ══ ASSET ALLOCATION ══ */
    .nw-alloc-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:18px; margin-bottom:14px; }
    .nw-alloc-title { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:16px; }
    .nw-alloc-body { display:flex; align-items:flex-start; gap:18px; }
    .nw-alloc-donut { width:130px; height:130px; flex-shrink:0; }
    .nw-alloc-legend { flex:1; display:flex; flex-direction:column; gap:5px; max-height:140px; overflow-y:auto; }
    .nw-legend-row { display:flex; align-items:center; gap:8px; }
    .nw-legend-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
    .nw-legend-name { font-size:0.75em; font-weight:700; color:var(--text-med); flex:1; line-height:1.2; }
    .nw-legend-pct  { font-size:0.72em; font-weight:900; color:var(--text-dark); width:28px; text-align:right; flex-shrink:0; }
    .nw-legend-amt  { font-size:0.72em; font-weight:900; color:var(--text-dark); width:54px; text-align:right; flex-shrink:0; }
    /* ══ ACCOUNT SECTIONS ══ */
    .nw-group-header { display:flex; align-items:center; justify-content:space-between; margin:6px 0 10px; }
    .nw-group-label { font-size:0.72em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; display:flex; align-items:center; gap:6px; }
    .nw-group-total { font-size:0.82em; font-weight:900; }
    .nw-section { background:var(--white); border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.06); margin-bottom:10px; overflow:hidden; }
    .nw-section-header { display:flex; align-items:center; justify-content:space-between; padding:16px 16px; cursor:pointer; transition:background 0.1s; }
    .nw-section-header:active { background:#FAFAFA; }
    .nw-section-left { display:flex; align-items:center; gap:14px; }
    .nw-section-icon { width:50px; height:50px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:1.5em; flex-shrink:0; }
    .nw-section-name { font-weight:900; font-size:0.95em; color:var(--text-dark); }
    .nw-section-sub  { font-size:0.7em; font-weight:600; color:var(--text-light); margin-top:2px; }
    .nw-section-right { display:flex; align-items:center; gap:10px; }
    .nw-section-val  { font-weight:900; font-size:1.05em; }
    .nw-section-chevron { font-size:0.7em; color:var(--text-light); transition:transform 0.2s; }
    .nw-section-chevron.open { transform:rotate(180deg); }
    .nw-section-add  { background:var(--yellow); border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.72em; cursor:pointer; color:var(--text-dark); white-space:nowrap; }
    .nw-section-body { padding:0 16px 14px; border-top:1px solid #F5F5F5; display:none; }
    .nw-section-body.open { display:block; }
    .nw-account-row { display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid #F8F8F8; gap:8px; }
    .nw-metal-grp-body { overflow:hidden; transition:max-height 0.25s ease; max-height:2000px; }
    .nw-metal-grp-body.collapsed { max-height:0; }
    .nw-account-row:last-child { border-bottom:none; }
    .nw-account-left { flex:1; min-width:0; }
    .nw-account-name { font-size:0.85em; font-weight:800; color:var(--text-dark); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .nw-account-meta { font-size:0.68em; font-weight:600; color:var(--text-light); margin-top:2px; }
    .nw-account-bar-wrap { height:3px; background:#F0F0F0; border-radius:4px; margin-top:6px; width:100%; max-width:120px; }
    .nw-account-bar-fill { height:100%; border-radius:4px; }
    .nw-account-right { display:flex; align-items:center; gap:6px; flex-shrink:0; }
    .nw-account-val { font-weight:900; font-size:0.9em; text-align:right; }
    .nw-account-updated { font-size:0.62em; font-weight:600; color:var(--text-light); text-align:right; margin-top:1px; }
    .nw-account-actions { display:flex; gap:4px; }
    .nw-account-btn { background:#F5F5F5; border:none; border-radius:7px; padding:5px 7px; font-size:0.72em; cursor:pointer; color:var(--text-med); font-family:'Nunito',sans-serif; font-weight:800; }
    .nw-account-btn.del { background:#FFF0F0; color:var(--expenses); }
    .nw-snapshot-btn { background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:10px 20px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.85em; cursor:pointer; width:100%; margin-bottom:12px; }
    /* Account add/edit bottom sheet */
    .nw-sheet-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1050; opacity:0; pointer-events:none; transition:opacity 0.25s; }
    /* Type picker grid */
    .nws-type-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:18px; }
    .nws-type-tile { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; padding:16px 8px; background:#F8F8F8; border-radius:14px; border:2px solid transparent; cursor:pointer; transition:all 0.15s; min-height:90px; }
    .nws-type-tile:hover { background:var(--yellow-light); }
    .nws-type-tile.selected { background:var(--yellow-light); border-color:var(--yellow); }
    .nws-type-tile-icon { font-size:2em; line-height:1; }
    .nws-type-tile-name { font-size:0.74em; font-weight:900; color:var(--text-dark); text-align:center; line-height:1.2; }
    /* Last 2 tiles in an 11-item grid span to stay even */
    .nws-type-tile:nth-child(10) { grid-column: 1 / 2; }
    .nws-type-tile:nth-child(11) { grid-column: 2 / 3; }
    /* Selected type banner */
    .nws-selected-banner { display:flex; align-items:center; justify-content:space-between; background:#EEF4FF; border-radius:14px; padding:14px 16px; margin-bottom:20px; }
    .nws-selected-left { display:flex; align-items:center; gap:10px; }
    .nws-selected-icon { font-size:1.6em; }
    .nws-selected-name { font-weight:900; font-size:1em; color:var(--text-dark); }
    .nws-type-badge { font-size:0.7em; font-weight:900; padding:3px 10px; border-radius:8px; letter-spacing:0.4px; }
    .nws-type-badge.asset { background:#D1FAE5; color:#059669; }
    .nws-type-badge.liab  { background:#FFE4E4; color:#DC2626; }
    /* Form section label */
    .nws-section-label { font-size:0.68em; font-weight:900; color:var(--text-light); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:6px; }
    .nw-sheet-overlay.open { opacity:1; pointer-events:all; }
    .nw-sheet { position:fixed; bottom:0; left:0; right:0; background:var(--white); border-radius:24px 24px 0 0; z-index:1100; transform:translateY(100%); transition:transform 0.32s cubic-bezier(0.32,0,0.15,1); max-height:90vh; overflow-y:auto; padding:0 20px 80px; }
    .nw-sheet.open { transform:translateY(0); }
    .nw-sheet-handle { width:36px; height:4px; background:#E0E0E0; border-radius:4px; margin:12px auto 18px; }
    .nw-sheet-title { font-size:1.05em; font-weight:900; color:var(--text-dark); margin-bottom:16px; }
    .nw-sheet-field { margin-bottom:14px; }
    .nw-sheet-label { font-size:0.75em; font-weight:800; color:var(--text-med); margin-bottom:5px; text-transform:uppercase; letter-spacing:0.3px; }
    .nw-sheet-input { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; }
    .nw-sheet-input:focus { border-color:var(--yellow); background:var(--white); }
    .nw-sheet-select { width:100%; background:var(--bg); border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:11px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.9em; color:var(--text-dark); outline:none; appearance:none; }
    .nw-sheet-select:focus { border-color:var(--yellow); }
    .nw-sheet-row { display:grid; grid-template-columns:1fr 1fr; gap:10px; }

    /* ── Goal Account Picker — redesigned ── */
    .gap-search { width:100%; border:1.5px solid #E8E8E8; border-radius:var(--radius-sm); padding:10px 14px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.88em; color:var(--text-dark); outline:none; margin-bottom:10px; box-sizing:border-box; background:#FAFAFA; }
    .gap-search:focus { border-color:var(--yellow); background:var(--white); }
    .gap-group { margin-bottom:10px; }
    .gap-group-header { display:flex; align-items:center; justify-content:space-between; padding:7px 10px; background:#F5F5F5; border-radius:10px; cursor:pointer; user-select:none; margin-bottom:4px; }
    .gap-group-title { font-size:0.78em; font-weight:900; color:var(--text-dark); display:flex; align-items:center; gap:6px; }
    .gap-group-meta { font-size:0.72em; font-weight:700; color:var(--text-med); display:flex; align-items:center; gap:8px; }
    .gap-group-total { font-size:0.78em; font-weight:900; color:#10B981; }
    .gap-group-chevron { font-size:0.7em; color:var(--text-light); transition:transform 0.2s; }
    .gap-group-chevron.open { transform:rotate(90deg); }
    .gap-group-body { display:flex; flex-direction:column; gap:3px; padding:0 4px; }
    .gap-group-body.collapsed { display:none; }
    .gap-acc-row { display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:9px; cursor:pointer; transition:background 0.15s; }
    .gap-acc-row:hover { background:#F8F8F8; }
    .gap-acc-row.selected { background:#F0F4FF; }
    .gap-acc-cb { width:18px; height:18px; border-radius:5px; border:2px solid #D0D0D0; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:0.7em; transition:all 0.15s; background:white; }
    .gap-acc-cb.checked { background:var(--primary); border-color:var(--primary); color:white; }
    .gap-acc-name { flex:1; font-size:0.82em; font-weight:700; color:var(--text-dark); line-height:1.3; }
    .gap-acc-sub { font-size:0.68em; color:var(--text-light); font-weight:600; }
    .gap-acc-val { text-align:right; flex-shrink:0; }
    .gap-acc-val-main { font-size:0.82em; font-weight:900; color:#10B981; }
    .gap-acc-val-sub { font-size:0.68em; font-weight:600; color:var(--text-light); }
    .gap-select-all { display:flex; align-items:center; gap:6px; padding:4px 10px; cursor:pointer; font-size:0.72em; font-weight:800; color:var(--primary); }
    .gap-select-all:hover { text-decoration:underline; }
    .gap-preview-bar { background:#F0F4FF; border-radius:12px; padding:12px 14px; margin:10px 0 0; }
    .gap-preview-label { font-size:0.72em; font-weight:800; color:var(--primary); margin-bottom:6px; text-transform:uppercase; letter-spacing:0.3px; }
    .gap-preview-track { height:8px; background:#E0E8FF; border-radius:20px; overflow:hidden; margin-bottom:6px; }
    .gap-preview-fill { height:100%; border-radius:20px; background:var(--primary); transition:width 0.4s; }
    .gap-preview-nums { display:flex; justify-content:space-between; font-size:0.78em; font-weight:800; }
    .gap-empty { text-align:center; padding:20px; color:var(--text-light); font-size:0.82em; font-weight:600; }
    .nw-sheet-meta { font-size:0.75em; font-weight:700; color:var(--text-light); background:var(--bg); border-radius:10px; padding:8px 12px; margin-bottom:12px; line-height:1.5; }
    .nw-sheet-save { width:100%; background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:15px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); margin-top:6px; }
    .nw-asset-name { font-size:0.85em; font-weight:700; color:var(--text-dark); }
    .nw-asset-sub   { font-size:0.7em; font-weight:600; color:var(--text-light); }
    .nw-asset-val   { font-weight:900; font-size:0.9em; color:var(--text-dark); text-align:right; }

    /* ══ IMPORT HUB ══ */
    .import-tabs { display:flex; gap:6px; margin-bottom:16px; overflow-x:auto; scrollbar-width:none; padding:2px; }
    .import-tabs::-webkit-scrollbar { display:none; }
    .import-tab { flex-shrink:0; padding:8px 14px; border:none; background:var(--white); border-radius:var(--radius-sm); font-family:'Nunito',sans-serif; font-weight:800; font-size:0.78em; color:var(--text-light); cursor:pointer; box-shadow:var(--card-shadow); transition:all 0.2s; white-space:nowrap; }
    .import-tab.active { background:var(--yellow); color:var(--text-dark); }
    .import-section { display:none; }
    .import-section.active { display:block; }
    .import-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); padding:20px; margin-bottom:14px; }
    .import-card-title { font-weight:900; font-size:0.95em; color:var(--text-dark); margin-bottom:6px; }
    .import-card-sub { font-size:0.78em; color:var(--text-light); font-weight:600; margin-bottom:16px; line-height:1.5; }
    .import-drop-zone { border:2.5px dashed #E0E0E0; border-radius:var(--radius-sm); padding:28px 20px; text-align:center; cursor:pointer; transition:all 0.2s; margin-bottom:14px; background:var(--bg); }
    .import-drop-zone:hover, .import-drop-zone.dragover { border-color:var(--yellow); background:var(--yellow-light); }
    .import-drop-icon { font-size:2.2em; margin-bottom:8px; }
    .import-drop-text { font-weight:800; font-size:0.9em; color:var(--text-dark); }
    .import-drop-sub  { font-size:0.75em; color:var(--text-light); font-weight:600; margin-top:3px; }
    .import-progress { background:#F0F0F0; border-radius:20px; height:8px; overflow:hidden; margin:10px 0; }
    .import-progress-fill { height:100%; background:var(--yellow); border-radius:20px; transition:width 0.4s ease; }
    .import-step { display:none; }
    .import-step.active { display:block; }
    .import-col-map { display:flex; flex-direction:column; gap:8px; margin-bottom:14px; }
    .import-col-row { display:flex; align-items:center; gap:10px; background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; }
    .import-col-field { font-size:0.8em; font-weight:800; color:var(--text-dark); min-width:100px; flex-shrink:0; }
    .import-col-select { flex:1; background:var(--white); border:1.5px solid #E8E8E8; border-radius:8px; padding:7px 10px; font-family:'Nunito',sans-serif; font-weight:700; font-size:0.82em; color:var(--text-dark); outline:none; }
    .import-col-select:focus { border-color:var(--yellow); }
    .import-preview-table { width:100%; border-collapse:collapse; font-size:0.75em; margin-bottom:14px; }
    .import-preview-table th { background:var(--yellow-light); font-weight:800; padding:6px 8px; text-align:left; border-bottom:2px solid var(--yellow); }
    .import-preview-table td { padding:5px 8px; border-bottom:1px solid #F0F0F0; color:var(--text-dark); font-weight:600; }
    .import-preview-table tr:nth-child(even) td { background:#FAFAFA; }
    .import-btn { width:100%; background:var(--yellow); border:none; border-radius:var(--radius-sm); padding:14px; font-family:'Nunito',sans-serif; font-weight:900; font-size:0.95em; cursor:pointer; color:var(--text-dark); margin-top:8px; transition:background 0.15s; }
    .import-btn:hover { background:#e8b900; }
    .import-btn.secondary { background:var(--bg); color:var(--text-med); }
    .import-btn.danger    { background:#FFF0F0; color:var(--expenses); }
    .cat-review-item { display:flex; align-items:center; gap:10px; background:var(--bg); border-radius:var(--radius-sm); padding:10px 12px; margin-bottom:8px; flex-wrap:wrap; }
    .cat-review-flag { font-size:0.7em; font-weight:800; padding:3px 8px; border-radius:10px; flex-shrink:0; }
    .cat-review-flag.dup  { background:#FFF0E0; color:#D97706; }
    .cat-review-flag.new  { background:#F0FBF3; color:#10B981; }
    .cat-review-names { flex:1; font-weight:800; font-size:0.85em; color:var(--text-dark); }
    .cat-review-action { display:flex; gap:6px; }
    .cat-merge-btn { background:var(--yellow-light); border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; }
    .cat-keep-btn  { background:#F5F5F5; border:none; border-radius:8px; padding:5px 10px; font-family:'Nunito',sans-serif; font-weight:800; font-size:0.72em; cursor:pointer; }
    .import-summary-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:14px; }
    .import-summary-box { background:var(--bg); border-radius:var(--radius-sm); padding:12px 10px; text-align:center; }
    .import-summary-box .isb-num { font-size:1.4em; font-weight:900; color:var(--text-dark); }
    .import-summary-box .isb-label { font-size:0.65em; font-weight:800; color:var(--text-light); margin-top:2px; text-transform:uppercase; }
    .given-ledger-row { display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid #F5F5F5; }
    .given-ledger-row:last-child { border-bottom:none; }
    .given-person { font-weight:900; font-size:0.9em; color:var(--text-dark); }
    .given-total  { font-weight:900; font-size:0.95em; color:var(--expenses); }

    /* ══ HOME INSIGHTS CARD ══ */
    .insights-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--card-shadow); margin-bottom:16px; overflow:hidden; }
    .insights-header { display:flex; align-items:center; justify-content:space-between; padding:14px 16px 14px; cursor:pointer; user-select:none; }
    .insights-header-left { display:flex; align-items:center; gap:8px; }
    .insights-title { font-weight:900; font-size:0.92em; color:var(--text-dark); }
    .insights-toggle { font-size:0.82em; color:var(--text-light); font-weight:700; transition:transform 0.25s; display:inline-block; }
    .insights-toggle.open { transform:rotate(180deg); }
    .insights-body { padding:0 16px 16px; display:none; }
    .insights-body.open { display:block; }
    /* KPI row at top — always visible */
    .insights-kpi-row { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:12px; }
    .insights-kpi { background:var(--bg); border-radius:var(--radius-sm); padding:11px 10px; text-align:center; }
    .ikpi-val  { font-size:1.1em; font-weight:900; color:var(--text-dark); line-height:1.1; }
    .ikpi-label{ font-size:0.62em; font-weight:800; color:var(--text-light); text-transform:uppercase; letter-spacing:0.3px; margin-top:3px; }
    /* Insight chips — the interesting findings */
    .insights-chips { display:flex; flex-direction:column; gap:8px; }
    .insight-chip { display:flex; align-items:flex-start; gap:10px; padding:10px 12px; border-radius:var(--radius-sm); border-left:3px solid transparent; }
    .insight-chip.good    { background:#F0FBF3; border-color:#10B981; }
    .insight-chip.warn    { background:#FFFBEE; border-color:#F59E0B; }
    .insight-chip.alert   { background:#FFF5F5; border-color:#EF4444; }
    .insight-chip.neutral { background:var(--bg); border-color:var(--text-light); }
    .insight-chip-icon { font-size:1.1em; flex-shrink:0; margin-top:1px; }
    .insight-chip-text { flex:1; }
    .insight-chip-title { font-size:0.82em; font-weight:900; color:var(--text-dark); }
    .insight-chip-sub   { font-size:0.72em; font-weight:600; color:var(--text-med); margin-top:2px; line-height:1.4; }

    /* ══ PIN LOCK SCREEN (COMMENTED OUT - RE-ENABLE SECTION START) ══
    === To re-enable PIN functionality:
    === 1. Uncomment the CSS block below (remove the slash-star markers)
    === 2. Uncomment the #lock-screen HTML block in the body
    === 3. Uncomment the PIN JavaScript section at the bottom
    === 4. Call initLockScreen() in the init section

    #lock-screen {
      position: fixed; inset: 0; z-index: 9999;
      background: linear-gradient(160deg, #0f1229 0%, #1a1035 40%, #0d1f18 100%);
      display: flex; flex-direction: column; align-items: center;
      overflow: hidden;
      transition: opacity 0.45s cubic-bezier(.4,0,.2,1), transform 0.45s cubic-bezier(.4,0,.2,1);
    }
    ... (rest of lock screen CSS here when re-enabling)
    === RE-ENABLE SECTION END === */
    /* ══ ONBOARDING OVERLAY ══ */
    #onboarding-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: #1A1F3C;
      display: flex; flex-direction: column;
      font-family: 'Nunito', sans-serif;
      overflow: hidden;
    }
    #onboarding-overlay.hiding {
      animation: onboardFadeOut 0.6s ease forwards;
    }
    @keyframes onboardFadeOut {
      to { opacity: 0; transform: scale(1.04); }
    }
    .ob-slides-wrap {
      flex: 1; display: flex; overflow: hidden; position: relative;
    }
    .ob-slides-track {
      display: flex; height: 100%;
      transition: transform 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: transform;
    }
    .ob-slide {
      min-width: 100vw; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 32px 28px 12px;
      text-align: center;
      position: relative;
    }
    .ob-slide-art {
      font-size: 5.5em;
      margin-bottom: 18px;
      animation: obArtBounce 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
      filter: drop-shadow(0 8px 24px rgba(0,0,0,0.35));
    }
    @keyframes obArtBounce {
      from { transform: scale(0.4) translateY(30px); opacity: 0; }
      to   { transform: scale(1) translateY(0);      opacity: 1; }
    }
    .ob-slide-tag {
      font-size: 0.68em; font-weight: 900; letter-spacing: 2px;
      text-transform: uppercase; margin-bottom: 10px;
      padding: 4px 14px; border-radius: 20px;
      background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.6);
    }
    .ob-slide-title {
      font-size: 1.75em; font-weight: 900; line-height: 1.15;
      color: #FFFFFF; margin-bottom: 12px;
      animation: obTextSlide 0.5s 0.15s ease both;
    }
    .ob-slide-desc {
      font-size: 0.9em; font-weight: 600; line-height: 1.6;
      color: rgba(255,255,255,0.65); max-width: 300px;
      animation: obTextSlide 0.5s 0.25s ease both;
    }
    @keyframes obTextSlide {
      from { transform: translateY(18px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }
    .ob-highlight {
      color: #F5C842; font-weight: 900;
    }
    /* Slide-specific accent circles */
    .ob-bg-circle {
      position: absolute; border-radius: 50%; opacity: 0.07;
      pointer-events: none;
    }
    /* Bottom bar */
    .ob-bottom {
      padding: 16px 28px 36px;
      display: flex; flex-direction: column; align-items: center; gap: 14px;
    }
    .ob-dots {
      display: flex; gap: 7px; align-items: center;
    }
    .ob-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: rgba(255,255,255,0.25);
      transition: all 0.3s ease; cursor: pointer;
    }
    .ob-dot.active {
      background: #F5C842; width: 22px; border-radius: 4px;
    }
    .ob-btn-row {
      display: flex; gap: 10px; width: 100%;
    }
    .ob-skip-btn {
      flex: 0; padding: 14px 20px;
      background: rgba(255,255,255,0.1);
      border: none; border-radius: 14px;
      color: rgba(255,255,255,0.5); font-family: 'Nunito', sans-serif;
      font-weight: 800; font-size: 0.88em; cursor: pointer;
      transition: background 0.2s;
    }
    .ob-skip-btn:hover { background: rgba(255,255,255,0.18); }
    .ob-next-btn {
      flex: 1; padding: 14px;
      background: #F5C842;
      border: none; border-radius: 14px;
      color: #1A1F3C; font-family: 'Nunito', sans-serif;
      font-weight: 900; font-size: 1em; cursor: pointer;
      box-shadow: 0 4px 20px rgba(245,200,66,0.45);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    /* ══ COACH MARKS ══ */
    #coach-overlay {
      position: fixed; inset: 0; z-index: 9998; pointer-events: none; display: none;
    }
    #coach-overlay.active {
      pointer-events: all;
    }
    #coach-svg {
      position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none;
    }
    #coach-tooltip {
      position: fixed; z-index: 9999;
      background: #1A1F3C; color: white;
      border-radius: 16px; padding: 14px 16px;
      max-width: 268px; min-width: 210px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      pointer-events: all;
    }
    .coach-tooltip-anim { animation: coachPop 0.3s cubic-bezier(0.34,1.56,0.64,1) both; }
    @keyframes coachPop {
      from { transform: scale(0.82); opacity: 0; }
      to   { transform: scale(1);    opacity: 1; }
    }
    .coach-arrow {
      position: absolute; width: 0; height: 0;
    }
    .coach-arrow.down {
      border-left: 9px solid transparent; border-right: 9px solid transparent;
      border-top: 10px solid #1A1F3C;
      bottom: -10px; left: 50%; transform: translateX(-50%);
    }
    .coach-arrow.up {
      border-left: 9px solid transparent; border-right: 9px solid transparent;
      border-bottom: 10px solid #1A1F3C;
      top: -10px; left: 50%; transform: translateX(-50%);
    }
    .coach-arrow.right {
      border-top: 9px solid transparent; border-bottom: 9px solid transparent;
      border-left: 10px solid #1A1F3C;
      right: -10px; top: 50%; transform: translateY(-50%);
    }
    .coach-step-tag {
      font-size: 0.62em; font-weight: 900; letter-spacing: 1.5px;
      text-transform: uppercase; color: #F5C842; margin-bottom: 5px;
    }
    .coach-title {
      font-weight: 900; font-size: 0.95em; color: #fff; margin-bottom: 5px; line-height: 1.3;
    }
    .coach-desc {
      font-size: 0.78em; font-weight: 600; color: rgba(255,255,255,0.68); line-height: 1.55;
    }
    .coach-btn-row { display: flex; gap: 7px; margin-top: 11px; align-items: center; }
    .coach-prev-btn {
      padding: 7px 12px; background: rgba(255,255,255,0.1);
      border: none; border-radius: 9px; color: rgba(255,255,255,0.6);
      font-family: 'Nunito',sans-serif; font-weight: 800; font-size: 0.78em; cursor: pointer;
    }
    .coach-next-btn {
      flex: 1; padding: 8px 12px; background: #F5C842;
      border: none; border-radius: 9px; color: #1A1F3C;
      font-family: 'Nunito',sans-serif; font-weight: 900; font-size: 0.85em; cursor: pointer;
    }
    .coach-skip-btn {
      padding: 7px 8px; background: transparent; border: none;
      color: rgba(255,255,255,0.3); font-family: 'Nunito',sans-serif;
      font-weight: 800; font-size: 0.7em; cursor: pointer;
    }
    .coach-progress {
      font-size: 0.63em; font-weight: 800; color: rgba(255,255,255,0.25);
      text-align: right; margin-top: 5px;
    }
    #coach-pulse {
      position: fixed; border-radius: 12px;
      border: 2.5px solid #F5C842; pointer-events: none; z-index: 9999;
      animation: coachPulse 1.5s ease-in-out infinite;
    }
    @keyframes coachPulse {
      0%,100% { box-shadow: 0 0 0 0 rgba(245,200,66,0.6); }
      50%      { box-shadow: 0 0 0 10px rgba(245,200,66,0); }
    }
  </style>
</head>
<body>

<!-- ══ COACH MARK OVERLAY ══ -->
<div id="coach-overlay">
  <svg id="coach-svg" xmlns="http://www.w3.org/2000/svg"></svg>
  <div id="coach-pulse" style="display:none;"></div>
  <div id="coach-tooltip" style="display:none;"></div>
</div>
<div id="onboarding-overlay" style="display:none;">
  <div class="ob-slides-wrap" id="ob-slides-wrap">
    <div class="ob-slides-track" id="ob-track">

      <!-- Slide 1: Welcome -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:300px;height:300px;background:#F5C842;top:-80px;right:-80px;"></div>
        <div class="ob-bg-circle" style="width:200px;height:200px;background:#3B4A9C;bottom:-40px;left:-60px;"></div>
        <div class="ob-slide-art">💰</div>
        <div class="ob-slide-tag">Welcome</div>
        <div class="ob-slide-title">Meet <span class="ob-highlight">MoneyFi</span></div>
        <div class="ob-slide-desc">Your personal finance companion — built for clarity, designed for real life. Track every dollar, across every country.</div>
      </div>

      <!-- Slide 2: Tracking -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:250px;height:250px;background:#10B981;top:-60px;left:-60px;"></div>
        <div class="ob-bg-circle" style="width:180px;height:180px;background:#F5C842;bottom:-30px;right:-50px;"></div>
        <div class="ob-slide-art">📊</div>
        <div class="ob-slide-tag">Track</div>
        <div class="ob-slide-title">Income, Spending <span class="ob-highlight">&amp; Beyond</span></div>
        <div class="ob-slide-desc">Log income, expenses, investments and debts. View by day, week, month or year. Spot trends instantly.</div>
      </div>

      <!-- Slide 3: Net Worth -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:280px;height:280px;background:#7C3AED;top:-70px;right:-70px;"></div>
        <div class="ob-bg-circle" style="width:160px;height:160px;background:#EF4444;bottom:-20px;left:-40px;"></div>
        <div class="ob-slide-art">💎</div>
        <div class="ob-slide-tag">Net Worth</div>
        <div class="ob-slide-title">Your <span class="ob-highlight">Full Picture</span></div>
        <div class="ob-slide-desc">Assets, liabilities, real estate, gold &amp; silver — all in one place. Multi-currency with live FX rates you control.</div>
      </div>

      <!-- Slide 4: Goals -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:260px;height:260px;background:#F97316;top:-50px;left:-70px;"></div>
        <div class="ob-bg-circle" style="width:200px;height:200px;background:#3B4A9C;bottom:-50px;right:-50px;"></div>
        <div class="ob-slide-art">🎯</div>
        <div class="ob-slide-tag">Goals</div>
        <div class="ob-slide-title">Dream It. <span class="ob-highlight">Track It.</span></div>
        <div class="ob-slide-desc">Set goals to grow savings, buy property, or pay off a loan. Watch your progress bar fill up in real time.</div>
      </div>

      <!-- Slide 5: Get Started -->
      <div class="ob-slide">
        <div class="ob-bg-circle" style="width:320px;height:320px;background:#F5C842;top:-100px;right:-100px;opacity:0.1;"></div>
        <div class="ob-bg-circle" style="width:220px;height:220px;background:#10B981;bottom:-60px;left:-60px;opacity:0.1;"></div>
        <div class="ob-slide-art">🚀</div>
        <div class="ob-slide-tag">You're all set</div>
        <div class="ob-slide-title">Let's <span class="ob-highlight">Get Started</span></div>
        <div class="ob-slide-desc">Your financial story starts now. Tap below and add your first account — it takes less than a minute.</div>
      </div>

    </div>
  </div>

  <!-- Bottom controls -->
  <div class="ob-bottom">
    <div class="ob-dots" id="ob-dots">
      <div class="ob-dot active" onclick="obGoTo(0)"></div>
      <div class="ob-dot" onclick="obGoTo(1)"></div>
      <div class="ob-dot" onclick="obGoTo(2)"></div>
      <div class="ob-dot" onclick="obGoTo(3)"></div>
      <div class="ob-dot" onclick="obGoTo(4)"></div>
    </div>
    <div class="ob-btn-row">
      <button class="ob-skip-btn" id="ob-skip-btn" onclick="dismissOnboarding()">Skip</button>
      <button class="ob-next-btn" id="ob-next-btn" onclick="obNext()">Next →</button>
    </div>
  </div>
</div>

<!-- ══ THEME DECORATION ELEMENTS (always present, visible only when theme active) ══ -->
<!-- Looney -->
<div class="looney-char" style="bottom:160px;right:15px;animation-delay:0s;">🐰</div>
<div class="looney-char" style="bottom:320px;left:10px;animation-delay:1.2s;font-size:2em;">🦆</div>
<div class="looney-char" style="top:120px;right:8px;animation-delay:0.6s;font-size:1.8em;">🐦</div>
<div class="looney-char" style="top:300px;left:5px;animation-delay:1.8s;font-size:2.2em;">🐱</div>
<!-- Jungle -->
<div class="jungle-leaf" style="top:80px;right:5px;animation-delay:0s;">🍃</div>
<div class="jungle-leaf" style="bottom:200px;left:8px;animation-delay:1s;font-size:2.5em;">🌿</div>
<div class="jungle-leaf" style="top:280px;right:12px;animation-delay:2s;font-size:1.8em;">🐒</div>
<div class="jungle-leaf" style="bottom:350px;left:5px;animation-delay:0.5s;font-size:2.2em;">🦜</div>
<div class="jungle-leaf" style="top:180px;left:3px;animation-delay:1.5s;">🌺</div>
<!-- Space -->
<div class="space-star" style="top:100px;right:20px;animation-delay:0s;">⭐</div>
<div class="space-star" style="top:200px;left:15px;animation-delay:0.8s;">🌙</div>
<div class="space-star" style="bottom:250px;right:25px;animation-delay:0.4s;">✨</div>
<div class="space-star" style="top:350px;right:10px;animation-delay:1.2s;font-size:1.5em;">🚀</div>
<div class="space-star" style="bottom:300px;left:12px;animation-delay:1.6s;">💫</div>
<!-- Ocean -->
<div class="ocean-wave" style="bottom:160px;right:8px;animation-delay:0s;">🐠</div>
<div class="ocean-wave" style="top:200px;left:6px;animation-delay:1s;font-size:1.5em;">🌊</div>
<div class="ocean-wave" style="bottom:340px;right:12px;animation-delay:2s;font-size:1.8em;">🐚</div>
<div class="ocean-wave" style="top:320px;left:8px;animation-delay:0.5s;">🐟</div>

<!-- ══ LOCK SCREEN — COMMENTED OUT (RE-ENABLE LATER) ══
=== To re-enable: uncomment this entire block and the JS PIN section below ===
<div id="lock-screen" style="display:none;">
  ... lock screen HTML ...
</div>
=== END COMMENTED PIN LOCK SCREEN === -->

<!-- Decorative -->
<div class="deco-circle deco-yellow" style="width:160px;height:160px;top:-60px;right:-50px;opacity:0.7;"></div>
<div class="deco-circle deco-blue" style="width:120px;height:120px;bottom:120px;left:-40px;opacity:0.8;"></div>
<div class="deco-circle deco-yellow" style="width:80px;height:80px;bottom:200px;right:20px;opacity:0.5;"></div>

<!-- TOP BAR — Clean layout with icons inside topbar -->
<div class="topbar">
  <div class="topbar-title">💰 MoneyFlow</div>
  <div style="display:flex;align-items:center;gap:8px;">
    <div class="topbar-badge" id="topbar-month" style="cursor:default;">Feb 2026</div>
    <div class="topbar-icons">
      <button class="topbar-icon-btn" onclick="goToScreen('metals')" title="Metals">🥇</button>
      <button class="topbar-icon-btn" onclick="goToScreen('networth')" title="Net Worth">💎</button>
      <button class="topbar-icon-btn" onclick="goToScreen('settings')" title="Settings">⚙️</button>
    </div>
  </div>
</div>

<!-- ══════════════ HOME ══════════════ -->
<div class="screen active" id="screen-home">
  <!-- Time Period Selector -->
  <div class="time-period-bar" id="time-period-bar">
    <button class="period-tab" onclick="setPeriod('day',this)">Day</button>
    <button class="period-tab active" onclick="setPeriod('month',this)">Month</button>
    <button class="period-tab" onclick="setPeriod('week',this)">Week</button>
    <button class="period-tab" onclick="setPeriod('year',this)">Year</button>
  </div>
  <!-- Day chips (shown in day/week mode) -->
  <div class="period-detail" id="period-detail"></div>
  <!-- Period navigation -->
  <div class="period-nav">
    <button onclick="changePeriod(-1)">‹</button>
    <div class="period-label" id="home-month-label">February 2026</div>
    <button onclick="changePeriod(1)">›</button>
  </div>

  <!-- Spending / Investment Tab Toggle -->
  <div class="home-tab-bar">
    <button class="home-tab-btn active" id="htab-spending" onclick="setHomeTab('spending')">💸 Spending</button>
    <button class="home-tab-btn" id="htab-invest" onclick="setHomeTab('invest')">📈 Investing</button>
  </div>

  <!-- ── SPENDING SECTION ── -->
  <div class="home-section active" id="hsec-spending">
    <div class="spending-hero">
      <div class="spending-label">💸 Total Spending</div>
      <div class="spending-amount" id="home-spending">$0</div>
    </div>
    <div class="budget-grid" id="budget-grid"></div>

    <!-- Insights Card -->
    <div class="insights-card" id="home-insights-card">
      <div class="insights-header" onclick="toggleInsights()">
        <div class="insights-header-left">
          <span style="font-size:1.2em;">💡</span>
          <span class="insights-title">Monthly Insights</span>
        </div>
        <span class="insights-toggle" id="insights-toggle-arrow">▾</span>
      </div>
      <!-- KPI strip — always visible inside the header area -->
      <div style="padding:0 16px 14px;" id="insights-kpi-strip"></div>
      <!-- Expandable body -->
      <div class="insights-body" id="insights-body">
        <div class="insights-chips" id="insights-chips"></div>
      </div>
    </div>

    <div class="home-income-section">
      <div class="home-income-header">
        <div class="home-income-title">💵 Income</div>
        <div class="home-income-total" id="home-income">$0</div>
      </div>
      <div class="income-sub-grid">
        <div class="income-sub-card" onclick="openQuickAdd('income','Salary')">
          <div class="isc-icon">💼</div><div class="isc-name">Salary</div>
          <div class="isc-amount" id="home-salary">$0</div>
        </div>
        <div class="income-sub-card" onclick="openQuickAdd('income','Gift')">
          <div class="isc-icon">🎁</div><div class="isc-name">Gifts</div>
          <div class="isc-amount" id="home-gifts">$0</div>
        </div>
        <div class="income-sub-card" onclick="openQuickAdd('income','Other')">
          <div class="isc-icon">💰</div><div class="isc-name">Others</div>
          <div class="isc-amount" id="home-other-income">$0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ── INVESTMENT SECTION ── -->
  <div class="home-section" id="hsec-invest">
    <div class="invest-home-hero">
      <div class="invest-home-hero-label">📈 Total Portfolio Value</div>
      <div class="invest-home-hero-amt" id="home-invest-total">$0</div>
    </div>
    <div class="invest-cat-grid" id="invest-cat-grid"></div>
  </div>
</div>

<!-- ══════════════ TRANSACTIONS / CALENDAR ══════════════ -->
<div class="screen" id="screen-tx">
  <!-- Month Navigation -->
  <div class="cal-header">
    <button class="cal-nav-btn" onclick="calChangeMonth(-1)">&#8249;</button>
    <div class="cal-month-title" id="cal-month-title"></div>
    <button class="cal-nav-btn" onclick="calChangeMonth(1)">&#8250;</button>
  </div>
  <div style="display:flex;justify-content:flex-end;gap:6px;margin-bottom:8px;">
    <button id="cal-view-btn-calendar" onclick="setCalView('calendar')" style="background:#1E2A6E;color:white;border:none;border-radius:8px;padding:5px 12px;font-size:0.78em;font-weight:800;cursor:pointer;">📅 Calendar</button>
    <button id="cal-view-btn-list" onclick="setCalView('list')" style="background:#F0F0F0;color:var(--text-med);border:none;border-radius:8px;padding:5px 12px;font-size:0.78em;font-weight:800;cursor:pointer;">📋 List</button>
  </div>
  <!-- Monthly Summary -->
  <div class="cal-summary">
    <div class="cal-sum-item income">
      <div class="cal-sum-label">Income</div>
      <div class="cal-sum-val" id="cal-total-income">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item expense">
      <div class="cal-sum-label">Expenses</div>
      <div class="cal-sum-val" id="cal-total-expense">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item savings">
      <div class="cal-sum-label">INVESTING</div>
      <div class="cal-sum-val" id="cal-total-savings">$0</div>
    </div>
    <div class="cal-sum-divider"></div>
    <div class="cal-sum-item net">
      <div class="cal-sum-label">Net</div>
      <div class="cal-sum-val" id="cal-total-net">$0</div>
    </div>
  </div>
  <!-- Calendar Grid -->
  <div class="cal-grid-wrap">
    <div class="cal-dow-row">
      <div class="cal-dow">SUN</div><div class="cal-dow">MON</div><div class="cal-dow">TUE</div>
      <div class="cal-dow">WED</div><div class="cal-dow">THU</div><div class="cal-dow">FRI</div><div class="cal-dow">SAT</div>
    </div>
    <div class="cal-grid" id="cal-grid"></div>
  <!-- Month list view -->
  <div id="cal-list-view" style="display:none;"></div>
  </div>
  <!-- Day Detail -->
  <div id="cal-day-detail"></div>
</div>

<!-- ══════════════ ADD ══════════════ -->
<div class="screen" id="screen-add">
  <div class="add-type-toggle">
    <button class="add-type-btn active" onclick="setAddType('expense',this)">Expense</button>
    <button class="add-type-btn" onclick="setAddType('income',this)">Income</button>
    <button class="add-type-btn" onclick="setAddType('investment',this)">Investment</button>
    <button class="add-type-btn" onclick="setAddType('debt',this)">Debt</button>
    <button class="add-type-btn" onclick="setAddType('given',this)">Given</button>
    <button class="add-type-btn" onclick="setAddType('additional',this)">Additional</button>
  </div>
  <div class="amount-display">
    <div class="amount-num"><span class="amount-cur">$</span><span id="add-amount-display">0</span></div>
  </div>
  <div class="sub-cats" id="sub-cats-row"></div>
  <div class="add-form">
    <div class="form-row">
      <span class="form-icon">📝</span><span class="form-label">Note</span>
      <input type="text" class="form-input" id="add-note" placeholder="Add note...">
    </div>
    <div class="form-row">
      <span class="form-icon">📅</span><span class="form-label">Date</span>
      <input type="date" class="form-input" id="add-date" style="text-align:right;">
    </div>
    <div class="form-row">
      <span class="form-icon">💳</span><span class="form-label">Account</span>
      <select class="form-select" id="add-account"><option>Cash</option><option>Paypal</option><option>Bank</option></select>
    </div>
  </div>
  <div class="numpad">
    <div class="numpad-grid" id="numpad-grid"></div>
  </div>
</div>

<!-- ══════════════ DATA ══════════════ -->
<div class="screen" id="screen-data">
  <div class="data-controls">
    <div class="data-controls-row">
      <span class="data-label">📅 Month:</span>
      <select id="data-month-select" onchange="renderDataScreen()" style="flex:1;background:#F8F8F8;border:1.5px solid #EEE;border-radius:10px;padding:8px 12px;font-family:Nunito,sans-serif;font-weight:700;font-size:0.88em;color:var(--text-dark);outline:none;"></select>
    </div>
    <div class="data-controls-row">
      <span class="data-label">🗓 Range:</span>
      <input type="date" id="data-filter-start" onchange="renderDataScreen()" class="date-filter-input" style="flex:1;">
      <span class="data-label">to</span>
      <input type="date" id="data-filter-end" onchange="renderDataScreen()" class="date-filter-input" style="flex:1;">
      <button class="icon-btn" onclick="clearDataFilter()">Clear</button>
    </div>
    <div class="data-controls-row">
      <button class="icon-btn danger" onclick="deleteCurrentDataMonth()">🗑️ Month</button>
    </div>
  </div>
  <div id="data-sections"></div>
</div>

<!-- ══════════════ STATS ══════════════ -->
<div class="screen" id="screen-stats">
  <div class="chart-card">
    <div class="chart-title">Spending Trend (6 months)</div>
    <div class="chart-container"><canvas id="trendChart"></canvas></div>
    <div style="display:flex;gap:20px;margin-top:12px;justify-content:center;">
      <div style="display:flex;align-items:center;gap:6px;font-size:0.82em;font-weight:700;color:var(--expenses);"><div style="width:24px;height:3px;background:var(--expenses);border-radius:2px;"></div>Spending <span id="stat-spending-total">$0</span></div>
      <div style="display:flex;align-items:center;gap:6px;font-size:0.82em;font-weight:700;color:var(--income);"><div style="width:24px;height:3px;background:var(--income);border-radius:2px;"></div>Income <span id="stat-income-total">$0</span></div>
    </div>
  </div>
  <div class="spending-tops">
    <div class="chart-title">Top 5 Spending Categories</div>
    <div style="display:flex;gap:20px;align-items:center;">
      <div style="position:relative;width:120px;height:120px;flex-shrink:0;"><canvas id="donutChart"></canvas></div>
      <div id="top5-list" style="flex:1;"></div>
    </div>
  </div>
  <div class="chart-card">
    <div class="chart-title">Budget vs Spent</div>
    <div id="budget-bars"></div>
  </div>
  <div class="chart-card">
    <div class="chart-title">Account Breakdown</div>
    <div style="display:flex;gap:20px;align-items:center;">
      <canvas id="accountChart" width="120" height="120" style="width:120px;height:120px;flex-shrink:0;"></canvas>
      <div id="account-breakdown" style="flex:1;"></div>
    </div>
  </div>
</div>

<!-- ══════════════ ACCOUNT ══════════════ -->
<div class="screen" id="screen-account">
  <div class="networth-card">
    <div class="nw-label">Net Worth</div>
    <div class="nw-amount" id="nw-amount">$0</div>
    <div class="nw-sub">
      <div class="nw-sub-item">Assets<span id="nw-assets">$0</span></div>
      <div class="nw-sub-item">Liabilities<span id="nw-liabilities" class="negative">$0</span></div>
    </div>
  </div>
  <div class="account-section-title">Assets</div>
  <div class="account-grid" id="account-assets-grid"></div>
  <div class="account-section-title">Liabilities</div>
  <div class="account-grid" id="account-debts-grid"></div>
  <button onclick="showAddAccountModal()" style="width:100%;background:var(--yellow);border:none;border-radius:var(--radius-sm);padding:16px;font-family:Nunito,sans-serif;font-weight:900;font-size:0.95em;color:var(--text-dark);cursor:pointer;box-shadow:0 4px 15px rgba(245,200,66,0.4);margin-top:8px;">+ Add Account</button>
</div>

<!-- ══════════════ METALS ══════════════ -->
<div class="screen" id="screen-metals">
  <div class="metals-portfolio-bar">
    <div class="metals-portfolio-title">Total Precious Metals Value</div>
    <div class="metals-portfolio-total" id="metals-grand-total">$0</div>
    <div class="metals-mini-cards">
      <div class="metals-mini-card gold-card active-metal" id="mini-gold" onclick="switchMetal('gold')">
        <div class="metals-mini-icon">🥇</div><div class="metals-mini-name">Gold</div>
        <div class="metals-mini-grams" id="mini-gold-grams">0 g</div><div class="metals-mini-usd" id="mini-gold-usd">$0</div>
      </div>
      <div class="metals-mini-card silver-card" id="mini-silver" onclick="switchMetal('silver')">
        <div class="metals-mini-icon">🥈</div><div class="metals-mini-name">Silver</div>
        <div class="metals-mini-grams" id="mini-silver-grams">0 g</div><div class="metals-mini-usd" id="mini-silver-usd">$0</div>
      </div>
      <div class="metals-mini-card platinum-card" id="mini-platinum" onclick="switchMetal('platinum')">
        <div class="metals-mini-icon">🔷</div><div class="metals-mini-name">Platinum</div>
        <div class="metals-mini-grams" id="mini-platinum-grams">0 g</div><div class="metals-mini-usd" id="mini-platinum-usd">$0</div>
      </div>
    </div>
  </div>
  <div class="metal-detail-header">
    <div class="metal-detail-icon-wrap gold" id="metal-detail-icon">🥇</div>
    <div class="metal-detail-info">
      <div class="metal-detail-name" id="metal-detail-name">Gold</div>
      <div class="metal-detail-grams" id="metal-detail-grams">0 g · 0.000 oz</div>
      <div class="metal-detail-usd gold" id="metal-detail-usd">$0</div>
    </div>
    <div style="background:#F8F8F8;border-radius:8px;padding:6px 10px;font-size:0.72em;font-weight:800;color:var(--text-med);text-align:center;flex-shrink:0;">
      <div style="font-size:0.72em;color:var(--text-light);" id="metal-price-base-label">$/gram (24K pure)</div>
      <div style="display:flex;align-items:center;gap:6px;">
        <span style="font-size:1.3em;font-weight:900;color:var(--text-dark);" id="metal-live-price">$96.50</span>
        <button onclick="showMetalPriceEdit()" style="background:#F0F4FF;border:none;border-radius:7px;padding:3px 8px;font-size:0.72em;font-weight:800;color:var(--primary);cursor:pointer;">✏️ Edit</button>
      </div>
      <div id="metal-price-override-panel" style="display:none;margin-top:8px;background:white;border:1.5px solid #DDD;border-radius:10px;padding:10px 12px;text-align:left;">
        <div style="font-size:0.78em;font-weight:800;color:var(--text-dark);margin-bottom:6px;" id="metal-price-override-label">Set base $/gram:</div>
        <div style="display:flex;gap:8px;margin-bottom:8px;">
          <input type="number" id="metal-price-override-input" step="0.01" placeholder="e.g. 96.50" style="flex:1;border:1.5px solid #DDD;border-radius:8px;padding:6px 10px;font-size:0.9em;font-weight:700;">
          <button onclick="applyMetalPriceOverride()" style="background:#10B981;color:white;border:none;border-radius:8px;padding:6px 12px;font-weight:800;font-size:0.82em;cursor:pointer;">✓</button>
          <button onclick="resetMetalPriceOverride(currentMetal)" style="background:#FFF0F0;color:#EF4444;border:none;border-radius:8px;padding:6px 10px;font-weight:800;font-size:0.82em;cursor:pointer;">Reset All</button>
        </div>
        <div id="metal-purity-prices"></div>
      </div>
    </div>
  </div>
  <div class="metal-stat-row">
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-entries">0</div><div class="metal-stat-box-lbl">Entries</div></div>
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-oz">0</div><div class="metal-stat-box-lbl">Troy Oz</div></div>
    <div class="metal-stat-box"><div class="metal-stat-box-val" id="metal-stat-avg">$0</div><div class="metal-stat-box-lbl">Avg Cost/g</div></div>
  </div>
  <div class="metal-add-panel">
    <div class="metal-add-panel-header" onclick="toggleAddPanel()">
      <div class="metal-add-panel-title"><span id="metal-add-icon">🥇</span> Add <span id="metal-add-label">Gold</span> Entry</div>
      <div class="metal-add-panel-toggle" id="add-panel-toggle">+</div>
    </div>
    <div class="metal-add-panel-body" id="metal-add-panel-body">
      <div class="metal-form-grid">
        <div class="metal-form-field"><label>Source / Name</label><input type="text" id="metal-name" placeholder="e.g. OneGold, Coin"></div>
        <div class="metal-form-field"><label>Weight (grams)</label><input type="number" id="metal-grams" placeholder="0.00" step="0.001"></div>
        <div class="metal-form-field"><label>Purity</label><input type="text" id="metal-purity" placeholder="e.g. 22K, 999"></div>
        <div class="metal-form-field"><label>Occasion</label><input type="text" id="metal-occasion" placeholder="e.g. Purchase, Gift"></div>
        <div class="metal-form-field"><label>Purchase Price / gram ($)</label><input type="number" id="metal-price" placeholder="Leave blank = current est." step="0.01"></div>
        <div class="metal-form-field"><label>Date</label><input type="date" id="metal-date"></div>
        <div class="metal-form-field"><label>Form</label><select id="metal-form"><option>Bar</option><option>Coin</option><option>Round</option><option>ETF / Digital</option><option>Jewelry</option><option>Other</option></select></div>
        <div class="metal-form-field"><label>Notes</label><input type="text" id="metal-notes" placeholder="Optional"></div>
      </div>
      <button class="metal-save-btn gold" id="metal-save-btn" onclick="addMetalEntry()">+ Add Gold Entry</button>
      <div style="font-size:0.73em;color:var(--text-light);font-weight:600;margin-top:10px;text-align:center;" id="metal-price-hint">💡 Est. gold ≈ $95.50/g · $2,970/oz</div>
    </div>
  </div>
  <div class="metal-holdings-card">
    <div class="metal-holdings-header">
      <div class="metal-holdings-title" id="holdings-list-title">🥇 Gold Holdings</div>
      <div class="metal-holdings-count" id="holdings-list-count">0 entries</div>
    </div>
    <div id="metals-holdings-list"><div class="metal-empty"><div class="metal-empty-icon">🥇</div><div class="metal-empty-text">No gold entries yet</div></div></div>
  </div>
</div>

<!-- ══════════════ INVESTMENTS ══════════════ -->
<div class="screen" id="screen-invest">
  <div class="invest-hero">
    <div class="invest-deco">📈</div>
    <div class="invest-hero-label">Total Portfolio Value</div>
    <div class="invest-hero-value" id="invest-total-value">$0</div>
    <div class="invest-hero-stats">
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-cost">$0</div><div class="invest-hero-stat-lbl">Total Cost</div></div>
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-gain">$0</div><div class="invest-hero-stat-lbl">Gain / Loss</div></div>
      <div class="invest-hero-stat"><div class="invest-hero-stat-val" id="invest-total-pct">0%</div><div class="invest-hero-stat-lbl">Return</div></div>
    </div>
  </div>
  <div class="invest-cat-tabs" id="invest-cat-tabs">
    <button class="invest-cat-tab active" onclick="filterInvest('All',this)">All</button>
    <button class="invest-cat-tab" onclick="filterInvest('Stocks',this)">📊 Stocks</button>
    <button class="invest-cat-tab" onclick="filterInvest('ETF',this)">🗂 ETF</button>
    <button class="invest-cat-tab" onclick="filterInvest('Crypto',this)">🪙 Crypto</button>
    <button class="invest-cat-tab" onclick="filterInvest('Retirement',this)">🏦 Retirement</button>
    <button class="invest-cat-tab" onclick="filterInvest('Real Estate',this)">🏡 Real Estate</button>
    <button class="invest-cat-tab" onclick="filterInvest('Other',this)">📦 Other</button>
  </div>
  <div id="invest-holdings-list" style="margin-bottom:16px;"></div>
  <div class="invest-entry-card">
    <div class="invest-entry-title">➕ Add Investment</div>
    <div class="inv-form-grid">
      <div class="inv-field"><label>Ticker / Name</label><input type="text" id="inv-ticker" placeholder="e.g. FXAIX, BTC"></div>
      <div class="inv-field"><label>Category</label><select id="inv-cat"><option>Stocks</option><option>ETF</option><option>Crypto</option><option>Retirement</option><option>Real Estate</option><option>Other</option></select></div>
      <div class="inv-field"><label>Shares / Units</label><input type="number" id="inv-shares" placeholder="0.00" step="0.0001"></div>
      <div class="inv-field"><label>Avg Cost / Share ($)</label><input type="number" id="inv-cost" placeholder="0.00" step="0.01"></div>
      <div class="inv-field"><label>Current Price ($)</label><input type="number" id="inv-price" placeholder="0.00" step="0.01"></div>
      <div class="inv-field"><label>Date Added</label><input type="date" id="inv-date"></div>
      <div class="inv-field full"><label>Account / Broker</label><input type="text" id="inv-broker" placeholder="e.g. Fidelity, Robinhood, Webull"></div>
    </div>
    <button class="add-invest-btn" onclick="addInvestEntry()">+ Add to Portfolio</button>
  </div>
</div>

<!-- ══════════════ SETTINGS ══════════════ -->
<div class="screen" id="screen-settings">
  <!-- Data Management (moved from Home) -->
  
    <!-- ═══ Firebase Account ═══ -->
    <div style="background:white;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 1px 6px rgba(0,0,0,0.06);">
      <div style="font-size:0.7em;font-weight:800;color:#888;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px;">☁️ Cloud Sync Account</div>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <img id="firebase-user-avatar" src="" style="display:none;width:40px;height:40px;border-radius:50%;border:2px solid #E8E8E8;">
        <div>
          <div id="firebase-user-display" style="font-weight:800;font-size:0.9em;color:#1E2A6E;">Loading...</div>
          <div style="font-size:0.72em;color:#10B981;font-weight:700;">✅ Synced across devices</div>
        </div>
      </div>
      <button onclick="signOut()" style="width:100%;padding:10px;background:#FFF0F0;border:1.5px solid #FFCDD2;border-radius:10px;color:#EF4444;font-weight:800;font-size:0.82em;cursor:pointer;">
        Sign Out
      </button>
    </div>
    <!-- ══════════════════════ -->
<div class="settings-card">
    <div class="settings-title">💾 Data Management</div>
    <div class="form-row">
      <span class="form-icon">💾</span><span class="form-label">Backup</span>
      <button onclick="downloadBackup()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">⬇️ Download</button>
    </div>
    <div class="form-row">
      <span class="form-icon">📊</span><span class="form-label">Export</span>
      <button onclick="exportAllData()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">Export Excel</button>
    </div>
    <div class="form-row" style="border-bottom:none;">
      <span class="form-icon">📥</span><span class="form-label">Restore</span>
      <label for="restore-settings-file" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 14px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">⬆️ Upload</label>
      <input type="file" id="restore-settings-file" accept=".json" style="display:none;" onchange="restoreBackup(this)">
    </div>
    <div class="form-row" style="border-bottom:none;margin-top:4px;">
      <span class="form-icon">🎬</span><span class="form-label">Intro Tour</span>
      <div style="display:flex;gap:6px;">
        <button onclick="showOnboarding()" style="background:var(--yellow-light);border:none;border-radius:8px;padding:8px 12px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--text-dark);">▶ Slides</button>
        <button onclick="startCoachTour()" style="background:var(--primary-light);border:none;border-radius:8px;padding:8px 12px;font-family:Nunito;font-weight:800;font-size:0.82em;cursor:pointer;color:var(--primary);">🎯 Coach</button>
      </div>
    </div>
  </div>

  <!-- PIN Lock — COMMENTED OUT, RE-ENABLE LATER -->
  <!-- 
  === PIN LOCK SETTINGS UI — Uncomment to re-enable ===
  <div class="settings-card">
    <div class="settings-title">🔒 App Lock</div>
    <div class="form-row">
      <span class="form-icon">🔑</span>
      <div style="flex:1;">
        <div style="font-weight:800;font-size:0.9em;color:var(--text-dark);">PIN Lock</div>
        <div style="font-size:0.76em;color:var(--text-light);font-weight:600;margin-top:2px;" id="pin-status-label">Not set up</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="pin-toggle-btn" onclick="handlePinToggle()">Set PIN</button>
        <button id="pin-change-btn" onclick="showChangePIN()" style="display:none;">Change</button>
      </div>
    </div>
  </div>
  === END PIN LOCK SETTINGS === -->

  <!-- Currency -->
  <div class="settings-card">
    <div class="settings-title">💱 Currency</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">All amounts display in your chosen currency symbol.</p>
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div style="font-weight:900;font-size:1.1em;" id="settings-curr-display">🇺🇸 USD — $</div>
        <div style="font-size:0.78em;color:var(--text-light);margin-top:2px;" id="settings-curr-name">US Dollar</div>
      </div>
      <button onclick="openCurrencyPicker('settings')" style="background:var(--yellow);border:none;border-radius:10px;padding:10px 18px;font-family:Nunito,sans-serif;font-weight:900;font-size:0.88em;cursor:pointer;">Change</button>
    </div>
  </div>

  <!-- FX Exchange Rates -->
  <div class="settings-card">
    <div class="settings-title">💱 Exchange Rates <span id="fx-override-badge" style="display:none;background:#F0FFF4;color:#10B981;font-size:0.65em;border-radius:8px;padding:2px 8px;font-weight:800;margin-left:6px;vertical-align:middle;">✏️ Custom</span></div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Rates used to convert your multi-currency assets &amp; transactions to <span id="fx-base-label">USD</span>. Override any rate if the built-in estimate is off.</p>
    <div id="fx-rates-list"></div>
    <div style="margin-top:10px;font-size:0.72em;color:var(--text-light);font-weight:600;">
      💡 Rates shown as: 1 USD = N units. Only currencies found in your data appear here.
    </div>
  </div>

  <!-- Home Spending Cards Manager -->
  <div class="settings-card">
    <div class="settings-title">🏠 Home Spending Cards</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which category cards appear on your home screen. Toggle ✓ to show/hide, ✕ to permanently remove.</p>
    <div class="home-card-grid" id="home-card-grid"></div>
    <div style="margin-top:10px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;">ADD CUSTOM CARD</div>
      <div class="home-card-emoji-pick" id="home-card-emoji-row"></div>
      <div class="home-card-add-row">
        <input type="text" class="cat-add-input" id="home-card-name-input" placeholder="Card name (e.g. Groceries)">
        <button class="cat-add-btn" onclick="addHomeCard()">+ Add</button>
      </div>
    </div>
  </div>

  <!-- Investment Cards Manager -->
  <div class="settings-card">
    <div class="settings-title">📈 Home Investment Cards</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which investment cards appear on the Investing tab. Toggle ✓ to show/hide, ✕ to remove. Add custom cards like PF, NPS, FD, etc.</p>
    <div class="home-card-grid" id="inv-card-grid"></div>
    <div style="margin-top:10px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;">ADD CUSTOM INVESTMENT CARD</div>
      <div style="font-size:0.75em;color:var(--text-light);font-weight:600;margin-bottom:8px;">Pick an emoji, name your card, choose how it tracks (contributions like PF/VPF/FD, or units like ETF)</div>
      <div class="home-card-emoji-pick" id="inv-card-emoji-row"></div>
      <div style="display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;">
        <input type="text" class="cat-add-input" id="inv-card-name-input" placeholder="Card name (e.g. PF/VPF, NPS, FD)" style="flex:2;min-width:140px;">
        <select id="inv-card-template" class="cat-add-input" style="flex:1;min-width:110px;">
          <option value="General">💰 Contribution</option>
          <option value="ETF/MF">📊 Units × NAV</option>
          <option value="Stocks">📈 Shares × Price</option>
          <option value="Crypto">🪙 Coins × Price</option>
          <option value="Metals">🥇 Weight × Cost</option>
          <option value="Real Estate">🏡 Property</option>
        </select>
      </div>
      <button class="cat-add-btn" style="width:100%;" onclick="addInvCard()">+ Add Investment Card</button>
    </div>
  </div>

  <!-- Category Manager -->
  <div class="settings-card">
    <div class="settings-title">🏷️ Manage Categories</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Customize subcategories used in Quick Add. Tap ✕ to remove, or add your own below.</p>
    <div class="cat-mgr-tabs" id="cat-mgr-tabs">
      <button class="cat-mgr-tab active" onclick="showCatMgrTab('expense',this)">💸 Expense</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('income',this)">💵 Income</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('investment',this)">📈 Invest</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('debt',this)">📉 Debt</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('given',this)">🤝 Given</button>
      <button class="cat-mgr-tab" onclick="showCatMgrTab('additional',this)">🎁 Additional</button>
    </div>
    <div class="cat-pills-wrap" id="cat-pills-wrap"></div>
    <div class="cat-add-row">
      <input type="text" class="cat-add-input" id="cat-add-input" placeholder="New category name..." onkeydown="if(event.key==='Enter')addCustomCat()">
      <button class="cat-add-btn" onclick="addCustomCat()">+ Add</button>
    </div>
  </div>

  <!-- Net Worth Account Types -->
  <div class="settings-card" id="settings-nw-card">
    <div class="settings-title">💎 Net Worth Account Types</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:12px;">Choose which types appear in the Add Account picker. Toggle ✓ to show/hide, ✕ to remove custom types.</p>
    <div class="home-card-grid" id="nw-type-visibility-grid"></div>
    <div style="margin-top:12px;border-top:1px solid #F0F0F0;padding-top:12px;">
      <div style="font-size:0.78em;font-weight:800;color:var(--text-med);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Add Custom Type</div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <div id="nw-type-emoji-row" style="display:flex;gap:4px;flex-wrap:wrap;"></div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <input type="text" id="nw-type-name-input" class="cat-add-input" placeholder="e.g. Auto Loan, Other Asset" style="flex:1;">
        <label style="display:flex;align-items:center;gap:4px;font-size:0.8em;font-weight:700;cursor:pointer;">
          <input type="checkbox" id="nw-type-is-liab"> Liability
        </label>
        <button class="cat-add-btn" onclick="addCustomNWType()">+ Add</button>
      </div>
    </div>
  </div>

  <!-- Theme Selector -->
  <div class="settings-card">
    <div class="settings-title">🎨 App Theme</div>
    <p style="font-size:0.82em;color:var(--text-light);font-weight:600;margin-bottom:14px;">Pick a vibe! Each theme adds fun decorations and colors.</p>
    <div class="theme-grid">
      <div class="theme-card default active-theme" id="theme-default" onclick="setTheme('default')">
        <div class="tc-preview">☀️💰</div>
        <div class="tc-name">Classic MoneyFlow</div>
        <div class="tc-desc">The original warm & sunny look</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card looney" id="theme-looney" onclick="setTheme('looney')">
        <div class="tc-preview">🐰🦆😜</div>
        <div class="tc-name">Looney Tunes!</div>
        <div class="tc-desc">Wabbit season for your wallet</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card jungle" id="theme-jungle" onclick="setTheme('jungle')">
        <div class="tc-preview">🐒🌿🦜</div>
        <div class="tc-name">Jungle Vibes</div>
        <div class="tc-desc">Go bananas with your budget!</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card space" id="theme-space" onclick="setTheme('space')">
        <div class="tc-preview">🚀⭐🌙</div>
        <div class="tc-name">Space Explorer</div>
        <div class="tc-desc">Finance at warp speed</div>
        <div class="tc-active-badge">✓</div>
      </div>
      <div class="theme-card ocean" id="theme-ocean" onclick="setTheme('ocean')">
        <div class="tc-preview">🐠🌊🐚</div>
        <div class="tc-name">Deep Ocean</div>
        <div class="tc-desc">Dive deep into your finances</div>
        <div class="tc-active-badge">✓</div>
      </div>
    </div>
  </div>


</div>

<!-- FAB BACKDROP -->
<div class="fab-backdrop" id="fab-backdrop" onclick="closeFabMenu()"></div>

<!-- FAB LAUNCHER MENU -->
<div class="fab-menu" id="fab-menu">
  <div class="fab-menu-item" id="fmi-investment">
    <div class="fab-menu-label">📈 Investment</div>
    <button class="fab-menu-btn" style="background:#7C3AED;color:white;" onclick="closeFabMenu();openQuickAdd('investment',null)">📈</button>
  </div>
  <div class="fab-menu-item" id="fmi-income">
    <div class="fab-menu-label">💵 Income</div>
    <button class="fab-menu-btn" style="background:#10B981;color:white;" onclick="closeFabMenu();openQuickAdd('income',null)">💵</button>
  </div>
  <div class="fab-menu-item" id="fmi-expense">
    <div class="fab-menu-label">💸 Expense</div>
    <button class="fab-menu-btn" style="background:#EF4444;color:white;" onclick="closeFabMenu();openQuickAdd('expense',null)">💸</button>
  </div>
</div>

<!-- FLOATING ADD BUTTON -->
<button class="fab-add" id="fab-add-btn" onclick="toggleFabMenu()" title="Add Transaction">＋</button>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <button class="nav-item active" onclick="switchScreen('home',this)"><div class="nav-icon">🏠</div><span>Home</span></button>
  <button class="nav-item" onclick="switchScreen('tx',this)"><div class="nav-icon">📋</div><span>Txns</span></button>
  <button class="nav-item" onclick="switchScreen('budget',this)"><div class="nav-icon">🎯</div><span>Budget</span></button>
  <button class="nav-item" onclick="switchScreen('networth',this)"><div class="nav-icon">💎</div><span>Net Worth</span></button>
  <button class="nav-item" onclick="switchScreen('import',this)"><div class="nav-icon">📥</div><span>Import</span></button>
</div>

<!-- ══════════════ BUDGET MODULE ══════════════ -->
<div class="screen" id="screen-budget">
  <!-- Module Tabs -->
  <div class="budget-module-tabs">
    <button class="bm-tab active" id="btab-overview" onclick="setBudgetTab('overview',this)">📊 Overview</button>
    <button class="bm-tab" id="btab-expenses" onclick="setBudgetTab('expenses',this)">💸 Expenses</button>
    <button class="bm-tab" id="btab-savings" onclick="setBudgetTab('savings',this)">💰 Savings</button>
    <button class="bm-tab" id="btab-goals" onclick="setBudgetTab('goals',this)">🎯 Goals</button>
  </div>

  <!-- Budget Month Nav -->
  <div class="period-nav" style="margin-bottom:12px;">
    <button onclick="budgetChangeMonth(-1)">‹</button>
    <div class="period-label" id="budget-month-label">February 2026</div>
    <button onclick="budgetChangeMonth(1)">›</button>
  </div>

  <!-- OVERVIEW TAB -->
  <div id="bsec-overview" class="budget-section">
    <!-- Hero card: Total left + dual line chart -->
    <div class="budget-hero-card" id="bh-card">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:2px;">
        <div class="bh-title" id="bh-title">TOTAL BUDGETED</div>
        <div class="bh-view-toggle">
          <button class="bh-view-btn active" id="bh-btn-month" onclick="setBudgetViewMode('month')">Month</button>
          <button class="bh-view-btn" id="bh-btn-year" onclick="setBudgetViewMode('year')">Year</button>
        </div>
      </div>
      <div class="bh-amount" id="bh-amount">$0</div>
      <div class="bh-sub" id="bh-sub"></div>
      <div class="bh-chart-wrap"><canvas id="budget-overview-chart"></canvas></div>
      <div class="bh-dual-lines">
        <div class="bh-line-block">
          <div class="bh-line-label">Expenses</div>
          <div class="bh-line-val" id="bh-exp-val">$0</div>
          <div class="bh-line-sub" id="bh-exp-sub"></div>
        </div>
        <div class="bh-line-block">
          <div class="bh-line-label">Savings</div>
          <div class="bh-line-val" id="bh-sav-val">$0</div>
          <div class="bh-line-sub" id="bh-sav-sub"></div>
        </div>
      </div>
    </div>

    <!-- Category bubbles — split by type -->
    <div id="budget-cats-wrapper">
      <div class="bcat-group-label" id="bcat-label-exp" style="display:none;">
        <span class="bcat-group-pill exp">💸 Expenses</span>
      </div>
      <div class="budget-cats-scroll" id="budget-cats-bubbles-exp"></div>
      <div class="bcat-group-label" id="bcat-label-sav" style="display:none;">
        <span class="bcat-group-pill sav">💰 Savings</span>
      </div>
      <div class="budget-cats-scroll" id="budget-cats-bubbles-sav"></div>
    </div>
  </div>

  <!-- EXPENSES GOALS TAB -->
  <div id="bsec-expenses" class="budget-section" style="display:none;">
    <!-- Category detail view (shown when a category is clicked) -->
    <div class="bcat-detail-view" id="bcat-detail-expenses">
      <button class="bcd-back-btn" onclick="closeBudgetCatDetail('expenses')">← Back</button>
      <div class="bcd-header">
        <div class="bcd-icon" id="bcd-exp-icon"></div>
        <div class="bcd-name" id="bcd-exp-name"></div>
        <div class="bcd-spent" id="bcd-exp-spent"></div>
      </div>
      <div class="bcd-chart-card">
        <div class="bcd-chart-title"><span>Last 12 Months</span></div>
        <div class="bcd-chart-outer">
          <div class="bcd-chart-wrap"><canvas id="bcd-exp-chart"></canvas></div>
          <div class="bcd-budget-chip" id="bcd-exp-chip" onclick="activateBudgetChip('expense')">
            <span class="bcd-chip-label" id="bcd-exp-chip-label">$0</span>
            <span class="bcd-chip-pencil">✏️</span>
            <input class="bcd-chip-input" id="bcd-exp-chip-input" type="number" step="1"
              onblur="saveBudgetChip('expense')"
              onkeydown="if(event.key==='Enter')saveBudgetChip('expense');if(event.key==='Escape')cancelBudgetChip('expense');">
          </div>
        </div>
      </div>
      <div class="bcd-metrics" id="bcd-exp-metrics"></div>
      <div class="bcd-txns-section">
        <div class="bcd-txns-title"><span id="bcd-exp-txn-month">Transactions</span></div>
        <div id="bcd-exp-txns"></div>
      </div>
    </div>
    <!-- Goals list -->
    <div id="blist-expenses">
      <div class="budget-goals-section">
        <div class="bgs-header">
          <div class="bgs-title">💸 Expense Budgets</div>
          <button class="bgs-add-btn" onclick="openEditBudgetPopup(null,'expense')">+ Add</button>
        </div>
        <div id="budget-exp-goals"></div>
      </div>
    </div>
  </div>

  <!-- SAVINGS GOALS TAB -->
  <div id="bsec-savings" class="budget-section" style="display:none;">
    <div class="bcat-detail-view" id="bcat-detail-savings">
      <button class="bcd-back-btn" onclick="closeBudgetCatDetail('savings')">← Back</button>
      <div class="bcd-header">
        <div class="bcd-icon" id="bcd-sav-icon"></div>
        <div class="bcd-name" id="bcd-sav-name"></div>
        <div class="bcd-spent" id="bcd-sav-spent"></div>
      </div>
      <div class="bcd-chart-card">
        <div class="bcd-chart-title"><span>Last 12 Months</span></div>
        <div class="bcd-chart-outer">
          <div class="bcd-chart-wrap"><canvas id="bcd-sav-chart"></canvas></div>
          <div class="bcd-budget-chip" id="bcd-sav-chip" onclick="activateBudgetChip('savings')">
            <span class="bcd-chip-label" id="bcd-sav-chip-label">$0</span>
            <span class="bcd-chip-pencil">✏️</span>
            <input class="bcd-chip-input" id="bcd-sav-chip-input" type="number" step="1"
              onblur="saveBudgetChip('savings')"
              onkeydown="if(event.key==='Enter')saveBudgetChip('savings');if(event.key==='Escape')cancelBudgetChip('savings');">
          </div>
        </div>
      </div>
      <div class="bcd-metrics" id="bcd-sav-metrics"></div>
      <div class="bcd-txns-section">
        <div class="bcd-txns-title"><span id="bcd-sav-txn-month">Transactions</span></div>
        <div id="bcd-sav-txns"></div>
      </div>
    </div>
    <div id="blist-savings">
      <div class="budget-goals-section">
        <div class="bgs-header">
          <div class="bgs-title">💰 Savings Goals</div>
          <button class="bgs-add-btn" onclick="openEditBudgetPopup(null,'savings')">+ Add</button>
        </div>
        <div id="budget-sav-goals"></div>
      </div>
    </div>
  </div>
</div>

<!-- ── GOALS PANEL (outside all bsec, inside screen-budget via JS control) ── -->
<div id="blist-goals" style="display:none;position:fixed;top:0;left:0;right:0;bottom:60px;overflow-y:auto;background:#FAF8F5;z-index:50;padding:16px 16px 96px;">
  <!-- Top bar -->
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <button onclick="closeGoalsPanelBack()" style="background:#F0F0F0;border:none;border-radius:10px;padding:8px 14px;font-weight:800;font-size:0.85em;cursor:pointer;">← Back</button>
    <div style="font-weight:900;font-size:1.05em;color:var(--text-dark);">🎯 Goals</div>
    <div style="width:70px;"></div>
  </div>
  <!-- Active / Achieved tabs -->
  <div style="display:flex;gap:8px;margin-bottom:14px;" id="goals-tab-bar">
    <button id="gtab-active" onclick="setGoalsTab('active')"
      style="flex:1;padding:9px 0;border:none;border-radius:12px;background:var(--yellow);color:var(--text-dark);font-family:Nunito,sans-serif;font-weight:900;font-size:0.85em;cursor:pointer;">
      🎯 Active <span id="gtab-active-count" style="background:rgba(0,0,0,0.12);border-radius:20px;padding:1px 7px;font-size:0.85em;margin-left:4px;">0</span>
    </button>
    <button id="gtab-achieved" onclick="setGoalsTab('achieved')"
      style="flex:1;padding:9px 0;border:none;border-radius:12px;background:#F0F0F0;color:var(--text-med);font-family:Nunito,sans-serif;font-weight:900;font-size:0.85em;cursor:pointer;">
      🏆 Achieved <span id="gtab-achieved-count" style="background:rgba(0,0,0,0.10);border-radius:20px;padding:1px 7px;font-size:0.85em;margin-left:4px;">0</span>
    </button>
  </div>
  <div id="goals-list-grid"></div>
</div>
<!-- Goals FAB — yellow to match main FAB for visual consistency -->
<button id="goals-fab-btn" onclick="openGoalSheet(null)"
  style="display:none;position:fixed;bottom:80px;right:20px;width:56px;height:56px;
         border-radius:50%;background:var(--yellow);color:var(--text-dark);border:none;font-size:1.8em;
         font-weight:900;box-shadow:0 4px 20px rgba(245,200,66,0.55);cursor:pointer;z-index:300;
         align-items:center;justify-content:center;line-height:1;
         animation:fabPulse 2.8s ease-in-out infinite;">＋</button>

<!-- GOAL BOTTOM SHEET -->
<div id="goal-sheet-overlay" onclick="closeGoalSheet()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:299;"></div>
<div id="goal-sheet" style="display:none;position:fixed;bottom:0;left:0;right:0;background:white;border-radius:20px 20px 0 0;padding:20px 16px 36px;z-index:300;box-shadow:0 -4px 30px rgba(0,0,0,0.2);max-height:88vh;overflow-y:auto;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <div style="font-weight:900;font-size:1em;color:var(--text-dark);" id="goal-sheet-title">New Goal</div>
    <button onclick="closeGoalSheet()" style="background:#F0F0F0;border:none;border-radius:50%;width:32px;height:32px;font-size:1.1em;cursor:pointer;">✕</button>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Goal Type</div>
      <select class="nw-sheet-select" id="gs-goaltype" onchange="toggleGoalTypeFields()">
        <option value="grow">📈 Grow (build toward target)</option>
        <option value="reduce">📉 Reduce (pay down liability)</option>
      </select>
    </div>
  </div>
  <!-- Start Balance — only shown for reduce goals -->
  <div class="nw-sheet-row" id="gs-startbal-row" style="display:none;">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Starting Balance (when you began tracking)</div>
      <input class="nw-sheet-input" id="gs-startbal" type="number" placeholder="e.g. 25000 (original loan balance)" step="any" oninput="updateGoalPreview()">
    </div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Goal Name</div>
      <input class="nw-sheet-input" id="gs-name" type="text" placeholder="e.g. Emergency Fund, Gold 1500g">
    </div>
  </div>
  <!-- Icon picker row (full width, below name) -->
  <div class="nw-sheet-field">
    <div class="nw-sheet-label">Icon <span style="font-weight:600;color:var(--text-light);text-transform:none;letter-spacing:0;">— tap to pick</span></div>
    <input type="hidden" id="gs-icon" value="🎯">
    <div id="gs-icon-grid" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Target Amount</div>
      <input class="nw-sheet-input" id="gs-target" type="number" placeholder="1000000" step="any" oninput="updateGoalPreview()">
    </div>
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Unit</div>
      <select class="nw-sheet-select" id="gs-unit">
        <option value="currency">$ (Currency)</option>
        <option value="grams">Grams (g)</option>
        <option value="kg">Kilograms (kg)</option>
        <option value="count">Count</option>
        <option value="sqft">Sq. Ft / Area (Real Estate)</option>
      </select>
    </div>
  </div>
  <div class="nw-sheet-row">
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Currency (if currency unit)</div>
      <select class="nw-sheet-select" id="gs-currency" onchange="updateGoalPreview()">
        <option value="USD">USD $</option>
        <option value="INR">INR ₹</option>
        <option value="EUR">EUR €</option>
        <option value="GBP">GBP £</option>
        <option value="AED">AED د.إ</option>
        <option value="SAR">SAR ﷼</option>
        <option value="CAD">CAD C$</option>
        <option value="AUD">AUD A$</option>
        <option value="SGD">SGD S$</option>
        <option value="JPY">JPY ¥</option>
        <option value="CNY">CNY ¥</option>
      </select>
    </div>
    <div class="nw-sheet-field" style="flex:1;">
      <div class="nw-sheet-label">Target Date (optional)</div>
      <input class="nw-sheet-input" id="gs-date" type="month">
    </div>
  </div>
  <div class="nw-sheet-field">
    <div class="nw-sheet-label">Description (optional)</div>
    <input class="nw-sheet-input" id="gs-desc" type="text" placeholder="e.g. Kids college fund">
  </div>
  <div class="nw-sheet-field">
    <div class="nw-sheet-label" id="gs-picker-label">Map NW Accounts to this Goal</div>
    <div style="font-size:0.72em;color:var(--text-light);font-weight:600;margin-bottom:8px;" id="gs-picker-hint">Search and select accounts — grouped by type. Combined value counts as current progress.</div>
    <input type="text" class="gap-search" id="gap-search-input" placeholder="🔍  Search accounts..." oninput="filterGoalPicker(this.value)">
    <div id="gs-account-picker" style="max-height:260px;overflow-y:auto;border:1.5px solid #EEE;border-radius:12px;padding:8px;background:white;"></div>
  </div>
  <!-- Live progress preview -->
  <div class="gap-preview-bar" id="gs-preview" style="display:none;">
    <div class="gap-preview-label">📊 Progress Preview</div>
    <div class="gap-preview-track"><div class="gap-preview-fill" id="gap-preview-fill" style="width:0%;"></div></div>
    <div class="gap-preview-nums">
      <span id="gap-preview-current" style="color:var(--primary);">—</span>
      <span id="gap-preview-pct" style="color:var(--primary);">0%</span>
      <span id="gap-preview-target" style="color:var(--text-med);">of —</span>
    </div>
  </div>
  <button id="gs-save-btn" onclick="saveGoal()" style="width:100%;background:var(--primary);color:white;border:none;border-radius:14px;padding:16px;font-weight:900;font-size:1.05em;cursor:pointer;margin-top:14px;box-shadow:0 4px 18px rgba(30,42,110,0.35);letter-spacing:0.2px;">🎯 Add Goal</button>
  <input type="hidden" id="gs-editing-id">
</div>

<!-- ══════════════ NET WORTH ══════════════ -->
<div class="screen" id="screen-networth">
  <!-- ── Hero ── -->
  <div class="nw-hero">
    <div class="nw-hero-label">💎 Total Net Worth</div>
    <div class="nw-hero-amount" id="nw-total">$0</div>
    <div class="nw-hero-change" id="nw-change"></div>
    <div class="nw-hero-bars">
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Assets</div>
        <div class="nw-hero-bar-val" id="nw-assets-hero">$0</div>
      </div>
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Liabilities</div>
        <div class="nw-hero-bar-val" id="nw-liab-hero">$0</div>
      </div>
      <div class="nw-hero-bar-block">
        <div class="nw-hero-bar-label">Debt Ratio</div>
        <div class="nw-hero-bar-val" id="nw-debt-ratio">0%</div>
        <div class="nw-debt-badge" id="nw-debt-badge"></div>
      </div>
    </div>
  </div>

  <!-- ── CTA Buttons ── -->
  <div class="nw-cta-row">
    <button class="nw-btn-snapshot" onclick="saveNWSnapshot()">📸 Save Snapshot</button>
    <button class="nw-btn-add" onclick="openNWSheet()">+ Add Account</button>
  </div>

  <!-- ── Insights Cards ── -->
  <div id="nw-insights-list"></div>

  <!-- ── Trend + Snapshots Card ── -->
  <div class="nw-trend-card" id="nw-chart-card" style="display:none;">
    <div class="nw-trend-header">
      <div class="nw-trend-title">📈 Net Worth Trend</div>
      <div class="nw-trend-badge" id="nw-snap-count">0 Snapshots</div>
    </div>
    <div class="nw-chart-wrap"><canvas id="nw-trend-chart"></canvas></div>
    <div class="nw-snaps-label">Recent Snapshots</div>
    <div id="nw-snapshots-list"></div>
  </div>

  <!-- ── Asset Allocation ── -->
  <div class="nw-alloc-card" id="nw-alloc-card" style="display:none;">
    <div class="nw-alloc-title">Asset Allocation</div>
    <!-- Stacked bar -->
    <div id="nw-alloc-stacked-bar" style="display:flex;height:22px;border-radius:11px;overflow:hidden;margin-bottom:14px;gap:2px;"></div>
    <!-- Total -->
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div style="font-size:0.75em;font-weight:700;color:var(--text-light);">Total Assets</div>
      <div style="font-weight:900;font-size:1em;color:var(--text-dark);" id="nw-alloc-total">$0</div>
    </div>
    <!-- Allocation rows -->
    <div id="nw-donut-legend"></div>
  </div>

  <!-- ── ASSETS section ── -->
  <div class="nw-group-header">
    <div class="nw-group-label">💰 Assets</div>
    <div class="nw-group-total" id="nw-assets-total" style="color:#10B981;"></div>
  </div>

  <div class="nw-section" id="nw-sec-checking">
    <div class="nw-section-header" onclick="toggleNWSection('checking')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#EBF5FF;">🏦</div>
        <div><div class="nw-section-name">Checking</div><div class="nw-section-sub" id="nw-sub-checking">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-checking" style="color:#4A9EFF;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-checking">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-checking">
      <button class="nw-section-add" onclick="openNWSheet('checking')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-savings_acc">
    <div class="nw-section-header" onclick="toggleNWSection('savings_acc')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#E8FDF5;">💵</div>
        <div><div class="nw-section-name">Savings</div><div class="nw-section-sub" id="nw-sub-savings_acc">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-savings_acc" style="color:#10B981;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-savings_acc">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-savings_acc">
      <button class="nw-section-add" onclick="openNWSheet('savings_acc')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-brokerage">
    <div class="nw-section-header" onclick="toggleNWSection('brokerage')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F0EBFF;">📈</div>
        <div><div class="nw-section-name">Investments &amp; Brokerage</div><div class="nw-section-sub" id="nw-sub-brokerage">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-brokerage" style="color:#7C3AED;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-brokerage">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-brokerage">
      <button class="nw-section-add" onclick="openNWSheet('brokerage')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-retirement">
    <div class="nw-section-header" onclick="toggleNWSection('retirement')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFFBE8;">🏛️</div>
        <div><div class="nw-section-name">Retirement</div><div class="nw-section-sub" id="nw-sub-retirement">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-retirement" style="color:#7C3AED;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-retirement">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-retirement">
      <button class="nw-section-add" onclick="openNWSheet('retirement')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-bonds_fd">
    <div class="nw-section-header" onclick="toggleNWSection('bonds_fd')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF7E8;">📋</div>
        <div><div class="nw-section-name">Bonds &amp; Fixed Income</div><div class="nw-section-sub" id="nw-sub-bonds_fd">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-bonds_fd" style="color:#F59E0B;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-bonds_fd">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-bonds_fd">
      <button class="nw-section-add" onclick="openNWSheet('bonds_fd')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-metals">
    <div class="nw-section-header" onclick="toggleNWSection('metals')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF8E1;">🥇</div>
        <div><div class="nw-section-name">Precious Metals</div><div class="nw-section-sub" id="nw-sub-metals">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-metals" style="color:#C8900A;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-metals">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-metals">
      <button class="nw-section-add" onclick="openNWSheet('metals')" style="margin-top:8px;">+ Add Entry</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-realestate">
    <div class="nw-section-header" onclick="toggleNWSection('realestate')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#E8F9EF;">🏡</div>
        <div><div class="nw-section-name">Real Estate</div><div class="nw-section-sub" id="nw-sub-realestate">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-realestate" style="color:#F97316;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-realestate">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-realestate">
      <button class="nw-section-add" onclick="openNWSheet('realestate')" style="margin-top:8px;">+ Add Property</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-cash">
    <div class="nw-section-header" onclick="toggleNWSection('cash')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F0FFF0;">💴</div>
        <div><div class="nw-section-name">Cash &amp; Wallet</div><div class="nw-section-sub" id="nw-sub-cash">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-cash" style="color:#84CC16;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-cash">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-cash">
      <button class="nw-section-add" onclick="openNWSheet('cash')" style="margin-top:8px;">+ Add Account</button>
    </div>
  </div>

  <!-- ── CUSTOM ASSET TYPES (dynamically injected) ── -->
  <div id="nw-custom-sections-assets"></div>

  <!-- ── LIABILITIES ── -->
  <div class="nw-group-header" style="margin-top:8px;">
    <div class="nw-group-label">📉 Liabilities</div>
    <div class="nw-group-total" id="nw-liab-total" style="color:#EF4444;"></div>
  </div>

  <div class="nw-section" id="nw-sec-credit_card">
    <div class="nw-section-header" onclick="toggleNWSection('credit_card')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF0F0;">💳</div>
        <div><div class="nw-section-name">Credit Cards</div><div class="nw-section-sub" id="nw-sub-credit_card">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-credit_card" style="color:#EF4444;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-credit_card">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-credit_card">
      <button class="nw-section-add" onclick="openNWSheet('credit_card')" style="margin-top:8px;">+ Add Card</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-loan">
    <div class="nw-section-header" onclick="toggleNWSection('loan')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#FFF4EE;">🏠</div>
        <div><div class="nw-section-name">Loans / Mortgage</div><div class="nw-section-sub" id="nw-sub-loan">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-loan" style="color:#F97316;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-loan">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-loan">
      <button class="nw-section-add" onclick="openNWSheet('loan')" style="margin-top:8px;">+ Add Loan</button>
    </div>
  </div>

  <div class="nw-section" id="nw-sec-other_liability">
    <div class="nw-section-header" onclick="toggleNWSection('other_liability')">
      <div class="nw-section-left">
        <div class="nw-section-icon" style="background:#F5F0FF;">📉</div>
        <div><div class="nw-section-name">Other Liabilities</div><div class="nw-section-sub" id="nw-sub-other_liability">—</div></div>
      </div>
      <div class="nw-section-right">
        <div class="nw-section-val" id="nw-val-other_liability" style="color:#8B5CF6;">$0</div>
        <span class="nw-section-chevron" id="nw-chev-other_liability">▼</span>
      </div>
    </div>
    <div class="nw-section-body" id="nw-body-other_liability">
      <button class="nw-section-add" onclick="openNWSheet('other_liability')" style="margin-top:8px;">+ Add Liability</button>
    </div>
  </div>

  <!-- ── CUSTOM LIABILITY TYPES (dynamically injected) ── -->
  <div id="nw-custom-sections-liab"></div>

<!-- ══ NW Account Sheet ══ -->
<div class="nw-sheet-overlay" id="nw-sheet-overlay" onclick="closeNWSheet()"></div>
<div class="nw-sheet" id="nw-sheet">
  <div class="nw-sheet-handle"></div>

  <!-- Phase 1: Type picker -->
  <div id="nws-phase-pick">
    <div class="nw-sheet-title">+ Add Account</div>
    <div class="nws-section-label">Account Type</div>
    <div class="nws-type-grid" id="nws-type-grid"></div>
  </div>

  <!-- Phase 2: Form (hidden until type chosen) -->
  <div id="nws-phase-form" style="display:none;">
    <!-- Selected type banner -->
    <div class="nws-selected-banner" id="nws-banner">
      <div class="nws-selected-left">
        <span class="nws-selected-icon" id="nws-banner-icon"></span>
        <span class="nws-selected-name" id="nws-banner-name"></span>
      </div>
      <span class="nws-type-badge" id="nws-banner-badge"></span>
    </div>

    <!-- Dynamic form fields -->
    <div id="nw-sheet-body"></div>

    <!-- Save + Cancel -->
    <button class="nw-sheet-save" onclick="saveNWAccount()" style="background:var(--yellow);border:none;border-radius:14px;padding:16px;width:100%;font-family:Nunito,sans-serif;font-weight:900;font-size:1em;cursor:pointer;margin-top:8px;">
      ✅ Save
    </button>
    <button onclick="closeNWSheet()" style="width:100%;background:none;border:none;font-family:Nunito,sans-serif;font-weight:800;font-size:0.88em;color:var(--text-light);cursor:pointer;padding:12px;margin-top:4px;">
      Cancel
    </button>
  </div>
</div>

</div><!-- /screen-networth -->

<!-- ══════════════ IMPORT HUB ══════════════ -->
<div class="screen" id="screen-import">
  <div style="margin-bottom:8px;">
    <div style="font-size:1.1em;font-weight:900;color:var(--text-dark);">📥 Import Hub</div>
    <div style="font-size:0.78em;color:var(--text-light);font-weight:600;margin-top:2px;">Bring your Excel history into MoneyFlow</div>
  </div>

  <!-- Tabs -->
  <div class="import-tabs">
    <button class="import-tab active" onclick="setImportTab('transactions',this)">💸 Transactions</button>
    <button class="import-tab" onclick="setImportTab('given',this)">🤝 Given to Others</button>
    <button class="import-tab" onclick="setImportTab('metals',this)">🥇 Metals</button>
    <button class="import-tab" onclick="setImportTab('realestate',this)">🏡 Real Estate</button>
    <button class="import-tab" onclick="setImportTab('reset',this)">🗑️ Reset</button>
  </div>

  <!-- ── TRANSACTIONS ── -->
  <div class="import-section active" id="isec-transactions">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="itx-step1">
      <div class="import-card">
        <div class="import-card-title">Step 1 — Upload Your Excel</div>
        <div class="import-card-sub">Supports Expenses, Income, and Investments sheets. Upload one file at a time. Expected columns: Date, Category, Amount, and optionally Description/Store/Month.</div>
        <div class="import-drop-zone" id="itx-dropzone" onclick="document.getElementById('itx-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'transactions')">
          <div class="import-drop-icon">📂</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV — Expenses, Income, or Investments</div>
        </div>
        <input type="file" id="itx-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'transactions')">
        <!-- Type selector -->
        <div style="font-size:0.78em;font-weight:800;color:var(--text-light);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px;">This file contains:</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:4px;">
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="expense" checked> 💸 Expenses</label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="income"> 💵 Income</label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-weight:700;font-size:0.85em;"><input type="radio" name="itx-type" value="investment"> 📈 Investments</label>
        </div>
      </div>
    </div>

    <!-- Step 2: Map columns -->
    <div class="import-step" id="itx-step2">
      <div class="import-card">
        <div class="import-card-title">Step 2 — Map Columns</div>
        <div class="import-card-sub" id="itx-map-sub">Match your Excel columns to the right fields.</div>
        <div class="import-col-map" id="itx-col-map"></div>
        <!-- Preview -->
        <div style="font-size:0.78em;font-weight:800;color:var(--text-light);text-transform:uppercase;letter-spacing:0.4px;margin-bottom:8px;">Preview (first 5 rows)</div>
        <div style="overflow-x:auto;"><table class="import-preview-table" id="itx-preview-table"></table></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetImportStep('transactions')">← Back</button>
          <button class="import-btn" onclick="goToImportStep('transactions','step3')">Review Categories →</button>
        </div>
      </div>
    </div>

    <!-- Step 3: Category review -->
    <div class="import-step" id="itx-step3">
      <div class="import-card">
        <div class="import-card-title">Step 3 — Review Categories</div>
        <div class="import-card-sub">We found possible duplicates or inconsistencies. Review each and choose to merge or keep separate.</div>
        <div id="itx-cat-review"></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="import-btn secondary" onclick="goToImportStep('transactions','step2')">← Back</button>
          <button class="import-btn" onclick="goToImportStep('transactions','step4')">Preview Import →</button>
        </div>
      </div>
    </div>

    <!-- Step 4: Final preview + confirm -->
    <div class="import-step" id="itx-step4">
      <div class="import-card">
        <div class="import-card-title">Step 4 — Confirm Import</div>
        <div class="import-summary-grid" id="itx-summary-grid"></div>
        <div style="overflow-x:auto;max-height:300px;overflow-y:auto;"><table class="import-preview-table" id="itx-final-table"></table></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="import-btn secondary" onclick="goToImportStep('transactions','step3')">← Back</button>
          <button class="import-btn" onclick="confirmImport('transactions')" style="background:#10B981;color:white;">✅ Import Now</button>
        </div>
      </div>
    </div>

    <!-- Step 5: Done -->
    <div class="import-step" id="itx-step5">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="itx-done-title">Import Complete!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="itx-done-sub"></div>
        <button class="import-btn" onclick="resetImportStep('transactions')">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── GIVEN TO OTHERS ── -->
  <div class="import-section" id="isec-given">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="igiv-step1">
      <div class="import-card">
        <div class="import-card-title">🤝 Given to Others — Upload</div>
        <div class="import-card-sub">Expected columns: Date, Category (person name), Amount, Description.</div>
        <div class="import-drop-zone" onclick="document.getElementById('igiven-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'given')">
          <div class="import-drop-icon">🤝</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="igiven-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'given')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="igiv-step2">
      <div class="import-card">
        <div class="import-card-title">🤝 Preview & Confirm</div>
        <div id="igiven-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="igiven-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetGivenImport()">← Back</button>
          <button class="import-btn" onclick="confirmGivenImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="igiv-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="igiv-done-title">Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="igiv-done-sub"></div>
        <button class="import-btn" onclick="resetGivenImport()">Import Another File</button>
      </div>
    </div>

    <!-- Ledger view (always visible) -->
    <div class="import-card" id="given-ledger-card">
      <div class="import-card-title">Outstanding Balances</div>
      <div id="given-ledger-list"></div>
    </div>
  </div>

  <!-- ── METALS ── -->
  <div class="import-section" id="isec-metals">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="imet-step1">
      <div class="import-card">
        <div class="import-card-title">🥇 Precious Metals — Upload</div>
        <div class="import-card-sub">Upload your metals file. Expected columns: Metal/Type, Purity, Occasion, Item/Name, Weight (grams or oz), Date.</div>
        <div class="import-drop-zone" onclick="document.getElementById('imetals-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'metals')">
          <div class="import-drop-icon">🥇</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="imetals-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'metals')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="imet-step2">
      <div class="import-card">
        <div class="import-card-title">🥇 Preview & Confirm</div>
        <div id="imetals-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="imetals-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetMetalsImport()">← Back</button>
          <button class="import-btn" onclick="confirmMetalsImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="imet-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="imet-done-title">Metals Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="imet-done-sub"></div>
        <button class="import-btn" onclick="resetMetalsImport()">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── REAL ESTATE ── -->
  <div class="import-section" id="isec-realestate">
    <!-- Step 1: Upload -->
    <div class="import-step active" id="ire-step1">
      <div class="import-card">
        <div class="import-card-title">🏡 Real Estate — Upload</div>
        <div class="import-card-sub">Expected columns: Date, Country, Currency, Purchase Value, Description, Area, Current Value.</div>
        <div class="import-drop-zone" onclick="document.getElementById('ire-file').click()" ondragover="event.preventDefault();this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleImportDrop(event,'realestate')">
          <div class="import-drop-icon">🏡</div>
          <div class="import-drop-text">Tap to choose file</div>
          <div class="import-drop-sub">Excel (.xlsx) or CSV</div>
        </div>
        <input type="file" id="ire-file" accept=".xlsx,.csv" style="display:none;" onchange="handleImportFile(this,'realestate')">
      </div>
    </div>
    <!-- Step 2: Preview & Confirm -->
    <div class="import-step" id="ire-step2">
      <div class="import-card">
        <div class="import-card-title">🏡 Preview & Confirm</div>
        <div id="ire-preview-table-wrap" style="overflow-x:auto;margin-bottom:12px;"></div>
        <div id="ire-summary" style="margin-bottom:12px;"></div>
        <div style="display:flex;gap:8px;">
          <button class="import-btn secondary" onclick="resetREImport()">← Back</button>
          <button class="import-btn" onclick="confirmREImport()" style="background:#10B981;color:white;">✅ Confirm Import</button>
        </div>
      </div>
    </div>
    <!-- Step 3: Done -->
    <div class="import-step" id="ire-step3">
      <div class="import-card" style="text-align:center;padding:32px 20px;">
        <div style="font-size:3em;margin-bottom:12px;">🎉</div>
        <div style="font-weight:900;font-size:1.1em;color:var(--text-dark);margin-bottom:6px;" id="ire-done-title">Properties Imported!</div>
        <div style="font-size:0.85em;color:var(--text-light);font-weight:600;margin-bottom:20px;" id="ire-done-sub"></div>
        <button class="import-btn" onclick="resetREImport()">Import Another File</button>
      </div>
    </div>
  </div>

  <!-- ── RESET ── -->
  <div class="import-section" id="isec-reset">

    <!-- Delete by month -->
    <div class="import-card">
      <div class="import-card-title">📅 Delete Month Data</div>
      <div class="import-card-sub">Remove all transactions for a specific month. Useful for clearing test data or a bad import — without wiping everything.</div>
      <div id="months-list" style="margin-top:4px;"></div>
    </div>

    <!-- What's stored summary -->
    <div class="import-card">
      <div class="import-card-title">📊 What's Currently Stored</div>
      <div id="reset-data-summary"></div>
    </div>

    <!-- Clear individual datasets -->
    <div class="import-card">
      <div class="import-card-title">🧹 Clear Specific Data</div>
      <div class="import-card-sub">Remove only one type of imported data — your transactions stay safe.</div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🥇 Metals Holdings</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-metals-count">—</div>
          </div>
          <button onclick="clearDataset('metals')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🤝 Given to Others</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-given-count">—</div>
          </div>
          <button onclick="clearDataset('given')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">🏡 Real Estate Assets</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-re-count">—</div>
          </div>
          <button onclick="clearDataset('realestate')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:#F8F8F8;border-radius:12px;">
          <div>
            <div style="font-weight:800;font-size:0.88em;">💎 Net Worth Accounts</div>
            <div style="font-size:0.75em;color:var(--text-light);font-weight:600;" id="reset-nw-count">—</div>
          </div>
          <button onclick="clearDataset('networth')" style="background:#FFF0F0;border:none;border-radius:9px;padding:7px 14px;font-weight:800;font-size:0.78em;color:var(--expenses);cursor:pointer;flex-shrink:0;">Clear All</button>
        </div>
      </div>
    </div>

    <!-- Nuclear option -->
    <div class="import-card" style="border:1.5px solid #FFDDDD;">
      <div class="import-card-title" style="color:var(--expenses);">⚠️ Reset All Data</div>
      <div class="import-card-sub">Permanently deletes ALL transactions, investments, metals, real estate, budgets and snapshots. Cannot be undone. Use only to start completely fresh.</div>
      <button class="import-btn danger" onclick="confirmResetAll()">🗑️ Delete Everything & Start Fresh</button>
    </div>

  </div>
</div>

<!-- EDIT BUDGET POPUP (bottom sheet) -->
<div class="edit-budget-popup" id="edit-budget-popup">
  <div class="popup-backdrop" onclick="closeEditBudgetPopup()"></div>
  <div class="edit-budget-sheet">
    <div class="ebp-handle"></div>
    <div class="ebp-title" id="ebp-title">📋 Budget Settings</div>
    <div class="ebp-emoji-row" id="ebp-emoji-row"></div>
    <div class="ebp-field">
      <label>Category Name</label>
      <input type="text" id="ebp-name" placeholder="e.g. Groceries, Pottery Class">
    </div>
    <div class="ebp-field">
      <label>Type</label>
      <select id="ebp-type">
        <option value="expense">💸 Expense Budget</option>
        <option value="savings">💰 Savings Goal</option>
      </select>
    </div>
    <div class="ebp-field">
      <label>Monthly Budget / Goal Amount ($)</label>
      <input type="number" id="ebp-amount" placeholder="0.00" step="0.01" min="0">
    </div>
    <div class="ebp-field" id="ebp-linked-cats-field">
      <label id="ebp-linked-cats-label">Linked Transaction Categories</label>
      <div id="ebp-linked-cats-hint" style="font-size:0.72em;color:var(--text-light);font-weight:600;margin-bottom:6px;"></div>
      <!-- Selected chips -->
      <div id="ebp-linked-chips" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px;min-height:0;"></div>
      <!-- Search input -->
      <div style="position:relative;">
        <input type="text" id="ebp-linked-search"
          placeholder="Type to search categories..."
          autocomplete="off"
          oninput="filterLinkedCatSuggestions(this.value)"
          onfocus="filterLinkedCatSuggestions(this.value)"
          style="width:100%;background:#F8F8F8;border:1.5px solid #EEE;border-radius:10px;padding:10px 12px;font-family:inherit;font-weight:700;font-size:0.88em;color:var(--text-dark);outline:none;box-sizing:border-box;">
        <!-- Suggestions dropdown -->
        <div id="ebp-linked-suggestions" style="
          display:none;position:absolute;top:100%;left:0;right:0;z-index:999;
          background:white;border:1.5px solid #EEE;border-radius:10px;
          box-shadow:0 8px 24px rgba(0,0,0,0.1);max-height:180px;overflow-y:auto;margin-top:4px;
        "></div>
      </div>
      <!-- Hidden input carries the actual comma-separated value for save logic -->
      <input type="hidden" id="ebp-linked-cats">
    </div>
    <div class="ebp-actions">
      <button class="ebp-save-btn" onclick="saveEditedBudget()">✅ Save</button>
      <button class="ebp-del-btn" id="ebp-del-btn" onclick="deleteEditedBudget()" style="display:none;">🗑️</button>
    </div>
  </div>
</div>

<!-- ══ MODALS ══ -->
<div class="modal-overlay" id="add-account-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Add Account</div>
      <button class="modal-close" onclick="closeModal('add-account-modal')">✕</button>
    </div>
    <div class="add-form">
      <div class="form-row"><span class="form-label">Name</span><input type="text" class="form-input" id="acc-name-input" placeholder="Account name"></div>
      <div class="form-row"><span class="form-label">Type</span><select class="form-select" id="acc-type-input"><option>Debit</option><option>Credit</option><option>Cash</option><option>Investment</option></select></div>
      <div class="form-row" style="border-bottom:none;"><span class="form-label">Balance</span><input type="number" class="form-input" id="acc-balance-input" placeholder="0"></div>
    </div>
    <button onclick="saveAccount()" style="width:100%;background:var(--yellow);border:none;border-radius:var(--radius-sm);padding:16px;font-family:Nunito;font-weight:900;color:var(--text-dark);cursor:pointer;margin-top:8px;">Save Account</button>
  </div>
</div>

<!-- QUICK ADD POPUP (for home screen category icons) -->
<div class="modal-overlay" id="quick-add-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="qa-modal-title">➕ Quick Add</div>
      <button class="modal-close" onclick="closeModal('quick-add-modal')">✕</button>
    </div>
    <!-- Type selector -->
    <div class="qa-type-row" id="qa-type-row">
      <div class="qa-type-chip active" onclick="qaSetType('expense',this)">💸 Expense</div>
      <div class="qa-type-chip" onclick="qaSetType('income',this)">💵 Income</div>
      <div class="qa-type-chip" onclick="qaSetType('investment',this)">📈 Investment</div>
      <div class="qa-type-chip" onclick="qaSetType('debt',this)">📉 Debt</div>
      <div class="qa-type-chip" onclick="qaSetType('given',this)">🤝 Given</div>
      <div class="qa-type-chip" onclick="qaSetType('additional',this)">🎁 Additional</div>
    </div>
    <!-- Amount display -->
    <div class="qa-amount-row">
      <span class="qa-currency-sym">$</span>
      <input type="text" class="qa-amount-input" id="qa-amount-display" value="0" readonly>
    </div>
    <!-- Sub-category pills -->
    <div class="qa-sub-cats" id="qa-sub-cats"></div>
    <!-- Fields -->
    <div class="qa-fields-row">
      <div class="qa-field">
        <label>Date</label>
        <input type="date" id="qa-date-input">
      </div>
      <div class="qa-field">
        <label>Note</label>
        <input type="text" id="qa-note-input" placeholder="Optional note...">
      </div>
    </div>
    <!-- Metal extra fields — only shown when investment category is a metal -->
    <div id="qa-metal-fields" style="display:none;">
      <div style="background:linear-gradient(135deg,#FFF8E1,#FFF3C4);border-radius:14px;padding:12px 14px;margin:0 0 10px;">
        <div style="font-size:0.72em;font-weight:900;color:#A07800;text-transform:uppercase;letter-spacing:0.4px;margin-bottom:10px;">🥇 Metal Purchase Details</div>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">WEIGHT</div>
            <input type="number" id="qa-metal-grams" placeholder="1.0" step="0.001" min="0"
              style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 10px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
          </div>
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">UNIT</div>
            <select id="qa-metal-unit" style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 6px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
              <option value="g">grams</option>
              <option value="oz">oz</option>
            </select>
          </div>
          <div>
            <div style="font-size:0.68em;font-weight:800;color:var(--text-light);margin-bottom:4px;">TYPE</div>
            <select id="qa-metal-type" style="width:100%;background:var(--white);border:1.5px solid #E8E8E8;border-radius:9px;padding:8px 6px;font-family:Nunito,sans-serif;font-weight:800;font-size:0.9em;outline:none;">
              <option value="gold">Gold</option>
              <option value="silver">Silver</option>
              <option value="platinum">Platinum</option>
            </select>
          </div>
        </div>
        <div style="font-size:0.68em;color:#A07800;font-weight:700;margin-top:8px;line-height:1.5;">
          💡 Records <strong>this month's purchase</strong> for budget tracking. Your total holdings in Net Worth are separate — update them there when you want a snapshot.
        </div>
      </div>
    </div>
    <!-- Numpad -->
    <div class="qa-numpad" id="qa-numpad"></div>
  </div>
</div>

<!-- ══ INVESTMENT QUICK-ADD MODAL ══ -->
<div class="modal-overlay" id="inv-quick-modal">
  <div class="modal" style="max-height:90vh;overflow-y:auto;">
    <div class="modal-header">
      <div class="modal-title" id="inv-modal-title">📈 Add Investment</div>
      <button class="modal-close" onclick="closeModal('inv-quick-modal')">✕</button>
    </div>
    <!-- Type tabs -->
    <div class="inv-type-tabs" id="inv-type-tabs">
      <button class="inv-type-chip active" style="background:#4A9EFF;color:white;" onclick="setInvModalType('Stocks','Stocks',this,'#4A9EFF')">📊 Stocks</button>
      <button class="inv-type-chip" onclick="setInvModalType('Crypto','Crypto',this,'#F59E0B')">🪙 Crypto</button>
      <button class="inv-type-chip" onclick="setInvModalType('Metals','Metals',this,'#C8900A')">🥇 Metals</button>
      <button class="inv-type-chip" onclick="setInvModalType('Real Estate','Real Estate',this,'#10B981')">🏡 Real Estate</button>
      <button class="inv-type-chip" onclick="setInvModalType('ETF/MF','ETF/MF',this,'#7C3AED')">🗂 ETF / MF</button>
    </div>
    <!-- Dynamic fields -->
    <div id="inv-modal-fields"></div>
    <!-- Auto-computed total -->
    <div class="inv-total-pill" id="inv-total-pill" style="display:none;">
      <span class="inv-total-pill-label" id="inv-total-pill-label">💰 Computed Total Value</span>
      <span class="inv-total-pill-val" id="inv-computed-total">$0</span>
    </div>
    <!-- Date + Currency row -->
    <div class="inv-fields-grid" style="margin-bottom:14px;">
      <div class="inv-field-box">
        <label>📅 Date</label>
        <input type="date" class="inv-field-input" id="inv-modal-date">
      </div>
      <div class="inv-field-box">
        <label>🌍 Currency</label>
        <button onclick="openCurrencyPicker('inv')" class="inv-field-input" style="text-align:left;cursor:pointer;display:flex;align-items:center;gap:6px;" id="inv-curr-btn">
          <span id="inv-curr-flag">🇺🇸</span><span id="inv-curr-label">USD — $</span>
        </button>
      </div>
    </div>
    <!-- Note -->
    <div class="inv-field-box full" style="margin-bottom:16px;">
      <label>📝 Notes</label>
      <input type="text" class="inv-field-input" id="inv-modal-note" placeholder="Optional notes...">
    </div>
    <button class="inv-save-btn" onclick="saveInvEntry()">✅ Save Investment</button>
  </div>
</div>

<!-- ══ CURRENCY PICKER MODAL ══ -->
<div class="modal-overlay" id="currency-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">🌍 Select Currency</div>
      <button class="modal-close" onclick="closeModal('currency-modal')">✕</button>
    </div>
    <input type="text" class="curr-search" id="curr-search-input" placeholder="Search country or currency..." oninput="filterCurrencies(this.value)">
    <div class="curr-list" id="curr-list"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- Sync status bar -->
<div id="sync-status-bar" style="
  display:none;position:fixed;top:0;left:0;right:0;z-index:200;
  padding:4px 16px;font-size:0.72em;font-weight:700;
  text-align:center;transition:all 0.3s;
" id="sync-bar"></div>

<datalist id="catlist"></datalist>

<script>
// MoneyFi — Protected Application Code
// © 2026 MoneyFi. All rights reserved.
(function(){
try {
var _d=['Ci8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBTVEFURQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKY29uc3QgU1RPUkFHRV9LRVkgPSAnZmluYW5jZURhdGEnOwpsZXQgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9LRVkpKSB8fCB7fTsKLy8gUmVzdG9yZSBjdXN0b20gTlcgdHlwZXMgaW50byBydW50aW1lIE5XX1RZUEVTIG9iamVjdApzZXRUaW1lb3V0KCgpID0+IHsKICAoZGF0YS5fbndDdXN0b21UeXBlcyB8fCBbXSkuZm9yRWFjaChjID0+IHsKICAgIE5XX1RZUEVTW2Mua2V5XSA9IHsgbGFiZWw6IGMubGFiZWwsIGVtb2ppOiBjLmVtb2ppIHx8ICfwn4+mJywgY29sb3I6ICcjNkI3MjgwJywgaXNMaWFiOiBjLmlzTGlhYiB8fCBmYWxzZSB9OwogIH0pOwp9LCAwKTsKbGV0IGN1cnJlbnRBZGRUeXBlID0gJ2V4cGVuc2UnOwpsZXQgY3VycmVudEFtb3VudFN0ciA9ICcnOwpsZXQgc2VsZWN0ZWRTdWJDYXQgPSAnJzsKbGV0IHZpZXdNb250aCA9IGdldEN1cnJlbnRNb250aEtleSgpOwpsZXQgY3VycmVudFBlcmlvZCA9ICdtb250aCc7CmxldCBzZWxlY3RlZERheSA9IG51bGw7CmxldCBjaGFydHMgPSB7fTsKbGV0IGN1cnJlbnRNZXRhbCA9ICdnb2xkJzsKbGV0IGFkZFBhbmVsT3BlbiA9IGZhbHNlOwpsZXQgY3VycmVudEludmVzdEZpbHRlciA9ICdBbGwnOwpsZXQgdHhGaWx0ZXIgPSAnYWxsJzsKbGV0IGRhdGFTb3J0U3RhdGUgPSB7fTsKbGV0IHFhVHlwZSA9ICdleHBlbnNlJzsKbGV0IHFhQW1vdW50U3RyID0gJyc7CmxldCBxYVN1YkNhdCA9ICcnOwpsZXQgcWFQcmVzZWxlY3RUeXBlID0gbnVsbDsKbGV0IHFhUHJlc2VsZWN0U3ViQ2F0ID0gbnVsbDsKbGV0IGN1cnJlbnRUaGVtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtZl90aGVtZScpIHx8ICdkZWZhdWx0JzsKLy8gSG9tZSB0YWIgc3RhdGUKbGV0IGhvbWVUYWIgPSAnc3BlbmRpbmcnOwovLyBJbnZlc3RtZW50IG1vZGFsIHN0YXRlCmxldCBpbnZNb2RhbFR5cGUgPSAnU3RvY2tzJzsKbGV0IGludk1vZGFsVGVtcGxhdGUgPSAnU3RvY2tzJzsKbGV0IGludkN1cnJlbmN5VGFyZ2V0ID0gJ2ludic7IC8vIHdoaWNoIGNvbnRleHQgb3BlbmVkIGN1cnJlbmN5IHBpY2tlcgovLyBDdXJyZW5jeSBzdGF0ZSDigJQgcGVyc2lzdGVkIHNlcGFyYXRlbHkgZm9yIGZhc3QgaW5pdApsZXQgY3VycmVudEN1cnJlbmN5ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWZfY3VycmVuY3knKSB8fCAnbnVsbCcpIHx8IHtjb2RlOidVU0QnLHN5bWJvbDonJCcsbmFtZTonVVMgRG9sbGFyJyxmbGFnOifwn4e68J+HuCcsY291bnRyeTonVW5pdGVkIFN0YXRlcyd9OwoKZnVuY3Rpb24gc2F2ZUN1cnJlbmN5KGMpIHsKICBjdXJyZW50Q3VycmVuY3kgPSBjOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtZl9jdXJyZW5jeScsIEpTT04uc3RyaW5naWZ5KGMpKTsKICAvLyBQZXJzaXN0IGN1cnJlbmN5IHByZWZlcmVuY2UgaW4gRmlyZWJhc2UgdG9vCiAgaWYgKHdpbmRvdy5fZmJVc2VyICYmIHdpbmRvdy5fZmJEYikgewogICAgY29uc3QgdWlkID0gd2luZG93Ll9mYlVzZXIudWlkOwogICAgd2luZG93Ll9mYkRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZG9jKHVpZCkKICAgICAgLnNldCh7IGN1cnJlbmN5OiBjIH0sIHsgbWVyZ2U6IHRydWUgfSkKICAgICAgLmNhdGNoKGUgPT4gY29uc29sZS53YXJuKCdDdXJyZW5jeSBzeW5jIGZhaWxlZDonLCBlKSk7CiAgfQp9CmZ1bmN0aW9uIHN5bSgpIHsgcmV0dXJuIGN1cnJlbnRDdXJyZW5jeS5zeW1ib2w7IH0KCi8vIOKUgOKUgCBBcHByb3hpbWF0ZSBGWCByYXRlcyByZWxhdGl2ZSB0byBVU0QgKHVwZGF0ZWQgcGVyaW9kaWNhbGx5IGJ5IHVzZXIgdmlhIFNldHRpbmdzIGlmIG5lZWRlZCkKLy8gVmFsdWVzID0gMSBVU0Qg4oaSIE4gdW5pdHMgb2YgdGhhdCBjdXJyZW5jeQpjb25zdCBGWF9VU0RfQkFTRSA9IHsKICBVU0Q6MSwgRVVSOjAuOTIsIEdCUDowLjc5LCBJTlI6ODMuNSwgQUVEOjMuNjcsIFNBUjozLjc1LAogIENBRDoxLjM2LCBBVUQ6MS41MywgSlBZOjE0OSwgQ05ZOjcuMjQsIFNHRDoxLjM0LCBDSEY6MC44OSwKICBNWVI6NC43MiwgSEtEOjcuODIsIE5aRDoxLjYzLCBLV0Q6MC4zMSwgUUFSOjMuNjQsIE9NUjowLjM4LAogIFBLUjoyNzgsIEJEVDoxMTAsIExLUjozMTAsIE5QUjoxMzMsIE1YTjoxNy4xLCBCUkw6NC45NywKICBaQVI6MTguNiwgTkdOOjE1NTAsIEtFUzoxMjksIEVHUDo0OC41LCBUUlk6MzIuMiwgUlVCOjkxLAogIFNFSzoxMC40LCBOT0s6MTAuNiwgREtLOjYuODgsIElEUjoxNTcwMCwgUEhQOjU1LjgsIFRIQjozNSwKICBWTkQ6MjQ1MDAsIEtSVzoxMzIwLAp9OwoKLy8gQ29udmVydCBhbiBhbW91bnQgZnJvbSBlbnRyeUN1cnJlbmN5IHRvIGRpc3BsYXlDdXJyZW5jeQpmdW5jdGlvbiBjb252ZXJ0QW10KGFtb3VudCwgZW50cnlDdXJyZW5jeUNvZGUpIHsKICBpZighZW50cnlDdXJyZW5jeUNvZGUgfHwgZW50cnlDdXJyZW5jeUNvZGUgPT09IGN1cnJlbnRDdXJyZW5jeS5jb2RlKSByZXR1cm4gTnVtYmVyKGFtb3VudHx8MCk7CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fZnhPdmVycmlkZXMgfHwge307CiAgY29uc3QgZnJvbVJhdGUgPSBvdmVycmlkZXNbZW50cnlDdXJyZW5jeUNvZGVdID8/IEZYX1VTRF9CQVNFW2VudHJ5Q3VycmVuY3lDb2RlXSA/PyAxOyAgIC8vIDEgVVNEIOKGkiBOIGVudHJ5IHVuaXRzCiAgY29uc3QgdG9SYXRlICAgPSBvdmVycmlkZXNbY3VycmVudEN1cnJlbmN5LmNvZGVdID8/IEZYX1VTRF9CQVNFW2N1cnJlbnRDdXJyZW5jeS5jb2RlXSA/PyAxOyAvLyAxIFVTRCDihpIgTiBkaXNwbGF5IHVuaXRzCiAgLy8gYW1vdW50IC8gZnJvbVJhdGUgPSBVU0QgdmFsdWUg4oaSICogdG9SYXRlID0gZGlzcGxheSB2YWx1ZQogIHJldHVybiAoTnVtYmVyKGFtb3VudHx8MCkgLyBmcm9tUmF0ZSkgKiB0b1JhdGU7Cn0KCi8vIFdyYXBwZXI6IGZvcm1hdCBhbiBhbW91bnQgcmVzcGVjdGluZyBpdHMgc3RvcmVkIGN1cnJlbmN5CmZ1bmN0aW9uIGZtdENvbnZlcnRlZChhbW91bnQsIGVudHJ5Q3VycmVuY3lDb2RlKSB7CiAgcmV0dXJuIHN5bSgpICsgTWF0aC5hYnMoY29udmVydEFtdChhbW91bnQsIGVudHJ5Q3VycmVuY3lDb2RlKSkudG9Mb2NhbGVTdHJpbmcodW5kZWZpbmVkLHttaW5pbXVtRnJhY3Rpb25EaWdpdHM6MCxtYXhpbXVtRnJhY3Rpb25EaWdpdHM6MH0pOwp9CmZ1bmN0aW9uIGZtdENvbnZlcnRlZEZ1bGwoYW1vdW50LCBlbnRyeUN1cnJlbmN5Q29kZSkgewogIHJldHVybiBzeW0oKSArIE1hdGguYWJzKGNvbnZlcnRBbXQoYW1vdW50LCBlbnRyeUN1cnJlbmN5Q29kZSkpLnRvTG9jYWxlU3RyaW5nKHVuZGVmaW5lZCx7bWluaW11bUZyYWN0aW9uRGlnaXRzOjIsbWF4aW11bUZyYWN0aW9uRGlnaXRzOjJ9KTsKfQoKY29uc3QgY29tbW9uQ2F0ZWdvcmllcyA9IFsKICAnS1AtUEMxJywnS1AtUEMyJywnU0stUEMxJywnU0stUEMyJywnU0stUEMzJywnUEtELVNIT1BTJywKICAnR3JvY2VyaWVzJywnRmFzdEZvb2QnLCdHYXMnLCdVdGlsaXR5JywnVC1Nb2JpbGUnLCdJbnN1cmFuY2UnLAogICdPbmVHb2xkJywnT25lU2lsdmVyJywnRmlkZWxpdHknLCdSb2Jpbmhvb2QnLCdXZWJ1bGwnLCdNRicsCiAgJ1BhcmVudHMnLCdIZWFsdGggQ2FyZScsJ0VudGVydGFpbm1lbnQnLCdBdXRvJywnR2lmdHMnLCdSZXR1cm4nLCdSZWZ1bmQnLCdDcmVkaXQnCl07CmNvbnN0IGNhdExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2F0bGlzdCcpOwpjb21tb25DYXRlZ29yaWVzLmZvckVhY2goYyA9PiB7IGNvbnN0IG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsgby52YWx1ZSA9IGM7IGNhdExpc3QuYXBwZW5kQ2hpbGQobyk7IH0pOwoKLy8gU3BlbmRpbmcgY2F0ZWdvcmllcyBvbiBob21lIChubyBEZWJ0LCBubyBJbnZlc3RtZW50KQpjb25zdCBERUZBVUxUX1NQRU5EX0NBUkRTID0gWwogIHsga2V5Oidmb29kJywgICAgICAgbGFiZWw6J0Zvb2QgJiBEcmluaycsICAgIGljb246J/CfjZQnLCBjb2xvcjonI0ZGNkIzNScsIGNsczonZm9vZCcsICAgICAgIHN1YmNhdHM6WydCcmVha2Zhc3QnLCdMdW5jaCcsJ0Rpbm5lcicsJ1NuYWNrcycsJ0NvZmZlZScsJ0dyb2NlcmllcycsJ0Zhc3RGb29kJ10gfSwKICB7IGtleTondHJhbnNwb3J0JywgIGxhYmVsOidUcmFuc3BvcnRhdGlvbicsICBpY29uOifwn5qMJywgY29sb3I6JyM0QTlFRkYnLCBjbHM6J3RyYW5zcG9ydCcsICBzdWJjYXRzOlsnVHJhbnNwb3J0JywnVWJlcicsJ0dhcycsJ0F1dG8nXSB9LAogIHsga2V5Oidob3VzaW5nJywgICAgbGFiZWw6J0hvdXNpbmcnLCAgICAgICAgIGljb246J/Cfj6AnLCBjb2xvcjonI0ZGOEM0MicsIGNsczonaG91c2luZycsICAgIHN1YmNhdHM6WydFbGVjdHJpYycsJ0ludGVybmV0JywnVXRpbGl0eScsJ1JlbnQnLCdNb3J0Z2FnZSddIH0sCiAgeyBrZXk6J2hlYWx0aCcsICAgICBsYWJlbDonSGVhbHRoJywgICAgICAgICAgaWNvbjon8J+SiicsIGNvbG9yOicjNEVDREM0JywgY2xzOidoZWFsdGgnLCAgICAgc3ViY2F0czpbJ0hlYWx0aCcsJ0RlbnRhbCcsJ01lZGljaW5lJywnRG9jdG9yJ10gfSwKICB7IGtleTonc2hvcHBpbmcnLCAgIGxhYmVsOidTaG9wcGluZycsICAgICAgICBpY29uOifwn5uN77iPJywgY29sb3I6JyNGRjQ3NTcnLCBjbHM6J3Nob3BwaW5nJywgICBzdWJjYXRzOlsnU2hvcHBpbmcnLCdDbG90aGluZycsJ0Nvc21ldGljcycsJ0VsZWN0cm9uaWNzJ10gfSwKICB7IGtleTonZ3JvY2VyaWVzJywgIGxhYmVsOidHcm9jZXJpZXMnLCAgICAgICBpY29uOifwn5uSJywgY29sb3I6JyMxMEI5ODEnLCBjbHM6J2ludmVzdCcsICAgICBzdWJjYXRzOlsnR3JvY2VyaWVzJywnU3VwZXJtYXJrZXQnLCdWZWdldGFibGVzJywnRnJ1aXRzJ10gfSwKICB7IGtleTonZ2l2aW5nJywgICAgIGxhYmVsOidHaXZpbmcnLCAgICAgICAgICBpY29uOifinaTvuI8nLCBjb2xvcjonI0ZGNkI5RCcsIGNsczonZ2l2aW5nJywgICAgIHN1YmNhdHM6WydQYXJlbnRzJywnRmFtaWx5JywnRnJpZW5kJywnQ2hhcml0eSddIH0sCiAgeyBrZXk6J290aGVyJywgICAgICBsYWJlbDonQWRkaXRpb25hbCcsICAgICAgaWNvbjon8J+OgScsIGNvbG9yOicjNjRCNUY2JywgY2xzOidvdGhlci1jYXQnLCAgc3ViY2F0czpbJ0VudGVydGFpbm1lbnQnLCdUcmF2ZWwnLCdJbnN1cmFuY2UnLCdPdGhlciddIH0sCl07CgpmdW5jdGlvbiBnZXRIb21lU3BlbmRDYXJkcygpIHsKICBpZighZGF0YS5faG9tZVNwZW5kQ2FyZHMpIHJldHVybiBERUZBVUxUX1NQRU5EX0NBUkRTLm1hcChjPT4oey4uLmMsdmlzaWJsZTp0cnVlfSkpOwogIHJldHVybiBkYXRhLl9ob21lU3BlbmRDYXJkczsKfQpmdW5jdGlvbiBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpIHsgZGF0YS5faG9tZVNwZW5kQ2FyZHM9Y2FyZHM7IHNhdmUoKTsgfQoKLy8gTWFpbnRhaW4gYmFja3dhcmRzLWNvbXBhdGlibGUgc3BlbmRDYXRDb25maWcKY29uc3Qgc3BlbmRDYXRDb25maWcgPSBERUZBVUxUX1NQRU5EX0NBUkRTOwpjb25zdCBjYXRDb25maWcgPSBbCiAgLi4uREVGQVVMVF9TUEVORF9DQVJEUywKICB7IGtleTonaW52ZXN0JywgbGFiZWw6J0ludmVzdG1lbnQnLCBpY29uOifwn5OIJywgY2xzOidpbnZlc3QnLCBjb2xvcjonIzdCREE4RicgfSwKICB7IGtleTonZGVidCcsICAgbGFiZWw6J0RlYnQnLCAgICAgICBpY29uOifwn5OJJywgY2xzOidkZWJ0LWNhdCcs','IGNvbG9yOicjOEI1Q0Y2JyB9LApdOwoKY29uc3QgREVGQVVMVF9DQVRTID0gewogIGV4cGVuc2U6ICAgIFsnQnJlYWtmYXN0JywnTHVuY2gnLCdEaW5uZXInLCdTbmFja3MnLCdDb2ZmZWUnLCdHcm9jZXJpZXMnLCdGYXN0Rm9vZCcsJ1RyYW5zcG9ydCcsJ1ViZXInLCdHYXMnLCdIZWFsdGgnLCdEZW50YWwnLCdTaG9wcGluZycsJ0Nsb3RoaW5nJywnQ29zbWV0aWNzJywnRWxlY3RyaWMnLCdVdGlsaXR5JywnUGhvbmUnLCdJbnRlcm5ldCddLAogIGluY29tZTogICAgIFsnU2FsYXJ5JywnRnJlZWxhbmNlJywnQm9udXMnLCdJbnRlcmVzdCcsJ0RpdmlkZW5kJywnR2lmdCcsJ1JldHVybicsJ1JlZnVuZCcsJ090aGVyJ10sCiAgaW52ZXN0bWVudDogWydTdG9ja3MnLCdFVEYnLCdDcnlwdG8nLCdHb2xkJywnU2lsdmVyJywnUmVhbCBFc3RhdGUnLCc0MDFrJywnSVJBJywnTXV0dWFsIEZ1bmQnLCdPdGhlciddLAogIGRlYnQ6ICAgICAgIFsnQ3JlZGl0IENhcmQnLCdMb2FuJywnTW9ydGdhZ2UnLCdNZWRpY2FsJywnT3RoZXInXSwKICBnaXZlbjogICAgICBbJ1BhcmVudHMnLCdGYW1pbHknLCdGcmllbmQnLCdDaGFyaXR5JywnT3RoZXInXSwKICBhZGRpdGlvbmFsOiBbJ0VudGVydGFpbm1lbnQnLCdUcmF2ZWwnLCdBdXRvJywnSW5zdXJhbmNlJywnU3Vic2NyaXB0aW9uJywnT3RoZXInXQp9OwoKZnVuY3Rpb24gZ2V0Q3VzdG9tQ2F0cygpIHsKICBpZiAoIWRhdGEuX2N1c3RvbUNhdHMpIGRhdGEuX2N1c3RvbUNhdHMgPSB7fTsKICByZXR1cm4gZGF0YS5fY3VzdG9tQ2F0czsKfQoKZnVuY3Rpb24gZ2V0Q2F0c0ZvclR5cGUodHlwZSkgewogIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogIC8vIElmIHVzZXIgaGFzIGV2ZXIgY3VzdG9taXplZCB0aGlzIHR5cGUsIHVzZSB0aGVpciBsaXN0OyBvdGhlcndpc2UgZGVmYXVsdHMKICByZXR1cm4gKGNjW3R5cGVdICYmIGNjW3R5cGVdLmxlbmd0aCA+IDApID8gY2NbdHlwZV0gOiAoREVGQVVMVF9DQVRTW3R5cGVdIHx8IFtdKTsKfQoKY29uc3Qgc3ViQ2F0c0J5VHlwZSA9IG5ldyBQcm94eSh7fSwgewogIGdldChfLCB0eXBlKSB7IHJldHVybiBnZXRDYXRzRm9yVHlwZSh0eXBlKTsgfQp9KTsKCi8vIOKUgOKUgCBDYXRlZ29yeSBNYW5hZ2VyIHN0YXRlCmxldCBjYXRNZ3JUeXBlID0gJ2V4cGVuc2UnOwoKZnVuY3Rpb24gc2hvd0NhdE1nclRhYih0eXBlLCBidG4pIHsKICBjYXRNZ3JUeXBlID0gdHlwZTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2F0LW1nci10YWInKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHJlbmRlckNhdFBpbGxzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNhdFBpbGxzKCkgewogIGNvbnN0IGNhdHMgPSBnZXRDYXRzRm9yVHlwZShjYXRNZ3JUeXBlKTsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdC1waWxscy13cmFwJyk7CiAgaWYgKCF3cmFwKSByZXR1cm47CiAgd3JhcC5pbm5lckhUTUwgPSBjYXRzLm1hcCgoYywgaSkgPT4gYAogICAgPGRpdiBjbGFzcz0iY2F0LXBpbGwiPgogICAgICA8c3Bhbj4ke2N9PC9zcGFuPgogICAgICA8YnV0dG9uIGNsYXNzPSJjYXQtcGlsbC1kZWwiIG9uY2xpY2s9InJlbW92ZUN1c3RvbUNhdCgke2l9KSIgdGl0bGU9IlJlbW92ZSI+4pyVPC9idXR0b24+CiAgICA8L2Rpdj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gYWRkQ3VzdG9tQ2F0KCkgewogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhdC1hZGQtaW5wdXQnKTsKICBjb25zdCBuYW1lID0gKGlucHV0LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgaWYgKCFuYW1lKSB7IHNob3dUb2FzdCgnRW50ZXIgYSBjYXRlZ29yeSBuYW1lIOKdjCcpOyByZXR1cm47IH0KICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICAvLyBJbml0aWFsaXplIGZyb20gZGVmYXVsdHMgaWYgbm90IHlldCBjdXN0b21pemVkCiAgaWYgKCFjY1tjYXRNZ3JUeXBlXSkgY2NbY2F0TWdyVHlwZV0gPSBbLi4uKERFRkFVTFRfQ0FUU1tjYXRNZ3JUeXBlXSB8fCBbXSldOwogIGlmIChjY1tjYXRNZ3JUeXBlXS5pbmNsdWRlcyhuYW1lKSkgeyBzaG93VG9hc3QoJ0NhdGVnb3J5IGFscmVhZHkgZXhpc3RzIOKaoO+4jycpOyByZXR1cm47IH0KICBjY1tjYXRNZ3JUeXBlXS5wdXNoKG5hbWUpOwogIHNhdmUoKTsKICBpbnB1dC52YWx1ZSA9ICcnOwogIHJlbmRlckNhdFBpbGxzKCk7CiAgc2hvd1RvYXN0KCfinIUgQ2F0ZWdvcnkgYWRkZWQhJyk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUN1c3RvbUNhdChpZHgpIHsKICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICBpZiAoIWNjW2NhdE1nclR5cGVdKSBjY1tjYXRNZ3JUeXBlXSA9IFsuLi4oREVGQVVMVF9DQVRTW2NhdE1nclR5cGVdIHx8IFtdKV07CiAgY29uc3QgY2F0ID0gY2NbY2F0TWdyVHlwZV1baWR4XTsKICBpZiAoIWNvbmZpcm0oYFJlbW92ZSAiJHtjYXR9IiBmcm9tICR7Y2F0TWdyVHlwZX0gY2F0ZWdvcmllcz9gKSkgcmV0dXJuOwogIGNjW2NhdE1nclR5cGVdLnNwbGljZShpZHgsIDEpOwogIHNhdmUoKTsKICByZW5kZXJDYXRQaWxscygpOwogIHNob3dUb2FzdCgnQ2F0ZWdvcnkgcmVtb3ZlZCcpOwp9CgovLyBQdXJpdHkgbXVsdGlwbGllcnMgKGZyYWN0aW9uIG9mIHB1cmUgbWV0YWwpCmNvbnN0IFBVUklUWV9NVUxUID0gewogIC8vIEdvbGQgKEthcmF0KQogICcyNEsnOiAxLjAsICcyM0snOiAwLjk1ODMsICcyMksnOiAwLjkxNjcsICcyMUsnOiAwLjg3NSwgJzE4Syc6IDAuNzUsCiAgJzE0Syc6IDAuNTgzMywgJzEwSyc6IDAuNDE2NywgJzlLJzogMC4zNzUsCiAgLy8gRmluZSAvIG1pbGxlc2ltYWwgKGdvbGQsIHNpbHZlciwgcGxhdGludW0gYWxsIHVzZSB0aGVzZSkKICAnOTk5JzogMS4wLCAnOTk5IEZJTkUnOiAxLjAsICc5OTkgRmluZSc6IDEuMCwKICAnOTk1JzogMC45OTUsICc5OTAnOiAwLjk5LCAnOTc1JzogMC45NzUsCiAgJzk1MCc6IDAuOTUsICc5MjUnOiAwLjkyNSwgJzkwMCc6IDAuOSwgJzg1MCc6IDAuODUsICc4MDAnOiAwLjgsCiAgLy8gU2lsdmVyLXNwZWNpZmljIGFsaWFzZXMKICAnOTk5IFNpbHZlcic6IDEuMCwgJzkyNSBTaWx2ZXInOiAwLjkyNSwgJ1N0ZXJsaW5nJzogMC45MjUsCiAgLy8gUGxhdGludW0tc3BlY2lmaWMgYWxpYXNlcwogICdQdDk5OSc6IDEuMCwgJ1B0OTUwJzogMC45NSwgJ1B0OTAwJzogMC45LCAnUHQ4NTAnOiAwLjg1LAogICc5NTAgUHQnOiAwLjk1LCAnOTAwIFB0JzogMC45LAp9OwoKLy8gTm9ybWFsaXplIHB1cml0eSBzdHJpbmcgc28gIjIyayIgbWF0Y2hlcyAiMjJLIiwgIlBUOTUwIiBtYXRjaGVzICJQdDk1MCIsIGV0Yy4KZnVuY3Rpb24gbm9ybWFsaXplUHVyaXR5KHB1cml0eSkgewogIGlmICghcHVyaXR5KSByZXR1cm4gJyc7CiAgY29uc3QgcyA9IFN0cmluZyhwdXJpdHkpLnRyaW0oKTsKICAvLyBLYXJhdDogMjJrIOKGkiAyMksKICBjb25zdCBrTWF0Y2ggPSBzLm1hdGNoKC9eKFxkKylccypba0tdJC8pOwogIGlmIChrTWF0Y2gpIHJldHVybiBrTWF0Y2hbMV0gKyAnSyc7CiAgLy8gUHQgcHJlZml4OiBQVDk1MCwgcHQ5NTAsIFB0OTUwIOKGkiBQdDk1MAogIGNvbnN0IHB0TWF0Y2ggPSBzLm1hdGNoKC9eW1BwXVtUdF1ccyooXGQrKSQvKTsKICBpZiAocHRNYXRjaCkgcmV0dXJuICdQdCcgKyBwdE1hdGNoWzFdOwogIC8vICI5NTAgUFQiIOKGkiAiOTUwIFB0IgogIGNvbnN0IHB0U3VmZml4ID0gcy5tYXRjaCgvXihcZCspXHMqW1BwXVtUdF0kLyk7CiAgaWYgKHB0U3VmZml4KSByZXR1cm4gcHRTdWZmaXhbMV0gKyAnIFB0JzsKICAvLyBOdW1lcmljIG9ubHk6IDk1MCDihpIgJzk1MCcKICBjb25zdCBudW1NYXRjaCA9IHMubWF0Y2goL14oXGQrKSQvKTsKICBpZiAobnVtTWF0Y2gpIHJldHVybiBudW1NYXRjaFsxXTsKICAvLyBUcnkgdXBwZXJjYXNlL3RpdGxlLWNhc2UgbWF0Y2gKICByZXR1cm4gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7Cn0KCmZ1bmN0aW9uIGdldFB1cml0eU11bHQocHVyaXR5KSB7CiAgaWYgKCFwdXJpdHkpIHJldHVybiAxLjA7CiAgY29uc3Qgbm9ybSA9IG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpOwogIC8vIERpcmVjdCBtYXRjaAogIGlmIChQVVJJVFlfTVVMVFtub3JtXSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gUFVSSVRZX01VTFRbbm9ybV07CiAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBmYWxsYmFjawogIGNvbnN0IHVwcGVyID0gbm9ybS50b1VwcGVyQ2FzZSgpOwogIGZvciAoY29uc3QgayBvZiBPYmplY3Qua2V5cyhQVVJJVFlfTVVMVCkpIHsKICAgIGlmIChrLnRvVXBwZXJDYXNlKCkgPT09IHVwcGVyKSByZXR1cm4gUFVSSVRZX01VTFRba107CiAgfQogIHJldHVybiBudWxsOyAvLyB1bmtub3duIHB1cml0eQp9CgpmdW5jdGlvbiBnZXRQcmljZUZvck1ldGFsKG1ldGFsVHlwZSwgcHVyaXR5KSB7CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlcyB8fCB7fTsKICBjb25zdCBiYXNlS2V5ID0gbWV0YWxUeXBlOwogIC8vIENoZWNrIGZvciBhIHB1cml0eS1zcGVjaWZpYyBvdmVycmlkZSBmaXJzdAogIGNvbnN0IHB1cml0eUtleSA9IHB1cml0eSA/IChtZXRhbFR5cGUgKyAnfCcgKyBub3JtYWxpemVQdXJpdHkocHVyaXR5KSkgOiBudWxsOwogIGlmIChwdXJpdHlLZXkgJiYgb3ZlcnJpZGVzW3B1cml0eUtleV0gIT09IHVuZGVmaW5lZCkgcmV0dXJuIG92ZXJyaWRlc1twdXJpdHlLZXldOwogIC8vIEZhbGwgYmFjayB0byBiYXNlICgyNEsgLyBGaW5lKSBwcmljZSBmb3IgdGhpcyBtZXRhbAogIGNvbnN0IGJhc2UgPSBvdmVycmlkZXNbYmFzZUtleV0gIT09IHVuZGVmaW5lZCA/IG92ZXJyaWRlc1tiYXNlS2V5XSA6IChNRVRBTF9DT05GSUdbbWV0YWxUeXBlXT8ucHJpY2VQZXJHcmFtIHx8IDApOwogIGlmICghcHVyaXR5KSByZXR1cm4gYmFzZTsKICBjb25zdCBtdWx0ID0gZ2V0UHVyaXR5TXVsdChwdXJpdHkpOwogIHJldHVybiBtdWx0ICE9PSBudWxsID8gYmFzZSAqIG11bHQgOiBiYXNlOyAvLyB1bmtub3duIHB1cml0eSDihpIgdXNlIGJhc2UgKGZpbmUpIHByaWNlCn0KCmNvbnN0IE1FVEFMX0NPTkZJRyA9IHsKICBnb2xkOiAgICAgeyBsYWJlbDonR29sZCcsICAgICBlbW9qaTon8J+lhycsIHByaWNlUGVyR3JhbTogOTYuNTAsICBoaW50OicyNEsgcHVyZSBnb2xkIOKJiCAkOTYuNTAvZy4gMjJLIOKJiCAkODguNDIvZywgMThLIOKJiCAkNzIuMzgvZy4gVXNlIOKcj++4jyBFZGl0IHRvIHNldCBsaXZlIHByaWNlLicgfSwKICBzaWx2ZXI6ICAgeyBsYWJlbDonU2lsdmVyJywgICBlbW9qaTon8J+liCcsIHByaWNlUGVyR3JhbTogMS4wMywgICBoaW50Oic5OTkgRmluZSBzaWx2ZXIg4omIICQxLjAzL2cuIDkyNSBTdGVybGluZyDiiYggJDAuOTUvZywgOTAwIENvaW4g4omIICQwLjkzL2cuJyB9LAogIHBsYXRpbnVtOiB7IGxhYmVsOidQbGF0aW51bScsIGVtb2ppOifwn5S3JywgcHJpY2VQZXJHcmFtOiAzMC41MCwgIGhpbnQ6J1B0OTk5IOKJiCAkMzAuNTAvZy4gUHQ5NTAg4omIICQyOC45OC9nLiBVc2Ug4pyP77iPIEVkaXQgdG8gc2V0IGN1cnJlbnQgcHJpY2Ug4oCUIHBlci1wdXJpdHkgb3ZlcnJpZGVzIHN1cHBvcnRlZC4nIH0sCn07CgpmdW5jdGlvbiB1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUobWV0YWxUeXBlLCBwcmljZSwgcHVyaXR5KSB7CiAgaWYgKCFkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzKSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzID0ge307CiAgY29uc3Qga2V5ID0gcHVyaXR5ID8gKG1ldGFsVHlwZSArICd8JyArIG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpKSA6IG1ldGFsVHlwZTsKICBjb25zdCBwID0gcGFyc2VGbG9hdChwcmljZSk7CiAgaWYgKCFwIHx8IHAgPD0gMCkgeyBkZWxldGUgZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc1trZXldOyB9CiAgZWxzZSB7IGRhdGEuX21ldGFsUHJpY2VPdmVycmlkZXNba2V5XSA9IHA7IH0KICBzYXZlKCk7CiAgcmVuZGVyTWV0','YWxzKCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICByZW5kZXJQdXJpdHlQcmljZXMobWV0YWxUeXBlKTsKICBzaG93VG9hc3QoJ+KchSBQcmljZSB1cGRhdGVkIOKAlCBOZXQgV29ydGggcmVjYWxjdWxhdGVkIScpOwp9CgpmdW5jdGlvbiByZXNldE1ldGFsUHJpY2VPdmVycmlkZShtZXRhbFR5cGUsIHB1cml0eSkgewogIGlmICghZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlcykgcmV0dXJuOwogIGlmIChwdXJpdHkpIHsKICAgIGRlbGV0ZSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzW21ldGFsVHlwZSArICd8JyArIG5vcm1hbGl6ZVB1cml0eShwdXJpdHkpXTsKICB9IGVsc2UgewogICAgLy8gUmVzZXQgYmFzZSBBTkQgYWxsIHB1cml0eSBvdmVycmlkZXMgZm9yIHRoaXMgbWV0YWwKICAgIGNvbnN0IHByZWZpeCA9IG1ldGFsVHlwZSArICd8JzsKICAgIE9iamVjdC5rZXlzKGRhdGEuX21ldGFsUHJpY2VPdmVycmlkZXMpLmZvckVhY2goayA9PiB7CiAgICAgIGlmIChrID09PSBtZXRhbFR5cGUgfHwgay5zdGFydHNXaXRoKHByZWZpeCkpIGRlbGV0ZSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzW2tdOwogICAgfSk7CiAgfQogIHNhdmUoKTsgcmVuZGVyTWV0YWxzKCk7IHJlbmRlck5ldFdvcnRoKCk7CiAgcmVuZGVyUHVyaXR5UHJpY2VzKG1ldGFsVHlwZSk7CiAgc2hvd1RvYXN0KCdQcmljZSByZXNldCB0byBkZWZhdWx0Jyk7Cn0KCmZ1bmN0aW9uIGdldE1ldGFsQmFzZVByaWNlKG1ldGFsVHlwZSkgewogIHJldHVybiAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW21ldGFsVHlwZV0gIT09IHVuZGVmaW5lZAogICAgPyAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW21ldGFsVHlwZV0KICAgIDogKE1FVEFMX0NPTkZJR1ttZXRhbFR5cGVdPy5wcmljZVBlckdyYW0gfHwgMCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBIRUxQRVJTCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBnZXRDdXJyZW50TW9udGhLZXkoKSB7IGNvbnN0IG49bmV3IERhdGUoKTsgcmV0dXJuIGAke24uZ2V0RnVsbFllYXIoKX0tJHsobi5nZXRNb250aCgpKzEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpfWA7IH0KZnVuY3Rpb24gZ2V0TW9udGhLZXkoZGF0ZVN0cikgeyBpZighZGF0ZVN0cikgcmV0dXJuIG51bGw7IGNvbnN0IGR0PW5ldyBEYXRlKGRhdGVTdHIpOyBpZihpc05hTihkdC5nZXRUaW1lKCkpKSByZXR1cm4gbnVsbDsgcmV0dXJuIGAke2R0LmdldEZ1bGxZZWFyKCl9LSR7U3RyaW5nKGR0LmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7IH0KZnVuY3Rpb24gZ2V0RGlzcGxheU1vbnRoKGtleSkgeyBpZigha2V5KSByZXR1cm4gJyc7IGNvbnN0W3ksbV09a2V5LnNwbGl0KCctJyk7IHJldHVybiBbJ0phbicsJ0ZlYicsJ01hcicsJ0FwcicsJ01heScsJ0p1bicsJ0p1bCcsJ0F1ZycsJ1NlcCcsJ09jdCcsJ05vdicsJ0RlYyddW3BhcnNlSW50KG0pLTFdKycgJyt5OyB9CmZ1bmN0aW9uIGdldEZ1bGxEaXNwbGF5TW9udGgoa2V5KSB7IGlmKCFrZXkpIHJldHVybiAnJzsgY29uc3RbeSxtXT1rZXkuc3BsaXQoJy0nKTsgcmV0dXJuIFsnSmFudWFyeScsJ0ZlYnJ1YXJ5JywnTWFyY2gnLCdBcHJpbCcsJ01heScsJ0p1bmUnLCdKdWx5JywnQXVndXN0JywnU2VwdGVtYmVyJywnT2N0b2JlcicsJ05vdmVtYmVyJywnRGVjZW1iZXInXVtwYXJzZUludChtKS0xXSsnICcreTsgfQpmdW5jdGlvbiBub3JtYWxpemVEYXRlKHJhdykgeyBpZighcmF3KSByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07IGxldCBzdHI9U3RyaW5nKHJhdykudHJpbSgpOyBpZih0eXBlb2YgcmF3PT09J251bWJlcicmJnJhdz4zMDAwMCl7Y29uc3QgZD1NYXRoLmZsb29yKHJhdy0yNTU2OSk7cmV0dXJuIG5ldyBEYXRlKGQqODY0MDAqMTAwMCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO30gaWYoL15cZHs0fS1cZHsyfS1cZHsyfSQvLnRlc3Qoc3RyKSkgcmV0dXJuIHN0cjsgY29uc3QgZHQ9bmV3IERhdGUoc3RyKTsgaWYoIWlzTmFOKGR0LmdldFRpbWUoKSkpIHJldHVybiBkdC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07IHJldHVybiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsgfQpmdW5jdGlvbiBlbnN1cmVNb250aChrZXkpIHsgaWYoIWRhdGFba2V5XSkgZGF0YVtrZXldPXtpbmNvbWU6W10sZXhwZW5zZXM6W10saW52ZXN0bWVudHM6W10sYWRkaXRpb25hbDpbXSxyZWFsRXN0YXRlOltdLG1ldGFsczpbXSxnaXZlblRvT3RoZXJzOltdLGRlYnRzOltdfTsgfQpmdW5jdGlvbiBzYXZlKCkgewogIC8vIEFsd2F5cyBrZWVwIGxvY2FsU3RvcmFnZSBhcyBvZmZsaW5lIGJhY2t1cAogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgLy8gU3luYyB0byBGaXJlYmFzZSBpZiBsb2dnZWQgaW4KICBmaXJlYmFzZVNhdmUoKTsKfQpmdW5jdGlvbiBmbXQobikgeyByZXR1cm4gc3ltKCkrTWF0aC5hYnMoTnVtYmVyKG4pKS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQse21pbmltdW1GcmFjdGlvbkRpZ2l0czowLG1heGltdW1GcmFjdGlvbkRpZ2l0czowfSk7IH0KZnVuY3Rpb24gZm10RnVsbChuKSB7IHJldHVybiBzeW0oKStNYXRoLmFicyhOdW1iZXIobikpLnRvTG9jYWxlU3RyaW5nKHVuZGVmaW5lZCx7bWluaW11bUZyYWN0aW9uRGlnaXRzOjIsbWF4aW11bUZyYWN0aW9uRGlnaXRzOjJ9KTsgfQpmdW5jdGlvbiBnZXRDdXJyZW5jeVN5bWJvbChjdXJyZW5jeT0nVVNEJykgeyByZXR1cm4geydVU0QnOickJywnSU5SJzon4oK5JywnRVVSJzon4oKsJywnR0JQJzonwqMnLCdBRUQnOifYry7YpScsJ0NBRCc6J0MkJywnQVVEJzonQSQnfVsoY3VycmVuY3l8fCdVU0QnKS50b1VwcGVyQ2FzZSgpXXx8KGN1cnJlbmN5fHwnVVNEJykrJyAnOyB9CmZ1bmN0aW9uIGdldENvbXBhY3ROdW0obnVtKSB7IGlmKCFudW0pcmV0dXJuJzAnOyBpZihudW0+PTEwMDAwMDAwKXJldHVybihudW0vMTAwMDAwMDApLnRvRml4ZWQoMikrJ0NyJzsgaWYobnVtPj0xMDAwMDApcmV0dXJuKG51bS8xMDAwMDApLnRvRml4ZWQoMikrJ0wnOyBpZihudW0+PTEwMDApcmV0dXJuKG51bS8xMDAwKS50b0ZpeGVkKDEpKydrJzsgcmV0dXJuIG51bS50b0xvY2FsZVN0cmluZygpOyB9CmZ1bmN0aW9uIHNob3dUb2FzdChtc2csIGR1cj0yNTAwKSB7IGNvbnN0IHQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0Jyk7IHQudGV4dENvbnRlbnQ9bXNnOyB0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsgc2V0VGltZW91dCgoKT0+dC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JyksZHVyKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFRIRU1FIFNZU1RFTQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gc2V0VGhlbWUodGhlbWUpIHsKICAvLyBSZW1vdmUgYWxsIHRoZW1lIGNsYXNzZXMKICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ3RoZW1lLWxvb25leScsJ3RoZW1lLWp1bmdsZScsJ3RoZW1lLXNwYWNlJywndGhlbWUtb2NlYW4nKTsKICBpZih0aGVtZSAhPT0gJ2RlZmF1bHQnKSBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3RoZW1lLScrdGhlbWUpOwogIGN1cnJlbnRUaGVtZSA9IHRoZW1lOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtZl90aGVtZScsIHRoZW1lKTsKICAvLyBVcGRhdGUgYWN0aXZlIGJhZGdlIGluIHNldHRpbmdzCiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRoZW1lLWNhcmQnKS5mb3JFYWNoKGMgPT4gYy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUtdGhlbWUnKSk7CiAgY29uc3QgdGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWUtJyt0aGVtZSk7CiAgaWYodGMpIHRjLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZS10aGVtZScpOwogIHNob3dUb2FzdCgn8J+OqCBUaGVtZSBhcHBsaWVkIScpOwp9CgpmdW5jdGlvbiBhcHBseVN0b3JlZFRoZW1lKCkgewogIGNvbnN0IHQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWZfdGhlbWUnKSB8fCAnZGVmYXVsdCc7CiAgc2V0VGhlbWUodCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBUSU1FIFBFUklPRCBOQVZJR0FUSU9OCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBzZXRQZXJpb2QocGVyaW9kLCBidG4pIHsKICBjdXJyZW50UGVyaW9kID0gcGVyaW9kOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZXJpb2QtdGFiJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlclBlcmlvZERldGFpbCgpOwogIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gY2hhbmdlUGVyaW9kKGRpcikgewogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICdtb250aCcpIHsKICAgIGNvbnN0IFt5LG1dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICBjb25zdCBkdCA9IG5ldyBEYXRlKHksIG0tMStkaXIsIDEpOwogICAgdmlld01vbnRoID0gYCR7ZHQuZ2V0RnVsbFllYXIoKX0tJHsoZHQuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsJzAnKX1gOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAneWVhcicpIHsKICAgIGNvbnN0IFt5LG1dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgICBjb25zdCBkdCA9IG5ldyBEYXRlKHkrZGlyLCBtLTEsIDEpOwogICAgdmlld01vbnRoID0gYCR7ZHQuZ2V0RnVsbFllYXIoKX0tJHsoZHQuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsJzAnKX1gOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAnd2VlaycpIHsKICAgIGNvbnN0IGQgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBkLnNldERhdGUoZC5nZXREYXRlKCkgKyBkaXIqNyk7CiAgICBzZWxlY3RlZERheSA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgdmlld01vbnRoID0gZ2V0TW9udGhLZXkoc2VsZWN0ZWREYXkpOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5ID8g','bmV3IERhdGUoc2VsZWN0ZWREYXkrJ1QwMDowMDowMCcpIDogbmV3IERhdGUoKTsKICAgIGQuc2V0RGF0ZShkLmdldERhdGUoKSArIGRpcik7CiAgICBzZWxlY3RlZERheSA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgdmlld01vbnRoID0gZ2V0TW9udGhLZXkoc2VsZWN0ZWREYXkpOwogIH0KICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlclBlcmlvZERldGFpbCgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BiYXItbW9udGgnKS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIHJlbmRlckhvbWUoKTsKICByZW5kZXJUcmFuc2FjdGlvbnMoKTsKfQoKZnVuY3Rpb24gdXBkYXRlUGVyaW9kTGFiZWwoKSB7CiAgY29uc3QgbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtbW9udGgtbGFiZWwnKTsKICBjb25zdCB0b3BiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BiYXItbW9udGgnKTsKICBpZihjdXJyZW50UGVyaW9kID09PSAnbW9udGgnKSB7CiAgICBsYmwudGV4dENvbnRlbnQgPSBnZXRGdWxsRGlzcGxheU1vbnRoKHZpZXdNb250aCk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIH0gZWxzZSBpZihjdXJyZW50UGVyaW9kID09PSAneWVhcicpIHsKICAgIGNvbnN0IFt5XSA9IHZpZXdNb250aC5zcGxpdCgnLScpOwogICAgbGJsLnRleHRDb250ZW50ID0gJ1llYXIgJyArIHk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9IHk7CiAgfSBlbHNlIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd3ZWVrJykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5ID8gbmV3IERhdGUoc2VsZWN0ZWREYXkrJ1QwMDowMDowMCcpIDogbmV3IERhdGUoKTsKICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoZCk7IHN0YXJ0LnNldERhdGUoZC5nZXREYXRlKCkgLSBkLmdldERheSgpKTsKICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKHN0YXJ0KTsgZW5kLnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgNik7CiAgICBjb25zdCBmbXQyID0gZHQgPT4gZHQudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycse21vbnRoOidzaG9ydCcsZGF5OidudW1lcmljJ30pOwogICAgbGJsLnRleHRDb250ZW50ID0gZm10MihzdGFydCkrJyDigJMgJytmbXQyKGVuZCk7CiAgICB0b3BiYWRnZS50ZXh0Q29udGVudCA9ICdXZWVrJzsKICB9IGVsc2UgaWYoY3VycmVudFBlcmlvZCA9PT0gJ2RheScpIHsKICAgIGNvbnN0IGQgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBsYmwudGV4dENvbnRlbnQgPSBkLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHt3ZWVrZGF5Oidsb25nJyxtb250aDonbG9uZycsZGF5OidudW1lcmljJ30pOwogICAgdG9wYmFkZ2UudGV4dENvbnRlbnQgPSBkLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYyd9KTsKICB9Cn0KCmZ1bmN0aW9uIHJlbmRlclBlcmlvZERldGFpbCgpIHsKICBjb25zdCBkZXRhaWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyaW9kLWRldGFpbCcpOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd3ZWVrJyB8fCBjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgZGV0YWlsLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgIC8vIFNob3cgNyBkYXlzIG9mIGN1cnJlbnQgd2VlawogICAgY29uc3QgYW5jaG9yID0gc2VsZWN0ZWREYXkgPyBuZXcgRGF0ZShzZWxlY3RlZERheSsnVDAwOjAwOjAwJykgOiBuZXcgRGF0ZSgpOwogICAgY29uc3Qgd2Vla1N0YXJ0ID0gbmV3IERhdGUoYW5jaG9yKTsKICAgIHdlZWtTdGFydC5zZXREYXRlKGFuY2hvci5nZXREYXRlKCkgLSBhbmNob3IuZ2V0RGF5KCkpOwogICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgIGNvbnN0IGRheU5hbWVzID0gWydTdScsJ01vJywnVHUnLCdXZScsJ1RoJywnRnInLCdTYSddOwogICAgZGV0YWlsLmlubmVySFRNTCA9IEFycmF5LmZyb20oe2xlbmd0aDo3fSkubWFwKChfLGkpID0+IHsKICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHdlZWtTdGFydCk7IGQuc2V0RGF0ZSh3ZWVrU3RhcnQuZ2V0RGF0ZSgpK2kpOwogICAgICBjb25zdCBkcyA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICBjb25zdCBpc1RvZGF5ID0gZHMgPT09IHRvZGF5OwogICAgICBjb25zdCBpc1NlbCA9IGRzID09PSBzZWxlY3RlZERheTsKICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJkYXktY2hpcCAke2lzVG9kYXk/J3RvZGF5JzonJ30gJHtpc1NlbD8nc2VsZWN0ZWQnOicnfSIgb25jbGljaz0ic2VsZWN0RGF5KCcke2RzfScpIj4KICAgICAgICA8ZGl2IGNsYXNzPSJkYy1kYXkiPiR7ZGF5TmFtZXNbaV19PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZGMtbnVtIj4ke2QuZ2V0RGF0ZSgpfTwvZGl2PgogICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CiAgfSBlbHNlIHsKICAgIGRldGFpbC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgfQp9CgpmdW5jdGlvbiBzZWxlY3REYXkoZGF0ZVN0cikgewogIHNlbGVjdGVkRGF5ID0gZGF0ZVN0cjsKICB2aWV3TW9udGggPSBnZXRNb250aEtleShkYXRlU3RyKTsKICByZW5kZXJQZXJpb2REZXRhaWwoKTsKICB1cGRhdGVQZXJpb2RMYWJlbCgpOwogIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gdG9nZ2xlUGVyaW9kVmlldygpIHsKICAvLyBDbGlja2luZyB0aGUgYmFkZ2UgY3ljbGVzIHRocm91Z2ggcGVyaW9kcwogIGNvbnN0IHBlcmlvZHMgPSBbJ21vbnRoJywnd2VlaycsJ2RheScsJ3llYXInXTsKICBjb25zdCBuZXh0ID0gcGVyaW9kc1socGVyaW9kcy5pbmRleE9mKGN1cnJlbnRQZXJpb2QpKzEpICUgcGVyaW9kcy5sZW5ndGhdOwogIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGVyaW9kLXRhYicpOwogIHRhYnMuZm9yRWFjaCh0ID0+IHsgaWYodC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpID09PSBuZXh0KSBzZXRQZXJpb2QobmV4dCx0KTsgfSk7Cn0KCi8vIEdldCBlbnRyaWVzIGZpbHRlcmVkIGJ5IGN1cnJlbnQgcGVyaW9kCmZ1bmN0aW9uIGdldFBlcmlvZEVudHJpZXMobW9udGhEYXRhLCB0eXBlKSB7CiAgY29uc3QgZW50cmllcyA9IChtb250aERhdGFbdHlwZV0gfHwgW10pOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICdtb250aCcgfHwgY3VycmVudFBlcmlvZCA9PT0gJ3llYXInKSByZXR1cm4gZW50cmllczsKICBpZihjdXJyZW50UGVyaW9kID09PSAnZGF5JykgewogICAgY29uc3QgZCA9IHNlbGVjdGVkRGF5IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgcmV0dXJuIGVudHJpZXMuZmlsdGVyKGUgPT4gZS5kYXRlID09PSBkKTsKICB9CiAgaWYoY3VycmVudFBlcmlvZCA9PT0gJ3dlZWsnKSB7CiAgICBjb25zdCBhbmNob3IgPSBzZWxlY3RlZERheSA/IG5ldyBEYXRlKHNlbGVjdGVkRGF5KydUMDA6MDA6MDAnKSA6IG5ldyBEYXRlKCk7CiAgICBjb25zdCB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShhbmNob3IpOyB3ZWVrU3RhcnQuc2V0RGF0ZShhbmNob3IuZ2V0RGF0ZSgpLWFuY2hvci5nZXREYXkoKSk7CiAgICBjb25zdCB3ZWVrRW5kID0gbmV3IERhdGUod2Vla1N0YXJ0KTsgd2Vla0VuZC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkrNik7CiAgICBjb25zdCB3cyA9IHdlZWtTdGFydC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgICBjb25zdCB3ZSA9IHdlZWtFbmQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgcmV0dXJuIGVudHJpZXMuZmlsdGVyKGUgPT4gZS5kYXRlID49IHdzICYmIGUuZGF0ZSA8PSB3ZSk7CiAgfQogIHJldHVybiBlbnRyaWVzOwp9CgpmdW5jdGlvbiBnZXRZZWFyRW50cmllcyh0eXBlKSB7CiAgY29uc3QgW3ldID0gdmlld01vbnRoLnNwbGl0KCctJyk7CiAgbGV0IGFsbCA9IFtdOwogIE9iamVjdC5rZXlzKGRhdGEpLmZpbHRlcihrID0+IGsuc3RhcnRzV2l0aCh5KyctJykgJiYgIWsuc3RhcnRzV2l0aCgnXycpKS5mb3JFYWNoKGsgPT4gewogICAgYWxsID0gYWxsLmNvbmNhdChkYXRhW2tdW3R5cGVdIHx8IFtdKTsKICB9KTsKICByZXR1cm4gYWxsOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSE9NRQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gc2V0SG9tZVRhYih0YWIpIHsKICBob21lVGFiID0gdGFiOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5ob21lLXRhYi1idG4nKS5mb3JFYWNoKGI9PmIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdodGFiLScrdGFiKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaG9tZS1zZWN0aW9uJykuZm9yRWFjaChzPT5zLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHNlYy0nK3RhYikuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgcmVuZGVySG9tZSgpOwp9CgpmdW5jdGlvbiByZW5kZXJIb21lKCkgewogIGVuc3VyZU1vbnRoKHZpZXdNb250aCk7CiAgY29uc3QgbSA9IGRhdGFbdmlld01vbnRoXTsKCiAgbGV0IGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzLCBhZGRpdGlvbmFsOwogIGlmKGN1cnJlbnRQZXJpb2QgPT09ICd5ZWFyJykgewogICAgZXhwZW5zZXMgPSBnZXRZZWFyRW50cmllcygnZXhwZW5zZXMnKTsKICAgIGluY29tZSA9IGdldFllYXJFbnRyaWVzKCdpbmNvbWUnKTsKICAgIGludmVzdG1lbnRzID0gZ2V0WWVhckVudHJpZXMoJ2ludmVzdG1lbnRzJyk7CiAgICBhZGRpdGlvbmFsID0gZ2V0WWVhckVudHJpZXMoJ2FkZGl0aW9uYWwnKTsKICB9IGVsc2UgewogICAgZXhwZW5zZXMgPSBnZXRQZXJpb2RFbnRyaWVzKG0sICdleHBlbnNlcycpOwogICAgaW5jb21lID0gZ2V0UGVyaW9kRW50cmllcyhtLCAnaW5jb21lJyk7CiAgICBpbnZlc3RtZW50cyA9IGdldFBlcmlvZEVudHJpZXMobSwgJ2ludmVzdG1lbnRzJyk7CiAgICBhZGRpdGlvbmFsID0gZ2V0UGVyaW9kRW50cmllcyhtLCAnYWRkaXRpb25hbCcpOwogIH0KCiAgaWYoaG9tZVRhYiA9PT0gJ3NwZW5kaW5nJykgewogICAgY29uc3QgdG90YWxFeHAgPSBleHBlbnNlcy5yZWR1Y2UoKHMscik9PnMrY29udmVydEFtdChyLmFtb3VudCxyLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IHRvdGFsQWRkID0gYWRkaXRpb25hbC5yZWR1Y2UoKHMscik9PnMrY29udmVydEFtdChyLmFtb3VudCxyLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IHRvdGFsSW5jID0gaW5jb21lLnJlZHVjZSgocyxyKT0+cytjb252ZXJ0QW10KHIuYW1vdW50LHIuY3VycmVuY3kpLDApOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtc3BlbmRpbmcnKS50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEV4cCt0b3RhbEFkZCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1pbmNvbWUnKS50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEluYyk7CgogICAgY29uc3Qgc2FsYXJ5ID0gaW5jb21lLmZpbHRlcihlPT5bJ1NhbGFyeScsJ0ZyZWVsYW5jZScsJ0JvbnVzJ10uaW5jbHVkZXMoZS5jYXRlZ29yeSkpLnJlZHVjZSgocyxlKT0+cytjb252ZXJ0QW10KGUuYW1vdW50LGUuY3VycmVu','Y3kpLDApOwogICAgY29uc3QgZ2lmdHMgID0gaW5jb21lLmZpbHRlcihlPT5bJ0dpZnQnLCdHaWZ0cyddLmluY2x1ZGVzKGUuY2F0ZWdvcnkpKS5yZWR1Y2UoKHMsZSk9PnMrY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KSwwKTsKICAgIGNvbnN0IG90aGVySW5jID0gaW5jb21lLmZpbHRlcihlPT4hWydTYWxhcnknLCdGcmVlbGFuY2UnLCdCb251cycsJ0dpZnQnLCdHaWZ0cyddLmluY2x1ZGVzKGUuY2F0ZWdvcnkpKS5yZWR1Y2UoKHMsZSk9PnMrY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KSwwKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLXNhbGFyeScpLnRleHRDb250ZW50ID0gZm10KHNhbGFyeSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1naWZ0cycpLnRleHRDb250ZW50ICA9IGZtdChnaWZ0cyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1vdGhlci1pbmNvbWUnKS50ZXh0Q29udGVudCA9IGZtdChvdGhlckluYyk7CgogICAgLy8gRHluYW1pYyBob21lIHNwZW5kIGNhcmRzCiAgICBjb25zdCBjYXJkcyA9IGdldEhvbWVTcGVuZENhcmRzKCkuZmlsdGVyKGM9PmMudmlzaWJsZSE9PWZhbHNlKTsKICAgIGNvbnN0IGFsbEV4cCA9IHRvdGFsRXhwICsgdG90YWxBZGQ7CiAgICBjb25zdCBjYXRUb3RhbHMgPSB7fTsKICAgIGV4cGVuc2VzLmZvckVhY2goZT0+e2NhdFRvdGFsc1tlLmNhdGVnb3J5XT0oY2F0VG90YWxzW2UuY2F0ZWdvcnldfHwwKStjb252ZXJ0QW10KGUuYW1vdW50LGUuY3VycmVuY3kpO30pOwogICAgYWRkaXRpb25hbC5mb3JFYWNoKGU9PntjYXRUb3RhbHNbJ0FkZGl0aW9uYWwnXT0oY2F0VG90YWxzWydBZGRpdGlvbmFsJ118fDApK2NvbnZlcnRBbXQoZS5hbW91bnQsZS5jdXJyZW5jeSk7fSk7CgogICAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtZ3JpZCcpOwogICAgZ3JpZC5pbm5lckhUTUwgPSBjYXJkcy5tYXAoY2FyZD0+ewogICAgICBjb25zdCBzdWJjYXRzID0gY2FyZC5zdWJjYXRzfHxbXTsKICAgICAgLy8gVXNlIHN1YmNhdHMgaWYgZGVmaW5lZCwgZWxzZSBmYWxsIGJhY2sgdG8gY2FyZC5sYWJlbCDigJQgbmV2ZXIgYWRkIGJvdGggKGF2b2lkcyBkb3VibGUtY291bnQpCiAgICAgIGNvbnN0IGFtdCA9IHN1YmNhdHMubGVuZ3RoID4gMAogICAgICAgID8gc3ViY2F0cy5yZWR1Y2UoKHMsc2MpPT5zKyhjYXRUb3RhbHNbc2NdfHwwKSwwKQogICAgICAgIDogKGNhdFRvdGFsc1tjYXJkLmxhYmVsXXx8MCk7CiAgICAgIGNvbnN0IHBjdCA9IGFsbEV4cD4wID8gTWF0aC5taW4oYW10L2FsbEV4cCoxMDAsMTAwKSA6IDA7CiAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iYnVkZ2V0LWNhcmQgJHtjYXJkLmNsc3x8J290aGVyLWNhdCd9IiBvbmNsaWNrPSJvcGVuUXVpY2tBZGQoJ2V4cGVuc2UnLCcke3N1YmNhdHNbMF18fGNhcmQubGFiZWx9JykiPgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1pY29uIiBzdHlsZT0iYmFja2dyb3VuZDoke2NhcmQuY29sb3J9MjI7Ij4ke2NhcmQuaWNvbn08L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXQtbmFtZSI+JHtjYXJkLmxhYmVsfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNhdC1hbW91bnQiPiR7Zm10KGFtdCl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2F0LWJhciI+PGRpdiBjbGFzcz0iY2F0LWJhci1maWxsIiBzdHlsZT0id2lkdGg6JHtwY3R9JTtiYWNrZ3JvdW5kOiR7Y2FyZC5jb2xvcn07Ij48L2Rpdj48L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogIH0gZWxzZSB7CiAgICByZW5kZXJJbnZlc3RIb21lKGludmVzdG1lbnRzKTsKICB9CiAgcmVuZGVySG9tZUluc2lnaHRzKGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzKTsKICByZW5kZXJTZXR0aW5ncygpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSE9NRSBJTlNJR0hUUwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKbGV0IGluc2lnaHRzT3BlbiA9IGZhbHNlOwoKZnVuY3Rpb24gdG9nZ2xlSW5zaWdodHMoKSB7CiAgaW5zaWdodHNPcGVuID0gIWluc2lnaHRzT3BlbjsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMtYm9keScpLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nLCBpbnNpZ2h0c09wZW4pOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnNpZ2h0cy10b2dnbGUtYXJyb3cnKS5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJywgaW5zaWdodHNPcGVuKTsKfQoKZnVuY3Rpb24gcmVuZGVySG9tZUluc2lnaHRzKGV4cGVuc2VzLCBpbmNvbWUsIGludmVzdG1lbnRzKSB7CiAgY29uc3Qga3BpU3RyaXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMta3BpLXN0cmlwJyk7CiAgY29uc3QgY2hpcHNFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zaWdodHMtY2hpcHMnKTsKICBpZiAoIWtwaVN0cmlwIHx8ICFjaGlwc0VsKSByZXR1cm47CgogIGNvbnN0IHRvdGFsRXhwID0gZXhwZW5zZXMucmVkdWNlKChzLGUpID0+IHMgKyBjb252ZXJ0QW10KGUuYW1vdW50LCBlLmN1cnJlbmN5KSwgMCk7CiAgY29uc3QgdG90YWxJbmMgPSBpbmNvbWUucmVkdWNlKChzLGUpICAgPT4gcyArIGNvbnZlcnRBbXQoZS5hbW91bnQsIGUuY3VycmVuY3kpLCAwKTsKICBjb25zdCB0b3RhbEludiA9IGludmVzdG1lbnRzLnJlZHVjZSgocyxlKSA9PiBzICsgY29udmVydEFtdChlLmFtb3VudCwgZS5jdXJyZW5jeSksIDApOwogIGNvbnN0IG5ldCA9IHRvdGFsSW5jIC0gdG90YWxFeHA7CiAgY29uc3Qgc2F2aW5nc1JhdGUgPSB0b3RhbEluYyA+IDAgPyAoKHRvdGFsSW5jIC0gdG90YWxFeHApIC8gdG90YWxJbmMgKiAxMDApIDogMDsKCiAgLy8g4pSA4pSAIEtQSSBzdHJpcCAoMyBhbHdheXMtdmlzaWJsZSBudW1iZXJzKSDilIDilIAKICBjb25zdCBrcGlzID0gWwogICAgeyB2YWw6IGZtdChuZXQpLCAgbGFiZWw6IG5ldCA+PSAwID8gJ05ldCBTYXZlZCcgOiAnTmV0IERlZmljaXQnLCBjb2xvcjogbmV0ID49IDAgPyAndmFyKC0taW5jb21lKScgOiAndmFyKC0tZXhwZW5zZXMpJyB9LAogICAgeyB2YWw6IHNhdmluZ3NSYXRlLnRvRml4ZWQoMCkgKyAnJScsIGxhYmVsOiAnU2F2aW5ncyBSYXRlJywgY29sb3I6IHNhdmluZ3NSYXRlID49IDIwID8gJ3ZhcigtLWluY29tZSknIDogc2F2aW5nc1JhdGUgPj0gMTAgPyAnI0Y1OUUwQicgOiAndmFyKC0tZXhwZW5zZXMpJyB9LAogICAgeyB2YWw6IGZtdCh0b3RhbEludiksIGxhYmVsOiAnSW52ZXN0ZWQnLCBjb2xvcjogJyM3QzNBRUQnIH0sCiAgXTsKICBrcGlTdHJpcC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iaW5zaWdodHMta3BpLXJvdyI+JHsKICAgIGtwaXMubWFwKGsgPT4gYDxkaXYgY2xhc3M9Imluc2lnaHRzLWtwaSI+CiAgICAgIDxkaXYgY2xhc3M9ImlrcGktdmFsIiBzdHlsZT0iY29sb3I6JHtrLmNvbG9yfTsiPiR7ay52YWx9PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImlrcGktbGFiZWwiPiR7ay5sYWJlbH08L2Rpdj4KICAgIDwvZGl2PmApLmpvaW4oJycpCiAgfTwvZGl2PmA7CgogIC8vIOKUgOKUgCBDb21wdXRlIGNoaXBzIOKUgOKUgAogIGNvbnN0IGNoaXBzID0gW107CgogIC8vIDEuIFRvcCBzcGVuZGluZyBjYXRlZ29yeQogIGNvbnN0IGNhdFRvdGFscyA9IHt9OwogIGV4cGVuc2VzLmZvckVhY2goZSA9PiB7IGNhdFRvdGFsc1tlLmNhdGVnb3J5XSA9IChjYXRUb3RhbHNbZS5jYXRlZ29yeV18fDApICsgY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KTsgfSk7CiAgY29uc3QgdG9wQ2F0cyA9IE9iamVjdC5lbnRyaWVzKGNhdFRvdGFscykuc29ydCgoYSxiKSA9PiBiWzFdLWFbMV0pOwogIGlmICh0b3BDYXRzLmxlbmd0aCA+IDApIHsKICAgIGNvbnN0IFt0b3BDYXQsIHRvcEFtdF0gPSB0b3BDYXRzWzBdOwogICAgY29uc3QgcGN0ID0gdG90YWxFeHAgPiAwID8gKHRvcEFtdC90b3RhbEV4cCoxMDApLnRvRml4ZWQoMCkgOiAwOwogICAgY2hpcHMucHVzaCh7IHR5cGU6IHBjdCA+IDMwID8gJ3dhcm4nIDogJ25ldXRyYWwnLCBpY29uOiAn8J+PhicsIHRpdGxlOiBgQmlnZ2VzdCBzcGVuZDogJHt0b3BDYXR9YCwgc3ViOiBgJHtmbXQodG9wQW10KX0g4oCUICR7cGN0fSUgb2YgdG90YWwgc3BlbmRpbmcgdGhpcyBwZXJpb2RgIH0pOwogIH0KCiAgLy8gMi4gU2F2aW5ncyByYXRlIHZlcmRpY3QKICBpZiAodG90YWxJbmMgPiAwKSB7CiAgICBpZiAoc2F2aW5nc1JhdGUgPj0gMjApIGNoaXBzLnB1c2goeyB0eXBlOidnb29kJywgIGljb246J/CfjJ8nLCB0aXRsZTonR3JlYXQgc2F2aW5ncyByYXRlIScsIHN1YjpgWW91J3JlIHNhdmluZyAke3NhdmluZ3NSYXRlLnRvRml4ZWQoMCl9JSBvZiBpbmNvbWUg4oCUIGFib3ZlIHRoZSAyMCUgYmVuY2htYXJrYCB9KTsKICAgIGVsc2UgaWYgKHNhdmluZ3NSYXRlID49IDEwKSBjaGlwcy5wdXNoKHsgdHlwZTond2FybicsICBpY29uOifwn5KbJywgdGl0bGU6J0RlY2VudCBzYXZpbmdzIHJhdGUnLCBzdWI6YCR7c2F2aW5nc1JhdGUudG9GaXhlZCgwKX0lIHNhdmVkIOKAlCBhaW0gZm9yIDIwJSB0byBidWlsZCB3ZWFsdGggZmFzdGVyYCB9KTsKICAgIGVsc2UgaWYgKHNhdmluZ3NSYXRlID4gMCkgICBjaGlwcy5wdXNoKHsgdHlwZTonYWxlcnQnLCBpY29uOifimqDvuI8nLCB0aXRsZTonTG93IHNhdmluZ3MgcmF0ZScsIHN1YjpgT25seSAke3NhdmluZ3NSYXRlLnRvRml4ZWQoMCl9JSBzYXZlZCB0aGlzIHBlcmlvZCDigJQgcmV2aWV3IHRvcCBzcGVuZGluZyBjYXRlZ29yaWVzYCB9KTsKICAgIGVsc2UgaWYgKG5ldCA8IDApICAgICAgICAgICBjaGlwcy5wdXNoKHsgdHlwZTonYWxlcnQnLCBpY29uOifwn5qoJywgdGl0bGU6J1NwZW5kaW5nIGV4Y2VlZHMgaW5jb21lJywgc3ViOmAke2ZtdChNYXRoLmFicyhuZXQpKX0gbW9yZSBzcGVudCB0aGFuIGVhcm5lZCDigJQgcmV2aWV3IHlvdXIgYnVkZ2V0YCB9KTsKICB9CgogIC8vIDMuIEludmVzdG1lbnQgZGlzY2lwbGluZQogIGlmICh0b3RhbEluYyA+IDApIHsKICAgIGNvbnN0IGludlJhdGUgPSAodG90YWxJbnYgLyB0b3RhbEluYyAqIDEwMCk7CiAgICBpZiAoaW52UmF0ZSA+PSAxNSkgY2hpcHMucHVzaCh7IHR5cGU6J2dvb2QnLCAgIGljb246J/Cfk4gnLCB0aXRsZTonU3Ryb25nIGludmVzdG1lbnQgaGFiaXQnLCBzdWI6YCR7aW52UmF0ZS50b0ZpeGVkKDApfSUgb2YgaW5jb21lIGdvaW5nIHRvIGludmVzdG1lbnRzIOKAlCBleGNlbGxlbnQgZGlzY2lwbGluZWAgfSk7CiAgICBlbHNlIGlmIChpbnZSYXRlID4gMCkgY2hpcHMucHVzaCh7IHR5cGU6J25ldXRyYWwnLCBpY29uOifwn5OKJywgdGl0bGU6YCR7aW52UmF0ZS50b0ZpeGVkKDApfSUgaW52ZXN0ZWRgLCBzdWI6YCR7Zm10KHRvdGFsSW52KX0gaW52ZXN0ZWQgdGhpcyBwZXJpb2Qg4oCUIGNvbnNpZGVyIGluY3JlYXNpbmcgdG8gMTUlK2AgfSk7CiAgICBlbHNlIGNoaXBzLnB1c2goeyB0eXBlOiduZXV0cmFsJywgaWNvbjon8J+SoScsIHRpdGxlOidObyBpbnZlc3RtZW50cyB0aGlzIHBlcmlvZCcsIHN1YjonQ29uc2lkZXIgYWxsb2NhdGluZyBhIHBvcnRpb24gb2YgaW5jb21lIHRvIGludmVzdG1lbnRzJyB9KTsKICB9CgogIC8vIDQuIEJ1ZGdldCBnb2FsIGNoZWNrIOKAlCBmaW5kIG1vc3Qgb3Zlci1idWRnZXQgY2F0ZWdvcnkKICBjb25zdCBleHBHb2FscyA9IGdldEJ1ZGdldEdvYWxzKCdleHBlbnNlJyk7CiAgaWYgKGV4cEdvYWxzLmxlbmd0','aCA+IDAgJiYgY3VycmVudFBlcmlvZCAhPT0gJ3llYXInKSB7CiAgICBjb25zdCBvdmVyQnVkZ2V0ID0gZXhwR29hbHMubWFwKGcgPT4gewogICAgICBjb25zdCBhY3R1YWwgPSBnZXRCdWRnZXRBY3R1YWwoZywgdmlld01vbnRoKTsKICAgICAgY29uc3QgYnVkZ2V0ID0gTnVtYmVyKGcuYW1vdW50IHx8IDApOwogICAgICByZXR1cm4geyBuYW1lOiBnLm5hbWUsIG92ZXI6IGFjdHVhbCAtIGJ1ZGdldCwgcGN0OiBidWRnZXQgPiAwID8gYWN0dWFsL2J1ZGdldCoxMDAgOiAwIH07CiAgICB9KS5maWx0ZXIoZyA9PiBnLm92ZXIgPiAwKS5zb3J0KChhLGIpID0+IGIucGN0IC0gYS5wY3QpOwogICAgaWYgKG92ZXJCdWRnZXQubGVuZ3RoID4gMCkgewogICAgICBjb25zdCB3b3JzdCA9IG92ZXJCdWRnZXRbMF07CiAgICAgIGNoaXBzLnB1c2goeyB0eXBlOidhbGVydCcsIGljb246J/Cfjq8nLCB0aXRsZTpgJHt3b3JzdC5uYW1lfSBvdmVyIGJ1ZGdldGAsIHN1YjpgJHtmbXQod29yc3Qub3Zlcil9IG92ZXIgbGltaXQg4oCUICR7d29yc3QucGN0LnRvRml4ZWQoMCl9JSBvZiBidWRnZXQgdXNlZGAgfSk7CiAgICB9IGVsc2UgaWYgKGV4cEdvYWxzLmxlbmd0aCA+IDApIHsKICAgICAgY2hpcHMucHVzaCh7IHR5cGU6J2dvb2QnLCBpY29uOifinIUnLCB0aXRsZTonQWxsIGNhdGVnb3JpZXMgd2l0aGluIGJ1ZGdldCcsIHN1YjonR3JlYXQgam9iIHN0YXlpbmcgb24gdHJhY2sgdGhpcyBwZXJpb2QhJyB9KTsKICAgIH0KICB9CgogIC8vIDUuIEJpZ2dlc3Qgc2luZ2xlIGRheSAobW9udGgvd2VlayBtb2RlIG9ubHkpCiAgaWYgKGN1cnJlbnRQZXJpb2QgIT09ICd5ZWFyJykgewogICAgY29uc3QgZGF5VG90YWxzID0ge307CiAgICBleHBlbnNlcy5mb3JFYWNoKGUgPT4gewogICAgICBjb25zdCBkID0gKGUuZGF0ZXx8JycpLnN1YnN0cmluZygwLDEwKTsKICAgICAgaWYgKGQpIGRheVRvdGFsc1tkXSA9IChkYXlUb3RhbHNbZF18fDApICsgY29udmVydEFtdChlLmFtb3VudCxlLmN1cnJlbmN5KTsKICAgIH0pOwogICAgY29uc3QgZGF5RW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGRheVRvdGFscykuc29ydCgoYSxiKSA9PiBiWzFdLWFbMV0pOwogICAgaWYgKGRheUVudHJpZXMubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBbYmlnRGF5LCBiaWdBbXRdID0gZGF5RW50cmllc1swXTsKICAgICAgY29uc3QgZCA9IG5ldyBEYXRlKGJpZ0RheSsnVDAwOjAwOjAwJyk7CiAgICAgIGNvbnN0IGxhYmVsID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnfSk7CiAgICAgIGNoaXBzLnB1c2goeyB0eXBlOiBiaWdBbXQgPiB0b3RhbEV4cCAqIDAuMjUgPyAnd2FybicgOiAnbmV1dHJhbCcsIGljb246J/Cfk4UnLCB0aXRsZTpgQmlnZ2VzdCBzcGVuZCBkYXk6ICR7bGFiZWx9YCwgc3ViOmAke2ZtdChiaWdBbXQpfSBzcGVudCDigJQgJHt0b3RhbEV4cD4wPyhiaWdBbXQvdG90YWxFeHAqMTAwKS50b0ZpeGVkKDApOjB9JSBvZiBtb250aGx5IHRvdGFsIGluIG9uZSBkYXlgIH0pOwogICAgfQogIH0KCiAgLy8gNi4gTm8tc3BlbmQgLyBsb3ctc3BlbmQgZW5jb3VyYWdlbWVudAogIGlmICh0b3RhbEV4cCA9PT0gMCAmJiB0b3RhbEluYyA9PT0gMCkgewogICAgY2hpcHMucHVzaCh7IHR5cGU6J25ldXRyYWwnLCBpY29uOifwn4yxJywgdGl0bGU6J05vIGRhdGEgeWV0IGZvciB0aGlzIHBlcmlvZCcsIHN1YjonQWRkIHRyYW5zYWN0aW9ucyBvciBpbXBvcnQgeW91ciBFeGNlbCBmaWxlcyBmcm9tIHRoZSBJbXBvcnQgdGFiJyB9KTsKICB9CgogIGNoaXBzRWwuaW5uZXJIVE1MID0gY2hpcHMubWFwKGMgPT4gYAogICAgPGRpdiBjbGFzcz0iaW5zaWdodC1jaGlwICR7Yy50eXBlfSI+CiAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC1pY29uIj4ke2MuaWNvbn08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW5zaWdodC1jaGlwLXRleHQiPgogICAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC10aXRsZSI+JHtjLnRpdGxlfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Imluc2lnaHQtY2hpcC1zdWIiPiR7Yy5zdWJ9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YCkuam9pbignJyk7Cn0KY29uc3QgREVGQVVMVF9JTlZfQ0FSRFMgPSBbCiAgeyBrZXk6J1N0b2NrcycsICAgICAgbGFiZWw6J1N0b2NrcycsICAgICAgICAgIGljb246J/Cfk4onLCBjb2xvcjonIzRBOUVGRicsIGJnOicjRUVGNUZGJywgZmllbGRUZW1wbGF0ZTonU3RvY2tzJywgICAgICB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonQ3J5cHRvJywgICAgICBsYWJlbDonQ3J5cHRvJywgICAgICAgICAgaWNvbjon8J+qmScsIGNvbG9yOicjRjU5RTBCJywgYmc6JyNGRkZCRUUnLCBmaWVsZFRlbXBsYXRlOidDcnlwdG8nLCAgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidNZXRhbHMnLCAgICAgIGxhYmVsOidNZXRhbHMnLCAgICAgICAgICBpY29uOifwn6WHJywgY29sb3I6JyNDODkwMEEnLCBiZzonI0ZGRjhFMCcsIGZpZWxkVGVtcGxhdGU6J01ldGFscycsICAgICAgdmlzaWJsZTp0cnVlIH0sCiAgeyBrZXk6J1JlYWwgRXN0YXRlJywgbGFiZWw6J1JlYWwgRXN0YXRlJywgICAgIGljb246J/Cfj6EnLCBjb2xvcjonIzEwQjk4MScsIGJnOicjRjBGQkYzJywgZmllbGRUZW1wbGF0ZTonUmVhbCBFc3RhdGUnLCB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonRVRGL01GJywgICAgICBsYWJlbDonRVRGIC8gTUYnLCAgICAgICAgaWNvbjon8J+XgicsIGNvbG9yOicjN0MzQUVEJywgYmc6JyNGM0VFRkYnLCBmaWVsZFRlbXBsYXRlOidFVEYvTUYnLCAgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidQRi9WUEYnLCAgICAgIGxhYmVsOidQRiAvIFZQRicsICAgICAgICBpY29uOifwn4+b77iPJywgY29sb3I6JyMwRUE1RTknLCBiZzonI0UwRjJGRScsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTp0cnVlIH0sCiAgeyBrZXk6J05QUycsICAgICAgICAgbGFiZWw6J05QUycsICAgICAgICAgICAgIGljb246J/Cfp5MnLCBjb2xvcjonIzhCNUNGNicsIGJnOicjRjNFRUZGJywgZmllbGRUZW1wbGF0ZTonR2VuZXJhbCcsICAgICB2aXNpYmxlOnRydWUgfSwKICB7IGtleTonUFBGJywgICAgICAgICBsYWJlbDonUFBGJywgICAgICAgICAgICAgaWNvbjon8J+TricsIGNvbG9yOicjMDU5NjY5JywgYmc6JyNFQ0ZERjUnLCBmaWVsZFRlbXBsYXRlOidHZW5lcmFsJywgICAgIHZpc2libGU6dHJ1ZSB9LAogIHsga2V5OidGRCcsICAgICAgICAgIGxhYmVsOidGaXhlZCBEZXBvc2l0JywgICBpY29uOifwn4+mJywgY29sb3I6JyNEOTc3MDYnLCBiZzonI0ZGRkJFQicsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTpmYWxzZSB9LAogIHsga2V5OidJbnN1cmFuY2UnLCAgIGxhYmVsOidJbnN1cmFuY2UnLCAgICAgICBpY29uOifwn5uh77iPJywgY29sb3I6JyNEQzI2MjYnLCBiZzonI0ZFRjJGMicsIGZpZWxkVGVtcGxhdGU6J0dlbmVyYWwnLCAgICAgdmlzaWJsZTpmYWxzZSB9LApdOwoKLy8gSU5WX0NBVFMga2VwdCBhcyBhbiBhbGlhcyBmb3IgYW55IGxlZ2FjeSByZWFkcwpjb25zdCBJTlZfQ0FUUyA9IERFRkFVTFRfSU5WX0NBUkRTOwoKLy8gR2VuZXJhbCBmaWVsZCB0ZW1wbGF0ZSBmb3Igc2F2aW5ncy9jb250cmlidXRpb24tc3R5bGUgaW52ZXN0bWVudHMgKFBGLCBOUFMsIEZEIGV0Yy4pCmNvbnN0IElOVl9GSUVMRFNfR0VORVJBTCA9IFsKICB7aWQ6J2ludi1zY2hlbWUnLCAgIGxhYmVsOidTY2hlbWUgLyBBY2NvdW50JywgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIFZQRiwgTlBTIFRpZXItMScsICBmdWxsOnRydWV9LAogIHtpZDonaW52LWNvbnRyaWInLCAgbGFiZWw6J0NvbnRyaWJ1dGlvbicsICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogIHtpZDonaW52LXRvdGFsLWFjYycsbGFiZWw6J1RvdGFsIEFjY3VtdWxhdGVkJywgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwIChvcHRpb25hbCknLCAgICAgICAgZnVsbDpmYWxzZX0sCiAge2lkOidpbnYtcmF0ZScsICAgICBsYWJlbDonSW50ZXJlc3QgLyBSZXR1cm4gJScsdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6J2UuZy4gOC4yNScsICAgICAgICAgICAgIGZ1bGw6ZmFsc2V9LAogIHtpZDonaW52LW1hdHVyaXR5JywgbGFiZWw6J01hdHVyaXR5IC8gVGFyZ2V0IERhdGUnLHR5cGU6J3RleHQnLHBsYWNlaG9sZGVyOidlLmcuIDIwMzUnLCAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKXTsKCmZ1bmN0aW9uIGdldEhvbWVJbnZDYXJkcygpIHsKICBpZighZGF0YS5faG9tZUludkNhcmRzKSByZXR1cm4gREVGQVVMVF9JTlZfQ0FSRFMubWFwKGM9Pih7Li4uY30pKTsKICByZXR1cm4gZGF0YS5faG9tZUludkNhcmRzOwp9CmZ1bmN0aW9uIHNhdmVIb21lSW52Q2FyZHMoY2FyZHMpIHsgZGF0YS5faG9tZUludkNhcmRzID0gY2FyZHM7IHNhdmUoKTsgfQoKZnVuY3Rpb24gcmVuZGVySW52ZXN0SG9tZShpbnZlc3RtZW50cykgewogIC8vIEhvbWUgaW52ZXN0bWVudCBjYXJkcyBzaG93IE9OTFkgbW9udGhseSBjYXNoLWZsb3cgdHJhbnNhY3Rpb25zICh3aGF0IHlvdSBpbnZlc3RlZCB0aGlzIG1vbnRoKS4KICAvLyBkYXRhLl9tZXRhbHMgYW5kIGRhdGEuX253QWNjb3VudHMgYXJlIE5ldCBXb3J0aCBob2xkaW5ncyDigJQgdGhleSBORVZFUiBhcHBlYXIgaGVyZS4KICBsZXQgaW52QWxsID0gaW52ZXN0bWVudHMgfHwgW107CgogIGNvbnN0IHRvdGFscyA9IHt9OwogIGludkFsbC5mb3JFYWNoKGludj0+ewogICAgY29uc3QgdHlwZSA9IGludi5pbnZlc3RUeXBlfHxpbnYuY2F0ZWdvcnl8fCdTdG9ja3MnOwogICAgdG90YWxzW3R5cGVdPSh0b3RhbHNbdHlwZV18fDApK2NvbnZlcnRBbXQoaW52LmFtb3VudCwgaW52LmN1cnJlbmN5KTsKICB9KTsKICAvLyBOb3RlOiBkYXRhLl9pbnZlc3RtZW50cyAocG9ydGZvbGlvIHBvc2l0aW9ucykgYWxzbyBleGNsdWRlZCBmcm9tIG1vbnRobHkgdG90YWwg4oCUCiAgLy8gcG9ydGZvbGlvIHZhbHVlIOKJoCBhbW91bnQgaW52ZXN0ZWQgdGhpcyBtb250aC4KCiAgY29uc3QgZ3JhbmRUb3RhbCA9IE9iamVjdC52YWx1ZXModG90YWxzKS5yZWR1Y2UoKHMsdik9PnMrdiwwKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9tZS1pbnZlc3QtdG90YWwnKS50ZXh0Q29udGVudCA9IGZtdChncmFuZFRvdGFsKTsKCiAgLy8gVXNlIGR5bmFtaWMgY2FyZHMKICBjb25zdCBjYXJkcyA9IGdldEhvbWVJbnZDYXJkcygpLmZpbHRlcihjPT5jLnZpc2libGUhPT1mYWxzZSk7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtY2F0LWdyaWQnKTsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcChjYXJkPT57CiAgICBjb25zdCBhbXQgPSB0b3RhbHNbY2FyZC5rZXldfHwwOwogICAgY29uc3QgcGN0ID0gZ3JhbmRUb3RhbD4wP01hdGgubWluKGFtdC9ncmFuZFRvdGFsKjEwMCwxMDApOjA7CiAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImludmVzdC1jYXQtY2FyZCIgc3R5bGU9ImJhY2tncm91bmQ6JHtjYXJkLmJnfHwnI0Y4RjhGOCd9OyIgb25jbGljaz0iY2xvc2VGYWJNZW51KCk7b3BlblF1aWNrQWRkKCdpbnZlc3RtZW50JywnJHtjYXJkLmtleX0nKSI+CiAgICAgIDxkaXYgY2xhc3M9Imludi1jYXJkLWljb24iIHN0eWxlPSJiYWNrZ3JvdW5kOiR7Y2FyZC5jb2xvcn0yMjsiPiR7Y2FyZC5pY29ufTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbnYtY2FyZC1sYWJlbCI+JHtjYXJkLmxhYmVsfHxjYXJkLmtleX08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW52LWNhcmQtYW10Ij4ke2ZtdChhbXQpfTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbnYtY2FyZC11bml0cyI+JHthbXQ+MD8nVGFwIHRvIGFkZCBtb3JlJzonVGFwIHRvIHN0YXJ0IHRyYWNraW5nJ308L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW52','LWNhcmQtYmFyIj48ZGl2IGNsYXNzPSJpbnYtY2FyZC1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiR7cGN0fSU7YmFja2dyb3VuZDoke2NhcmQuY29sb3J9OyI+PC9kaXY+PC9kaXY+CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpICsKICBgPGRpdiBzdHlsZT0iZ3JpZC1jb2x1bW46c3BhbiAyO2JhY2tncm91bmQ6dmFyKC0td2hpdGUpO2JvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTtib3gtc2hhZG93OnZhcigtLWNhcmQtc2hhZG93KTtwYWRkaW5nOjE0cHg7dGV4dC1hbGlnbjpjZW50ZXI7Y3Vyc29yOnBvaW50ZXI7IiBvbmNsaWNrPSJzd2l0Y2hTY3JlZW4oJ25ldHdvcnRoJyxkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LWl0ZW06bnRoLWNoaWxkKDQpJykpIj4KICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOWVtO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPvCfko4gVmlldyBOZXQgV29ydGgg4oaSPC9zcGFuPgogIDwvZGl2PmA7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBRVUlDSyBBREQgUE9QVVAgKEggcmVxdWlyZW1lbnQg4oCUIHBvcHVwIGluc3RlYWQgb2YgVFhOIHBhZ2UpCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApmdW5jdGlvbiBvcGVuUXVpY2tBZGQodHlwZSwgc3ViQ2F0KSB7CiAgcWFUeXBlID0gdHlwZSB8fCAnZXhwZW5zZSc7CiAgcWFBbW91bnRTdHIgPSAnJzsKICBxYVByZXNlbGVjdFN1YkNhdCA9IHN1YkNhdCB8fCBudWxsOwoKICAvLyBTZXQgdHlwZSBjaGlwcwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5xYS10eXBlLWNoaXAnKS5mb3JFYWNoKGMgPT4gYy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgY29uc3QgY2hpcCA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucWEtdHlwZS1jaGlwJyldLmZpbmQoYyA9PiBjLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModHlwZSkpOwogIGlmKGNoaXApIGNoaXAuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CgogIC8vIFJlc2V0IGFtb3VudAogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1hbW91bnQtZGlzcGxheScpLnZhbHVlID0gJzAnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1kYXRlLWlucHV0JykudmFsdWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbm90ZS1pbnB1dCcpLnZhbHVlID0gJyc7CiAgY29uc3QgX21nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLWdyYW1zJyk7IGlmIChfbWcpIF9tZy52YWx1ZSA9ICcnOwogIGNvbnN0IF9tZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1maWVsZHMnKTsgaWYgKF9tZikgX21mLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogIHFhUmVuZGVyU3ViQ2F0cygpOwogIHFhUmVuZGVyTnVtcGFkKCk7CgogIC8vIFNldCB0aXRsZQogIGNvbnN0IGljb25zID0geyBleHBlbnNlOifwn5K4JywgaW5jb21lOifwn5K1JywgaW52ZXN0bWVudDon8J+TiCcsIGRlYnQ6J/Cfk4knLCBnaXZlbjon8J+knScsIGFkZGl0aW9uYWw6J/CfjoEnIH07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1vZGFsLXRpdGxlJykudGV4dENvbnRlbnQgPSAoaWNvbnNbdHlwZV18fCfinpUnKSArICcgUXVpY2sgQWRkICcgKyAodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0eXBlLnNsaWNlKDEpKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aWNrLWFkZC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKfQoKZnVuY3Rpb24gcWFTZXRUeXBlKHR5cGUsIGVsKSB7CiAgcWFUeXBlID0gdHlwZTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucWEtdHlwZS1jaGlwJykuZm9yRWFjaChjID0+IGMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHFhUHJlc2VsZWN0U3ViQ2F0ID0gbnVsbDsKICBxYVJlbmRlclN1YkNhdHMoKTsKICBjb25zdCBpY29ucyA9IHsgZXhwZW5zZTon8J+SuCcsIGluY29tZTon8J+StScsIGludmVzdG1lbnQ6J/Cfk4gnLCBkZWJ0Oifwn5OJJywgZ2l2ZW46J/CfpJ0nLCBhZGRpdGlvbmFsOifwn46BJyB9OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tb2RhbC10aXRsZScpLnRleHRDb250ZW50ID0gKGljb25zW3R5cGVdfHwn4p6VJykgKyAnIFF1aWNrIEFkZCAnICsgKHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrdHlwZS5zbGljZSgxKSk7CiAgX3FhVG9nZ2xlTWV0YWxGaWVsZHMoKTsKfQoKbGV0IHFhRGVsZXRlTW9kZSA9IGZhbHNlOwoKZnVuY3Rpb24gcWFSZW5kZXJTdWJDYXRzKCkgewogIHFhRGVsZXRlTW9kZSA9IGZhbHNlOwogIGNvbnN0IGNhdHMgPSBnZXRDYXRzRm9yVHlwZShxYVR5cGUpOwogIHFhU3ViQ2F0ID0gcWFQcmVzZWxlY3RTdWJDYXQgfHwgY2F0c1swXSB8fCAnJzsKICBpZihxYVByZXNlbGVjdFN1YkNhdCAmJiAhY2F0cy5pbmNsdWRlcyhxYVByZXNlbGVjdFN1YkNhdCkpIHsKICAgIHFhU3ViQ2F0ID0gY2F0c1swXSB8fCAnJzsKICB9CiAgX3JlbmRlclFhUGlsbHMoY2F0cyk7Cn0KCmZ1bmN0aW9uIF9yZW5kZXJRYVBpbGxzKGNhdHMpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtc3ViLWNhdHMnKTsKICAvLyBSZWd1bGFyIHBpbGxzCiAgY29uc3QgcGlsbHNIdG1sID0gY2F0cy5tYXAoKGMsaSkgPT4gewogICAgY29uc3QgaXNBY3RpdmUgPSBjID09PSBxYVN1YkNhdDsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0icWEtc3ViLXBpbGwgJHtpc0FjdGl2ZT8nYWN0aXZlJzonJ30gJHtxYURlbGV0ZU1vZGU/J2RlbGV0ZS1tb2RlJzonJ30iCiAgICAgIG9uY2xpY2s9ImlmKCFxYURlbGV0ZU1vZGUpcWFTZWxlY3RTdWIoJyR7Y30nLHRoaXMpIgogICAgICBvbmNvbnRleHRtZW51PSJldmVudC5wcmV2ZW50RGVmYXVsdCgpO3FhVG9nZ2xlRGVsZXRlTW9kZSgpIgogICAgICB0aXRsZT0iJHtxYURlbGV0ZU1vZGU/J3RhcCDinJUgdG8gcmVtb3ZlJzonaG9sZCB0byBtYW5hZ2UnfSI+CiAgICAgICR7Y30KICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtcGlsbC1kZWwiIG9uY2xpY2s9ImV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO3FhUmVtb3ZlQ2F0KCR7aX0pIj7inJU8L2J1dHRvbj4KICAgIDwvZGl2PmA7CiAgfSkuam9pbignJyk7CiAgLy8gQWRkIHBpbGwgb3IgZG9uZSBidXR0b24KICBjb25zdCBhY3Rpb25QaWxsID0gcWFEZWxldGVNb2RlCiAgICA/IGA8ZGl2IGNsYXNzPSJxYS1zdWItcGlsbCIgc3R5bGU9ImJhY2tncm91bmQ6I0ZGRjBGMDtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ym9yZGVyLWNvbG9yOiNGRkNDQ0M7IiBvbmNsaWNrPSJxYVRvZ2dsZURlbGV0ZU1vZGUoKSI+4pyUIERvbmU8L2Rpdj5gCiAgICA6IGA8ZGl2IGNsYXNzPSJxYS1zdWItcGlsbCIgc3R5bGU9ImJhY2tncm91bmQ6dmFyKC0teWVsbG93LWxpZ2h0KTtib3JkZXItY29sb3I6dmFyKC0teWVsbG93KTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO2ZvbnQtd2VpZ2h0OjkwMDsiIG9uY2xpY2s9InFhU2hvd0FkZElucHV0KCkiPu+8iyBBZGQ8L2Rpdj5gOwogIGNvbnRhaW5lci5pbm5lckhUTUwgPSBwaWxsc0h0bWwgKyBhY3Rpb25QaWxsOwp9CgpmdW5jdGlvbiBxYVRvZ2dsZURlbGV0ZU1vZGUoKSB7CiAgcWFEZWxldGVNb2RlID0gIXFhRGVsZXRlTW9kZTsKICBfcmVuZGVyUWFQaWxscyhnZXRDYXRzRm9yVHlwZShxYVR5cGUpKTsKfQoKZnVuY3Rpb24gcWFSZW1vdmVDYXQoaWR4KSB7CiAgY29uc3QgY2F0cyA9IGdldENhdHNGb3JUeXBlKHFhVHlwZSk7CiAgY29uc3QgY2F0ID0gY2F0c1tpZHhdOwogIGlmKCFjYXQpIHJldHVybjsKICAvLyBJbml0aWFsaXplIGN1c3RvbSBpZiBuZWVkZWQKICBjb25zdCBjYyA9IGdldEN1c3RvbUNhdHMoKTsKICBpZighY2NbcWFUeXBlXSkgY2NbcWFUeXBlXSA9IFsuLi4oREVGQVVMVF9DQVRTW3FhVHlwZV18fFtdKV07CiAgY2NbcWFUeXBlXS5zcGxpY2UoaWR4LCAxKTsKICBpZihxYVN1YkNhdCA9PT0gY2F0KSBxYVN1YkNhdCA9IGNjW3FhVHlwZV1bMF0gfHwgJyc7CiAgc2F2ZSgpOwogIF9yZW5kZXJRYVBpbGxzKGNjW3FhVHlwZV0pOwogIHJlbmRlckNhdFBpbGxzKCk7IC8vIHN5bmMgc2V0dGluZ3MgdmlldwogIHNob3dUb2FzdChgIiR7Y2F0fSIgcmVtb3ZlZGApOwp9CgpmdW5jdGlvbiBxYVNob3dBZGRJbnB1dCgpIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtc3ViLWNhdHMnKTsKICAvLyBBcHBlbmQgaW5saW5lIGlucHV0IGFmdGVyIGV4aXN0aW5nIHBpbGxzCiAgY29uc3QgZXhpc3RpbmcgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnFhLXN1Yi1waWxsJyk7CiAgZXhpc3RpbmcuZm9yRWFjaChwID0+IHAuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7CiAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgcm93LnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTpmbGV4O2dhcDo2cHg7d2lkdGg6MTAwJTttYXJnaW4tdG9wOjRweDsnOwogIHJvdy5pbm5lckhUTUwgPSBgCiAgICA8aW5wdXQgaWQ9InFhLW5ldy1jYXQtaW5wdXQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJDYXRlZ29yeSBuYW1lLi4uIgogICAgICBzdHlsZT0iZmxleDoxO2JvcmRlcjoxLjVweCBzb2xpZCB2YXIoLS15ZWxsb3cpO2JvcmRlci1yYWRpdXM6MTBweDtwYWRkaW5nOjdweCAxMHB4O2ZvbnQtZmFtaWx5Ok51bml0byxzYW5zLXNlcmlmO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7b3V0bGluZTpub25lOyIKICAgICAgb25rZXlkb3duPSJpZihldmVudC5rZXk9PT0nRW50ZXInKXFhQ29uZmlybUFkZENhdCgpIj4KICAgIDxidXR0b24gb25jbGljaz0icWFDb25maXJtQWRkQ2F0KCkiIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLXllbGxvdyk7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6N3B4IDE0cHg7Zm9udC1mYW1pbHk6TnVuaXRvLHNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjg1ZW07Y3Vyc29yOnBvaW50ZXI7Ij5BZGQ8L2J1dHRvbj4KICAgIDxidXR0b24gb25jbGljaz0icWFSZW5kZXJTdWJDYXRzKCkiIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6N3B4IDEycHg7Zm9udC1mYW1pbHk6TnVuaXRvLHNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg1ZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+Q2FuY2VsPC9idXR0b24+CiAgYDsKICBjb250YWluZXIuYXBwZW5kQ2hpbGQocm93KTsKICBzZXRUaW1lb3V0KCgpPT5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbmV3LWNhdC1pbnB1dCcpPy5mb2N1cygpLCA1MCk7Cn0KCmZ1bmN0aW9uIHFhQ29uZmlybUFkZENhdCgpIHsKICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1uZXctY2F0LWlucHV0Jyk7CiAgY29uc3QgbmFtZSA9IChpbnB1dD8udmFsdWV8fCcnKS50cmltKCk7CiAgaWYoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIG5hbWUg4p2MJyk7IHJldHVybjsgfQogIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogIGlmKCFjY1txYVR5cGVdKSBjY1txYVR5cGVd','ID0gWy4uLihERUZBVUxUX0NBVFNbcWFUeXBlXXx8W10pXTsKICBpZihjY1txYVR5cGVdLmluY2x1ZGVzKG5hbWUpKSB7IHNob3dUb2FzdCgnQWxyZWFkeSBleGlzdHMg4pqg77iPJyk7IHJldHVybjsgfQogIGNjW3FhVHlwZV0ucHVzaChuYW1lKTsKICBxYVN1YkNhdCA9IG5hbWU7CiAgc2F2ZSgpOwogIHFhUmVuZGVyU3ViQ2F0cygpOwogIHJlbmRlckNhdFBpbGxzKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGFkZGVkIWApOwp9Cgpjb25zdCBfTUVUQUxfQ0FUUyA9IFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJywnbWV0YWxzJywncHJlY2lvdXMnXTsKZnVuY3Rpb24gX3FhVG9nZ2xlTWV0YWxGaWVsZHMoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtZmllbGRzJyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IHNob3cgPSBxYVR5cGUgPT09ICdpbnZlc3RtZW50JyAmJiBfTUVUQUxfQ0FUUy5zb21lKG0gPT4gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhtKSk7CiAgZWwuc3R5bGUuZGlzcGxheSA9IHNob3cgPyAnYmxvY2snIDogJ25vbmUnOwogIGlmIChzaG93KSB7CiAgICAvLyBBdXRvLXNlbGVjdCBtZXRhbCB0eXBlIHRvIG1hdGNoIHRoZSBjaG9zZW4gc3ViLWNhdGVnb3J5IHBpbGwKICAgIGNvbnN0IG10ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLXR5cGUnKTsKICAgIGlmIChtdCkgewogICAgICBjb25zdCBzID0gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKTsKICAgICAgbXQudmFsdWUgPSBzLmluY2x1ZGVzKCdzaWx2ZXInKSA/ICdzaWx2ZXInIDogcy5pbmNsdWRlcygncGxhdGludW0nKSA/ICdwbGF0aW51bScgOiAnZ29sZCc7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBxYVNlbGVjdFN1YihjYXQsIGVsKSB7CiAgcWFTdWJDYXQgPSBjYXQ7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnFhLXN1Yi1waWxsJykuZm9yRWFjaChwID0+IHAuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGVsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIF9xYVRvZ2dsZU1ldGFsRmllbGRzKCk7Cn0KCmZ1bmN0aW9uIHFhUmVuZGVyTnVtcGFkKCkgewogIGNvbnN0IGtleXMgPSBbJzEnLCcyJywnMycsJzQnLCc1JywnNicsJzcnLCc4JywnOScsJy4nLCAgJzAnLCfijKsnXTsKICBjb25zdCBjbHMgICA9IFsnJywnJywnJywnJywnJywnJywnJywnJywnJywncWEtZG90JywnJywncWEtZGVsJ107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW51bXBhZCcpLmlubmVySFRNTCA9IGtleXMubWFwKChrLGkpID0+CiAgICBgPGJ1dHRvbiBjbGFzcz0icWEta2V5ICR7Y2xzW2ldfSIgb25jbGljaz0icWFOdW1wcmVzcygnJHtrfScpIj4ke2t9PC9idXR0b24+YAogICkuam9pbignJykgKyBgPGJ1dHRvbiBjbGFzcz0icWEta2V5IHFhLXNhdmUiIHN0eWxlPSJncmlkLWNvbHVtbjpzcGFuIDM7IiBvbmNsaWNrPSJxYVNhdmUoKSI+4pyFIFNhdmUgRW50cnk8L2J1dHRvbj5gOwp9CgpmdW5jdGlvbiBxYU51bXByZXNzKGtleSkgewogIGlmKGtleSA9PT0gJ+KMqycpIHsKICAgIHFhQW1vdW50U3RyID0gcWFBbW91bnRTdHIuc2xpY2UoMCwtMSk7CiAgfSBlbHNlIHsKICAgIGlmKHFhQW1vdW50U3RyLmluY2x1ZGVzKCcuJykgJiYga2V5ID09PSAnLicpIHJldHVybjsKICAgIGlmKHFhQW1vdW50U3RyLmxlbmd0aCA+PSAxMCkgcmV0dXJuOwogICAgcWFBbW91bnRTdHIgKz0ga2V5OwogIH0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtYW1vdW50LWRpc3BsYXknKS52YWx1ZSA9IHFhQW1vdW50U3RyIHx8ICcwJzsKfQoKZnVuY3Rpb24gcWFTYXZlKCkgewogIGNvbnN0IGFtb3VudCA9IHBhcnNlRmxvYXQocWFBbW91bnRTdHIpOwogIGlmKCFhbW91bnQgfHwgYW1vdW50IDw9IDApIHsgc2hvd1RvYXN0KCdFbnRlciBhbiBhbW91bnQg4p2MJyk7IHJldHVybjsgfQogIGNvbnN0IGRhdGUgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtZGF0ZS1pbnB1dCcpLnZhbHVlIHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGNvbnN0IG5vdGUgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbm90ZS1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBtb250aEtleSA9IGdldE1vbnRoS2V5KGRhdGUpIHx8IGdldEN1cnJlbnRNb250aEtleSgpOwogIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsKCiAgY29uc3QgZW50cnkgPSB7IGRhdGU6IG5vcm1hbGl6ZURhdGUoZGF0ZSksIGNhdGVnb3J5OiBxYVN1YkNhdHx8J090aGVyJywgYW1vdW50LCBkZXNjcmlwdGlvbjogbm90ZSwgY3VycmVuY3k6IGN1cnJlbnRDdXJyZW5jeS5jb2RlIH07CgogIC8vIElmIHRoaXMgaXMgYSBtZXRhbCBwdXJjaGFzZSwgYXR0YWNoIGdyYW1zIHNvIHRoZSB0cmFuc2FjdGlvbiBjYXJyaWVzIGZ1bGwgY29udGV4dAogIGNvbnN0IGlzTWV0YWwgPSBxYVR5cGUgPT09ICdpbnZlc3RtZW50JyAmJiBfTUVUQUxfQ0FUUy5zb21lKG0gPT4gKHFhU3ViQ2F0fHwnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhtKSk7CiAgaWYgKGlzTWV0YWwpIHsKICAgIGNvbnN0IGdyYW1zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtZ3JhbXMnKTsKICAgIGNvbnN0IHVuaXRFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtdW5pdCcpOwogICAgY29uc3QgdHlwZUVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC10eXBlJyk7CiAgICBjb25zdCByYXdHcmFtcyA9IHBhcnNlRmxvYXQoZ3JhbXNFbD8udmFsdWUpIHx8IDA7CiAgICBjb25zdCB1bml0ICAgICA9IHVuaXRFbD8udmFsdWUgfHwgJ2cnOwogICAgY29uc3QgZ3JhbXMgICAgPSB1bml0ID09PSAnb3onID8gcmF3R3JhbXMgKiAzMS4xMDM1IDogcmF3R3JhbXM7CiAgICBpZiAoZ3JhbXMgPiAwKSB7CiAgICAgIGVudHJ5Lm1ldGFsR3JhbXMgPSBwYXJzZUZsb2F0KGdyYW1zLnRvRml4ZWQoNCkpOwogICAgICBlbnRyeS5tZXRhbFR5cGUgID0gdHlwZUVsPy52YWx1ZSB8fCAnZ29sZCc7CiAgICB9CiAgfQoKICBjb25zdCB0eXBlTWFwID0ge2V4cGVuc2U6J2V4cGVuc2VzJyxpbmNvbWU6J2luY29tZScsaW52ZXN0bWVudDonaW52ZXN0bWVudHMnLGRlYnQ6J2RlYnRzJyxnaXZlbjonZ2l2ZW5Ub090aGVycycsYWRkaXRpb25hbDonYWRkaXRpb25hbCd9OwogIGRhdGFbbW9udGhLZXldW3R5cGVNYXBbcWFUeXBlXV0ucHVzaChlbnRyeSk7CiAgc2F2ZSgpOwoKICAvLyBCdWlsZCB0b2FzdCBtZXNzYWdlCiAgbGV0IHRvYXN0TXNnID0gJ+KchSBTYXZlZCEnOwogIGlmIChpc01ldGFsICYmIGVudHJ5Lm1ldGFsR3JhbXMpIHsKICAgIGNvbnN0IG1jID0gTUVUQUxfQ09ORklHW2VudHJ5Lm1ldGFsVHlwZV0gfHwgTUVUQUxfQ09ORklHWydnb2xkJ107CiAgICB0b2FzdE1zZyA9IGAke21jLmVtb2ppfSAke2VudHJ5Lm1ldGFsR3JhbXMudG9GaXhlZCgyKX1nICR7ZW50cnkubWV0YWxUeXBlfSDCtyAke2ZtdChhbW91bnQpfSByZWNvcmRlZGA7CiAgfQoKICBxYUFtb3VudFN0ciA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1hbW91bnQtZGlzcGxheScpLnZhbHVlID0gJzAnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1ub3RlLWlucHV0JykudmFsdWUgPSAnJzsKICBjb25zdCBfbWcyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLW1ldGFsLWdyYW1zJyk7IGlmIChfbWcyKSBfbWcyLnZhbHVlID0gJyc7CiAgY29uc3QgX21mMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1maWVsZHMnKTsgaWYgKF9tZjIpIF9tZjIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBzaG93VG9hc3QodG9hc3RNc2cpOwogIGlmKG1vbnRoS2V5ID09PSB2aWV3TW9udGgpIHJlbmRlckhvbWUoKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElOVkVTVE1FTlQgUVVJQ0stQUREIE1PREFMCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApjb25zdCBJTlZfRklFTERTID0gewogICdTdG9ja3MnOiBbCiAgICB7aWQ6J2ludi10aWNrZXInLCAgbGFiZWw6J1RpY2tlciAvIE5hbWUnLCAgICB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBBQVBMLCBGWEFJWCcsIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtc2hhcmVzJywgIGxhYmVsOidTaGFyZXMnLCAgICAgICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi1hdmdjb3N0JywgbGFiZWw6J0F2ZyBDb3N0IC8gU2hhcmUnLCAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAnLCAgICAgICAgICAgICAgZnVsbDpmYWxzZSwgY2FsYzp0cnVlfSwKICAgIHtpZDonaW52LWN1cnByaWNlJyxsYWJlbDonQ3VycmVudCBQcmljZScsICAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LWJyb2tlcicsICBsYWJlbDonQnJva2VyIC8gUGxhdGZvcm0nLCB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBGaWRlbGl0eScsICAgICBmdWxsOnRydWV9LAogIF0sCiAgJ0NyeXB0byc6IFsKICAgIHtpZDonaW52LWNvaW4nLCAgICBsYWJlbDonQ29pbiAvIFRva2VuJywgICAgICB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBCVEMsIEVUSCcsICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXVuaXRzJywgICBsYWJlbDonVW5pdHMgLyBRdHknLCAgICAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMDAwMDAnLCAgICAgICAgICAgZnVsbDpmYWxzZSwgY2FsYzp0cnVlfSwKICAgIHtpZDonaW52LWJ1eXByaWNlJyxsYWJlbDonQnV5IFByaWNlIC8gVW5pdCcsICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMC4wMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VycHJpY2UnLGxhYmVsOidDdXJyZW50IFByaWNlJywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtZXhjaGFuZ2UnLGxhYmVsOidFeGNoYW5nZScsICAgICAgICAgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIENvaW5iYXNlJywgICAgICBmdWxsOnRydWV9LAogIF0sCiAgJ01ldGFscyc6IFsKICAgIHtpZDonaW52LW1ldGFsJywgICBsYWJlbDonTWV0YWwgVHlwZScsICAgICAgICB0eXBlOidzZWxlY3QnLCBvcHRpb25zOlsnR29sZCcsJ1NpbHZlcicsJ1BsYXRpbnVtJywnUGFsbGFkaXVtJywnT3RoZXInXSwgZnVsbDpmYWxzZX0sCiAgICB7aWQ6J2ludi11bml0JywgICAgbGFiZWw6J1VuaXQnLCAgICAgICAgICAgICAgdHlwZTonc2VsZWN0Jywgb3B0aW9uczpbJ2dyYW1zJywnb3onLCd0b2xhJ10sICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtcXR5JywgICAgIGxhYmVsOidRdWFudGl0eScsICAgICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwMCcsICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtYXZnY29zdCcsIGxhYmVsOidBdmcgQ29zdCAvIHVuaXQnLCAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgIGZ1','bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi1wdXJpdHknLCAgbGFiZWw6J1B1cml0eSAvIEZvcm0nLCAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gMjJLLCA5OTksIENvaW4nLGZ1bGw6dHJ1ZX0sCiAgXSwKICAnUmVhbCBFc3RhdGUnOiBbCiAgICB7aWQ6J2ludi1wcm9wbmFtZScsbGFiZWw6J1Byb3BlcnR5IE5hbWUnLCAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gRG93bnRvd24gQXB0JywgIGZ1bGw6dHJ1ZX0sCiAgICB7aWQ6J2ludi1jb3VudHJ5JywgbGFiZWw6J0NvdW50cnknLCAgICAgICAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gVVNBLCBJbmRpYScsICAgIGZ1bGw6ZmFsc2V9LAogICAge2lkOidpbnYtcHVyY2hhc2UnLGxhYmVsOidQdXJjaGFzZSBWYWx1ZScsICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VycmVudCcsIGxhYmVsOidDdXJyZW50IFZhbHVlJywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LWFyZWEnLCAgICBsYWJlbDonQXJlYSAoc3FmdC9zcW0pJywgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonMCcsICAgICAgICAgICAgICAgICAgZnVsbDpmYWxzZX0sCiAgXSwKICAnRVRGL01GJzogWwogICAge2lkOidpbnYtZnVuZCcsICAgIGxhYmVsOidGdW5kIE5hbWUnLCAgICAgICAgIHR5cGU6J3RleHQnLCAgIHBsYWNlaG9sZGVyOidlLmcuIFZUU0FYLCBOSUZUWTUwJyxmdWxsOnRydWV9LAogICAge2lkOidpbnYtdW5pdHMnLCAgIGxhYmVsOidVbml0cyAvIFNoYXJlcycsICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtbmF2JywgICAgIGxhYmVsOidBdmcgTkFWIC8gQnV5JywgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlLCBjYWxjOnRydWV9LAogICAge2lkOidpbnYtY3VybmF2JywgIGxhYmVsOidDdXJyZW50IE5BVicsICAgICAgIHR5cGU6J251bWJlcicsIHBsYWNlaG9sZGVyOicwLjAwJywgICAgICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXBsYXRmb3JtJyxsYWJlbDonQnJva2VyIC8gUGxhdGZvcm0nLCB0eXBlOid0ZXh0JywgICBwbGFjZWhvbGRlcjonZS5nLiBWYW5ndWFyZCcsICAgICAgZnVsbDp0cnVlfSwKICBdLAogICdHZW5lcmFsJzogWwogICAge2lkOidpbnYtc2NoZW1lJywgICBsYWJlbDonU2NoZW1lIC8gQWNjb3VudCBOYW1lJywgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gVlBGLCBOUFMgVGllci0xLCBGRCcsIGZ1bGw6dHJ1ZX0sCiAgICB7aWQ6J2ludi1jb250cmliJywgIGxhYmVsOidBbW91bnQgSW52ZXN0ZWQnLCAgICAgICAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAnLCAgICAgICAgICAgICAgICAgICAgIGZ1bGw6ZmFsc2UsIGNhbGM6dHJ1ZX0sCiAgICB7aWQ6J2ludi10b3RhbC1hY2MnLGxhYmVsOidUb3RhbCBBY2N1bXVsYXRlZCcsICAgICAgdHlwZTonbnVtYmVyJywgcGxhY2Vob2xkZXI6JzAuMDAgKG9wdGlvbmFsKScsICAgICAgICAgICBmdWxsOmZhbHNlfSwKICAgIHtpZDonaW52LXJhdGUnLCAgICAgbGFiZWw6J0ludGVyZXN0IC8gUmV0dXJuICUnLCAgICB0eXBlOidudW1iZXInLCBwbGFjZWhvbGRlcjonZS5nLiA4LjI1JywgICAgICAgICAgICAgICAgZnVsbDpmYWxzZX0sCiAgICB7aWQ6J2ludi1tYXR1cml0eScsIGxhYmVsOidNYXR1cml0eSAvIFRhcmdldCcsICAgICAgdHlwZTondGV4dCcsICAgcGxhY2Vob2xkZXI6J2UuZy4gMjAzNSBvciA1IHllYXJzJywgICAgIGZ1bGw6ZmFsc2V9LAogIF0sCn07CgpsZXQgaW52RmllbGRDdXJyZW5jeSA9IHsuLi5jdXJyZW50Q3VycmVuY3l9OwoKZnVuY3Rpb24gb3Blbkludk1vZGFsKHR5cGUpIHsKICBpbnZNb2RhbFR5cGUgPSB0eXBlIHx8ICdTdG9ja3MnOwogIGludkZpZWxkQ3VycmVuY3kgPSB7Li4uY3VycmVudEN1cnJlbmN5fTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LW1vZGFsLWRhdGUnKS52YWx1ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtbm90ZScpLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jb21wdXRlZC10b3RhbCcpLnRleHRDb250ZW50ID0gc3ltKCkrJzAnOwogIHVwZGF0ZUludkN1cnJCdG4oKTsKICAvLyBSZWJ1aWxkIHRhYnMgZnJvbSBsaXZlIGNhcmQgbGlzdAogIF9yZWJ1aWxkSW52TW9kYWxUYWJzKHR5cGUpOwogIHJlbmRlckludkZpZWxkcygpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtcXVpY2stbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7Cn0KCmZ1bmN0aW9uIF9yZWJ1aWxkSW52TW9kYWxUYWJzKGFjdGl2ZUtleSkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCkuZmlsdGVyKGM9PmMudmlzaWJsZSE9PWZhbHNlKTsKICBjb25zdCB0YWJzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXR5cGUtdGFicycpOwogIGlmKCF0YWJzRWwpIHJldHVybjsKICB0YWJzRWwuaW5uZXJIVE1MID0gY2FyZHMubWFwKGNhcmQ9PnsKICAgIGNvbnN0IGlzQWN0aXZlID0gY2FyZC5rZXkgPT09IGFjdGl2ZUtleTsKICAgIGNvbnN0IHRlbXBsYXRlID0gY2FyZC5maWVsZFRlbXBsYXRlfHwnR2VuZXJhbCc7CiAgICBjb25zdCBiZyA9IGlzQWN0aXZlID8gY2FyZC5jb2xvciA6ICcnOwogICAgY29uc3QgY29sID0gaXNBY3RpdmUgPyAnd2hpdGUnIDogJyc7CiAgICByZXR1cm4gYDxidXR0b24gY2xhc3M9Imludi10eXBlLWNoaXAgJHtpc0FjdGl2ZT8nYWN0aXZlJzonJ30iIAogICAgICBzdHlsZT0iYmFja2dyb3VuZDoke2JnfTtjb2xvcjoke2NvbH07IgogICAgICBvbmNsaWNrPSJzZXRJbnZNb2RhbFR5cGUoJyR7Y2FyZC5rZXl9JywnJHt0ZW1wbGF0ZX0nLHRoaXMsJyR7Y2FyZC5jb2xvcn0nKSIKICAgID4ke2NhcmQuaWNvbn0gJHtjYXJkLmxhYmVsfHxjYXJkLmtleX08L2J1dHRvbj5gOwogIH0pLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBzZXRJbnZNb2RhbFR5cGUoa2V5LCB0ZW1wbGF0ZSwgYnRuLCBjb2xvcikgewogIGludk1vZGFsVHlwZSA9IGtleTsKICBpbnZNb2RhbFRlbXBsYXRlID0gKHR5cGVvZiB0ZW1wbGF0ZSA9PT0gJ3N0cmluZycgPyB0ZW1wbGF0ZSA6IG51bGwpIHx8ICdHZW5lcmFsJzsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW52LXR5cGUtY2hpcCcpLmZvckVhY2goYz0+e2MuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7Yy5zdHlsZS5iYWNrZ3JvdW5kPScnO2Muc3R5bGUuY29sb3I9Jyc7fSk7CiAgaWYoYnRuICYmIGJ0bi5jbGFzc0xpc3QpIHsKICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3J8fCcjNEE5RUZGJzsKICAgIGJ0bi5zdHlsZS5jb2xvciA9ICd3aGl0ZSc7CiAgfQogIHJlbmRlckludkZpZWxkcygpOwp9CgpmdW5jdGlvbiByZW5kZXJJbnZGaWVsZHMoKSB7CiAgLy8gRGV0ZXJtaW5lIHdoaWNoIGZpZWxkIHRlbXBsYXRlIHRvIHVzZQogIGNvbnN0IGNhcmQgPSBnZXRIb21lSW52Q2FyZHMoKS5maW5kKGM9PmMua2V5PT09aW52TW9kYWxUeXBlKTsKICBjb25zdCB0ZW1wbGF0ZSA9IGNhcmQ/LmZpZWxkVGVtcGxhdGUgfHwgaW52TW9kYWxUZW1wbGF0ZSB8fCAoSU5WX0ZJRUxEU1tpbnZNb2RhbFR5cGVdID8gaW52TW9kYWxUeXBlIDogJ0dlbmVyYWwnKTsKICBjb25zdCBmaWVsZHMgPSBJTlZfRklFTERTW3RlbXBsYXRlXSB8fCBJTlZfRklFTERTWydHZW5lcmFsJ107CiAgY29uc3QgaHRtbCA9IGA8ZGl2IGNsYXNzPSJpbnYtZmllbGRzLWdyaWQiPgogICAgJHtmaWVsZHMubWFwKGY9PnsKICAgICAgY29uc3QgaW5wdXQgPSBmLnR5cGU9PT0nc2VsZWN0JwogICAgICAgID8gYDxzZWxlY3QgY2xhc3M9Imludi1maWVsZC1zZWxlY3QiIGlkPSIke2YuaWR9IiBvbmNoYW5nZT0iY2FsY0ludlRvdGFsKCkiPiR7KGYub3B0aW9uc3x8W10pLm1hcChvPT5gPG9wdGlvbj4ke299PC9vcHRpb24+YCkuam9pbignJyl9PC9zZWxlY3Q+YAogICAgICAgIDogYDxpbnB1dCB0eXBlPSIke2YudHlwZX0iIGNsYXNzPSJpbnYtZmllbGQtaW5wdXQiIGlkPSIke2YuaWR9IiBwbGFjZWhvbGRlcj0iJHtmLnBsYWNlaG9sZGVyfHwnJ30iIHN0ZXA9ImFueSIgb25pbnB1dD0iY2FsY0ludlRvdGFsKCkiPmA7CiAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaW52LWZpZWxkLWJveCR7Zi5mdWxsPycgZnVsbCc6Jyd9Ij5gKwogICAgICAgICAgICAgYDxsYWJlbD4ke2YubGFiZWx9PC9sYWJlbD4ke2lucHV0fTwvZGl2PmA7CiAgICB9KS5qb2luKCcnKX0KICA8L2Rpdj5gOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtZmllbGRzJykuaW5uZXJIVE1MID0gaHRtbDsKICBjb25zdCBoYXNDYWxjID0gZmllbGRzLnNvbWUoZj0+Zi5jYWxjKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXRvdGFsLXBpbGwnKS5zdHlsZS5kaXNwbGF5ID0gaGFzQ2FsYyA/ICcnIDogJ25vbmUnOwogIGNhbGNJbnZUb3RhbCgpOwp9CgpmdW5jdGlvbiBjYWxjSW52VG90YWwoKSB7CiAgY29uc3QgY2FyZCA9IGdldEhvbWVJbnZDYXJkcygpLmZpbmQoYz0+Yy5rZXk9PT1pbnZNb2RhbFR5cGUpOwogIGNvbnN0IHRlbXBsYXRlID0gY2FyZD8uZmllbGRUZW1wbGF0ZSB8fCBpbnZNb2RhbFRlbXBsYXRlIHx8IGludk1vZGFsVHlwZTsKICBsZXQgdG90YWwgPSAwOwogIGxldCBsYWJlbCA9ICdDb21wdXRlZCBUb3RhbCBWYWx1ZSc7CiAgY29uc3QgZyA9IGlkID0+IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpPy52YWx1ZXx8JzAnKXx8MDsKICBpZih0ZW1wbGF0ZT09PSdTdG9ja3MnKSAgICAgICB7IHRvdGFsID0gZygnaW52LXNoYXJlcycpICAqIGcoJ2ludi1hdmdjb3N0Jyk7IH0KICBlbHNlIGlmKHRlbXBsYXRlPT09J0NyeXB0bycpICB7IHRvdGFsID0gZygnaW52LXVuaXRzJykgICAqIGcoJ2ludi1idXlwcmljZScpOyB9CiAgZWxzZSBpZih0ZW1wbGF0ZT09PSdNZXRhbHMnKSAgeyB0b3RhbCA9IGcoJ2ludi1xdHknKSAgICAgKiBnKCdpbnYtYXZnY29zdCcpOyB9CiAgZWxzZSBpZih0ZW1wbGF0ZT09PSdSZWFsIEVzdGF0ZScpIHsKICAgIGNvbnN0IGN1ciA9IGcoJ2ludi1jdXJyZW50JyksIHB1ciA9IGcoJ2ludi1wdXJjaGFzZScpOwogICAgaWYoY3VyID4gMCkgeyB0b3RhbCA9IGN1cjsgbGFiZWwgPSAn8J+TiCBDdXJyZW50IE1hcmtldCBWYWx1ZSc7IH0KICAgIGVsc2UgICAgICAgIHsgdG90YWwgPSBwdXI7IGxhYmVsID0gJ/Cfj7fvuI8gUHVyY2hhc2UgVmFsdWUgKG5vIGN1cnJlbnQgZ2l2ZW4pJzsgfQogIH0KICBlbHNlIGlmKHRlbXBsYXRlPT09J0VURi9NRicpICB7IHRvdGFsID0gZygnaW52LXVuaXRzJykgICAqIGcoJ2ludi1uYXYnKTsgfQogIGVsc2UgaWYodGVtcGxhdGU9PT0nR2VuZXJhbCcpIHsgdG90YWwgPSBnKCdpbnYtY29udHJpYicpOyB9CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi10b3RhbC1waWxsLWxhYmVsJykudGV4dENvbnRlbnQgPSAn8J+SsCAnICsgbGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jb21wdXRlZC10b3RhbCcpLnRleHRDb250ZW50ID0gaW52RmllbGRDdXJyZW5jeS5zeW1ib2wrdG90YWwudG9GaXhlZCgyKTsKfQoKZnVuY3Rpb24gc2F2ZUludkVudHJ5KCkgewogIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LW1vZGFsLWRhdGUnKS52YWx1ZXx8bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylb','MF07CiAgY29uc3Qgbm90ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtbW9kYWwtbm90ZScpLnZhbHVlLnRyaW0oKTsKICBjb25zdCBnID0gaWQgPT4gcGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk/LnZhbHVlfHwnMCcpfHwwOwogIGNvbnN0IHMgPSBpZCA9PiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpPy52YWx1ZXx8JycpLnRyaW0oKTsKICBjb25zdCBjYXJkID0gZ2V0SG9tZUludkNhcmRzKCkuZmluZChjPT5jLmtleT09PWludk1vZGFsVHlwZSk7CiAgY29uc3QgdGVtcGxhdGUgPSBjYXJkPy5maWVsZFRlbXBsYXRlIHx8IGludk1vZGFsVGVtcGxhdGUgfHwgKElOVl9GSUVMRFNbaW52TW9kYWxUeXBlXSA/IGludk1vZGFsVHlwZSA6ICdHZW5lcmFsJyk7CiAgbGV0IGFtb3VudD0wLCBlbnRyeT17fTsKCiAgaWYodGVtcGxhdGU9PT0nU3RvY2tzJykgewogICAgY29uc3Qgc2hhcmVzPWcoJ2ludi1zaGFyZXMnKSxhdmdjb3N0PWcoJ2ludi1hdmdjb3N0JyksY3VycHJpY2U9ZygnaW52LWN1cnByaWNlJyksdGlja2VyPXMoJ2ludi10aWNrZXInKTsKICAgIGlmKCF0aWNrZXJ8fCFzaGFyZXN8fCFhdmdjb3N0KXtzaG93VG9hc3QoJ0ZpbGwgVGlja2VyLCBTaGFyZXMgJiBDb3N0IOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9c2hhcmVzKmF2Z2Nvc3Q7CiAgICBlbnRyeT17dGlja2VyLHNoYXJlcyxhdmdDb3N0OmF2Z2Nvc3QsY3VycmVudFByaWNlOmN1cnByaWNlLGJyb2tlcjpzKCdpbnYtYnJva2VyJyl9OwogIH0gZWxzZSBpZih0ZW1wbGF0ZT09PSdDcnlwdG8nKSB7CiAgICBjb25zdCB1bml0cz1nKCdpbnYtdW5pdHMnKSxidXk9ZygnaW52LWJ1eXByaWNlJyksY29pbj1zKCdpbnYtY29pbicpOwogICAgaWYoIWNvaW58fCF1bml0c3x8IWJ1eSl7c2hvd1RvYXN0KCdGaWxsIENvaW4sIFVuaXRzICYgQnV5IFByaWNlIOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9dW5pdHMqYnV5OwogICAgZW50cnk9e2NvaW4sdW5pdHMsYnV5UHJpY2U6YnV5LGN1cnJlbnRQcmljZTpnKCdpbnYtY3VycHJpY2UnKSxleGNoYW5nZTpzKCdpbnYtZXhjaGFuZ2UnKX07CiAgfSBlbHNlIGlmKHRlbXBsYXRlPT09J01ldGFscycpIHsKICAgIGNvbnN0IHF0eT1nKCdpbnYtcXR5JyksY29zdD1nKCdpbnYtYXZnY29zdCcpOwogICAgaWYoIXF0eXx8IWNvc3Qpe3Nob3dUb2FzdCgnRmlsbCBRdWFudGl0eSAmIEF2ZyBDb3N0IOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9cXR5KmNvc3Q7CiAgICBjb25zdCBtZXRhbD1zKCdpbnYtbWV0YWwnKXx8J0dvbGQnLCB1bml0PXMoJ2ludi11bml0Jyl8fCdncmFtcyc7CiAgICBlbnRyeT17bWV0YWwscXR5LHVuaXQsYXZnQ29zdFBlclVuaXQ6Y29zdCxwdXJpdHk6cygnaW52LXB1cml0eScpfTsKICAgIGlmKCFkYXRhLl9tZXRhbHMpIGRhdGEuX21ldGFscz1bXTsKICAgIGRhdGEuX21ldGFscy5wdXNoKHttZXRhbFR5cGU6bWV0YWwudG9Mb3dlckNhc2UoKSxuYW1lOm1ldGFsLGdyYW1zOnVuaXQ9PT0nb3onP3F0eSozMS4xMDM1OnF0eSxwcmljZTpjb3N0LGRhdGUsZm9ybTonQmFyJyxub3Rlczpub3RlLHB1cml0eTpzKCdpbnYtcHVyaXR5Jyl9KTsKICB9IGVsc2UgaWYodGVtcGxhdGU9PT0nUmVhbCBFc3RhdGUnKSB7CiAgICBjb25zdCBwdj1nKCdpbnYtcHVyY2hhc2UnKTsKICAgIGlmKCFwdil7c2hvd1RvYXN0KCdFbnRlciBQdXJjaGFzZSBWYWx1ZSDinYwnKTtyZXR1cm47fQogICAgY29uc3QgY3Y9ZygnaW52LWN1cnJlbnQnKTsKICAgIGFtb3VudCA9IGN2ID4gMCA/IGN2IDogcHY7ICAgLy8gcHJlZmVyIGN1cnJlbnQgbWFya2V0IHZhbHVlLCBmYWxsYmFjayB0byBwdXJjaGFzZQogICAgZW50cnk9e3Byb3BlcnR5TmFtZTpzKCdpbnYtcHJvcG5hbWUnKSxjb3VudHJ5OnMoJ2ludi1jb3VudHJ5JykscHVyY2hhc2VWYWx1ZTpwdixjdXJyZW50VmFsdWU6Y3Z8fHB2LGFyZWE6ZygnaW52LWFyZWEnKX07CiAgfSBlbHNlIGlmKHRlbXBsYXRlPT09J0VURi9NRicpIHsKICAgIGNvbnN0IHVuaXRzPWcoJ2ludi11bml0cycpLG5hdj1nKCdpbnYtbmF2Jyk7CiAgICBpZighdW5pdHN8fCFuYXYpe3Nob3dUb2FzdCgnRmlsbCBVbml0cyAmIE5BViDinYwnKTtyZXR1cm47fQogICAgYW1vdW50PXVuaXRzKm5hdjsKICAgIGVudHJ5PXtmdW5kTmFtZTpzKCdpbnYtZnVuZCcpLHVuaXRzLGF2Z05BVjpuYXYsY3VycmVudE5BVjpnKCdpbnYtY3VybmF2JykscGxhdGZvcm06cygnaW52LXBsYXRmb3JtJyl9OwogIH0gZWxzZSB7CiAgICAvLyBHZW5lcmFsIHRlbXBsYXRlIChQRi9WUEYsIE5QUywgUFBGLCBGRCwgSW5zdXJhbmNlLCBjdXN0b20pCiAgICBjb25zdCBjb250cmliPWcoJ2ludi1jb250cmliJyk7CiAgICBpZighY29udHJpYil7c2hvd1RvYXN0KCdFbnRlciB0aGUgYW1vdW50IGludmVzdGVkIOKdjCcpO3JldHVybjt9CiAgICBhbW91bnQ9Y29udHJpYjsKICAgIGVudHJ5PXtzY2hlbWU6cygnaW52LXNjaGVtZScpLHRvdGFsQWNjdW11bGF0ZWQ6ZygnaW52LXRvdGFsLWFjYycpLHJhdGU6ZygnaW52LXJhdGUnKSxtYXR1cml0eTpzKCdpbnYtbWF0dXJpdHknKX07CiAgfQoKICBjb25zdCBtb250aEtleSA9IGdldE1vbnRoS2V5KGRhdGUpfHxnZXRDdXJyZW50TW9udGhLZXkoKTsKICBlbnN1cmVNb250aChtb250aEtleSk7CiAgZGF0YVttb250aEtleV0uaW52ZXN0bWVudHMucHVzaCh7CiAgICBkYXRlOm5vcm1hbGl6ZURhdGUoZGF0ZSksIGNhdGVnb3J5Omludk1vZGFsVHlwZSwgaW52ZXN0VHlwZTppbnZNb2RhbFR5cGUsCiAgICBhbW91bnQsIGRlc2NyaXB0aW9uOm5vdGV8fHMoJ2ludi1zY2hlbWUnKXx8cygnaW52LXRpY2tlcicpfHxzKCdpbnYtZnVuZCcpfHxzKCdpbnYtY29pbicpfHwnJywKICAgIGN1cnJlbmN5OmludkZpZWxkQ3VycmVuY3kuY29kZSwgLi4uZW50cnkKICB9KTsKICBzYXZlKCk7IGNsb3NlTW9kYWwoJ2ludi1xdWljay1tb2RhbCcpOyByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgJHtjYXJkPy5sYWJlbHx8aW52TW9kYWxUeXBlfSBlbnRyeSBzYXZlZCFgKTsKfQoKZnVuY3Rpb24gdXBkYXRlSW52Q3VyckJ0bigpIHsKICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWN1cnItYnRuJyk7CiAgaWYoIWJ0bikgcmV0dXJuOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY3Vyci1mbGFnJykudGV4dENvbnRlbnQgPSBpbnZGaWVsZEN1cnJlbmN5LmZsYWd8fCfwn4yNJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWN1cnItbGFiZWwnKS50ZXh0Q29udGVudCA9IGAke2ludkZpZWxkQ3VycmVuY3kuY29kZX0g4oCUICR7aW52RmllbGRDdXJyZW5jeS5zeW1ib2x9YDsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIENVUlJFTkNZIFBJQ0tFUgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKY29uc3QgQ1VSUkVOQ0lFUyA9IFsKICB7Y29kZTonVVNEJyxzeW1ib2w6JyQnLCAgbmFtZTonVVMgRG9sbGFyJywgICAgICAgZmxhZzon8J+HuvCfh7gnLGNvdW50cnk6J1VuaXRlZCBTdGF0ZXMnfSwKICB7Y29kZTonRVVSJyxzeW1ib2w6J+KCrCcsICBuYW1lOidFdXJvJywgICAgICAgICAgICAgZmxhZzon8J+HqvCfh7onLGNvdW50cnk6J0V1cm9wZSd9LAogIHtjb2RlOidHQlAnLHN5bWJvbDonwqMnLCAgbmFtZTonQnJpdGlzaCBQb3VuZCcsICAgIGZsYWc6J/Cfh6zwn4enJyxjb3VudHJ5OidVbml0ZWQgS2luZ2RvbSd9LAogIHtjb2RlOidJTlInLHN5bWJvbDon4oK5JywgIG5hbWU6J0luZGlhbiBSdXBlZScsICAgICBmbGFnOifwn4eu8J+HsycsY291bnRyeTonSW5kaWEnfSwKICB7Y29kZTonQUVEJyxzeW1ib2w6J9ivLtilJyxuYW1lOidVQUUgRGlyaGFtJywgICAgICAgZmxhZzon8J+HpvCfh6onLGNvdW50cnk6J1VBRSd9LAogIHtjb2RlOidTQVInLHN5bWJvbDon77e8JywgIG5hbWU6J1NhdWRpIFJpeWFsJywgICAgICBmbGFnOifwn4e48J+HpicsY291bnRyeTonU2F1ZGkgQXJhYmlhJ30sCiAge2NvZGU6J0NBRCcsc3ltYm9sOidDJCcsIG5hbWU6J0NhbmFkaWFuIERvbGxhcicsICBmbGFnOifwn4eo8J+HpicsY291bnRyeTonQ2FuYWRhJ30sCiAge2NvZGU6J0FVRCcsc3ltYm9sOidBJCcsIG5hbWU6J0F1c3RyYWxpYW4gRG9sbGFyJyxmbGFnOifwn4em8J+HuicsY291bnRyeTonQXVzdHJhbGlhJ30sCiAge2NvZGU6J0pQWScsc3ltYm9sOifCpScsICBuYW1lOidKYXBhbmVzZSBZZW4nLCAgICAgZmxhZzon8J+Hr/Cfh7UnLGNvdW50cnk6J0phcGFuJ30sCiAge2NvZGU6J0NOWScsc3ltYm9sOifCpScsICBuYW1lOidDaGluZXNlIFl1YW4nLCAgICAgZmxhZzon8J+HqPCfh7MnLGNvdW50cnk6J0NoaW5hJ30sCiAge2NvZGU6J1NHRCcsc3ltYm9sOidTJCcsIG5hbWU6J1NpbmdhcG9yZSBEb2xsYXInLCBmbGFnOifwn4e48J+HrCcsY291bnRyeTonU2luZ2Fwb3JlJ30sCiAge2NvZGU6J0NIRicsc3ltYm9sOidGcicsIG5hbWU6J1N3aXNzIEZyYW5jJywgICAgICBmbGFnOifwn4eo8J+HrScsY291bnRyeTonU3dpdHplcmxhbmQnfSwKICB7Y29kZTonTVlSJyxzeW1ib2w6J1JNJywgbmFtZTonTWFsYXlzaWFuIFJpbmdnaXQnLGZsYWc6J/Cfh7Lwn4e+Jyxjb3VudHJ5OidNYWxheXNpYSd9LAogIHtjb2RlOidIS0QnLHN5bWJvbDonSEskJyxuYW1lOidIb25nIEtvbmcgRG9sbGFyJywgZmxhZzon8J+HrfCfh7AnLGNvdW50cnk6J0hvbmcgS29uZyd9LAogIHtjb2RlOidOWkQnLHN5bWJvbDonTlokJyxuYW1lOidOZXcgWmVhbGFuZCBEb2xsYXInLGZsYWc6J/Cfh7Pwn4e/Jyxjb3VudHJ5OidOZXcgWmVhbGFuZCd9LAogIHtjb2RlOidLV0QnLHN5bWJvbDonS0QnLCBuYW1lOidLdXdhaXRpIERpbmFyJywgICAgZmxhZzon8J+HsPCfh7wnLGNvdW50cnk6J0t1d2FpdCd9LAogIHtjb2RlOidRQVInLHN5bWJvbDonUVInLCBuYW1lOidRYXRhcmkgUml5YWwnLCAgICAgZmxhZzon8J+HtvCfh6YnLGNvdW50cnk6J1FhdGFyJ30sCiAge2NvZGU6J09NUicsc3ltYm9sOifYsS7YuS4nLG5hbWU6J09tYW5pIFJpYWwnLCAgICAgIGZsYWc6J/Cfh7Twn4eyJyxjb3VudHJ5OidPbWFuJ30sCiAge2NvZGU6J1BLUicsc3ltYm9sOifigqgnLCAgbmFtZTonUGFraXN0YW5pIFJ1cGVlJywgIGZsYWc6J/Cfh7Xwn4ewJyxjb3VudHJ5OidQYWtpc3Rhbid9LAogIHtjb2RlOidCRFQnLHN5bWJvbDon4KezJywgIG5hbWU6J0JhbmdsYWRlc2hpIFRha2EnLCBmbGFnOifwn4en8J+HqScsY291bnRyeTonQmFuZ2xhZGVzaCd9LAogIHtjb2RlOidMS1InLHN5bWJvbDon4oKoJywgIG5hbWU6J1NyaSBMYW5rYW4gUnVwZWUnLCBmbGFnOifwn4ex8J+HsCcsY291bnRyeTonU3JpIExhbmthJ30sCiAge2NvZGU6J05QUicsc3ltYm9sOifigqgnLCAgbmFtZTonTmVwYWxlc2UgUnVwZWUnLCAgIGZsYWc6J/Cfh7Pwn4e1Jyxjb3VudHJ5OidOZXBhbCd9LAogIHtjb2RlOidNWE4nLHN5bWJvbDonJCcsICBuYW1lOidNZXhpY2FuIFBlc28nLCAgICAgZmxhZzon8J+HsvCfh70nLGNvdW50cnk6J01leGljbyd9LAogIHtjb2RlOidCUkwnLHN5bWJvbDonUiQnLCBuYW1lOidCcmF6aWxpYW4gUmVhbCcsICAgZmxhZzon8J+Hp/Cfh7cnLGNvdW50cnk6J0JyYXppbCd9LAogIHtjb2RlOidaQVInLHN5bWJvbDonUicsICBuYW1lOidTb3V0aCBBZnJpY2FuIFJhbmQnLGZsYWc6J/Cfh7/wn4emJyxjb3VudHJ5OidTb3V0aCBBZnJpY2EnfSwKICB7Y29kZTonTkdOJyxzeW1ib2w6J+KCpicsICBuYW1lOidOaWdl','cmlhbiBOYWlyYScsICAgZmxhZzon8J+Hs/Cfh6wnLGNvdW50cnk6J05pZ2VyaWEnfSwKICB7Y29kZTonS0VTJyxzeW1ib2w6J0tTaCcsbmFtZTonS2VueWFuIFNoaWxsaW5nJywgIGZsYWc6J/Cfh7Dwn4eqJyxjb3VudHJ5OidLZW55YSd9LAogIHtjb2RlOidFR1AnLHN5bWJvbDonRcKjJywgbmFtZTonRWd5cHRpYW4gUG91bmQnLCAgIGZsYWc6J/Cfh6rwn4esJyxjb3VudHJ5OidFZ3lwdCd9LAogIHtjb2RlOidUUlknLHN5bWJvbDon4oK6JywgIG5hbWU6J1R1cmtpc2ggTGlyYScsICAgICBmbGFnOifwn4e58J+HtycsY291bnRyeTonVHVya2V5J30sCiAge2NvZGU6J1JVQicsc3ltYm9sOifigr0nLCAgbmFtZTonUnVzc2lhbiBSdWJsZScsICAgIGZsYWc6J/Cfh7fwn4e6Jyxjb3VudHJ5OidSdXNzaWEnfSwKICB7Y29kZTonU0VLJyxzeW1ib2w6J2tyJywgbmFtZTonU3dlZGlzaCBLcm9uYScsICAgIGZsYWc6J/Cfh7jwn4eqJyxjb3VudHJ5OidTd2VkZW4nfSwKICB7Y29kZTonTk9LJyxzeW1ib2w6J2tyJywgbmFtZTonTm9yd2VnaWFuIEtyb25lJywgIGZsYWc6J/Cfh7Pwn4e0Jyxjb3VudHJ5OidOb3J3YXknfSwKICB7Y29kZTonREtLJyxzeW1ib2w6J2tyJywgbmFtZTonRGFuaXNoIEtyb25lJywgICAgIGZsYWc6J/Cfh6nwn4ewJyxjb3VudHJ5OidEZW5tYXJrJ30sCiAge2NvZGU6J0lEUicsc3ltYm9sOidScCcsIG5hbWU6J0luZG9uZXNpYW4gUnVwaWFoJyxmbGFnOifwn4eu8J+HqScsY291bnRyeTonSW5kb25lc2lhJ30sCiAge2NvZGU6J1BIUCcsc3ltYm9sOifigrEnLCAgbmFtZTonUGhpbGlwcGluZSBQZXNvJywgIGZsYWc6J/Cfh7Xwn4etJyxjb3VudHJ5OidQaGlsaXBwaW5lcyd9LAogIHtjb2RlOidUSEInLHN5bWJvbDon4Li/JywgIG5hbWU6J1RoYWkgQmFodCcsICAgICAgICBmbGFnOifwn4e58J+HrScsY291bnRyeTonVGhhaWxhbmQnfSwKICB7Y29kZTonVk5EJyxzeW1ib2w6J+KCqycsICBuYW1lOidWaWV0bmFtZXNlIERvbmcnLCAgZmxhZzon8J+Hu/Cfh7MnLGNvdW50cnk6J1ZpZXRuYW0nfSwKICB7Y29kZTonS1JXJyxzeW1ib2w6J+KCqScsICBuYW1lOidTb3V0aCBLb3JlYW4gV29uJywgZmxhZzon8J+HsPCfh7cnLGNvdW50cnk6J1NvdXRoIEtvcmVhJ30sCl07CgpmdW5jdGlvbiBvcGVuQ3VycmVuY3lQaWNrZXIoY29udGV4dCkgewogIGludkN1cnJlbmN5VGFyZ2V0ID0gY29udGV4dDsKICBmaWx0ZXJDdXJyZW5jaWVzKCcnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vyci1zZWFyY2gtaW5wdXQnKS52YWx1ZSA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW5jeS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKfQoKZnVuY3Rpb24gZmlsdGVyQ3VycmVuY2llcyhxdWVyeSkgewogIGNvbnN0IHEgPSBxdWVyeS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IGZpbHRlcmVkID0gcSA/IENVUlJFTkNJRVMuZmlsdGVyKGM9PmMubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHEpfHxjLmNvZGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKXx8Yy5jb3VudHJ5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocSkpIDogQ1VSUkVOQ0lFUzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vyci1saXN0JykuaW5uZXJIVE1MID0gZmlsdGVyZWQubWFwKGM9PmAKICAgIDxkaXYgY2xhc3M9ImN1cnItaXRlbSAke2MuY29kZT09PWN1cnJlbnRDdXJyZW5jeS5jb2RlPydhY3RpdmUnOicnfSIgb25jbGljaz0ic2VsZWN0Q3VycmVuY3koJyR7Yy5jb2RlfScpIj4KICAgICAgPHNwYW4gY2xhc3M9ImN1cnItZmxhZyI+JHtjLmZsYWd9PC9zcGFuPgogICAgICA8ZGl2IGNsYXNzPSJjdXJyLWluZm8iPgogICAgICAgIDxkaXYgY2xhc3M9ImN1cnItbmFtZSI+JHtjLm5hbWV9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY3Vyci1jb3VudHJ5Ij4ke2MuY291bnRyeX08L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxzcGFuIGNsYXNzPSJjdXJyLWNvZGUiPiR7Yy5jb2RlfTwvc3Bhbj4KICAgICAgPHNwYW4gY2xhc3M9ImN1cnItc3ltYm9sIj4ke2Muc3ltYm9sfTwvc3Bhbj4KICAgIDwvZGl2PmApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBzZWxlY3RDdXJyZW5jeShjb2RlKSB7CiAgY29uc3QgYyA9IENVUlJFTkNJRVMuZmluZCh4PT54LmNvZGU9PT1jb2RlKTsKICBpZighYykgcmV0dXJuOwogIGlmKGludkN1cnJlbmN5VGFyZ2V0PT09J2ludicpIHsKICAgIGludkZpZWxkQ3VycmVuY3kgPSBjOwogICAgdXBkYXRlSW52Q3VyckJ0bigpOwogICAgY2FsY0ludlRvdGFsKCk7CiAgfSBlbHNlIHsKICAgIHNhdmVDdXJyZW5jeShjKTsKICAgIHJlbmRlckhvbWUoKTsgcmVuZGVyU2V0dGluZ3MoKTsKICB9CiAgY2xvc2VNb2RhbCgnY3VycmVuY3ktbW9kYWwnKTsKICBzaG93VG9hc3QoYCR7Yy5mbGFnfSBDdXJyZW5jeSBzZXQgdG8gJHtjLmNvZGV9YCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBGWCBSQVRFIE9WRVJSSURFIE1PRFVMRQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCi8vIFNjYW4gYWxsIGRhdGEgdG8gZmluZCBldmVyeSBjdXJyZW5jeSBjb2RlIGFjdHVhbGx5IGluIHVzZQpmdW5jdGlvbiBnZXRBY3RpdmVDdXJyZW5jaWVzKCkgewogIGNvbnN0IGZvdW5kID0gbmV3IFNldCgpOwogIC8vIE5XIGFjY291bnRzCiAgKGRhdGEuX253QWNjb3VudHMgfHwgW10pLmZvckVhY2goYSA9PiB7IGlmIChhLmN1cnJlbmN5KSBmb3VuZC5hZGQoYS5jdXJyZW5jeS50b1VwcGVyQ2FzZSgpKTsgfSk7CiAgLy8gTWV0YWxzCiAgKGRhdGEuX21ldGFscyB8fCBbXSkuZm9yRWFjaChtID0+IHsgaWYgKG0uY3VycmVuY3kpIGZvdW5kLmFkZChtLmN1cnJlbmN5LnRvVXBwZXJDYXNlKCkpOyB9KTsKICAvLyBSZWFsIGVzdGF0ZQogIChkYXRhLl9yZWFsRXN0YXRlIHx8IFtdKS5mb3JFYWNoKHAgPT4geyBpZiAocC5jdXJyZW5jeSkgZm91bmQuYWRkKHAuY3VycmVuY3kudG9VcHBlckNhc2UoKSk7IH0pOwogIC8vIE1vbnRobHkgdHJhbnNhY3Rpb25zCiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrZXkgPT4gewogICAgaWYgKCEvXlxkezR9LVxkezJ9JC8udGVzdChrZXkpKSByZXR1cm47CiAgICBjb25zdCBtbyA9IGRhdGFba2V5XTsKICAgIFsnaW5jb21lJywnZXhwZW5zZXMnLCdpbnZlc3RtZW50cycsJ2FkZGl0aW9uYWwnLCdtZXRhbHMnLCdkZWJ0cyddLmZvckVhY2goY2F0ID0+IHsKICAgICAgKG1vW2NhdF0gfHwgW10pLmZvckVhY2goZSA9PiB7IGlmIChlLmN1cnJlbmN5KSBmb3VuZC5hZGQoZS5jdXJyZW5jeS50b1VwcGVyQ2FzZSgpKTsgfSk7CiAgICB9KTsKICAgIChtby5yZWFsRXN0YXRlIHx8IFtdKS5mb3JFYWNoKGUgPT4geyBpZiAoZS5jdXJyZW5jeSkgZm91bmQuYWRkKGUuY3VycmVuY3kudG9VcHBlckNhc2UoKSk7IH0pOwogIH0pOwogIC8vIEFsd2F5cyByZW1vdmUgZGlzcGxheSBjdXJyZW5jeSDigJQgbm8gY29udmVyc2lvbiBuZWVkZWQgZm9yIHRoYXQKICBmb3VuZC5kZWxldGUoY3VycmVudEN1cnJlbmN5LmNvZGUudG9VcHBlckNhc2UoKSk7CiAgLy8gQWRkIGRpc3BsYXkgY3VycmVuY3kncyBvd24gcmF0ZSBlbnRyeSBvbmx5IGlmIGl0J3Mgbm90IFVTRCAoc28gdXNlciBjYW4gc2VlIGl0KQogIHJldHVybiBbLi4uZm91bmRdLnNvcnQoKTsKfQoKZnVuY3Rpb24gcmVuZGVyRlhSYXRlc1BhbmVsKCkgewogIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LXJhdGVzLWxpc3QnKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3Qgb3ZlcnJpZGVzID0gZGF0YS5fZnhPdmVycmlkZXMgfHwge307CiAgY29uc3QgZGlzcGxheUNvZGUgPSBjdXJyZW50Q3VycmVuY3kuY29kZS50b1VwcGVyQ2FzZSgpOwogIGNvbnN0IGFjdGl2ZUN1cnJlbmNpZXMgPSBnZXRBY3RpdmVDdXJyZW5jaWVzKCk7CgogIC8vIFVwZGF0ZSBiYXNlIGxhYmVsIGFuZCBiYWRnZQogIGNvbnN0IGJhc2VMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmeC1iYXNlLWxhYmVsJyk7CiAgaWYgKGJhc2VMYWJlbCkgYmFzZUxhYmVsLnRleHRDb250ZW50ID0gZGlzcGxheUNvZGU7CiAgY29uc3QgYmFkZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZngtb3ZlcnJpZGUtYmFkZ2UnKTsKICBpZiAoYmFkZ2UpIGJhZGdlLnN0eWxlLmRpc3BsYXkgPSBPYmplY3Qua2V5cyhvdmVycmlkZXMpLmxlbmd0aCA+IDAgPyAnJyA6ICdub25lJzsKCiAgaWYgKGFjdGl2ZUN1cnJlbmNpZXMubGVuZ3RoID09PSAwKSB7CiAgICBlbC5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuODJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxNnB4OyI+CiAgICAgIE5vIGZvcmVpZ24tY3VycmVuY3kgZGF0YSBmb3VuZCB5ZXQuIEFkZCBhc3NldHMgb3IgdHJhbnNhY3Rpb25zIGluIG90aGVyIGN1cnJlbmNpZXMgYW5kIHRoZXknbGwgYXBwZWFyIGhlcmUuCiAgICA8L2Rpdj5gOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3Qgcm93cyA9IGFjdGl2ZUN1cnJlbmNpZXMubWFwKGNvZGUgPT4gewogICAgY29uc3QgYnVpbHRJbiA9IEZYX1VTRF9CQVNFW2NvZGVdOwogICAgY29uc3Qgb3ZlcnJpZGUgPSBvdmVycmlkZXNbY29kZV07CiAgICBjb25zdCBlZmZlY3RpdmUgPSBvdmVycmlkZSAhPT0gdW5kZWZpbmVkID8gb3ZlcnJpZGUgOiAoYnVpbHRJbiB8fCBudWxsKTsKICAgIC8vIFJhdGUgc2hvd24gYXMgIjEgVVNEID0gWCBmb3JlaWduIiDigJQgY29udmVydCB0byAiMSBmb3JlaWduID0gWSBkaXNwbGF5Q3VycmVuY3kiIGZvciBpbnR1aXRpdmUgcmVhZGluZwogICAgY29uc3QgZGlzcGxheVJhdGUgPSBGWF9VU0RfQkFTRVtkaXNwbGF5Q29kZV0gfHwgMTsKICAgIGNvbnN0IGVmZmVjdGl2ZURpc3BsYXkgPSBlZmZlY3RpdmUgPyAoZGlzcGxheVJhdGUgLyBlZmZlY3RpdmUpIDogbnVsbDsKICAgIGNvbnN0IGJ1aWx0SW5EaXNwbGF5ICA9IGJ1aWx0SW4gICA/IChkaXNwbGF5UmF0ZSAvIGJ1aWx0SW4pICAgOiBudWxsOwogICAgY29uc3QgaGFzT3ZlcnJpZGUgPSBvdmVycmlkZSAhPT0gdW5kZWZpbmVkOwogICAgY29uc3QgdW5rbm93blJhdGUgPSBlZmZlY3RpdmUgPT09IG51bGw7CiAgICBjb25zdCBjSW5mbyA9IENVUlJFTkNJRVMuZmluZChjID0+IGMuY29kZSA9PT0gY29kZSkgfHwgeyBmbGFnOiAn8J+MkCcsIG5hbWU6IGNvZGUgfTsKCiAgICByZXR1cm4gYDxkaXYgc3R5bGU9ImJvcmRlci1ib3R0b206MXB4IHNvbGlkICNGNUY1RjU7cGFkZGluZzoxMHB4IDA7IiBpZD0iZngtcm93LSR7Y29kZX0iPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2dhcDo4cHg7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7ZmxleDoxO21pbi13aWR0aDowOyI+CiAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEuMmVtOyI+JHtjSW5mby5mbGFnfHwn8J+MkCd9PC9zcGFuPgogICAgICAgICAgPGRpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg4ZW07Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTsiPiR7Y29kZX0KICAgICAgICAgICAgICAke2hhc092ZXJyaWRlID8gYDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEZGRjQ7Y29sb3I6IzEwQjk4MTtmb250','LXNpemU6MC43ZW07Ym9yZGVyLXJhZGl1czo2cHg7cGFkZGluZzoxcHggNnB4O21hcmdpbi1sZWZ0OjRweDsiPuKcj++4jyBDdXN0b208L3NwYW4+YCA6ICcnfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7Ij4ke2NJbmZvLm5hbWV8fCcnfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtmbGV4LXNocmluazowOyI+CiAgICAgICAgICAke3Vua25vd25SYXRlCiAgICAgICAgICAgID8gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Y29sb3I6I0VGNDQ0NDtmb250LXdlaWdodDo3MDA7Ij5SYXRlIHVua25vd248L2Rpdj5gCiAgICAgICAgICAgIDogYDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45MmVtO2NvbG9yOnZhcigtLXByaW1hcnkpOyI+MSAke2NvZGV9ID0gJHtlZmZlY3RpdmVEaXNwbGF5LnRvRml4ZWQoNCl9ICR7ZGlzcGxheUNvZGV9PC9kaXY+CiAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NjAwOyI+MSBVU0QgPSAke2VmZmVjdGl2ZS50b0ZpeGVkKDQpfSAke2NvZGV9PC9kaXY+YAogICAgICAgICAgfQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NHB4O2ZsZXgtc2hyaW5rOjA7Ij4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0ib3BlbkZYT3ZlcnJpZGUoJyR7Y29kZX0nKSIKICAgICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjRweCA5cHg7Zm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Y3Vyc29yOnBvaW50ZXI7Ij7inI/vuI8gU2V0PC9idXR0b24+CiAgICAgICAgICAke2hhc092ZXJyaWRlID8gYDxidXR0b24gb25jbGljaz0icmVzZXRGWE92ZXJyaWRlKCcke2NvZGV9JykiCiAgICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo0cHggOHB4O2ZvbnQtc2l6ZTowLjcyZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOiNFRjQ0NDQ7Y3Vyc29yOnBvaW50ZXI7Ij7inJU8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8IS0tIElubGluZSBlZGl0IHBhbmVsIChoaWRkZW4gYnkgZGVmYXVsdCkgLS0+CiAgICAgIDxkaXYgaWQ9ImZ4LWVkaXQtJHtjb2RlfSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjhweDtiYWNrZ3JvdW5kOiNGOEY4Rjg7Ym9yZGVyLXJhZGl1czo5cHg7cGFkZGluZzoxMHB4IDEycHg7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO21hcmdpbi1ib3R0b206NnB4OyI+U2V0IHJhdGUgZm9yICR7Y29kZX06PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2dhcDo2cHg7bWFyZ2luLWJvdHRvbTo2cHg7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZsZXg6MTsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC42OGVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjcwMDttYXJnaW4tYm90dG9tOjNweDsiPjEgVVNEID0gPyAke2NvZGV9PC9kaXY+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJmeC1pbnB1dC11c2QtJHtjb2RlfSIgc3RlcD0iMC4wMDAxIiBwbGFjZWhvbGRlcj0iJHtlZmZlY3RpdmUgPyBlZmZlY3RpdmUudG9GaXhlZCg0KSA6ICdlLmcuIDgzLjUnfSIKICAgICAgICAgICAgICBzdHlsZT0id2lkdGg6MTAwJTtib3JkZXI6MS41cHggc29saWQgI0RERDtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjZweCA4cHg7Zm9udC1zaXplOjAuODhlbTtmb250LXdlaWdodDo3MDA7IgogICAgICAgICAgICAgIG9uaW5wdXQ9InN5bmNGWElucHV0cygnJHtjb2RlfScsJ3VzZCcpIgogICAgICAgICAgICAgIHZhbHVlPSIke2VmZmVjdGl2ZSA/IGVmZmVjdGl2ZS50b0ZpeGVkKDQpIDogJyd9Ij4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxOyI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwO21hcmdpbi1ib3R0b206M3B4OyI+MSAke2NvZGV9ID0gPyAke2Rpc3BsYXlDb2RlfTwvZGl2PgogICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iZngtaW5wdXQtZGlzcC0ke2NvZGV9IiBzdGVwPSIwLjAwMDEiIHBsYWNlaG9sZGVyPSIke2VmZmVjdGl2ZURpc3BsYXkgPyBlZmZlY3RpdmVEaXNwbGF5LnRvRml4ZWQoNCkgOiAnJ30iCiAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOjEwMCU7Ym9yZGVyOjEuNXB4IHNvbGlkICNEREQ7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo2cHggOHB4O2ZvbnQtc2l6ZTowLjg4ZW07Zm9udC13ZWlnaHQ6NzAwOyIKICAgICAgICAgICAgICBvbmlucHV0PSJzeW5jRlhJbnB1dHMoJyR7Y29kZX0nLCdkaXNwJykiCiAgICAgICAgICAgICAgdmFsdWU9IiR7ZWZmZWN0aXZlRGlzcGxheSA/IGVmZmVjdGl2ZURpc3BsYXkudG9GaXhlZCg0KSA6ICcnfSI+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICAke2J1aWx0SW4gPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tYm90dG9tOjZweDsiPkJ1aWx0LWluIGRlZmF1bHQ6IDEgVVNEID0gJHtidWlsdElufSAke2NvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4OyI+CiAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImFwcGx5RlhPdmVycmlkZSgnJHtjb2RlfScpIgogICAgICAgICAgICBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6IzEwQjk4MTtjb2xvcjp3aGl0ZTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjdweDtwYWRkaW5nOjdweDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODJlbTtjdXJzb3I6cG9pbnRlcjsiPuKckyBBcHBseTwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjbG9zZUZYRWRpdCgnJHtjb2RlfScpIgogICAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDojRUVFO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6N3B4IDEycHg7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y3Vyc29yOnBvaW50ZXI7Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKCiAgZWwuaW5uZXJIVE1MID0gcm93cyB8fCBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuODJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzoxNnB4OyI+Tm8gZm9yZWlnbiBjdXJyZW5jaWVzIGluIHVzZSB5ZXQuPC9kaXY+YDsKfQoKZnVuY3Rpb24gb3BlbkZYT3ZlcnJpZGUoY29kZSkgewogIC8vIENsb3NlIGFueSBvdGhlciBvcGVuIHBhbmVscyBmaXJzdAogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tpZF49ImZ4LWVkaXQtIl0nKS5mb3JFYWNoKHAgPT4gcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnKTsKICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmeC1lZGl0LScgKyBjb2RlKTsKICBpZiAocGFuZWwpIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnJzsKfQoKZnVuY3Rpb24gY2xvc2VGWEVkaXQoY29kZSkgewogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWVkaXQtJyArIGNvZGUpOwogIGlmIChwYW5lbCkgcGFuZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gc3luY0ZYSW5wdXRzKGNvZGUsIGNoYW5nZWQpIHsKICBjb25zdCBkaXNwQ29kZSA9IGN1cnJlbnRDdXJyZW5jeS5jb2RlLnRvVXBwZXJDYXNlKCk7CiAgY29uc3QgZGlzcFJhdGUgPSBGWF9VU0RfQkFTRVtkaXNwQ29kZV0gfHwgMTsKICBjb25zdCB1c2RJbnB1dCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZngtaW5wdXQtdXNkLScgICsgY29kZSk7CiAgY29uc3QgZGlzcElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWlucHV0LWRpc3AtJyArIGNvZGUpOwogIGlmICghdXNkSW5wdXQgfHwgIWRpc3BJbnB1dCkgcmV0dXJuOwogIGlmIChjaGFuZ2VkID09PSAndXNkJykgewogICAgY29uc3QgdXNkVmFsID0gcGFyc2VGbG9hdCh1c2RJbnB1dC52YWx1ZSk7CiAgICBpZiAodXNkVmFsID4gMCkgZGlzcElucHV0LnZhbHVlID0gKGRpc3BSYXRlIC8gdXNkVmFsKS50b0ZpeGVkKDYpOwogIH0gZWxzZSB7CiAgICBjb25zdCBkaXNwVmFsID0gcGFyc2VGbG9hdChkaXNwSW5wdXQudmFsdWUpOwogICAgaWYgKGRpc3BWYWwgPiAwKSB1c2RJbnB1dC52YWx1ZSA9IChkaXNwUmF0ZSAvIGRpc3BWYWwpLnRvRml4ZWQoNik7CiAgfQp9CgpmdW5jdGlvbiBhcHBseUZYT3ZlcnJpZGUoY29kZSkgewogIGNvbnN0IHVzZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Z4LWlucHV0LXVzZC0nICsgY29kZSk7CiAgY29uc3QgcmF0ZSA9IHBhcnNlRmxvYXQodXNkSW5wdXQ/LnZhbHVlKTsKICBpZiAoIXJhdGUgfHwgcmF0ZSA8PSAwKSB7IHNob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCByYXRlIOKdjCcpOyByZXR1cm47IH0KICBpZiAoIWRhdGEuX2Z4T3ZlcnJpZGVzKSBkYXRhLl9meE92ZXJyaWRlcyA9IHt9OwogIGRhdGEuX2Z4T3ZlcnJpZGVzW2NvZGVdID0gcmF0ZTsKICBzYXZlKCk7CiAgcmVuZGVyRlhSYXRlc1BhbmVsKCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgJHtjb2RlfSByYXRlIHNhdmVkIOKAlCBOZXQgV29ydGggcmVjYWxjdWxhdGVkIWApOwp9CgpmdW5jdGlvbiByZXNldEZYT3ZlcnJpZGUoY29kZSkgewogIGlmICghZGF0YS5fZnhPdmVycmlkZXMpIHJldHVybjsKICBkZWxldGUgZGF0YS5fZnhPdmVycmlkZXNbY29kZV07CiAgc2F2ZSgpOwogIHJlbmRlckZYUmF0ZXNQYW5lbCgpOwogIHJlbmRlck5ldFdvcnRoKCk7CiAgcmVuZGVySG9tZSgpOwogIHNob3dUb2FzdChgJHtjb2RlfSByYXRlIHJlc2V0IHRvIGJ1aWx0LWluIGRlZmF1bHRgKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElOVkVTVE1FTlQgQ0FSRCBNQU5BR0VSCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApjb25zdCBJTlZfRU1PSklfT1BUUyA9IFsn8J+Pm++4jycsJ/Cfp5MnLCfwn5OuJywn8J+PpicsJ/Cfm6HvuI8nLCfwn5OKJywn8J+qmScsJ/CfpYcnLCfwn4+hJywn8J+XgicsJ/CfkrknLCfwn4yQJywn8J+SvCcsJ/Cfjq8nLCfwn4+X77iPJywn8J+TsScsJ/CfjLEnLCfimqEnLCfwn5SRJywn8J+SjicsJ/Cfj4UnLCfwn4yNJywn8J+TiycsJ/Cfj6AnXTsKbGV0IHBpY2tlZEludkVtb2ppID0gJ/Cfj5vvuI8nOwoKZnVuY3Rpb24gcmVuZGVySW52Q2FyZFNldHRpbmdzKCkgewogIGNvbnN0IGNh','cmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY2FyZC1ncmlkJyk7CiAgaWYoIWdyaWQpIHJldHVybjsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcCgoYyxpKSA9PiB7CiAgICBjb25zdCB0ZW1wbGF0ZUxhYmVsID0gYy5maWVsZFRlbXBsYXRlPT09J0dlbmVyYWwnID8gJ/CfkrAnIDogYy5maWVsZFRlbXBsYXRlPT09J0VURi9NRicgPyAn8J+TiicgOiBjLmZpZWxkVGVtcGxhdGU9PT0nTWV0YWxzJyA/ICfwn6WHJyA6IGMuZmllbGRUZW1wbGF0ZT09PSdDcnlwdG8nID8gJ/CfqpknIDogYy5maWVsZFRlbXBsYXRlPT09J1JlYWwgRXN0YXRlJyA/ICfwn4+hJyA6ICfwn5OIJzsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjLmljb259PC9zcGFuPgogICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjA7Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJob21lLWNhcmQtaXRlbS1sYWJlbCIgc3R5bGU9IndoaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczsiPiR7Yy5sYWJlbHx8Yy5rZXl9PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNjhlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo2MDA7Ij4ke3RlbXBsYXRlTGFiZWx9ICR7Yy5maWVsZFRlbXBsYXRlfHwnR2VuZXJhbCd9PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlICR7Yy52aXNpYmxlIT09ZmFsc2U/J29uJzonJ30iIG9uY2xpY2s9InRvZ2dsZUludkNhcmQoJHtpfSkiIHRpdGxlPSIke2MudmlzaWJsZSE9PWZhbHNlPydWaXNpYmxlIOKAlCBjbGljayB0byBoaWRlJzonSGlkZGVuIOKAlCBjbGljayB0byBzaG93J30iPgogICAgICAgICR7Yy52aXNpYmxlIT09ZmFsc2U/J+Kckyc6J+KXiyd9CiAgICAgIDwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVJbnZDYXJkKCR7aX0pIiB0aXRsZT0iUmVtb3ZlIiBzdHlsZT0iY29sb3I6dmFyKC0tZXhwZW5zZXMpO2ZvbnQtc2l6ZTowLjhlbTsiPuKclTwvYnV0dG9uPgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKCiAgLy8gRW1vamkgcGlja2VyIHJvdwogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jYXJkLWVtb2ppLXJvdycpOwogIGlmKGVtb2ppUm93KSBlbW9qaVJvdy5pbm5lckhUTUwgPSBJTlZfRU1PSklfT1BUUy5tYXAoZSA9PgogICAgYDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkSW52RW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tJbnZFbW9qaSgnJHtlfScpIj4ke2V9PC9zcGFuPmAKICApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBwaWNrSW52RW1vamkoZSkgeyBwaWNrZWRJbnZFbW9qaSA9IGU7IHJlbmRlckludkNhcmRTZXR0aW5ncygpOyB9CgpmdW5jdGlvbiB0b2dnbGVJbnZDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgY2FyZHNbaWR4XS52aXNpYmxlID0gY2FyZHNbaWR4XS52aXNpYmxlID09PSBmYWxzZSA/IHRydWUgOiBmYWxzZTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICByZW5kZXJJbnZDYXJkU2V0dGluZ3MoKTsKICBpZihob21lVGFiPT09J2ludmVzdCcpIHJlbmRlckhvbWUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlSW52Q2FyZChpZHgpIHsKICBjb25zdCBjYXJkcyA9IGdldEhvbWVJbnZDYXJkcygpOwogIGlmKCFjb25maXJtKGBSZW1vdmUgIiR7Y2FyZHNbaWR4XS5sYWJlbHx8Y2FyZHNbaWR4XS5rZXl9IiBpbnZlc3RtZW50IGNhcmQ/YCkpIHJldHVybjsKICBjYXJkcy5zcGxpY2UoaWR4LCAxKTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICByZW5kZXJJbnZDYXJkU2V0dGluZ3MoKTsKICBpZihob21lVGFiPT09J2ludmVzdCcpIHJlbmRlckhvbWUoKTsKICBzaG93VG9hc3QoJ0NhcmQgcmVtb3ZlZCcpOwp9CgpmdW5jdGlvbiBhZGRJbnZDYXJkKCkgewogIGNvbnN0IG5hbWUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludi1jYXJkLW5hbWUtaW5wdXQnKT8udmFsdWV8fCcnKS50cmltKCk7CiAgaWYoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIGNhcmQgbmFtZSDinYwnKTsgcmV0dXJuOyB9CiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhcmQtdGVtcGxhdGUnKT8udmFsdWUgfHwgJ0dlbmVyYWwnOwogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZUludkNhcmRzKCk7CiAgaWYoY2FyZHMuZmluZChjPT5jLmtleT09PW5hbWV8fGMubGFiZWw9PT1uYW1lKSkgeyBzaG93VG9hc3QoJ0NhcmQgYWxyZWFkeSBleGlzdHMg4pqg77iPJyk7IHJldHVybjsgfQoKICBjb25zdCBpbnZDb2xvcnMgPSBbJyMwRUE1RTknLCcjOEI1Q0Y2JywnIzA1OTY2OScsJyNEOTc3MDYnLCcjREMyNjI2JywnI0VDNDg5OScsJyMxNEI4QTYnLCcjRjk3MzE2JywnIzYzNjZGMScsJyM4NENDMTYnXTsKICBjb25zdCBpbnZCZ3MgICA9IFsnI0UwRjJGRScsJyNGM0VFRkYnLCcjRUNGREY1JywnI0ZGRkJFQicsJyNGRUYyRjInLCcjRkRGMkY4JywnI0YwRkRGQScsJyNGRkY3RUQnLCcjRUVGMkZGJywnI0Y3RkVFNyddOwogIGNvbnN0IGlkeCA9IGNhcmRzLmxlbmd0aCAlIGludkNvbG9ycy5sZW5ndGg7CgogIGNhcmRzLnB1c2goewogICAga2V5OiBuYW1lLAogICAgbGFiZWw6IG5hbWUsCiAgICBpY29uOiBwaWNrZWRJbnZFbW9qaSwKICAgIGNvbG9yOiBpbnZDb2xvcnNbaWR4XSwKICAgIGJnOiBpbnZCZ3NbaWR4XSwKICAgIGZpZWxkVGVtcGxhdGU6IHRlbXBsYXRlLAogICAgdmlzaWJsZTogdHJ1ZSwKICB9KTsKICBzYXZlSG9tZUludkNhcmRzKGNhcmRzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhcmQtbmFtZS1pbnB1dCcpLnZhbHVlID0gJyc7CiAgcmVuZGVySW52Q2FyZFNldHRpbmdzKCk7CiAgaWYoaG9tZVRhYj09PSdpbnZlc3QnKSByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGNhcmQgYWRkZWQhYCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBIT01FIENBUkQgTUFOQUdFUiAoU3BlbmRpbmcpCmNvbnN0IEVNT0pJX09QVFMgPSBbJ/CfjZQnLCfwn5uSJywn8J+PoCcsJ/CfmpcnLCfwn5KKJywn8J+OkycsJ+KaoScsJ/CfjIonLCfinIjvuI8nLCfwn46sJywn8J+RlycsJ/CfkoYnLCfwn5C+Jywn8J+nuScsJ/Cfk7EnLCfimJUnLCfwn46uJywn8J+TmicsJ/CfjZUnLCfwn46BJywn8J+SqicsJ/CfjLEnLCfwn5SnJywn8J+OtSddOwpsZXQgcGlja2VkRW1vamkgPSAn8J+bkic7CgpmdW5jdGlvbiByZW5kZXJIb21lQ2FyZFNldHRpbmdzKCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBjb25zdCBncmlkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1ncmlkJyk7CiAgaWYoIWdyaWQpIHJldHVybjsKICBncmlkLmlubmVySFRNTCA9IGNhcmRzLm1hcCgoYyxpKT0+YAogICAgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjLmljb259PC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0tbGFiZWwiPiR7Yy5sYWJlbH08L3NwYW4+CiAgICAgIDxidXR0b24gY2xhc3M9ImhvbWUtY2FyZC10b2dnbGUgJHtjLnZpc2libGUhPT1mYWxzZT8nb24nOicnfSIgb25jbGljaz0idG9nZ2xlSG9tZUNhcmQoJHtpfSkiIHRpdGxlPSIke2MudmlzaWJsZSE9PWZhbHNlPydWaXNpYmxlJzonSGlkZGVuJ30iPgogICAgICAgICR7Yy52aXNpYmxlIT09ZmFsc2U/J+Kckyc6J+KXiyd9CiAgICAgIDwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVIb21lQ2FyZCgke2l9KSIgdGl0bGU9IlJlbW92ZSIgc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTtmb250LXNpemU6MC44ZW07Ij7inJU8L2J1dHRvbj4KICAgIDwvZGl2PmApLmpvaW4oJycpOwogIC8vIEVtb2ppIHBpY2tlcgogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1lbW9qaS1yb3cnKTsKICBpZihlbW9qaVJvdykgZW1vamlSb3cuaW5uZXJIVE1MID0gRU1PSklfT1BUUy5tYXAoZT0+YDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkRW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tFbW9qaSgnJHtlfScpIj4ke2V9PC9zcGFuPmApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBwaWNrRW1vamkoZSkgeyBwaWNrZWRFbW9qaT1lOyByZW5kZXJIb21lQ2FyZFNldHRpbmdzKCk7IH0KCmZ1bmN0aW9uIHRvZ2dsZUhvbWVDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBjYXJkc1tpZHhdLnZpc2libGUgPSBjYXJkc1tpZHhdLnZpc2libGU9PT1mYWxzZTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUhvbWVDYXJkKGlkeCkgewogIGNvbnN0IGNhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKICBpZighY29uZmlybShgUmVtb3ZlICIke2NhcmRzW2lkeF0ubGFiZWx9IiBjYXJkP2ApKSByZXR1cm47CiAgY2FyZHMuc3BsaWNlKGlkeCwxKTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIGFkZEhvbWVDYXJkKCkgewogIGNvbnN0IG5hbWUgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbWUtY2FyZC1uYW1lLWlucHV0Jyk/LnZhbHVlfHwnJykudHJpbSgpOwogIGlmKCFuYW1lKXtzaG93VG9hc3QoJ0VudGVyIGEgY2FyZCBuYW1lIOKdjCcpO3JldHVybjt9CiAgY29uc3QgY2FyZHMgPSBnZXRIb21lU3BlbmRDYXJkcygpOwogIGNvbnN0IGNvbG9ycz1bJyNGRjZCMzUnLCcjNEE5RUZGJywnI0ZGOEM0MicsJyM0RUNEQzQnLCcjRkY0NzU3JywnIzEwQjk4MScsJyNGRkJFMEInLCcjRkY2QjlEJywnIzY0QjVGNicsJyM3QzNBRUQnXTsKICBjb25zdCBjb2xvciA9IGNvbG9yc1tjYXJkcy5sZW5ndGggJSBjb2xvcnMubGVuZ3RoXTsKICBjYXJkcy5wdXNoKHtrZXk6bmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCdfJyksbGFiZWw6bmFtZSxpY29uOnBpY2tlZEVtb2ppLGNvbG9yLGNsczonb3RoZXItY2F0JyxzdWJjYXRzOltuYW1lXSx2aXNpYmxlOnRydWV9KTsKICBzYXZlSG9tZVNwZW5kQ2FyZHMoY2FyZHMpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob21lLWNhcmQtbmFtZS1pbnB1dCcpLnZhbHVlPScnOwogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iIGNhcmQgYWRkZWQgdG8gaG9tZSFgKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIE5BVklHQVRJT04KLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ','4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHN3aXRjaFNjcmVlbihuYW1lLCBidG4pIHsKICAvLyBBbHdheXMgY2xvc2UgZ29hbHMgb3ZlcmxheSB3aGVuIG5hdmlnYXRpbmcgYXdheQogIGNvbnN0IGdvYWxzT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGlzdC1nb2FscycpOwogIGlmIChnb2Fsc092ZXJsYXkpIGdvYWxzT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGNvbnN0IGdvYWxzRmFiTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWxzLWZhYi1idG4nKTsKICBpZiAoZ29hbHNGYWJOYXYpIGdvYWxzRmFiTmF2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgY2xvc2VHb2FsU2hlZXQoKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NyZWVuJykuZm9yRWFjaChzID0+IHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5uYXYtaXRlbScpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2NyZWVuLSR7bmFtZX1gKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBpZihidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAvLyBTaG93IEZBQiBvbmx5IG9uIHNjcmVlbnMgd2hlcmUgYWRkaW5nIHRyYW5zYWN0aW9ucyBtYWtlcyBzZW5zZQogIGNvbnN0IGZhYlNjcmVlbnMgPSBbJ2hvbWUnLCd0eCcsJ2FkZCddOwogIGNvbnN0IGZhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYWRkLWJ0bicpOwogIGlmKGZhYikgZmFiLnN0eWxlLmRpc3BsYXkgPSBmYWJTY3JlZW5zLmluY2x1ZGVzKG5hbWUpID8gJ2ZsZXgnIDogJ25vbmUnOwogIGlmKG5hbWU9PT0nc3RhdHMnKSByZW5kZXJTdGF0cygpOwogIGlmKG5hbWU9PT0nYWNjb3VudCcpIHJlbmRlckFjY291bnQoKTsKICBpZihuYW1lPT09J3R4JykgcmVuZGVyVHJhbnNhY3Rpb25zKCk7CiAgaWYobmFtZT09PSdob21lJykgcmVuZGVySG9tZSgpOwogIGlmKG5hbWU9PT0nYWRkJykgcmVuZGVyQWRkU2NyZWVuKCk7CiAgaWYobmFtZT09PSdzZXR0aW5ncycpIHJlbmRlclNldHRpbmdzKCk7CiAgaWYobmFtZT09PSdtZXRhbHMnKSByZW5kZXJNZXRhbHMoKTsKICBpZihuYW1lPT09J2ludmVzdCcpIHJlbmRlckludmVzdG1lbnRzKCk7CiAgaWYobmFtZT09PSdkYXRhJykgeyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOyByZW5kZXJEYXRhU2NyZWVuKCk7IH0KICBpZihuYW1lPT09J2J1ZGdldCcpIHsgYnVkZ2V0Vmlld01vbnRoID0gdmlld01vbnRoOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LW1vbnRoLWxhYmVsJykudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgoYnVkZ2V0Vmlld01vbnRoKTsgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7IH0KICBpZihuYW1lPT09J25ldHdvcnRoJykgcmVuZGVyTmV0V29ydGgoKTsKICBpZihuYW1lPT09J2ltcG9ydCcpIHsgc2V0SW1wb3J0VGFiKCd0cmFuc2FjdGlvbnMnLCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW1wb3J0LXRhYicpKTsgcmVuZGVyR2l2ZW5MZWRnZXIoKTsgcmVuZGVyUmVzZXRTdW1tYXJ5KCk7IHJlbmRlck1vbnRoc0xpc3QoKTsgfQp9CgpmdW5jdGlvbiBnb1RvU2NyZWVuKG5hbWUpIHsKICBjb25zdCBnb2Fsc092ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmxpc3QtZ29hbHMnKTsKICBpZiAoZ29hbHNPdmVybGF5KSBnb2Fsc092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBjbG9zZUdvYWxTaGVldCgpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY3JlZW4nKS5mb3JFYWNoKHMgPT4gcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm5hdi1pdGVtJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzY3JlZW4tJHtuYW1lfWApLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGlmKG5hbWU9PT0nc2V0dGluZ3MnKSByZW5kZXJTZXR0aW5ncygpOwogIGlmKG5hbWU9PT0nbWV0YWxzJykgcmVuZGVyTWV0YWxzKCk7CiAgaWYobmFtZT09PSdpbnZlc3QnKSByZW5kZXJJbnZlc3RtZW50cygpOwogIGlmKG5hbWU9PT0nbmV0d29ydGgnKSByZW5kZXJOZXRXb3J0aCgpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gVFJBTlNBQ1RJT05TIC8gQ0FMRU5EQVIKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBjYWxTZWxlY3RlZERheSA9IG51bGw7CgoKbGV0IGNhbFZpZXdNb2RlID0gJ2NhbGVuZGFyJzsgLy8gJ2NhbGVuZGFyJyB8ICdsaXN0JwoKZnVuY3Rpb24gc2V0Q2FsVmlldyhtb2RlKSB7CiAgY2FsVmlld01vZGUgPSBtb2RlOwogIGNvbnN0IGNhbEdyaWQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1ncmlkJyk7CiAgY29uc3QgbGlzdFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWxpc3QtdmlldycpOwogIGNvbnN0IGJ0bkNhbCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC12aWV3LWJ0bi1jYWxlbmRhcicpOwogIGNvbnN0IGJ0bkxpc3QgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC12aWV3LWJ0bi1saXN0Jyk7CiAgY29uc3QgYWN0aXZlU3R5bGUgID0gJ2JhY2tncm91bmQ6IzFFMkE2RTtjb2xvcjp3aGl0ZTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjVweCAxMnB4O2ZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6ODAwO2N1cnNvcjpwb2ludGVyOyc7CiAgY29uc3QgaW5hY3RpdmVTdHlsZT0gJ2JhY2tncm91bmQ6I0YwRjBGMDtjb2xvcjp2YXIoLS10ZXh0LW1lZCk7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzo1cHggMTJweDtmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjgwMDtjdXJzb3I6cG9pbnRlcjsnOwogIGlmIChtb2RlID09PSAnY2FsZW5kYXInKSB7CiAgICBpZiAoY2FsR3JpZCkgY2FsR3JpZC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBpZiAobGlzdFZpZXcpIGxpc3RWaWV3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoYnRuQ2FsKSAgYnRuQ2FsLnN0eWxlLmNzc1RleHQgID0gYWN0aXZlU3R5bGU7CiAgICBpZiAoYnRuTGlzdCkgYnRuTGlzdC5zdHlsZS5jc3NUZXh0ID0gaW5hY3RpdmVTdHlsZTsKICB9IGVsc2UgewogICAgaWYgKGNhbEdyaWQpIGNhbEdyaWQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIGlmIChsaXN0VmlldykgeyBsaXN0Vmlldy5zdHlsZS5kaXNwbGF5ID0gJyc7IHJlbmRlckNhbExpc3RWaWV3KGxpc3RWaWV3KTsgfQogICAgaWYgKGJ0bkNhbCkgIGJ0bkNhbC5zdHlsZS5jc3NUZXh0ICA9IGluYWN0aXZlU3R5bGU7CiAgICBpZiAoYnRuTGlzdCkgYnRuTGlzdC5zdHlsZS5jc3NUZXh0ID0gYWN0aXZlU3R5bGU7CiAgfQp9CgpmdW5jdGlvbiByZW5kZXJDYWxMaXN0Vmlldyhjb250YWluZXIpIHsKICBjb25zdCBbeSwgbW9dID0gdmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgY29uc3QgbWsgPSB2aWV3TW9udGg7CiAgaWYgKCFkYXRhW21rXSkgeyBjb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6MzBweDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo3MDA7Ij5ObyBkYXRhIGZvciB0aGlzIG1vbnRoPC9kaXY+JzsgcmV0dXJuOyB9CiAgY29uc3QgdG9EaXNwID0gdCA9PiBjb252ZXJ0QW10KHQuYW1vdW50LCB0LmN1cnJlbmN5KTsKICBjb25zdCBleHAgID0gKGRhdGFbbWtdLmV4cGVuc2VzICAgIHx8IFtdKS5tYXAodCA9PiAoey4uLnQsIF90eXBlOidleHBlbnNlJ30pKTsKICBjb25zdCBpbmMgID0gKGRhdGFbbWtdLmluY29tZSAgICAgIHx8IFtdKS5tYXAodCA9PiAoey4uLnQsIF90eXBlOidpbmNvbWUnfSkpOwogIGNvbnN0IGludiAgPSAoZGF0YVtta10uaW52ZXN0bWVudHMgfHwgW10pLm1hcCh0ID0+ICh7Li4udCwgX3R5cGU6J2ludmVzdG1lbnQnfSkpOwogIGNvbnN0IGFkZCAgPSAoZGF0YVtta10uYWRkaXRpb25hbCAgfHwgW10pLm1hcCh0ID0+ICh7Li4udCwgX3R5cGU6J2FkZGl0aW9uYWwnfSkpOwogIGNvbnN0IGFsbCAgPSBbLi4uaW5jLCAuLi5leHAsIC4uLmludiwgLi4uYWRkXS5zb3J0KChhLGIpPT4oYi5kYXRlfHwnJykubG9jYWxlQ29tcGFyZShhLmRhdGV8fCcnKSk7CgogIGNvbnN0IHR5cGVDb2xvcnMgPSB7IGV4cGVuc2U6JyNFRjQ0NDQnLCBpbmNvbWU6JyMxMEI5ODEnLCBpbnZlc3RtZW50OicjN0MzQUVEJywgYWRkaXRpb25hbDonI0Y1OUUwQicgfTsKICBjb25zdCB0eXBlTGFiZWxzID0geyBleHBlbnNlOidFeHBlbnNlJywgaW5jb21lOidJbmNvbWUnLCBpbnZlc3RtZW50OidJbnZlc3QnLCBhZGRpdGlvbmFsOidPdGhlcicgfTsKCiAgLy8gR3JvdXAgYnkgZGF0ZQogIGNvbnN0IGJ5RGF0ZSA9IHt9OwogIGFsbC5mb3JFYWNoKHQgPT4gewogICAgY29uc3QgZCA9IHQuZGF0ZSB8fCAnPyc7CiAgICBpZiAoIWJ5RGF0ZVtkXSkgYnlEYXRlW2RdID0gW107CiAgICBieURhdGVbZF0ucHVzaCh0KTsKICB9KTsKCiAgY29uc3QgZGF0ZUtleXMgPSBPYmplY3Qua2V5cyhieURhdGUpLnNvcnQoKGEsYikgPT4gYi5sb2NhbGVDb21wYXJlKGEpKTsKICBjb25zdCB0b3RhbEluYyA9IGluYy5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsRXhwID0gZXhwLnJlZHVjZSgocyx0KT0+cyt0b0Rpc3AodCksMCk7CiAgY29uc3QgdG90YWxJbnYgPSBpbnYucmVkdWNlKChzLHQpPT5zK3RvRGlzcCh0KSwwKTsKCiAgbGV0IGh0bWwgPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp3aGl0ZTtib3JkZXItcmFkaXVzOjE0cHg7cGFkZGluZzoxMnB4IDE2cHg7bWFyZ2luLWJvdHRvbToxMHB4O2JveC1zaGFkb3c6dmFyKC0tY2FyZC1zaGFkb3cpOyI+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWFyb3VuZDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICA8ZGl2PjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOyI+SW5jb21lPC9kaXY+PGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2NvbG9yOnZhcigtLWluY29tZSk7Ij4ke2ZtdCh0b3RhbEluYyl9PC9kaXY+PC9kaXY+CiAgICAgIDxkaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7Ij5FeHBlbnNlczwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ij4ke2ZtdCh0b3RhbEV4cCl9PC9kaXY+PC9kaXY+CiAgICAgIDxkaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTt0ZXh0LXRyYW5zZm9ybTp1cHBlcmNhc2U7Ij5JbnZlc3Rpbmc8L2Rpdj48ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Y29sb3I6IzdDM0FFRDsiPiR7Zm10KHRvdGFsSW52KX08L2Rpdj48L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7CgogIGRhdGVLZXlz','LmZvckVhY2goZGF0ZSA9PiB7CiAgICBjb25zdCB0eG5zID0gYnlEYXRlW2RhdGVdOwogICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUgKyAnVDAwOjAwOjAwJyk7CiAgICBjb25zdCBkYXlMYWJlbCA9IGQudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycsIHsgd2Vla2RheTonc2hvcnQnLCBtb250aDonc2hvcnQnLCBkYXk6J251bWVyaWMnIH0pOwogICAgY29uc3QgZGF5VG90YWwgPSB0eG5zLnJlZHVjZSgocyx0KSA9PiB7CiAgICAgIGlmICh0Ll90eXBlPT09J2luY29tZScpIHJldHVybiBzICsgdG9EaXNwKHQpOwogICAgICBpZiAodC5fdHlwZT09PSdleHBlbnNlJ3x8dC5fdHlwZT09PSdhZGRpdGlvbmFsJykgcmV0dXJuIHMgLSB0b0Rpc3AodCk7CiAgICAgIHJldHVybiBzOwogICAgfSwgMCk7CiAgICBodG1sICs9IGA8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjhweDsiPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6NnB4IDEycHg7YmFja2dyb3VuZDojRjhGOEY4O2JvcmRlci1yYWRpdXM6MTBweDttYXJnaW4tYm90dG9tOjRweDsiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MC44MmVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4ke2RheUxhYmVsfTwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC44MmVtO2NvbG9yOiR7ZGF5VG90YWw+PTA/J3ZhcigtLWluY29tZSknOid2YXIoLS1leHBlbnNlcyknfTsiPiR7ZGF5VG90YWw+PTA/JysnOicnfSR7Zm10KE1hdGguYWJzKGRheVRvdGFsKSl9PC9kaXY+CiAgICAgIDwvZGl2PmA7CiAgICB0eG5zLmZvckVhY2godCA9PiB7CiAgICAgIGNvbnN0IGNvbG9yID0gdHlwZUNvbG9yc1t0Ll90eXBlXSB8fCAnIzg4OCc7CiAgICAgIGNvbnN0IGxhYmVsID0gdHlwZUxhYmVsc1t0Ll90eXBlXSB8fCB0Ll90eXBlOwogICAgICBjb25zdCBwcmVmaXggPSB0Ll90eXBlID09PSAnaW5jb21lJyA/ICcrJyA6ICctJzsKICAgICAgaHRtbCArPSBgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDtwYWRkaW5nOjdweCAxMnB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNGNUY1RjU7Ij4KICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDo3cHg7aGVpZ2h0OjdweDtib3JkZXItcmFkaXVzOjUwJTtiYWNrZ3JvdW5kOiR7Y29sb3J9O2ZsZXgtc2hyaW5rOjA7Ij48L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjA7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOyI+JHt0LmRlc2NyaXB0aW9ufHx0LmNhdGVnb3J5fHwn4oCUJ308L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjcyZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+JHt0LmNhdGVnb3J5fHwnJ30gwrcgJHtsYWJlbH08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuODhlbTtjb2xvcjoke2NvbG9yfTtmbGV4LXNocmluazowOyI+JHtwcmVmaXh9JHtmbXQodG9EaXNwKHQpKX08L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pOwogICAgaHRtbCArPSBgPC9kaXY+YDsKICB9KTsKCiAgaWYgKGRhdGVLZXlzLmxlbmd0aCA9PT0gMCkgaHRtbCArPSBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzozMHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjcwMDsiPk5vIHRyYW5zYWN0aW9ucyB0aGlzIG1vbnRoPC9kaXY+YDsKICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gY2FsQ2hhbmdlTW9udGgoZGlyKSB7CiAgY29uc3QgW3ksbV0gPSB2aWV3TW9udGguc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICBjb25zdCBkID0gbmV3IERhdGUoeSwgbS0xK2RpciwgMSk7CiAgdmlld01vbnRoID0gYCR7ZC5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpfWA7CiAgLy8gUmVmcmVzaCBsaXN0IHZpZXcgaWYgYWN0aXZlCiAgaWYgKGNhbFZpZXdNb2RlID09PSAnbGlzdCcpIHsgY29uc3QgbHY9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1saXN0LXZpZXcnKTsgaWYobHYmJmx2LnN0eWxlLmRpc3BsYXkhPT0nbm9uZScpIHJlbmRlckNhbExpc3RWaWV3KGx2KTsgfQogIGNvbnN0IHRvcGJhck1vbnRoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGJhci1tb250aCcpOwogIGlmKHRvcGJhck1vbnRoKSB0b3BiYXJNb250aC50ZXh0Q29udGVudCA9IGdldERpc3BsYXlNb250aCh2aWV3TW9udGgpOwogIGNhbFNlbGVjdGVkRGF5ID0gbnVsbDsKICByZW5kZXJUcmFuc2FjdGlvbnMoKTsKICByZW5kZXJIb21lKCk7Cn0KCmZ1bmN0aW9uIGZtdFNob3J0KG4pIHsKICBpZihuID49IDEwMDApIHJldHVybiAobi8xMDAwKS50b0ZpeGVkKDEpKydrJzsKICByZXR1cm4gbi50b0ZpeGVkKDApOwp9CgpmdW5jdGlvbiByZW5kZXJUcmFuc2FjdGlvbnMoKSB7CiAgZW5zdXJlTW9udGgodmlld01vbnRoKTsKICBjb25zdCBtID0gZGF0YVt2aWV3TW9udGhdOwogIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgY29uc3QgW3ksIG1vXSA9IHZpZXdNb250aC5zcGxpdCgnLScpLm1hcChOdW1iZXIpOwoKICBjb25zdCB0aXRsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1tb250aC10aXRsZScpOwogIGlmKHRpdGxlRWwpIHRpdGxlRWwudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgodmlld01vbnRoKTsKCiAgLy8gR2F0aGVyIGFsbCB0cmFuc2FjdGlvbnMg4oCUIG5vcm1hbGl6ZSBkYXRlcyBzbyBZWVlZLU0tRCBtYXRjaGVzIFlZWVktTU0tREQKICBsZXQgYWxsVHggPSBbXTsKICBjb25zdCBwdXNoVHggPSAobGlzdCwgdHlwZSkgPT4gKGxpc3R8fFtdKS5mb3JFYWNoKChlLGkpID0+IHsKICAgIGNvbnN0IG5vcm1EYXRlID0gbm9ybWFsaXplRGF0ZShlLmRhdGUpOyAgIC8vIOKGkCBmaXg6IGFsd2F5cyBwYWRkZWQgWVlZWS1NTS1ERAogICAgYWxsVHgucHVzaCh7Li4uZSwgZGF0ZTogbm9ybURhdGUsIF90eXBlOiB0eXBlLCBfaWR4OiBpfSk7CiAgfSk7CiAgcHVzaFR4KG0uZXhwZW5zZXMsICAgICAgJ2V4cGVuc2UnKTsKICBwdXNoVHgobS5pbmNvbWUsICAgICAgICAnaW5jb21lJyk7CiAgcHVzaFR4KG0uaW52ZXN0bWVudHMsICAgJ2ludmVzdG1lbnQnKTsKICBwdXNoVHgobS5kZWJ0cywgICAgICAgICAnZGVidCcpOwogIHB1c2hUeChtLmdpdmVuVG9PdGhlcnMsICdnaXZlbicpOwogIHB1c2hUeChtLmFkZGl0aW9uYWwsICAgICdhZGRpdGlvbmFsJyk7CgogIC8vIFN1bW1hcnkg4oCUIGNvbnZlcnQgZWFjaCBlbnRyeSB0byBkaXNwbGF5IGN1cnJlbmN5IGJlZm9yZSBzdW1taW5nCiAgY29uc3QgdG9EaXNwID0gdCA9PiBjb252ZXJ0QW10KHQuYW1vdW50LCB0LmN1cnJlbmN5KTsKICBjb25zdCB0b3RhbEluYyAgPSBhbGxUeC5maWx0ZXIodD0+dC5fdHlwZT09PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsRXhwICA9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2V4cGVuc2UnfHx0Ll90eXBlPT09J2FkZGl0aW9uYWwnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsSW52ICA9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2ludmVzdG1lbnQnKS5yZWR1Y2UoKHMsdCk9PnMrdG9EaXNwKHQpLDApOwogIGNvbnN0IHRvdGFsT3RoZXI9IGFsbFR4LmZpbHRlcih0PT50Ll90eXBlPT09J2RlYnQnfHx0Ll90eXBlPT09J2dpdmVuJykucmVkdWNlKChzLHQpPT5zK3RvRGlzcCh0KSwwKTsKICBjb25zdCBzYXZpbmdzICAgPSB0b3RhbEludjsgIC8vICJJbnZlc3RpbmciIHRpbGUgc2hvd3MgaW52ZXN0bWVudHMgYW1vdW50CiAgY29uc3QgbmV0ICAgICAgID0gdG90YWxJbmMgLSB0b3RhbEV4cCAtIHRvdGFsSW52IC0gdG90YWxPdGhlcjsKCiAgY29uc3QgZWxfaW5jICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdG90YWwtaW5jb21lJyk7CiAgY29uc3QgZWxfZXhwICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdG90YWwtZXhwZW5zZScpOwogIGNvbnN0IGVsX3NhdiAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLXRvdGFsLXNhdmluZ3MnKTsKICBjb25zdCBlbF9uZXQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC10b3RhbC1uZXQnKTsKICBpZihlbF9pbmMpIGVsX2luYy50ZXh0Q29udGVudCA9IGZtdCh0b3RhbEluYyk7CiAgaWYoZWxfZXhwKSBlbF9leHAudGV4dENvbnRlbnQgPSBmbXQodG90YWxFeHApOwogIGlmKGVsX3NhdikgeyBlbF9zYXYudGV4dENvbnRlbnQgPSBmbXQoc2F2aW5ncyk7IGVsX3Nhdi5zdHlsZS5jb2xvciA9ICcjN0MzQUVEJzsgfQogIGlmKGVsX25ldCkgewogICAgZWxfbmV0LnRleHRDb250ZW50ID0gKG5ldD49MD8nKyc6Jy0nKSArIGZtdChNYXRoLmFicyhuZXQpKTsKICAgIGVsX25ldC5zdHlsZS5jb2xvciA9IG5ldD49MCA/ICd2YXIoLS1pbmNvbWUpJyA6ICd2YXIoLS1leHBlbnNlcyknOwogIH0KCiAgLy8gR3JvdXAgYnkgbm9ybWFsaXplZCBkYXRlCiAgY29uc3QgYnlEYXRlID0ge307CiAgYWxsVHguZm9yRWFjaCh0ID0+IHsKICAgIGNvbnN0IGQgPSB0LmRhdGV8fCcnOwogICAgaWYoZCkgeyBpZighYnlEYXRlW2RdKSBieURhdGVbZF09W107IGJ5RGF0ZVtkXS5wdXNoKHQpOyB9CiAgfSk7CgogIC8vIEJ1aWxkIGNhbGVuZGFyIGdyaWQKICBjb25zdCBmaXJzdERvdyA9IG5ldyBEYXRlKHksIG1vLTEsIDEpLmdldERheSgpOwogIGNvbnN0IGRheXNJbk1vbnRoID0gbmV3IERhdGUoeSwgbW8sIDApLmdldERhdGUoKTsKICBjb25zdCB0eXBlQ29sb3JzID0gewogICAgZXhwZW5zZTonI0VGNDQ0NCcsIGluY29tZTonIzEwQjk4MScsIGludmVzdG1lbnQ6JyM3QzNBRUQnLAogICAgZGVidDonIzhCNUNGNicsIGdpdmVuOicjRkY2QjlEJywgYWRkaXRpb25hbDonI0Y1OUUwQicKICB9OwoKICBsZXQgY2VsbHMgPSAnJzsKICBmb3IobGV0IGk9MDsgaTxmaXJzdERvdzsgaSsrKSB7CiAgICBjZWxscyArPSBgPGRpdiBjbGFzcz0iY2FsLWNlbGwgZW1wdHkiPjwvZGl2PmA7CiAgfQogIGZvcihsZXQgZD0xOyBkPD1kYXlzSW5Nb250aDsgZCsrKSB7CiAgICBjb25zdCBkYXRlU3RyID0gYCR7dmlld01vbnRofS0ke1N0cmluZyhkKS5wYWRTdGFydCgyLCcwJyl9YDsKICAgIGNvbnN0IHR4cyA9IGJ5RGF0ZVtkYXRlU3RyXSB8fCBbXTsKICAgIGNvbnN0IGlzVG9kYXkgPSBkYXRlU3RyID09PSB0b2RheTsKICAgIGNvbnN0IGlzU2VsICAgPSBkYXRlU3RyID09PSBjYWxTZWxlY3RlZERheTsKICAgIGNvbnN0IGRheUV4cCAgPSB0eHMuZmlsdGVyKHQ9PnQuX3R5cGUhPT0naW5jb21lJykucmVkdWNlKChzLHQpPT5zK2NvbnZlcnRBbXQodC5hbW91bnQsdC5jdXJyZW5jeSksMCk7CiAgICBjb25zdCBkYXlJbmMgID0gdHhzLmZpbHRlcih0PT50Ll90eXBlPT09J2luY29tZScpLnJlZHVjZSgocyx0KT0+cytjb252ZXJ0QW10KHQuYW1vdW50LHQuY3VycmVuY3kpLDApOwogICAgY29uc3QgdW5pcXVlVHlwZXMgPSBbLi4ubmV3IFNldCh0eHMubWFwKHQ9PnQuX3R5cGUpKV0uc2xpY2UoMCw0KTsKICAgIGNvbnN0IGRvdHMgPSB1bmlxdWVUeXBlcy5tYXAodHA9PmA8ZGl2IGNsYXNzPSJjYWwtZG90IiBzdHlsZT0iYmFja2dyb3VuZDoke3R5cGVDb2xvcnNbdHBdfHwnI2NjYyd9OyI+PC9kaXY+YCkuam9pbignJyk7CiAgICBsZXQgYW10SHRtbCA9ICcnOwogICAgaWYodHhzLmxlbmd0','aCA+IDApIHsKICAgICAgY29uc3QgcGFydHMgPSBbXTsKICAgICAgaWYoZGF5RXhwPjApIHBhcnRzLnB1c2goYDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1leHBlbnNlcykiPiR7Zm10U2hvcnQoZGF5RXhwKX08L3NwYW4+YCk7CiAgICAgIGlmKGRheUluYz4wKSBwYXJ0cy5wdXNoKGA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0taW5jb21lKSI+JHtmbXRTaG9ydChkYXlJbmMpfTwvc3Bhbj5gKTsKICAgICAgYW10SHRtbCA9IGA8ZGl2IGNsYXNzPSJjYWwtY2VsbC1hbXQiPiR7cGFydHMuam9pbignPGJyPicpfTwvZGl2PmA7CiAgICB9CiAgICBjZWxscyArPSBgPGRpdiBjbGFzcz0iY2FsLWNlbGwke2lzVG9kYXk/JyB0b2RheSc6Jyd9JHtpc1NlbD8nIHNlbGVjdGVkJzonJ30iIG9uY2xpY2s9ImNhbFNlbGVjdERheSgnJHtkYXRlU3RyfScpIj4KICAgICAgPGRpdiBjbGFzcz0iY2FsLWRheS1udW0iPiR7ZH08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY2FsLWRvdHMiPiR7ZG90c308L2Rpdj4KICAgICAgJHthbXRIdG1sfQogICAgPC9kaXY+YDsKICB9CgogIGNvbnN0IGNhbEdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWdyaWQnKTsKICBpZihjYWxHcmlkKSBjYWxHcmlkLmlubmVySFRNTCA9IGNlbGxzOwogIHJlbmRlckNhbERheURldGFpbChhbGxUeCk7Cn0KCmZ1bmN0aW9uIGNhbFNlbGVjdERheShkYXRlU3RyKSB7CiAgY2FsU2VsZWN0ZWREYXkgPSBjYWxTZWxlY3RlZERheSA9PT0gZGF0ZVN0ciA/IG51bGwgOiBkYXRlU3RyOwogIC8vIHNjcm9sbCBkZXRhaWwgaW50byB2aWV3IHNtb290aGx5CiAgaWYoY2FsU2VsZWN0ZWREYXkpIHsKICAgIHNldFRpbWVvdXQoKCk9PnsgY29uc3QgZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1kYXktZGV0YWlsJyk7IGlmKGVsKSBlbC5zY3JvbGxJbnRvVmlldyh7YmVoYXZpb3I6J3Ntb290aCcsYmxvY2s6J25lYXJlc3QnfSk7IH0sIDgwKTsKICB9CiAgcmVuZGVyVHJhbnNhY3Rpb25zKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckNhbERheURldGFpbChhbGxUeCkgewogIGNvbnN0IGRldGFpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtZGF5LWRldGFpbCcpOwogIGlmKCFkZXRhaWwpIHJldHVybjsKICBpZighY2FsU2VsZWN0ZWREYXkpIHsgZGV0YWlsLmlubmVySFRNTD0nJzsgcmV0dXJuOyB9CgogIGNvbnN0IGRheVR4ID0gKGFsbFR4fHxbXSkuZmlsdGVyKHQgPT4gdC5kYXRlID09PSBjYWxTZWxlY3RlZERheSk7CiAgbGV0IGQ7IHRyeSB7IGQgPSBuZXcgRGF0ZShjYWxTZWxlY3RlZERheSsnVDAwOjAwOjAwJyk7IH0gY2F0Y2goZSl7IGQgPSBuZXcgRGF0ZSgpOyB9CiAgY29uc3QgZGF0ZUxhYmVsID0gZC50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7d2Vla2RheTonbG9uZycsbW9udGg6J2xvbmcnLGRheTonbnVtZXJpYyd9KTsKICBjb25zdCBkYXlJbiAgPSBkYXlUeC5maWx0ZXIodD0+dC5fdHlwZT09PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrY29udmVydEFtdCh0LmFtb3VudCx0LmN1cnJlbmN5KSwwKTsKICBjb25zdCBkYXlPdXQgPSBkYXlUeC5maWx0ZXIodD0+dC5fdHlwZSE9PSdpbmNvbWUnKS5yZWR1Y2UoKHMsdCk9PnMrY29udmVydEFtdCh0LmFtb3VudCx0LmN1cnJlbmN5KSwwKTsKICBjb25zdCBuZXQgICAgPSBkYXlJbiAtIGRheU91dDsKCiAgaWYoZGF5VHgubGVuZ3RoID09PSAwKSB7CiAgICBkZXRhaWwuaW5uZXJIVE1MPWA8ZGl2IGNsYXNzPSJjYWwtZW1wdHktZGF5Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjEuOGVtO21hcmdpbi1ib3R0b206OHB4OyI+8J+XkzwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuOTVlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtkYXRlTGFiZWx9PC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjgyZW07bWFyZ2luLXRvcDo2cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij5ObyB0cmFuc2FjdGlvbnMgcmVjb3JkZWQ8L2Rpdj4KICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJvcGVuUXVpY2tBZGQoJ2V4cGVuc2UnLG51bGwpIiBzdHlsZT0ibWFyZ2luLXRvcDoxMnB4O2JhY2tncm91bmQ6dmFyKC0teWVsbG93KTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzo4cHggMThweDtmb250LWZhbWlseTpOdW5pdG8sc2Fucy1zZXJpZjtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODVlbTtjdXJzb3I6cG9pbnRlcjsiPisgQWRkIG9uZTwvYnV0dG9uPgogICAgPC9kaXY+YDsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHR5cGVMYWJlbCA9IHtleHBlbnNlOidFeHBlbnNlJyxpbmNvbWU6J0luY29tZScsaW52ZXN0bWVudDonSW52ZXN0bWVudCcsZGVidDonRGVidCcsZ2l2ZW46J0dpdmVuJyxhZGRpdGlvbmFsOidBZGRpdGlvbmFsJ307CiAgY29uc3QgaWNvbk1hcCAgID0ge2V4cGVuc2U6J/CfkrgnLGluY29tZTon8J+StScsaW52ZXN0bWVudDon8J+TiCcsZGVidDon8J+TiScsZ2l2ZW46J/CfpJ0nLGFkZGl0aW9uYWw6J/CfjoEnfTsKICBjb25zdCBiZ01hcCAgICAgPSB7ZXhwZW5zZTonI0VGNDQ0NDE1JyxpbmNvbWU6JyMxMEI5ODExNScsaW52ZXN0bWVudDonIzdDM0FFRDE1JyxkZWJ0OicjOEI1Q0Y2MTUnLGdpdmVuOicjRkY2QjlEMTUnLGFkZGl0aW9uYWw6JyNGNTlFMEIxNSd9OwogIGNvbnN0IGNvbG9yTWFwICA9IHtleHBlbnNlOicjRUY0NDQ0JyxpbmNvbWU6JyMxMEI5ODEnLGludmVzdG1lbnQ6JyM3QzNBRUQnLGRlYnQ6JyM4QjVDRjYnLGdpdmVuOicjRkY2QjlEJyxhZGRpdGlvbmFsOicjRjU5RTBCJ307CiAgLy8gQW1vdW50czogaW5jb21lIGdyZWVuIHBsYWluLCBldmVyeXRoaW5nIGVsc2UgcmVkIHBsYWluIOKAlCBubyBtaXNsZWFkaW5nIHNpZ25zCiAgY29uc3QgYW10Q29sb3IgID0gdCA9PiB0Ll90eXBlPT09J2luY29tZScgPyAndmFyKC0taW5jb21lKScgOiAndmFyKC0tZXhwZW5zZXMpJzsKCiAgZGV0YWlsLmlubmVySFRNTD1gCiAgICA8IS0tIERheSBzdW1tYXJ5IHN0cmlwIC0tPgogICAgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS13aGl0ZSk7Ym9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMpO2JveC1zaGFkb3c6dmFyKC0tY2FyZC1zaGFkb3cpO3BhZGRpbmc6MTRweCAxNnB4O21hcmdpbi1ib3R0b206MTBweDsiPgogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi1ib3R0b206MTBweDsiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjFlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtkYXRlTGFiZWx9PC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43NWVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDttYXJnaW4tdG9wOjJweDsiPiR7ZGF5VHgubGVuZ3RofSB0cmFuc2FjdGlvbiR7ZGF5VHgubGVuZ3RoPT09MT8nJzoncyd9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsiPgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7bWFyZ2luLWJvdHRvbToycHg7Ij5ORVQ8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxLjFlbTtmb250LXdlaWdodDo5MDA7Y29sb3I6JHtuZXQ+PTA/J3ZhcigtLWluY29tZSknOid2YXIoLS1leHBlbnNlcyknfTsiPiR7bmV0Pj0wPycrJzon4oiSJ30ke2ZtdChNYXRoLmFicyhuZXQpKX08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6MTBweDsiPgogICAgICAgICR7ZGF5SW4+MD9gPGRpdiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6I0YwRkJGMztib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzo4cHggMTBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLWluY29tZSk7bWFyZ2luLWJvdHRvbToycHg7Ij5JTjwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45NWVtO2NvbG9yOnZhcigtLWluY29tZSk7Ij4rJHtmbXQoZGF5SW4pfTwvZGl2PjwvZGl2PmA6Jyd9CiAgICAgICAgJHtkYXlPdXQ+MD9gPGRpdiBzdHlsZT0iZmxleDoxO2JhY2tncm91bmQ6I0ZGRjBGMDtib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzo4cHggMTBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY4ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLWV4cGVuc2VzKTttYXJnaW4tYm90dG9tOjJweDsiPk9VVDwvZGl2PjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45NWVtO2NvbG9yOnZhcigtLWV4cGVuc2VzKTsiPuKIkiR7Zm10KGRheU91dCl9PC9kaXY+PC9kaXY+YDonJ30KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFRyYW5zYWN0aW9uIHJvd3Mg4oCUIHZpZXcgb25seSwg4pyVIHRvIGRlbGV0ZSAtLT4KICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47Z2FwOjhweDsiPgogICAgICAke2RheVR4Lm1hcCh0PT5gCiAgICAgICAgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp2YXIoLS13aGl0ZSk7Ym9yZGVyLXJhZGl1czp2YXIoLS1yYWRpdXMtc20pO2JveC1zaGFkb3c6MCAycHggMTBweCByZ2JhKDAsMCwwLDAuMDYpO3BhZGRpbmc6MTJweCAxNHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEycHg7Ij4KICAgICAgICAgIDwhLS0gSWNvbiAtLT4KICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOjQycHg7aGVpZ2h0OjQycHg7Ym9yZGVyLXJhZGl1czoxM3B4O2JhY2tncm91bmQ6JHtiZ01hcFt0Ll90eXBlXXx8JyNlZWUnfTtib3JkZXI6MS41cHggc29saWQgJHtjb2xvck1hcFt0Ll90eXBlXXx8JyNjY2MnfTIyO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXNpemU6MS4yZW07ZmxleC1zaHJpbms6MDsiPiR7aWNvbk1hcFt0Ll90eXBlXXx8J/CfkrAnfTwvZGl2PgogICAgICAgICAgPCEtLSBJbmZvIC0tPgogICAgICAgICAgPGRpdiBzdHlsZT0iZmxleDoxO21pbi13aWR0aDowOyI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjZweDttYXJnaW4tYm90dG9tOjNweDsiPgogICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOWVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7d2hpdGUtc3BhY2U6bm93cmFwO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOyI+JHt0LmNhdGVnb3J5fHwnT3RoZXInfTwvc3Bhbj4KICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNjVlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6JHtjb2xvck1hcFt0Ll90eXBlXX07YmFja2dyb3VuZDoke2JnTWFwW3QuX3R5cGVdfTtib3JkZXItcmFkaXVzOjIwcHg7cGFkZGluZzoycHggN3B4O2ZsZXgtc2hyaW5rOjA7Ij4ke3R5cGVMYWJlbFt0Ll90eXBlXXx8dC5fdHlwZX08L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7Ij4ke3QuZGVzY3JpcHRpb258fCfigJQnfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIEFtb3VudCAtLT4KICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7ZmxleC1zaHJpbms6','MDsiPgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MWVtO2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjoke2FtdENvbG9yKHQpfTsiPiR7Zm10Q29udmVydGVkRnVsbCh0LmFtb3VudCx0LmN1cnJlbmN5KX08L2Rpdj4KICAgICAgICAgICAgJHt0LmN1cnJlbmN5JiZ0LmN1cnJlbmN5IT09Y3VycmVudEN1cnJlbmN5LmNvZGU/YDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY1ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+JHt0LmN1cnJlbmN5fSAke051bWJlcih0LmFtb3VudHx8MCkudG9GaXhlZCgyKX08L2Rpdj5gOicnfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIERlbGV0ZSAtLT4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0iY2FsRGVsZXRlVHgoJyR7dmlld01vbnRofScsJyR7dC5fdHlwZX0nLCR7dC5faWR4fSkiIAogICAgICAgICAgICBzdHlsZT0iZmxleC1zaHJpbms6MDtiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7d2lkdGg6MjhweDtoZWlnaHQ6MjhweDtjb2xvcjojRUY0NDQ0O2ZvbnQtc2l6ZTowLjhlbTtjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7Zm9udC13ZWlnaHQ6OTAwOyI+4pyVPC9idXR0b24+CiAgICAgICAgPC9kaXY+YCkuam9pbignJyl9CiAgICA8L2Rpdj4KICBgOwp9CgpmdW5jdGlvbiBjYWxEZWxldGVUeChtb250aEtleSwgdHlwZSwgaWR4KSB7CiAgaWYoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHRyYW5zYWN0aW9uPycpKSByZXR1cm47CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFt0eXBlXV0uc3BsaWNlKGlkeCwxKTsKICBzYXZlKCk7IHJlbmRlclRyYW5zYWN0aW9ucygpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgnVHJhbnNhY3Rpb24gZGVsZXRlZCcpOwp9CgpmdW5jdGlvbiBzZXRUeEZpbHRlcihmaWx0ZXIsIGVsKSB7IC8qIGxlZ2FjeSDigJMgbm8tb3AgaW4gY2FsZW5kYXIgdmlldyAqLyB9CgpmdW5jdGlvbiBkZWxldGVUeChtb250aEtleSwgdHlwZSwgaWR4KSB7CiAgaWYoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHRyYW5zYWN0aW9uPycpKSByZXR1cm47CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFt0eXBlXV0uc3BsaWNlKGlkeCwxKTsKICBzYXZlKCk7IHJlbmRlclRyYW5zYWN0aW9ucygpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgnVHJhbnNhY3Rpb24gZGVsZXRlZCcpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gQUREIFNDUkVFTiAoZnVsbCBzY3JlZW4gYWRkKQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gcmVuZGVyQWRkU2NyZWVuKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtZGF0ZScpLnZhbHVlID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CiAgcmVuZGVyTnVtcGFkKCk7IHJlbmRlclN1YkNhdHMoKTsKfQoKZnVuY3Rpb24gc2V0QWRkVHlwZSh0eXBlLCBidG4pIHsKICBjdXJyZW50QWRkVHlwZT10eXBlOyBjdXJyZW50QW1vdW50U3RyPScnOyB1cGRhdGVBbW91bnREaXNwbGF5KCk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFkZC10eXBlLWJ0bicpLmZvckVhY2goYj0+Yi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIHJlbmRlclN1YkNhdHMoKTsKfQoKZnVuY3Rpb24gcmVuZGVyU3ViQ2F0cygpIHsKICBjb25zdCBjYXRzPWdldENhdHNGb3JUeXBlKGN1cnJlbnRBZGRUeXBlKTsKICBzZWxlY3RlZFN1YkNhdD1jYXRzWzBdfHwnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3ViLWNhdHMtcm93JykuaW5uZXJIVE1MPWNhdHMubWFwKGM9PmA8ZGl2IGNsYXNzPSJzdWItY2F0LXBpbGwgJHtjPT09c2VsZWN0ZWRTdWJDYXQ/J2FjdGl2ZSc6Jyd9IiBvbmNsaWNrPSJzZWxlY3RTdWJDYXQoJyR7Y30nLHRoaXMpIj4ke2N9PC9kaXY+YCkuam9pbignJyk7Cn0KZnVuY3Rpb24gc2VsZWN0U3ViQ2F0KGNhdCxlbCkgeyBzZWxlY3RlZFN1YkNhdD1jYXQ7IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWItY2F0LXBpbGwnKS5mb3JFYWNoKHA9PnAuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOyBlbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgfQoKZnVuY3Rpb24gcmVuZGVyTnVtcGFkKCkgewogIGNvbnN0IGtleXM9Wyc3JywnOCcsJzknLCfijKsnLCc0JywnNScsJzYnLCclJywnMScsJzInLCczJywnw7cnLCckJywnMCcsJy4nLCc9J107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bXBhZC1ncmlkJykuaW5uZXJIVE1MPWtleXMubWFwKGs9PmA8YnV0dG9uIGNsYXNzPSJudW0tYnRuICR7WyfijKsnLCclJywnw7cnXS5pbmNsdWRlcyhrKT8nc3BlY2lhbCc6Jyd9ICR7az09PSc9Jz8nc2F2ZS1idG4nOicnfSIgb25jbGljaz0iaGFuZGxlTnVtcGFkKCcke2t9JykiPiR7a308L2J1dHRvbj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gaGFuZGxlTnVtcGFkKGtleSkgewogIGlmKGtleT09PSfijKsnKXtjdXJyZW50QW1vdW50U3RyPWN1cnJlbnRBbW91bnRTdHIuc2xpY2UoMCwtMSk7fQogIGVsc2UgaWYoa2V5PT09Jz0nKXtzYXZlVHJhbnNhY3Rpb24oKTtyZXR1cm47fQogIGVsc2UgaWYoa2V5PT09JyQnKXtjdXJyZW50QW1vdW50U3RyPScnO30KICBlbHNlIGlmKFsnJScsJ8O3J10uaW5jbHVkZXMoa2V5KSl7fQogIGVsc2V7aWYoY3VycmVudEFtb3VudFN0ci5pbmNsdWRlcygnLicpJiZrZXk9PT0nLicpIHJldHVybjsgaWYoY3VycmVudEFtb3VudFN0ci5sZW5ndGg+PTEwKSByZXR1cm47IGN1cnJlbnRBbW91bnRTdHIrPWtleTt9CiAgdXBkYXRlQW1vdW50RGlzcGxheSgpOwp9CmZ1bmN0aW9uIHVwZGF0ZUFtb3VudERpc3BsYXkoKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtYW1vdW50LWRpc3BsYXknKS50ZXh0Q29udGVudD1jdXJyZW50QW1vdW50U3RyfHwnMCc7IH0KCmZ1bmN0aW9uIHNhdmVUcmFuc2FjdGlvbigpIHsKICBjb25zdCBhbW91bnQ9cGFyc2VGbG9hdChjdXJyZW50QW1vdW50U3RyKTsKICBpZighYW1vdW50fHxhbW91bnQ8PTApe3Nob3dUb2FzdCgnRW50ZXIgYW4gYW1vdW50JywyMDAwKTtyZXR1cm47fQogIGNvbnN0IGRhdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1kYXRlJykudmFsdWV8fG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogIGNvbnN0IG5vdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1ub3RlJykudmFsdWUudHJpbSgpOwogIGNvbnN0IG1vbnRoS2V5PWdldE1vbnRoS2V5KGRhdGUpfHxnZXRDdXJyZW50TW9udGhLZXkoKTsKICBlbnN1cmVNb250aChtb250aEtleSk7CiAgY29uc3QgdHlwZU1hcD17ZXhwZW5zZTonZXhwZW5zZXMnLGluY29tZTonaW5jb21lJyxpbnZlc3RtZW50OidpbnZlc3RtZW50cycsZGVidDonZGVidHMnLGdpdmVuOidnaXZlblRvT3RoZXJzJyxhZGRpdGlvbmFsOidhZGRpdGlvbmFsJ307CiAgY29uc3QgZW50cnk9e2RhdGU6bm9ybWFsaXplRGF0ZShkYXRlKSxjYXRlZ29yeTpzZWxlY3RlZFN1YkNhdHx8J090aGVyJyxhbW91bnQsZGVzY3JpcHRpb246bm90ZSxjdXJyZW5jeTpjdXJyZW50Q3VycmVuY3kuY29kZX07CiAgZGF0YVttb250aEtleV1bdHlwZU1hcFtjdXJyZW50QWRkVHlwZV1dLnB1c2goZW50cnkpOwogIHNhdmUoKTsgY3VycmVudEFtb3VudFN0cj0nJzsgdXBkYXRlQW1vdW50RGlzcGxheSgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtbm90ZScpLnZhbHVlPScnOwogIHNob3dUb2FzdChgU2F2ZWQhIOKchWApOwogIGlmKG1vbnRoS2V5PT09dmlld01vbnRoKSByZW5kZXJIb21lKCk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBBQ0NPVU5UIFNDUkVFTgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gZ2V0QWNjb3VudHNMaXN0KCkgewogIGlmKCFkYXRhLl9hY2NvdW50cykgZGF0YS5fYWNjb3VudHM9W3tpZDonMScsbmFtZTonQ2FzaCcsdHlwZTonQ2FzaCcsYmFsYW5jZToxMDAwfSx7aWQ6JzInLG5hbWU6J1BheXBhbCcsdHlwZTonRGViaXQnLGJhbGFuY2U6MTUwMH0se2lkOiczJyxuYW1lOidCYW5rJyx0eXBlOidEZWJpdCcsYmFsYW5jZTo1MDAwfV07CiAgcmV0dXJuIGRhdGEuX2FjY291bnRzOwp9CmZ1bmN0aW9uIHJlbmRlckFjY291bnQoKSB7CiAgY29uc3QgYWNjb3VudHM9Z2V0QWNjb3VudHNMaXN0KCk7CiAgbGV0IHRvdGFsQXNzZXRzPTAsIHRvdGFsRGVidD0wOwogIGFjY291bnRzLmZvckVhY2goYT0+eyBpZihhLnR5cGU9PT0nQ3JlZGl0JykgdG90YWxEZWJ0Kz1NYXRoLmFicyhOdW1iZXIoYS5iYWxhbmNlfHwwKSk7IGVsc2UgdG90YWxBc3NldHMrPU51bWJlcihhLmJhbGFuY2V8fDApOyB9KTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYW1vdW50JykudGV4dENvbnRlbnQ9Zm10KHRvdGFsQXNzZXRzLXRvdGFsRGVidCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWFzc2V0cycpLnRleHRDb250ZW50PWZtdCh0b3RhbEFzc2V0cyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWxpYWJpbGl0aWVzJykudGV4dENvbnRlbnQ9Jy0nK2ZtdCh0b3RhbERlYnQpOwogIGNvbnN0IGFjY0ljb25zPXtEZWJpdDon8J+PpicsQ2FzaDon8J+StScsSW52ZXN0bWVudDon8J+TiCcsQ3JlZGl0Oifwn5KzJ307CiAgY29uc3QgcmVuZGVyR3JpZD1saXN0PT5saXN0Lm1hcChhPT5gPGRpdiBjbGFzcz0iYWNjb3VudC1jYXJkICR7YS50eXBlPT09J0NyZWRpdCc/J2NyZWRpdCc6Jyd9IiBvbmNsaWNrPSJlZGl0QWNjb3VudCgnJHthLmlkfScpIj48ZGl2IGNsYXNzPSJhY2MtaWNvbiI+JHthY2NJY29uc1thLnR5cGVdfHwn8J+SsCd9PC9kaXY+PGRpdiBjbGFzcz0iYWNjLW5hbWUiPiR7YS5uYW1lfTwvZGl2PjxkaXYgY2xhc3M9ImFjYy1hbW91bnQiPiR7YS50eXBlPT09J0NyZWRpdCc/Jy0nOicnfSR7Zm10KGEuYmFsYW5jZXx8MCl9PC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtYXNzZXRzLWdyaWQnKS5pbm5lckhUTUw9cmVuZGVyR3JpZChhY2NvdW50cy5maWx0ZXIoYT0+YS50eXBlIT09J0NyZWRpdCcpKXx8JzxwIHN0eWxlPSJjb2xv','cjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO3BhZGRpbmc6OHB4OyI+Tm8gYXNzZXRzIHlldDwvcD4nOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWRlYnRzLWdyaWQnKS5pbm5lckhUTUw9cmVuZGVyR3JpZChhY2NvdW50cy5maWx0ZXIoYT0+YS50eXBlPT09J0NyZWRpdCcpKXx8JzxwIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO3BhZGRpbmc6OHB4OyI+Tm8gbGlhYmlsaXRpZXM8L3A+JzsKfQpmdW5jdGlvbiBzaG93QWRkQWNjb3VudE1vZGFsKCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjLW5hbWUtaW5wdXQnKS52YWx1ZT0nJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjYy1iYWxhbmNlLWlucHV0JykudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtYWNjb3VudC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsgfQpmdW5jdGlvbiBzYXZlQWNjb3VudCgpIHsKICBjb25zdCBuYW1lPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2MtbmFtZS1pbnB1dCcpLnZhbHVlLnRyaW0oKSwgdHlwZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjLXR5cGUtaW5wdXQnKS52YWx1ZSwgYmFsYW5jZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2MtYmFsYW5jZS1pbnB1dCcpLnZhbHVlKXx8MDsKICBpZighbmFtZSl7c2hvd1RvYXN0KCdFbnRlciBhY2NvdW50IG5hbWUnKTtyZXR1cm47fQogIGlmKCFkYXRhLl9hY2NvdW50cykgZGF0YS5fYWNjb3VudHM9W107CiAgZGF0YS5fYWNjb3VudHMucHVzaCh7aWQ6RGF0ZS5ub3coKS50b1N0cmluZygpLG5hbWUsdHlwZSxiYWxhbmNlfSk7CiAgc2F2ZSgpOyBjbG9zZU1vZGFsKCdhZGQtYWNjb3VudC1tb2RhbCcpOyByZW5kZXJBY2NvdW50KCk7IHNob3dUb2FzdCgnQWNjb3VudCBhZGRlZCEnKTsKfQpmdW5jdGlvbiBlZGl0QWNjb3VudChpZCkgeyBjb25zdCBhY2M9Z2V0QWNjb3VudHNMaXN0KCkuZmluZChhPT5hLmlkPT09aWQpOyBpZighYWNjKSByZXR1cm47IGNvbnN0IG5iPXByb21wdChgQmFsYW5jZSBmb3IgJHthY2MubmFtZX06YCxhY2MuYmFsYW5jZSk7IGlmKG5iPT09bnVsbCkgcmV0dXJuOyBhY2MuYmFsYW5jZT1wYXJzZUZsb2F0KG5iKXx8MDsgc2F2ZSgpOyByZW5kZXJBY2NvdW50KCk7IH0KZnVuY3Rpb24gY2xvc2VNb2RhbChpZCkgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOyB9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gREFUQSBTQ1JFRU4KLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0KCkgewogIGNvbnN0IHNlbD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKTsKICBjb25zdCBjdXI9c2VsLnZhbHVlOwogIGNvbnN0IGN1cnJlbnRLZXk9Z2V0Q3VycmVudE1vbnRoS2V5KCk7CiAgc2VsLmlubmVySFRNTD0nJzsKICBsZXQgb3B0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOyBvcHQudmFsdWU9Y3VycmVudEtleTsgb3B0LnRleHRDb250ZW50PSdDdXJyZW50OiAnK2dldERpc3BsYXlNb250aChjdXJyZW50S2V5KTsgc2VsLmFwcGVuZENoaWxkKG9wdCk7CiAgT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKGs9PiFrLnN0YXJ0c1dpdGgoJ18nKSYmayE9PWN1cnJlbnRLZXkpLnNvcnQoKGEsYik9PmIubG9jYWxlQ29tcGFyZShhKSkuZm9yRWFjaChrZXk9PnsKICAgIG9wdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsgb3B0LnZhbHVlPWtleTsgb3B0LnRleHRDb250ZW50PWdldERpc3BsYXlNb250aChrZXkpOyBzZWwuYXBwZW5kQ2hpbGQob3B0KTsKICB9KTsKICBpZihjdXImJlsuLi5zZWwub3B0aW9uc10uc29tZShvPT5vLnZhbHVlPT09Y3VyKSkgc2VsLnZhbHVlPWN1cjsgZWxzZSBzZWwudmFsdWU9Y3VycmVudEtleTsKfQoKZnVuY3Rpb24gZ2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSkgewogIGNvbnN0IHNlbGVjdGVkTW9udGg9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7CiAgY29uc3Qgc3RhcnREYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhLWZpbHRlci1zdGFydCcpLnZhbHVlOwogIGNvbnN0IGVuZERhdGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtZmlsdGVyLWVuZCcpLnZhbHVlOwogIGNvbnN0IGlzR2xvYmFsPSEhKHN0YXJ0RGF0ZXx8ZW5kRGF0ZSk7CiAgbGV0IGxpc3Q9W107CiAgaWYoaXNHbG9iYWwpewogICAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChtS2V5PT57IGlmKGRhdGFbbUtleV1bdHlwZV0pIGRhdGFbbUtleV1bdHlwZV0uZm9yRWFjaCgoZSxpKT0+bGlzdC5wdXNoKHsuLi5lLF9tb250aDptS2V5LF9pZHg6aX0pKTsgfSk7CiAgfSBlbHNlIHsKICAgIGVuc3VyZU1vbnRoKHNlbGVjdGVkTW9udGgpOwogICAgKGRhdGFbc2VsZWN0ZWRNb250aF1bdHlwZV18fFtdKS5mb3JFYWNoKChlLGkpPT5saXN0LnB1c2goey4uLmUsX21vbnRoOnNlbGVjdGVkTW9udGgsX2lkeDppfSkpOwogIH0KICByZXR1cm4gbGlzdC5maWx0ZXIoZT0+eyBpZighaXNHbG9iYWwpIHJldHVybiB0cnVlOyBpZighZS5kYXRlKSByZXR1cm4gdHJ1ZTsgaWYoc3RhcnREYXRlJiZlLmRhdGU8c3RhcnREYXRlKSByZXR1cm4gZmFsc2U7IGlmKGVuZERhdGUmJmUuZGF0ZT5lbmREYXRlKSByZXR1cm4gZmFsc2U7IHJldHVybiB0cnVlOyB9KTsKfQoKZnVuY3Rpb24gZGF0YVNvcnRFbnRyaWVzKGVudHJpZXMsIHR5cGUpIHsKICBsZXQgY29sPW51bGwsIGRpcj0nYXNjJzsKICBPYmplY3Qua2V5cyhkYXRhU29ydFN0YXRlKS5mb3JFYWNoKGs9PnsgaWYoay5zdGFydHNXaXRoKHR5cGUrJy0nKSl7Y29sPWsuc3BsaXQoJy0nKS5zbGljZSgxKS5qb2luKCctJyk7ZGlyPWRhdGFTb3J0U3RhdGVba107fSB9KTsKICBpZighY29sKSByZXR1cm4gZW50cmllczsKICByZXR1cm4gWy4uLmVudHJpZXNdLnNvcnQoKGEsYik9PnsKICAgIGxldCB2YSx2YjsKICAgIGlmKGNvbD09PSdkYXRlJyl7dmE9bmV3IERhdGUoYS5kYXRlfHwnMTkwMC0wMS0wMScpO3ZiPW5ldyBEYXRlKGIuZGF0ZXx8JzE5MDAtMDEtMDEnKTt9CiAgICBlbHNlIGlmKFsnYW1vdW50Jywnd2VpZ2h0R21zJywncHVyY2hhc2VWYWx1ZScsJ2N1cnJlbnRWYWx1ZSddLmluY2x1ZGVzKGNvbCkpe3ZhPXBhcnNlRmxvYXQoYVtjb2xdfHwwKTt2Yj1wYXJzZUZsb2F0KGJbY29sXXx8MCk7fQogICAgZWxzZXt2YT1TdHJpbmcoYVtjb2xdfHwnJykudG9Mb3dlckNhc2UoKTt2Yj1TdHJpbmcoYltjb2xdfHwnJykudG9Mb3dlckNhc2UoKTt9CiAgICByZXR1cm4gZGlyPT09J2FzYyc/KHZhPnZiPzE6LTEpOih2YTx2Yj8xOi0xKTsKICB9KTsKfQpmdW5jdGlvbiB0b2dnbGVEYXRhU29ydCh0eXBlLCBjb2wpIHsgY29uc3Qgaz1gJHt0eXBlfS0ke2NvbH1gOyBkYXRhU29ydFN0YXRlW2tdPSghZGF0YVNvcnRTdGF0ZVtrXXx8ZGF0YVNvcnRTdGF0ZVtrXT09PSdkZXNjJyk/J2FzYyc6J2Rlc2MnOyByZW5kZXJEYXRhU2NyZWVuKCk7IH0KZnVuY3Rpb24gc29ydEFycm93KHR5cGUsY29sKXtjb25zdCBrPWAke3R5cGV9LSR7Y29sfWA7cmV0dXJuIGRhdGFTb3J0U3RhdGVba109PT0nYXNjJz8nIOKGkSc6ZGF0YVNvcnRTdGF0ZVtrXT09PSdkZXNjJz8nIOKGkyc6JyDihpUnO30KCmZ1bmN0aW9uIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24odHlwZSwgbGFiZWwsIGljb24sIGNvbG9yKSB7CiAgY29uc3Qgc2VsZWN0ZWRNb250aD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKS52YWx1ZTsKICBsZXQgZW50cmllcz1kYXRhU29ydEVudHJpZXMoZ2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSksdHlwZSk7CiAgY29uc3QgdG90YWw9ZW50cmllcy5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKTsKICByZXR1cm4gYDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbiI+CiAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24taGVhZGVyIiBvbmNsaWNrPSJ0aGlzLm5leHRFbGVtZW50U2libGluZy5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJykiPgogICAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24tdGl0bGUiPiR7aWNvbn0gJHtsYWJlbH0gPHNwYW4gc3R5bGU9ImJhY2tncm91bmQ6I0YwRjBGMDtib3JkZXItcmFkaXVzOjIwcHg7cGFkZGluZzoycHggOHB4O2ZvbnQtc2l6ZTowLjgyZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+JHtlbnRyaWVzLmxlbmd0aH08L3NwYW4+PC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7Ij4KICAgICAgICA8c3BhbiBjbGFzcz0iZGF0YS1zZWN0aW9uLXRvdGFsIiBzdHlsZT0iY29sb3I6JHtjb2xvcn07Ij4kJHt0b3RhbC50b0ZpeGVkKDIpfTwvc3Bhbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJpY29uLWJ0biBkYW5nZXIiIG9uY2xpY2s9ImNsZWFyRGF0YVNlY3Rpb24oJyR7c2VsZWN0ZWRNb250aH0nLCcke3R5cGV9Jyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5eR77iPPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4iIG9uY2xpY2s9ImV4cG9ydERhdGFDYXRlZ29yeSgnJHt0eXBlfScpO2V2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyI+8J+TpTwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLWJvZHkiPgogICAgICAke2VudHJpZXMubGVuZ3RoID8gYDxkaXYgY2xhc3M9ImRhdGEtdGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJkYXRhLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+PHRyPgogICAgICAgICAgPHRoIG9uY2xpY2s9InRvZ2dsZURhdGFTb3J0KCcke3R5cGV9JywnZGF0ZScpIj5EYXRlJHtzb3J0QXJyb3codHlwZSwnZGF0ZScpfTwvdGg+CiAgICAgICAgICA8dGggb25jbGljaz0idG9nZ2xlRGF0YVNvcnQoJyR7dHlwZX0nLCdjYXRlZ29yeScpIj5DYXRlZ29yeSR7c29ydEFycm93KHR5cGUsJ2NhdGVnb3J5Jyl9PC90aD4KICAgICAgICAgIDx0aCBvbmNsaWNrPSJ0b2dnbGVEYXRhU29ydCgnJHt0eXBlfScsJ2Ftb3VudCcpIj5BbW91bnQke3NvcnRBcnJvdyh0eXBlLCdhbW91bnQnKX08L3RoPgogICAgICAgICAgPHRoIG9uY2xpY2s9InRvZ2dsZURhdGFTb3J0KCcke3R5cGV9JywnZGVzY3JpcHRpb24nKSI+RGVzY3JpcHRpb24ke3NvcnRBcnJvdyh0eXBlLCdkZXNjcmlwdGlvbicpfTwvdGg+CiAgICAgICAgICA8dGg+QWN0aW9uPC90aD4KICAgICAgICA8L3RyPjwvdGhlYWQ+CiAgICAgICAgPHRib2R5PiR7ZW50cmllcy5tYXAocm93PT5gPHRyPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhU3RhbmRhcmQoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSwnZGF0ZScsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmRhdGV9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVN0YW5kYXJkKCcke3Jvdy5fbW9udGh9JywnJHt0eXBlfScsJHtyb3cuX2lkeH0sJ2NhdGVnb3J5Jyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cuY2F0ZWdvcnl9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRp','dGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVN0YW5kYXJkKCcke3Jvdy5fbW9udGh9JywnJHt0eXBlfScsJHtyb3cuX2lkeH0sJ2Ftb3VudCcsdGhpcy50ZXh0Q29udGVudCkiIHN0eWxlPSJjb2xvcjoke051bWJlcihyb3cuYW1vdW50KTwwPyd2YXIoLS1leHBlbnNlcyknOidpbmhlcml0J307Ij4kJHtOdW1iZXIocm93LmFtb3VudCkudG9GaXhlZCgyKX08L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhU3RhbmRhcmQoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSwnZGVzY3JpcHRpb24nLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5kZXNjcmlwdGlvbnx8Jyd9PC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCcke3R5cGV9Jywke3Jvdy5faWR4fSkiPsOXPC9idXR0b24+PC90ZD4KICAgICAgICA8L3RyPmApLmpvaW4oJycpfTwvdGJvZHk+CiAgICAgIDwvdGFibGU+PC9kaXY+YCA6ICc8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gZW50cmllczwvZGl2Pid9CiAgICAgIDxkaXYgY2xhc3M9InF1aWNrLWFkZC1yb3ciPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1kYXRlLSR7dHlwZX0iIHN0eWxlPSJtaW4td2lkdGg6MTEwcHg7ZmxleDowOyI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGxpc3Q9ImNhdGxpc3QiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWNhdC0ke3R5cGV9IiBwbGFjZWhvbGRlcj0iQ2F0ZWdvcnkiPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWFtdC0ke3R5cGV9IiBwbGFjZWhvbGRlcj0iQW1vdW50IiBzdGVwPSIwLjAxIiBzdHlsZT0ibWF4LXdpZHRoOjExMHB4OyI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLWRlc2MtJHt0eXBlfSIgcGxhY2Vob2xkZXI9IkRlc2NyaXB0aW9uIj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJxYS1idG4iIG9uY2xpY2s9ImFkZERhdGFSb3coJyR7c2VsZWN0ZWRNb250aH0nLCcke3R5cGV9JykiPisgQWRkPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtcGFuZWwiPgogICAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1wYW5lbC10aXRsZSI+8J+TpSBJbXBvcnQg4oCUIFBhc3RlOiBkYXRlIGNhdGVnb3J5IGFtb3VudCBkZXNjcmlwdGlvbjwvZGl2PgogICAgICAgIDx0ZXh0YXJlYSBjbGFzcz0icGFzdGUtYXJlYSIgaWQ9InBhc3RlLSR7dHlwZX0iPjwvdGV4dGFyZWE+CiAgICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LWNvbnRyb2xzIj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJwYXJzZVBhc3RlKCcke3NlbGVjdGVkTW9udGh9JywnJHt0eXBlfScpIj5JbXBvcnQgVGV4dDwvYnV0dG9uPgogICAgICAgICAgPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJmaWxlLSR7dHlwZX0iIGFjY2VwdD0iLmNzdiwueGxzeCIgc3R5bGU9ImZvbnQtc2l6ZTowLjgyZW07Ij4KICAgICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJpbXBvcnRGaWxlKCcke3NlbGVjdGVkTW9udGh9JywnJHt0eXBlfScpIj5JbXBvcnQgRmlsZTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHJlbmRlckRhdGFNZXRhbHNTZWN0aW9uKCkgewogIGNvbnN0IHNlbGVjdGVkTW9udGg9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7CiAgbGV0IGVudHJpZXM9Z2V0RGF0YUVmZmVjdGl2ZUVudHJpZXMoJ21ldGFscycpOwogIGNvbnN0IHdlaWdodHM9e307CiAgZW50cmllcy5mb3JFYWNoKGU9PnsgY29uc3QgdD0oZS5tZXRhbFR5cGV8fCdHb2xkJykudHJpbSgpOyB3ZWlnaHRzW3RdPSh3ZWlnaHRzW3RdfHwwKSsoTnVtYmVyKGUud2VpZ2h0R21zKXx8MCk7IH0pOwogIGNvbnN0IHN1bW1hcnk9T2JqZWN0LmtleXMod2VpZ2h0cykubGVuZ3RoP09iamVjdC5lbnRyaWVzKHdlaWdodHMpLm1hcCgoW2ssdl0pPT5gPGI+JHtrfTwvYj46ICR7di50b0ZpeGVkKDIpfWdgKS5qb2luKCcgfCAnKTonTm8gRGF0YSc7CiAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24iPgogICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLWhlYWRlciIgb25jbGljaz0idGhpcy5uZXh0RWxlbWVudFNpYmxpbmcuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpIj4KICAgICAgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uLXRpdGxlIj7wn6WHIE1ldGFscyA8c21hbGwgc3R5bGU9Im9wYWNpdHk6MC43O2ZvbnQtc2l6ZTowLjg1ZW07Ij4oJHtlbnRyaWVzLmxlbmd0aH0pPC9zbWFsbD48L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDsiPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC44ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPiR7c3VtbWFyeX08L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4gZGFuZ2VyIiBvbmNsaWNrPSJjbGVhckRhdGFTZWN0aW9uKCcke3NlbGVjdGVkTW9udGh9JywnbWV0YWxzJyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5eR77iPPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4iIG9uY2xpY2s9ImV4cG9ydERhdGFDYXRlZ29yeSgnbWV0YWxzJyk7ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7Ij7wn5OlPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJkYXRhLXNlY3Rpb24tYm9keSI+CiAgICAgICR7ZW50cmllcy5sZW5ndGg/YDxkaXYgY2xhc3M9ImRhdGEtdGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJkYXRhLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+PHRyPjx0aD5NZXRhbDwvdGg+PHRoPlB1cml0eTwvdGg+PHRoPk9jY2FzaW9uPC90aD48dGg+SXRlbTwvdGg+PHRoPldlaWdodDwvdGg+PHRoPkFjdGlvbjwvdGg+PC90cj48L3RoZWFkPgogICAgICAgIDx0Ym9keT4ke2VudHJpZXMubWFwKHJvdz0+YDx0cj4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YU1ldGFsKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnbWV0YWxUeXBlJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cubWV0YWxUeXBlfHwnJ308L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhTWV0YWwoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdwdXJpdHknLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5wdXJpdHl8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ29jY2FzaW9uJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cub2NjYXNpb258fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2l0ZW1OYW1lJyx0aGlzLnRleHRDb250ZW50KSI+JHtyb3cuaXRlbU5hbWV8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFNZXRhbCgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ3dlaWdodEdtcycsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LndlaWdodEdtc3x8MH1nPC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCdtZXRhbHMnLCR7cm93Ll9pZHh9KSI+w5c8L2J1dHRvbj48L3RkPgogICAgICAgIDwvdHI+YCkuam9pbignJyl9PC90Ym9keT4KICAgICAgPC90YWJsZT48L2Rpdj5gOic8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gbWV0YWxzPC9kaXY+J30KICAgICAgPGRpdiBjbGFzcz0icXVpY2stYWRkLXJvdyI+CiAgICAgICAgPHNlbGVjdCBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC10eXBlIiBzdHlsZT0ibWF4LXdpZHRoOjEwMHB4OyI+PG9wdGlvbj5Hb2xkPC9vcHRpb24+PG9wdGlvbj5TaWx2ZXI8L29wdGlvbj48b3B0aW9uPlBsYXRpbnVtPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLW1ldGFsLXB1cml0eSIgcGxhY2Vob2xkZXI9IlB1cml0eSI+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLW1ldGFsLW9jY2FzaW9uIiBwbGFjZWhvbGRlcj0iT2NjYXNpb24iPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC1pdGVtIiBwbGFjZWhvbGRlcj0iSXRlbSBOYW1lIj4KICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1tZXRhbC13ZWlnaHQiIHBsYWNlaG9sZGVyPSJXZWlnaHQgKGcpIiBzdHlsZT0ibWF4LXdpZHRoOjEwMHB4OyI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtYnRuIiBvbmNsaWNrPSJhZGREYXRhTWV0YWxSb3coJyR7c2VsZWN0ZWRNb250aH0nKSI+KyBBZGQ8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj5gOwp9CgpmdW5jdGlvbiByZW5kZXJEYXRhUmVhbEVzdGF0ZVNlY3Rpb24oKSB7CiAgY29uc3Qgc2VsZWN0ZWRNb250aD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGF0YS1tb250aC1zZWxlY3QnKS52YWx1ZTsKICBsZXQgZW50cmllcz1nZXREYXRhRWZmZWN0aXZlRW50cmllcygncmVhbEVzdGF0ZScpOwogIGNvbnN0IHRvdGFscz17fTsKICBlbnRyaWVzLmZvckVhY2gocj0+eyBjb25zdCBjPShyLmN1cnJlbmN5fHwnVVNEJykudG9VcHBlckNhc2UoKTsgaWYoIXRvdGFsc1tjXSkgdG90YWxzW2NdPXtwOjAsY3Y6MH07IHRvdGFsc1tjXS5wKz1OdW1iZXIoci5wdXJjaGFzZVZhbHVlfHwwKTsgdG90YWxzW2NdLmN2Kz1OdW1iZXIoci5jdXJyZW50VmFsdWV8fDApOyB9KTsKICBjb25zdCBzdW1tYXJ5PU9iamVjdC5lbnRyaWVzKHRvdGFscykubGVuZ3RoP09iamVjdC5lbnRyaWVzKHRvdGFscykubWFwKChbYyx2XSk9PmA8Yj4ke2N9PC9iPjogSW52ICR7Z2V0Q29tcGFjdE51bSh2LnApfSAvIEN1ciAke2dldENvbXBhY3ROdW0odi5jdil9YCkuam9pbignIHwgJyk6J05vIERhdGEnOwogIHJldHVybiBgPGRpdiBjbGFzcz0iZGF0YS1zZWN0aW9uIj4KICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi1oZWFkZXIiIG9uY2xpY2s9InRoaXMubmV4dEVsZW1lbnRTaWJsaW5nLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKSI+CiAgICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi10aXRsZSI+8J+PoSBSZWFsIEVzdGF0ZSA8c21hbGwgc3R5bGU9Im9wYWNpdHk6MC43O2ZvbnQtc2l6ZTowLjg1ZW07Ij4oJHtlbnRyaWVzLmxlbmd0aH0pPC9zbWFsbD48L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDsiPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC44ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPiR7c3VtbWFyeX08L3NwYW4+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaWNvbi1idG4gZGFuZ2VyIiBvbmNsaWNrPSJjbGVhckRhdGFTZWN0aW9uKCcke3NlbGVjdGVkTW9udGh9Jywn','cmVhbEVzdGF0ZScpO2V2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyI+8J+Xke+4jzwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9Imljb24tYnRuIiBvbmNsaWNrPSJleHBvcnREYXRhQ2F0ZWdvcnkoJ3JlYWxFc3RhdGUnKTtldmVudC5zdG9wUHJvcGFnYXRpb24oKTsiPvCfk6U8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImRhdGEtc2VjdGlvbi1ib2R5Ij4KICAgICAgJHtlbnRyaWVzLmxlbmd0aD9gPGRpdiBjbGFzcz0iZGF0YS10YWJsZS13cmFwIj48dGFibGUgY2xhc3M9ImRhdGEtdGFibGUiPgogICAgICAgIDx0aGVhZD48dHI+PHRoPkRhdGU8L3RoPjx0aD5Db3VudHJ5PC90aD48dGg+Q3VycmVuY3k8L3RoPjx0aD5QdXJjaGFzZTwvdGg+PHRoPkRlc2NyaXB0aW9uPC90aD48dGg+QXJlYTwvdGg+PHRoPkN1cnJlbnQgVmFsdWU8L3RoPjx0aD5BY3Rpb248L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICA8dGJvZHk+JHtlbnRyaWVzLm1hcChyb3c9Pntjb25zdCBzeW09Z2V0Q3VycmVuY3lTeW1ib2wocm93LmN1cnJlbmN5KTtyZXR1cm5gPHRyPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2RhdGUnLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5kYXRlfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFSZWFsRXN0YXRlKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnY291bnRyeScsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmNvdW50cnl8fCcnfTwvdGQ+CiAgICAgICAgICA8dGQgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBvbmJsdXI9InVwZGF0ZURhdGFSZWFsRXN0YXRlKCcke3Jvdy5fbW9udGh9Jywke3Jvdy5faWR4fSwnY3VycmVuY3knLHRoaXMudGV4dENvbnRlbnQpIj4ke3Jvdy5jdXJyZW5jeXx8J1VTRCd9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVJlYWxFc3RhdGUoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdwdXJjaGFzZVZhbHVlJyx0aGlzLnRleHRDb250ZW50KSI+JHtzeW19JHtOdW1iZXIocm93LnB1cmNoYXNlVmFsdWV8fDApLnRvTG9jYWxlU3RyaW5nKCl9PC90ZD4KICAgICAgICAgIDx0ZCBjb250ZW50ZWRpdGFibGU9InRydWUiIG9uYmx1cj0idXBkYXRlRGF0YVJlYWxFc3RhdGUoJyR7cm93Ll9tb250aH0nLCR7cm93Ll9pZHh9LCdkZXNjcmlwdGlvbicsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmRlc2NyaXB0aW9ufHwnJ308L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2FyZWFDZW50cycsdGhpcy50ZXh0Q29udGVudCkiPiR7cm93LmFyZWFDZW50c3x8MH08L3RkPgogICAgICAgICAgPHRkIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgb25ibHVyPSJ1cGRhdGVEYXRhUmVhbEVzdGF0ZSgnJHtyb3cuX21vbnRofScsJHtyb3cuX2lkeH0sJ2N1cnJlbnRWYWx1ZScsdGhpcy50ZXh0Q29udGVudCkiPiR7c3ltfSR7TnVtYmVyKHJvdy5jdXJyZW50VmFsdWV8fDApLnRvTG9jYWxlU3RyaW5nKCl9PC90ZD4KICAgICAgICAgIDx0ZD48YnV0dG9uIGNsYXNzPSJkZWwtYnRuLXNtIiBvbmNsaWNrPSJyZW1vdmVEYXRhRW50cnkoJyR7cm93Ll9tb250aH0nLCdyZWFsRXN0YXRlJywke3Jvdy5faWR4fSkiPsOXPC9idXR0b24+PC90ZD4KICAgICAgICA8L3RyPmA7fSkuam9pbignJyl9PC90Ym9keT4KICAgICAgPC90YWJsZT48L2Rpdj5gOic8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nOjI0cHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NzAwOyI+Tm8gZW50cmllczwvZGl2Pid9CiAgICAgIDxkaXYgY2xhc3M9InF1aWNrLWFkZC1yb3ciPgogICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1kYXRlIiBzdHlsZT0ibWluLXdpZHRoOjExMHB4O2ZsZXg6MDsiPgogICAgICAgIDxzZWxlY3QgY2xhc3M9InFhLWlucHV0IiBpZD0icWEtcmUtY291bnRyeSIgc3R5bGU9Im1heC13aWR0aDo5MHB4OyI+PG9wdGlvbiB2YWx1ZT0iVVMiPlVTPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iSW5kaWEiPkluZGlhPC9vcHRpb24+PC9zZWxlY3Q+CiAgICAgICAgPHNlbGVjdCBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1jdXJyZW5jeSIgc3R5bGU9Im1heC13aWR0aDo4MHB4OyI+PG9wdGlvbj5VU0Q8L29wdGlvbj48b3B0aW9uPklOUjwvb3B0aW9uPjwvc2VsZWN0PgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLXJlLXB1cmNoYXNlIiBwbGFjZWhvbGRlcj0iUHVyY2hhc2UgVmFsdWUiPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1kZXNjIiBwbGFjZWhvbGRlcj0iRGVzY3JpcHRpb24iPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGNsYXNzPSJxYS1pbnB1dCIgaWQ9InFhLXJlLWFyZWEiIHBsYWNlaG9sZGVyPSJBcmVhIj4KICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBjbGFzcz0icWEtaW5wdXQiIGlkPSJxYS1yZS1jdXJyZW50IiBwbGFjZWhvbGRlcj0iQ3VycmVudCBWYWx1ZSI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0icWEtYnRuIiBvbmNsaWNrPSJhZGREYXRhUmVhbEVzdGF0ZVJvdygnJHtzZWxlY3RlZE1vbnRofScpIj4rIEFkZDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHJlbmRlckRhdGFTY3JlZW4oKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtc2VjdGlvbnMnKS5pbm5lckhUTUw9WwogICAgcmVuZGVyRGF0YVN0YW5kYXJkU2VjdGlvbignaW5jb21lJywnSW5jb21lJywn8J+StScsJyMxMEI5ODEnKSwKICAgIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24oJ2V4cGVuc2VzJywnRXhwZW5zZXMnLCfwn5K4JywnI0VGNDQ0NCcpLAogICAgcmVuZGVyRGF0YVN0YW5kYXJkU2VjdGlvbignaW52ZXN0bWVudHMnLCdJbnZlc3RtZW50cycsJ/Cfko4nLCcjN0MzQUVEJyksCiAgICByZW5kZXJEYXRhUmVhbEVzdGF0ZVNlY3Rpb24oKSwKICAgIHJlbmRlckRhdGFNZXRhbHNTZWN0aW9uKCksCiAgICByZW5kZXJEYXRhU3RhbmRhcmRTZWN0aW9uKCdhZGRpdGlvbmFsJywnQWRkaXRpb25hbCcsJ/CfjoEnLCcjRjU5RTBCJyksCiAgICByZW5kZXJEYXRhU3RhbmRhcmRTZWN0aW9uKCdkZWJ0cycsJ0RlYnRzJywn8J+TiScsJyNFRjQ0NDQnKSwKICAgIHJlbmRlckRhdGFTdGFuZGFyZFNlY3Rpb24oJ2dpdmVuVG9PdGhlcnMnLCdHaXZlbiBUbyBPdGhlcnMnLCfwn6SdJywnI0VDNDg5OScpLAogIF0uam9pbignJyk7Cn0KCmZ1bmN0aW9uIGNsZWFyRGF0YUZpbHRlcigpIHsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtZmlsdGVyLXN0YXJ0JykudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhLWZpbHRlci1lbmQnKS52YWx1ZT0nJzsgcmVuZGVyRGF0YVNjcmVlbigpOyB9CmZ1bmN0aW9uIGRlbGV0ZUN1cnJlbnREYXRhTW9udGgoKSB7IGNvbnN0IGs9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGEtbW9udGgtc2VsZWN0JykudmFsdWU7IGlmKCFjb25maXJtKGBEZWxldGUgYWxsIGRhdGEgZm9yICR7a30/YCkpIHJldHVybjsgZGVsZXRlIGRhdGFba107IHNhdmUoKTsgcG9wdWxhdGVEYXRhTW9udGhTZWxlY3QoKTsgcmVuZGVyRGF0YVNjcmVlbigpOyB9CmZ1bmN0aW9uIGNsZWFyRGF0YVNlY3Rpb24obW9udGhLZXksdHlwZSkgeyBpZighY29uZmlybShgQ2xlYXIgYWxsICR7dHlwZX0gZm9yIHRoaXMgdmlldz9gKSkgcmV0dXJuOyBlbnN1cmVNb250aChtb250aEtleSk7IGRhdGFbbW9udGhLZXldW3R5cGVdPVtdOyBzYXZlKCk7IHJlbmRlckRhdGFTY3JlZW4oKTsgfQpmdW5jdGlvbiByZW1vdmVEYXRhRW50cnkobW9udGhLZXksdHlwZSxpZHgpIHsgaWYoIWNvbmZpcm0oJ0RlbGV0ZT8nKSkgcmV0dXJuOyBkYXRhW21vbnRoS2V5XVt0eXBlXS5zcGxpY2UoaWR4LDEpOyBzYXZlKCk7IHJlbmRlckRhdGFTY3JlZW4oKTsgc2hvd1RvYXN0KCdFbnRyeSBkZWxldGVkJyk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YVN0YW5kYXJkKG1vbnRoS2V5LHR5cGUsaWR4LGZpZWxkLHZhbCkgeyBpZihmaWVsZD09PSdkYXRlJykgdmFsPW5vcm1hbGl6ZURhdGUodmFsKTsgaWYoZmllbGQ9PT0nYW1vdW50JykgdmFsPXBhcnNlRmxvYXQodmFsLnJlcGxhY2UoL1teMC05Li1dL2csJycpKXx8MDsgZGF0YVttb250aEtleV1bdHlwZV1baWR4XVtmaWVsZF09dmFsOyBzYXZlKCk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YU1ldGFsKG1vbnRoS2V5LGlkeCxmaWVsZCx2YWwpIHsgaWYoZmllbGQ9PT0nd2VpZ2h0R21zJykgdmFsPXBhcnNlRmxvYXQodmFsLnJlcGxhY2UoL1teMC05Ll0vZywnJykpfHwwOyBkYXRhW21vbnRoS2V5XS5tZXRhbHNbaWR4XVtmaWVsZF09dmFsOyBzYXZlKCk7IH0KZnVuY3Rpb24gdXBkYXRlRGF0YVJlYWxFc3RhdGUobW9udGhLZXksaWR4LGZpZWxkLHZhbCkgeyBpZihmaWVsZD09PSdkYXRlJykgdmFsPW5vcm1hbGl6ZURhdGUodmFsKTsgaWYoWydwdXJjaGFzZVZhbHVlJywnY3VycmVudFZhbHVlJywnYXJlYUNlbnRzJ10uaW5jbHVkZXMoZmllbGQpKSB2YWw9cGFyc2VGbG9hdCh2YWwucmVwbGFjZSgvW14wLTkuLV0vZywnJykpfHwwOyBkYXRhW21vbnRoS2V5XS5yZWFsRXN0YXRlW2lkeF1bZmllbGRdPXZhbDsgc2F2ZSgpOyB9CgpmdW5jdGlvbiBhZGREYXRhUm93KG1vbnRoS2V5LHR5cGUpIHsKICBjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWRhdGUtJHt0eXBlfWApLnZhbHVlKSwgY2F0ZWdvcnk9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWNhdC0ke3R5cGV9YCkudmFsdWUudHJpbSgpLCBhbW91bnQ9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcWEtYW10LSR7dHlwZX1gKS52YWx1ZSl8fDAsIGRlc2NyaXB0aW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kZXNjLSR7dHlwZX1gKS52YWx1ZS50cmltKCk7CiAgaWYoIWRhdGV8fCFjYXRlZ29yeSl7c2hvd1RvYXN0KCdEYXRlIGFuZCBDYXRlZ29yeSByZXF1aXJlZCcpO3JldHVybjt9CiAgY29uc3QgdGFyZ2V0TW9udGg9Z2V0TW9udGhLZXkoZGF0ZSl8fG1vbnRoS2V5OyBlbnN1cmVNb250aCh0YXJnZXRNb250aCk7CiAgZGF0YVt0YXJnZXRNb250aF1bdHlwZV0ucHVzaCh7ZGF0ZSxjYXRlZ29yeSxhbW91bnQsZGVzY3JpcHRpb259KTsgc2F2ZSgpOyByZW5kZXJEYXRhU2NyZWVuKCk7IHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0KCk7CiAgaWYodGFyZ2V0TW9udGghPT1tb250aEtleSkgc2hvd1RvYXN0KGDinIUgQWRkZWQgdG8gJHtnZXREaXNwbGF5TW9udGgodGFyZ2V0TW9udGgpfWApOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kYXRlLSR7dHlwZX1gKS52YWx1ZT0nJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHFhLWFtdC0ke3R5cGV9YCkudmFsdWU9Jyc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxYS1kZXNjLSR7dHlwZX1gKS52YWx1ZT0nJzsKfQoKZnVuY3Rpb24gYWRkRGF0YU1ldGFsUm93KG1vbnRoS2V5KSB7CiAgY29uc3QgbWV0YWxUeXBlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC10eXBlJykudmFsdWUsIHB1cml0eT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtcHVyaXR5JykudmFsdWUsIG9jY2FzaW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1tZXRhbC1vY2Nhc2lvbicpLnZhbHVlLCBpdGVtTmFtZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtaXRlbScpLnZhbHVlLCB3ZWlnaHRHbXM9cGFyc2VGbG9h','dChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtbWV0YWwtd2VpZ2h0JykudmFsdWUpfHwwOwogIGlmKCFpdGVtTmFtZXx8IXdlaWdodEdtcyl7c2hvd1RvYXN0KCdJdGVtIGFuZCBXZWlnaHQgcmVxdWlyZWQnKTtyZXR1cm47fQogIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsgZGF0YVttb250aEtleV0ubWV0YWxzLnB1c2goe21ldGFsVHlwZSxwdXJpdHksb2NjYXNpb24saXRlbU5hbWUsd2VpZ2h0R21zfSk7IHNhdmUoKTsgcmVuZGVyRGF0YVNjcmVlbigpOwp9CgpmdW5jdGlvbiBhZGREYXRhUmVhbEVzdGF0ZVJvdyhtb250aEtleSkgewogIGNvbnN0IGRhdGU9bm9ybWFsaXplRGF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtZGF0ZScpLnZhbHVlKSwgY291bnRyeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtY291bnRyeScpLnZhbHVlLCBjdXJyZW5jeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncWEtcmUtY3VycmVuY3knKS52YWx1ZSwgcHVyY2hhc2VWYWx1ZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1yZS1wdXJjaGFzZScpLnZhbHVlKXx8MCwgZGVzY3JpcHRpb249ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLXJlLWRlc2MnKS52YWx1ZSwgYXJlYUNlbnRzPXBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FhLXJlLWFyZWEnKS52YWx1ZSl8fDAsIGN1cnJlbnRWYWx1ZT1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxYS1yZS1jdXJyZW50JykudmFsdWUpfHwwOwogIGlmKCFkYXRlfHwhcHVyY2hhc2VWYWx1ZSl7c2hvd1RvYXN0KCdEYXRlIGFuZCBQdXJjaGFzZSBWYWx1ZSByZXF1aXJlZCcpO3JldHVybjt9CiAgY29uc3QgdGFyZ2V0TW9udGg9Z2V0TW9udGhLZXkoZGF0ZSl8fG1vbnRoS2V5OyBlbnN1cmVNb250aCh0YXJnZXRNb250aCk7CiAgZGF0YVt0YXJnZXRNb250aF0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnksY3VycmVuY3kscHVyY2hhc2VWYWx1ZSxkZXNjcmlwdGlvbixhcmVhQ2VudHMsY3VycmVudFZhbHVlfSk7IHNhdmUoKTsgcmVuZGVyRGF0YVNjcmVlbigpOyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gU1RBVFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIHJlbmRlclN0YXRzKCkgewogIGNvbnN0IG1vbnRocz1bXTsgZm9yKGxldCBpPTU7aT49MDtpLS0pe2NvbnN0IGR0PW5ldyBEYXRlKCk7ZHQuc2V0TW9udGgoZHQuZ2V0TW9udGgoKS1pKTttb250aHMucHVzaChgJHtkdC5nZXRGdWxsWWVhcigpfS0keyhkdC5nZXRNb250aCgpKzEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwnMCcpfWApO30KICBjb25zdCBzcGVuZEJ5TW9udGg9bW9udGhzLm1hcChrPT4hZGF0YVtrXT8wOihkYXRhW2tdLmV4cGVuc2VzfHxbXSkucmVkdWNlKChzLHIpPT5zK051bWJlcihyLmFtb3VudHx8MCksMCkrKGRhdGFba10uaW52ZXN0bWVudHN8fFtdKS5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKSsoZGF0YVtrXS5kZWJ0c3x8W10pLnJlZHVjZSgocyxyKT0+cytOdW1iZXIoci5hbW91bnR8fDApLDApKTsKICBjb25zdCBpbmNCeU1vbnRoPW1vbnRocy5tYXAoaz0+IWRhdGFba10/MDooZGF0YVtrXS5pbmNvbWV8fFtdKS5yZWR1Y2UoKHMscik9PnMrTnVtYmVyKHIuYW1vdW50fHwwKSwwKSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXQtc3BlbmRpbmctdG90YWwnKS50ZXh0Q29udGVudD1mbXQoc3BlbmRCeU1vbnRoLnJlZHVjZSgocyx2KT0+cyt2LDApKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdC1pbmNvbWUtdG90YWwnKS50ZXh0Q29udGVudD1mbXQoaW5jQnlNb250aC5yZWR1Y2UoKHMsdik9PnMrdiwwKSk7CiAgaWYoY2hhcnRzLnRyZW5kKSBjaGFydHMudHJlbmQuZGVzdHJveSgpOwogIGNvbnN0IHRjPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmVuZENoYXJ0JykuZ2V0Q29udGV4dCgnMmQnKTsKICBjaGFydHMudHJlbmQ9bmV3IENoYXJ0KHRjLHt0eXBlOidsaW5lJyxkYXRhOntsYWJlbHM6bW9udGhzLm1hcChtPT5nZXREaXNwbGF5TW9udGgobSkpLGRhdGFzZXRzOlt7bGFiZWw6J1NwZW5kaW5nJyxkYXRhOnNwZW5kQnlNb250aCxib3JkZXJDb2xvcjonI0VGNDQ0NCcsYmFja2dyb3VuZENvbG9yOidyZ2JhKDIzOSw2OCw2OCwwLjEpJyx0ZW5zaW9uOjAuNCxmaWxsOnRydWUscG9pbnRSYWRpdXM6NCxwb2ludEJhY2tncm91bmRDb2xvcjonI0VGNDQ0NCd9LHtsYWJlbDonSW5jb21lJyxkYXRhOmluY0J5TW9udGgsYm9yZGVyQ29sb3I6JyMxMEI5ODEnLGJhY2tncm91bmRDb2xvcjoncmdiYSgxNiwxODUsMTI5LDAuMSknLHRlbnNpb246MC40LGZpbGw6dHJ1ZSxwb2ludFJhZGl1czo0LHBvaW50QmFja2dyb3VuZENvbG9yOicjMTBCOTgxJ31dfSxvcHRpb25zOntyZXNwb25zaXZlOnRydWUsbWFpbnRhaW5Bc3BlY3RSYXRpbzpmYWxzZSxwbHVnaW5zOntsZWdlbmQ6e2Rpc3BsYXk6ZmFsc2V9fSxzY2FsZXM6e3g6e2dyaWQ6e2Rpc3BsYXk6ZmFsc2V9LHRpY2tzOntmb250OntmYW1pbHk6J051bml0bycsc2l6ZToxMH0sY29sb3I6JyM5QUEwQjInfX0seTp7Z3JpZDp7Y29sb3I6JyNGMEYwRjAnfSx0aWNrczp7Zm9udDp7ZmFtaWx5OidOdW5pdG8nLHNpemU6MTB9LGNvbG9yOicjOUFBMEIyJyxjYWxsYmFjazp2PT4nJCcrdi50b0xvY2FsZVN0cmluZygpfX19fX0pOwogIGNvbnN0IGNhdFRvdGFscz17fTsKICBPYmplY3QudmFsdWVzKGRhdGEpLmZvckVhY2gobT0+e2lmKCFtfHwhbS5leHBlbnNlcykgcmV0dXJuOyBtLmV4cGVuc2VzLmZvckVhY2goZT0+e2NhdFRvdGFsc1tlLmNhdGVnb3J5fHwnT3RoZXInXT0oY2F0VG90YWxzW2UuY2F0ZWdvcnl8fCdPdGhlciddfHwwKStOdW1iZXIoZS5hbW91bnR8fDApO30pO30pOwogIGNvbnN0IHNvcnRlZD1PYmplY3QuZW50cmllcyhjYXRUb3RhbHMpLnNvcnQoKGEsYik9PmJbMV0tYVsxXSkuc2xpY2UoMCw1KTsKICBjb25zdCBncmFuZFRvdGFsPXNvcnRlZC5yZWR1Y2UoKHMsWyx2XSk9PnMrdiwwKTsKICBjb25zdCBkb251dENvbG9ycz1bJyNGRjZCMzUnLCcjRkY4QzQyJywnI0ZGNDc1NycsJyM0QTlFRkYnLCcjRkZCRTBCJ107CiAgaWYoY2hhcnRzLmRvbnV0KSBjaGFydHMuZG9udXQuZGVzdHJveSgpOwogIGNoYXJ0cy5kb251dD1uZXcgQ2hhcnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RvbnV0Q2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpLHt0eXBlOidkb3VnaG51dCcsZGF0YTp7ZGF0YXNldHM6W3tkYXRhOnNvcnRlZC5tYXAoKFssdl0pPT52KSxiYWNrZ3JvdW5kQ29sb3I6ZG9udXRDb2xvcnMsYm9yZGVyV2lkdGg6MH1dfSxvcHRpb25zOntyZXNwb25zaXZlOnRydWUsbWFpbnRhaW5Bc3BlY3RSYXRpbzpmYWxzZSxjdXRvdXQ6JzY1JScscGx1Z2luczp7bGVnZW5kOntkaXNwbGF5OmZhbHNlfX19fSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcDUtbGlzdCcpLmlubmVySFRNTD1zb3J0ZWQubWFwKChbY2F0LHZhbF0saSk9PmA8ZGl2IGNsYXNzPSJ0b3AtaXRlbSI+PGRpdiBjbGFzcz0idG9wLWRvdCIgc3R5bGU9ImJhY2tncm91bmQ6JHtkb251dENvbG9yc1tpXX07Ij48L2Rpdj48ZGl2IGNsYXNzPSJ0b3AtbGFiZWwiPiR7Y2F0fTwvZGl2PjxkaXYgY2xhc3M9InRvcC1wY3QiPiR7Z3JhbmRUb3RhbD4wPyh2YWwvZ3JhbmRUb3RhbCoxMDApLnRvRml4ZWQoMSk6MH0lPC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgY29uc3QgY3VyTT1kYXRhW3ZpZXdNb250aF18fHt9OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWRnZXQtYmFycycpLmlubmVySFRNTD1jYXRDb25maWcuZmlsdGVyKGM9PmMua2V5IT09J2ludmVzdCcmJmMua2V5IT09J3NhbGFyeScmJmMua2V5IT09J2RlYnQnJiZjLmtleSE9PSdvdGhlcicpLm1hcChjYXQ9PnsKICAgIGNvbnN0IHNwZW50PSgoY3VyTS5leHBlbnNlc3x8W10pLmZpbHRlcihlPT5lLmNhdGVnb3J5PT09Y2F0LmxhYmVsKS5yZWR1Y2UoKHMsZSk9PnMrTnVtYmVyKGUuYW1vdW50fHwwKSwwKSk7CiAgICBjb25zdCBwY3Q9TWF0aC5taW4oc3BlbnQvMTAwMCoxMDAsMTAwKTsKICAgIHJldHVybiBgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMnB4OyI+PGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO21hcmdpbi1ib3R0b206NnB4OyI+PGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6OHB4OyI+PGRpdiBzdHlsZT0id2lkdGg6MjhweDtoZWlnaHQ6MjhweDtiYWNrZ3JvdW5kOiR7Y2F0LmNvbG9yfTIwO2JvcmRlci1yYWRpdXM6OHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXNpemU6MC45ZW07Ij4ke2NhdC5pY29ufTwvZGl2PjxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjAuODhlbTsiPiR7Y2F0LmxhYmVsfTwvc3Bhbj48L2Rpdj48c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTowLjgyZW07Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+JHtmbXQoc3BlbnQpfSAvICQxMDAwPC9zcGFuPjwvZGl2PjxkaXYgc3R5bGU9ImhlaWdodDo2cHg7YmFja2dyb3VuZDojRjBGMEYwO2JvcmRlci1yYWRpdXM6NHB4O292ZXJmbG93OmhpZGRlbjsiPjxkaXYgc3R5bGU9IndpZHRoOiR7cGN0fSU7aGVpZ2h0OjEwMCU7YmFja2dyb3VuZDoke2NhdC5jb2xvcn07Ym9yZGVyLXJhZGl1czo0cHg7Ij48L2Rpdj48L2Rpdj48L2Rpdj5gOwogIH0pLmpvaW4oJycpOwogIGNvbnN0IGFjY291bnRzPWdldEFjY291bnRzTGlzdCgpLCBhY2NUeXBlcz17fTsKICBhY2NvdW50cy5mb3JFYWNoKGE9PnthY2NUeXBlc1thLnR5cGVdPShhY2NUeXBlc1thLnR5cGVdfHwwKStNYXRoLmFicyhOdW1iZXIoYS5iYWxhbmNlfHwwKSk7fSk7CiAgY29uc3QgYWNjQ29sb3JzPVsnI0ZGQkUwQicsJyM0QTlFRkYnLCcjRkY2QjM1JywnIzRFQ0RDNCddOwogIGNvbnN0IGFjY0tleXM9T2JqZWN0LmtleXMoYWNjVHlwZXMpLCBhY2NWYWxzPWFjY0tleXMubWFwKGs9PmFjY1R5cGVzW2tdKTsKICBjb25zdCBhY2NUb3RhbD1hY2NWYWxzLnJlZHVjZSgocyx2KT0+cyt2LDApOwogIGlmKGNoYXJ0cy5hY2NvdW50KSBjaGFydHMuYWNjb3VudC5kZXN0cm95KCk7CiAgY2hhcnRzLmFjY291bnQ9bmV3IENoYXJ0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50Q2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpLHt0eXBlOidkb3VnaG51dCcsZGF0YTp7ZGF0YXNldHM6W3tkYXRhOmFjY1ZhbHMsYmFja2dyb3VuZENvbG9yOmFjY0NvbG9ycyxib3JkZXJXaWR0aDowfV19LG9wdGlvbnM6e3Jlc3BvbnNpdmU6ZmFsc2UsY3V0b3V0Oic2MCUnLHBsdWdpbnM6e2xlZ2VuZDp7ZGlzcGxheTpmYWxzZX19fX0pOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWJyZWFrZG93bicpLmlubmVySFRNTD1hY2NLZXlzLm1hcCgoayxpKT0+YDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjhweDttYXJnaW4tYm90dG9tOjhweDtmb250LXNpemU6MC44MmVtO2ZvbnQtd2VpZ2h0OjcwMDsiPjxkaXYgc3R5bGU9IndpZHRoOjEwcHg7aGVpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czo1MCU7YmFja2dyb3VuZDoke2FjY0NvbG9yc1tpXX07ZmxleC1zaHJpbms6MDsiPjwvZGl2','PjxzcGFuPiR7a308L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbWVkKTttYXJnaW4tbGVmdDphdXRvOyI+JHthY2NUb3RhbD4wPyhhY2NWYWxzW2ldL2FjY1RvdGFsKjEwMCkudG9GaXhlZCgxKTowfSU8L3NwYW4+PC9kaXY+YCkuam9pbignJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBTRVRUSU5HUwovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8g4pSA4pSAIE5ldCBXb3J0aCBUeXBlIFZpc2liaWxpdHkgKFNldHRpbmdzKSDilIDilIAKY29uc3QgTldfVFlQRV9PUkRFUl9CQVNFID0gWydjaGVja2luZycsJ3NhdmluZ3NfYWNjJywnYnJva2VyYWdlJywncmV0aXJlbWVudCcsJ2JvbmRzX2ZkJywnbWV0YWxzJywncmVhbGVzdGF0ZScsJ2Nhc2gnLCdjcmVkaXRfY2FyZCcsJ2xvYW4nLCdvdGhlcl9saWFiaWxpdHknXTsKY29uc3QgTldfVFlQRV9TSE9SVF9CQVNFID0geyBjaGVja2luZzonQ2hlY2tpbmcnLCBzYXZpbmdzX2FjYzonU2F2aW5ncycsIGJyb2tlcmFnZTonSW52ZXN0bWVudCcsIHJldGlyZW1lbnQ6J1JldGlyZW1lbnQnLCBib25kc19mZDonQm9uZHMvRkQnLCBtZXRhbHM6J01ldGFscycsIHJlYWxlc3RhdGU6J1Byb3BlcnR5JywgY2FzaDonQ2FzaCcsIGNyZWRpdF9jYXJkOidDcmVkaXQgQ2FyZCcsIGxvYW46J0xvYW4nLCBvdGhlcl9saWFiaWxpdHk6J090aGVyIExpYWIuJyB9OwoKZnVuY3Rpb24gZ2V0TldDdXN0b21UeXBlcygpIHsgcmV0dXJuIGRhdGEuX253Q3VzdG9tVHlwZXMgfHwgW107IH0KZnVuY3Rpb24gZ2V0TldUeXBlT3JkZXIoKSB7CiAgY29uc3QgY3VzdG9tID0gZ2V0TldDdXN0b21UeXBlcygpLm1hcChjID0+IGMua2V5KTsKICByZXR1cm4gWy4uLk5XX1RZUEVfT1JERVJfQkFTRSwgLi4uY3VzdG9tXTsKfQpmdW5jdGlvbiBnZXROV1R5cGVTaG9ydCgpIHsKICBjb25zdCBzaG9ydHMgPSB7IC4uLk5XX1RZUEVfU0hPUlRfQkFTRSB9OwogIGdldE5XQ3VzdG9tVHlwZXMoKS5mb3JFYWNoKGMgPT4geyBzaG9ydHNbYy5rZXldID0gYy5sYWJlbDsgfSk7CiAgcmV0dXJuIHNob3J0czsKfQovLyBBbGlhc2VzIHVzZWQgYWNyb3NzIHRoZSBjb2RlYmFzZQpsZXQgTldfVFlQRV9PUkRFUiA9IE5XX1RZUEVfT1JERVJfQkFTRTsKbGV0IE5XX1RZUEVfU0hPUlQgPSBOV19UWVBFX1NIT1JUX0JBU0U7Cgpjb25zdCBOV19UWVBFX0VNT0pJX09QVFMgPSBbJ/Cfj6YnLCfwn4+gJywn8J+alycsJ/CfkrAnLCfwn5OmJywn8J+OkycsJ/CfkrwnLCfwn4+FJywn8J+MkCcsJ/CfkrMnLCfwn4+X77iPJywn8J+Pi++4jycsJ/Cfk7EnLCfwn46oJywn8J+boe+4jyddOwpsZXQgcGlja2VkTldUeXBlRW1vamkgPSAn8J+Ppic7CgpmdW5jdGlvbiBhZGRDdXN0b21OV1R5cGUoKSB7CiAgY29uc3QgbmFtZSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1uYW1lLWlucHV0JykudmFsdWUgfHwgJycpLnRyaW0oKTsKICBjb25zdCBpc0xpYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1pcy1saWFiJykuY2hlY2tlZDsKICBpZiAoIW5hbWUpIHsgc2hvd1RvYXN0KCdFbnRlciBhIHR5cGUgbmFtZSDinYwnKTsgcmV0dXJuOyB9CiAgY29uc3Qga2V5ID0gJ2N1c3RvbV8nICsgbmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xzKy9nLCdfJykgKyAnXycgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTsKICBjb25zdCBsYWJlbCA9IG5hbWU7CiAgaWYgKCFkYXRhLl9ud0N1c3RvbVR5cGVzKSBkYXRhLl9ud0N1c3RvbVR5cGVzID0gW107CiAgLy8gQWRkIHRvIE5XX1RZUEVTIHJ1bnRpbWUgb2JqZWN0CiAgTldfVFlQRVNba2V5XSA9IHsgbGFiZWwsIGVtb2ppOiBwaWNrZWROV1R5cGVFbW9qaSwgY29sb3I6ICcjNkI3MjgwJywgaXNMaWFiIH07CiAgZGF0YS5fbndDdXN0b21UeXBlcy5wdXNoKHsga2V5LCBsYWJlbCwgZW1vamk6IHBpY2tlZE5XVHlwZUVtb2ppLCBpc0xpYWIgfSk7CiAgLy8gQWRkIHRvIHZpc2liaWxpdHkKICBjb25zdCB2aXMgPSBnZXROV1R5cGVWaXNpYmlsaXR5KCk7CiAgdmlzW2tleV0gPSB0cnVlOwogIHNhdmUoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1uYW1lLWlucHV0JykudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctdHlwZS1pcy1saWFiJykuY2hlY2tlZCA9IGZhbHNlOwogIHJlbmRlck5XVHlwZVNldHRpbmdzKCk7CiAgc2hvd1RvYXN0KCfinIUgJyArIGxhYmVsICsgJyB0eXBlIGFkZGVkIScpOwp9CgpmdW5jdGlvbiByZW1vdmVDdXN0b21OV1R5cGUoa2V5KSB7CiAgaWYgKCFjb25maXJtKCdSZW1vdmUgdGhpcyBjdXN0b20gYWNjb3VudCB0eXBlPycpKSByZXR1cm47CiAgZGF0YS5fbndDdXN0b21UeXBlcyA9IChkYXRhLl9ud0N1c3RvbVR5cGVzfHxbXSkuZmlsdGVyKGMgPT4gYy5rZXkgIT09IGtleSk7CiAgY29uc3QgdmlzID0gZ2V0TldUeXBlVmlzaWJpbGl0eSgpOwogIGRlbGV0ZSB2aXNba2V5XTsKICBkZWxldGUgTldfVFlQRVNba2V5XTsKICBzYXZlKCk7CiAgcmVuZGVyTldUeXBlU2V0dGluZ3MoKTsKICBzaG93VG9hc3QoJ1R5cGUgcmVtb3ZlZCcpOwp9CgpmdW5jdGlvbiBnZXROV1R5cGVWaXNpYmlsaXR5KCkgewogIGlmICghZGF0YS5fbndUeXBlVmlzaWJsZSkgewogICAgLy8gRGVmYXVsdDogYWxsIHZpc2libGUKICAgIGRhdGEuX253VHlwZVZpc2libGUgPSB7fTsKICAgIE5XX1RZUEVfT1JERVIuZm9yRWFjaCh0ID0+IHsgZGF0YS5fbndUeXBlVmlzaWJsZVt0XSA9IHRydWU7IH0pOwogIH0KICByZXR1cm4gZGF0YS5fbndUeXBlVmlzaWJsZTsKfQoKZnVuY3Rpb24gcmVuZGVyTldUeXBlU2V0dGluZ3MoKSB7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy10eXBlLXZpc2liaWxpdHktZ3JpZCcpOwogIGlmICghZ3JpZCkgcmV0dXJuOwogIGNvbnN0IHZpcyA9IGdldE5XVHlwZVZpc2liaWxpdHkoKTsKICBjb25zdCBvcmRlciA9IGdldE5XVHlwZU9yZGVyKCk7CiAgY29uc3Qgc2hvcnRzID0gZ2V0TldUeXBlU2hvcnQoKTsKICBjb25zdCBjdXN0b21LZXlzID0gZ2V0TldDdXN0b21UeXBlcygpLm1hcChjID0+IGMua2V5KTsKICBncmlkLmlubmVySFRNTCA9IG9yZGVyLm1hcCh0ID0+IHsKICAgIGNvbnN0IGNmZyA9IE5XX1RZUEVTW3RdOwogICAgaWYgKCFjZmcpIHJldHVybiAnJzsKICAgIGNvbnN0IG9uID0gdmlzW3RdICE9PSBmYWxzZTsKICAgIGNvbnN0IGlzQ3VzdG9tID0gY3VzdG9tS2V5cy5pbmNsdWRlcyh0KTsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0iPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0taWNvbiI+JHtjZmcuZW1vaml9PC9zcGFuPgogICAgICA8c3BhbiBjbGFzcz0iaG9tZS1jYXJkLWl0ZW0tbGFiZWwiPiR7c2hvcnRzW3RdfHxjZmcubGFiZWx9JHtjZmcuaXNMaWFiPycgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Ij5MaWFiPC9zcGFuPic6Jyd9PC9zcGFuPgogICAgICA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlICR7b24/J29uJzonJ30iIG9uY2xpY2s9InRvZ2dsZU5XVHlwZSgnJHt0fScpIiB0aXRsZT0iJHtvbj8nVmlzaWJsZSc6J0hpZGRlbid9Ij4KICAgICAgICAke29uPyfinJMnOifil4snfQogICAgICA8L2J1dHRvbj4KICAgICAgJHtpc0N1c3RvbSA/IGA8YnV0dG9uIGNsYXNzPSJob21lLWNhcmQtdG9nZ2xlIiBvbmNsaWNrPSJyZW1vdmVDdXN0b21OV1R5cGUoJyR7dH0nKSIgdGl0bGU9IlJlbW92ZSIgc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTtmb250LXNpemU6MC44ZW07Ij7inJU8L2J1dHRvbj5gIDogJyd9CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwogIC8vIEVtb2ppIHBpY2tlcgogIGNvbnN0IGVtb2ppUm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXR5cGUtZW1vamktcm93Jyk7CiAgaWYgKGVtb2ppUm93KSBlbW9qaVJvdy5pbm5lckhUTUwgPSBOV19UWVBFX0VNT0pJX09QVFMubWFwKGUgPT4gYDxzcGFuIGNsYXNzPSJlbW9qaS1vcHQgJHtlPT09cGlja2VkTldUeXBlRW1vamk/J3NlbGVjdGVkJzonJ30iIG9uY2xpY2s9InBpY2tlZE5XVHlwZUVtb2ppPScke2V9JztyZW5kZXJOV1R5cGVTZXR0aW5ncygpOyI+JHtlfTwvc3Bhbj5gKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gdG9nZ2xlTldUeXBlKHR5cGUpIHsKICBjb25zdCB2aXMgPSBnZXROV1R5cGVWaXNpYmlsaXR5KCk7CiAgdmlzW3R5cGVdID0gdmlzW3R5cGVdID09PSBmYWxzZTsgLy8gdG9nZ2xlCiAgc2F2ZSgpOwogIHJlbmRlck5XVHlwZVNldHRpbmdzKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlclNldHRpbmdzKCkgewogIGNvbnN0IG1vbnRocz1PYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoaz0+IWsuc3RhcnRzV2l0aCgnXycpKS5zb3J0KChhLGIpPT5iLmxvY2FsZUNvbXBhcmUoYSkpOwoKICAvLyBUaGVtZSBiYWRnZQogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50aGVtZS1jYXJkJykuZm9yRWFjaChjID0+IGMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlLXRoZW1lJykpOwogIGNvbnN0IHRjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RoZW1lLScrY3VycmVudFRoZW1lKTsKICBpZih0YykgdGMuY2xhc3NMaXN0LmFkZCgnYWN0aXZlLXRoZW1lJyk7CiAgLy8gQ3VycmVuY3kgZGlzcGxheQogIGNvbnN0IGNkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldHRpbmdzLWN1cnItZGlzcGxheScpOwogIGNvbnN0IGNuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NldHRpbmdzLWN1cnItbmFtZScpOwogIGlmKGNkKSBjZC50ZXh0Q29udGVudCA9IGAke2N1cnJlbnRDdXJyZW5jeS5mbGFnfSAke2N1cnJlbnRDdXJyZW5jeS5jb2RlfSDigJQgJHtjdXJyZW50Q3VycmVuY3kuc3ltYm9sfWA7CiAgaWYoY24pIGNuLnRleHRDb250ZW50ID0gY3VycmVudEN1cnJlbmN5Lm5hbWUgKyAoY3VycmVudEN1cnJlbmN5LmNvdW50cnk/JyDCtyAnK2N1cnJlbnRDdXJyZW5jeS5jb3VudHJ5OicnKTsKICAvLyBIb21lIGNhcmQgbWFuYWdlcgogIHJlbmRlckhvbWVDYXJkU2V0dGluZ3MoKTsKICAvLyBJbnZlc3RtZW50IGNhcmQgbWFuYWdlcgogIHJlbmRlckludkNhcmRTZXR0aW5ncygpOwogIC8vIENhdGVnb3J5IHBpbGxzCiAgcmVuZGVyQ2F0UGlsbHMoKTsKICAvLyBOZXQgV29ydGggdHlwZSB2aXNpYmlsaXR5CiAgcmVuZGVyTldUeXBlU2V0dGluZ3MoKTsKICAvLyBGWCByYXRlIG92ZXJyaWRlcyBwYW5lbAogIHJlbmRlckZYUmF0ZXNQYW5lbCgpOwp9CmZ1bmN0aW9uIGRlbGV0ZU1vbnRoKGtleSkgeyBpZighY29uZmlybShgRGVsZXRlIGFsbCBkYXRhIGZvciAke2dldERpc3BsYXlNb250aChrZXkpfT9gKSkgcmV0dXJuOyBkZWxldGUgZGF0YVtrZXldOyBzYXZlKCk7IHJlbmRlckhvbWUoKTsgcmVuZGVyTW9udGhzTGlzdCgpOyByZW5kZXJSZXNldFN1bW1hcnkoKTsgc2hvd1RvYXN0KCfwn5eR77iPICcgKyBnZXREaXNwbGF5TW9udGgoa2V5KSArICcgZGVsZXRlZCcpOyB9CgoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEVYUE9SVCAvIElNUE9SVCAvIEJBQ0tVUAovLyDilZDilZDilZDilZDi','lZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gZG93bmxvYWRCYWNrdXAoKSB7CiAgY29uc3Qgc3RyPSJkYXRhOnRleHQvanNvbjtjaGFyc2V0PXV0Zi04LCIrZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICBjb25zdCBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsgYS5zZXRBdHRyaWJ1dGUoImhyZWYiLHN0cik7IGEuc2V0QXR0cmlidXRlKCJkb3dubG9hZCIsIm1vbmV5Zmxvd19iYWNrdXBfIituZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwxMCkrIi5qc29uIik7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsgYS5jbGljaygpOyBhLnJlbW92ZSgpOyBzaG93VG9hc3QoJ0JhY2t1cCBkb3dubG9hZGVkIOKchScpOwp9CmZ1bmN0aW9uIHJlc3RvcmVCYWNrdXAoaW5wdXQpIHsKICBjb25zdCBmaWxlPWlucHV0LmZpbGVzWzBdOyBpZighZmlsZSkgcmV0dXJuOwogIGNvbnN0IHJlYWRlcj1uZXcgRmlsZVJlYWRlcigpOwogIHJlYWRlci5vbmxvYWQ9ZT0+eyB0cnl7IGNvbnN0IGltcG9ydGVkPUpTT04ucGFyc2UoZS50YXJnZXQucmVzdWx0KTsgaWYoY29uZmlybSgn4pqg77iPIFRoaXMgd2lsbCBPVkVSV1JJVEUgYWxsIGRhdGEuIENvbnRpbnVlPycpKXsgZGF0YT1pbXBvcnRlZDsgc2F2ZSgpOyBwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpOyByZW5kZXJIb21lKCk7IHNob3dUb2FzdCgn4pyFIERhdGEgcmVzdG9yZWQhJyk7IH0gfWNhdGNoKGVycil7c2hvd1RvYXN0KCfinYwgSW52YWxpZCBKU09OJyk7fSB9OwogIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwp9CmZ1bmN0aW9uIGV4cG9ydEFsbERhdGEoKSB7CiAgY29uc3Qgd2I9WExTWC51dGlscy5ib29rX25ldygpOwogIFt7a2V5OidpbmNvbWUnLG5hbWU6J0luY29tZSd9LHtrZXk6J2V4cGVuc2VzJyxuYW1lOidFeHBlbnNlcyd9LHtrZXk6J2ludmVzdG1lbnRzJyxuYW1lOidJbnZlc3RtZW50cyd9LHtrZXk6J3JlYWxFc3RhdGUnLG5hbWU6J1JlYWwgRXN0YXRlJ30se2tleTonbWV0YWxzJyxuYW1lOidNZXRhbHMnfSx7a2V5OidhZGRpdGlvbmFsJyxuYW1lOidBZGRpdGlvbmFsJ30se2tleTonZGVidHMnLG5hbWU6J0RlYnRzJ30se2tleTonZ2l2ZW5Ub090aGVycycsbmFtZTonR2l2ZW4gVG8gT3RoZXJzJ31dLmZvckVhY2goY2F0PT57CiAgICBsZXQgcm93cz1bXTsKICAgIGlmKGNhdC5rZXk9PT0nbWV0YWxzJykgcm93cy5wdXNoKFsnTW9udGgnLCdNZXRhbCcsJ1B1cml0eScsJ09jY2FzaW9uJywnSXRlbScsJ1dlaWdodChnKSddKTsKICAgIGVsc2UgaWYoY2F0LmtleT09PSdyZWFsRXN0YXRlJykgcm93cy5wdXNoKFsnTW9udGgnLCdEYXRlJywnQ291bnRyeScsJ0N1cnJlbmN5JywnUHVyY2hhc2UnLCdEZXNjJywnQXJlYScsJ0N1cnJlbnQnXSk7CiAgICBlbHNlIHJvd3MucHVzaChbJ01vbnRoJywnRGF0ZScsJ0NhdGVnb3J5JywnQW1vdW50JywnRGVzY3JpcHRpb24nXSk7CiAgICBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoaz0+IWsuc3RhcnRzV2l0aCgnXycpKS5zb3J0KCkuZm9yRWFjaChtS2V5PT57CiAgICAgIChkYXRhW21LZXldW2NhdC5rZXldfHxbXSkuZm9yRWFjaChyPT57CiAgICAgICAgY29uc3QgbWw9Z2V0RGlzcGxheU1vbnRoKG1LZXkpOwogICAgICAgIGlmKGNhdC5rZXk9PT0nbWV0YWxzJykgcm93cy5wdXNoKFttbCxyLm1ldGFsVHlwZSxyLnB1cml0eSxyLm9jY2FzaW9uLHIuaXRlbU5hbWUsci53ZWlnaHRHbXNdKTsKICAgICAgICBlbHNlIGlmKGNhdC5rZXk9PT0ncmVhbEVzdGF0ZScpIHJvd3MucHVzaChbbWwsci5kYXRlLHIuY291bnRyeSxyLmN1cnJlbmN5LHIucHVyY2hhc2VWYWx1ZSxyLmRlc2NyaXB0aW9uLHIuYXJlYUNlbnRzLHIuY3VycmVudFZhbHVlXSk7CiAgICAgICAgZWxzZSByb3dzLnB1c2goW21sLHIuZGF0ZSxyLmNhdGVnb3J5LHIuYW1vdW50LHIuZGVzY3JpcHRpb25dKTsKICAgICAgfSk7CiAgICB9KTsKICAgIGlmKHJvd3MubGVuZ3RoPjEpe2NvbnN0IHdzPVhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJvd3MpO1hMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2Isd3MsY2F0Lm5hbWUpO30KICB9KTsKICAvLyBTaGVldDogR2xvYmFsIE1ldGFscyAoX21ldGFscyBhcnJheSkKICBjb25zdCBtZXRhbHNHbG9iYWwgPSBkYXRhLl9tZXRhbHMgfHwgW107CiAgaWYgKG1ldGFsc0dsb2JhbC5sZW5ndGgpIHsKICAgIGNvbnN0IG1Sb3dzID0gW1snTWV0YWwgVHlwZScsJ05hbWUnLCdQdXJpdHknLCdPY2Nhc2lvbicsJ0Zvcm0nLCdXZWlnaHQgKGcpJywnUHJpY2UvZycsJ1ZhbHVlIChVU0QpJywnRGF0ZScsJ05vdGVzJ11dOwogICAgbWV0YWxzR2xvYmFsLmZvckVhY2gobSA9PiB7CiAgICAgIGNvbnN0IGcgPSBOdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgICBjb25zdCBwID0gTnVtYmVyKG0ucHJpY2V8fDApIHx8IChNRVRBTF9DT05GSUdbbS5tZXRhbFR5cGVdfHx7fSkucHJpY2VQZXJHcmFtIHx8IDA7CiAgICAgIG1Sb3dzLnB1c2goW20ubWV0YWxUeXBlfHwnJywgbS5uYW1lfHwnJywgbS5wdXJpdHl8fCcnLCBtLm9jY2FzaW9ufHwnJywgbS5mb3JtfHwnJywgZywgcCwgKGcqcCkudG9GaXhlZCgyKSwgbS5kYXRlfHwnJywgbS5ub3Rlc3x8JyddKTsKICAgIH0pOwogICAgY29uc3QgbVdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQobVJvd3MpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3YiwgbVdzLCAnTWV0YWxzIChQb3J0Zm9saW8pJyk7CiAgfQoKICAvLyBTaGVldDogR2xvYmFsIFJlYWwgRXN0YXRlIChfcmVhbEVzdGF0ZSBhcnJheSkKICBjb25zdCByZUdsb2JhbCA9IGRhdGEuX3JlYWxFc3RhdGUgfHwgW107CiAgaWYgKHJlR2xvYmFsLmxlbmd0aCkgewogICAgY29uc3QgcmVSb3dzID0gW1snRGVzY3JpcHRpb24nLCdDb3VudHJ5JywnQ3VycmVuY3knLCdQdXJjaGFzZSBWYWx1ZScsJ0N1cnJlbnQgVmFsdWUnLCdBcmVhJywnRGF0ZSddXTsKICAgIHJlR2xvYmFsLmZvckVhY2gocCA9PiByZVJvd3MucHVzaChbcC5kZXNjcmlwdGlvbnx8JycsIHAuY291bnRyeXx8JycsIHAuY3VycmVuY3l8fCcnLCBwLnB1cmNoYXNlVmFsdWV8fDAsIHAuY3VycmVudFZhbHVlfHwwLCBwLmFyZWF8fCcnLCBwLmRhdGV8fCcnXSkpOwogICAgY29uc3QgcmVXcyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KHJlUm93cyk7CiAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCByZVdzLCAnUmVhbCBFc3RhdGUgKFBvcnRmb2xpbyknKTsKICB9CgogIC8vIFNoZWV0OiBOVyBBY2NvdW50cyAoX253QWNjb3VudHMpCiAgY29uc3QgbndBY2N0cyA9IGRhdGEuX253QWNjb3VudHMgfHwgW107CiAgaWYgKG53QWNjdHMubGVuZ3RoKSB7CiAgICBjb25zdCBud1Jvd3MgPSBbWydUeXBlJywnTmFtZScsJ0JhbGFuY2UnLCdDdXJyZW5jeScsJ0xhc3QgVXBkYXRlZCcsJ0JhbmsnLCdOb3RlcycsJ1B1cml0eScsJ0dyYW1zJywnUHVyY2hhc2UgVmFsdWUnLCdDb3VudHJ5J11dOwogICAgbndBY2N0cy5mb3JFYWNoKGEgPT4gewogICAgICBjb25zdCBtID0gYS5tZXRhIHx8IHt9OwogICAgICBud1Jvd3MucHVzaChbYS50eXBlfHwnJywgYS5uYW1lfHwnJywgYS5iYWxhbmNlfHwwLCBhLmN1cnJlbmN5fHwnJywgYS5sYXN0VXBkYXRlZHx8JycsIG0uYmFua3x8JycsIG0ubm90ZXN8fCcnLCBtLnB1cml0eXx8JycsIG0uZ3JhbXN8fCcnLCBtLnB1cmNoYXNlVmFsdWV8fCcnLCBtLmNvdW50cnl8fCcnXSk7CiAgICB9KTsKICAgIGNvbnN0IG53V3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChud1Jvd3MpOwogICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3YiwgbndXcywgJ05XIEFjY291bnRzJyk7CiAgfQoKICBYTFNYLndyaXRlRmlsZSh3YiwiTW9uZXlGbG93X0NvbXBsZXRlLnhsc3giKTsgc2hvd1RvYXN0KCdFeGNlbCBleHBvcnRlZCDinIUnKTsKfQpmdW5jdGlvbiBleHBvcnREYXRhQ2F0ZWdvcnkodHlwZSkgewogIGNvbnN0IGxpc3Q9Z2V0RGF0YUVmZmVjdGl2ZUVudHJpZXModHlwZSk7IGlmKCFsaXN0Lmxlbmd0aCl7c2hvd1RvYXN0KCdObyBkYXRhIHRvIGV4cG9ydCcpO3JldHVybjt9CiAgY29uc3QgY2xlYW49bGlzdC5tYXAoKHtfbW9udGgsX2lkeCwuLi5yfSk9PnIpOwogIGNvbnN0IHdiPVhMU1gudXRpbHMuYm9va19uZXcoKTsgY29uc3Qgd3M9WExTWC51dGlscy5qc29uX3RvX3NoZWV0KGNsZWFuKTsgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yix3cyx0eXBlKTsKICBYTFNYLndyaXRlRmlsZSh3YixgJHt0eXBlfV9FeHBvcnQueGxzeGApOwp9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gUEFTVEUgLyBGSUxFIElNUE9SVAovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKZnVuY3Rpb24gcGFyc2VQYXN0ZShtb250aEtleSwgdHlwZSkgewogIGNvbnN0IHRleHQ9KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBwYXN0ZS0ke3R5cGV9YCl8fHt9KS52YWx1ZXx8Jyc7IGlmKCF0ZXh0LnRyaW0oKSkgcmV0dXJuOwogIGlmKHR5cGU9PT0nbWV0YWxzJyl7cGFyc2VNZXRhbHNQYXN0ZShtb250aEtleSx0ZXh0KTtyZXR1cm47fQogIGlmKHR5cGU9PT0ncmVhbEVzdGF0ZScpe3BhcnNlUmVhbEVzdGF0ZVBhc3RlKG1vbnRoS2V5LHRleHQpO3JldHVybjt9CiAgY29uc3QgbGluZXM9dGV4dC50cmltKCkuc3BsaXQoJ1xuJyk7IGxldCBjb3VudD0wOwogIGxpbmVzLmZvckVhY2gobGluZT0+ewogICAgY29uc3QgcGFydHM9bGluZS5yZXBsYWNlKC8sL2csJycpLnNwbGl0KC9ccysvKTsKICAgIGlmKHBhcnRzLmxlbmd0aDwyKSByZXR1cm47CiAgICBjb25zdCBkYXRlSWR4PXBhcnRzLmZpbmRJbmRleChwPT4haXNOYU4oRGF0ZS5wYXJzZShwKSkmJihwLmluY2x1ZGVzKCcvJyl8fHAuaW5jbHVkZXMoJy0nKSkpOwogICAgaWYoZGF0ZUlkeD09PS0xKSByZXR1cm47CiAgICBjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUocGFydHNbZGF0ZUlkeF0pOwogICAgbGV0IGFtdElkeD0tMTsKICAgIGZvcihsZXQgaT1wYXJ0cy5sZW5ndGgtMTtpPj0wO2ktLSl7aWYoaT09PWRhdGVJZHgpY29udGludWU7Y29uc3QgYz1wYXJ0c1tpXS5yZXBsYWNlKC9bJOKCrMKjXS9nLCcnKTtpZighaXNOYU4ocGFyc2VGbG9hdChjKSkmJmlzRmluaXRlKGMpKXthbXRJZHg9aTticmVhazt9fQogICAgaWYoYW10SWR4PT09LTEpIHJldHVybjsKICAgIGNvbnN0IGFtb3VudD1wYXJzZUZsb2F0KHBhcnRzW2FtdElkeF0ucmVwbGFjZSgvWyTigqzCo10vZywnJykpOwogICAgY29uc3QgZGVzYz1wYXJ0cy5maWx0ZXIoKF8saSk9PmkhPT1kYXRlSWR4JiZpIT09YW10SWR4KS5qb2luKCcgJyk7CiAgICBjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8bW9udGhLZXk7IGVuc3VyZU1vbnRoKHRtKTsKICAgIGRhdGFbdG1dW3R5cGVdLnB1c2goe2RhdGUsY2F0ZWdvcnk6J0ltcG9ydGVkJyxhbW91bnQsZGVzY3JpcHRpb246ZGVzY30pOyBjb3VudCsrOwogIH0pOwogIGlmKGNvdW50PjApe3NhdmUoKTtwb3B1bGF0ZURhdGFNb250aFNlbGVjdCgpO3JlbmRlckRhdGFTY3JlZW4oKTtzaG93VG9hc3QoYOKchSBQYXJzZWQgJHtjb3VudH0gcm93cyFgKTsoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo','YHBhc3RlLSR7dHlwZX1gKXx8e30pLnZhbHVlPScnO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLiBDaGVjayBmb3JtYXQuJyk7Cn0KZnVuY3Rpb24gcGFyc2VNZXRhbHNQYXN0ZShtb250aEtleSx0ZXh0KXtjb25zdCBsaW5lcz10ZXh0LnRyaW0oKS5zcGxpdCgnXG4nKTtsZXQgY291bnQ9MDtsaW5lcy5mb3JFYWNoKGxpbmU9Pntjb25zdCBwPWxpbmUuc3BsaXQoL1ssXHRdLykubWFwKHM9PnMudHJpbSgpKTtpZihwLmxlbmd0aDw1KXJldHVybjtkYXRhW21vbnRoS2V5XS5tZXRhbHMucHVzaCh7bWV0YWxUeXBlOnBbMF0scHVyaXR5OnBbMV0sb2NjYXNpb246cFsyXSxpdGVtTmFtZTpwWzNdLHdlaWdodEdtczpwYXJzZUZsb2F0KHBbNF0pfHwwfSk7Y291bnQrKzt9KTtpZihjb3VudD4wKXtzYXZlKCk7cmVuZGVyRGF0YVNjcmVlbigpO3Nob3dUb2FzdChg4pyFIFBhcnNlZCAke2NvdW50fSByb3dzIWApO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLicpO30KZnVuY3Rpb24gcGFyc2VSZWFsRXN0YXRlUGFzdGUobW9udGhLZXksdGV4dCl7Y29uc3QgbGluZXM9dGV4dC50cmltKCkuc3BsaXQoJ1xuJyk7bGV0IGNvdW50PTA7bGluZXMuZm9yRWFjaChsaW5lPT57Y29uc3QgcD1saW5lLnNwbGl0KC9bLFx0XS8pLm1hcChzPT5zLnRyaW0oKSk7aWYocC5sZW5ndGg8NClyZXR1cm47Y29uc3QgZGF0ZT1ub3JtYWxpemVEYXRlKHBbMF0pO2NvbnN0IHRtPWdldE1vbnRoS2V5KGRhdGUpfHxtb250aEtleTtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnk6cFsxXSxjdXJyZW5jeTpwWzJdLHB1cmNoYXNlVmFsdWU6cGFyc2VGbG9hdChwWzNdKXx8MCxkZXNjcmlwdGlvbjpwWzRdLGFyZWFDZW50czpwYXJzZUZsb2F0KHBbNV0pfHwwLGN1cnJlbnRWYWx1ZTpwYXJzZUZsb2F0KHBbNl0pfHwwfSk7Y291bnQrKzt9KTtpZihjb3VudD4wKXtzYXZlKCk7cmVuZGVyRGF0YVNjcmVlbigpO3Nob3dUb2FzdChg4pyFIFBhcnNlZCAke2NvdW50fSByb3dzIWApO31lbHNlIHNob3dUb2FzdCgnQ291bGQgbm90IHBhcnNlLicpO30KCmZ1bmN0aW9uIGltcG9ydEZpbGUobW9udGhLZXksIHR5cGUpIHsKICBjb25zdCBmaT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZmlsZS0ke3R5cGV9YCk7IGlmKCFmaXx8IWZpLmZpbGVzWzBdKXtzaG93VG9hc3QoJ1NlbGVjdCBhIGZpbGUgZmlyc3QnKTtyZXR1cm47fQogIGNvbnN0IGZpbGU9ZmkuZmlsZXNbMF0sIHJlYWRlcj1uZXcgRmlsZVJlYWRlcigpOwogIHJlYWRlci5vbmxvYWQ9ZnVuY3Rpb24oZSl7CiAgICBpZihmaWxlLm5hbWUuZW5kc1dpdGgoJy5jc3YnKSl7UGFwYVBhcnNlLnBhcnNlKGUudGFyZ2V0LnJlc3VsdCx7aGVhZGVyOnRydWUsc2tpcEVtcHR5TGluZXM6dHJ1ZSxjb21wbGV0ZTpyPT5wcm9jZXNzSW1wb3J0Um93cyhyLmRhdGEsbW9udGhLZXksdHlwZSl9KTt9CiAgICBlbHNle2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoZS50YXJnZXQucmVzdWx0KTtjb25zdCB3Yj1YTFNYLnJlYWQoZCx7dHlwZTonYXJyYXknfSk7Y29uc3Qgd3M9d2IuU2hlZXRzW3diLlNoZWV0TmFtZXNbMF1dO3Byb2Nlc3NJbXBvcnRSb3dzKFhMU1gudXRpbHMuc2hlZXRfdG9fanNvbih3cyx7cmF3OmZhbHNlfSksbW9udGhLZXksdHlwZSk7fQogIH07CiAgaWYoZmlsZS5uYW1lLmVuZHNXaXRoKCcuY3N2JykpIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOyBlbHNlIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsKfQpmdW5jdGlvbiBwcm9jZXNzSW1wb3J0Um93cyhyb3dzLHNlbGVjdGVkTW9udGgsdHlwZSl7CiAgbGV0IGFkZGVkPTA7CiAgcm93cy5mb3JFYWNoKHI9PnsKICAgIGlmKHR5cGU9PT0nbWV0YWxzJyl7Y29uc3Qgdz1wYXJzZUZsb2F0KHIuV2VpZ2h0fHxyLndlaWdodHx8ci5XZWlnaHRHbXN8fHJbJ1dlaWdodCAoZ21zKSddfHwwKTtjb25zdCBpdGVtPXIuSXRlbXx8ci5pdGVtfHxyLkl0ZW1OYW1lfHxyWydJdGVtIE5hbWUnXTtpZih3JiZpdGVtKXtkYXRhW3NlbGVjdGVkTW9udGhdLm1ldGFscy5wdXNoKHttZXRhbFR5cGU6ci5NZXRhbHx8ci5tZXRhbHx8ci5NZXRhbFR5cGV8fCdHb2xkJyxwdXJpdHk6ci5QdXJpdHl8fHIucHVyaXR5fHwnJyxvY2Nhc2lvbjpyLk9jY2FzaW9ufHxyLm9jY2FzaW9ufHwnJyxpdGVtTmFtZTppdGVtLHdlaWdodEdtczp3fSk7YWRkZWQrKzt9cmV0dXJuO30KICAgIGlmKHR5cGU9PT0ncmVhbEVzdGF0ZScpe2NvbnN0IGRhdGU9bm9ybWFsaXplRGF0ZShyLkRhdGV8fHIuZGF0ZSk7Y29uc3QgdmFsPXBhcnNlRmxvYXQoU3RyaW5nKHIuUHVyY2hhc2VWYWx1ZXx8ci5QdXJjaGFzZXx8ci5wdXJjaGFzZVZhbHVlfHxyWydQdXJjaGFzZSBWYWx1ZSddfHwwKS5yZXBsYWNlKC9bXjAtOS4tXS9nLCcnKSk7aWYoZGF0ZSYmdmFsKXtjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8c2VsZWN0ZWRNb250aDtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV0ucmVhbEVzdGF0ZS5wdXNoKHtkYXRlLGNvdW50cnk6ci5Db3VudHJ5fHxyLmNvdW50cnl8fCdVUycsY3VycmVuY3k6ci5DdXJyZW5jeXx8ci5jdXJyZW5jeXx8J1VTRCcscHVyY2hhc2VWYWx1ZTp2YWwsZGVzY3JpcHRpb246ci5EZXNjcmlwdGlvbnx8JycsYXJlYUNlbnRzOnBhcnNlRmxvYXQoci5BcmVhfHxyLmFyZWF8fDApLGN1cnJlbnRWYWx1ZTpwYXJzZUZsb2F0KHIuQ3VycmVudFZhbHVlfHxyLmN1cnJlbnRWYWx1ZXx8MCl9KTthZGRlZCsrO31yZXR1cm47fQogICAgY29uc3QgZGF0ZVN0cj1yLkRhdGV8fHIuZGF0ZXx8ci5EQVRFO2NvbnN0IGFtdFN0cj1yLkFtb3VudHx8ci5hbW91bnR8fHIuRGViaXR8fHIuQ3JlZGl0OwogICAgaWYoZGF0ZVN0ciYmYW10U3RyKXtjb25zdCBkYXRlPW5vcm1hbGl6ZURhdGUoZGF0ZVN0cik7Y29uc3QgYW1vdW50PXBhcnNlRmxvYXQoU3RyaW5nKGFtdFN0cikucmVwbGFjZSgvW14wLTkuLV0vZywnJykpO2lmKGRhdGUmJiFpc05hTihhbW91bnQpKXtjb25zdCB0bT1nZXRNb250aEtleShkYXRlKXx8c2VsZWN0ZWRNb250aDtlbnN1cmVNb250aCh0bSk7ZGF0YVt0bV1bdHlwZV0ucHVzaCh7ZGF0ZSxjYXRlZ29yeTpyLkNhdGVnb3J5fHwnSW1wb3J0ZWQnLGFtb3VudCxkZXNjcmlwdGlvbjpyLkRlc2NyaXB0aW9ufHwnJ30pO2FkZGVkKys7fX0KICB9KTsKICBpZihhZGRlZD4wKXtzYXZlKCk7cG9wdWxhdGVEYXRhTW9udGhTZWxlY3QoKTtyZW5kZXJEYXRhU2NyZWVuKCk7c2hvd1RvYXN0KGDinIUgSW1wb3J0ZWQgJHthZGRlZH0gcm93cyFgKTt9ZWxzZSBzaG93VG9hc3QoJ05vIHZhbGlkIHJvd3MgZm91bmQuJyk7Cn0KCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBNRVRBTFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIGdldE1ldGFscygpIHsgaWYoIWRhdGEuX21ldGFscykgZGF0YS5fbWV0YWxzPVtdOyByZXR1cm4gZGF0YS5fbWV0YWxzOyB9CmZ1bmN0aW9uIHRvZ2dsZUFkZFBhbmVsKCkgeyBhZGRQYW5lbE9wZW49IWFkZFBhbmVsT3BlbjsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWFkZC1wYW5lbC1ib2R5JykuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicsYWRkUGFuZWxPcGVuKTsgY29uc3QgdD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXBhbmVsLXRvZ2dsZScpOyB0LnRleHRDb250ZW50PWFkZFBhbmVsT3Blbj8n4oiSJzonKyc7IHQuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicsYWRkUGFuZWxPcGVuKTsgfQpmdW5jdGlvbiBzaG93TWV0YWxQcmljZUVkaXQoKSB7CiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2Utb3ZlcnJpZGUtcGFuZWwnKTsKICBpZiAoIXBhbmVsKSByZXR1cm47CiAgY29uc3QgaXNWaXNpYmxlID0gcGFuZWwuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnOwogIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSBpc1Zpc2libGUgPyAnbm9uZScgOiAnJzsKICBpZiAoIWlzVmlzaWJsZSkgewogICAgY29uc3QgYmFzZSA9IGdldE1ldGFsQmFzZVByaWNlKGN1cnJlbnRNZXRhbCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2Utb3ZlcnJpZGUtaW5wdXQnKS52YWx1ZSA9IGJhc2UudG9GaXhlZCgyKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1vdmVycmlkZS1sYWJlbCcpLnRleHRDb250ZW50ID0KICAgICAgYFNldCBiYXNlIHByaWNlICgke2N1cnJlbnRNZXRhbCA9PT0gJ2dvbGQnID8gJzI0SyBwdXJlJyA6IGN1cnJlbnRNZXRhbCA9PT0gJ3NpbHZlcicgPyAnOTk5IEZpbmUnIDogJ1B0OTk5J30pICQvZ3JhbSBmb3IgJHtNRVRBTF9DT05GSUdbY3VycmVudE1ldGFsXS5sYWJlbH06YDsKICAgIHJlbmRlclB1cml0eVByaWNlcyhjdXJyZW50TWV0YWwpOwogIH0KfQoKZnVuY3Rpb24gYXBwbHlNZXRhbFByaWNlT3ZlcnJpZGUoKSB7CiAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1vdmVycmlkZS1pbnB1dCcpLnZhbHVlKTsKICBpZiAoIXByaWNlIHx8IHByaWNlIDw9IDApIHsgc2hvd1RvYXN0KCdFbnRlciBhIHZhbGlkIHByaWNlIOKdjCcpOyByZXR1cm47IH0KICB1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUoY3VycmVudE1ldGFsLCBwcmljZSk7IC8vIG5vIHB1cml0eSA9IHNldHMgYmFzZSBwcmljZQogIHJlbmRlclB1cml0eVByaWNlcyhjdXJyZW50TWV0YWwpOwp9CgpmdW5jdGlvbiByZW5kZXJQdXJpdHlQcmljZXMobWV0YWxUeXBlKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHVyaXR5LXByaWNlcycpOwogIGlmICghZWwpIHJldHVybjsKICBjb25zdCBiYXNlID0gZ2V0TWV0YWxCYXNlUHJpY2UobWV0YWxUeXBlKTsKICBjb25zdCBvdmVycmlkZXMgPSBkYXRhLl9tZXRhbFByaWNlT3ZlcnJpZGVzIHx8IHt9OwoKICBjb25zdCBwdXJpdGllcyA9IG1ldGFsVHlwZSA9PT0gJ2dvbGQnCiAgICA/IFtbJzI0SycsMS4wXSxbJzIySycsMC45MTY3XSxbJzIxSycsMC44NzVdLFsnMThLJywwLjc1XSxbJzE0SycsMC41ODMzXSxbJzEwSycsMC40MTY3XSxbJzlLJywwLjM3NV1dCiAgICA6IG1ldGFsVHlwZSA9PT0gJ3NpbHZlcicKICAgID8gW1snOTk5JywxLjBdLFsnOTk1JywwLjk5NV0sWyc5MjUnLDAuOTI1XSxbJzkwMCcsMC45XSxbJzg1MCcsMC44NV0sWyc4MDAnLDAuOF1dCiAgICA6IFtbJzk5OScsMS4wXSxbJ1B0OTUwJywwLjk1XSxbJ1B0OTAwJywwLjldLFsnUHQ4NTAnLDAuODVdXTsKCiAgY29uc3Qgcm93cyA9IHB1cml0aWVzLm1hcCgoW3AsIG11bHRdKSA9PiB7CiAgICBjb25zdCBwdXJpdHlLZXkgPSBtZXRhbFR5cGUgKyAnfCcgKyBub3JtYWxpemVQdXJpdHkocCk7CiAgICBjb25zdCBoYXNPdmVycmlkZSA9IG92ZXJyaWRlc1twdXJpdHlLZXldICE9PSB1bmRlZmluZWQ7CiAgICBjb25zdCBlZmZlY3RpdmVQcmljZSA9IGhhc092ZXJyaWRlID8gb3ZlcnJpZGVzW3B1cml0eUtleV0gOiAoYmFzZSAqIG11bHQpOwogICAgY29uc3Qgb3ZlcnJpZGVCYWRnZSA9IGhhc092ZXJyaWRlCiAgICAgID8gYDxzcGFuIHN0eWxlPSJjb2xvcjojMTBCOTgxO2ZvbnQtc2l6ZTowLjg1ZW07IiB0aXRsZT0iQ3VzdG9tIHByaWNlIHNldCI+4pyP77iPPC9zcGFuPmAKICAgICAgOiAnJzsKICAgIHJldHVybiBgPHRyIHN0eWxlPSJib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRjBGMEYwOyI+CiAgICAgIDx0ZCBzdHlsZT0icGFkZGlu','Zzo0cHggNnB4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO2ZvbnQtc2l6ZTowLjgyZW07Ij4ke3B9PC90ZD4KICAgICAgPHRkIHN0eWxlPSJwYWRkaW5nOjRweCA2cHg7Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTtmb250LXNpemU6MC43OGVtOyI+JHtoYXNPdmVycmlkZSA/ICcnIDogKG11bHQqMTAwKS50b0ZpeGVkKDEpKyclJ308L3RkPgogICAgICA8dGQgc3R5bGU9InBhZGRpbmc6NHB4IDZweDtmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Zm9udC1zaXplOjAuODhlbTsiPiQke2VmZmVjdGl2ZVByaWNlLnRvRml4ZWQoMil9L2cgJHtvdmVycmlkZUJhZGdlfTwvdGQ+CiAgICAgIDx0ZCBzdHlsZT0icGFkZGluZzo0cHggMnB4O3RleHQtYWxpZ246cmlnaHQ7Ij4KICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im9wZW5QdXJpdHlPdmVycmlkZSgnJHttZXRhbFR5cGV9JywnJHtwfScsJHtlZmZlY3RpdmVQcmljZX0pIgogICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtwYWRkaW5nOjJweCA3cHg7Zm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS1wcmltYXJ5KTtjdXJzb3I6cG9pbnRlcjsiPlNldDwvYnV0dG9uPgogICAgICAgICR7aGFzT3ZlcnJpZGUgPyBgPGJ1dHRvbiBvbmNsaWNrPSJ1cGRhdGVNZXRhbFByaWNlT3ZlcnJpZGUoJyR7bWV0YWxUeXBlfScsMCwnJHtwfScpIgogICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQ6I0ZGRjBGMDtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjVweDtwYWRkaW5nOjJweCA3cHg7Zm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjojRUY0NDQ0O2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjJweDsiPuKclTwvYnV0dG9uPmAgOiAnJ30KICAgICAgPC90ZD4KICAgIDwvdHI+YDsKICB9KS5qb2luKCcnKTsKCiAgZWwuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTttYXJnaW4tYm90dG9tOjVweDsiPvCfko4gUHJpY2UgYnkgUHVyaXR5IOKAlCB0YXAgPGI+U2V0PC9iPiB0byBvdmVycmlkZSBhbnkgcm93OjwvZGl2PgogICAgPHRhYmxlIHN0eWxlPSJ3aWR0aDoxMDAlO2JvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsiPiR7cm93c308L3RhYmxlPgogICAgPGRpdiBpZD0icHVyaXR5LW92ZXJyaWRlLWlubGluZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjhweDtiYWNrZ3JvdW5kOndoaXRlO2JvcmRlcjoxLjVweCBzb2xpZCAjREREO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6OHB4IDEwcHg7Ij4KICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzVlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTttYXJnaW4tYm90dG9tOjVweDsiIGlkPSJwb2ktbGFiZWwiPlNldCBwcmljZSBmb3Ig4oCUPC9kaXY+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4O2FsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgIDxpbnB1dCB0eXBlPSJudW1iZXIiIGlkPSJwb2ktaW5wdXQiIHN0ZXA9IjAuMDEiIHBsYWNlaG9sZGVyPSIkL2dyYW0iCiAgICAgICAgICBzdHlsZT0iZmxleDoxO2JvcmRlcjoxLjVweCBzb2xpZCAjREREO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6NXB4IDhweDtmb250LXNpemU6MC45ZW07Zm9udC13ZWlnaHQ6NzAwOyI+CiAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJhcHBseVB1cml0eU92ZXJyaWRlKCkiCiAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDojMTBCOTgxO2NvbG9yOndoaXRlO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6N3B4O3BhZGRpbmc6NXB4IDEwcHg7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y3Vyc29yOnBvaW50ZXI7Ij7inJMgU2F2ZTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gb25jbGljaz0iZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3B1cml0eS1vdmVycmlkZS1pbmxpbmUnKS5zdHlsZS5kaXNwbGF5PSdub25lJyIKICAgICAgICAgIHN0eWxlPSJiYWNrZ3JvdW5kOiNFRUU7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo3cHg7cGFkZGluZzo1cHggMTBweDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODJlbTtjdXJzb3I6cG9pbnRlcjtjb2xvcjp2YXIoLS10ZXh0LW1lZCk7Ij7inJU8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj5gOwp9CgpsZXQgX3BvaU1ldGFsID0gJycsIF9wb2lQdXJpdHkgPSAnJzsKZnVuY3Rpb24gb3BlblB1cml0eU92ZXJyaWRlKG1ldGFsVHlwZSwgcHVyaXR5LCBjdXJyZW50UHJpY2UpIHsKICBfcG9pTWV0YWwgPSBtZXRhbFR5cGU7IF9wb2lQdXJpdHkgPSBwdXJpdHk7CiAgY29uc3QgcGFuZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHVyaXR5LW92ZXJyaWRlLWlubGluZScpOwogIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1sYWJlbCcpOwogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1pbnB1dCcpOwogIGlmICghcGFuZWwpIHJldHVybjsKICBpZiAobGFiZWwpIGxhYmVsLnRleHRDb250ZW50ID0gYFNldCAkL2dyYW0gZm9yICR7cHVyaXR5fSAke21ldGFsVHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSttZXRhbFR5cGUuc2xpY2UoMSl9OmA7CiAgaWYgKGlucHV0KSB7IGlucHV0LnZhbHVlID0gY3VycmVudFByaWNlLnRvRml4ZWQoMik7IGlucHV0LmZvY3VzKCk7IH0KICBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJyc7Cn0KZnVuY3Rpb24gYXBwbHlQdXJpdHlPdmVycmlkZSgpIHsKICBjb25zdCBwcmljZSA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvaS1pbnB1dCcpPy52YWx1ZSk7CiAgaWYgKCFwcmljZSB8fCBwcmljZSA8PSAwKSB7IHNob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCBwcmljZSDinYwnKTsgcmV0dXJuOyB9CiAgdXBkYXRlTWV0YWxQcmljZU92ZXJyaWRlKF9wb2lNZXRhbCwgcHJpY2UsIF9wb2lQdXJpdHkpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwdXJpdHktb3ZlcnJpZGUtaW5saW5lJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gc3dpdGNoTWV0YWwodHlwZSkgewogIGN1cnJlbnRNZXRhbD10eXBlOyBjb25zdCBjZmc9TUVUQUxfQ09ORklHW3R5cGVdOwogIFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJ10uZm9yRWFjaCh0PT5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluaS0nK3QpLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZS1tZXRhbCcsdD09PXR5cGUpKTsKICBjb25zdCBpdz1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZGV0YWlsLWljb24nKTsgaXcudGV4dENvbnRlbnQ9Y2ZnLmVtb2ppOyBpdy5jbGFzc05hbWU9J21ldGFsLWRldGFpbC1pY29uLXdyYXAgJyt0eXBlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kZXRhaWwtbmFtZScpLnRleHRDb250ZW50PWNmZy5sYWJlbDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZGV0YWlsLXVzZCcpLmNsYXNzTmFtZT0nbWV0YWwtZGV0YWlsLXVzZCAnK3R5cGU7CiAgY29uc3QgYmFzZVByaWNlID0gZ2V0TWV0YWxCYXNlUHJpY2UodHlwZSk7CiAgY29uc3QgaGFzT3ZlcnJpZGUgPSAoZGF0YS5fbWV0YWxQcmljZU92ZXJyaWRlc3x8e30pW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWxpdmUtcHJpY2UnKS50ZXh0Q29udGVudD0nJCcrYmFzZVByaWNlLnRvRml4ZWQoMikrKGhhc092ZXJyaWRlPycg4pyP77iPJzonJyk7CiAgY29uc3QgYmFzZUxhYmVsID0gdHlwZSA9PT0gJ2dvbGQnID8gJyQvZ3JhbSAoMjRLIHB1cmUpJyA6IHR5cGUgPT09ICdzaWx2ZXInID8gJyQvZ3JhbSAoOTk5IEZpbmUpJyA6ICckL2dyYW0gKFB0OTk5KSc7CiAgY29uc3QgYmFzZUxhYmVsRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtcHJpY2UtYmFzZS1sYWJlbCcpOwogIGlmIChiYXNlTGFiZWxFbCkgYmFzZUxhYmVsRWwudGV4dENvbnRlbnQgPSBiYXNlTGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWFkZC1pY29uJykudGV4dENvbnRlbnQ9Y2ZnLmVtb2ppOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1hZGQtbGFiZWwnKS50ZXh0Q29udGVudD1jZmcubGFiZWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXNhdmUtYnRuJykudGV4dENvbnRlbnQ9JysgQWRkICcrY2ZnLmxhYmVsKycgRW50cnknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1zYXZlLWJ0bicpLmNsYXNzTmFtZT0nbWV0YWwtc2F2ZS1idG4gJyt0eXBlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wcmljZS1oaW50JykudGV4dENvbnRlbnQ9J/CfkqEgJytjZmcuaGludDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9sZGluZ3MtbGlzdC10aXRsZScpLnRleHRDb250ZW50PWNmZy5lbW9qaSsnICcrY2ZnLmxhYmVsKycgSG9sZGluZ3MnOwogIC8vIENsb3NlIHByaWNlIHBhbmVsIHdoZW4gc3dpdGNoaW5nIG1ldGFscwogIGNvbnN0IHBhbmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXByaWNlLW92ZXJyaWRlLXBhbmVsJyk7CiAgaWYgKHBhbmVsKSBwYW5lbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIHJlbmRlck1ldGFscygpOwp9CmZ1bmN0aW9uIHJlbmRlck1ldGFscygpIHsKICBjb25zdCBtZXRhbHM9Z2V0TWV0YWxzKCksIGNmZz1NRVRBTF9DT05GSUc7CiAgY29uc3QgdG90YWxzPXt9OwogIC8vIEFsc28gZm9sZCBpbiBOVy1zaGVldCBtZXRhbCBhY2NvdW50cyBzbyBtaW5pLXRpbGVzIHNob3cgY29tYmluZWQgdG90YWxzCiAgY29uc3QgbndNZXRhbEFjY291bnRzID0gKGRhdGEuX253QWNjb3VudHN8fFtdKS5maWx0ZXIoYT0+YS50eXBlPT09J21ldGFscycpOwogIE9iamVjdC5rZXlzKGNmZykuZm9yRWFjaCh0PT57CiAgICBjb25zdCBlbnRyaWVzPW1ldGFscy5maWx0ZXIobT0+bS5tZXRhbFR5cGU9PT10KTsKICAgIGNvbnN0IGdyYW1zPWVudHJpZXMucmVkdWNlKChzLG0pPT5zK051bWJlcihtLmdyYW1zfHxtLndlaWdodEdtc3x8MCksMCk7CiAgICBjb25zdCB1c2Q9ZW50cmllcy5yZWR1Y2UoKHMsbSk9PnsKICAgICAgY29uc3QgZz1OdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgICAvLyBBbHdheXMgdXNlIGxpdmUgcHJpY2UgKG5vdCBzdG9yZWQgcHVyY2hhc2UgcHJpY2UpIHNvIHRvdGFsIG1hdGNoZXMgTmV0V29ydGgKICAgICAgY29uc3QgcHJpY2U9Z2V0UHJpY2VGb3JNZXRhbCh0LCBtLnB1cml0eSk7CiAgICAgIHJldHVybiBzK2cqcHJpY2U7CiAgICB9LDApOwogICAgLy8gQWRkIE5XIG1hbnVhbCBhY2NvdW50cyBmb3IgdGhpcyBtZXRhbCB0eXBlCiAgICBjb25zdCBud0VudHJpZXM9bndNZXRhbEFjY291bnRzLmZpbHRlcihhPT5hLm1ldGEmJmEubWV0YS5tZXRhbFR5cGU9PT10KTsKICAgIGNvbnN0IG53R3JhbXM9bndFbnRyaWVzLnJlZHVjZSgocyxhKT0+cytOdW1iZXIoYS5tZXRhLmdyYW1zfHwwKSwwKTsKICAgIGNvbnN0IG53VXNkPW53RW50cmllcy5yZWR1Y2UoKHMsYSk9PnsKICAgICAgY29uc3QgZz1OdW1iZXIoYS5tZXRhJiZhLm1ldGEuZ3JhbXN8fDApOwogICAgICBjb25zdCBwdXJpdHk9YS5tZXRhJiZhLm1ldGEucHVyaXR5fHwnJzsKICAgICAgLy8gQWx3YXlzIHJlY29tcHV0ZSBmcm9tIGdyYW1zIMOXIGxpdmUgcHJpY2Ugc28gTWV0YWxzIHBhZ2Ugc3RheXMgaW4gc3luYyB3aXRoIE5ldFdvcnRoCiAgICAgIHJldHVybiBzICsgZyAqIGdldFByaWNlRm9yTWV0YWwodCwgcHVyaXR5KTsKICAgIH0sMCk7CiAgICB0b3RhbHNbdF09e2VudHJpZXMsZ3JhbXM6Z3JhbXMrbndHcmFtcyx1c2Q6dXNkK253VXNkLGF2Z0Nvc3Q6KGdyYW1zK253R3JhbXMpPjA/KHVzZCtu','d1VzZCkvKGdyYW1zK253R3JhbXMpOjB9OwogIH0pOwogIGNvbnN0IGdyYW5kVG90YWw9T2JqZWN0LnZhbHVlcyh0b3RhbHMpLnJlZHVjZSgocyx0KT0+cyt0LnVzZCwwKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWxzLWdyYW5kLXRvdGFsJykudGV4dENvbnRlbnQ9Zm10KGdyYW5kVG90YWwpOwogIE9iamVjdC5rZXlzKGNmZykuZm9yRWFjaCh0PT57ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbmktJyt0KyctZ3JhbXMnKS50ZXh0Q29udGVudD10b3RhbHNbdF0uZ3JhbXMudG9GaXhlZCgyKSsnIGcnO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW5pLScrdCsnLXVzZCcpLnRleHRDb250ZW50PWZtdCh0b3RhbHNbdF0udXNkKTt9KTsKICBjb25zdCBhY3RpdmU9dG90YWxzW2N1cnJlbnRNZXRhbF0sIGFjPWNmZ1tjdXJyZW50TWV0YWxdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kZXRhaWwtZ3JhbXMnKS50ZXh0Q29udGVudD1hY3RpdmUuZ3JhbXMudG9GaXhlZCgzKSsnIGcgwrcgJysoYWN0aXZlLmdyYW1zLzMxLjEwMzUpLnRvRml4ZWQoMykrJyBveic7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWRldGFpbC11c2QnKS50ZXh0Q29udGVudD1mbXQoYWN0aXZlLnVzZCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXN0YXQtZW50cmllcycpLnRleHRDb250ZW50PWFjdGl2ZS5lbnRyaWVzLmxlbmd0aDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtc3RhdC1veicpLnRleHRDb250ZW50PShhY3RpdmUuZ3JhbXMvMzEuMTAzNSkudG9GaXhlZCgzKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtc3RhdC1hdmcnKS50ZXh0Q29udGVudD1hY3RpdmUuYXZnQ29zdD4wPyckJythY3RpdmUuYXZnQ29zdC50b0ZpeGVkKDIpOickMCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvbGRpbmdzLWxpc3QtY291bnQnKS50ZXh0Q29udGVudD1hY3RpdmUuZW50cmllcy5sZW5ndGgrKGFjdGl2ZS5lbnRyaWVzLmxlbmd0aD09PTE/JyBlbnRyeSc6JyBlbnRyaWVzJyk7CiAgY29uc3QgaGw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFscy1ob2xkaW5ncy1saXN0Jyk7CiAgaWYoYWN0aXZlLmVudHJpZXMubGVuZ3RoPT09MCl7aGwuaW5uZXJIVE1MPWA8ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eSI+PGRpdiBjbGFzcz0ibWV0YWwtZW1wdHktaWNvbiI+JHthYy5lbW9qaX08L2Rpdj48ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eS10ZXh0Ij5ObyAke2FjLmxhYmVsLnRvTG93ZXJDYXNlKCl9IGVudHJpZXMgeWV0Ljxicj5UYXAgKyBhYm92ZSB0byBhZGQgb25lLjwvZGl2PjwvZGl2PmA7cmV0dXJuO30KICAvLyBDb21iaW5lIF9tZXRhbHMgKyBOVyBhY2NvdW50cyBmb3IgdGhpcyBtZXRhbCB0eXBlCiAgY29uc3QgbndNZXRhbEZvclR5cGUgPSAoZGF0YS5fbndBY2NvdW50c3x8W10pLmZpbHRlcihhPT5hLnR5cGU9PT0nbWV0YWxzJyYmYS5tZXRhJiZhLm1ldGEubWV0YWxUeXBlPT09Y3VycmVudE1ldGFsKTsKICBjb25zdCBhbGxFbnRyaWVzID0gWwogICAgLi4uYWN0aXZlLmVudHJpZXMubWFwKG0gPT4gKHsgLi4ubSwgX3NvdXJjZTogJ3BvcnRmb2xpbycgfSkpLAogICAgLi4ubndNZXRhbEZvclR5cGUubWFwKGEgPT4gKHsKICAgICAgbmFtZTogYS5uYW1lLCBncmFtczogTnVtYmVyKGEubWV0YS5ncmFtc3x8MCksIHByaWNlOiAwLAogICAgICBwdXJpdHk6IGEubWV0YS5wdXJpdHl8fCcnLCBvY2Nhc2lvbjogYS5tZXRhLm9jY2FzaW9ufHwnJywgZm9ybTogYS5tZXRhLmZvcm18fCcnLAogICAgICBkYXRlOiBhLmxhc3RVcGRhdGVkfHwnJywgbm90ZXM6IGEubWV0YS5ub3Rlc3x8JycsIF9zb3VyY2U6ICduZXR3b3J0aCcsIF9ud0lkOiBhLmlkCiAgICB9KSkKICBdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdob2xkaW5ncy1saXN0LWNvdW50JykudGV4dENvbnRlbnQgPSBhbGxFbnRyaWVzLmxlbmd0aCArIChhbGxFbnRyaWVzLmxlbmd0aD09PTE/JyBlbnRyeSc6JyBlbnRyaWVzJyk7CiAgaWYoYWxsRW50cmllcy5sZW5ndGg9PT0wKXtobC5pbm5lckhUTUw9YDxkaXYgY2xhc3M9Im1ldGFsLWVtcHR5Ij48ZGl2IGNsYXNzPSJtZXRhbC1lbXB0eS1pY29uIj4ke2FjLmVtb2ppfTwvZGl2PjxkaXYgY2xhc3M9Im1ldGFsLWVtcHR5LXRleHQiPk5vICR7YWMubGFiZWwudG9Mb3dlckNhc2UoKX0gZW50cmllcyB5ZXQuPGJyPlRhcCArIGFib3ZlIHRvIGFkZCBvbmUuPC9kaXY+PC9kaXY+YDtyZXR1cm47fQogIGhsLmlubmVySFRNTD1hbGxFbnRyaWVzLm1hcCgobSxpZHgpPT57CiAgICBjb25zdCBncmFtcz1OdW1iZXIobS5ncmFtc3x8bS53ZWlnaHRHbXN8fDApOwogICAgY29uc3QgcHVyaXR5ID0gbS5wdXJpdHl8fCcnOwogICAgLy8gQWx3YXlzIHNob3cgbGl2ZSBwcmljZSBwZXIgZ3JhbSAocHVyY2hhc2UgcHJpY2Ugc2hvd24gc2VwYXJhdGVseSBhcyBhdmcgY29zdCkKICAgIGNvbnN0IHByaWNlID0gZ2V0UHJpY2VGb3JNZXRhbChjdXJyZW50TWV0YWwsIHB1cml0eSk7CiAgICBjb25zdCB1c2RWYWw9Z3JhbXMqcHJpY2U7CiAgICBjb25zdCBvej0oZ3JhbXMvMzEuMTAzNSkudG9GaXhlZCgzKTsKICAgIGNvbnN0IHB1cml0eVRhZyA9IHB1cml0eSA/IGA8c3BhbiBzdHlsZT0iYmFja2dyb3VuZDojRjVGNUY1O2JvcmRlci1yYWRpdXM6NXB4O3BhZGRpbmc6MXB4IDZweDtmb250LXNpemU6MC43NWVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjojN0MzQUVEOyI+JHtwdXJpdHl9PC9zcGFuPmAgOiAnJzsKICAgIGNvbnN0IHByaWNlVGFnID0gYDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC43NWVtOyI+JCR7cHJpY2UudG9GaXhlZCgyKX0vZzwvc3Bhbj5gOwogICAgY29uc3Qgc291cmNlVGFnID0gbS5fc291cmNlPT09J25ldHdvcnRoJyA/IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+IMK3IPCfk4ogTlc8L3NwYW4+YCA6ICcnOwogICAgY29uc3QgZGVsQnRuID0gbS5fc291cmNlPT09J25ldHdvcnRoJwogICAgICA/IGA8YnV0dG9uIGNsYXNzPSJtZXRhbC1ob2xkaW5nLWRlbCIgb25jbGljaz0ibmF2aWdhdGVUbygnbmV0d29ydGgnKSIgdGl0bGU9IkVkaXQgaW4gTmV0IFdvcnRoIj7ihpfvuI88L2J1dHRvbj5gCiAgICAgIDogYDxidXR0b24gY2xhc3M9Im1ldGFsLWhvbGRpbmctZGVsIiBvbmNsaWNrPSJkZWxldGVNZXRhbEVudHJ5KCR7bWV0YWxzLmluZGV4T2YobSl9KSI+4pyVPC9idXR0b24+YDsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy1pdGVtIj4KICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy1iYWRnZSAke2N1cnJlbnRNZXRhbH0iPiR7YWMuZW1vaml9PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctbWFpbiI+CiAgICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy10b3AiPgogICAgICAgICAgPHNwYW4gY2xhc3M9Im1ldGFsLWhvbGRpbmctbmFtZS10ZXh0Ij4ke20ubmFtZXx8bS5pdGVtTmFtZXx8J1VubmFtZWQnfTwvc3Bhbj4KICAgICAgICAgICR7cHVyaXR5VGFnfQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctYm90dG9tIj4ke2dyYW1zLnRvRml4ZWQoMil9ZyDCtyAke296fW96ICR7cHJpY2VUYWd9JHttLm9jY2FzaW9uPycgwrcgJyttLm9jY2FzaW9uOicnfSR7bS5ub3Rlcz8nIMK3ICcrbS5ub3RlczonJ30ke3NvdXJjZVRhZ308L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctcmlnaHQiPgogICAgICAgIDxkaXYgY2xhc3M9Im1ldGFsLWhvbGRpbmctdmFsdWUiPiR7Zm10KHVzZFZhbCl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibWV0YWwtaG9sZGluZy13ZWlnaHQiPiR7Z3JhbXMudG9GaXhlZCgyKX0gZzwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgJHtkZWxCdG59CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwp9CmZ1bmN0aW9uIGFkZE1ldGFsRW50cnkoKSB7CiAgY29uc3QgbmFtZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtbmFtZScpLnZhbHVlLnRyaW0oKSwgZ3JhbXM9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtZ3JhbXMnKS52YWx1ZSksIHByaWNlPXBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLXByaWNlJykudmFsdWUpfHwwLCBkYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1kYXRlJykudmFsdWV8fG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLCBmb3JtPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1mb3JtJykudmFsdWUsIG5vdGVzPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1ub3RlcycpLnZhbHVlLnRyaW0oKSwgcHVyaXR5PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1wdXJpdHknKS52YWx1ZS50cmltKCksIG9jY2FzaW9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXRhbC1vY2Nhc2lvbicpLnZhbHVlLnRyaW0oKTsKICBpZighbmFtZSl7c2hvd1RvYXN0KCdFbnRlciBhIHNvdXJjZS9uYW1lIOKdjCcpO3JldHVybjt9IGlmKCFncmFtc3x8Z3JhbXM8PTApe3Nob3dUb2FzdCgnRW50ZXIgYSB2YWxpZCB3ZWlnaHQg4p2MJyk7cmV0dXJuO30KICBnZXRNZXRhbHMoKS5wdXNoKHttZXRhbFR5cGU6Y3VycmVudE1ldGFsLG5hbWUsZ3JhbXMscHJpY2U6cHJpY2V8fE1FVEFMX0NPTkZJR1tjdXJyZW50TWV0YWxdLnByaWNlUGVyR3JhbSxkYXRlLGZvcm0sbm90ZXMscHVyaXR5LG9jY2FzaW9ufSk7CiAgc2F2ZSgpOyByZW5kZXJNZXRhbHMoKTsKICBbJ25hbWUnLCdncmFtcycsJ3ByaWNlJywnbm90ZXMnLCdwdXJpdHknLCdvY2Nhc2lvbiddLmZvckVhY2goaWQ9Pnt0cnl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLScraWQpLnZhbHVlPScnO31jYXRjaChlKXt9fSk7CiAgYWRkUGFuZWxPcGVuPWZhbHNlOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YWwtYWRkLXBhbmVsLWJvZHknKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcGFuZWwtdG9nZ2xlJykudGV4dENvbnRlbnQ9JysnOwogIHNob3dUb2FzdChNRVRBTF9DT05GSUdbY3VycmVudE1ldGFsXS5lbW9qaSsnICcrTUVUQUxfQ09ORklHW2N1cnJlbnRNZXRhbF0ubGFiZWwrJyBlbnRyeSBhZGRlZCEnKTsKfQpmdW5jdGlvbiBkZWxldGVNZXRhbEVudHJ5KGlkeCkgeyBpZighY29uZmlybSgnRGVsZXRlIHRoaXMgZW50cnk/JykpIHJldHVybjsgZGF0YS5fbWV0YWxzLnNwbGljZShpZHgsMSk7IHNhdmUoKTsgcmVuZGVyTWV0YWxzKCk7IHNob3dUb2FzdCgnRW50cnkgZGVsZXRlZCcpOyB9CgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gSU5WRVNUTUVOVFMKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIGdldEludmVzdG1lbnRzKCkgeyBpZighZGF0YS5faW52ZXN0bWVudHMpIGRhdGEuX2ludmVzdG1lbnRzPVtdOyByZXR1cm4gZGF0YS5faW52ZXN0bWVudHM7IH0KZnVuY3Rpb24gZmlsdGVySW52ZXN0KGNhdCxidG4pIHsgY3VycmVudEludmVzdEZpbHRlcj1jYXQ7IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnZlc3QtY2F0LXRhYicpLmZvckVhY2goYj0+Yi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7IGJ0','bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgcmVuZGVySW52ZXN0bWVudHMoKTsgfQpmdW5jdGlvbiByZW5kZXJJbnZlc3RtZW50cygpIHsKICBjb25zdCBpbnZlc3RtZW50cz1nZXRJbnZlc3RtZW50cygpOwogIGxldCB0b3RhbENvc3Q9MCwgdG90YWxWYWx1ZT0wOwogIGludmVzdG1lbnRzLmZvckVhY2goaW52PT57dG90YWxDb3N0Kz1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5jb3N0fHwwKTt0b3RhbFZhbHVlKz1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5wcmljZXx8aW52LmNvc3R8fDApO30pOwogIGNvbnN0IHRvdGFsR2Fpbj10b3RhbFZhbHVlLXRvdGFsQ29zdCwgdG90YWxQY3Q9dG90YWxDb3N0PjA/dG90YWxHYWluL3RvdGFsQ29zdCoxMDA6MDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52ZXN0LXRvdGFsLXZhbHVlJykudGV4dENvbnRlbnQ9Zm10KHRvdGFsVmFsdWUpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtY29zdCcpLnRleHRDb250ZW50PWZtdCh0b3RhbENvc3QpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtZ2FpbicpLnRleHRDb250ZW50PSh0b3RhbEdhaW4+PTA/JysnOictJykrZm10KE1hdGguYWJzKHRvdGFsR2FpbikpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtdG90YWwtcGN0JykudGV4dENvbnRlbnQ9KHRvdGFsUGN0Pj0wPycrJzonJykrdG90YWxQY3QudG9GaXhlZCgxKSsnJSc7CiAgY29uc3QgZmlsdGVyZWQ9Y3VycmVudEludmVzdEZpbHRlcj09PSdBbGwnP2ludmVzdG1lbnRzOmludmVzdG1lbnRzLmZpbHRlcihpbnY9Pmludi5jYXRlZ29yeT09PWN1cnJlbnRJbnZlc3RGaWx0ZXIpOwogIGNvbnN0IGhsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnZlc3QtaG9sZGluZ3MtbGlzdCcpOwogIGlmKGZpbHRlcmVkLmxlbmd0aD09PTApe2hsLmlubmVySFRNTD1gPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2JhY2tncm91bmQ6dmFyKC0td2hpdGUpO2JvcmRlci1yYWRpdXM6dmFyKC0tcmFkaXVzKTtib3gtc2hhZG93OnZhcigtLWNhcmQtc2hhZG93KTsiPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZToyLjVlbTttYXJnaW4tYm90dG9tOjhweDsiPvCfk4o8L2Rpdj48ZGl2IHN0eWxlPSJmb250LXdlaWdodDo3MDA7Ij5ObyBpbnZlc3RtZW50cyR7Y3VycmVudEludmVzdEZpbHRlciE9PSdBbGwnPycgaW4gJytjdXJyZW50SW52ZXN0RmlsdGVyOicnfSB5ZXQ8L2Rpdj48L2Rpdj5gO3JldHVybjt9CiAgY29uc3QgY2F0Q29sb3JzPXtTdG9ja3M6JyM0QTlFRkYnLEVURjonIzEwQjk4MScsQ3J5cHRvOicjRjU5RTBCJyxSZXRpcmVtZW50OicjN0MzQUVEJywnUmVhbCBFc3RhdGUnOicjRkY2QjM1JyxPdGhlcjonIzlBQTBCMid9OwogIGhsLmlubmVySFRNTD1maWx0ZXJlZC5tYXAoaW52PT57Y29uc3QgcmVhbElkeD1pbnZlc3RtZW50cy5pbmRleE9mKGludik7Y29uc3QgY29zdD1OdW1iZXIoaW52LnNoYXJlc3x8MCkqTnVtYmVyKGludi5jb3N0fHwwKTtjb25zdCB2YWw9TnVtYmVyKGludi5zaGFyZXN8fDApKk51bWJlcihpbnYucHJpY2V8fGludi5jb3N0fHwwKTtjb25zdCBnYWluPXZhbC1jb3N0O2NvbnN0IHBjdD1jb3N0PjA/Z2Fpbi9jb3N0KjEwMDowO2NvbnN0IGNvbG9yPWNhdENvbG9yc1tpbnYuY2F0ZWdvcnldfHwnIzlBQTBCMic7cmV0dXJuYDxkaXYgY2xhc3M9ImludmVzdC1ob2xkaW5nLXJvdyI+PGRpdiBjbGFzcz0iaW52ZXN0LXRpY2tlci1iYWRnZSIgc3R5bGU9ImJhY2tncm91bmQ6JHtjb2xvcn0xODtjb2xvcjoke2NvbG9yfTsiPiR7KGludi50aWNrZXJ8fCc/JykudG9VcHBlckNhc2UoKX08L2Rpdj48ZGl2IGNsYXNzPSJpbnZlc3QtaW5mbyI+PGRpdiBjbGFzcz0iaW52ZXN0LW5hbWUiPiR7aW52LnRpY2tlcnx8J0ludmVzdG1lbnQnfTwvZGl2PjxkaXYgY2xhc3M9ImludmVzdC1kZXRhaWwiPiR7aW52LnNoYXJlc30gc2hhcmVzIMK3ICR7aW52LmJyb2tlcnx8Jyd9IMK3ICR7aW52LmNhdGVnb3J5fHwnJ308L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJpbnZlc3QtdmFsdWVzIj48ZGl2IGNsYXNzPSJpbnZlc3QtdmFsdWUiPiR7Zm10KHZhbCl9PC9kaXY+PGRpdiBjbGFzcz0iaW52ZXN0LWdhaW4gJHtnYWluPj0wPyd1cCc6J2Rvd24nfSI+JHtnYWluPj0wPycrJzonLSd9JHtmbXRGdWxsKE1hdGguYWJzKGdhaW4pKX0gKCR7cGN0LnRvRml4ZWQoMSl9JSk8L2Rpdj48L2Rpdj48YnV0dG9uIG9uY2xpY2s9ImRlbGV0ZUludmVzdEVudHJ5KCR7cmVhbElkeH0pIiBzdHlsZT0iYmFja2dyb3VuZDojRkZGMEYwO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6NnB4IDhweDtmb250LXNpemU6MC43NWVtO2NvbG9yOnZhcigtLWV4cGVuc2VzKTtjdXJzb3I6cG9pbnRlcjttYXJnaW4tbGVmdDo4cHg7Ij7inJU8L2J1dHRvbj48L2Rpdj5gO30pLmpvaW4oJycpOwp9CmZ1bmN0aW9uIGFkZEludmVzdEVudHJ5KCkgewogIGNvbnN0IHRpY2tlcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXRpY2tlcicpLnZhbHVlLnRyaW0oKS50b1VwcGVyQ2FzZSgpLCBjYXRlZ29yeT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWNhdCcpLnZhbHVlLCBzaGFyZXM9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXNoYXJlcycpLnZhbHVlKSwgY29zdD1wYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtY29zdCcpLnZhbHVlKSwgcHJpY2U9cGFyc2VGbG9hdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LXByaWNlJykudmFsdWUpfHxjb3N0LCBkYXRlPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtZGF0ZScpLnZhbHVlfHxuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSwgYnJva2VyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnYtYnJva2VyJykudmFsdWUudHJpbSgpOwogIGlmKCF0aWNrZXJ8fCFzaGFyZXN8fCFjb3N0KXtzaG93VG9hc3QoJ0ZpbGwgaW4gdGlja2VyLCBzaGFyZXMgJiBjb3N0IOKdjCcpO3JldHVybjt9CiAgY29uc3QgaW52ZXN0bWVudHM9Z2V0SW52ZXN0bWVudHMoKTsKICBjb25zdCBleGlzdGluZz1pbnZlc3RtZW50cy5maW5kKGludj0+aW52LnRpY2tlcj09PXRpY2tlciYmaW52LmNhdGVnb3J5PT09Y2F0ZWdvcnkpOwogIGlmKGV4aXN0aW5nKXtpZihjb25maXJtKGAke3RpY2tlcn0gYWxyZWFkeSBleGlzdHMuIEFkZCBtb3JlIHNoYXJlcz9gKSl7Y29uc3QgdHM9TnVtYmVyKGV4aXN0aW5nLnNoYXJlcykrc2hhcmVzO2V4aXN0aW5nLmNvc3Q9KChOdW1iZXIoZXhpc3RpbmcuY29zdCkqTnVtYmVyKGV4aXN0aW5nLnNoYXJlcykrY29zdCpzaGFyZXMpL3RzKS50b0ZpeGVkKDIpO2V4aXN0aW5nLnNoYXJlcz10cy50b0ZpeGVkKDQpO2lmKHByaWNlKSBleGlzdGluZy5wcmljZT1wcmljZS50b0ZpeGVkKDIpO31lbHNlIHJldHVybjt9CiAgZWxzZSBpbnZlc3RtZW50cy5wdXNoKHt0aWNrZXIsY2F0ZWdvcnksc2hhcmVzOnNoYXJlcy50b0ZpeGVkKDQpLGNvc3Q6Y29zdC50b0ZpeGVkKDIpLHByaWNlOnByaWNlLnRvRml4ZWQoMiksZGF0ZSxicm9rZXJ9KTsKICBzYXZlKCk7IHJlbmRlckludmVzdG1lbnRzKCk7CiAgWydpbnYtdGlja2VyJywnaW52LXNoYXJlcycsJ2ludi1jb3N0JywnaW52LXByaWNlJywnaW52LWJyb2tlciddLmZvckVhY2goaWQ9PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS52YWx1ZT0nJyk7CiAgc2hvd1RvYXN0KGDwn5OIICR7dGlja2VyfSBhZGRlZCB0byBwb3J0Zm9saW8hYCk7Cn0KZnVuY3Rpb24gZGVsZXRlSW52ZXN0RW50cnkoaWR4KSB7IGlmKCFjb25maXJtKCdSZW1vdmUgdGhpcyBpbnZlc3RtZW50PycpKSByZXR1cm47IGRhdGEuX2ludmVzdG1lbnRzLnNwbGljZShpZHgsMSk7IHNhdmUoKTsgcmVuZGVySW52ZXN0bWVudHMoKTsgc2hvd1RvYXN0KCdJbnZlc3RtZW50IHJlbW92ZWQnKTsgfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIFBJTiBMT0NLIOKAlCBDT01NRU5URUQgT1VUIChSRS1FTkFCTEUgTEFURVIpCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovKgo9PT0gUElOIExPQ0sgSkFWQVNDUklQVCDigJQgVW5jb21tZW50IHRoaXMgZW50aXJlIGJsb2NrIHRvIHJlLWVuYWJsZSA9PT0KPT09IEFsc28gdW5jb21tZW50OiBDU1MgYmxvY2ssIEhUTUwgbG9jayBzY3JlZW4gZGl2LCBpbml0TG9ja1NjcmVlbigpIGluIGluaXQgPT09Cgpjb25zdCBQSU5fS0VZID0gJ21mX3Bpbic7CmxldCBwaW5CdWZmZXIgPSAnJywgbG9ja01vZGUgPSAndW5sb2NrJywgc2V0dXBGaXJzdFBpbiA9ICcnLCBsb2NrQXR0ZW1wdHMgPSAwOwpjb25zdCBNQVhfQVRURU1QVFMgPSA1OwpsZXQgbG9ja291dFRpbWVySW50ZXJ2YWwgPSBudWxsOwoKZnVuY3Rpb24gZ2V0U3RvcmVkUElOKCl7IHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShQSU5fS0VZKXx8Jyc7IH0KZnVuY3Rpb24gaGFzUGluKCl7IHJldHVybiAhIWdldFN0b3JlZFBJTigpOyB9CgpmdW5jdGlvbiBpbml0TG9ja1NjcmVlbigpewogIGNvbnN0IGxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2stc2NyZWVuJyk7CiAgaWYoIWxzKSByZXR1cm47CiAgaWYoaGFzUGluKCkpewogICAgbG9ja01vZGUgPSAndW5sb2NrJzsKICAgIGxzLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgfSBlbHNlIHsKICAgIGxzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfQp9CgpmdW5jdGlvbiBwaW5QcmVzcyhkaWdpdCl7IC4uLiB9CmZ1bmN0aW9uIHBpbkRlbCgpeyAuLi4gfQpmdW5jdGlvbiBoYW5kbGVQaW5Db21wbGV0ZSgpeyAuLi4gfQpmdW5jdGlvbiB1bmxvY2tBcHAoKXsgLi4uIH0KZnVuY3Rpb24gaGlkZUxvY2tTY3JlZW4oKXsgLi4uIH0KZnVuY3Rpb24gaGFuZGxlUGluVG9nZ2xlKCl7IC4uLiB9CmZ1bmN0aW9uIG9wZW5Mb2NrRm9yU2V0dXAoKXsgLi4uIH0KZnVuY3Rpb24gc2hvd0NoYW5nZVBJTigpeyAuLi4gfQpmdW5jdGlvbiB1cGRhdGVTZXR0aW5nc1BpblVJKCl7IC4uLiB9Ci8vIChmaWxsIGluIHRoZSBmdWxsIGltcGxlbWVudGF0aW9ucyBmcm9tIHRoZSBvcmlnaW5hbCBjb2RlKQoKPT09IEVORCBQSU4gTE9DSyBKQVZBU0NSSVBUID09PQoqLwoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEJVREdFVCBNT0RVTEUKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBidWRnZXRWaWV3TW9udGggPSBnZXRDdXJyZW50TW9udGhLZXkoKTsKbGV0IGN1cnJlbnRCdWRnZXRUYWIgPSAnb3ZlcnZpZXcnOwpsZXQgY3VycmVudEJ1ZGdldENhdERldGFpbCA9IG51bGw7IC8vIHt0eXBlOidleHBlbnNlJ3wnc2F2aW5ncycsIGdvYWxLZXl9CmxldCBlZGl0aW5nQnVkZ2V0S2V5ID0gbnVsbDsgLy8gbnVsbCA9IG5ldywgc3RyaW5nID0gZXhpc3Rpbmcga2V5Cmxl','dCBlZGl0aW5nQnVkZ2V0VHlwZSA9ICdleHBlbnNlJzsKbGV0IHBpY2tlZEJ1ZGdldEVtb2ppID0gJ/CfkrgnOwoKY29uc3QgQlVER0VUX0VNT0pJUyA9IFsn8J+SuCcsJ/Cfm5InLCfwn5qXJywn8J+PoCcsJ/CfkoonLCfwn46tJywn8J+NlCcsJ+KYlScsJ/CfjpMnLCfwn5C+Jywn4pyI77iPJywn8J+RlycsJ/Cfjq4nLCfwn4+L77iPJywn8J+OgScsJ/Cfk7EnLCfimqEnLCfwn5qMJywn8J+SiCcsJ/CfjqonLCfwn4+lJywn8J+PpicsJ/CflKcnLCfwn4yuJywn8J+TmicsJ/CfkJ8nLCfwn4y/Jywn8J+SoScsJ/Cfjq8nLCfwn4+hJywn8J+lhycsJ/CfkrAnLCfwn5OIJywn8J+Pm++4jycsJ/CfjoknLCfwn42VJywn8J+MuicsJ/CfjIonLCfwn462Jywn8J+nmCddOwoKLy8gRGVmYXVsdCBidWRnZXRzIOKAlCBlbXB0eSBmb3IgbmV3IHVzZXJzLCB0aGV5IHNldCB1cCB0aGVpciBvd24KY29uc3QgREVGQVVMVF9FWFBFTlNFX0JVREdFVFMgPSBbXTsKY29uc3QgREVGQVVMVF9TQVZJTkdTX0JVREdFVFMgPSBbXTsKCmZ1bmN0aW9uIGdldEJ1ZGdldEdvYWxzKHR5cGUpIHsKICBjb25zdCBrZXkgPSB0eXBlID09PSAnc2F2aW5ncycgPyAnX3NhdmluZ3NHb2FscycgOiAnX2V4cGVuc2VHb2Fscyc7CiAgaWYgKCFkYXRhW2tleV0pIHsKICAgIGRhdGFba2V5XSA9IHR5cGUgPT09ICdzYXZpbmdzJyA/IERFRkFVTFRfU0FWSU5HU19CVURHRVRTLm1hcChnID0+ICh7Li4uZ30pKSA6IERFRkFVTFRfRVhQRU5TRV9CVURHRVRTLm1hcChnID0+ICh7Li4uZ30pKTsKICAgIHNhdmUoKTsKICB9CiAgcmV0dXJuIGRhdGFba2V5XTsKfQoKCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBHT0FMUyBNT0RVTEUgKEZlYXR1cmUgNCkKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmZ1bmN0aW9uIGdldEdvYWxzKCkgeyByZXR1cm4gZGF0YS5fZ29hbHMgfHwgW107IH0KZnVuY3Rpb24gc2F2ZUdvYWxzKGdvYWxzKSB7IGRhdGEuX2dvYWxzID0gZ29hbHM7IHNhdmUoKTsgfQoKZnVuY3Rpb24gb3BlbkdvYWxTaGVldChlZGl0SWQpIHsKICBjb25zdCBnb2FscyA9IGdldEdvYWxzKCk7CiAgY29uc3QgZyA9IGVkaXRJZCA/IGdvYWxzLmZpbmQoeCA9PiB4LmlkID09PSBlZGl0SWQpIDogbnVsbDsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWwtc2hlZXQtdGl0bGUnKS50ZXh0Q29udGVudCA9IGcgPyAn4pyP77iPIEVkaXQgR29hbCcgOiAn8J+OryBOZXcgR29hbCc7CiAgY29uc3Qgc2F2ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1zYXZlLWJ0bicpOwogIGlmIChzYXZlQnRuKSBzYXZlQnRuLnRleHRDb250ZW50ID0gZyA/ICfinI/vuI8gVXBkYXRlIEdvYWwnIDogJ/Cfjq8gQWRkIEdvYWwnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1uYW1lJykudmFsdWUgICAgPSBnID8gZy5uYW1lIDogJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWljb24nKS52YWx1ZSAgICA9IGcgPyAoZy5pY29ufHwn8J+OrycpIDogJ/Cfjq8nOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy10YXJnZXQnKS52YWx1ZSAgPSBnID8gZy50YXJnZXQgOiAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtdW5pdCcpLnZhbHVlICAgID0gZyA/IChnLnVuaXR8fCdjdXJyZW5jeScpIDogJ2N1cnJlbmN5JzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtY3VycmVuY3knKS52YWx1ZT0gZyA/IChnLmN1cnJlbmN5fHwnVVNEJykgOiAnVVNEJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZGF0ZScpLnZhbHVlICAgID0gZyA/IChnLnRhcmdldERhdGV8fCcnKSA6ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1kZXNjJykudmFsdWUgICAgPSBnID8gKGcuZGVzY3x8JycpIDogJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWVkaXRpbmctaWQnKS52YWx1ZSA9IGVkaXRJZCB8fCAnJzsKICBjb25zdCBnb2FsVHlwZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWdvYWx0eXBlJyk7CiAgaWYgKGdvYWxUeXBlRWwpIGdvYWxUeXBlRWwudmFsdWUgPSBnID8gKGcuZ29hbFR5cGV8fCdncm93JykgOiAnZ3Jvdyc7CiAgY29uc3Qgc3RhcnRCYWxFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1zdGFydGJhbCcpOwogIGlmIChzdGFydEJhbEVsKSBzdGFydEJhbEVsLnZhbHVlID0gZyA/IChnLnN0YXJ0QmFsYW5jZXx8JycpIDogJyc7CiAgdG9nZ2xlR29hbFR5cGVGaWVsZHMoKTsKCiAgLy8gQnVpbGQgYWNjb3VudCBwaWNrZXIgZnJvbSBOVyBhY2NvdW50cwogIGJ1aWxkR29hbEFjY291bnRQaWNrZXIoZyA/IChnLm1hcHBlZEFjY291bnRzfHxbXSkgOiBbXSk7CiAgLy8gUmVuZGVyIGljb24gcGlja2VyIHdpdGggY3VycmVudCBzZWxlY3Rpb24gaGlnaGxpZ2h0ZWQKICByZW5kZXJHb2FsSWNvblBpY2tlcihnID8gKGcuaWNvbnx8J/Cfjq8nKSA6ICfwn46vJyk7CiAgdXBkYXRlR29hbFByZXZpZXcoKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWwtc2hlZXQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1zaGVldC1vdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7Cn0KCmZ1bmN0aW9uIHRvZ2dsZUdvYWxUeXBlRmllbGRzKCkgewogIGNvbnN0IGdvYWxUeXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWdvYWx0eXBlJyk/LnZhbHVlIHx8ICdncm93JzsKICBjb25zdCBzdGFydEJhbFJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1zdGFydGJhbC1yb3cnKTsKICBpZiAoc3RhcnRCYWxSb3cpIHN0YXJ0QmFsUm93LnN0eWxlLmRpc3BsYXkgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScgPyAnJyA6ICdub25lJzsKICAvLyBGb3IgcmVkdWNlIGdvYWxzLCBzaG93IGxpYWJpbGl0eS1mcmllbmRseSBsYWJlbCBvbiBhY2NvdW50IHBpY2tlcgogIGNvbnN0IHBpY2tlckxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXBpY2tlci1sYWJlbCcpOwogIGlmIChwaWNrZXJMYWJlbCkgewogICAgcGlja2VyTGFiZWwudGV4dENvbnRlbnQgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScKICAgICAgPyAnTWFwIExpYWJpbGl0eSBBY2NvdW50cyB0byB0cmFjayByZWR1Y3Rpb24gcHJvZ3Jlc3MnCiAgICAgIDogJ01hcCBOVyBBY2NvdW50cyB0byB0aGlzIEdvYWwnOwogIH0KICBjb25zdCBwaWNrZXJIaW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXBpY2tlci1oaW50Jyk7CiAgaWYgKHBpY2tlckhpbnQpIHsKICAgIHBpY2tlckhpbnQudGV4dENvbnRlbnQgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScKICAgICAgPyAnU2VsZWN0IGxvYW4vY3JlZGl0IGNhcmQgYWNjb3VudHMuIFByb2dyZXNzIHRyYWNrcyBhcyB0aGUgYmFsYW5jZSBnb2VzIGRvd24uJwogICAgICA6ICdTZWFyY2ggYW5kIHNlbGVjdCBhY2NvdW50cyDigJQgZ3JvdXBlZCBieSB0eXBlLiBDb21iaW5lZCB2YWx1ZSBjb3VudHMgYXMgY3VycmVudCBwcm9ncmVzcy4nOwogIH0KICB1cGRhdGVHb2FsUHJldmlldygpOwp9CgpmdW5jdGlvbiBjbG9zZUdvYWxTaGVldCgpIHsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbC1zaGVldCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWwtc2hlZXQtb3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cn0KCmZ1bmN0aW9uIGNsb3NlR29hbHNQYW5lbEJhY2soKSB7CiAgLy8gR28gYmFjayB0byBidWRnZXQgb3ZlcnZpZXcKICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGlzdC1nb2FscycpOwogIGNvbnN0IGZhYiAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvYWxzLWZhYi1idG4nKTsKICBpZiAocGFuZWwpIHBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgaWYgKGZhYikgICBmYWIuc3R5bGUuZGlzcGxheSAgID0gJ25vbmUnOwogIHNldEJ1ZGdldFRhYignb3ZlcnZpZXcnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRhYi1vdmVydmlldycpKTsKfQoKLy8g4pSA4pSAIEhvbGRzIHRoZSBmdWxsIGFjY291bnQgbGlzdCBzbyBmaWx0ZXIgY2FuIHJlLXJlbmRlciB3aXRob3V0IHJlY29tcHV0aW5nCmxldCBfZ2FwQWxsR3JvdXBzID0gW107CmxldCBfZ2FwU2VsZWN0ZWRJZHMgPSBuZXcgU2V0KCk7CgovLyDilIDilIAgR29hbHMgcGFuZWwgdGFiIHN0YXRlIOKUgOKUgApsZXQgZ29hbHNUYWIgPSAnYWN0aXZlJzsgLy8gJ2FjdGl2ZScgfCAnYWNoaWV2ZWQnCgpjb25zdCBHT0FMX0VNT0pJUyA9IFsKICAn8J+OrycsJ/Cfj4YnLCfwn4+FJywn8J+SsCcsJ/Cfj6AnLCfwn5qXJywn8J+OkycsJ+KciO+4jycsJ/CfkajigI3wn5Gp4oCN8J+Rp+KAjfCfkaYnLCfwn4+W77iPJywKICAn8J+SjicsJ/CfpYcnLCfwn5OIJywn8J+Pm++4jycsJ/Cfm6HvuI8nLCfwn4yNJywn8J+nkycsJ/CfkoonLCfwn46JJywn8J+UkScsCiAgJ/Cfj5fvuI8nLCfwn4yxJywn4pqhJywn8J+TsScsJ/Cfj4vvuI8nLCfwn46oJywn8J+aoicsJ/CfjLonLCfwn462Jywn8J+QvicsCl07CgpmdW5jdGlvbiByZW5kZXJHb2FsSWNvblBpY2tlcihjdXJyZW50SWNvbikgewogIGNvbnN0IGdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtaWNvbi1ncmlkJyk7CiAgaWYgKCFncmlkKSByZXR1cm47CiAgY29uc3QgcGlja2VkID0gY3VycmVudEljb24gfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWljb24nKT8udmFsdWUgfHwgJ/Cfjq8nOwogIGdyaWQuaW5uZXJIVE1MID0gR09BTF9FTU9KSVMubWFwKGUgPT4KICAgIGA8ZGl2IG9uY2xpY2s9InBpY2tHb2FsSWNvbignJHtlfScpIgogICAgICBzdHlsZT0id2lkdGg6MzhweDtoZWlnaHQ6MzhweDtib3JkZXItcmFkaXVzOjEwcHg7Ym9yZGVyOjJweCBzb2xpZCAke2U9PT1waWNrZWQ/J3ZhcigtLXllbGxvdyknOid0cmFuc3BhcmVudCd9OwogICAgICAgICAgICAgYmFja2dyb3VuZDoke2U9PT1waWNrZWQ/J3ZhcigtLXllbGxvdy1saWdodCknOid2YXIoLS1iZyknfTsKICAgICAgICAgICAgIGRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtmb250LXNpemU6MS4yZW07Y3Vyc29yOnBvaW50ZXI7dHJhbnNpdGlvbjphbGwgMC4xNXM7IgogICAgICBpZD0iZ3MtaWNvbi1vcHQtJHtlLmNvZGVQb2ludEF0KDApfSI+JHtlfTwvZGl2PmAKICApLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBwaWNrR29hbEljb24oZSkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1pY29uJykudmFsdWUgPSBlOwogIHJlbmRlckdvYWxJY29uUGlja2VyKGUpOwp9CgpmdW5jdGlvbiBzZXRHb2Fsc1RhYih0YWIpIHsKICBnb2Fsc1RhYiA9IHRhYjsKICBjb25zdCBhY3RpdmVCdG4gICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndGFiLWFjdGl2ZScpOwogIGNvbnN0IGFjaGlldmVkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0YWItYWNoaWV2ZWQnKTsKICBpZiAoYWN0aXZlQnRuKSB7CiAgICBhY3RpdmVCdG4uc3R5bGUuYmFja2dyb3VuZCAgID0gdGFiID09PSAnYWN0aXZlJyAgID8gJ3ZhcigtLXllbGxvdyknIDogJyNGMEYwRjAnOwogICAgYWN0aXZlQnRuLnN0eWxlLmNvbG9yICAgICAgICA9IHRhYiA9PT0gJ2FjdGl2ZScgICA/ICd2YXIoLS10ZXh0LWRhcmspJyA6ICd2YXIoLS10ZXh0LW1lZCkn','OwogIH0KICBpZiAoYWNoaWV2ZWRCdG4pIHsKICAgIGFjaGlldmVkQnRuLnN0eWxlLmJhY2tncm91bmQgPSB0YWIgPT09ICdhY2hpZXZlZCcgPyAndmFyKC0teWVsbG93KScgOiAnI0YwRjBGMCc7CiAgICBhY2hpZXZlZEJ0bi5zdHlsZS5jb2xvciAgICAgID0gdGFiID09PSAnYWNoaWV2ZWQnID8gJ3ZhcigtLXRleHQtZGFyayknIDogJ3ZhcigtLXRleHQtbWVkKSc7CiAgfQogIHJlbmRlckdvYWxzUGFuZWwoKTsKfQoKZnVuY3Rpb24gYnVpbGRHb2FsQWNjb3VudFBpY2tlcihzZWxlY3RlZElkcykgewogIF9nYXBTZWxlY3RlZElkcyA9IG5ldyBTZXQoc2VsZWN0ZWRJZHMgfHwgW10pOwogIGNvbnN0IG53ID0gY29tcHV0ZU5ldFdvcnRoKCk7CgogIC8vIEJ1aWxkIGdyb3VwZWQgc3RydWN0dXJlIOKAlCBvbmUgZ3JvdXAgcGVyIE5XIHR5cGUKICBfZ2FwQWxsR3JvdXBzID0gW107CiAgT2JqZWN0LmtleXMoTldfVFlQRVMpLmZvckVhY2godCA9PiB7CiAgICBjb25zdCBjZmcgICA9IE5XX1RZUEVTW3RdOwogICAgY29uc3QgZ3JvdXAgPSBudy5ieVR5cGVbdF07CiAgICBpZiAoIWdyb3VwIHx8IGdyb3VwLmFjY291bnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgIC8vIEZvciBtZXRhbHM6IGNvbnNvbGlkYXRlIGluZGl2aWR1YWwgcm93cyBieSBtZXRhbFR5cGUrcHVyaXR5IHRvIGF2b2lkIDE5MC1yb3cgZmxvb2RzCiAgICBsZXQgYWNjb3VudHMgPSBncm91cC5hY2NvdW50czsKICAgIGlmICh0ID09PSAnbWV0YWxzJykgewogICAgICBjb25zdCBjb25zb2xpZGF0ZWQgPSB7fTsKICAgICAgYWNjb3VudHMuZm9yRWFjaChhID0+IHsKICAgICAgICBjb25zdCBtZXRhbCAgPSAoYS5tZXRhICYmIGEubWV0YS5tZXRhbFR5cGUpIHx8ICdnb2xkJzsKICAgICAgICBjb25zdCBwdXJpdHkgPSAoYS5tZXRhICYmIGEubWV0YS5wdXJpdHkpICAgIHx8ICcnOwogICAgICAgIGNvbnN0IGtleSAgICA9IG1ldGFsICsgJ3wnICsgcHVyaXR5OwogICAgICAgIGlmICghY29uc29saWRhdGVkW2tleV0pIHsKICAgICAgICAgIGNvbnNvbGlkYXRlZFtrZXldID0gewogICAgICAgICAgICAuLi5hLAogICAgICAgICAgICBpZDogICBhLmlkLCAgICAgICAgICAgICAgICAgICAgICAvLyBrZWVwIGZpcnN0IGlkIGZvciBzaW1wbGUgY2FzZXMKICAgICAgICAgICAgX2lkczogW2EuaWRdLCAgICAgICAgICAgICAgICAgICAgLy8gQUxMIGlkcyBpbiB0aGlzIGdyb3VwCiAgICAgICAgICAgIG5hbWU6IGNmZy5lbW9qaSArICcgJyArIG1ldGFsLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbWV0YWwuc2xpY2UoMSkgKyAocHVyaXR5ID8gJyDCtyAnICsgcHVyaXR5IDogJycpLAogICAgICAgICAgICBfdmFsOiAgYS5fdmFsIHx8IDAsCiAgICAgICAgICAgIG1ldGE6IHsgLi4uYS5tZXRhIH0sCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xpZGF0ZWRba2V5XS5faWRzLnB1c2goYS5pZCk7CiAgICAgICAgICBjb25zb2xpZGF0ZWRba2V5XS5fdmFsICArPSAoYS5fdmFsICB8fCAwKTsKICAgICAgICAgIGNvbnNvbGlkYXRlZFtrZXldLm1ldGEuZ3JhbXMgPSAoTnVtYmVyKGNvbnNvbGlkYXRlZFtrZXldLm1ldGEuZ3JhbXMpIHx8IDApICsgKE51bWJlcihhLm1ldGEgJiYgYS5tZXRhLmdyYW1zKSB8fCAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBhY2NvdW50cyA9IE9iamVjdC52YWx1ZXMoY29uc29saWRhdGVkKS5tYXAoYyA9PiAoewogICAgICAgIC4uLmMsCiAgICAgICAgaWQ6IGMuX2lkc1swXSwgICAgICAgICAgLy8gcHJpbWFyeSBpZCBmb3Igc2luZ2xlLWFjY291bnQgZ29hbCBtYXBwaW5nCiAgICAgICAgX2FsbElkczogYy5faWRzLCAgICAgICAgLy8gYWxsIGlkcyBzbyB1c2VyIGNhbiBzZWxlY3QgdGhlIHdob2xlIGdyb3VwCiAgICAgIH0pKTsKICAgIH0KCiAgICBjb25zdCBncm91cFRvdGFsID0gYWNjb3VudHMucmVkdWNlKChzLCBhKSA9PiBzICsgKGEuX3ZhbCB8fCAwKSwgMCk7CiAgICBfZ2FwQWxsR3JvdXBzLnB1c2goeyB0eXBlOnQsIGNmZywgYWNjb3VudHMsIGdyb3VwVG90YWwgfSk7CiAgfSk7CgogIGlmIChfZ2FwQWxsR3JvdXBzLmxlbmd0aCA9PT0gMCkgewogICAgY29uc3QgcGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWFjY291bnQtcGlja2VyJyk7CiAgICBpZiAocGlja2VyKSBwaWNrZXIuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9ImdhcC1lbXB0eSI+Tm8gTmV0IFdvcnRoIGFjY291bnRzIHlldCDigJQgYWRkIHRoZW0gaW4gdGhlIE5ldCBXb3J0aCBzY3JlZW4uPC9kaXY+JzsKICAgIHJldHVybjsKICB9CiAgLy8gQ2xlYXIgc2VhcmNoIGFuZCByZW5kZXIKICBjb25zdCBzZWFyY2hJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXAtc2VhcmNoLWlucHV0Jyk7CiAgaWYgKHNlYXJjaElucHV0KSBzZWFyY2hJbnB1dC52YWx1ZSA9ICcnOwogIF9yZW5kZXJHYXBHcm91cHMoJycpOwp9CgpmdW5jdGlvbiBfcmVuZGVyR2FwR3JvdXBzKHF1ZXJ5KSB7CiAgY29uc3QgcGlja2VyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWFjY291bnQtcGlja2VyJyk7CiAgaWYgKCFwaWNrZXIpIHJldHVybjsKICBjb25zdCBxID0gcXVlcnkudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgbGV0IGh0bWwgPSAnJzsKICBsZXQgYW55UmVzdWx0ID0gZmFsc2U7CgogIF9nYXBBbGxHcm91cHMuZm9yRWFjaCgoZ3JwLCBnaSkgPT4gewogICAgY29uc3QgZmlsdGVyZWRBY2NvdW50cyA9IHEKICAgICAgPyBncnAuYWNjb3VudHMuZmlsdGVyKGEgPT4gYS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocSkpCiAgICAgIDogZ3JwLmFjY291bnRzOwogICAgaWYgKGZpbHRlcmVkQWNjb3VudHMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICBhbnlSZXN1bHQgPSB0cnVlOwoKICAgIGNvbnN0IGdyb3VwU2VsZWN0ZWRDb3VudCA9IGZpbHRlcmVkQWNjb3VudHMuZmlsdGVyKGEgPT4gewogICAgICBjb25zdCBpZHMgPSBhLl9hbGxJZHMgfHwgW2EuaWRdOwogICAgICByZXR1cm4gaWRzLnNvbWUoaWQgPT4gX2dhcFNlbGVjdGVkSWRzLmhhcyhpZCkpOwogICAgfSkubGVuZ3RoOwogICAgY29uc3QgYWxsU2VsZWN0ZWQgPSBncm91cFNlbGVjdGVkQ291bnQgPT09IGZpbHRlcmVkQWNjb3VudHMubGVuZ3RoOwogICAgY29uc3QgZ3JvdXBUb3RhbEZtdCA9IGZtdChncnAuZ3JvdXBUb3RhbCk7CiAgICBjb25zdCBjb2xsYXBzZUlkID0gJ2dhcGdycF8nICsgZ2k7CgogICAgaHRtbCArPSBgPGRpdiBjbGFzcz0iZ2FwLWdyb3VwIj4KICAgICAgPGRpdiBjbGFzcz0iZ2FwLWdyb3VwLWhlYWRlciIgb25jbGljaz0idG9nZ2xlR2FwR3JvdXAoJyR7Y29sbGFwc2VJZH0nKSI+CiAgICAgICAgPGRpdiBjbGFzcz0iZ2FwLWdyb3VwLXRpdGxlIj4KICAgICAgICAgIDxzcGFuPiR7Z3JwLmNmZy5lbW9qaX08L3NwYW4+CiAgICAgICAgICA8c3Bhbj4ke2dycC5jZmcubGFiZWx9PC9zcGFuPgogICAgICAgICAgJHtncm91cFNlbGVjdGVkQ291bnQgPiAwID8gYDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOnZhcigtLXByaW1hcnkpO2NvbG9yOndoaXRlO2ZvbnQtc2l6ZTowLjY1ZW07Ym9yZGVyLXJhZGl1czoyMHB4O3BhZGRpbmc6MnB4IDdweDsiPiR7Z3JvdXBTZWxlY3RlZENvdW50fSBzZWxlY3RlZDwvc3Bhbj5gIDogJyd9CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZ2FwLWdyb3VwLW1ldGEiPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImdhcC1ncm91cC10b3RhbCI+JHtncm91cFRvdGFsRm10fTwvc3Bhbj4KICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43NWVtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpIj4ke2ZpbHRlcmVkQWNjb3VudHMubGVuZ3RofSBhY2N0JHtmaWx0ZXJlZEFjY291bnRzLmxlbmd0aD09PTE/Jyc6J3MnfTwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJnYXAtZ3JvdXAtY2hldnJvbiBvcGVuIiBpZD0iJHtjb2xsYXBzZUlkfV9jaGV2Ij7igLo8L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJnYXAtZ3JvdXAtYm9keSIgaWQ9IiR7Y29sbGFwc2VJZH0iPgogICAgICAgICR7IXEgPyBgPGRpdiBjbGFzcz0iZ2FwLXNlbGVjdC1hbGwiIG9uY2xpY2s9ImdhcFNlbGVjdEFsbCgke2dpfSwke2FsbFNlbGVjdGVkfSkiPgogICAgICAgICAgJHthbGxTZWxlY3RlZCA/ICfimJEgRGVzZWxlY3QgYWxsIGluIGdyb3VwJyA6ICfimJAgU2VsZWN0IGFsbCBpbiBncm91cCd9CiAgICAgICAgPC9kaXY+YCA6ICcnfQogICAgICAgICR7ZmlsdGVyZWRBY2NvdW50cy5tYXAoKGEsIGFpKSA9PiB7CiAgICAgICAgICBjb25zdCBpZHMgPSBhLl9hbGxJZHMgfHwgW2EuaWRdOwogICAgICAgICAgY29uc3QgaXNDaGVja2VkID0gaWRzLnNvbWUoaWQgPT4gX2dhcFNlbGVjdGVkSWRzLmhhcyhpZCkpOwogICAgICAgICAgY29uc3QgZ3JhbXMgPSBhLm1ldGEgJiYgYS5tZXRhLmdyYW1zID8gTnVtYmVyKGEubWV0YS5ncmFtcykudG9GaXhlZCgxKSArICdnJyA6ICcnOwogICAgICAgICAgY29uc3Qgb3ogICAgPSBhLm1ldGEgJiYgYS5tZXRhLmdyYW1zID8gKE51bWJlcihhLm1ldGEuZ3JhbXMpLzMxLjEwMzUpLnRvRml4ZWQoMykgKyAnIG96JyA6ICcnOwogICAgICAgICAgY29uc3Qgc3ViTGluZSA9IGdyYW1zID8gYCR7Z3JhbXN9IMK3ICR7b3p9YCA6IChhLm1ldGEgJiYgYS5tZXRhLnB1cml0eSA/IGEubWV0YS5wdXJpdHkgOiAnJyk7CiAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImdhcC1hY2Mtcm93ICR7aXNDaGVja2VkPydzZWxlY3RlZCc6Jyd9IiBvbmNsaWNrPSJnYXBUb2dnbGVBY2MoJHtnaX0sJHthaX0sJyR7aWRzLmpvaW4oJywnKX0nLHRoaXMpIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ2FwLWFjYy1jYiAke2lzQ2hlY2tlZD8nY2hlY2tlZCc6Jyd9IiBpZD0iZ2FwY2JfJHtnaX1fJHthaX0iPiR7aXNDaGVja2VkPyfinJMnOicnfTwvZGl2PgogICAgICAgICAgICA8ZGl2IHN0eWxlPSJmbGV4OjE7bWluLXdpZHRoOjA7Ij4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYXAtYWNjLW5hbWUiPiR7YS5uYW1lfTwvZGl2PgogICAgICAgICAgICAgICR7c3ViTGluZSA/IGA8ZGl2IGNsYXNzPSJnYXAtYWNjLXN1YiI+JHtzdWJMaW5lfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhcC1hY2MtdmFsIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYXAtYWNjLXZhbC1tYWluIj4ke2ZtdChhLl92YWx8fDApfTwvZGl2PgogICAgICAgICAgICAgICR7YS5jdXJyZW5jeSAmJiBhLmN1cnJlbmN5ICE9PSBjdXJyZW50Q3VycmVuY3kuY29kZSA/IGA8ZGl2IGNsYXNzPSJnYXAtYWNjLXZhbC1zdWIiPiR7YS5jdXJyZW5jeX08L2Rpdj5gIDogJyd9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9KS5qb2luKCcnKX0KICAgICAgPC9kaXY+CiAgICA8L2Rpdj5gOwogIH0pOwoKICBwaWNrZXIuaW5uZXJIVE1MID0gYW55UmVzdWx0ID8gaHRtbCA6ICc8ZGl2IGNsYXNzPSJnYXAtZW1wdHkiPk5vIGFjY291bnRzIG1hdGNoIHlvdXIgc2VhcmNoPC9kaXY+JzsKfQoKZnVuY3Rpb24gdG9nZ2xlR2FwR3JvdXAoaWQpIHsKICBjb25zdCBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogIGNvbnN0IGNoZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArICdfY2hldicpOwogIGlmICghYm9keSkgcmV0dXJuOwogIGNvbnN0IGNvbGxhcHNlZCA9IGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnY29sbGFwc2VkJyk7CiAgaWYgKGNoZXYpIHsgY2hldi5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJywgIWNvbGxhcHNlZCk7IH0KfQoKZnVuY3Rpb24gZ2FwU2VsZWN0QWxsKGdyb3VwSWR4LCBkZXNlbGVjdE1vZGUpIHsKICBjb25zdCBncnAgPSBfZ2FwQWxsR3JvdXBzW2dyb3VwSWR4XTsKICBpZiAoIWdycCkgcmV0dXJuOwogIGdycC5hY2NvdW50cy5mb3JFYWNoKGEgPT4g','ewogICAgY29uc3QgaWRzID0gYS5fYWxsSWRzIHx8IFthLmlkXTsKICAgIGlkcy5mb3JFYWNoKGlkID0+IGRlc2VsZWN0TW9kZSA/IF9nYXBTZWxlY3RlZElkcy5kZWxldGUoaWQpIDogX2dhcFNlbGVjdGVkSWRzLmFkZChpZCkpOwogIH0pOwogIF9yZW5kZXJHYXBHcm91cHMoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1zZWFyY2gtaW5wdXQnKT8udmFsdWUgfHwgJycpOwogIHVwZGF0ZUdvYWxQcmV2aWV3KCk7Cn0KCmZ1bmN0aW9uIGdhcFRvZ2dsZUFjYyhncm91cElkeCwgYWNjSWR4LCBpZHNTdHIsIHJvd0VsKSB7CiAgY29uc3QgaWRzID0gaWRzU3RyLnNwbGl0KCcsJyk7CiAgY29uc3QgaXNOb3dTZWxlY3RlZCA9IGlkcy5zb21lKGlkID0+IF9nYXBTZWxlY3RlZElkcy5oYXMoaWQpKTsKICBpZiAoaXNOb3dTZWxlY3RlZCkgewogICAgaWRzLmZvckVhY2goaWQgPT4gX2dhcFNlbGVjdGVkSWRzLmRlbGV0ZShpZCkpOwogIH0gZWxzZSB7CiAgICBpZHMuZm9yRWFjaChpZCA9PiBfZ2FwU2VsZWN0ZWRJZHMuYWRkKGlkKSk7CiAgfQogIC8vIFVwZGF0ZSB2aXN1YWwgd2l0aG91dCBmdWxsIHJlLXJlbmRlciBmb3Igc3BlZWQKICBjb25zdCBjYiA9IHJvd0VsLnF1ZXJ5U2VsZWN0b3IoJy5nYXAtYWNjLWNiJyk7CiAgcm93RWwuY2xhc3NMaXN0LnRvZ2dsZSgnc2VsZWN0ZWQnLCAhaXNOb3dTZWxlY3RlZCk7CiAgaWYgKGNiKSB7IGNiLmNsYXNzTGlzdC50b2dnbGUoJ2NoZWNrZWQnLCAhaXNOb3dTZWxlY3RlZCk7IGNiLnRleHRDb250ZW50ID0gIWlzTm93U2VsZWN0ZWQgPyAn4pyTJyA6ICcnOyB9CiAgLy8gVXBkYXRlIGdyb3VwIHNlbGVjdGVkIGJhZGdlIOKAlCByZS1yZW5kZXIgZ3JvdXAgaGVhZGVyIG9ubHkKICBfcmVuZGVyR2FwR3JvdXBzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXAtc2VhcmNoLWlucHV0Jyk/LnZhbHVlIHx8ICcnKTsKICB1cGRhdGVHb2FsUHJldmlldygpOwp9CgpmdW5jdGlvbiBmaWx0ZXJHb2FsUGlja2VyKHF1ZXJ5KSB7CiAgX3JlbmRlckdhcEdyb3VwcyhxdWVyeSk7Cn0KCmZ1bmN0aW9uIGdldEdvYWxDaGVja2VkSWRzKCkgewogIHJldHVybiBbLi4uX2dhcFNlbGVjdGVkSWRzXTsKfQoKZnVuY3Rpb24gdXBkYXRlR29hbFByZXZpZXcoKSB7CiAgY29uc3Qgc2VsZWN0ZWRJZHMgPSBnZXRHb2FsQ2hlY2tlZElkcygpOwogIGNvbnN0IHJhd1RhcmdldCA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXRhcmdldCcpLnZhbHVlKSB8fCAwOwogIGNvbnN0IHVuaXQgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy11bml0JykudmFsdWU7CiAgY29uc3QgZ29hbEN1ciAgID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1jdXJyZW5jeScpPy52YWx1ZSB8fCBjdXJyZW50Q3VycmVuY3kuY29kZSkudG9VcHBlckNhc2UoKTsKICBjb25zdCBwcmV2aWV3ICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtcHJldmlldycpOwogIGlmICghcHJldmlldykgcmV0dXJuOwoKICBpZiAoc2VsZWN0ZWRJZHMubGVuZ3RoID09PSAwIHx8IHJhd1RhcmdldCA9PT0gMCkgewogICAgcHJldmlldy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgcmV0dXJuOwogIH0KCiAgLy8gQ29udmVydCB0YXJnZXQgZnJvbSBnb2FsJ3MgY3VycmVuY3kgdG8gZGlzcGxheSBjdXJyZW5jeSAoZm9yIGFwcGxlcy10by1hcHBsZXMgY29tcGFyaXNvbikKICBjb25zdCB0YXJnZXREaXNwbGF5ID0gdW5pdCA9PT0gJ2N1cnJlbmN5JyA/IGNvbnZlcnRBbXQocmF3VGFyZ2V0LCBnb2FsQ3VyKSA6IHJhd1RhcmdldDsKICBjb25zdCBnb2FsVHlwZSAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWdvYWx0eXBlJyk/LnZhbHVlIHx8ICdncm93JzsKICBjb25zdCBjdXJyZW50ICAgICAgID0gY29tcHV0ZUdvYWxDdXJyZW50KHNlbGVjdGVkSWRzLCB1bml0LCBnb2FsVHlwZSk7CiAgLy8gRm9yICdyZWR1Y2UnIGdvYWxzOiBwcm9ncmVzcyA9IGhvdyBtdWNoIGJhbGFuY2UgaGFzIGRyb3BwZWQgZnJvbSBzdGFydEJhbGFuY2UgdG93YXJkIHRhcmdldAogIGxldCBwY3Q7CiAgaWYgKGdvYWxUeXBlID09PSAncmVkdWNlJykgewogICAgY29uc3Qgc3RhcnRCYWwgPSBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1zdGFydGJhbCcpPy52YWx1ZSkgfHwgMDsKICAgIGNvbnN0IHJlZHVjZWQgID0gTWF0aC5tYXgoc3RhcnRCYWwgLSBjdXJyZW50LCAwKTsKICAgIGNvbnN0IHRvdGFsUmVkdWNlID0gTWF0aC5tYXgoc3RhcnRCYWwgLSB0YXJnZXREaXNwbGF5LCAwKTsKICAgIHBjdCA9IHRvdGFsUmVkdWNlID4gMCA/IE1hdGgubWluKHJlZHVjZWQgLyB0b3RhbFJlZHVjZSAqIDEwMCwgMTAwKSA6IChjdXJyZW50IDw9IHRhcmdldERpc3BsYXkgPyAxMDAgOiAwKTsKICB9IGVsc2UgewogICAgcGN0ID0gdGFyZ2V0RGlzcGxheSA+IDAgPyBNYXRoLm1pbihjdXJyZW50IC8gdGFyZ2V0RGlzcGxheSAqIDEwMCwgMTAwKSA6IDA7CiAgfQogIGNvbnN0IHVuaXRMYWJlbCAgICAgPSB1bml0ID09PSAnZ3JhbXMnID8gJ2cnIDogdW5pdCA9PT0gJ2tnJyA/ICdrZycgOiB1bml0ID09PSAnc3FmdCcgPyAnIHNxZnQnIDogJyc7CiAgY29uc3QgZm10Q3VycmVudCAgICA9IHVuaXQgPT09ICdjdXJyZW5jeScgPyBmbXQoY3VycmVudCkgICAgICAgIDogY3VycmVudC50b0ZpeGVkKHVuaXQgPT09ICdzcWZ0JyA/IDAgOiAyKSArIHVuaXRMYWJlbDsKICBjb25zdCBmbXRUYXJnZXQgICAgID0gdW5pdCA9PT0gJ2N1cnJlbmN5JyA/IGZtdCh0YXJnZXREaXNwbGF5KSAgOiByYXdUYXJnZXQudG9GaXhlZCgwKSArIHVuaXRMYWJlbDsKICBjb25zdCBiYXJDb2xvciAgICAgID0gcGN0ID49IDEwMCA/ICcjMTBCOTgxJyA6IHBjdCA+PSA3NSA/ICcjM0I5RUZGJyA6IHBjdCA+PSA0MCA/ICcjRjU5RTBCJyA6ICcjRUY0NDQ0JzsKICBjb25zdCBpc0ZvcmVpZ24gICAgID0gdW5pdCA9PT0gJ2N1cnJlbmN5JyAmJiBnb2FsQ3VyICE9PSBjdXJyZW50Q3VycmVuY3kuY29kZTsKCiAgcHJldmlldy5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgY29uc3QgZmlsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXAtcHJldmlldy1maWxsJyk7CiAgY29uc3QgY3VyICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXAtcHJldmlldy1jdXJyZW50Jyk7CiAgY29uc3QgcGN0RWw9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYXAtcHJldmlldy1wY3QnKTsKICBjb25zdCB0Z3QgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhcC1wcmV2aWV3LXRhcmdldCcpOwogIGlmIChmaWxsKSAgeyBmaWxsLnN0eWxlLndpZHRoID0gcGN0LnRvRml4ZWQoMSkgKyAnJSc7IGZpbGwuc3R5bGUuYmFja2dyb3VuZCA9IGJhckNvbG9yOyB9CiAgaWYgKGN1cikgICB7CiAgICBjdXIudGV4dENvbnRlbnQgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScgPyAnQmFsYW5jZTogJyArIGZtdEN1cnJlbnQgOiBmbXRDdXJyZW50OwogICAgY3VyLnN0eWxlLmNvbG9yID0gYmFyQ29sb3I7CiAgfQogIGlmIChwY3RFbCkgeyBwY3RFbC50ZXh0Q29udGVudCA9IHBjdC50b0ZpeGVkKDApICsgJyUnOyBwY3RFbC5zdHlsZS5jb2xvciA9IGJhckNvbG9yOyB9CiAgaWYgKHRndCkgICB7CiAgICB0Z3QudGV4dENvbnRlbnQgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScKICAgICAgPyBg4oaSIFRhcmdldDogJHtmbXRUYXJnZXR9YAogICAgICA6IGlzRm9yZWlnbgogICAgICAgID8gYG9mICR7Zm10VGFyZ2V0fSAoJHtmbXRHb2FsT3JpZ2luYWwocmF3VGFyZ2V0LCBnb2FsQ3VyKX0gJHtnb2FsQ3VyfSlgCiAgICAgICAgOiBgb2YgJHtmbXRUYXJnZXR9YDsKICB9Cn0KCmZ1bmN0aW9uIGNvbXB1dGVHb2FsQ3VycmVudChtYXBwZWRBY2NvdW50SWRzLCB1bml0LCBnb2FsVHlwZSkgewogIGNvbnN0IG53ID0gY29tcHV0ZU5ldFdvcnRoKCk7CiAgY29uc3QgYWxsQWNjb3VudHMgPSBbXTsKICBPYmplY3Qua2V5cyhOV19UWVBFUykuZm9yRWFjaCh0ID0+IHsKICAgIGNvbnN0IGdyb3VwID0gbncuYnlUeXBlW3RdOwogICAgaWYgKGdyb3VwKSBncm91cC5hY2NvdW50cy5mb3JFYWNoKGEgPT4gYWxsQWNjb3VudHMucHVzaCh7IC4uLmEsIF9ud1R5cGU6IHQgfSkpOwogIH0pOwoKICBsZXQgdG90YWwgPSAwOwogIG1hcHBlZEFjY291bnRJZHMuZm9yRWFjaChpZCA9PiB7CiAgICBjb25zdCBhY2MgPSBhbGxBY2NvdW50cy5maW5kKGEgPT4gYS5pZCA9PT0gaWQpOwogICAgaWYgKCFhY2MpIHJldHVybjsKICAgIGNvbnN0IGlzTGlhYiA9IE5XX1RZUEVTW2FjYy5fbndUeXBlXSAmJiBOV19UWVBFU1thY2MuX253VHlwZV0uaXNMaWFiOwoKICAgIGlmICh1bml0ID09PSAnZ3JhbXMnKSB7CiAgICAgIHRvdGFsICs9IE51bWJlcihhY2MubWV0YSAmJiBhY2MubWV0YS5ncmFtcyB8fCAwKTsKICAgIH0gZWxzZSBpZiAodW5pdCA9PT0gJ2tnJykgewogICAgICB0b3RhbCArPSBOdW1iZXIoYWNjLm1ldGEgJiYgYWNjLm1ldGEuZ3JhbXMgfHwgMCkgLyAxMDAwOwogICAgfSBlbHNlIGlmICh1bml0ID09PSAnY291bnQnKSB7CiAgICAgIHRvdGFsICs9IDE7CiAgICB9IGVsc2UgaWYgKHVuaXQgPT09ICdzcWZ0JykgewogICAgICAvLyBGb3IgcmVhbCBlc3RhdGU6IHN1bSBhcmVhIChhcmVhQ2VudHMgZmllbGQgc3RvcmVzIHNxZnQvYXJlYSkKICAgICAgdG90YWwgKz0gTnVtYmVyKGFjYy5tZXRhICYmIGFjYy5tZXRhLmFyZWEgfHwgYWNjLm1ldGEgJiYgYWNjLm1ldGEuYXJlYUNlbnRzIHx8IDApOwogICAgfSBlbHNlIHsKICAgICAgLy8gQ3VycmVuY3k6IGxpYWJpbGl0aWVzIHN1YnRyYWN0IGZyb20gdG90YWwgKGZvciBuZXQgd29ydGggLyBncm93IGdvYWxzKQogICAgICAvLyBGb3IgJ3JlZHVjZScgZ29hbHMsIHdlIGp1c3Qgc3VtIHRoZSByYXcgbGlhYmlsaXR5IGJhbGFuY2UgZGlyZWN0bHkKICAgICAgaWYgKGdvYWxUeXBlID09PSAncmVkdWNlJykgewogICAgICAgIHRvdGFsICs9IE51bWJlcihhY2MuX3ZhbCB8fCAwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBncm93IC8gbmV0d29ydGg6IGFzc2V0cyBhZGQsIGxpYWJpbGl0aWVzIHN1YnRyYWN0CiAgICAgICAgdG90YWwgKz0gaXNMaWFiID8gLU51bWJlcihhY2MuX3ZhbCB8fCAwKSA6IE51bWJlcihhY2MuX3ZhbCB8fCAwKTsKICAgICAgfQogICAgfQogIH0pOwogIHJldHVybiB0b3RhbDsKfQoKZnVuY3Rpb24gc2F2ZUdvYWwoKSB7CiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1uYW1lJykudmFsdWUudHJpbSgpOwogIGNvbnN0IHRhcmdldFJhdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy10YXJnZXQnKS52YWx1ZTsKICBjb25zdCB0YXJnZXQgPSBwYXJzZUZsb2F0KHRhcmdldFJhdyk7CiAgY29uc3QgZ29hbFR5cGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtZ29hbHR5cGUnKT8udmFsdWUgfHwgJ2dyb3cnOwogIGlmICghbmFtZSkgeyBzaG93VG9hc3QoJ0VudGVyIGEgZ29hbCBuYW1lIOKdjCcpOyByZXR1cm47IH0KICBpZiAodGFyZ2V0UmF3ID09PSAnJyB8fCBpc05hTih0YXJnZXQpKSB7IHNob3dUb2FzdCgnRW50ZXIgYSB0YXJnZXQgYW1vdW50IOKdjCcpOyByZXR1cm47IH0KICBpZiAoZ29hbFR5cGUgIT09ICdyZWR1Y2UnICYmICF0YXJnZXQpIHsgc2hvd1RvYXN0KCdFbnRlciBhIHRhcmdldCBhbW91bnQg4p2MJyk7IHJldHVybjsgfQoKICBjb25zdCBnb2FscyA9IGdldEdvYWxzKCk7CiAgY29uc3QgZWRpdElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLWVkaXRpbmctaWQnKS52YWx1ZTsKICBjb25zdCBtYXBwZWRBY2NvdW50cyA9IFsuLi5fZ2FwU2VsZWN0ZWRJZHNdOwoKICBjb25zdCBnb2FsID0gewogICAgaWQ6ICAgZWRpdElkIHx8ICgnZ29hbF8nICsgRGF0ZS5ub3coKSksCiAgICBuYW1lLAogICAgaWNvbjogICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtaWNvbicpLnZhbHVlIHx8ICfwn46vJywKICAgIHRhcmdldCwKICAgIHVuaXQ6ICAgZG9jdW1lbnQuZ2V0','RWxlbWVudEJ5SWQoJ2dzLXVuaXQnKS52YWx1ZSwKICAgIGN1cnJlbmN5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3MtY3VycmVuY3knKS52YWx1ZSwKICAgIHRhcmdldERhdGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1kYXRlJykudmFsdWUsCiAgICBkZXNjOiAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1kZXNjJykudmFsdWUudHJpbSgpLAogICAgZ29hbFR5cGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdncy1nb2FsdHlwZScpPy52YWx1ZSB8fCAnZ3JvdycsCiAgICBzdGFydEJhbGFuY2U6IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dzLXN0YXJ0YmFsJyk/LnZhbHVlKSB8fCAwLAogICAgbWFwcGVkQWNjb3VudHMsCiAgICBjcmVhdGVkQXQ6IGVkaXRJZCA/IChnb2Fscy5maW5kKGc9PmcuaWQ9PT1lZGl0SWQpfHx7fSkuY3JlYXRlZEF0IDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sCiAgfTsKCiAgaWYgKGVkaXRJZCkgewogICAgY29uc3QgaWR4ID0gZ29hbHMuZmluZEluZGV4KGcgPT4gZy5pZCA9PT0gZWRpdElkKTsKICAgIGlmIChpZHggPj0gMCkgZ29hbHNbaWR4XSA9IGdvYWw7IGVsc2UgZ29hbHMucHVzaChnb2FsKTsKICB9IGVsc2UgewogICAgZ29hbHMucHVzaChnb2FsKTsKICB9CgogIHNhdmVHb2Fscyhnb2Fscyk7CiAgY2xvc2VHb2FsU2hlZXQoKTsKICByZW5kZXJHb2Fsc1BhbmVsKCk7CiAgc2hvd1RvYXN0KCfwn46vIEdvYWwgc2F2ZWQhJyk7Cn0KCmZ1bmN0aW9uIGRlbGV0ZUdvYWwoaWQpIHsKICBpZiAoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIGdvYWw/JykpIHJldHVybjsKICBkYXRhLl9nb2FscyA9IGdldEdvYWxzKCkuZmlsdGVyKGcgPT4gZy5pZCAhPT0gaWQpOwogIHNhdmUoKTsKICByZW5kZXJHb2Fsc1BhbmVsKCk7CiAgc2hvd1RvYXN0KCdHb2FsIGRlbGV0ZWQnKTsKfQoKLy8g4pSA4pSAIENvbnZlcnQgYSBnb2FsJ3MgcmF3IHRhcmdldCBhbW91bnQgaW50byB0aGUgZGlzcGxheSBjdXJyZW5jeS4KLy8gVGhlIHRhcmdldCBpcyBzdG9yZWQgaW4gZy5jdXJyZW5jeSAoZS5nLiDigrkxMCwwMCwwMDAgSU5SKS4KLy8gY29tcHV0ZUdvYWxDdXJyZW50IHJldHVybnMgdmFsdWVzIGluIHRoZSBkaXNwbGF5IGN1cnJlbmN5IChlLmcuIFVTRCkuCi8vIFdlIG11c3QgY29udmVydCB0aGUgdGFyZ2V0IGludG8gZGlzcGxheSBjdXJyZW5jeSBiZWZvcmUgY29tcHV0aW5nIHRoZSByYXRpby4KZnVuY3Rpb24gZ29hbFRhcmdldEluRGlzcGxheShnKSB7CiAgaWYgKChnLnVuaXQgfHwgJ2N1cnJlbmN5JykgIT09ICdjdXJyZW5jeScpIHJldHVybiBOdW1iZXIoZy50YXJnZXQgfHwgMCk7CiAgY29uc3QgZ29hbEN1ciA9IChnLmN1cnJlbmN5IHx8IGN1cnJlbnRDdXJyZW5jeS5jb2RlKS50b1VwcGVyQ2FzZSgpOwogIHJldHVybiBjb252ZXJ0QW10KGcudGFyZ2V0IHx8IDAsIGdvYWxDdXIpOwp9CgovLyBHZXQgdGhlIGN1cnJlbmN5IHN5bWJvbCBmb3IgYSBnb2FsJ3MgZGVjbGFyZWQgY3VycmVuY3kKZnVuY3Rpb24gZ29hbEN1cnJlbmN5U3ltKGdvYWxDdXJyZW5jeUNvZGUpIHsKICBjb25zdCBjID0gQ1VSUkVOQ0lFUy5maW5kKHggPT4geC5jb2RlID09PSBnb2FsQ3VycmVuY3lDb2RlKTsKICByZXR1cm4gYyA/IGMuc3ltYm9sIDogKGdvYWxDdXJyZW5jeUNvZGUgfHwgc3ltKCkpOwp9CgovLyBGb3JtYXQgYSByYXcgYW1vdW50IGluIHRoZSBnb2FsJ3Mgb3duIGN1cnJlbmN5IChmb3IgZGlzcGxheSBhcyB0aGUgb3JpZ2luYWwgdGFyZ2V0KQpmdW5jdGlvbiBmbXRHb2FsT3JpZ2luYWwoYW1vdW50LCBjdXJyZW5jeUNvZGUpIHsKICBjb25zdCBzID0gZ29hbEN1cnJlbmN5U3ltKGN1cnJlbmN5Q29kZSk7CiAgcmV0dXJuIHMgKyBNYXRoLnJvdW5kKE51bWJlcihhbW91bnQgfHwgMCkpLnRvTG9jYWxlU3RyaW5nKCk7Cn0KCmZ1bmN0aW9uIHJlbmRlckdvYWxzUGFuZWwoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbHMtbGlzdC1ncmlkJyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IGFsbEdvYWxzID0gZ2V0R29hbHMoKTsKCiAgLy8gQ29tcHV0ZSBhY2hpZXZlZCBzdGF0dXMgZm9yIGV2ZXJ5IGdvYWwgdXAgZnJvbnQKICBjb25zdCB0YWdnZWQgPSBhbGxHb2Fscy5tYXAoZyA9PiB7CiAgICBjb25zdCBjdXJyZW50ICAgICAgID0gY29tcHV0ZUdvYWxDdXJyZW50KGcubWFwcGVkQWNjb3VudHMgfHwgW10sIGcudW5pdCB8fCAnY3VycmVuY3knLCBnLmdvYWxUeXBlIHx8ICdncm93Jyk7CiAgICBjb25zdCB0YXJnZXREaXNwbGF5ID0gZ29hbFRhcmdldEluRGlzcGxheShnKTsKICAgIGxldCBwY3Q7CiAgICBpZiAoKGcuZ29hbFR5cGUgfHwgJ2dyb3cnKSA9PT0gJ3JlZHVjZScpIHsKICAgICAgY29uc3Qgc3RhcnRCYWwgPSBOdW1iZXIoZy5zdGFydEJhbGFuY2UgfHwgMCk7CiAgICAgIGNvbnN0IHJlZHVjZWQgID0gTWF0aC5tYXgoc3RhcnRCYWwgLSBjdXJyZW50LCAwKTsKICAgICAgY29uc3QgdG90YWxSZWR1Y2UgPSBNYXRoLm1heChzdGFydEJhbCAtIHRhcmdldERpc3BsYXksIDApOwogICAgICBwY3QgPSB0b3RhbFJlZHVjZSA+IDAgPyBNYXRoLm1pbihyZWR1Y2VkIC8gdG90YWxSZWR1Y2UgKiAxMDAsIDEwMCkgOiAoY3VycmVudCA8PSB0YXJnZXREaXNwbGF5ID8gMTAwIDogMCk7CiAgICB9IGVsc2UgewogICAgICBwY3QgPSB0YXJnZXREaXNwbGF5ID4gMCA/IE1hdGgubWluKGN1cnJlbnQgLyB0YXJnZXREaXNwbGF5ICogMTAwLCAxMDApIDogMDsKICAgIH0KICAgIHJldHVybiB7IGcsIGN1cnJlbnQsIHRhcmdldERpc3BsYXksIHBjdCwgYWNoaWV2ZWQ6IHBjdCA+PSAxMDAgfTsKICB9KTsKCiAgY29uc3QgYWN0aXZlTGlzdCAgID0gdGFnZ2VkLmZpbHRlcih0ID0+ICF0LmFjaGlldmVkKTsKICBjb25zdCBhY2hpZXZlZExpc3QgPSB0YWdnZWQuZmlsdGVyKHQgPT4gIHQuYWNoaWV2ZWQpOwoKICAvLyBVcGRhdGUgdGFiIGNvdW50IGJhZGdlcwogIGNvbnN0IGFjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2d0YWItYWN0aXZlLWNvdW50Jyk7CiAgY29uc3QgaGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3RhYi1hY2hpZXZlZC1jb3VudCcpOwogIGlmIChhYykgYWMudGV4dENvbnRlbnQgPSBhY3RpdmVMaXN0Lmxlbmd0aDsKICBpZiAoaGMpIGhjLnRleHRDb250ZW50ID0gYWNoaWV2ZWRMaXN0Lmxlbmd0aDsKCiAgaWYgKGFsbEdvYWxzLmxlbmd0aCA9PT0gMCkgewogICAgZWwuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6NDBweCAyMHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToyLjVlbTttYXJnaW4tYm90dG9tOjhweDsiPvCfjq88L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjllbTttYXJnaW4tYm90dG9tOjRweDsiPk5vIGdvYWxzIHlldDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtOyI+VGFwIHRoZSA8c3Ryb25nPu+8izwvc3Ryb25nPiBidXR0b24gYmVsb3cgdG8gdHJhY2sgZmluYW5jaWFsIG1pbGVzdG9uZXM8L2Rpdj4KICAgIDwvZGl2PmA7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBsaXN0ID0gZ29hbHNUYWIgPT09ICdhY2hpZXZlZCcgPyBhY2hpZXZlZExpc3QgOiBhY3RpdmVMaXN0OwoKICBpZiAobGlzdC5sZW5ndGggPT09IDApIHsKICAgIGVsLmlubmVySFRNTCA9IGdvYWxzVGFiID09PSAnYWNoaWV2ZWQnCiAgICAgID8gYDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6NDBweCAyMHB4O2NvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+CiAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjIuNWVtO21hcmdpbi1ib3R0b206OHB4OyI+8J+PhjwvZGl2PgogICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDtmb250LXNpemU6MC45ZW07bWFyZ2luLWJvdHRvbTo0cHg7Ij5ObyBhY2hpZXZlZCBnb2FscyB5ZXQ8L2Rpdj4KICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtOyI+S2VlcCBnb2luZyDigJQgY29tcGxldGVkIGdvYWxzIHdpbGwgYXBwZWFyIGhlcmUhPC9kaXY+CiAgICAgICAgIDwvZGl2PmAKICAgICAgOiBgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo0MHB4IDIwcHg7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Ij4KICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6Mi41ZW07bWFyZ2luLWJvdHRvbTo4cHg7Ij7wn46JPC9kaXY+CiAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjllbTttYXJnaW4tYm90dG9tOjRweDsiPkFsbCBnb2FscyBhY2hpZXZlZCE8L2Rpdj4KICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43OGVtOyI+SW5jcmVkaWJsZSDigJQgc2V0IG5ldyBvbmVzIHdpdGggdGhlIO+8iyBidXR0b248L2Rpdj4KICAgICAgICAgPC9kaXY+YDsKICAgIHJldHVybjsKICB9CgogIGVsLmlubmVySFRNTCA9IGxpc3QubWFwKCh7IGcsIGN1cnJlbnQsIHRhcmdldERpc3BsYXksIHBjdCwgYWNoaWV2ZWQgfSkgPT4gewogICAgY29uc3QgdW5pdCAgICAgICAgPSBnLnVuaXQgfHwgJ2N1cnJlbmN5JzsKICAgIGNvbnN0IGdvYWxUeXBlICAgID0gZy5nb2FsVHlwZSB8fCAnZ3Jvdyc7CiAgICBjb25zdCBnb2FsQ3VyQ29kZSA9IChnLmN1cnJlbmN5IHx8IGN1cnJlbnRDdXJyZW5jeS5jb2RlKS50b1VwcGVyQ2FzZSgpOwogICAgY29uc3QgaXNGb3JlaWduQ3VyID0gdW5pdCA9PT0gJ2N1cnJlbmN5JyAmJiBnb2FsQ3VyQ29kZSAhPT0gY3VycmVudEN1cnJlbmN5LmNvZGU7CiAgICBjb25zdCBiYXJDb2xvciAgICA9IGFjaGlldmVkID8gJyMxMEI5ODEnIDogcGN0ID49IDc1ID8gJyMzQjlFRkYnIDogcGN0ID49IDQwID8gJyNGNTlFMEInIDogJyNFRjQ0NDQnOwogICAgY29uc3QgZm10VmFsID0gdiA9PiB1bml0ID09PSAnY3VycmVuY3knCiAgICAgID8gZm10KHYpCiAgICAgIDogdi50b0ZpeGVkKHVuaXQgPT09ICdncmFtcycgPyAxIDogdW5pdCA9PT0gJ3NxZnQnID8gMCA6IDIpICsgKHVuaXQgPT09ICdncmFtcycgPyAnZycgOiB1bml0ID09PSAna2cnID8gJ2tnJyA6IHVuaXQgPT09ICdzcWZ0JyA/ICcgc3FmdCcgOiAnJyk7CiAgICAvLyBGb3IgcmVkdWNlIGdvYWxzOiBzaG93IGhvdyBtdWNoIGlzIGxlZnQgdG8gcmVkdWNlCiAgICBjb25zdCByZW1haW5pbmcgPSBnb2FsVHlwZSA9PT0gJ3JlZHVjZScKICAgICAgPyBNYXRoLm1heChjdXJyZW50IC0gdGFyZ2V0RGlzcGxheSwgMCkgICAvLyBzdGlsbCBvd2UgdGhpcyBtdWNoCiAgICAgIDogTWF0aC5tYXgodGFyZ2V0RGlzcGxheSAtIGN1cnJlbnQsIDApOyAgLy8gc3RpbGwgbmVlZCB0byBncm93IGJ5IHRoaXMKICAgIC8vIEdvYWwgdHlwZSBiYWRnZQogICAgY29uc3QgZ29hbFR5cGVCYWRnZSA9IGdvYWxUeXBlID09PSAncmVkdWNlJwogICAgICA/IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNjVlbTtmb250LXdlaWdodDo4MDA7YmFja2dyb3VuZDojRkZGMEYwO2NvbG9yOiNFRjQ0NDQ7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzoycHggN3B4O21hcmdpbi1sZWZ0OjRweDsiPvCfk4kgUmVkdWNlPC9zcGFuPmAKICAgICAgOiBnb2FsVHlwZSA9PT0gJ2dyb3cnID8gJycgOiAnJzsKICAgIC8vIEZvciByZWR1Y2U6IHNob3cgY3VycmVudCBiYWxhbmNlIHZzIHRhcmdldCBiYWxhbmNlCiAgICBjb25zdCBwcm9ncmVzc0xhYmVsID0gZ29hbFR5cGUgPT09ICdyZWR1Y2UnCiAgICAgID8gYEJhbGFuY2U6ICR7Zm10VmFsKGN1cnJlbnQpfSDihpIgVGFyZ2V0OiAke2ZtdFZhbCh0YXJnZXREaXNwbGF5KX1gCiAgICAgIDogYCR7Zm10VmFsKGN1cnJlbnQpfSBvZiAke2ZtdFZhbCh0YXJnZXREaXNwbGF5KX1gOwoKICAgIC8vIFRhcmdldCBkYXRlIHRhZwogICAgbGV0IGRhdGVUYWcgPSAnJzsKICAgIGlmIChnLnRhcmdldERhdGUp','IHsKICAgICAgY29uc3QgZGlmZk1zICAgPSBuZXcgRGF0ZShnLnRhcmdldERhdGUgKyAnLTAxJykgLSBuZXcgRGF0ZSgpOwogICAgICBjb25zdCBkaWZmRGF5cyA9IE1hdGguY2VpbChkaWZmTXMgLyA4NjQwMDAwMCk7CiAgICAgIGRhdGVUYWcgPSBkaWZmRGF5cyA+IDAKICAgICAgICA/IGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjoke2RpZmZEYXlzPDkwPycjRUY0NDQ0JzondmFyKC0tdGV4dC1saWdodCknfTttYXJnaW4tbGVmdDo2cHg7Ij7ij7MgJHtkaWZmRGF5cz42MD9NYXRoLmNlaWwoZGlmZkRheXMvMzApKydtbyc6ZGlmZkRheXMrJ2QnfTwvc3Bhbj5gCiAgICAgICAgOiBgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjdlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6IzEwQjk4MTttYXJnaW4tbGVmdDo2cHg7Ij7inJMgRGVhZGxpbmUgcGFzc2VkPC9zcGFuPmA7CiAgICB9CgogICAgLy8gQ2VsZWJyYXRpb24gYmFubmVyIG9ubHkgb24gYWNoaWV2ZWQgdGFiCiAgICBjb25zdCBhY2hpZXZlZEJhbm5lciA9IGFjaGlldmVkID8gYAogICAgICA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOmxpbmVhci1ncmFkaWVudCgxMzVkZWcsIzEwQjk4MSwjMDU5NjY5KTtjb2xvcjp3aGl0ZTtib3JkZXItcmFkaXVzOjEwcHg7CiAgICAgICAgICAgICAgICAgIHBhZGRpbmc6MTBweCAxNHB4O21hcmdpbi1ib3R0b206MTBweDtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMHB4OyI+CiAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxLjZlbTsiPvCfj4Y8L3NwYW4+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC44OGVtOyI+R29hbCBBY2hpZXZlZCE8L2Rpdj4KICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjcyZW07b3BhY2l0eTowLjg1OyI+WW91IGhpdCAke2ZtdFZhbCh0YXJnZXREaXNwbGF5KX0g4oCUIG91dHN0YW5kaW5nIHdvcms8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+YCA6ICcnOwoKICAgIHJldHVybiBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp3aGl0ZTtib3JkZXItcmFkaXVzOjE2cHg7cGFkZGluZzoxNHB4IDE2cHg7bWFyZ2luLWJvdHRvbToxMHB4OwogICAgICAgIGJveC1zaGFkb3c6MCAycHggMTBweCByZ2JhKDAsMCwwLDAuMDYpO2JvcmRlcjoxLjVweCBzb2xpZCAke2FjaGlldmVkPycjMTBCOTgxJzonI0YwRjBGMCd9OyI+CiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpmbGV4LXN0YXJ0O21hcmdpbi1ib3R0b206OHB4OyI+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtmbGV4LXdyYXA6d3JhcDtnYXA6NHB4O2ZsZXg6MTttaW4td2lkdGg6MDsiPgogICAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxLjNlbTsiPiR7Zy5pY29ufHwn8J+Oryd9PC9zcGFuPgogICAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45MmVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7bWFyZ2luLWxlZnQ6NHB4OyI+JHtnLm5hbWV9PC9zcGFuPgogICAgICAgICAgJHtnb2FsVHlwZUJhZGdlfQogICAgICAgICAgJHtkYXRlVGFnfQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtnYXA6NnB4O2ZsZXgtc2hyaW5rOjA7bWFyZ2luLWxlZnQ6OHB4OyI+CiAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9Im9wZW5Hb2FsU2hlZXQoJyR7Zy5pZH0nKSIgc3R5bGU9ImJhY2tncm91bmQ6I0YwRjRGRjtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjhweDtwYWRkaW5nOjVweCA5cHg7Zm9udC1zaXplOjAuNzVlbTtmb250LXdlaWdodDo4MDA7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Y3Vyc29yOnBvaW50ZXI7Ij7inI/vuI88L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gb25jbGljaz0iZGVsZXRlR29hbCgnJHtnLmlkfScpIiBzdHlsZT0iYmFja2dyb3VuZDojRkZGMEYwO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6NXB4IDlweDtmb250LXNpemU6MC43NWVtO2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Y3Vyc29yOnBvaW50ZXI7Ij7inJU8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgICR7Zy5kZXNjID8gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc1ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NjAwO21hcmdpbi1ib3R0b206OHB4OyI+JHtnLmRlc2N9PC9kaXY+YCA6ICcnfQogICAgICAke2FjaGlldmVkQmFubmVyfQogICAgICAke2lzRm9yZWlnbkN1ciA/IGA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43MmVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjp2YXIoLS10ZXh0LW1lZCk7bWFyZ2luLWJvdHRvbTo2cHg7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6NXB4O2ZsZXgtd3JhcDp3cmFwOyI+CiAgICAgICAgPHNwYW4+8J+OryBUYXJnZXQ6PC9zcGFuPgogICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXdlaWdodDo5MDA7Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTsiPiR7Zm10R29hbE9yaWdpbmFsKGcudGFyZ2V0LCBnb2FsQ3VyQ29kZSl9PC9zcGFuPgogICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTsiPuKJiDwvc3Bhbj4KICAgICAgICA8c3BhbiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2NvbG9yOnZhcigtLXByaW1hcnkpOyI+JHtmbXQodGFyZ2V0RGlzcGxheSl9PC9zcGFuPgogICAgICAgIDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEY0RkY7Y29sb3I6dmFyKC0tcHJpbWFyeSk7Zm9udC1zaXplOjAuOWVtO2JvcmRlci1yYWRpdXM6NnB4O3BhZGRpbmc6MXB4IDVweDsiPiR7Z29hbEN1ckNvZGV9IOKGkiAke2N1cnJlbnRDdXJyZW5jeS5jb2RlfTwvc3Bhbj4KICAgICAgPC9kaXY+YCA6ICcnfQogICAgICA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNGNUY1RjU7Ym9yZGVyLXJhZGl1czoyMHB4O2hlaWdodDoxMHB4O292ZXJmbG93OmhpZGRlbjttYXJnaW4tYm90dG9tOjZweDsiPgogICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDoxMDAlO3dpZHRoOiR7cGN0LnRvRml4ZWQoMSl9JTtiYWNrZ3JvdW5kOiR7YmFyQ29sb3J9O2JvcmRlci1yYWRpdXM6MjBweDt0cmFuc2l0aW9uOndpZHRoIDAuNXMgZWFzZTsiPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjc1ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtbWVkKTsiPiR7cHJvZ3Jlc3NMYWJlbH08L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC44OGVtO2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjoke2JhckNvbG9yfTsiPiR7cGN0LnRvRml4ZWQoMCl9JTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgJHshYWNoaWV2ZWQgPyBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtmb250LXdlaWdodDo3MDA7Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7bWFyZ2luLXRvcDozcHg7Ij4ke2dvYWxUeXBlID09PSAncmVkdWNlJyA/ICdTdGlsbCB0byByZWR1Y2U6ICcgKyBmbXRWYWwocmVtYWluaW5nKSA6ICdTdGlsbCBuZWVkOiAnICsgZm10VmFsKHJlbWFpbmluZyl9PC9kaXY+YCA6ICcnfQogICAgICAkeyhnLm1hcHBlZEFjY291bnRzfHxbXSkubGVuZ3RoID4gMCA/IGA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43ZW07Zm9udC13ZWlnaHQ6NjAwO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO21hcmdpbi10b3A6NXB4O2JvcmRlci10b3A6MXB4IHNvbGlkICNGNUY1RjU7cGFkZGluZy10b3A6NXB4OyI+8J+TiiAke2cubWFwcGVkQWNjb3VudHMubGVuZ3RofSBhY2NvdW50JHtnLm1hcHBlZEFjY291bnRzLmxlbmd0aD4xPydzJzonJ30gbWFwcGVkPC9kaXY+YCA6ICcnfQogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gYnVkZ2V0Q2hhbmdlTW9udGgoZGlyKSB7CiAgY29uc3QgW3ksIG1dID0gYnVkZ2V0Vmlld01vbnRoLnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgY29uc3QgZCA9IG5ldyBEYXRlKHksIG0gLSAxICsgZGlyLCAxKTsKICBidWRnZXRWaWV3TW9udGggPSBgJHtkLmdldEZ1bGxZZWFyKCl9LSR7U3RyaW5nKGQuZ2V0TW9udGgoKSsxKS5wYWRTdGFydCgyLCcwJyl9YDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LW1vbnRoLWxhYmVsJykudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgoYnVkZ2V0Vmlld01vbnRoKTsKICByZW5kZXJCdWRnZXRNb2R1bGUoKTsKICAvLyBJZiBkZXRhaWwgcGFuZSBpcyBvcGVuLCByZS1yZW5kZXIgaXQgZm9yIHRoZSBuZXcgbW9udGgKICBpZiAoY3VycmVudEJ1ZGdldENhdERldGFpbCkgewogICAgY29uc3QgeyB0eXBlLCBnb2FsS2V5IH0gPSBjdXJyZW50QnVkZ2V0Q2F0RGV0YWlsOwogICAgY29uc3QgZ29hbHMgPSBnZXRCdWRnZXRHb2Fscyh0eXBlKTsKICAgIGNvbnN0IGdvYWwgID0gZ29hbHMuZmluZChnID0+IGcua2V5ID09PSBnb2FsS2V5KTsKICAgIGlmIChnb2FsKSB7CiAgICAgIGNvbnN0IHByZWZpeCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdzYXYnIDogJ2V4cCc7CiAgICAgIF9yZW5kZXJCdWRnZXREZXRhaWwocHJlZml4LCBnb2FsLCB0eXBlKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHNldEJ1ZGdldFRhYih0YWIsIGVsKSB7CiAgY3VycmVudEJ1ZGdldFRhYiA9IHRhYjsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYm0tdGFiJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGlmIChlbCkgZWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgLy8gSGlkZSBnb2FscyBvdmVybGF5IGZpcnN0CiAgY29uc3QgZ29hbHNQYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGlzdC1nb2FscycpOwogIGNvbnN0IGdvYWxzRmFiICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ29hbHMtZmFiLWJ0bicpOwogIGlmIChnb2Fsc1BhbmVsKSBnb2Fsc1BhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgaWYgKGdvYWxzRmFiKSAgIGdvYWxzRmFiLnN0eWxlLmRpc3BsYXkgICA9ICdub25lJzsKICBpZiAodGFiID09PSAnZ29hbHMnKSB7CiAgICAvLyBTaG93IGdvYWxzIGFzIGZ1bGwgb3ZlcmxheSArIGl0cyBvd24gRkFCCiAgICBpZiAoZ29hbHNQYW5lbCkgZ29hbHNQYW5lbC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBpZiAoZ29hbHNGYWIpICAgeyBnb2Fsc0ZhYi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyB9CiAgICByZW5kZXJHb2Fsc1BhbmVsKCk7CiAgICByZXR1cm47CiAgfQogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5idWRnZXQtc2VjdGlvbicpLmZvckVhY2gocyA9PiBzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpOwogIGNvbnN0IHNlYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdic2VjLScgKyB0YWIpOwogIGlmIChzZWMpIHNlYy5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7Cn0KCi8vIENvbXB1dGUgYWN0dWFsIHNwZW50IGZvciBhIGdvYWwgaW4gYSBnaXZlbiBtb250aApmdW5jdGlvbiBnZXRCdWRnZXRBY3R1YWwoZ29hbCwgbW9udGhLZXkpIHsKICBlbnN1cmVNb250aChtb250aEtleSk7CiAgY29uc3QgbSA9IGRhdGFbbW9udGhLZXldOwogIGNvbnN0IGNhdHMgPSAoZ29hbC5saW5rZWRDYXRzIHx8IFtnb2FsLmtleV0pLm1hcChjID0+IGMudG9Mb3dlckNhc2UoKS50cmltKCkpOwogIGxldCB0b3RhbCA9IDA7CiAgWydleHBlbnNlcycsICdpbnZlc3RtZW50cycsICdhZGRpdGlvbmFsJ10uZm9yRWFjaChsaXN0S2V5ID0+IHsKICAgIChtW2xpc3RLZXldIHx8IFtdKS5mb3JFYWNoKGUg','PT4gewogICAgICBjb25zdCBlYyA9IChlLmNhdGVnb3J5IHx8ICcnKS50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgY29uc3QgZWQgPSAoZS5kZXNjcmlwdGlvbiB8fCAnJykudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgIGlmIChjYXRzLnNvbWUoYyA9PiBlYy5pbmNsdWRlcyhjKSB8fCAobGlzdEtleSA9PT0gJ2ludmVzdG1lbnRzJyAmJiAoZWQuaW5jbHVkZXMoYykgfHwgZWMuaW5jbHVkZXMoYykpKSkpIHsKICAgICAgICB0b3RhbCArPSBjb252ZXJ0QW10KGUuYW1vdW50LCBlLmN1cnJlbmN5KTsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgcmV0dXJuIHRvdGFsOwp9CgovLyBHZXQgbGFzdCAxMiBtb250aHMga2V5cwpmdW5jdGlvbiBnZXRMYXN0MTJNb250aHMoZnJvbU1vbnRoS2V5KSB7CiAgY29uc3QgW3ksIG1dID0gZnJvbU1vbnRoS2V5LnNwbGl0KCctJykubWFwKE51bWJlcik7CiAgY29uc3QgbW9udGhzID0gW107CiAgZm9yIChsZXQgaSA9IDExOyBpID49IDA7IGktLSkgewogICAgY29uc3QgZCA9IG5ldyBEYXRlKHksIG0gLSAxIC0gaSwgMSk7CiAgICBtb250aHMucHVzaChgJHtkLmdldEZ1bGxZZWFyKCl9LSR7U3RyaW5nKGQuZ2V0TW9udGgoKSsxKS5wYWRTdGFydCgyLCcwJyl9YCk7CiAgfQogIHJldHVybiBtb250aHM7Cn0KCmZ1bmN0aW9uIHJlbmRlckJ1ZGdldE1vZHVsZSgpIHsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LW1vbnRoLWxhYmVsJykudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgoYnVkZ2V0Vmlld01vbnRoKTsKICBpZiAoY3VycmVudEJ1ZGdldFRhYiA9PT0gJ292ZXJ2aWV3JykgcmVuZGVyQnVkZ2V0T3ZlcnZpZXcoKTsKICBlbHNlIGlmIChjdXJyZW50QnVkZ2V0VGFiID09PSAnZXhwZW5zZXMnKSByZW5kZXJCdWRnZXRHb2Fsc0xpc3QoJ2V4cGVuc2UnKTsKICBlbHNlIGlmIChjdXJyZW50QnVkZ2V0VGFiID09PSAnc2F2aW5ncycpIHJlbmRlckJ1ZGdldEdvYWxzTGlzdCgnc2F2aW5ncycpOwp9CgpsZXQgYnVkZ2V0Vmlld01vZGUgPSAnbW9udGgnOyAvLyAnbW9udGgnIHwgJ3llYXInCgpmdW5jdGlvbiBzZXRCdWRnZXRWaWV3TW9kZShtb2RlKSB7CiAgYnVkZ2V0Vmlld01vZGUgPSBtb2RlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiaC1idG4tbW9udGgnKS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBtb2RlID09PSAnbW9udGgnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtYnRuLXllYXInKS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCBtb2RlID09PSAneWVhcicpOwogIHJlbmRlckJ1ZGdldE92ZXJ2aWV3KCk7Cn0KCmZ1bmN0aW9uIGdldFllYXJNb250aEtleXMobW9udGhLZXkpIHsKICBjb25zdCB5ZWFyID0gbW9udGhLZXkuc3BsaXQoJy0nKVswXTsKICBjb25zdCBhbGwgPSBbXTsKICBmb3IgKGxldCBtID0gMTsgbSA8PSAxMjsgbSsrKSB7CiAgICBhbGwucHVzaChgJHt5ZWFyfS0ke1N0cmluZyhtKS5wYWRTdGFydCgyLCcwJyl9YCk7CiAgfQogIHJldHVybiBhbGw7Cn0KCmZ1bmN0aW9uIHJlbmRlckJ1ZGdldE92ZXJ2aWV3KCkgewogIGNvbnN0IGV4cEdvYWxzID0gZ2V0QnVkZ2V0R29hbHMoJ2V4cGVuc2UnKTsKICBjb25zdCBzYXZHb2FscyA9IGdldEJ1ZGdldEdvYWxzKCdzYXZpbmdzJyk7CiAgY29uc3QgaXNZZWFyID0gYnVkZ2V0Vmlld01vZGUgPT09ICd5ZWFyJzsKICBjb25zdCB5ZWFyID0gYnVkZ2V0Vmlld01vbnRoLnNwbGl0KCctJylbMF07CgogIC8vIOKUgOKUgCBDb21wdXRlIHRvdGFscyBkZXBlbmRpbmcgb24gbW9kZSDilIDilIAKICBsZXQgdG90YWxFeHBCdWRnZXQsIHRvdGFsU2F2QnVkZ2V0LCB0b3RhbEV4cEFjdHVhbCwgdG90YWxTYXZBY3R1YWw7CiAgY29uc3QgbW9udGhseUV4cEJ1ZGdldCA9IGV4cEdvYWxzLnJlZHVjZSgocywgZykgPT4gcyArIE51bWJlcihnLmFtb3VudCB8fCAwKSwgMCk7CiAgY29uc3QgbW9udGhseVNhdkJ1ZGdldCA9IHNhdkdvYWxzLnJlZHVjZSgocywgZykgPT4gcyArIE51bWJlcihnLmFtb3VudCB8fCAwKSwgMCk7CgogIGlmIChpc1llYXIpIHsKICAgIC8vIEFubnVhbGl6ZWQgYnVkZ2V0ID0gbW9udGhseSDDlyAxMgogICAgdG90YWxFeHBCdWRnZXQgPSBtb250aGx5RXhwQnVkZ2V0ICogMTI7CiAgICB0b3RhbFNhdkJ1ZGdldCA9IG1vbnRobHlTYXZCdWRnZXQgKiAxMjsKICAgIC8vIFlURCBhY3R1YWxzIOKAlCBzdW0gb25seSBtb250aHMgaW4gdGhpcyB5ZWFyIFVQIFRPIHRoZSBzZWxlY3RlZC9jdXJyZW50IG1vbnRoCiAgICBjb25zdCB0b2RheU1rID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsNyk7CiAgICBjb25zdCBjYXBNayA9IGJ1ZGdldFZpZXdNb250aCA8IHRvZGF5TWsgPyBidWRnZXRWaWV3TW9udGggOiB0b2RheU1rOwogICAgY29uc3QgeWVhck1vbnRocyA9IGdldFllYXJNb250aEtleXMoYnVkZ2V0Vmlld01vbnRoKS5maWx0ZXIobWsgPT4gbWsgPD0gY2FwTWspOwogICAgdG90YWxFeHBBY3R1YWwgPSB5ZWFyTW9udGhzLnJlZHVjZSgocywgbWspID0+IHMgKyBleHBHb2Fscy5yZWR1Y2UoKHNzLCBnKSA9PiBzcyArIGdldEJ1ZGdldEFjdHVhbChnLCBtayksIDApLCAwKTsKICAgIHRvdGFsU2F2QWN0dWFsID0geWVhck1vbnRocy5yZWR1Y2UoKHMsIG1rKSA9PiBzICsgc2F2R29hbHMucmVkdWNlKChzcywgZykgPT4gc3MgKyBnZXRCdWRnZXRBY3R1YWwoZywgbWspLCAwKSwgMCk7CiAgfSBlbHNlIHsKICAgIHRvdGFsRXhwQnVkZ2V0ID0gbW9udGhseUV4cEJ1ZGdldDsKICAgIHRvdGFsU2F2QnVkZ2V0ID0gbW9udGhseVNhdkJ1ZGdldDsKICAgIHRvdGFsRXhwQWN0dWFsID0gZXhwR29hbHMucmVkdWNlKChzLCBnKSA9PiBzICsgZ2V0QnVkZ2V0QWN0dWFsKGcsIGJ1ZGdldFZpZXdNb250aCksIDApOwogICAgdG90YWxTYXZBY3R1YWwgPSBzYXZHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgYnVkZ2V0Vmlld01vbnRoKSwgMCk7CiAgfQoKICBjb25zdCB0b3RhbEJ1ZGdldCA9IHRvdGFsRXhwQnVkZ2V0ICsgdG90YWxTYXZCdWRnZXQ7CiAgY29uc3QgdG90YWxMZWZ0ID0gdG90YWxCdWRnZXQgLSB0b3RhbEV4cEFjdHVhbCAtIHRvdGFsU2F2QWN0dWFsOwogIGNvbnN0IGlzT3ZlciA9IHRvdGFsTGVmdCA8IDA7CgogIC8vIOKUgOKUgCBIZXJvIG51bWJlcnMg4pSA4pSACiAgY29uc3QgeWVhckJhZGdlID0gaXNZZWFyID8gYDxzcGFuIGNsYXNzPSJiaC15ZWFyLWJhZGdlIj4ke3llYXJ9PC9zcGFuPmAgOiAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtdGl0bGUnKS5pbm5lckhUTUwgPSAoaXNZZWFyID8gJ0FOTlVBTCBCVURHRVQnIDogJ1RPVEFMIEJVREdFVEVEJykgKyB5ZWFyQmFkZ2U7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLWFtb3VudCcpLnRleHRDb250ZW50ID0gZm10KGlzWWVhciA/IHRvdGFsRXhwQWN0dWFsICsgdG90YWxTYXZBY3R1YWwgOiB0b3RhbEJ1ZGdldCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLXN1YicpLmlubmVySFRNTCA9IGlzWWVhcgogICAgPyBgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+b2YgJHtmbXQodG90YWxCdWRnZXQpfSBhbm51YWwgZ29hbCDCtyA8L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOiR7aXNPdmVyPyd2YXIoLS1leHBlbnNlcyknOid2YXIoLS1pbmNvbWUpJ307Ij4ke2lzT3ZlciA/IGZtdChNYXRoLmFicyh0b3RhbExlZnQpKSsnIG92ZXInIDogZm10KHRvdGFsTGVmdCkrJyBsZWZ0J308L3NwYW4+YAogICAgOiBgPHNwYW4gc3R5bGU9ImNvbG9yOiR7aXNPdmVyID8gJ3ZhcigtLWV4cGVuc2VzKScgOiAndmFyKC0taW5jb21lKSd9OyI+JHtpc092ZXIgPyAn4payICcgKyBmbXQoTWF0aC5hYnModG90YWxMZWZ0KSkgKyAnIG92ZXInIDogJ+KWvCAnICsgZm10KHRvdGFsTGVmdCkgKyAnIGxlZnQnfTwvc3Bhbj5gOwoKICAvLyDilIDilIAgRHVhbCBzdGF0IGJsb2NrcyDilIDilIAKICBjb25zdCBleHBMZWZ0ID0gdG90YWxFeHBCdWRnZXQgLSB0b3RhbEV4cEFjdHVhbDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtZXhwLXZhbCcpLnRleHRDb250ZW50ID0gZm10KHRvdGFsRXhwQWN0dWFsKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtZXhwLXZhbCcpLnN0eWxlLmNvbG9yID0gZXhwTGVmdCA8IDAgPyAndmFyKC0tZXhwZW5zZXMpJyA6ICd2YXIoLS10ZXh0LWRhcmspJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmgtZXhwLXN1YicpLmlubmVySFRNTCA9IGA8c3BhbiBzdHlsZT0iY29sb3I6JHtleHBMZWZ0PDA/J3ZhcigtLWV4cGVuc2VzKSc6J3ZhcigtLWluY29tZSknfTsiPiR7ZXhwTGVmdDwwID8gZm10KE1hdGguYWJzKGV4cExlZnQpKSsnIG92ZXInIDogZm10KGV4cExlZnQpKycgbGVmdCd9PC9zcGFuPjxicj48c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC1zaXplOjAuOWVtOyI+b2YgJHtmbXQodG90YWxFeHBCdWRnZXQpfSR7aXNZZWFyPycgYW5udWFsJzonJ308L3NwYW4+YDsKCiAgY29uc3Qgc2F2TGVmdCA9IHRvdGFsU2F2QnVkZ2V0IC0gdG90YWxTYXZBY3R1YWw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLXNhdi12YWwnKS50ZXh0Q29udGVudCA9IGZtdCh0b3RhbFNhdkFjdHVhbCk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLXNhdi12YWwnKS5zdHlsZS5jb2xvciA9IHNhdkxlZnQgPCAwID8gJ3ZhcigtLWV4cGVuc2VzKScgOiAndmFyKC0tdGV4dC1kYXJrKSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JoLXNhdi1zdWInKS5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOiR7c2F2TGVmdDwwPyd2YXIoLS1leHBlbnNlcyknOid2YXIoLS1pbmNvbWUpJ307Ij4ke3NhdkxlZnQ8MCA/IGZtdChNYXRoLmFicyhzYXZMZWZ0KSkrJyBvdmVyJyA6IGZtdChzYXZMZWZ0KSsnIGxlZnQnfTwvc3Bhbj48YnI+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc2l6ZTowLjllbTsiPm9mICR7Zm10KHRvdGFsU2F2QnVkZ2V0KX0ke2lzWWVhcj8nIGFubnVhbCc6Jyd9PC9zcGFuPmA7CgogIC8vIOKUgOKUgCBDaGFydCDilIDilIAKICBjb25zdCBjYW52YXNJZCA9ICdidWRnZXQtb3ZlcnZpZXctY2hhcnQnOwogIGlmIChjaGFydHNbY2FudmFzSWRdKSB7IGNoYXJ0c1tjYW52YXNJZF0uZGVzdHJveSgpOyBkZWxldGUgY2hhcnRzW2NhbnZhc0lkXTsgfQogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhc0lkKTsKICBpZiAoY3R4KSB7CiAgICBpZiAoaXNZZWFyKSB7CiAgICAgIC8vIFllYXIgdmlldzogZ3JvdXBlZCBiYXIgY2hhcnQgSmFu4oCTRGVjIHdpdGggZXhwZW5zZSArIHNhdmluZ3MgYmFycyBwZXIgbW9udGgKICAgICAgY29uc3QgeWVhck1vbnRocyA9IGdldFllYXJNb250aEtleXMoYnVkZ2V0Vmlld01vbnRoKTsKICAgICAgY29uc3QgbGFiZWxzID0geWVhck1vbnRocy5tYXAobWsgPT4geyBjb25zdCBbLG1vXSA9IG1rLnNwbGl0KCctJyk7IHJldHVybiBbJ0onLCdGJywnTScsJ0EnLCdNJywnSicsJ0onLCdBJywnUycsJ08nLCdOJywnRCddW3BhcnNlSW50KG1vKS0xXTsgfSk7CiAgICAgIGNvbnN0IGV4cERhdGEgPSB5ZWFyTW9udGhzLm1hcChtayA9PiBleHBHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgbWspLCAwKSk7CiAgICAgIGNvbnN0IHNhdkRhdGEgPSB5ZWFyTW9udGhzLm1hcChtayA9PiBzYXZHb2Fscy5yZWR1Y2UoKHMsIGcpID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZywgbWspLCAwKSk7CiAgICAgIGNvbnN0IGN1cklkeCA9IHllYXJNb250aHMuaW5kZXhPZihidWRnZXRWaWV3TW9udGgpOwogICAgICBjaGFydHNbY2FudmFzSWRdID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgIHR5cGU6ICdiYXInLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGxhYmVscywKICAgICAgICAgIGRhdGFzZXRzOiBbCiAgICAgICAgICAgIHsgbGFiZWw6','ICdFeHBlbnNlcycsIGRhdGE6IGV4cERhdGEsIGJhY2tncm91bmRDb2xvcjogZXhwRGF0YS5tYXAoKF8sIGkpID0+IGkgPT09IGN1cklkeCA/ICcjRUY0NDQ0JyA6ICcjRUY0NDQ0NjYnKSwgYm9yZGVyUmFkaXVzOiA0LCBiYXJQZXJjZW50YWdlOiAwLjU1LCBjYXRlZ29yeVBlcmNlbnRhZ2U6IDAuNzUgfSwKICAgICAgICAgICAgeyBsYWJlbDogJ1NhdmluZ3MnLCAgZGF0YTogc2F2RGF0YSwgYmFja2dyb3VuZENvbG9yOiBzYXZEYXRhLm1hcCgoXywgaSkgPT4gaSA9PT0gY3VySWR4ID8gJyMxMEI5ODEnIDogJyMxMEI5ODE2NicpLCBib3JkZXJSYWRpdXM6IDQsIGJhclBlcmNlbnRhZ2U6IDAuNTUsIGNhdGVnb3J5UGVyY2VudGFnZTogMC43NSB9LAogICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgb3B0aW9uczogewogICAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICBwbHVnaW5zOiB7IGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0b29sdGlwOiB7IG1vZGU6ICdpbmRleCcsIGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBjLmRhdGFzZXQubGFiZWwgKyAnOiAnICsgZm10KGMucmF3KSB9IH0gfSwKICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICB4OiB7IGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGlja3M6IHsgZm9udDogeyBzaXplOiA5LCBmYW1pbHk6ICdOdW5pdG8nLCB3ZWlnaHQ6ICc3MDAnIH0sIGNvbG9yOiAnIzlBQTBCMicgfSB9LAogICAgICAgICAgICB5OiB7IGRpc3BsYXk6IGZhbHNlIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgLy8gTW9udGggdmlldzogZHVhbCBsaW5lIGNoYXJ0IOKAlCBsYXN0IDEyIG1vbnRocwogICAgICBjb25zdCBtb250aHMxMiA9IGdldExhc3QxMk1vbnRocyhidWRnZXRWaWV3TW9udGgpOwogICAgICBjb25zdCBleHBBY3R1YWxzMTIgPSBtb250aHMxMi5tYXAobWsgPT4gZXhwR29hbHMucmVkdWNlKChzLCBnKSA9PiBzICsgZ2V0QnVkZ2V0QWN0dWFsKGcsIG1rKSwgMCkpOwogICAgICBjb25zdCBzYXZBY3R1YWxzMTIgPSBtb250aHMxMi5tYXAobWsgPT4gc2F2R29hbHMucmVkdWNlKChzLCBnKSA9PiBzICsgZ2V0QnVkZ2V0QWN0dWFsKGcsIG1rKSwgMCkpOwogICAgICBjb25zdCBsYWJlbHMxMiA9IG1vbnRoczEyLm1hcChtayA9PiB7IGNvbnN0IFssbW9dID0gbWsuc3BsaXQoJy0nKTsgcmV0dXJuIFsnSmFuJywnRmViJywnTWFyJywnQXByJywnTWF5JywnSnVuJywnSnVsJywnQXVnJywnU2VwJywnT2N0JywnTm92JywnRGVjJ11bcGFyc2VJbnQobW8pLTFdOyB9KTsKICAgICAgY2hhcnRzW2NhbnZhc0lkXSA9IG5ldyBDaGFydChjdHgsIHsKICAgICAgICB0eXBlOiAnbGluZScsCiAgICAgICAgZGF0YTogewogICAgICAgICAgbGFiZWxzOiBsYWJlbHMxMiwKICAgICAgICAgIGRhdGFzZXRzOiBbCiAgICAgICAgICAgIHsgbGFiZWw6ICdFeHBlbnNlIEFjdHVhbCcsIGRhdGE6IGV4cEFjdHVhbHMxMiwgYm9yZGVyQ29sb3I6ICcjRUY0NDQ0JywgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLCBib3JkZXJXaWR0aDogMiwgcG9pbnRSYWRpdXM6IDIsIHRlbnNpb246IDAuMyB9LAogICAgICAgICAgICB7IGxhYmVsOiAnRXhwZW5zZSBCdWRnZXQnLCBkYXRhOiBtb250aHMxMi5tYXAoKCkgPT4gbW9udGhseUV4cEJ1ZGdldCksIGJvcmRlckNvbG9yOiAnI0VGNDQ0NDQ0JywgYm9yZGVyV2lkdGg6IDEuNSwgYm9yZGVyRGFzaDogWzQsNF0sIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JywgcG9pbnRSYWRpdXM6IDAgfSwKICAgICAgICAgICAgeyBsYWJlbDogJ1NhdmluZ3MgQWN0dWFsJywgZGF0YTogc2F2QWN0dWFsczEyLCBib3JkZXJDb2xvcjogJyMxMEI5ODEnLCBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsIGJvcmRlcldpZHRoOiAyLCBwb2ludFJhZGl1czogMiwgdGVuc2lvbjogMC4zIH0sCiAgICAgICAgICAgIHsgbGFiZWw6ICdTYXZpbmdzIEJ1ZGdldCcsIGRhdGE6IG1vbnRoczEyLm1hcCgoKSA9PiBtb250aGx5U2F2QnVkZ2V0KSwgYm9yZGVyQ29sb3I6ICcjMTBCOTgxNDQnLCBib3JkZXJXaWR0aDogMS41LCBib3JkZXJEYXNoOiBbNCw0XSwgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLCBwb2ludFJhZGl1czogMCB9LAogICAgICAgICAgXQogICAgICAgIH0sCiAgICAgICAgb3B0aW9uczogeyByZXNwb25zaXZlOiB0cnVlLCBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwgcGx1Z2luczogeyBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdG9vbHRpcDogeyBtb2RlOiAnaW5kZXgnLCBjYWxsYmFja3M6IHsgbGFiZWw6IGMgPT4gYy5kYXRhc2V0LmxhYmVsICsgJzogJyArIGZtdChjLnJhdykgfSB9IH0sIHNjYWxlczogeyB4OiB7IGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwgdGlja3M6IHsgZm9udDogeyBzaXplOiA5LCBmYW1pbHk6ICdOdW5pdG8nLCB3ZWlnaHQ6ICc3MDAnIH0sIGNvbG9yOiAnIzlBQTBCMicgfSB9LCB5OiB7IGRpc3BsYXk6IGZhbHNlIH0gfSB9CiAgICAgIH0pOwogICAgfQogIH0KCiAgLy8g4pSA4pSAIENhdGVnb3J5IGJ1YmJsZXMg4oCUIHR3byB2aXN1YWxseSBzZXBhcmF0ZWQgcm93czog8J+SuCBFeHBlbnNlcyArIPCfkrAgU2F2aW5ncyDilIDilIAKICBmdW5jdGlvbiBtYWtlQnViYmxlSFRNTChnb2FsLCBndHlwZSkgewogICAgbGV0IGFjdHVhbCwgYnVkZ2V0OwogICAgaWYgKGlzWWVhcikgewogICAgICBjb25zdCB0b2RheU1rMiA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDcpOwogICAgICBjb25zdCBjYXBNazIgPSBidWRnZXRWaWV3TW9udGggPCB0b2RheU1rMiA/IGJ1ZGdldFZpZXdNb250aCA6IHRvZGF5TWsyOwogICAgICBjb25zdCB5dGRNb250aHMgPSBnZXRZZWFyTW9udGhLZXlzKGJ1ZGdldFZpZXdNb250aCkuZmlsdGVyKG1rID0+IG1rIDw9IGNhcE1rMik7CiAgICAgIGFjdHVhbCA9IHl0ZE1vbnRocy5yZWR1Y2UoKHMsIG1rKSA9PiBzICsgZ2V0QnVkZ2V0QWN0dWFsKGdvYWwsIG1rKSwgMCk7CiAgICAgIGJ1ZGdldCA9IE51bWJlcihnb2FsLmFtb3VudCB8fCAwKSAqIDEyOwogICAgfSBlbHNlIHsKICAgICAgYWN0dWFsID0gZ2V0QnVkZ2V0QWN0dWFsKGdvYWwsIGJ1ZGdldFZpZXdNb250aCk7CiAgICAgIGJ1ZGdldCA9IE51bWJlcihnb2FsLmFtb3VudCB8fCAwKTsKICAgIH0KICAgIGNvbnN0IHBjdCA9IGJ1ZGdldCA+IDAgPyBNYXRoLm1pbihhY3R1YWwgLyBidWRnZXQsIDEpIDogMDsKICAgIGNvbnN0IGlzR29hbE92ZXIgPSBhY3R1YWwgPiBidWRnZXQgJiYgYnVkZ2V0ID4gMDsKICAgIGNvbnN0IGlzU2F2ID0gZ3R5cGUgPT09ICdzYXZpbmdzJzsKICAgIGNvbnN0IHN0YXR1c0NvbG9yID0gaXNTYXYgPyAoYWN0dWFsID49IGJ1ZGdldCA/ICcjMTBCOTgxJyA6ICcjRjU5RTBCJykgOiAoaXNHb2FsT3ZlciA/ICcjRUY0NDQ0JyA6ICcjMTBCOTgxJyk7CiAgICBjb25zdCB0cmFja0NvbG9yICA9IGlzU2F2ID8gJyMxMEI5ODEnIDogKGlzR29hbE92ZXIgPyAnI0VGNDQ0NCcgOiAnIzEwQjk4MScpOwogICAgY29uc3QgYmdDb2xvciAgICAgPSBpc1NhdiA/ICcjMTBCOTgxMjAnIDogKGlzR29hbE92ZXIgPyAnI0VGNDQ0NDIwJyA6ICcjMTBCOTgxMTgnKTsKICAgIGNvbnN0IHIgPSAzMDsKICAgIGNvbnN0IGNpcmN1bWZlcmVuY2UgPSAyICogTWF0aC5QSSAqIHI7CiAgICBjb25zdCBkYXNoID0gcGN0ICogY2lyY3VtZmVyZW5jZTsKICAgIGNvbnN0IGxlZnRBbXQgPSBidWRnZXQgLSBhY3R1YWw7CiAgICBjb25zdCBzdGF0dXNUZXh0ID0gYnVkZ2V0ID4gMCA/IChsZWZ0QW10IDwgMCA/IGZtdChNYXRoLmFicyhsZWZ0QW10KSkgKyAnIG92ZXInIDogZm10KGxlZnRBbXQpICsgJyBsZWZ0JykgOiBmbXQoYWN0dWFsKTsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0iYmNhdC1idWJibGUiIG9uY2xpY2s9Im9wZW5CdWRnZXRDYXREZXRhaWwoJyR7Z3R5cGV9JywnJHtnb2FsLmtleX0nKSI+CiAgICAgIDxkaXYgY2xhc3M9ImJjYXQtcmluZyIgc3R5bGU9ImJhY2tncm91bmQ6JHtiZ0NvbG9yfTsiPgogICAgICAgIDxzdmcgdmlld0JveD0iMCAwIDcyIDcyIj48Y2lyY2xlIGN4PSIzNiIgY3k9IjM2IiByPSIke3J9IiBmaWxsPSJub25lIiBzdHJva2U9IiNFOEU4RTgiIHN0cm9rZS13aWR0aD0iNSIvPjxjaXJjbGUgY3g9IjM2IiBjeT0iMzYiIHI9IiR7cn0iIGZpbGw9Im5vbmUiIHN0cm9rZT0iJHt0cmFja0NvbG9yfSIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtZGFzaGFycmF5PSIke2Rhc2h9ICR7Y2lyY3VtZmVyZW5jZX0iIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPgogICAgICAgIDxkaXYgY2xhc3M9ImJjYXQtaWNvbi13cmFwIj4ke2dvYWwuaWNvbiB8fCAoaXNTYXYgPyAn8J+SsCcgOiAn8J+SuCcpfTwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYmNhdC1uYW1lIj4ke2dvYWwubmFtZX08L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYmNhdC1zdGF0dXMiIHN0eWxlPSJjb2xvcjoke3N0YXR1c0NvbG9yfTsiPiR7c3RhdHVzVGV4dH08L2Rpdj4KICAgIDwvZGl2PmA7CiAgfQoKICBjb25zdCBleHBCdWJibGVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LWNhdHMtYnViYmxlcy1leHAnKTsKICBjb25zdCBzYXZCdWJibGVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVkZ2V0LWNhdHMtYnViYmxlcy1zYXYnKTsKICBjb25zdCBleHBMYWJlbEVsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmNhdC1sYWJlbC1leHAnKTsKICBjb25zdCBzYXZMYWJlbEVsICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmNhdC1sYWJlbC1zYXYnKTsKCiAgaWYgKGV4cEJ1YmJsZXNFbCkgewogICAgaWYgKGV4cEdvYWxzLmxlbmd0aCA9PT0gMCkgewogICAgICBleHBCdWJibGVzRWwuaW5uZXJIVE1MID0gJyc7CiAgICAgIGlmIChleHBMYWJlbEVsKSBleHBMYWJlbEVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9IGVsc2UgewogICAgICBpZiAoZXhwTGFiZWxFbCkgZXhwTGFiZWxFbC5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICBleHBCdWJibGVzRWwuaW5uZXJIVE1MID0gZXhwR29hbHMubWFwKGcgPT4gbWFrZUJ1YmJsZUhUTUwoZywgJ2V4cGVuc2UnKSkuam9pbignJyk7CiAgICB9CiAgfQoKICBpZiAoc2F2QnViYmxlc0VsKSB7CiAgICBpZiAoc2F2R29hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHNhdkJ1YmJsZXNFbC5pbm5lckhUTUwgPSAnJzsKICAgICAgaWYgKHNhdkxhYmVsRWwpIHNhdkxhYmVsRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChzYXZMYWJlbEVsKSBzYXZMYWJlbEVsLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgIHNhdkJ1YmJsZXNFbC5pbm5lckhUTUwgPSBzYXZHb2Fscy5tYXAoZyA9PiBtYWtlQnViYmxlSFRNTChnLCAnc2F2aW5ncycpKS5qb2luKCcnKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHJlbmRlckJ1ZGdldEdvYWxzTGlzdCh0eXBlKSB7CiAgY29uc3QgZ29hbHMgPSBnZXRCdWRnZXRHb2Fscyh0eXBlKTsKICBjb25zdCBsaXN0SWQgPSB0eXBlID09PSAnc2F2aW5ncycgPyAnYnVkZ2V0LXNhdi1nb2FscycgOiAnYnVkZ2V0LWV4cC1nb2Fscyc7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsaXN0SWQpOwogIGlmICghZWwpIHJldHVybjsKCiAgaWYgKGdvYWxzLmxlbmd0aCA9PT0gMCkgewogICAgZWwuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6NDBweDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtiYWNrZ3JvdW5kOnZhcigtLXdoaXRlKTtib3JkZXItcmFkaXVzOnZhcigtLXJhZGl1cyk7Ym94LXNoYWRvdzp2YXIoLS1jYXJkLXNoYWRvdyk7Ij48ZGl2IHN0eWxlPSJmb250LXNpemU6Mi41ZW07bWFyZ2luLWJvdHRvbTo4cHg7Ij4ke3R5cGUgPT09ICdzYXZpbmdzJyA/','ICfwn5KwJyA6ICfwn46vJ308L2Rpdj48ZGl2IHN0eWxlPSJmb250LXdlaWdodDo3MDA7Ij5ObyAke3R5cGUgPT09ICdzYXZpbmdzJyA/ICdzYXZpbmdzIGdvYWxzJyA6ICdleHBlbnNlIGJ1ZGdldHMnfSB5ZXQ8L2Rpdj48YnV0dG9uIG9uY2xpY2s9Im9wZW5FZGl0QnVkZ2V0UG9wdXAobnVsbCwnJHt0eXBlfScpIiBzdHlsZT0ibWFyZ2luLXRvcDoxMnB4O2JhY2tncm91bmQ6dmFyKC0teWVsbG93KTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjEycHg7cGFkZGluZzoxMHB4IDIwcHg7Zm9udC1mYW1pbHk6TnVuaXRvLHNhbnMtc2VyaWY7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg1ZW07Y3Vyc29yOnBvaW50ZXI7Ij4rIEFkZCBHb2FsPC9idXR0b24+PC9kaXY+YDsKICAgIHJldHVybjsKICB9CgogIGVsLmlubmVySFRNTCA9IGdvYWxzLm1hcChnb2FsID0+IHsKICAgIGNvbnN0IGFjdHVhbCA9IGdldEJ1ZGdldEFjdHVhbChnb2FsLCBidWRnZXRWaWV3TW9udGgpOwogICAgY29uc3QgYnVkZ2V0ID0gTnVtYmVyKGdvYWwuYW1vdW50IHx8IDApOwogICAgY29uc3QgcGN0ID0gYnVkZ2V0ID4gMCA/IE1hdGgubWluKGFjdHVhbCAvIGJ1ZGdldCAqIDEwMCwgMTAwKSA6IDA7CiAgICBjb25zdCBpc092ZXIgPSBhY3R1YWwgPiBidWRnZXQgJiYgYnVkZ2V0ID4gMDsKICAgIGNvbnN0IGlzU2F2ID0gdHlwZSA9PT0gJ3NhdmluZ3MnOwogICAgY29uc3QgYmFyQ29sb3IgPSBpc1NhdiA/IChhY3R1YWwgPj0gYnVkZ2V0ID8gJyMxMEI5ODEnIDogJyNGNTlFMEInKSA6IChpc092ZXIgPyAnI0VGNDQ0NCcgOiAnIzEwQjk4MScpOwogICAgY29uc3QgYW10Q29sb3IgPSBpc1NhdiA/IChhY3R1YWwgPj0gYnVkZ2V0ID8gJ3ZhcigtLWluY29tZSknIDogJ3ZhcigtLXRleHQtZGFyayknKSA6IChpc092ZXIgPyAndmFyKC0tZXhwZW5zZXMpJyA6ICd2YXIoLS10ZXh0LWRhcmspJyk7CiAgICBjb25zdCBsZWZ0QW10ID0gYnVkZ2V0IC0gYWN0dWFsOwogICAgY29uc3Qgc3RhdHVzTGFiZWwgPSBidWRnZXQgPiAwID8gKGxlZnRBbXQgPCAwID8gZm10KE1hdGguYWJzKGxlZnRBbXQpKSArICcgb3ZlcicgOiBmbXQobGVmdEFtdCkgKyAnIGxlZnQnKSA6ICcnOwogICAgY29uc3QgaWNvbkJnID0gaXNTYXYgPyAnIzEwQjk4MTE4JyA6IChpc092ZXIgPyAnI0VGNDQ0NDE4JyA6ICcjMTBCOTgxMTgnKTsKCiAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImJ1ZGdldC1nb2FsLXJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImJnci10b3AiPgogICAgICAgIDxkaXYgY2xhc3M9ImJnci1pY29uIiBzdHlsZT0iYmFja2dyb3VuZDoke2ljb25CZ307Ij4ke2dvYWwuaWNvbiB8fCAn8J+SuCd9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYmdyLWluZm8iPgogICAgICAgICAgPGRpdiBjbGFzcz0iYmdyLW5hbWUiPiR7Z29hbC5uYW1lfTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iYmdyLXR5cGUiPiR7aXNTYXYgPyAn8J+SsCBTYXZpbmdzIEdvYWwnIDogJ/CfkrggRXhwZW5zZSBCdWRnZXQnfSDCtyAke2dldERpc3BsYXlNb250aChidWRnZXRWaWV3TW9udGgpfTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImJnci1yaWdodCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJiZ3Itc3BlbnQiIHN0eWxlPSJjb2xvcjoke2FtdENvbG9yfTsiPiR7Zm10KGFjdHVhbCl9PC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJiZ3ItYnVkZ2V0Ij5vZiAke2ZtdChidWRnZXQpfTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iYmdyLWJhciI+PGRpdiBjbGFzcz0iYmdyLWJhci1maWxsIiBzdHlsZT0id2lkdGg6JHtwY3R9JTtiYWNrZ3JvdW5kOiR7YmFyQ29sb3J9OyI+PC9kaXY+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImJnci1hY3Rpb25zIj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJiZ3ItYWN0aW9uLWJ0biIgc3R5bGU9ImJhY2tncm91bmQ6dmFyKC0teWVsbG93LWxpZ2h0KTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyIgb25jbGljaz0ib3BlbkJ1ZGdldENhdERldGFpbCgnJHt0eXBlfScsJyR7Z29hbC5rZXl9JykiPvCfk4ogRGV0YWlsczwvYnV0dG9uPgogICAgICAgIDxidXR0b24gY2xhc3M9ImJnci1hY3Rpb24tYnRuIiBzdHlsZT0iYmFja2dyb3VuZDojRjBGOEZGO2NvbG9yOiM0QTlFRkY7IiBvbmNsaWNrPSJvcGVuRWRpdEJ1ZGdldFBvcHVwKCcke2dvYWwua2V5fScsJyR7dHlwZX0nKSI+4pyP77iPIEVkaXQ8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwp9CgovLyBTaGFyZWQgZnVuY3Rpb24gdG8gKHJlKWJ1aWxkIHRoZSBkZXRhaWwgdmlldyBmb3IgYSBnaXZlbiBnb2FsCmZ1bmN0aW9uIF9yZW5kZXJCdWRnZXREZXRhaWwocHJlZml4LCBnb2FsLCB0eXBlKSB7CiAgY29uc3QgYWN0dWFsICA9IGdldEJ1ZGdldEFjdHVhbChnb2FsLCBidWRnZXRWaWV3TW9udGgpOwogIGNvbnN0IGJ1ZGdldCAgPSBOdW1iZXIoZ29hbC5hbW91bnQgfHwgMCk7CiAgY29uc3QgbGVmdEFtdCA9IGJ1ZGdldCAtIGFjdHVhbDsKICBjb25zdCBpc092ZXIgID0gYWN0dWFsID4gYnVkZ2V0ICYmIGJ1ZGdldCA+IDA7CiAgY29uc3QgaXNTYXYgICA9IHR5cGUgPT09ICdzYXZpbmdzJzsKCiAgLy8gSGVhZGVyCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0taWNvbmApLnRleHRDb250ZW50ICA9IGdvYWwuaWNvbiB8fCAoaXNTYXYgPyAn8J+SsCcgOiAn8J+SuCcpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LW5hbWVgKS50ZXh0Q29udGVudCAgPSBnb2FsLm5hbWU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tc3BlbnRgKS5pbm5lckhUTUwgICA9CiAgICBgPHNwYW4gc3R5bGU9ImNvbG9yOiR7aXNPdmVyPyd2YXIoLS1leHBlbnNlcyknOid2YXIoLS10ZXh0LWRhcmspJ307Ij4ke2ZtdChhY3R1YWwpfSBzcGVudDwvc3Bhbj5gICsKICAgIGAgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXRleHQtbGlnaHQpOyI+LyAke2ZtdChidWRnZXQpfSAke2lzU2F2Pydnb2FsJzonYnVkZ2V0J308L3NwYW4+YCArCiAgICBgIMK3IDxzcGFuIHN0eWxlPSJjb2xvcjoke2lzT3Zlcj8ndmFyKC0tZXhwZW5zZXMpJzondmFyKC0taW5jb21lKSd9OyI+JHtpc092ZXIgPyBmbXQoTWF0aC5hYnMobGVmdEFtdCkpKycgb3ZlcicgOiBmbXQobGVmdEFtdCkrJyBsZWZ0J308L3NwYW4+YDsKCiAgLy8gQnVkZ2V0IGNoaXAgbGFiZWwKICBjb25zdCBjaGlwTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1jaGlwLWxhYmVsYCk7CiAgY29uc3QgY2hpcElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tY2hpcC1pbnB1dGApOwogIGlmIChjaGlwTGFiZWwpIGNoaXBMYWJlbC50ZXh0Q29udGVudCA9IGZtdChidWRnZXQpOwogIGlmIChjaGlwSW5wdXQpIGNoaXBJbnB1dC52YWx1ZSA9IGJ1ZGdldDsKCiAgLy8g4pSA4pSAIENoYXJ0IOKUgOKUgAogIGNvbnN0IG1vbnRoczEyICA9IGdldExhc3QxMk1vbnRocyhidWRnZXRWaWV3TW9udGgpOwogIGNvbnN0IGFjdHVhbHMxMiA9IG1vbnRoczEyLm1hcChtayA9PiBnZXRCdWRnZXRBY3R1YWwoZ29hbCwgbWspKTsKICBjb25zdCBsYWJlbHMxMiAgPSBtb250aHMxMi5tYXAobWsgPT4geyBjb25zdCBbLG1vXSA9IG1rLnNwbGl0KCctJyk7IHJldHVybiBbJ0onLCdGJywnTScsJ0EnLCdNJywnSicsJ0onLCdBJywnUycsJ08nLCdOJywnRCddW3BhcnNlSW50KG1vKS0xXTsgfSk7CiAgY29uc3QgY3VySWR4ICAgID0gbW9udGhzMTIuaW5kZXhPZihidWRnZXRWaWV3TW9udGgpOwoKICBjb25zdCBsaW5lQ29sb3IgPSBpc1NhdiA/ICcjMTBCOTgxJyA6ICcjMUUyQTZFJzsKICBjb25zdCBiYXJDb2xvcnMgPSBhY3R1YWxzMTIubWFwKChhLCBpKSA9PiB7CiAgICBpZiAoaSA9PT0gY3VySWR4KSByZXR1cm4gaXNTYXYgPyAnIzEwQjk4MScgOiAnIzNCNEE5Qyc7CiAgICBpZiAoYnVkZ2V0ID4gMCkgICByZXR1cm4gYSA+IGJ1ZGdldCA/ICcjRUY0NDQ0JyA6IChpc1NhdiA/ICcjMTBCOTgxOTknIDogJyMxMEI5ODE5OScpOwogICAgcmV0dXJuICcjMTBCOTgxOTknOwogIH0pOwoKICBjb25zdCBjaGFydElkID0gYGJjZC0ke3ByZWZpeH0tY2hhcnRgOwogIGlmIChjaGFydHNbY2hhcnRJZF0pIHsgY2hhcnRzW2NoYXJ0SWRdLmRlc3Ryb3koKTsgZGVsZXRlIGNoYXJ0c1tjaGFydElkXTsgfQogIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNoYXJ0SWQpOwogIGlmICghY3R4KSByZXR1cm47CgogIGNoYXJ0c1tjaGFydElkXSA9IG5ldyBDaGFydChjdHgsIHsKICAgIHR5cGU6ICdiYXInLAogICAgZGF0YTogewogICAgICBsYWJlbHM6IGxhYmVsczEyLAogICAgICBkYXRhc2V0czogWwogICAgICAgIHsKICAgICAgICAgIGxhYmVsOiAnU3BlbnQnLAogICAgICAgICAgZGF0YTogYWN0dWFsczEyLAogICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBiYXJDb2xvcnMsCiAgICAgICAgICBib3JkZXJSYWRpdXM6IDYsCiAgICAgICAgICBiYXJQZXJjZW50YWdlOiAwLjY1LAogICAgICAgICAgb3JkZXI6IDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGxhYmVsOiAnQnVkZ2V0JywKICAgICAgICAgIGRhdGE6IG1vbnRoczEyLm1hcCgoKSA9PiBidWRnZXQpLAogICAgICAgICAgdHlwZTogJ2xpbmUnLAogICAgICAgICAgYm9yZGVyQ29sb3I6IGxpbmVDb2xvciwKICAgICAgICAgIGJvcmRlcldpZHRoOiAyLjUsCiAgICAgICAgICBib3JkZXJEYXNoOiBbNiwgNF0sCiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsCiAgICAgICAgICBwb2ludFJhZGl1czogMCwKICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IDAsCiAgICAgICAgICBvcmRlcjogMSwKICAgICAgICAgIC8vIERyYXcgYSBzb2xpZCBkb3QgYXQgdGhlIHJpZ2h0bW9zdCBwb2ludCB0byBhbmNob3IgdGhlIGNoaXAgdmlzdWFsbHkKICAgICAgICAgIHBvaW50UmFkaXVzOiBtb250aHMxMi5tYXAoKF8sIGkpID0+IGkgPT09IG1vbnRoczEyLmxlbmd0aCAtIDEgPyA0IDogMCksCiAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogbGluZUNvbG9yCiAgICAgICAgfQogICAgICBdCiAgICB9LAogICAgb3B0aW9uczogewogICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSwKICAgICAgcGx1Z2luczogewogICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgIHRvb2x0aXA6IHsKICAgICAgICAgIGNhbGxiYWNrczogewogICAgICAgICAgICBsYWJlbDogYyA9PiAoYy5kYXRhc2V0LmxhYmVsIHx8ICcnKSArICc6ICcgKyBmbXQoTnVtYmVyKGMucmF3IHx8IDApKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgc2NhbGVzOiB7CiAgICAgICAgeDogewogICAgICAgICAgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgICAgdGlja3M6IHsgZm9udDogeyBzaXplOiA5LCBmYW1pbHk6ICdOdW5pdG8nLCB3ZWlnaHQ6ICc3MDAnIH0sIGNvbG9yOiAnIzlBQTBCMicgfQogICAgICAgIH0sCiAgICAgICAgeTogeyBkaXNwbGF5OiBmYWxzZSB9CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8g4pSA4pSAIE1ldHJpY3Mg4pSA4pSACiAgY29uc3QgeWVhclN0YXJ0ICA9IGJ1ZGdldFZpZXdNb250aC5zcGxpdCgnLScpWzBdOwogIGNvbnN0IHllYXJNb250aHMgPSBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoayA9PiBrLnN0YXJ0c1dpdGgoeWVhclN0YXJ0ICsgJy0nKSAmJiAhay5zdGFydHNXaXRoKCdfJykpOwogIGNvbnN0IHllYXJUb3RhbCAgPSB5ZWFyTW9udGhzLnJlZHVjZSgocywgbWspID0+IHMgKyBnZXRCdWRnZXRBY3R1YWwoZ29hbCwgbWspLCAwKTsKICBjb25zdCBhdmdQZXJNb250aCA9IHllYXJNb250aHMubGVuZ3RoID4gMCA/IHllYXJUb3RhbCAvIHllYXJNb250aHMu','bGVuZ3RoIDogMDsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tbWV0cmljc2ApLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtY2FyZCI+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1sYWJlbCI+VG90YWwgJHt5ZWFyU3RhcnR9PC9kaXY+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy12YWwiPiR7Zm10KHllYXJUb3RhbCl9PC9kaXY+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJiY2QtbWV0cmljLWNhcmQiPjxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtbGFiZWwiPkF2ZyAvIE1vbnRoPC9kaXY+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy12YWwiPiR7Zm10KGF2Z1Blck1vbnRoKX08L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtY2FyZCI+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1sYWJlbCI+JHtpc1NhdiA/ICdNb250aGx5IEdvYWwnIDogJ01vbnRobHkgQnVkZ2V0J308L2Rpdj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLXZhbCI+JHtmbXQoYnVkZ2V0KX08L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJjZC1tZXRyaWMtY2FyZCI+PGRpdiBjbGFzcz0iYmNkLW1ldHJpYy1sYWJlbCI+JHtpc092ZXIgPyAnT3ZlciBieScgOiAnUmVtYWluaW5nJ308L2Rpdj48ZGl2IGNsYXNzPSJiY2QtbWV0cmljLXZhbCIgc3R5bGU9ImNvbG9yOiR7aXNPdmVyPyd2YXIoLS1leHBlbnNlcyknOid2YXIoLS1pbmNvbWUpJ307Ij4ke2ZtdChNYXRoLmFicyhsZWZ0QW10KSl9PC9kaXY+PC9kaXY+CiAgYDsKCiAgLy8g4pSA4pSAIFRyYW5zYWN0aW9ucyDilIDilIAKICBlbnN1cmVNb250aChidWRnZXRWaWV3TW9udGgpOwogIGNvbnN0IG0gICAgPSBkYXRhW2J1ZGdldFZpZXdNb250aF07CiAgY29uc3QgY2F0cyA9IChnb2FsLmxpbmtlZENhdHMgfHwgW2dvYWwua2V5XSkubWFwKGMgPT4gYy50b0xvd2VyQ2FzZSgpLnRyaW0oKSk7CiAgbGV0IHR4bnMgICA9IFtdOwogIFsnZXhwZW5zZXMnLCAnaW52ZXN0bWVudHMnLCAnYWRkaXRpb25hbCddLmZvckVhY2gobGlzdEtleSA9PiB7CiAgICAobVtsaXN0S2V5XSB8fCBbXSkuZm9yRWFjaChlID0+IHsKICAgICAgY29uc3QgZWMgPSAoZS5jYXRlZ29yeSB8fCAnJykudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgIGlmIChjYXRzLnNvbWUoYyA9PiBlYy5pbmNsdWRlcyhjKSkpIHR4bnMucHVzaCh7IC4uLmUsIF90eXBlOiBsaXN0S2V5IH0pOwogICAgfSk7CiAgfSk7CiAgdHhucy5zb3J0KChhLCBiKSA9PiAoYi5kYXRlIHx8ICcnKS5sb2NhbGVDb21wYXJlKGEuZGF0ZSB8fCAnJykpOwoKICBjb25zdCB0eG5Nb250aExhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tdHhuLW1vbnRoYCk7CiAgaWYgKHR4bk1vbnRoTGFiZWwpIHR4bk1vbnRoTGFiZWwudGV4dENvbnRlbnQgPSBgJHtnZXREaXNwbGF5TW9udGgoYnVkZ2V0Vmlld01vbnRoKX0gVHJhbnNhY3Rpb25zICgke3R4bnMubGVuZ3RofSlgOwoKICBjb25zdCB0eG5zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS10eG5zYCk7CiAgaWYgKHR4bnNFbCkgewogICAgdHhuc0VsLmlubmVySFRNTCA9IHR4bnMubGVuZ3RoID09PSAwCiAgICAgID8gYDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO3BhZGRpbmc6MjBweDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtO2ZvbnQtd2VpZ2h0OjcwMDsiPk5vIHRyYW5zYWN0aW9ucyB0aGlzIG1vbnRoPC9kaXY+YAogICAgICA6IHR4bnMubWFwKHQgPT4gewogICAgICAgICAgY29uc3QgZCAgID0gdC5kYXRlID8gbmV3IERhdGUodC5kYXRlICsgJ1QwMDowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCB7IG1vbnRoOidzaG9ydCcsIGRheTonbnVtZXJpYycgfSkgOiAnJzsKICAgICAgICAgIGNvbnN0IGFtdCA9IGNvbnZlcnRBbXQodC5hbW91bnQsIHQuY3VycmVuY3kpOwogICAgICAgICAgY29uc3QgYW10Q29sb3IgPSBpc1NhdiA/ICd2YXIoLS1pbmNvbWUpJyA6ICd2YXIoLS1leHBlbnNlcyknOwogICAgICAgICAgY29uc3QgbWV0YWxUYWcgPSB0Lm1ldGFsR3JhbXMgPyBgIMK3ICR7dC5tZXRhbEdyYW1zfWcgJHt0Lm1ldGFsVHlwZXx8Jyd9YCA6ICcnOwogICAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJiY2QtdHgtcm93Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmNkLXR4LWljb24iIHN0eWxlPSJiYWNrZ3JvdW5kOiR7aXNTYXY/JyMxMEI5ODExNSc6JyNFRjQ0NDQxNSd9OyI+JHtnb2FsLmljb24gfHwgKGlzU2F2Pyfwn5KwJzon8J+SuCcpfTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiY2QtdHgtaW5mbyI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmNkLXR4LW5hbWUiPiR7dC5kZXNjcmlwdGlvbiB8fCB0LmNhdGVnb3J5IHx8ICdUcmFuc2FjdGlvbid9PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmNkLXR4LWRhdGUiPiR7ZH0ke3QuY2F0ZWdvcnkgPyAnIMK3ICcgKyB0LmNhdGVnb3J5IDogJyd9JHttZXRhbFRhZ308L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJjZC10eC1hbXQiIHN0eWxlPSJjb2xvcjoke2FtdENvbG9yfTsiPiR7aXNTYXY/JysnOictJ30ke2ZtdChhbXQpfTwvZGl2PgogICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9KS5qb2luKCcnKTsKICB9Cn0KCmZ1bmN0aW9uIG9wZW5CdWRnZXRDYXREZXRhaWwodHlwZSwgZ29hbEtleSkgewogIGN1cnJlbnRCdWRnZXRDYXREZXRhaWwgPSB7IHR5cGUsIGdvYWxLZXkgfTsKICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKHR5cGUpOwogIGNvbnN0IGdvYWwgID0gZ29hbHMuZmluZChnID0+IGcua2V5ID09PSBnb2FsS2V5KTsKICBpZiAoIWdvYWwpIHJldHVybjsKCiAgLy8gU3dpdGNoIHRhYgogIGlmICh0eXBlID09PSAnc2F2aW5ncycgJiYgY3VycmVudEJ1ZGdldFRhYiAhPT0gJ3NhdmluZ3MnKSB7CiAgICBzZXRCdWRnZXRUYWIoJ3NhdmluZ3MnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRhYi1zYXZpbmdzJykpOwogIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2V4cGVuc2UnICYmIGN1cnJlbnRCdWRnZXRUYWIgIT09ICdleHBlbnNlcycpIHsKICAgIHNldEJ1ZGdldFRhYignZXhwZW5zZXMnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRhYi1leHBlbnNlcycpKTsKICB9CgogIGNvbnN0IHByZWZpeCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdzYXYnIDogJ2V4cCc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjYXQtZGV0YWlsLSR7dHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdmluZ3MnIDogJ2V4cGVuc2VzJ31gKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJsaXN0LSR7dHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdmluZ3MnIDogJ2V4cGVuc2VzJ31gKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICBfcmVuZGVyQnVkZ2V0RGV0YWlsKHByZWZpeCwgZ29hbCwgdHlwZSk7Cn0KCmZ1bmN0aW9uIGNsb3NlQnVkZ2V0Q2F0RGV0YWlsKHR5cGUpIHsKICBjdXJyZW50QnVkZ2V0Q2F0RGV0YWlsID0gbnVsbDsKICBjb25zdCBkZXRhaWxJZCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdiY2F0LWRldGFpbC1zYXZpbmdzJyA6ICdiY2F0LWRldGFpbC1leHBlbnNlcyc7CiAgY29uc3QgbGlzdElkICAgPSB0eXBlID09PSAnc2F2aW5ncycgPyAnYmxpc3Qtc2F2aW5ncycgOiAnYmxpc3QtZXhwZW5zZXMnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRldGFpbElkKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGlzdElkKS5zdHlsZS5kaXNwbGF5ID0gJyc7Cn0KCi8vIOKUgOKUgCBCdWRnZXQgY2hpcDogY2xpY2sgdG8gZWRpdCBpbmxpbmUg4pSA4pSACmZ1bmN0aW9uIGFjdGl2YXRlQnVkZ2V0Q2hpcCh0eXBlKSB7CiAgY29uc3QgcHJlZml4ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ3NhdicgOiAnZXhwJzsKICBjb25zdCBjaGlwICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgYmNkLSR7cHJlZml4fS1jaGlwYCk7CiAgY29uc3QgaW5wdXQgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tY2hpcC1pbnB1dGApOwogIGlmICghY2hpcCB8fCBjaGlwLmNsYXNzTGlzdC5jb250YWlucygnZWRpdGluZycpKSByZXR1cm47CiAgY2hpcC5jbGFzc0xpc3QuYWRkKCdlZGl0aW5nJyk7CiAgaW5wdXQuZm9jdXMoKTsKICBpbnB1dC5zZWxlY3QoKTsKfQoKZnVuY3Rpb24gc2F2ZUJ1ZGdldENoaXAodHlwZSkgewogIGNvbnN0IHByZWZpeCA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdzYXYnIDogJ2V4cCc7CiAgY29uc3QgY2hpcCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGJjZC0ke3ByZWZpeH0tY2hpcGApOwogIGNvbnN0IGlucHV0ICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LWNoaXAtaW5wdXRgKTsKICBpZiAoIWNoaXAgfHwgIWNoaXAuY2xhc3NMaXN0LmNvbnRhaW5zKCdlZGl0aW5nJykpIHJldHVybjsKCiAgY29uc3QgbmV3QW10ID0gcGFyc2VGbG9hdChpbnB1dC52YWx1ZSk7CiAgaWYgKGlzTmFOKG5ld0FtdCkgfHwgbmV3QW10IDwgMCkgeyBjYW5jZWxCdWRnZXRDaGlwKHR5cGUpOyByZXR1cm47IH0KCiAgLy8gU2F2ZSB0byBkYXRhCiAgY29uc3QgZGV0ICA9IGN1cnJlbnRCdWRnZXRDYXREZXRhaWw7CiAgaWYgKCFkZXQpIHsgY2FuY2VsQnVkZ2V0Q2hpcCh0eXBlKTsgcmV0dXJuOyB9CiAgY29uc3Qgc3RvcmFnZUtleSA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdfc2F2aW5nc0dvYWxzJyA6ICdfZXhwZW5zZUdvYWxzJzsKICBjb25zdCBnb2FscyA9IGRhdGFbc3RvcmFnZUtleV0gfHwgW107CiAgY29uc3QgZ29hbCAgPSBnb2Fscy5maW5kKGcgPT4gZy5rZXkgPT09IGRldC5nb2FsS2V5KTsKICBpZiAoZ29hbCkgewogICAgZ29hbC5hbW91bnQgPSBuZXdBbXQ7CiAgICBzYXZlKCk7CiAgICBzaG93VG9hc3QoYOKchSBCdWRnZXQgdXBkYXRlZCB0byAke2ZtdChuZXdBbXQpfWApOwogICAgLy8gUmUtcmVuZGVyIGV2ZXJ5dGhpbmcKICAgIGNoaXAuY2xhc3NMaXN0LnJlbW92ZSgnZWRpdGluZycpOwogICAgX3JlbmRlckJ1ZGdldERldGFpbChwcmVmaXgsIGdvYWwsIHR5cGUpOwogICAgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7IC8vIHJlZnJlc2ggYnViYmxlcyAmIGhlcm8gdG9vCiAgfSBlbHNlIHsKICAgIGNhbmNlbEJ1ZGdldENoaXAodHlwZSk7CiAgfQp9CgpmdW5jdGlvbiBjYW5jZWxCdWRnZXRDaGlwKHR5cGUpIHsKICBjb25zdCBwcmVmaXggPSB0eXBlID09PSAnc2F2aW5ncycgPyAnc2F2JyA6ICdleHAnOwogIGNvbnN0IGNoaXAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBiY2QtJHtwcmVmaXh9LWNoaXBgKTsKICBpZiAoY2hpcCkgY2hpcC5jbGFzc0xpc3QucmVtb3ZlKCdlZGl0aW5nJyk7Cn0KCi8vIEVkaXQgQnVkZ2V0IFBvcHVwCmNvbnN0IEJVREdFVF9FTU9KSV9QQU5FTF9PUFRTID0gWyfwn5K4Jywn8J+bkicsJ/CfmpcnLCfwn4+gJywn8J+SiicsJ/Cfjq0nLCfwn42UJywn4piVJywn8J+OkycsJ/CfkL4nLCfinIjvuI8nLCfwn5GXJywn8J+OricsJ/Cfj4vvuI8nLCfwn46BJywn8J+TsScsJ+KaoScsJ/CfmownLCfwn5KwJywn8J+TiCcsJ/CfpYcnLCfwn4+mJywn8J+MiicsJ/Cfjq8nXTsKCmZ1bmN0aW9uIG9wZW5FZGl0QnVkZ2V0UG9wdXAoZ29hbEtleSwgZm9yY2VUeXBlKSB7CiAgZWRpdGluZ0J1ZGdldEtleSA9IGdvYWxLZXkgfHwgbnVsbDsKICBlZGl0aW5nQnVkZ2V0VHlwZSA9IGZvcmNlVHlwZSB8fCBjdXJyZW50QnVkZ2V0VGFiID09PSAnc2F2aW5ncycgPyAnc2F2aW5ncycgOiAnZXhwZW5zZSc7CiAgaWYgKGZvcmNlVHlwZSkgZWRpdGluZ0J1ZGdldFR5cGUgPSBmb3JjZVR5cGU7CgogIGNvbnN0IHBvcHVwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtYnVkZ2V0LXBvcHVwJyk7CiAgY29uc3QgZGVsQnRuID0gZG9j','dW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1kZWwtYnRuJyk7CgogIC8vIFJlbmRlciBlbW9qaSByb3cKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWVtb2ppLXJvdycpLmlubmVySFRNTCA9IEJVREdFVF9FTU9KSV9QQU5FTF9PUFRTLm1hcChlID0+CiAgICBgPGRpdiBjbGFzcz0iZWJwLWVtb2ppLW9wdCAke2UgPT09IHBpY2tlZEJ1ZGdldEVtb2ppID8gJ3BpY2tlZCcgOiAnJ30iIG9uY2xpY2s9InBpY2tCdWRnZXRFbW9qaSgnJHtlfScpIj4ke2V9PC9kaXY+YAogICkuam9pbignJyk7CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtdHlwZScpLnZhbHVlID0gZWRpdGluZ0J1ZGdldFR5cGU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC10aXRsZScpLnRleHRDb250ZW50ID0gZ29hbEtleSA/ICfinI/vuI8gRWRpdCBCdWRnZXQgR29hbCcgOiAn4p6VIEFkZCBCdWRnZXQgR29hbCc7CgogIGlmIChnb2FsS2V5KSB7CiAgICBjb25zdCBnb2FscyA9IGdldEJ1ZGdldEdvYWxzKGVkaXRpbmdCdWRnZXRUeXBlKTsKICAgIGNvbnN0IGdvYWwgPSBnb2Fscy5maW5kKGcgPT4gZy5rZXkgPT09IGdvYWxLZXkpOwogICAgaWYgKGdvYWwpIHsKICAgICAgcGlja2VkQnVkZ2V0RW1vamkgPSBnb2FsLmljb24gfHwgJ/CfkrgnOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLW5hbWUnKS52YWx1ZSA9IGdvYWwubmFtZSB8fCBnb2FsLmtleTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1hbW91bnQnKS52YWx1ZSA9IGdvYWwuYW1vdW50IHx8ICcnOwogICAgICBpbml0TGlua2VkQ2F0UGlja2VyKGdvYWwubGlua2VkQ2F0cyB8fCBbXSwgZWRpdGluZ0J1ZGdldFR5cGUpOwogICAgICBkZWxCdG4uc3R5bGUuZGlzcGxheSA9ICcnOwogICAgfQogIH0gZWxzZSB7CiAgICBwaWNrZWRCdWRnZXRFbW9qaSA9ICfwn5K4JzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbmFtZScpLnZhbHVlID0gJyc7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWFtb3VudCcpLnZhbHVlID0gJyc7CiAgICBpbml0TGlua2VkQ2F0UGlja2VyKFtdLCBlZGl0aW5nQnVkZ2V0VHlwZSk7CiAgICBkZWxCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICB9CgogIC8vIFJlLXJlbmRlciBlbW9qaSByb3cgd2l0aCBzZWxlY3Rpb24KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWVtb2ppLXJvdycpLmlubmVySFRNTCA9IEJVREdFVF9FTU9KSV9QQU5FTF9PUFRTLm1hcChlID0+CiAgICBgPGRpdiBjbGFzcz0iZWJwLWVtb2ppLW9wdCAke2UgPT09IHBpY2tlZEJ1ZGdldEVtb2ppID8gJ3BpY2tlZCcgOiAnJ30iIG9uY2xpY2s9InBpY2tCdWRnZXRFbW9qaSgnJHtlfScpIj4ke2V9PC9kaXY+YAogICkuam9pbignJyk7CgogIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTsKfQoKZnVuY3Rpb24gcGlja0J1ZGdldEVtb2ppKGUpIHsKICBwaWNrZWRCdWRnZXRFbW9qaSA9IGU7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmVicC1lbW9qaS1vcHQnKS5mb3JFYWNoKGVsID0+IGVsLmNsYXNzTGlzdC5yZW1vdmUoJ3BpY2tlZCcpKTsKICBldmVudC50YXJnZXQuY2xhc3NMaXN0LmFkZCgncGlja2VkJyk7Cn0KCmZ1bmN0aW9uIGNsb3NlRWRpdEJ1ZGdldFBvcHVwKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0LWJ1ZGdldC1wb3B1cCcpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsKfQoKZnVuY3Rpb24gc2F2ZUVkaXRlZEJ1ZGdldCgpIHsKICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1uYW1lJykudmFsdWUudHJpbSgpOwogIGNvbnN0IGFtb3VudCA9IHBhcnNlRmxvYXQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1hbW91bnQnKS52YWx1ZSkgfHwgMDsKICBjb25zdCB0eXBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC10eXBlJykudmFsdWU7CiAgY29uc3QgbGlua2VkQ2F0c1JhdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbGlua2VkLWNhdHMnKS52YWx1ZS50cmltKCk7CiAgY29uc3QgbGlua2VkQ2F0cyA9IGxpbmtlZENhdHNSYXcgPyBsaW5rZWRDYXRzUmF3LnNwbGl0KCcsJykubWFwKGMgPT4gYy50cmltKCkpLmZpbHRlcihCb29sZWFuKSA6IFtuYW1lXTsKCiAgaWYgKCFuYW1lKSB7IHNob3dUb2FzdCgnRW50ZXIgYSBuYW1lIOKdjCcpOyByZXR1cm47IH0KICBpZiAoIWFtb3VudCkgeyBzaG93VG9hc3QoJ0VudGVyIGEgYnVkZ2V0IGFtb3VudCDinYwnKTsgcmV0dXJuOyB9CgogIGNvbnN0IGdvYWxzID0gZ2V0QnVkZ2V0R29hbHModHlwZSk7CiAgY29uc3Qga2V5ID0gZWRpdGluZ0J1ZGdldEtleSB8fCBuYW1lLnJlcGxhY2UoL1xzKy9nLCAnXycpOwoKICBpZiAoZWRpdGluZ0J1ZGdldEtleSkgewogICAgY29uc3QgaWR4ID0gZ29hbHMuZmluZEluZGV4KGcgPT4gZy5rZXkgPT09IGVkaXRpbmdCdWRnZXRLZXkpOwogICAgaWYgKGlkeCA+PSAwKSB7CiAgICAgIGdvYWxzW2lkeF0gPSB7Li4uZ29hbHNbaWR4XSwgbmFtZSwgYW1vdW50LCBpY29uOiBwaWNrZWRCdWRnZXRFbW9qaSwgbGlua2VkQ2F0c307CiAgICB9CiAgfSBlbHNlIHsKICAgIGdvYWxzLnB1c2goe2tleSwgbmFtZSwgaWNvbjogcGlja2VkQnVkZ2V0RW1vamksIGFtb3VudCwgbGlua2VkQ2F0c30pOwogIH0KCiAgY29uc3Qgc3RvcmFnZUtleSA9IHR5cGUgPT09ICdzYXZpbmdzJyA/ICdfc2F2aW5nc0dvYWxzJyA6ICdfZXhwZW5zZUdvYWxzJzsKICBkYXRhW3N0b3JhZ2VLZXldID0gZ29hbHM7CiAgc2F2ZSgpOwogIGNsb3NlRWRpdEJ1ZGdldFBvcHVwKCk7CiAgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7CiAgc2hvd1RvYXN0KGDinIUgIiR7bmFtZX0iICR7ZWRpdGluZ0J1ZGdldEtleSA/ICd1cGRhdGVkJyA6ICdhZGRlZCd9IWApOwp9CgpmdW5jdGlvbiBkZWxldGVFZGl0ZWRCdWRnZXQoKSB7CiAgaWYgKCFlZGl0aW5nQnVkZ2V0S2V5KSByZXR1cm47CiAgY29uc3QgdHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtdHlwZScpLnZhbHVlOwogIGNvbnN0IGdvYWxzID0gZ2V0QnVkZ2V0R29hbHModHlwZSk7CiAgY29uc3QgZ29hbCA9IGdvYWxzLmZpbmQoZyA9PiBnLmtleSA9PT0gZWRpdGluZ0J1ZGdldEtleSk7CiAgaWYgKCFnb2FsKSByZXR1cm47CiAgaWYgKCFjb25maXJtKGBEZWxldGUgIiR7Z29hbC5uYW1lfSI/YCkpIHJldHVybjsKICBjb25zdCBzdG9yYWdlS2V5ID0gdHlwZSA9PT0gJ3NhdmluZ3MnID8gJ19zYXZpbmdzR29hbHMnIDogJ19leHBlbnNlR29hbHMnOwogIGRhdGFbc3RvcmFnZUtleV0gPSBnb2Fscy5maWx0ZXIoZyA9PiBnLmtleSAhPT0gZWRpdGluZ0J1ZGdldEtleSk7CiAgc2F2ZSgpOwogIGNsb3NlRWRpdEJ1ZGdldFBvcHVwKCk7CiAgY2xvc2VCdWRnZXRDYXREZXRhaWwodHlwZSk7CiAgcmVuZGVyQnVkZ2V0TW9kdWxlKCk7CiAgc2hvd1RvYXN0KGDwn5eR77iPICIke2dvYWwubmFtZX0iIHJlbW92ZWRgKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIEZBQiBTTUFSVCBMQVVOQ0hFUgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKbGV0IGZhYk9wZW4gPSBmYWxzZTsKCmZ1bmN0aW9uIHRvZ2dsZUZhYk1lbnUoKSB7CiAgZmFiT3BlbiA/IGNsb3NlRmFiTWVudSgpIDogb3BlbkZhYk1lbnUoKTsKfQoKZnVuY3Rpb24gb3BlbkZhYk1lbnUoKSB7CiAgZmFiT3BlbiA9IHRydWU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1hZGQtYnRuJykuY2xhc3NMaXN0LmFkZCgnb3BlbicpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYmFja2Ryb3AnKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7CiAgLy8gU3RhZ2dlciBpdGVtcyBpbiByZXZlcnNlIHNvIGJvdHRvbSBpdGVtIGFwcGVhcnMgZmlyc3QKICBbJ2ZtaS1leHBlbnNlJywnZm1pLWluY29tZScsJ2ZtaS1pbnZlc3RtZW50J10uZm9yRWFjaCgoaWQsIGkpID0+IHsKICAgIHNldFRpbWVvdXQoKCkgPT4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKSwgaSAqIDQwKTsKICB9KTsKfQoKZnVuY3Rpb24gY2xvc2VGYWJNZW51KCkgewogIGZhYk9wZW4gPSBmYWxzZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLWFkZC1idG4nKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1iYWNrZHJvcCcpLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZmFiLW1lbnUtaXRlbScpLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpKTsKfQoKLy8gQ2xvc2UgRkFCIHdoZW4gUXVpY2sgQWRkIG9wZW5zCmNvbnN0IF9vcmlnT3BlblF1aWNrQWRkID0gb3BlblF1aWNrQWRkOwovLyAoY2xvc2VGYWJNZW51IGlzIGNhbGxlZCBpbmxpbmUgb24gZWFjaCBtZW51IGJ1dHRvbiBjbGljayDigJQgbm8gd3JhcCBuZWVkZWQpCgovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gTkVUIFdPUlRIIE1PRFVMRSDigJQgQWNjb3VudC1iYXNlZCBzeXN0ZW0KLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCgpjb25zdCBOV19UWVBFUyA9IHsKICBjaGVja2luZzogICAgICAgIHsgbGFiZWw6J0NoZWNraW5nIEFjY291bnQnLCAgICAgICBlbW9qaTon8J+PpicsIGNvbG9yOicjNEE5RUZGJywgICBpc0xpYWI6ZmFsc2UgfSwKICBzYXZpbmdzX2FjYzogICAgIHsgbGFiZWw6J1NhdmluZ3MgQWNjb3VudCcsICAgICAgICBlbW9qaTon8J+StScsIGNvbG9yOicjMTBCOTgxJywgICBpc0xpYWI6ZmFsc2UgfSwKICBicm9rZXJhZ2U6ICAgICAgIHsgbGFiZWw6J0Jyb2tlcmFnZSAvIEludmVzdG1lbnQnLCBlbW9qaTon8J+TiCcsIGNvbG9yOicjN0MzQUVEJywgICBpc0xpYWI6ZmFsc2UgfSwKICByZXRpcmVtZW50OiAgICAgIHsgbGFiZWw6J1JldGlyZW1lbnQgQWNjb3VudCcsICAgICBlbW9qaTon8J+Pm++4jycsIGNvbG9yOicjRjU5RTBCJywgICBpc0xpYWI6ZmFsc2UgfSwKICBib25kc19mZDogICAgICAgIHsgbGFiZWw6J0JvbmQgLyBGRCAvIENEJywgICAgICAgICBlbW9qaTon8J+TiycsIGNvbG9yOicjMDZCNkQ0JywgICBpc0xpYWI6ZmFsc2UgfSwKICBtZXRhbHM6ICAgICAgICAgIHsgbGFiZWw6J1ByZWNpb3VzIE1ldGFscycsICAgICAgICBlbW9qaTon8J+lhycsIGNvbG9yOicjQzg5MDBBJywgICBpc0xpYWI6ZmFsc2UgfSwKICByZWFsZXN0YXRlOiAgICAgIHsgbGFiZWw6J1JlYWwgRXN0YXRlJywgICAgICAgICAgICBlbW9qaTon8J+PoScsIGNvbG9yOicjMTBCOTgxJywgICBpc0xpYWI6ZmFsc2UgfSwKICBjYXNoOiAgICAgICAgICAgIHsgbGFiZWw6J0Nhc2ggLyBXYWxsZXQnLCAgICAgICAgICBlbW9qaTon8J+StCcsIGNvbG9yOicjODRDQzE2JywgICBpc0xpYWI6ZmFsc2UgfSwKICBjcmVkaXRfY2FyZDog','ICAgIHsgbGFiZWw6J0NyZWRpdCBDYXJkJywgICAgICAgICAgICBlbW9qaTon8J+SsycsIGNvbG9yOicjRUY0NDQ0JywgICBpc0xpYWI6dHJ1ZSAgfSwKICBsb2FuOiAgICAgICAgICAgIHsgbGFiZWw6J0xvYW4gLyBNb3J0Z2FnZScsICAgICAgICBlbW9qaTon8J+PoCcsIGNvbG9yOicjRjk3MzE2JywgICBpc0xpYWI6dHJ1ZSAgfSwKICBvdGhlcl9saWFiaWxpdHk6IHsgbGFiZWw6J090aGVyIExpYWJpbGl0eScsICAgICAgICBlbW9qaTon8J+TiScsIGNvbG9yOicjOEI1Q0Y2JywgICBpc0xpYWI6dHJ1ZSAgfSwKfTsKCmNvbnN0IFJFVElSRV9TVUJUWVBFUyA9IFsnNDAxaycsJzQwM2InLCdJUkEnLCdSb3RoIElSQScsJ1BQRicsJ0VQRicsJ05QUycsJ090aGVyJ107CgpmdW5jdGlvbiBnZXROV0FjY291bnRzKCkgewogIGlmICghZGF0YS5fbndBY2NvdW50cykgZGF0YS5fbndBY2NvdW50cyA9IFtdOwogIHJldHVybiBkYXRhLl9ud0FjY291bnRzOwp9CgpmdW5jdGlvbiBnZXROV1NuYXBzaG90cygpIHsKICBpZiAoIWRhdGEuX253U25hcHNob3RzKSBkYXRhLl9ud1NuYXBzaG90cyA9IFtdOwogIHJldHVybiBkYXRhLl9ud1NuYXBzaG90czsKfQoKZnVuY3Rpb24gZ2V0UmVhbEVzdGF0ZUFzc2V0cygpIHsKICBpZiAoIWRhdGEuX3JlYWxFc3RhdGUpIGRhdGEuX3JlYWxFc3RhdGUgPSBbXTsKICByZXR1cm4gZGF0YS5fcmVhbEVzdGF0ZTsKfQoKY29uc3QgSU5SX1RPX1VTRCA9IDAuMDEyOwoKLy8g4pSA4pSAIENvbnZlcnQgYWNjb3VudCBiYWxhbmNlIHRvIGRpc3BsYXkgY3VycmVuY3kg4pSA4pSACmZ1bmN0aW9uIG53Q29udmVydChiYWxhbmNlLCBjdXJyZW5jeSkgewogIGNvbnN0IGIgPSBOdW1iZXIoYmFsYW5jZSB8fCAwKTsKICBjb25zdCBjID0gKGN1cnJlbmN5IHx8IGN1cnJlbnRDdXJyZW5jeS5jb2RlKS50b1VwcGVyQ2FzZSgpOwogIGlmIChjID09PSBjdXJyZW50Q3VycmVuY3kuY29kZSkgcmV0dXJuIGI7CiAgLy8gVXNlIGV4aXN0aW5nIGNvbnZlcnRBbXQgaGVscGVyIHZpYSBhIGZha2UgZW50cnkKICByZXR1cm4gY29udmVydEFtdChiLCBjKTsKfQoKLy8g4pSA4pSAIENvbXB1dGUgbmV0IHdvcnRoIGZyb20gYWNjb3VudHMg4pSA4pSACmZ1bmN0aW9uIGNvbXB1dGVOZXRXb3J0aCgpIHsKICBjb25zdCBhY2NvdW50cyA9IGdldE5XQWNjb3VudHMoKTsKICBjb25zdCBieVR5cGUgPSB7fTsKICBsZXQgdG90YWxBc3NldHMgPSAwLCBsaWFiVG90YWwgPSAwOwoKICAvLyBBbHNvIHB1bGwgbWV0YWxzIGZyb20gaW1wb3J0IGRhdGEgYXMgcmVhZC1vbmx5IHJlZmVyZW5jZSDigJQgb25lIHJvdyBwZXIgZW50cnkKICBjb25zdCBtZXRhbHNGcm9tSW1wb3J0ID0gKGRhdGEuX21ldGFscyB8fCBbXSkubWFwKChtLCBpZHgpID0+IHsKICAgIGNvbnN0IG1jID0gTUVUQUxfQ09ORklHW20ubWV0YWxUeXBlXSB8fCBNRVRBTF9DT05GSUdbJ2dvbGQnXTsKICAgIGNvbnN0IGdyYW1zID0gTnVtYmVyKG0uZ3JhbXMgfHwgbS53ZWlnaHRHbXMgfHwgMCk7CiAgICBjb25zdCBwcmljZSA9IE51bWJlcihtLnByaWNlIHx8IDApIHx8IGdldFByaWNlRm9yTWV0YWwobS5tZXRhbFR5cGV8fCdnb2xkJywgbS5wdXJpdHkpOwogICAgY29uc3QgdmFsID0gZ3JhbXMgKiBwcmljZTsKICAgIGNvbnN0IG96ID0gKGdyYW1zIC8gMzEuMTAzNSkudG9GaXhlZCgzKTsKICAgIC8vIEJ1aWxkIGEgZGVzY3JpcHRpdmUgbmFtZTogIkdvbGQgwrcgMjJLIMK3IEJhbmdsZSIgb3IganVzdCAiR29sZCDCtyAxMGciCiAgICBjb25zdCBuYW1lUGFydHMgPSBbbWMuZW1vamkgKyAnICcgKyAoKG0ubWV0YWxUeXBlfHwnZ29sZCcpLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpKyhtLm1ldGFsVHlwZXx8J2dvbGQnKS5zbGljZSgxKSldOwogICAgaWYgKG0ucHVyaXR5KSAgIG5hbWVQYXJ0cy5wdXNoKG0ucHVyaXR5KTsKICAgIGlmIChtLm9jY2FzaW9uKSBuYW1lUGFydHMucHVzaChtLm9jY2FzaW9uKTsKICAgIGlmICghbS5wdXJpdHkgJiYgIW0ub2NjYXNpb24gJiYgbS5uYW1lICYmIG0ubmFtZSAhPT0gbS5tZXRhbFR5cGUpIG5hbWVQYXJ0cy5wdXNoKG0ubmFtZSk7CiAgICByZXR1cm4gewogICAgICBpZDogJ2ltcG9ydF9tZXRhbF8nICsgaWR4LAogICAgICBuYW1lOiBuYW1lUGFydHMuam9pbignIMK3ICcpLAogICAgICBiYWxhbmNlOiB2YWwsCiAgICAgIGN1cnJlbmN5OiAnVVNEJywKICAgICAgbGFzdFVwZGF0ZWQ6IG0uZGF0ZSB8fCAnJywKICAgICAgX2ltcG9ydGVkOiB0cnVlLAogICAgICB0eXBlOiAnbWV0YWxzJywKICAgICAgbWV0YTogewogICAgICAgIGdyYW1zLAogICAgICAgIG96LAogICAgICAgIG1ldGFsVHlwZTogbS5tZXRhbFR5cGUsCiAgICAgICAgcHVyaXR5OiBtLnB1cml0eSB8fCAnJywKICAgICAgICBvY2Nhc2lvbjogbS5vY2Nhc2lvbiB8fCAnJywKICAgICAgICBmb3JtOiBtLmZvcm0gfHwgJycsCiAgICAgICAgbm90ZXM6IG0ubm90ZXMgfHwgJycsCiAgICAgICAgb3JpZ2luYWxOYW1lOiBtLm5hbWUgfHwgJycKICAgICAgfQogICAgfTsKICB9KTsKCiAgLy8gQWxzbyBwdWxsIHJlYWwgZXN0YXRlIGZyb20gaW1wb3J0IGRhdGEgYXMgcmVhZC1vbmx5IHJlZmVyZW5jZQogIGNvbnN0IHJlRnJvbUltcG9ydCA9IChkYXRhLl9yZWFsRXN0YXRlIHx8IFtdKS5tYXAoKHAsIGlkeCkgPT4gewogICAgY29uc3QgY3YgPSBOdW1iZXIocC5jdXJyZW50VmFsdWUgfHwgcC5wdXJjaGFzZVZhbHVlIHx8IDApOwogICAgY29uc3QgY3VyciA9IChwLmN1cnJlbmN5IHx8ICdVU0QnKS50b1VwcGVyQ2FzZSgpOwogICAgY29uc3QgdmFsID0gY3VyciA9PT0gJ0lOUicgPyBjdiAqIChJTlJfVE9fVVNEfHwwLjAxMikgOiBud0NvbnZlcnQoY3YsIGN1cnIpOwogICAgY29uc3QgbmFtZVBhcnRzID0gWyfwn4+hJywgcC5kZXNjcmlwdGlvbiB8fCAnUHJvcGVydHknXTsKICAgIGlmIChwLmNvdW50cnkgJiYgcC5jb3VudHJ5ICE9PSAnVVMnKSBuYW1lUGFydHMucHVzaChwLmNvdW50cnkpOwogICAgcmV0dXJuIHsKICAgICAgaWQ6ICdpbXBvcnRfcmVfJyArIGlkeCwKICAgICAgbmFtZTogbmFtZVBhcnRzLmpvaW4oJyAnKSwKICAgICAgYmFsYW5jZTogdmFsLAogICAgICBjdXJyZW5jeTogY3VyciwKICAgICAgbGFzdFVwZGF0ZWQ6IHAuZGF0ZSB8fCAnJywKICAgICAgX2ltcG9ydGVkOiB0cnVlLAogICAgICB0eXBlOiAncmVhbGVzdGF0ZScsCiAgICAgIG1ldGE6IHsKICAgICAgICBwdXJjaGFzZVZhbHVlOiBwLnB1cmNoYXNlVmFsdWUsCiAgICAgICAgY291bnRyeTogcC5jb3VudHJ5LAogICAgICAgIGFyZWE6IHAuYXJlYSwKICAgICAgICBkZXNjcmlwdGlvbjogcC5kZXNjcmlwdGlvbgogICAgICB9CiAgICB9OwogIH0pOwoKICBjb25zdCBhbGxBY2NvdW50cyA9IFsuLi5hY2NvdW50cywgLi4ubWV0YWxzRnJvbUltcG9ydCwgLi4ucmVGcm9tSW1wb3J0XTsKCiAgT2JqZWN0LmtleXMoTldfVFlQRVMpLmZvckVhY2godCA9PiB7IGJ5VHlwZVt0XSA9IHsgdG90YWw6IDAsIGFjY291bnRzOiBbXSB9OyB9KTsKCiAgYWxsQWNjb3VudHMuZm9yRWFjaChhY2MgPT4gewogICAgY29uc3QgdCA9IGFjYy50eXBlOwogICAgaWYgKCFieVR5cGVbdF0pIHJldHVybjsKICAgIGxldCB2YWwgPSBud0NvbnZlcnQoYWNjLmJhbGFuY2UsIGFjYy5jdXJyZW5jeSk7CiAgICAvLyBGb3IgbWV0YWxzIHR5cGUsIGF1dG8tY2FsYyBmcm9tIGdyYW1zIHVzaW5nIHB1cml0eS1hd2FyZSBwcmljaW5nCiAgICBpZiAodCA9PT0gJ21ldGFscycgJiYgYWNjLm1ldGEgJiYgYWNjLm1ldGEuZ3JhbXMpIHsKICAgICAgY29uc3QgbWV0YWxUeXBlID0gYWNjLm1ldGEubWV0YWxUeXBlIHx8ICdnb2xkJzsKICAgICAgY29uc3QgcHVyaXR5ICAgID0gYWNjLm1ldGEucHVyaXR5IHx8ICcnOwogICAgICBjb25zdCBjYWxjUHJpY2UgPSBnZXRQcmljZUZvck1ldGFsKG1ldGFsVHlwZSwgcHVyaXR5KTsKICAgICAgY29uc3QgY2FsY1ZhbCAgID0gTnVtYmVyKGFjYy5tZXRhLmdyYW1zKSAqIGNhbGNQcmljZTsKICAgICAgLy8gVXNlIGNhbGN1bGF0ZWQgdmFsdWUgaWYgbm8gZXhwbGljaXQgYmFsYW5jZSwgb3IgaWYgZXhwbGljaXQgYmFsYW5jZSBpcyAwCiAgICAgIGlmICghTnVtYmVyKGFjYy5iYWxhbmNlKSB8fCBhY2MuX2ltcG9ydGVkKSB2YWwgPSBjYWxjVmFsOwogICAgICBlbHNlIHZhbCA9IE1hdGgubWF4KE51bWJlcihhY2MuYmFsYW5jZSkgfHwgMCwgY2FsY1ZhbCk7IC8vIHRha2UgdGhlIHN0b3JlZCBiYWxhbmNlIGlmIGV4cGxpY2l0bHkgc2V0IGFuZCA+IDAKICAgIH0KICAgIGJ5VHlwZVt0XS50b3RhbCArPSB2YWw7CiAgICBieVR5cGVbdF0uYWNjb3VudHMucHVzaCh7IC4uLmFjYywgX3ZhbDogdmFsIH0pOwogICAgaWYgKE5XX1RZUEVTW3RdLmlzTGlhYikgbGlhYlRvdGFsICs9IHZhbDsKICAgIGVsc2UgdG90YWxBc3NldHMgKz0gdmFsOwogIH0pOwoKICBjb25zdCBuZXRXb3J0aCA9IHRvdGFsQXNzZXRzIC0gbGlhYlRvdGFsOwogIGNvbnN0IGRlYnRSYXRpbyA9IHRvdGFsQXNzZXRzID4gMCA/IGxpYWJUb3RhbCAvIHRvdGFsQXNzZXRzIDogMDsKICByZXR1cm4geyBuZXRXb3J0aCwgdG90YWxBc3NldHMsIGxpYWJUb3RhbCwgZGVidFJhdGlvLCBieVR5cGUgfTsKfQoKLy8g4pSA4pSAIFJlbmRlciBOZXQgV29ydGgg4pSA4pSACgpmdW5jdGlvbiBidWlsZE5XTWV0YWxzQm9keShhY2NvdW50cywgY2ZnLCBhZGRCdG5MYWJlbCkgewogIC8vIEdyb3VwIGJ5IG1ldGFsVHlwZSBmaXJzdCwgdGhlbiBieSBwdXJpdHkgd2l0aGluIGVhY2ggdHlwZQogIGNvbnN0IE1FVEFMX09SREVSID0gWydnb2xkJywnc2lsdmVyJywncGxhdGludW0nXTsKICBjb25zdCBNRVRBTF9MQUJFTFMgPSB7IGdvbGQ6J/CfpYcgR29sZCcsIHNpbHZlcjon8J+liCBTaWx2ZXInLCBwbGF0aW51bTon8J+UmCBQbGF0aW51bScgfTsKCiAgLy8gQnVja2V0IGFjY291bnRzCiAgY29uc3QgYnlNZXRhbCA9IHt9OwogIE1FVEFMX09SREVSLmZvckVhY2gobXQgPT4geyBieU1ldGFsW210XSA9IFtdOyB9KTsKICBhY2NvdW50cy5mb3JFYWNoKGFjYyA9PiB7CiAgICBjb25zdCBtdCA9IChhY2MubWV0YSAmJiBhY2MubWV0YS5tZXRhbFR5cGUpIHx8ICdnb2xkJzsKICAgIGlmICghYnlNZXRhbFttdF0pIGJ5TWV0YWxbbXRdID0gW107CiAgICBieU1ldGFsW210XS5wdXNoKGFjYyk7CiAgfSk7CgogIGxldCBodG1sID0gJyc7CgogIE1FVEFMX09SREVSLmZvckVhY2gobXQgPT4gewogICAgY29uc3QgaXRlbXMgPSBieU1ldGFsW210XTsKICAgIGlmICghaXRlbXMubGVuZ3RoKSByZXR1cm47CgogICAgY29uc3QgbWV0YWxUb3RhbCA9IGl0ZW1zLnJlZHVjZSgocywgYSkgPT4gcyArIChhLl92YWwgfHwgMCksIDApOwogICAgY29uc3QgbWV0YWxHcmFtcyA9IGl0ZW1zLnJlZHVjZSgocywgYSkgPT4gcyArIE51bWJlcigoYS5tZXRhICYmIGEubWV0YS5ncmFtcykgfHwgMCksIDApOwoKICAgIC8vIE1ldGFsIHR5cGUgaGVhZGVyIHJvdwogICAgaHRtbCArPSBgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjEwcHggMCA0cHg7Ym9yZGVyLWJvdHRvbToycHggc29saWQgI0YwRjBGMDsiPgogICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo5MDA7Zm9udC1zaXplOjAuOTVlbTtjb2xvcjp2YXIoLS10ZXh0LWRhcmspOyI+JHtNRVRBTF9MQUJFTFNbbXRdIHx8IG10fTwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0OyI+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6OTAwO2ZvbnQtc2l6ZTowLjk1ZW07Y29sb3I6JHtjZmcuY29sb3J9OyI+JHtmbXQobWV0YWxUb3RhbCl9PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzJlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo3MDA7Ij4ke21ldGFsR3JhbXMudG9GaXhlZCgyKX1nIMK3ICR7KG1ldGFsR3JhbXMvMzEuMTAzNSkudG9GaXhlZCgzKX0gb3o8L2Rpdj4KICAgICAgPC9kaXY+','CiAgICA8L2Rpdj5gOwoKICAgIC8vIEdyb3VwIGJ5IHB1cml0eSB3aXRoaW4gdGhpcyBtZXRhbCB0eXBlCiAgICBjb25zdCBieVB1cml0eSA9IHt9OwogICAgaXRlbXMuZm9yRWFjaChhY2MgPT4gewogICAgICBjb25zdCBwdXJpdHkgPSAoYWNjLm1ldGEgJiYgYWNjLm1ldGEucHVyaXR5KSB8fCAnT3RoZXInOwogICAgICBpZiAoIWJ5UHVyaXR5W3B1cml0eV0pIGJ5UHVyaXR5W3B1cml0eV0gPSBbXTsKICAgICAgYnlQdXJpdHlbcHVyaXR5XS5wdXNoKGFjYyk7CiAgICB9KTsKCiAgICBPYmplY3Qua2V5cyhieVB1cml0eSkuZm9yRWFjaChwdXJpdHkgPT4gewogICAgICBjb25zdCBwSXRlbXMgPSBieVB1cml0eVtwdXJpdHldOwogICAgICBjb25zdCBwVG90YWwgID0gcEl0ZW1zLnJlZHVjZSgocywgYSkgPT4gcyArIChhLl92YWwgfHwgMCksIDApOwogICAgICBjb25zdCBwR3JhbXMgID0gcEl0ZW1zLnJlZHVjZSgocywgYSkgPT4gcyArIE51bWJlcigoYS5tZXRhICYmIGEubWV0YS5ncmFtcykgfHwgMCksIDApOwogICAgICBjb25zdCBwT3ogICAgID0gKHBHcmFtcyAvIDMxLjEwMzUpLnRvRml4ZWQoMyk7CgogICAgICAvLyBQdXJpdHkgc3ViZ3JvdXAgaGVhZGVyIOKAlCBjb2xsYXBzaWJsZQogICAgICBjb25zdCBwQ29sbGFwc2VJZCA9IGBudy1tZXRhbC1ncnAtJHttdH0tJHtwdXJpdHkucmVwbGFjZSgvXHMrL2csJycpfWA7CiAgICAgIGh0bWwgKz0gYDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzo3cHggMCA0cHggMTJweDtib3JkZXItYm90dG9tOjFweCBkYXNoZWQgI0VFRUVFRTtjdXJzb3I6cG9pbnRlcjsiIG9uY2xpY2s9InRvZ2dsZU5XTWV0YWxHcm91cCgnJHtwQ29sbGFwc2VJZH0nKSI+CiAgICAgICAgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjgyZW07Y29sb3I6dmFyKC0tdGV4dC1tZWQpOyI+CiAgICAgICAgICA8c3BhbiBpZD0iJHtwQ29sbGFwc2VJZH0tY2hldiIgc3R5bGU9ImRpc3BsYXk6aW5saW5lLWJsb2NrO3RyYW5zaXRpb246dHJhbnNmb3JtIDAuMnM7bWFyZ2luLXJpZ2h0OjRweDsiPuKWvjwvc3Bhbj4ke3B1cml0eX0KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0OyI+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuODJlbTtjb2xvcjoke2NmZy5jb2xvcn07Ij4ke2ZtdChwVG90YWwpfTwvZGl2PgogICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjcwMDsiPiR7cEdyYW1zLnRvRml4ZWQoMil9ZyDCtyAke3BPen0gb3o8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgICAgaHRtbCArPSBgPGRpdiBpZD0iJHtwQ29sbGFwc2VJZH0iIGNsYXNzPSJudy1tZXRhbC1ncnAtYm9keSI+YDsKCiAgICAgIC8vIEluZGl2aWR1YWwgaXRlbXMKICAgICAgcEl0ZW1zLmZvckVhY2goYWNjID0+IHsKICAgICAgICBjb25zdCBnID0gTnVtYmVyKChhY2MubWV0YSAmJiBhY2MubWV0YS5ncmFtcykgfHwgMCk7CiAgICAgICAgY29uc3Qgb3ogPSAoZyAvIDMxLjEwMzUpLnRvRml4ZWQoMyk7CiAgICAgICAgLy8gTmFtZTogb2NjYXNpb24gwrcgaXRlbSBuYW1lIChzdHJpcCByZWR1bmRhbnQgbWV0YWwrcHVyaXR5IHByZWZpeCBmcm9tIGRpc3BsYXkgbmFtZSkKICAgICAgICBjb25zdCBvY2Nhc2lvbiA9IChhY2MubWV0YSAmJiBhY2MubWV0YS5vY2Nhc2lvbikgfHwgJyc7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxOYW1lID0gKGFjYy5tZXRhICYmIGFjYy5tZXRhLm9yaWdpbmFsTmFtZSkgfHwgJyc7CiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBvY2Nhc2lvbgogICAgICAgICAgPyAob3JpZ2luYWxOYW1lICYmIG9yaWdpbmFsTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBtdCA/IG9jY2FzaW9uICsgJyDCtyAnICsgb3JpZ2luYWxOYW1lIDogb2NjYXNpb24pCiAgICAgICAgICA6IChvcmlnaW5hbE5hbWUgJiYgb3JpZ2luYWxOYW1lLnRvTG93ZXJDYXNlKCkgIT09IG10ID8gb3JpZ2luYWxOYW1lIDogYWNjLm5hbWUpOwogICAgICAgIGNvbnN0IGRhdGVTdHIgPSBhY2MubGFzdFVwZGF0ZWQgPyBuZXcgRGF0ZShhY2MubGFzdFVwZGF0ZWQrJ1QwMDowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYycseWVhcjonMi1kaWdpdCd9KSA6ICcnOwogICAgICAgIGNvbnN0IGVkaXRCdG4gPSBhY2MuX2ltcG9ydGVkID8gJycgOiBgPGJ1dHRvbiBjbGFzcz0ibnctYWNjb3VudC1idG4iIG9uY2xpY2s9Im9wZW5OV1NoZWV0KCdtZXRhbHMnLCcke2FjYy5pZH0nKSI+4pyP77iPPC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ibnctYWNjb3VudC1idG4gZGVsIiBvbmNsaWNrPSJkZWxldGVOV0FjY291bnQoJyR7YWNjLmlkfScpIj7inJU8L2J1dHRvbj5gOwoKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXJvdyIgc3R5bGU9InBhZGRpbmctbGVmdDoyNHB4OyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWxlZnQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LW5hbWUiIHN0eWxlPSJmb250LXNpemU6MC44N2VtOyI+JHtkaXNwbGF5TmFtZSB8fCAn4oCUJ308L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1tZXRhIj4ke2cudG9GaXhlZCgyKX1nIMK3ICR7b3p9IG96JHtkYXRlU3RyPycgwrcgJytkYXRlU3RyOicnfSR7YWNjLl9pbXBvcnRlZD8nIMK3IPCfk6UnOicnfTwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXJpZ2h0Ij4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LXZhbCIgc3R5bGU9ImNvbG9yOiR7Y2ZnLmNvbG9yfTtmb250LXNpemU6MC45ZW07Ij4ke2ZtdChhY2MuX3ZhbCl9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWFjdGlvbnMiPiR7ZWRpdEJ0bn08L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PmA7CiAgICAgIH0pOwogICAgICBodG1sICs9IGA8L2Rpdj5gOyAvLyBjbG9zZSBudy1tZXRhbC1ncnAtYm9keQogICAgfSk7CiAgfSk7YDxkaXYgc3R5bGU9InBhZGRpbmctdG9wOjhweDsiPjxidXR0b24gY2xhc3M9Im53LXNlY3Rpb24tYWRkIiBvbmNsaWNrPSJvcGVuTldTaGVldCgnbWV0YWxzJykiPiR7YWRkQnRuTGFiZWx9PC9idXR0b24+PC9kaXY+YDsKICByZXR1cm4gaHRtbDsKfQoKZnVuY3Rpb24gcmVuZGVyTmV0V29ydGgoKSB7CiAgY29uc3QgbncgPSBjb21wdXRlTmV0V29ydGgoKTsKCiAgLy8g4pSA4pSAIEhlcm8g4pSA4pSACiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXRvdGFsJykudGV4dENvbnRlbnQgPSBmbXQobncubmV0V29ydGgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy10b3RhbCcpLnN0eWxlLmNvbG9yID0gbncubmV0V29ydGggPCAwID8gJyNGRjZCNkInIDogJ3doaXRlJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctYXNzZXRzLWhlcm8nKS50ZXh0Q29udGVudCA9IGZtdChudy50b3RhbEFzc2V0cyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWxpYWItaGVybycpLnRleHRDb250ZW50ICAgPSBmbXQobncubGlhYlRvdGFsKTsKICBjb25zdCBkclBjdCA9IChudy5kZWJ0UmF0aW8gKiAxMDApLnRvRml4ZWQoMSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWRlYnQtcmF0aW8nKS50ZXh0Q29udGVudCA9IGRyUGN0ICsgJyUnOwogIGNvbnN0IGJhZGdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWRlYnQtYmFkZ2UnKTsKICBpZiAobncuZGVidFJhdGlvIDwgMC4yKSAgICAgIHsgYmFkZ2UudGV4dENvbnRlbnQgPSAn4pePIEhlYWx0aHknOyAgYmFkZ2Uuc3R5bGUuYmFja2dyb3VuZCA9ICcjMTBCOTgxMzAnOyBiYWRnZS5zdHlsZS5jb2xvciA9ICcjMTBCOTgxJzsgfQogIGVsc2UgaWYgKG53LmRlYnRSYXRpbyA8IDAuNCkgeyBiYWRnZS50ZXh0Q29udGVudCA9ICfil48gTW9kZXJhdGUnOyBiYWRnZS5zdHlsZS5iYWNrZ3JvdW5kID0gJyNGNTlFMEIzMCc7IGJhZGdlLnN0eWxlLmNvbG9yID0gJyNGNTlFMEInOyB9CiAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgeyBiYWRnZS50ZXh0Q29udGVudCA9ICfil48gSGlnaCc7ICAgICBiYWRnZS5zdHlsZS5iYWNrZ3JvdW5kID0gJyNFRjQ0NDQzMCc7IGJhZGdlLnN0eWxlLmNvbG9yID0gJyNFRjQ0NDQnOyB9CgogIC8vIENoYW5nZSBzaW5jZSBGSVJTVCBzbmFwc2hvdAogIGNvbnN0IHNuYXBzID0gZ2V0TldTbmFwc2hvdHMoKTsKICBjb25zdCBjaGFuZ2VFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1jaGFuZ2UnKTsKICBpZiAoc25hcHMubGVuZ3RoID49IDEpIHsKICAgIGNvbnN0IGZpcnN0ID0gc25hcHNbMF0udmFsdWU7CiAgICBjb25zdCBkaWZmICA9IG53Lm5ldFdvcnRoIC0gZmlyc3Q7CiAgICBjb25zdCBwY3QgICA9IGZpcnN0ICE9PSAwID8gKGRpZmYgLyBNYXRoLmFicyhmaXJzdCkgKiAxMDApLnRvRml4ZWQoMSkgOiAwOwogICAgY29uc3QgY29sb3IgPSBkaWZmID49IDAgPyAnIzg2RUZBQycgOiAnI0ZDQTVBNSc7CiAgICBjb25zdCBhcnJvdyA9IGRpZmYgPj0gMCA/ICfilrInIDogJ+KWvCc7CiAgICBjaGFuZ2VFbC5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9ImNvbG9yOiR7Y29sb3J9OyI+JHthcnJvd30gJHtmbXQoTWF0aC5hYnMoZGlmZikpfSAoJHtwY3R9JSk8L3NwYW4+IDxzcGFuIHN0eWxlPSJvcGFjaXR5OjAuNjtmb250LXNpemU6MC45ZW07Ij5zaW5jZSBmaXJzdCBzbmFwc2hvdDwvc3Bhbj5gOwogIH0gZWxzZSB7CiAgICBjaGFuZ2VFbC5pbm5lckhUTUwgPSBgPHNwYW4gc3R5bGU9Im9wYWNpdHk6MC42O2ZvbnQtc2l6ZTowLjg4ZW07Ij5TYXZlIGEgc25hcHNob3QgdG8gdHJhY2sgY2hhbmdlcyBvdmVyIHRpbWU8L3NwYW4+YDsKICB9CgogIC8vIEdyb3VwIHRvdGFscyBpbiBoZWFkZXIKICBjb25zdCBhc3NldHNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1hc3NldHMtdG90YWwnKTsKICBjb25zdCBsaWFiRWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1saWFiLXRvdGFsJyk7CiAgaWYgKGFzc2V0c0VsKSBhc3NldHNFbC50ZXh0Q29udGVudCA9IGZtdChudy50b3RhbEFzc2V0cyk7CiAgaWYgKGxpYWJFbCkgICBsaWFiRWwudGV4dENvbnRlbnQgICA9IGZtdChudy5saWFiVG90YWwpOwoKICAvLyDilIDilIAgSW5zaWdodHMgY2FyZHMg4pSA4pSACiAgcmVuZGVyTldJbnNpZ2h0cyhudyk7CgogIC8vIOKUgOKUgCBUcmVuZCArIFNuYXBzaG90cyDilIDilIAKICBjb25zdCBjaGFydENhcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctY2hhcnQtY2FyZCcpOwogIGNvbnN0IHNuYXBDb3VudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNuYXAtY291bnQnKTsKICBpZiAoc25hcHMubGVuZ3RoID49IDEpIHsKICAgIGNoYXJ0Q2FyZC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICBpZiAoc25hcENvdW50RWwpIHNuYXBDb3VudEVsLnRleHRDb250ZW50ID0gc25hcHMubGVuZ3RoICsgJyBTbmFwc2hvdCcgKyAoc25hcHMubGVuZ3RoICE9PSAxID8gJ3MnIDogJycpOwogICAgLy8gVHJlbmQgbGluZSBjaGFydAogICAgY29uc3QgY2FudmFzSWQgPSAnbnctdHJlbmQtY2hhcnQnOwogICAgaWYgKGNoYXJ0c1tjYW52YXNJZF0pIHsgY2hhcnRzW2NhbnZhc0lkXS5kZXN0cm95KCk7IGRlbGV0ZSBjaGFydHNbY2FudmFzSWRdOyB9CiAgICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNJZCk7CiAgICBpZiAoY3R4ICYmIHNuYXBzLmxlbmd0aCA+PSAyKSB7CiAgICAgIGNoYXJ0c1tjYW52','YXNJZF0gPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgdHlwZTogJ2xpbmUnLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGxhYmVsczogc25hcHMubWFwKHMgPT4gewogICAgICAgICAgICBjb25zdCBkID0gbmV3IERhdGUocy5kYXRlKydUMDA6MDA6MDAnKTsKICAgICAgICAgICAgcmV0dXJuIGQudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycse21vbnRoOidzaG9ydCcsZGF5OidudW1lcmljJ30pOwogICAgICAgICAgfSksCiAgICAgICAgICBkYXRhc2V0czogW3sKICAgICAgICAgICAgZGF0YTogc25hcHMubWFwKHMgPT4gcy52YWx1ZSksCiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnI0M4OTAwQScsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjQ1LDIwMCw2NiwwLjEyKScsCiAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLjUsCiAgICAgICAgICAgIHBvaW50UmFkaXVzOiA1LAogICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogJyNGNUM4NDInLAogICAgICAgICAgICBwb2ludEJvcmRlckNvbG9yOiAnd2hpdGUnLAogICAgICAgICAgICBwb2ludEJvcmRlcldpZHRoOiAyLAogICAgICAgICAgICBmaWxsOiB0cnVlLAogICAgICAgICAgICB0ZW5zaW9uOiAwLjM1CiAgICAgICAgICB9XQogICAgICAgIH0sCiAgICAgICAgb3B0aW9uczogewogICAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsCiAgICAgICAgICBwbHVnaW5zOiB7IGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0b29sdGlwOiB7IGNhbGxiYWNrczogeyBsYWJlbDogYyA9PiBmbXQoYy5yYXcpIH0gfSB9LAogICAgICAgICAgc2NhbGVzOiB7CiAgICAgICAgICAgIHg6IHsgZ3JpZDogeyBkaXNwbGF5OiBmYWxzZSB9LCB0aWNrczogeyBmb250OiB7IHNpemU6IDksIGZhbWlseTonTnVuaXRvJywgd2VpZ2h0Oic3MDAnIH0sIGNvbG9yOicjOUFBMEIyJyB9IH0sCiAgICAgICAgICAgIHk6IHsgZGlzcGxheTogZmFsc2UgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvLyBTbmFwc2hvdCBsaXN0IHdpdGggcHJvZ3Jlc3MgYmFycwogICAgY29uc3Qgc25hcExpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zbmFwc2hvdHMtbGlzdCcpOwogICAgaWYgKHNuYXBMaXN0RWwpIHsKICAgICAgY29uc3QgbWF4VmFsID0gTWF0aC5tYXgoLi4uc25hcHMubWFwKHMgPT4gcy52YWx1ZSksIDEpOwogICAgICBzbmFwTGlzdEVsLmlubmVySFRNTCA9IHNuYXBzLm1hcCgocywgaSkgPT4gewogICAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShzLmRhdGUrJ1QwMDowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYycseWVhcjonMi1kaWdpdCd9KTsKICAgICAgICBjb25zdCBwY3QgPSAocy52YWx1ZSAvIG1heFZhbCAqIDEwMCkudG9GaXhlZCgwKTsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9Im53LXNuYXAtcm93Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LXNuYXAtZGF0ZSI+JHtkfTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ibnctc25hcC1iYXItd3JhcCI+PGRpdiBjbGFzcz0ibnctc25hcC1iYXItZmlsbCIgc3R5bGU9IndpZHRoOiR7cGN0fSU7Ij48L2Rpdj48L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LXNuYXAtdmFsIj4ke2ZtdChzLnZhbHVlKX08L2Rpdj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9Im53LXNuYXAtZGVsIiBvbmNsaWNrPSJkZWxldGVOV1NuYXBzaG90KCR7aX0pIiB0aXRsZT0iRGVsZXRlIj7DlzwvYnV0dG9uPgogICAgICAgIDwvZGl2PmA7CiAgICAgIH0pLmpvaW4oJycpOwogICAgfQogIH0gZWxzZSB7CiAgICBjaGFydENhcmQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICB9CgogIC8vIOKUgOKUgCBBc3NldCBBbGxvY2F0aW9uIGRvbnV0IOKUgOKUgAogIHJlbmRlck5XRG9udXQobncpOwoKICAvLyDilIDilIAgQWNjb3VudCBTZWN0aW9ucyDilIDilIAKICBPYmplY3Qua2V5cyhOV19UWVBFUykuZm9yRWFjaCh0ID0+IHsKICAgIGNvbnN0IGNmZyAgICA9IE5XX1RZUEVTW3RdOwogICAgY29uc3QgZ3JvdXAgID0gbncuYnlUeXBlW3RdOwogICAgY29uc3QgdmFsRWwgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXZhbC0nK3QpOwogICAgY29uc3Qgc3ViRWwgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXN1Yi0nK3QpOwogICAgY29uc3QgYm9keUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWJvZHktJyt0KTsKICAgIGlmICghdmFsRWwgfHwgIWJvZHlFbCkgcmV0dXJuOwoKICAgIHZhbEVsLnRleHRDb250ZW50ID0gZm10KGdyb3VwLnRvdGFsKTsKICAgIGNvbnN0IGNudCA9IGdyb3VwLmFjY291bnRzLmxlbmd0aDsKICAgIGlmIChzdWJFbCkgewogICAgICBpZiAoY250ID09PSAwKSBzdWJFbC50ZXh0Q29udGVudCA9ICdObyBhY2NvdW50cyB5ZXQnOwogICAgICBlbHNlIHN1YkVsLnRleHRDb250ZW50ID0gY250ICsgJyBhY2NvdW50JyArIChjbnQgIT09IDEgPyAncycgOiAnJyk7CiAgICB9CgogICAgY29uc3QgYWRkQnRuTGFiZWwgPSB0ID09PSAnbWV0YWxzJyA/ICcrIEFkZCBFbnRyeScgOiB0ID09PSAncmVhbGVzdGF0ZScgPyAnKyBBZGQgUHJvcGVydHknIDogdCA9PT0gJ2NyZWRpdF9jYXJkJyA/ICcrIEFkZCBDYXJkJyA6IHQgPT09ICdsb2FuJyA/ICcrIEFkZCBMb2FuJyA6ICcrIEFkZCBBY2NvdW50JzsKCiAgICBpZiAoY250ID09PSAwKSB7CiAgICAgIGJvZHlFbC5pbm5lckhUTUwgPSBgPGJ1dHRvbiBjbGFzcz0ibnctc2VjdGlvbi1hZGQiIG9uY2xpY2s9Im9wZW5OV1NoZWV0KCcke3R9JykiIHN0eWxlPSJtYXJnaW4tdG9wOjhweDsiPiR7YWRkQnRuTGFiZWx9PC9idXR0b24+YDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHNlY3Rpb25Ub3RhbCA9IGdyb3VwLnRvdGFsOwoKICAgIGlmICh0ID09PSAnbWV0YWxzJykgewogICAgICAvLyDilIDilIAgR3JvdXBlZCBoaWVyYXJjaHk6IE1ldGFsIFR5cGUg4oaSIFB1cml0eSDihpIgSXRlbXMg4pSA4pSACiAgICAgIGJvZHlFbC5pbm5lckhUTUwgPSBidWlsZE5XTWV0YWxzQm9keShncm91cC5hY2NvdW50cywgY2ZnLCBhZGRCdG5MYWJlbCk7CiAgICB9IGVsc2UgewogICAgICBib2R5RWwuaW5uZXJIVE1MID0gZ3JvdXAuYWNjb3VudHMubWFwKGFjYyA9PiB7CiAgICAgICAgY29uc3QgcGN0ICAgICA9IHNlY3Rpb25Ub3RhbCA+IDAgPyBNYXRoLm1pbihhY2MuX3ZhbCAvIHNlY3Rpb25Ub3RhbCwgMSkgOiAwOwogICAgICAgIGNvbnN0IGRhdGVTdHIgPSBhY2MubGFzdFVwZGF0ZWQgPyBuZXcgRGF0ZShhY2MubGFzdFVwZGF0ZWQrJ1QwMDowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLHttb250aDonc2hvcnQnLGRheTonbnVtZXJpYyd9KSA6ICcnOwogICAgICAgIGNvbnN0IG1ldGFMaW5lID0gYnVpbGRBY2NvdW50TWV0YUxpbmUoYWNjKTsKICAgICAgICBjb25zdCBpc0xpYWIgICA9IGNmZy5pc0xpYWI7CiAgICAgICAgY29uc3QgdmFsQ29sb3IgPSBpc0xpYWIgPyAndmFyKC0tZXhwZW5zZXMpJyA6IGNmZy5jb2xvcjsKICAgICAgICBjb25zdCBlZGl0QnRuICA9IGFjYy5faW1wb3J0ZWQgPyAnJyA6IGA8YnV0dG9uIGNsYXNzPSJudy1hY2NvdW50LWJ0biIgb25jbGljaz0ib3Blbk5XU2hlZXQoJyR7YWNjLnR5cGV9JywnJHthY2MuaWR9JykiPuKcj++4jzwvYnV0dG9uPjxidXR0b24gY2xhc3M9Im53LWFjY291bnQtYnRuIGRlbCIgb25jbGljaz0iZGVsZXRlTldBY2NvdW50KCcke2FjYy5pZH0nKSI+4pyVPC9idXR0b24+YDsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9Im53LWFjY291bnQtcm93Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtbGVmdCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtbmFtZSI+JHthY2MubmFtZX08L2Rpdj4KICAgICAgICAgICAgJHttZXRhTGluZSA/IGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LW1ldGEiPiR7bWV0YUxpbmV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWJhci13cmFwIj48ZGl2IGNsYXNzPSJudy1hY2NvdW50LWJhci1maWxsIiBzdHlsZT0id2lkdGg6JHsocGN0KjEwMCkudG9GaXhlZCgwKX0lO2JhY2tncm91bmQ6JHtjZmcuY29sb3J9OyI+PC9kaXY+PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtcmlnaHQiPgogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtdmFsIiBzdHlsZT0iY29sb3I6JHt2YWxDb2xvcn07Ij4ke2ZtdChhY2MuX3ZhbCl9PC9kaXY+CiAgICAgICAgICAgICAgJHtkYXRlU3RyID8gYDxkaXYgY2xhc3M9Im53LWFjY291bnQtdXBkYXRlZCI+VXBkYXRlZCAke2RhdGVTdHJ9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1hY3Rpb25zIj4ke2VkaXRCdG59PC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj5gOwogICAgICB9KS5qb2luKCcnKSArIGA8ZGl2IHN0eWxlPSJwYWRkaW5nLXRvcDo4cHg7Ij48YnV0dG9uIGNsYXNzPSJudy1zZWN0aW9uLWFkZCIgb25jbGljaz0ib3Blbk5XU2hlZXQoJyR7dH0nKSI+JHthZGRCdG5MYWJlbH08L2J1dHRvbj48L2Rpdj5gOwogICAgfQogIH0pOwoKICAvLyDilIDilIAgUmVuZGVyIGN1c3RvbSB0eXBlIHNlY3Rpb25zIChub3QgaW4gc3RhdGljIEhUTUwpIOKUgOKUgAogIGNvbnN0IGN1c3RvbVR5cGVzID0gKGRhdGEuX253Q3VzdG9tVHlwZXMgfHwgW10pOwogIGNvbnN0IGN1c3RvbUFzc2V0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctY3VzdG9tLXNlY3Rpb25zLWFzc2V0cycpOwogIGNvbnN0IGN1c3RvbUxpYWJFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctY3VzdG9tLXNlY3Rpb25zLWxpYWInKTsKICBpZiAoY3VzdG9tQXNzZXRFbCkgY3VzdG9tQXNzZXRFbC5pbm5lckhUTUwgPSAnJzsKICBpZiAoY3VzdG9tTGlhYkVsKSAgY3VzdG9tTGlhYkVsLmlubmVySFRNTCAgPSAnJzsKCiAgY3VzdG9tVHlwZXMuZm9yRWFjaChjdCA9PiB7CiAgICBjb25zdCB0ID0gY3Qua2V5OwogICAgY29uc3QgY2ZnID0gTldfVFlQRVNbdF07CiAgICBpZiAoIWNmZykgcmV0dXJuOwogICAgY29uc3QgZ3JvdXAgPSBudy5ieVR5cGVbdF0gfHwgeyB0b3RhbDogMCwgYWNjb3VudHM6IFtdIH07CiAgICBjb25zdCBjb250YWluZXIgPSBjZmcuaXNMaWFiID8gY3VzdG9tTGlhYkVsIDogY3VzdG9tQXNzZXRFbDsKICAgIGlmICghY29udGFpbmVyKSByZXR1cm47CgogICAgY29uc3QgY250ID0gZ3JvdXAuYWNjb3VudHMubGVuZ3RoOwogICAgY29uc3QgYWRkQnRuTGFiZWwgPSAnKyBBZGQgQWNjb3VudCc7CgogICAgLy8gQnVpbGQgc2VjdGlvbiBIVE1MCiAgICBjb25zdCBzZWNJZCAgICA9ICdudy1zZWMtJyArIHQ7CiAgICBjb25zdCBib2R5SWQgICA9ICdudy1ib2R5LScgKyB0OwogICAgY29uc3QgdmFsSWQgICAgPSAnbnctdmFsLScgKyB0OwogICAgY29uc3Qgc3ViSWQgICAgPSAnbnctc3ViLScgKyB0OwogICAgY29uc3QgY2hldklkICAgPSAnbnctY2hldi0nICsgdDsKCiAgICAvLyBDaGVjayBpZiBlbGVtZW50IGFscmVhZHkgZXhpc3RzIChyZS1yZW5kZXIpCiAgICBsZXQgc2VjRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWNJZCk7CiAgICBpZiAoIXNlY0VsKSB7CiAgICAgIHNlY0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHNlY0VsLmNsYXNzTmFtZSA9ICdudy1zZWN0aW9uJzsKICAgICAgc2VjRWwuaWQgPSBzZWNJZDsKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNlY0VsKTsKICAgIH0KCiAgICBjb25zdCB2YWxDb2xvciA9IGNmZy5pc0xpYWIgPyAndmFyKC0tZXhwZW5zZXMpJyA6IChjZmcuY29sb3IgfHwgJyM2QjcyODAnKTsK','ICAgIGNvbnN0IHNlY3Rpb25Ub3RhbCA9IGdyb3VwLnRvdGFsOwoKICAgIC8vIEJ1aWxkIGJvZHkgcm93cwogICAgbGV0IGJvZHlIVE1MID0gJyc7CiAgICBpZiAoY250ID09PSAwKSB7CiAgICAgIGJvZHlIVE1MID0gYDxidXR0b24gY2xhc3M9Im53LXNlY3Rpb24tYWRkIiBvbmNsaWNrPSJvcGVuTldTaGVldCgnJHt0fScpIiBzdHlsZT0ibWFyZ2luLXRvcDo4cHg7Ij4ke2FkZEJ0bkxhYmVsfTwvYnV0dG9uPmA7CiAgICB9IGVsc2UgewogICAgICBib2R5SFRNTCA9IGdyb3VwLmFjY291bnRzLm1hcChhY2MgPT4gewogICAgICAgIGNvbnN0IHBjdCAgICAgPSBzZWN0aW9uVG90YWwgPiAwID8gTWF0aC5taW4oYWNjLl92YWwgLyBzZWN0aW9uVG90YWwsIDEpIDogMDsKICAgICAgICBjb25zdCBkYXRlU3RyID0gYWNjLmxhc3RVcGRhdGVkID8gbmV3IERhdGUoYWNjLmxhc3RVcGRhdGVkKydUMDA6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJyx7bW9udGg6J3Nob3J0JyxkYXk6J251bWVyaWMnfSkgOiAnJzsKICAgICAgICBjb25zdCBtZXRhTGluZSA9IGJ1aWxkQWNjb3VudE1ldGFMaW5lKGFjYyk7CiAgICAgICAgY29uc3QgaXNMaWFiICAgPSBjZmcuaXNMaWFiOwogICAgICAgIGNvbnN0IHZhbENvbG9yQWNjID0gaXNMaWFiID8gJ3ZhcigtLWV4cGVuc2VzKScgOiB2YWxDb2xvcjsKICAgICAgICBjb25zdCBlZGl0QnRuICA9IGFjYy5faW1wb3J0ZWQgPyAnJyA6IGA8YnV0dG9uIGNsYXNzPSJudy1hY2NvdW50LWJ0biIgb25jbGljaz0ib3Blbk5XU2hlZXQoJyR7YWNjLnR5cGV9JywnJHthY2MuaWR9JykiPuKcj++4jzwvYnV0dG9uPjxidXR0b24gY2xhc3M9Im53LWFjY291bnQtYnRuIGRlbCIgb25jbGljaz0iZGVsZXRlTldBY2NvdW50KCcke2FjYy5pZH0nKSI+4pyVPC9idXR0b24+YDsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9Im53LWFjY291bnQtcm93Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtbGVmdCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im53LWFjY291bnQtbmFtZSI+JHthY2MubmFtZX08L2Rpdj4KICAgICAgICAgICAgJHttZXRhTGluZSA/IGA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LW1ldGEiPiR7bWV0YUxpbmV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWJhci13cmFwIj48ZGl2IGNsYXNzPSJudy1hY2NvdW50LWJhci1maWxsIiBzdHlsZT0id2lkdGg6JHsocGN0KjEwMCkudG9GaXhlZCgwKX0lO2JhY2tncm91bmQ6JHt2YWxDb2xvcn07Ij48L2Rpdj48L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC1yaWdodCI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibnctYWNjb3VudC12YWwiIHN0eWxlPSJjb2xvcjoke3ZhbENvbG9yQWNjfTsiPiR7Zm10KGFjYy5fdmFsKX08L2Rpdj4KICAgICAgICAgICAgICAke2RhdGVTdHIgPyBgPGRpdiBjbGFzcz0ibnctYWNjb3VudC11cGRhdGVkIj5VcGRhdGVkICR7ZGF0ZVN0cn08L2Rpdj5gIDogJyd9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1hY2NvdW50LWFjdGlvbnMiPiR7ZWRpdEJ0bn08L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PmA7CiAgICAgIH0pLmpvaW4oJycpICsgYDxkaXYgc3R5bGU9InBhZGRpbmctdG9wOjhweDsiPjxidXR0b24gY2xhc3M9Im53LXNlY3Rpb24tYWRkIiBvbmNsaWNrPSJvcGVuTldTaGVldCgnJHt0fScpIj4ke2FkZEJ0bkxhYmVsfTwvYnV0dG9uPjwvZGl2PmA7CiAgICB9CgogICAgc2VjRWwuaW5uZXJIVE1MID0gYAogICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLWhlYWRlciIgb25jbGljaz0idG9nZ2xlTldTZWN0aW9uKCcke3R9JykiPgogICAgICAgIDxkaXYgY2xhc3M9Im53LXNlY3Rpb24tbGVmdCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLWljb24iPiR7Y2ZnLmVtb2ppfTwvZGl2PgogICAgICAgICAgPGRpdj48ZGl2IGNsYXNzPSJudy1zZWN0aW9uLW5hbWUiPiR7Y2ZnLmxhYmVsfTwvZGl2PjxkaXYgY2xhc3M9Im53LXNlY3Rpb24tc3ViIiBpZD0iJHtzdWJJZH0iPiR7Y250ID09PSAwID8gJ05vIGFjY291bnRzIHlldCcgOiBjbnQgKyAnIGFjY291bnQnICsgKGNudCAhPT0gMSA/ICdzJyA6ICcnKX08L2Rpdj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJudy1zZWN0aW9uLXJpZ2h0Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9Im53LXNlY3Rpb24tdmFsIiBpZD0iJHt2YWxJZH0iIHN0eWxlPSJjb2xvcjoke3ZhbENvbG9yfTsiPiR7Zm10KGdyb3VwLnRvdGFsKX08L2Rpdj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJudy1zZWN0aW9uLWNoZXZyb24iIGlkPSIke2NoZXZJZH0iPuKWvDwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im53LXNlY3Rpb24tYm9keSIgaWQ9IiR7Ym9keUlkfSI+JHtib2R5SFRNTH08L2Rpdj5gOwogIH0pOwp9CgpmdW5jdGlvbiBkZWxldGVOV1NuYXBzaG90KGlkeCkgewogIGNvbnN0IHNuYXBzID0gZ2V0TldTbmFwc2hvdHMoKTsKICBpZiAoIWNvbmZpcm0oJ0RlbGV0ZSB0aGlzIHNuYXBzaG90PycpKSByZXR1cm47CiAgc25hcHMuc3BsaWNlKGlkeCwgMSk7CiAgc2F2ZSgpOwogIHJlbmRlck5ldFdvcnRoKCk7CiAgc2hvd1RvYXN0KCdTbmFwc2hvdCBkZWxldGVkJyk7Cn0KCgpmdW5jdGlvbiBidWlsZEFjY291bnRNZXRhTGluZShhY2MpIHsKICBjb25zdCBwYXJ0cyA9IFtdOwogIGNvbnN0IG0gPSBhY2MubWV0YSB8fCB7fTsKICBpZiAoYWNjLnR5cGUgPT09ICdyZXRpcmVtZW50JyAmJiBtLnN1YnR5cGUpIHBhcnRzLnB1c2gobS5zdWJ0eXBlKTsKICBpZiAobS55dGRDb250cmlidXRpb24pIHBhcnRzLnB1c2goJ1lURDogJyArIGZtdChtLnl0ZENvbnRyaWJ1dGlvbikpOwogIGlmIChhY2MudHlwZSA9PT0gJ2NyZWRpdF9jYXJkJykgewogICAgaWYgKG0ubGltaXQpIHBhcnRzLnB1c2goJ0xpbWl0OiAnICsgZm10KG0ubGltaXQpKTsKICAgIGlmIChtLmFwcikgcGFydHMucHVzaCgnQVBSOiAnICsgbS5hcHIgKyAnJScpOwogICAgaWYgKG0ubGltaXQgJiYgYWNjLmJhbGFuY2UpIHsKICAgICAgY29uc3QgdXRpbCA9IE1hdGgubWluKE51bWJlcihhY2MuYmFsYW5jZSkvTnVtYmVyKG0ubGltaXQpKjEwMCwxMDApLnRvRml4ZWQoMCk7CiAgICAgIHBhcnRzLnB1c2goJ1V0aWxpemF0aW9uOiAnICsgdXRpbCArICclJyk7CiAgICB9CiAgfQogIGlmIChhY2MudHlwZSA9PT0gJ2xvYW4nICYmIG0uaW50ZXJlc3RSYXRlKSBwYXJ0cy5wdXNoKCdSYXRlOiAnICsgbS5pbnRlcmVzdFJhdGUgKyAnJScpOwogIGlmIChhY2MudHlwZSA9PT0gJ2JvbmRzX2ZkJykgewogICAgaWYgKG0uaW50ZXJlc3RSYXRlKSBwYXJ0cy5wdXNoKCdSYXRlOiAnICsgbS5pbnRlcmVzdFJhdGUgKyAnJScpOwogICAgaWYgKG0ubWF0dXJpdHlEYXRlKSBwYXJ0cy5wdXNoKCdNYXR1cmVzOiAnICsgbS5tYXR1cml0eURhdGUpOwogIH0KICBpZiAoYWNjLnR5cGUgPT09ICdtZXRhbHMnICYmIGFjYy5tZXRhKSB7CiAgICBjb25zdCBnID0gTnVtYmVyKGFjYy5tZXRhLmdyYW1zIHx8IDApOwogICAgaWYgKGcgPiAwKSB7CiAgICAgIGNvbnN0IG96ID0gKGcgLyAzMS4xMDM1KS50b0ZpeGVkKDMpOwogICAgICBwYXJ0cy5wdXNoKGcudG9GaXhlZCgyKSArICdnICgnICsgb3ogKyAnIG96KScpOwogICAgfQogICAgaWYgKGFjYy5tZXRhLnB1cml0eSkgICBwYXJ0cy5wdXNoKGFjYy5tZXRhLnB1cml0eSk7CiAgICBpZiAoYWNjLm1ldGEub2NjYXNpb24pIHBhcnRzLnB1c2goYWNjLm1ldGEub2NjYXNpb24pOwogICAgaWYgKGFjYy5tZXRhLmZvcm0gJiYgYWNjLm1ldGEuZm9ybSAhPT0gJ0pld2VscnknKSBwYXJ0cy5wdXNoKGFjYy5tZXRhLmZvcm0pOwogICAgaWYgKGFjYy5tZXRhLm9yaWdpbmFsTmFtZSAmJiBhY2MubWV0YS5vcmlnaW5hbE5hbWUgIT09IGFjYy5tZXRhLm1ldGFsVHlwZSkgcGFydHMucHVzaChhY2MubWV0YS5vcmlnaW5hbE5hbWUpOwogIH0KICBpZiAobS5iYW5rKSBwYXJ0cy5wdXNoKG0uYmFuayk7CiAgaWYgKG0ubGFzdDQpIHBhcnRzLnB1c2goJ8K3wrfCt8K3JyArIG0ubGFzdDQpOwogIGlmIChtLm5vdGVzKSBwYXJ0cy5wdXNoKG0ubm90ZXMpOwogIGlmIChhY2MuY3VycmVuY3kgJiYgYWNjLmN1cnJlbmN5ICE9PSBjdXJyZW50Q3VycmVuY3kuY29kZSkgcGFydHMucHVzaChhY2MuY3VycmVuY3kpOwogIGlmIChhY2MudHlwZSA9PT0gJ3JlYWxlc3RhdGUnICYmIGFjYy5tZXRhKSB7CiAgICBpZiAoYWNjLm1ldGEuYXJlYSkgICAgICAgICAgcGFydHMucHVzaChhY2MubWV0YS5hcmVhKTsKICAgIGlmIChhY2MubWV0YS5jb3VudHJ5KSAgICAgICBwYXJ0cy5wdXNoKGFjYy5tZXRhLmNvdW50cnkpOwogICAgaWYgKGFjYy5tZXRhLnB1cmNoYXNlVmFsdWUpIHBhcnRzLnB1c2goJ1B1cmNoYXNlZDogJyArIGZtdChhY2MubWV0YS5wdXJjaGFzZVZhbHVlKSk7CiAgfQogIGlmIChhY2MuX2ltcG9ydGVkKSBwYXJ0cy5wdXNoKCfwn5OlIGltcG9ydGVkJyk7CiAgcmV0dXJuIHBhcnRzLmpvaW4oJyDCtyAnKTsKfQoKZnVuY3Rpb24gcmVuZGVyTldJbnNpZ2h0cyhudykgewogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1pbnNpZ2h0cy1saXN0Jyk7CiAgaWYgKCFjb250YWluZXIpIHJldHVybjsKCiAgY29uc3QgY2FyZHMgPSBbXTsKICBjb25zdCB0b2RheU1rID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsNyk7CiAgbGV0IG1vbnRobHlFeHAgPSAwOwogIGlmIChkYXRhW3RvZGF5TWtdKSAoZGF0YVt0b2RheU1rXS5leHBlbnNlc3x8W10pLmZvckVhY2goZSA9PiBtb250aGx5RXhwICs9IG53Q29udmVydChlLmFtb3VudCwgZS5jdXJyZW5jeSkpOwoKICAvLyAxLiBEZWJ0IHJhdGlvCiAgY29uc3QgZHJQY3QgPSAobncuZGVidFJhdGlvICogMTAwKS50b0ZpeGVkKDApOwogIGlmIChudy5saWFiVG90YWwgPiAwKSB7CiAgICBjb25zdCBpc0hpZ2ggPSBudy5kZWJ0UmF0aW8gPiAwLjQsIGlzTW9kID0gbncuZGVidFJhdGlvID4gMC4yOwogICAgY2FyZHMucHVzaCh7CiAgICAgIGljb246IGlzSGlnaCA/ICfwn5S0JyA6IGlzTW9kID8gJ/CfkpsnIDogJ+KchScsCiAgICAgIGljb25CZzogaXNIaWdoID8gJyNGRkVFRUUnIDogaXNNb2QgPyAnI0ZGRkJFOCcgOiAnI0U4RkRGNScsCiAgICAgIGJvcmRlcjogaXNIaWdoID8gJyNFRjQ0NDQnIDogaXNNb2QgPyAnI0Y1OUUwQicgOiAnIzEwQjk4MScsCiAgICAgIHRpdGxlOiBgRGVidCByYXRpbyBhdCAke2RyUGN0fSVgLAogICAgICBzdWI6IGlzSGlnaCA/ICdDb25zaWRlciBwYXlpbmcgZG93biBkZWJ0IHRvIHJlZHVjZSBmaW5hbmNpYWwgcmlzay4nIDogaXNNb2QgPyAnTWFuYWdlYWJsZSBidXQgd29ydGggbW9uaXRvcmluZy4gQWltIHRvIGdldCB0aGlzIGJlbG93IDMwJSBvdmVyIHRpbWUuJyA6ICdFeGNlbGxlbnQhIFlvdXIgZGVidCBpcyB3ZWxsIHVuZGVyIGNvbnRyb2wuJwogICAgfSk7CiAgfQoKICAvLyAyLiBFbWVyZ2VuY3kgZnVuZAogIGNvbnN0IGxpcXVpZCA9IChudy5ieVR5cGUuY2hlY2tpbmc/LnRvdGFsfHwwKSArIChudy5ieVR5cGUuc2F2aW5nc19hY2M/LnRvdGFsfHwwKSArIChudy5ieVR5cGUuY2FzaD8udG90YWx8fDApOwogIGlmIChtb250aGx5RXhwID4gMCkgewogICAgY29uc3QgbW9udGhzID0gbGlxdWlkIC8gbW9udGhseUV4cDsKICAgIGNvbnN0IGlzR29vZCA9IG1vbnRocyA+PSAzOwogICAgY2FyZHMucHVzaCh7CiAgICAgIGljb246IGlzR29vZCA/ICfwn5uh77iPJyA6ICfwn4aYJywKICAgICAgaWNvbkJnOiBpc0dvb2QgPyAnI0U4RjVGRicgOiAnI0ZGRUVFRScsCiAgICAgIGJvcmRlcjogaXNHb29kID8gJyM0QTlFRkYnIDogJyNFRjQ0NDQnLAogICAgICB0aXRsZTogaXNHb29kID8gYCR7bW9udGhzLnRvRml4ZWQoMSl9IG1vbnRo','cyBlbWVyZ2VuY3kgZnVuZGAgOiAnTG93IGVtZXJnZW5jeSBmdW5kJywKICAgICAgc3ViOiBgJHtmbXQobGlxdWlkKX0gaW4gbGlxdWlkIGFjY291bnRzLiBBaW0gZm9yIDPigJM2IG1vbnRocyBvZiBleHBlbnNlcyBhcyBhIHNhZmV0eSBuZXQuYAogICAgfSk7CiAgfQoKICAvLyAzLiBJbnZlc3RtZW50IGFsbG9jYXRpb24KICBjb25zdCBpbnZlc3RWYWwgPSAobncuYnlUeXBlLmJyb2tlcmFnZT8udG90YWx8fDApICsgKG53LmJ5VHlwZS5yZXRpcmVtZW50Py50b3RhbHx8MCkgKyAobncuYnlUeXBlLmJvbmRzX2ZkPy50b3RhbHx8MCkgKyAobncuYnlUeXBlLm1ldGFscz8udG90YWx8fDApOwogIGlmIChudy50b3RhbEFzc2V0cyA+IDApIHsKICAgIGNvbnN0IGludlBjdCA9IChpbnZlc3RWYWwgLyBudy50b3RhbEFzc2V0cyAqIDEwMCkudG9GaXhlZCgwKTsKICAgIGNhcmRzLnB1c2goewogICAgICBpY29uOiAn8J+TiicsCiAgICAgIGljb25CZzogJyNGMEVCRkYnLAogICAgICBib3JkZXI6ICcjN0MzQUVEJywKICAgICAgdGl0bGU6IGAke2ludlBjdH0lIG9mIGFzc2V0cyBpbnZlc3RlZGAsCiAgICAgIHN1YjogYCR7Zm10KGludmVzdFZhbCl9IGluIGludmVzdG1lbnRzLCByZXRpcmVtZW50LCBib25kcyAmIG1ldGFscy5gCiAgICB9KTsKICB9CgogIC8vIDQuIFJlYWwgZXN0YXRlIGNvbmNlbnRyYXRpb24KICBjb25zdCByZVZhbCA9IG53LmJ5VHlwZS5yZWFsZXN0YXRlPy50b3RhbCB8fCAwOwogIGlmIChyZVZhbCA+IDAgJiYgbncudG90YWxBc3NldHMgPiAwKSB7CiAgICBjb25zdCByZVBjdCA9IChyZVZhbCAvIG53LnRvdGFsQXNzZXRzICogMTAwKS50b0ZpeGVkKDApOwogICAgY2FyZHMucHVzaCh7CiAgICAgIGljb246ICfwn4+hJywKICAgICAgaWNvbkJnOiAnI0U4RkRGNScsCiAgICAgIGJvcmRlcjogJyNGOTczMTYnLAogICAgICB0aXRsZTogYFJlYWwgZXN0YXRlOiAke3JlUGN0fSUgb2YgYXNzZXRzYCwKICAgICAgc3ViOiBgJHtmbXQocmVWYWwpfSBpbiBwcm9wZXJ0eS4ke3JlUGN0ID4gNzAgPyAnIENvbnNpZGVyIGRpdmVyc2lmeWluZyBpbnRvIG90aGVyIGFzc2V0IGNsYXNzZXMuJyA6ICcgR29vZCBkaXZlcnNpZmljYXRpb24gYWNyb3NzIGFzc2V0IHR5cGVzLid9YAogICAgfSk7CiAgfQoKICAvLyA1LiBOZXQgd29ydGggcG9zaXRpdmUKICBpZiAobncubmV0V29ydGggPiAwKSB7CiAgICBjYXJkcy5wdXNoKHsKICAgICAgaWNvbjogJ/CfkqonLAogICAgICBpY29uQmc6ICcjRThGREY1JywKICAgICAgYm9yZGVyOiAnIzEwQjk4MScsCiAgICAgIHRpdGxlOiBgUG9zaXRpdmUgbmV0IHdvcnRoOiAke2ZtdChudy5uZXRXb3J0aCl9YCwKICAgICAgc3ViOiAnWW91ciBhc3NldHMgZXhjZWVkIHlvdXIgbGlhYmlsaXRpZXMg4oCUIGtlZXAgYnVpbGRpbmchJwogICAgfSk7CiAgfQoKICBjb250YWluZXIuaW5uZXJIVE1MID0gY2FyZHMubWFwKGMgPT4gYAogICAgPGRpdiBjbGFzcz0ibnctaW5zaWdodC1jYXJkIiBzdHlsZT0iYm9yZGVyLWxlZnQtY29sb3I6JHtjLmJvcmRlcn07Ij4KICAgICAgPGRpdiBjbGFzcz0ibnctaW5zaWdodC1pY29uLXdyYXAiIHN0eWxlPSJiYWNrZ3JvdW5kOiR7Yy5pY29uQmd9OyI+JHtjLmljb259PC9kaXY+CiAgICAgIDxkaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibnctaW5zaWdodC10aXRsZSI+JHtjLnRpdGxlfTwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im53LWluc2lnaHQtc3ViIj4ke2Muc3VifTwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvZGl2PmApLmpvaW4oJycpOwp9CgoKZnVuY3Rpb24gcmVuZGVyTldEb251dChudykgewogIGNvbnN0IGFsbG9jQ2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1hbGxvYy1jYXJkJyk7CiAgY29uc3QgbGVnZW5kRWwgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LWRvbnV0LWxlZ2VuZCcpOwogIGNvbnN0IGJhckVsICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1hbGxvYy1zdGFja2VkLWJhcicpOwogIGNvbnN0IHRvdGFsRWwgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1hbGxvYy10b3RhbCcpOwoKICBjb25zdCBUWVBFX0NPTE9SUyA9IHsKICAgIHJlYWxlc3RhdGU6ICcjRjk3MzE2JywgcmV0aXJlbWVudDogJyM3QzNBRUQnLCBicm9rZXJhZ2U6ICcjOEI1Q0Y2JywKICAgIHNhdmluZ3NfYWNjOiAnIzEwQjk4MScsIGJvbmRzX2ZkOiAnI0Y1OUUwQicsIGNoZWNraW5nOiAnIzNCOUVGRicsCiAgICBtZXRhbHM6ICcjQzg5MDBBJywgY2FzaDogJyM4NENDMTYnCiAgfTsKICBjb25zdCBUWVBFX0xBQkVMUyA9IHsKICAgIHJlYWxlc3RhdGU6ICdSZWFsIEVzdGF0ZScsIHJldGlyZW1lbnQ6ICdSZXRpcmVtZW50JywgYnJva2VyYWdlOiAnSW52ZXN0bWVudCcsCiAgICBzYXZpbmdzX2FjYzogJ1NhdmluZ3MnLCBib25kc19mZDogJ0JvbmRzL0ZEJywgY2hlY2tpbmc6ICdDaGVja2luZycsCiAgICBtZXRhbHM6ICdQcmVjaW91cyBNZXRhbHMnLCBjYXNoOiAnQ2FzaCcKICB9OwogIC8vIEluY2x1ZGUgY3VzdG9tIHR5cGVzCiAgKGRhdGEuX253Q3VzdG9tVHlwZXN8fFtdKS5mb3JFYWNoKGMgPT4gewogICAgVFlQRV9MQUJFTFNbYy5rZXldID0gYy5sYWJlbDsKICAgIFRZUEVfQ09MT1JTW2Mua2V5XSA9IGMuY29sb3IgfHwgJyM2QjcyODAnOwogIH0pOwoKICBjb25zdCBzZWdtZW50cyA9IFtdOwogIE9iamVjdC5rZXlzKE5XX1RZUEVTKS5mb3JFYWNoKHQgPT4gewogICAgaWYgKE5XX1RZUEVTW3RdLmlzTGlhYikgcmV0dXJuOwogICAgY29uc3QgdmFsID0gbncuYnlUeXBlW3RdPy50b3RhbCB8fCAwOwogICAgaWYgKHZhbCA+IDApIHsKICAgICAgY29uc3QgbGFiZWwgPSBUWVBFX0xBQkVMU1t0XSB8fCBOV19UWVBFU1t0XT8ubGFiZWwgfHwgdDsKICAgICAgc2VnbWVudHMucHVzaCh7IHR5cGU6IHQsIHZhbCwgY29sb3I6IFRZUEVfQ09MT1JTW3RdIHx8ICcjOUFBMEIyJywgbGFiZWwgfSk7CiAgICB9CiAgfSk7CiAgc2VnbWVudHMuc29ydCgoYSwgYikgPT4gYi52YWwgLSBhLnZhbCk7CgogIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApIHsgaWYgKGFsbG9jQ2FyZCkgYWxsb2NDYXJkLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IHJldHVybjsgfQogIGlmIChhbGxvY0NhcmQpIGFsbG9jQ2FyZC5zdHlsZS5kaXNwbGF5ID0gJyc7CgogIGlmICh0b3RhbEVsKSB0b3RhbEVsLnRleHRDb250ZW50ID0gZm10KG53LnRvdGFsQXNzZXRzKTsKCiAgLy8gU3RhY2tlZCBob3Jpem9udGFsIGJhcgogIGlmIChiYXJFbCkgewogICAgYmFyRWwuaW5uZXJIVE1MID0gc2VnbWVudHMubWFwKHMgPT4gewogICAgICBjb25zdCBwY3QgPSBudy50b3RhbEFzc2V0cyA+IDAgPyAocy52YWwgLyBudy50b3RhbEFzc2V0cyAqIDEwMCkgOiAwOwogICAgICByZXR1cm4gYDxkaXYgc3R5bGU9ImZsZXg6JHtwY3R9O2JhY2tncm91bmQ6JHtzLmNvbG9yfTttaW4td2lkdGg6JHtwY3QgPiAxID8gJzRweCcgOiAnMCd9O3RyYW5zaXRpb246ZmxleCAwLjRzIGVhc2U7IiB0aXRsZT0iJHtzLmxhYmVsfTogJHtmbXQocy52YWwpfSAoJHtwY3QudG9GaXhlZCgwKX0lKSI+PC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogIH0KCiAgLy8gTGVnZW5kIGFzIGNsZWFuIHJvd3MKICBpZiAobGVnZW5kRWwpIHsKICAgIGxlZ2VuZEVsLmlubmVySFRNTCA9IHNlZ21lbnRzLm1hcChzID0+IHsKICAgICAgY29uc3QgcGN0ID0gbncudG90YWxBc3NldHMgPiAwID8gKHMudmFsIC8gbncudG90YWxBc3NldHMgKiAxMDApLnRvRml4ZWQoMSkgOiAnMCc7CiAgICAgIGNvbnN0IGJhcldpZHRoID0gTWF0aC5taW4ocGFyc2VGbG9hdChwY3QpLCAxMDApOwogICAgICByZXR1cm4gYDxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206OXB4OyI+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW4tYm90dG9tOjNweDsiPgogICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6N3B4OyI+CiAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOjEwcHg7aGVpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czozcHg7YmFja2dyb3VuZDoke3MuY29sb3J9O2ZsZXgtc2hyaW5rOjA7Ij48L2Rpdj4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6NzAwO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4ke3MubGFiZWx9PC9zcGFuPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyOyI+CiAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43MmVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTsiPiR7cGN0fSU8L3NwYW4+CiAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43OGVtO2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjp2YXIoLS10ZXh0LWRhcmspO21pbi13aWR0aDo2MHB4O3RleHQtYWxpZ246cmlnaHQ7Ij4ke2ZtdChzLnZhbCl9PC9zcGFuPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OjRweDtiYWNrZ3JvdW5kOiNGMEYwRjA7Ym9yZGVyLXJhZGl1czoycHg7Ij4KICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDoxMDAlO3dpZHRoOiR7YmFyV2lkdGh9JTtiYWNrZ3JvdW5kOiR7cy5jb2xvcn07Ym9yZGVyLXJhZGl1czoycHg7dHJhbnNpdGlvbjp3aWR0aCAwLjRzIGVhc2U7Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogIH0KfQoKCmZ1bmN0aW9uIHRvZ2dsZU5XTWV0YWxHcm91cChpZCkgewogIGNvbnN0IGJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgY29uc3QgY2hldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgJy1jaGV2Jyk7CiAgaWYgKCFib2R5KSByZXR1cm47CiAgY29uc3QgY29sbGFwc2VkID0gYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdjb2xsYXBzZWQnKTsKICBpZiAoY2hldikgY2hldi5zdHlsZS50cmFuc2Zvcm0gPSBjb2xsYXBzZWQgPyAncm90YXRlKC05MGRlZyknIDogJyc7Cn0KCmZ1bmN0aW9uIHRvZ2dsZU5XU2VjdGlvbihuYW1lKSB7CiAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1ib2R5LScrbmFtZSk7CiAgY29uc3QgY2hldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1jaGV2LScrbmFtZSk7CiAgaWYgKGJvZHkpIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpOwogIGlmIChjaGV2KSBjaGV2LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTsKfQoKZnVuY3Rpb24gc2F2ZU5XU25hcHNob3QoKSB7CiAgY29uc3QgbncgPSBjb21wdXRlTmV0V29ydGgoKTsKICBjb25zdCBzbmFwcyA9IGdldE5XU25hcHNob3RzKCk7CiAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAvLyBEb24ndCBkdXBsaWNhdGUgc2FtZS1kYXkgc25hcHNob3QsIHVwZGF0ZSBpdAogIGNvbnN0IGV4aXN0aW5nID0gc25hcHMuZmluZChzID0+IHMuZGF0ZSA9PT0gdG9kYXkpOwogIGlmIChleGlzdGluZykgeyBleGlzdGluZy52YWx1ZSA9IG53Lm5ldFdvcnRoOyB9CiAgZWxzZSB7IHNuYXBzLnB1c2goeyBkYXRlOiB0b2RheSwgdmFsdWU6IG53Lm5ldFdvcnRoIH0pOyB9CiAgc2F2ZSgpOwogIHJlbmRlck5ldFdvcnRoKCk7CiAgc2hvd1RvYXN0KCfwn5O4IFNuYXBzaG90IHNhdmVkOiAnICsgZm10KG53Lm5ldFdvcnRoKSk7Cn0KCmZ1bmN0aW9uIF9ud3NCdWlsZFR5cGVQaWNrZXIoKSB7CiAgY29uc3QgdmlzID0gZ2V0TldUeXBlVmlzaWJpbGl0eSgpOwogIGNvbnN0IHZpc2libGVUeXBlcyA9IGdldE5XVHlwZU9yZGVyKCkuZmlsdGVyKHQgPT4gdmlzW3RdICE9PSBmYWxzZSk7CiAgY29uc3QgZ3JpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3Mt','dHlwZS1ncmlkJyk7CiAgaWYgKCFncmlkKSByZXR1cm47CiAgaWYgKCF2aXNpYmxlVHlwZXMubGVuZ3RoKSB7CiAgICBncmlkLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJncmlkLWNvbHVtbjoxLy0xO3RleHQtYWxpZ246Y2VudGVyO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc2l6ZTowLjg1ZW07cGFkZGluZzoyMHB4IDA7Ij5BbGwgYWNjb3VudCB0eXBlcyBhcmUgaGlkZGVuLjxicj5FbmFibGUgdGhlbSBpbiBTZXR0aW5ncyDihpIgTmV0IFdvcnRoIEFjY291bnQgVHlwZXMuPC9kaXY+JzsKICAgIHJldHVybjsKICB9CiAgZ3JpZC5pbm5lckhUTUwgPSB2aXNpYmxlVHlwZXMubWFwKHQgPT4gewogICAgY29uc3QgY2ZnID0gTldfVFlQRVNbdF07CiAgICBjb25zdCBzZWwgPSB0ID09PSBud1NoZWV0VHlwZTsKICAgIHJldHVybiBgPGRpdiBjbGFzcz0ibndzLXR5cGUtdGlsZSR7c2VsPycgc2VsZWN0ZWQnOicnfSIgb25jbGljaz0iX253c1NlbGVjdFR5cGUoJyR7dH0nLGV2ZW50KSI+CiAgICAgIDxkaXYgY2xhc3M9Im53cy10eXBlLXRpbGUtaWNvbiI+JHtjZmcuZW1vaml9PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im53cy10eXBlLXRpbGUtbmFtZSI+JHtnZXROV1R5cGVTaG9ydCgpW3RdfHxjZmcubGFiZWx9PC9kaXY+CiAgICA8L2Rpdj5gOwogIH0pLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBfbndzU2VsZWN0VHlwZSh0eXBlLCBldikgewogIG53U2hlZXRUeXBlID0gdHlwZTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubndzLXR5cGUtdGlsZScpLmZvckVhY2godCA9PiB0LmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpOwogIGlmIChldiAmJiBldi5jdXJyZW50VGFyZ2V0KSBldi5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJyk7CiAgX253c1Nob3dGb3JtKCk7Cn0KCmZ1bmN0aW9uIF9ud3NTaG93Rm9ybSgpIHsKICBjb25zdCB0eXBlID0gbndTaGVldFR5cGU7CiAgY29uc3QgY2ZnID0gTldfVFlQRVNbdHlwZV07CiAgaWYgKCFjZmcpIHJldHVybjsKICBjb25zdCBleGlzdGluZyA9IG53U2hlZXRFZGl0SWQgPyAoZGF0YS5fbndBY2NvdW50c3x8W10pLmZpbmQoYT0+YS5pZD09PW53U2hlZXRFZGl0SWQpIDogbnVsbDsKICBjb25zdCBtID0gZXhpc3RpbmcgPyAoZXhpc3RpbmcubWV0YXx8e30pIDoge307CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcGhhc2UtcGljaycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1waGFzZS1mb3JtJykuc3R5bGUuZGlzcGxheSA9ICcnOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWJhbm5lci1pY29uJykudGV4dENvbnRlbnQgPSBjZmcuZW1vamk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1iYW5uZXItbmFtZScpLnRleHRDb250ZW50ID0gY2ZnLmxhYmVsOwogIGNvbnN0IGJhZGdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1iYW5uZXItYmFkZ2UnKTsKICBiYWRnZS50ZXh0Q29udGVudCA9IGNmZy5pc0xpYWIgPyAnTElBQklMSVRZJyA6ICdBU1NFVCc7CiAgYmFkZ2UuY2xhc3NOYW1lICAgPSAnbndzLXR5cGUtYmFkZ2UgJyArIChjZmcuaXNMaWFiID8gJ2xpYWInIDogJ2Fzc2V0Jyk7CgogIF9ud3NCdWlsZEZvcm0odHlwZSwgZXhpc3RpbmcsIG0pOwp9CgpmdW5jdGlvbiBvcGVuTldTaGVldCh0eXBlLCBlZGl0SWQpIHsKICBud1NoZWV0VHlwZSAgID0gdHlwZSB8fCBudWxsOwogIG53U2hlZXRFZGl0SWQgPSBlZGl0SWQgfHwgbnVsbDsKICBjb25zdCBwaGFzZVBpY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXBoYXNlLXBpY2snKTsKICBjb25zdCBwaGFzZUZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXBoYXNlLWZvcm0nKTsKCiAgaWYgKHR5cGUpIHsKICAgIC8vIERpcmVjdCBjYWxsIGZyb20gc2VjdGlvbiBidXR0b24g4oCUIHNraXAgcGlja2VyLCBzaG93IGZvcm0gaW1tZWRpYXRlbHkKICAgIHBoYXNlUGljay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgcGhhc2VGb3JtLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIF9ud3NTaG93Rm9ybSgpOwogIH0gZWxzZSB7CiAgICAvLyAiKyBBZGQgQWNjb3VudCIgQ1RBIOKAlCBzaG93IHR5cGUgcGlja2VyIGZpcnN0LCBubyB0eXBlIHByZS1zZWxlY3RlZAogICAgcGhhc2VQaWNrLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIHBoYXNlRm9ybS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgX253c0J1aWxkVHlwZVBpY2tlcigpOwogIH0KCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNoZWV0LW92ZXJsYXknKS5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNoZWV0JykuY2xhc3NMaXN0LmFkZCgnb3BlbicpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudy1zaGVldCcpLnNjcm9sbFRvcCA9IDA7Cn0KCmZ1bmN0aW9uIF9ud3NCdWlsZEZvcm0odHlwZSwgZXhpc3RpbmcsIG0pIHsKICBsZXQgZXh0cmFGaWVsZHMgPSAnJzsKICBpZiAodHlwZSA9PT0gJ3JldGlyZW1lbnQnKSB7CiAgICBjb25zdCBvcHRzID0gUkVUSVJFX1NVQlRZUEVTLm1hcChzID0+IGA8b3B0aW9uIHZhbHVlPSIke3N9IiAkeyhtLnN1YnR5cGU9PT1zKT8nc2VsZWN0ZWQnOicnfT4ke3N9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5BY2NvdW50IFN1YnR5cGU8L2Rpdj48c2VsZWN0IGNsYXNzPSJudy1zaGVldC1zZWxlY3QiIGlkPSJud3Mtc3VidHlwZSI+JHtvcHRzfTwvc2VsZWN0PjwvZGl2PmA7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5ZVEQgQ29udHJpYnV0aW9uPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy15dGQiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjAiIHZhbHVlPSIke20ueXRkQ29udHJpYnV0aW9ufHwnJ30iPjwvZGl2PmA7CiAgfQogIGlmICh0eXBlID09PSAnY3JlZGl0X2NhcmQnKSB7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPkNyZWRpdCBMaW1pdDwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtbGltaXQiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjUwMDAiIHZhbHVlPSIke20ubGltaXR8fCcnfSI+PC9kaXY+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5BUFIgJTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtYXByIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIxOS45OSIgc3RlcD0iMC4wMSIgdmFsdWU9IiR7bS5hcHJ8fCcnfSI+PC9kaXY+PC9kaXY+YDsKICB9CiAgaWYgKHR5cGUgPT09ICdsb2FuJykgewogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5JbnRlcmVzdCBSYXRlICU8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXJhdGUiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjYuNSIgc3RlcD0iMC4wMSIgdmFsdWU9IiR7bS5pbnRlcmVzdFJhdGV8fCcnfSI+PC9kaXY+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5Nb250aGx5IFBheW1lbnQ8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLW1wYXkiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjAiIHZhbHVlPSIke20ubW9udGhseVBheW1lbnR8fCcnfSI+PC9kaXY+PC9kaXY+YDsKICB9CiAgaWYgKHR5cGUgPT09ICdib25kc19mZCcpIHsKICAgIGV4dHJhRmllbGRzICs9IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1yb3ciPjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+SW50ZXJlc3QgUmF0ZSAlPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1yYXRlIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSI1LjAiIHN0ZXA9IjAuMDEiIHZhbHVlPSIke20uaW50ZXJlc3RSYXRlfHwnJ30iPjwvZGl2PjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+TWF0dXJpdHkgRGF0ZTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtbWF0dXJpdHkiIHR5cGU9ImRhdGUiIHZhbHVlPSIke20ubWF0dXJpdHlEYXRlfHwnJ30iPjwvZGl2PjwvZGl2PmA7CiAgfQogIGlmICh0eXBlID09PSAnbWV0YWxzJykgewogICAgY29uc3QgbWV0YWxUeXBlcyA9IFsnZ29sZCcsJ3NpbHZlcicsJ3BsYXRpbnVtJ107CiAgICBjb25zdCBtT3B0cyA9IG1ldGFsVHlwZXMubWFwKG10ID0+IGA8b3B0aW9uIHZhbHVlPSIke210fSIgJHsobS5tZXRhbFR5cGU9PT1tdCk/J3NlbGVjdGVkJzonJ30+JHttdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSttdC5zbGljZSgxKX08L29wdGlvbj5gKS5qb2luKCcnKTsKICAgIGNvbnN0IHB1cml0eU9wdHMgPSBbJzI0SycsJzIySycsJzIxSycsJzE4SycsJzE0SycsJzEwSycsJzk5OSBGaW5lJywnOTI1IFNpbHZlcicsJzg1MCcsJ090aGVyJ10ubWFwKHA9PmA8b3B0aW9uIHZhbHVlPSIke3B9IiAkeyhtLnB1cml0eT09PXApPydzZWxlY3RlZCc6Jyd9PiR7cH08L29wdGlvbj5gKS5qb2luKCcnKTsKICAgIGNvbnN0IHVuaXRPcHRzID0gWydnJywnb3onXS5tYXAodT0+YDxvcHRpb24gdmFsdWU9IiR7dX0iICR7KChtLndlaWdodFVuaXR8fCdnJyk9PT11KT8nc2VsZWN0ZWQnOicnfT4ke3V9PC9vcHRpb24+YCkuam9pbignJyk7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPk1ldGFsIFR5cGU8L2Rpdj48c2VsZWN0IGNsYXNzPSJudy1zaGVldC1zZWxlY3QiIGlkPSJud3MtbWV0YWx0eXBlIj4ke21PcHRzfTwvc2VsZWN0PjwvZGl2PjxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJudy1zaGVldC1sYWJlbCI+UHVyaXR5PC9kaXY+PHNlbGVjdCBjbGFzcz0ibnctc2hlZXQtc2VsZWN0IiBpZD0ibndzLXB1cml0eSI+JHtwdXJpdHlPcHRzfTwvc2VsZWN0PjwvZGl2PjwvZGl2PmA7CiAgICBleHRyYUZpZWxkcyArPSBgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij48ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCIgc3R5bGU9ImZsZXg6MjsiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5XZWlnaHQ8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWdyYW1zIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIxMCIgc3RlcD0iMC4wMDEiIHZhbHVlPSIke20uZ3JhbXN8fCcnfSI+PC9kaXY+PGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53LXNoZWV0LWxhYmVsIj5Vbml0PC9kaXY+PHNlbGVjdCBjbGFzcz0ibnctc2hlZXQtc2VsZWN0IiBpZD0ibndzLXdlaWdodHVuaXQiPiR7dW5pdE9wdHN9PC9zZWxlY3Q+PC9kaXY+PC9kaXY+YDsKICAgIGV4dHJhRmllbGRzICs9IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibnctc2hlZXQtbGFiZWwiPlByaWNlIHBlciBncmFtICgke2N1cnJlbnRDdXJyZW5jeS5jb2RlfSk8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXByaWNlcGVyZ3JhbSIgdHlwZT0ibnVtYmVyIiBwbGFjZWhvbGRlcj0iYXV0byIgc3RlcD0iMC4wMSIgdmFsdWU9IiR7bS5w','cmljZVBlckdyYW18fCcnfSI+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO21hcmdpbi10b3A6NHB4OyI+TGVhdmUgYmxhbmsgdG8gYXV0by11c2UgbGl2ZSBwcmljZSBmcm9tIE1ldGFscyBtb2R1bGU8L2Rpdj48L2Rpdj5gOwogICAgZXh0cmFGaWVsZHMgKz0gYDxkaXYgY2xhc3M9Im53LXNoZWV0LW1ldGEiPvCfkqEgSWYgb3ogc2VsZWN0ZWQsIHdlaWdodCBpcyBjb252ZXJ0ZWQgdG8gZ3JhbXMgYXV0b21hdGljYWxseSBvbiBzYXZlPC9kaXY+YDsKICB9CgogIGNvbnN0IGN1cnJlbmNpZXMgPSBbJ1VTRCcsJ0lOUicsJ0VVUicsJ0dCUCcsJ0FFRCcsJ0NBRCcsJ0FVRCcsJ1NHRCddOwogIGNvbnN0IGN1cnJPcHRzID0gY3VycmVuY2llcy5tYXAoYyA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtjfSIgJHsoZXhpc3RpbmcgPyBleGlzdGluZy5jdXJyZW5jeSA6IGN1cnJlbnRDdXJyZW5jeS5jb2RlKT09PWM/J3NlbGVjdGVkJzonJ30+JHtjfTwvb3B0aW9uPmApLmpvaW4oJycpOwoKICBjb25zdCBpc0xpYWIgPSBOV19UWVBFU1t0eXBlXS5pc0xpYWI7CiAgY29uc3QgYmFsTGFiZWwgPSBpc0xpYWIgPyAnT3V0c3RhbmRpbmcgQmFsYW5jZScgOiAnQ3VycmVudCBCYWxhbmNlJzsKICBjb25zdCBzaG93QmFsYW5jZSA9IHR5cGUgIT09ICdtZXRhbHMnOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnctc2hlZXQtYm9keScpLmlubmVySFRNTCA9IGAKICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj4KICAgICAgPGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkxhc3QgVXBkYXRlZDwvZGl2PgogICAgICA8aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWRhdGUiIHR5cGU9ImRhdGUiIHZhbHVlPSIke2V4aXN0aW5nID8gZXhpc3RpbmcubGFzdFVwZGF0ZWQgOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX0iPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+CiAgICAgIDxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5OYW1lPC9kaXY+CiAgICAgIDxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtbmFtZSIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9ImUuZy4gQ2hhc2UgQ2hlY2tpbmciIHZhbHVlPSIke2V4aXN0aW5nID8gZXhpc3RpbmcubmFtZSA6ICcnfSI+CiAgICA8L2Rpdj4KICAgICR7dHlwZSAhPT0gJ21ldGFscycgJiYgdHlwZSAhPT0gJ3JlYWxlc3RhdGUnID8gYDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+QmFuayAvIEluc3RpdHV0aW9uPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1iYW5rIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iZS5nLiBDaGFzZSwgQm9mQSwgU0JJIiB2YWx1ZT0iJHttLmJhbmt8fCcnfSI+PC9kaXY+YCA6ICcnfQogICAgJHt0eXBlID09PSAncmVhbGVzdGF0ZScgPyBgCiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1yb3ciPgogICAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkNvdW50cnk8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXJlLWNvdW50cnkiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJlLmcuIFVTLCBJTiwgQUUiIHZhbHVlPSIke20uY291bnRyeXx8Jyd9Ij48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5DdXJyZW5jeTwvZGl2PjxzZWxlY3QgY2xhc3M9Im53LXNoZWV0LXNlbGVjdCIgaWQ9Im53cy1jdXJyZW5jeSI+JHtjdXJyT3B0c308L3NlbGVjdD48L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtcm93Ij4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5QdXJjaGFzZSBWYWx1ZTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtcmUtcHYiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjAiIHN0ZXA9IjAuMDEiIHZhbHVlPSIke20ucHVyY2hhc2VWYWx1ZXx8Jyd9Ij48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPjxkaXYgY2xhc3M9Im53cy1zZWN0aW9uLWxhYmVsIj5DdXJyZW50IFZhbHVlPC9kaXY+PGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1iYWxhbmNlIiB0eXBlPSJudW1iZXIiIHBsYWNlaG9sZGVyPSIwIiBzdGVwPSIwLjAxIiB2YWx1ZT0iJHtleGlzdGluZyA/IGV4aXN0aW5nLmJhbGFuY2UgOiAobS5jdXJyZW50VmFsdWV8fCcnKX0iPjwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1yb3ciPgogICAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkFyZWEgKHNxIGZ0IC8gc3EgbSk8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLXJlLWFyZWEiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJlLmcuIDEyMDAgc3FmdCIgdmFsdWU9IiR7bS5hcmVhfHwnJ30iPjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPlB1cmNoYXNlIERhdGU8L2Rpdj48aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWRhdGUiIHR5cGU9ImRhdGUiIHZhbHVlPSIke2V4aXN0aW5nID8gZXhpc3RpbmcubGFzdFVwZGF0ZWQgOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX0iPjwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkRlc2NyaXB0aW9uIC8gQWRkcmVzczwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtcmUtZGVzYyIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9ImUuZy4gM0JSIEFwYXJ0bWVudCwgTWFpbiBTdCIgdmFsdWU9IiR7bS5kZXNjcmlwdGlvbnx8Jyd9Ij48L2Rpdj4KICAgIGAgOiBgJHtzaG93QmFsYW5jZSA/IGAKICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj4KICAgICAgPGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkN1cnJlbnQgQmFsYW5jZTwvZGl2PgogICAgICA8aW5wdXQgY2xhc3M9Im53LXNoZWV0LWlucHV0IiBpZD0ibndzLWJhbGFuY2UiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IjAuMDAiIHN0ZXA9IjAuMDEiIHZhbHVlPSIke2V4aXN0aW5nID8gZXhpc3RpbmcuYmFsYW5jZSA6ICcnfSI+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LXJvdyI+CiAgICAgIDxkaXYgY2xhc3M9Im53LXNoZWV0LWZpZWxkIj48ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+Q3VycmVuY3k8L2Rpdj48c2VsZWN0IGNsYXNzPSJudy1zaGVldC1zZWxlY3QiIGlkPSJud3MtY3VycmVuY3kiPiR7Y3Vyck9wdHN9PC9zZWxlY3Q+PC9kaXY+CiAgICAgICR7KHR5cGUgPT09ICdjaGVja2luZycgfHwgdHlwZSA9PT0gJ3NhdmluZ3NfYWNjJyB8fCB0eXBlID09PSAnY3JlZGl0X2NhcmQnKSA/IGA8ZGl2IGNsYXNzPSJudy1zaGVldC1maWVsZCI+PGRpdiBjbGFzcz0ibndzLXNlY3Rpb24tbGFiZWwiPkFjY291bnQgIyAoTGFzdCA0KTwvZGl2PjxpbnB1dCBjbGFzcz0ibnctc2hlZXQtaW5wdXQiIGlkPSJud3MtYWNjdDQiIHR5cGU9InRleHQiIG1heGxlbmd0aD0iNCIgcGxhY2Vob2xkZXI9IjEyMzQiIHZhbHVlPSIke20ubGFzdDR8fCcnfSI+PC9kaXY+YCA6ICcnfQogICAgPC9kaXY+YCA6ICcnfWB9CiAgICAke2V4dHJhRmllbGRzfQogICAgPGRpdiBjbGFzcz0ibnctc2hlZXQtZmllbGQiPgogICAgICA8ZGl2IGNsYXNzPSJud3Mtc2VjdGlvbi1sYWJlbCI+Tm90ZXM8L2Rpdj4KICAgICAgPGlucHV0IGNsYXNzPSJudy1zaGVldC1pbnB1dCIgaWQ9Im53cy1ub3RlcyIgdHlwZT0idGV4dCIgcGxhY2Vob2xkZXI9Ik9wdGlvbmFsIiB2YWx1ZT0iJHttLm5vdGVzfHwnJ30iPgogICAgPC9kaXY+CiAgYDsKfQoKCmZ1bmN0aW9uIGRlbGV0ZU5XQWNjb3VudChpZCkgewogIGlmICghY29uZmlybSgnRGVsZXRlIHRoaXMgYWNjb3VudD8nKSkgcmV0dXJuOwogIGlmICghZGF0YS5fbndBY2NvdW50cykgcmV0dXJuOwogIGRhdGEuX253QWNjb3VudHMgPSBkYXRhLl9ud0FjY291bnRzLmZpbHRlcihhID0+IGEuaWQgIT09IGlkKTsKICBzYXZlKCk7CiAgcmVuZGVyTmV0V29ydGgoKTsKICBzaG93VG9hc3QoJ0FjY291bnQgZGVsZXRlZCcpOwp9CgpmdW5jdGlvbiBjbG9zZU5XU2hlZXQoKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNoZWV0LW92ZXJsYXknKS5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253LXNoZWV0JykuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpOwogIC8vIFJlc2V0IGZvciBuZXh0IG9wZW4KICBzZXRUaW1lb3V0KCgpID0+IHsKICAgIGNvbnN0IHBpY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXBoYXNlLXBpY2snKTsKICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXBoYXNlLWZvcm0nKTsKICAgIGlmIChwaWNrKSBwaWNrLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIGlmIChmb3JtKSBmb3JtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBud1NoZWV0VHlwZSA9IG51bGw7CiAgICBud1NoZWV0RWRpdElkID0gbnVsbDsKICB9LCAzMjApOyAvLyBhZnRlciBzbGlkZS1kb3duIGFuaW1hdGlvbgp9CgpmdW5jdGlvbiBzYXZlTldBY2NvdW50KCkgewogIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLW5hbWUnKT8udmFsdWU/LnRyaW0oKTsKICBpZiAoIW5hbWUpIHsgc2hvd1RvYXN0KCfimqDvuI8gQWNjb3VudCBuYW1lIHJlcXVpcmVkJyk7IHJldHVybjsgfQoKICBjb25zdCB0eXBlID0gbndTaGVldFR5cGU7CiAgY29uc3QgbWV0YSA9IHt9OwogIGxldCBiYWxhbmNlID0gMDsKICBsZXQgY3VycmVuY3kgPSBjdXJyZW50Q3VycmVuY3kuY29kZTsKCiAgY29uc3QgYmFsRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWJhbGFuY2UnKTsKICBpZiAoYmFsRWwpIGJhbGFuY2UgPSBOdW1iZXIoYmFsRWwudmFsdWUgfHwgMCk7CiAgY29uc3QgY3VyckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1jdXJyZW5jeScpOwogIGlmIChjdXJyRWwpIGN1cnJlbmN5ID0gY3VyckVsLnZhbHVlOwoKICAvLyBFeHRyYSBtZXRhIOKAlCBhbHdheXMgdHJ5IHJlYWRpbmcgYWxsIHBvc3NpYmxlIGZpZWxkcwogIGNvbnN0IHN1YnR5cGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3Mtc3VidHlwZScpOwogIGlmIChzdWJ0eXBlRWwpIG1ldGEuc3VidHlwZSA9IHN1YnR5cGVFbC52YWx1ZTsKICBjb25zdCB5dGRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MteXRkJyk7CiAgaWYgKHl0ZEVsICYmIHl0ZEVsLnZhbHVlKSBtZXRhLnl0ZENvbnRyaWJ1dGlvbiA9IE51bWJlcih5dGRFbC52YWx1ZSk7CiAgY29uc3QgbGltaXRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtbGltaXQnKTsKICBpZiAobGltaXRFbCAmJiBsaW1pdEVsLnZhbHVlKSBtZXRhLmxpbWl0ID0gTnVtYmVyKGxpbWl0RWwudmFsdWUpOwogIGNvbnN0IGFwckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1hcHInKTsKICBpZiAoYXByRWwgJiYgYXByRWwudmFsdWUpIG1ldGEuYXByID0gTnVtYmVyKGFwckVsLnZhbHVlKTsKICBjb25zdCByYXRlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXJhdGUnKTsKICBpZiAocmF0ZUVsICYmIHJhdGVFbC52YWx1ZSkgbWV0YS5pbnRlcmVzdFJhdGUgPSBOdW1iZXIocmF0ZUVsLnZhbHVlKTsKICBjb25zdCBtcGF5RWwgPSBk','b2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLW1wYXknKTsKICBpZiAobXBheUVsICYmIG1wYXlFbC52YWx1ZSkgbWV0YS5tb250aGx5UGF5bWVudCA9IE51bWJlcihtcGF5RWwudmFsdWUpOwogIGNvbnN0IG1hdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1tYXR1cml0eScpOwogIGlmIChtYXRFbCAmJiBtYXRFbC52YWx1ZSkgbWV0YS5tYXR1cml0eURhdGUgPSBtYXRFbC52YWx1ZTsKICBjb25zdCBtdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1tZXRhbHR5cGUnKTsKICBpZiAobXRFbCkgbWV0YS5tZXRhbFR5cGUgPSBtdEVsLnZhbHVlOwogIGNvbnN0IGdyYW1zRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWdyYW1zJyk7CiAgY29uc3QgdW5pdEVsICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3Mtd2VpZ2h0dW5pdCcpOwogIGlmIChncmFtc0VsICYmIGdyYW1zRWwudmFsdWUpIHsKICAgIGNvbnN0IHJhd1dlaWdodCA9IE51bWJlcihncmFtc0VsLnZhbHVlKTsKICAgIGNvbnN0IGlzT3ogPSB1bml0RWwgJiYgdW5pdEVsLnZhbHVlID09PSAnb3onOwogICAgbWV0YS5ncmFtcyA9IGlzT3ogPyByYXdXZWlnaHQgKiAzMS4xMDM1IDogcmF3V2VpZ2h0OwogICAgbWV0YS53ZWlnaHRVbml0ID0gaXNPeiA/ICdveicgOiAnZyc7CiAgICBtZXRhLndlaWdodERpc3BsYXkgPSByYXdXZWlnaHQ7IC8vIG9yaWdpbmFsIGlucHV0IHZhbHVlCiAgfQogIGNvbnN0IHBwZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1wcmljZXBlcmdyYW0nKTsKICBpZiAocHBnRWwgJiYgcHBnRWwudmFsdWUpIG1ldGEucHJpY2VQZXJHcmFtID0gTnVtYmVyKHBwZ0VsLnZhbHVlKTsKICBjb25zdCBwdXJpdHlFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcHVyaXR5Jyk7CiAgaWYgKHB1cml0eUVsICYmIHB1cml0eUVsLnZhbHVlKSBtZXRhLnB1cml0eSA9IHB1cml0eUVsLnZhbHVlOwogIC8vIFJlYWwgZXN0YXRlIHNwZWNpZmljIGZpZWxkcwogIGNvbnN0IHJlUHZFbCAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1yZS1wdicpOwogIGNvbnN0IHJlRGVzY0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1yZS1kZXNjJyk7CiAgY29uc3QgcmVBcmVhRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLXJlLWFyZWEnKTsKICBjb25zdCByZUNvdW50cnlFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdud3MtcmUtY291bnRyeScpOwogIGlmIChyZVB2RWwgJiYgcmVQdkVsLnZhbHVlKSAgICAgbWV0YS5wdXJjaGFzZVZhbHVlID0gTnVtYmVyKHJlUHZFbC52YWx1ZSk7CiAgaWYgKHJlRGVzY0VsICYmIHJlRGVzY0VsLnZhbHVlKSBtZXRhLmRlc2NyaXB0aW9uICAgPSByZURlc2NFbC52YWx1ZS50cmltKCk7CiAgaWYgKHJlQXJlYUVsICYmIHJlQXJlYUVsLnZhbHVlKSBtZXRhLmFyZWEgICAgICAgICAgPSByZUFyZWFFbC52YWx1ZS50cmltKCk7CiAgaWYgKHJlQ291bnRyeUVsICYmIHJlQ291bnRyeUVsLnZhbHVlKSBtZXRhLmNvdW50cnkgPSByZUNvdW50cnlFbC52YWx1ZS50cmltKCk7CiAgLy8gTmV3IGZpZWxkcwogIGNvbnN0IGJhbmtFbCAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWJhbmsnKTsKICBpZiAoYmFua0VsICYmIGJhbmtFbC52YWx1ZSkgbWV0YS5iYW5rID0gYmFua0VsLnZhbHVlLnRyaW0oKTsKICBjb25zdCBhY2N0NEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1hY2N0NCcpOwogIGlmIChhY2N0NEVsICYmIGFjY3Q0RWwudmFsdWUpIG1ldGEubGFzdDQgPSBhY2N0NEVsLnZhbHVlLnRyaW0oKTsKICBjb25zdCBub3Rlc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ253cy1ub3RlcycpOwogIGlmIChub3Rlc0VsICYmIG5vdGVzRWwudmFsdWUpIG1ldGEubm90ZXMgPSBub3Rlc0VsLnZhbHVlLnRyaW0oKTsKICBjb25zdCBkYXRlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbndzLWRhdGUnKTsKICBjb25zdCBsYXN0VXBkYXRlZCA9IGRhdGVFbCA/IGRhdGVFbC52YWx1ZSA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwoKICBpZiAoIWRhdGEuX253QWNjb3VudHMpIGRhdGEuX253QWNjb3VudHMgPSBbXTsKICBpZiAobndTaGVldEVkaXRJZCkgewogICAgY29uc3QgaWR4ID0gZGF0YS5fbndBY2NvdW50cy5maW5kSW5kZXgoYSA9PiBhLmlkID09PSBud1NoZWV0RWRpdElkKTsKICAgIGlmIChpZHggPj0gMCkgZGF0YS5fbndBY2NvdW50c1tpZHhdID0geyAuLi5kYXRhLl9ud0FjY291bnRzW2lkeF0sIG5hbWUsIHR5cGUsIGJhbGFuY2UsIGN1cnJlbmN5LCBsYXN0VXBkYXRlZCwgbWV0YSB9OwogIH0gZWxzZSB7CiAgICBjb25zdCBpZCA9ICdud2FfJyArIERhdGUubm93KCkgKyAnXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLDYpOwogICAgZGF0YS5fbndBY2NvdW50cy5wdXNoKHsgaWQsIG5hbWUsIHR5cGUsIGJhbGFuY2UsIGN1cnJlbmN5LCBsYXN0VXBkYXRlZCwgbWV0YSB9KTsKICB9CgogIHNhdmUoKTsKICBjbG9zZU5XU2hlZXQoKTsKICByZW5kZXJOZXRXb3J0aCgpOwogIHNob3dUb2FzdCgn4pyFIEFjY291bnQgc2F2ZWQnKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIElNUE9SVCBIVUIKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCmxldCBpbXBvcnRTdGF0ZSA9IHsKICB0cmFuc2FjdGlvbnM6IHsgcm93czogW10sIGhlYWRlcnM6IFtdLCB0eXBlOiAnZXhwZW5zZScsIGNvbE1hcDoge30sIGNhdE1lcmdlczoge30gfSwKICBnaXZlbjogeyByb3dzOiBbXSwgaGVhZGVyczogW10gfSwKICBtZXRhbHM6IHsgcm93czogW10sIGhlYWRlcnM6IFtdIH0sCiAgcmVhbGVzdGF0ZTogeyByb3dzOiBbXSwgaGVhZGVyczogW10gfSwKfTsKCmZ1bmN0aW9uIHNldEltcG9ydFRhYih0YWIsIGVsKSB7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmltcG9ydC10YWInKS5mb3JFYWNoKHQgPT4gdC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmltcG9ydC1zZWN0aW9uJykuZm9yRWFjaChzID0+IHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogIGlmIChlbCkgZWwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgY29uc3Qgc2VjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lzZWMtJyArIHRhYik7CiAgaWYgKHNlYykgc2VjLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGlmICh0YWIgPT09ICdnaXZlbicpIHJlbmRlckdpdmVuTGVkZ2VyKCk7CiAgaWYgKHRhYiA9PT0gJ3Jlc2V0JykgeyByZW5kZXJSZXNldFN1bW1hcnkoKTsgcmVuZGVyTW9udGhzTGlzdCgpOyB9Cn0KCmZ1bmN0aW9uIGhhbmRsZUltcG9ydERyb3AoZXZlbnQsIHR5cGUpIHsKICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbXBvcnQtZHJvcC16b25lJykuZm9yRWFjaCh6ID0+IHouY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ292ZXInKSk7CiAgY29uc3QgZmlsZSA9IGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlc1swXTsKICBpZiAoZmlsZSkgcHJvY2Vzc0ltcG9ydEZpbGUoZmlsZSwgdHlwZSk7Cn0KCmZ1bmN0aW9uIGhhbmRsZUltcG9ydEZpbGUoaW5wdXQsIHR5cGUpIHsKICBjb25zdCBmaWxlID0gaW5wdXQuZmlsZXNbMF07CiAgaWYgKGZpbGUpIHByb2Nlc3NJbXBvcnRGaWxlKGZpbGUsIHR5cGUpOwogIGlucHV0LnZhbHVlID0gJyc7Cn0KCmZ1bmN0aW9uIHByb2Nlc3NJbXBvcnRGaWxlKGZpbGUsIHR5cGUpIHsKICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHdiID0gWExTWC5yZWFkKGUudGFyZ2V0LnJlc3VsdCwgeyB0eXBlOiAnYXJyYXknLCBjZWxsRGF0ZXM6IHRydWUgfSk7CiAgICAgIGNvbnN0IHdzID0gd2IuU2hlZXRzW3diLlNoZWV0TmFtZXNbMF1dOwogICAgICBjb25zdCByYXdSb3dzID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHdzLCB7IGhlYWRlcjogMSwgcmF3OiBmYWxzZSwgZGF0ZU5GOiAneXl5eS1tbS1kZCcgfSk7CiAgICAgIGlmIChyYXdSb3dzLmxlbmd0aCA8IDIpIHsgc2hvd1RvYXN0KCdGaWxlIGFwcGVhcnMgZW1wdHkg4p2MJyk7IHJldHVybjsgfQogICAgICBjb25zdCBoZWFkZXJzID0gKHJhd1Jvd3NbMF0gfHwgW10pLm1hcChoID0+IFN0cmluZyhoIHx8ICcnKS50cmltKCkpOwogICAgICBjb25zdCByb3dzID0gcmF3Um93cy5zbGljZSgxKS5maWx0ZXIociA9PiByLnNvbWUoYyA9PiBjICE9PSBudWxsICYmIGMgIT09IHVuZGVmaW5lZCAmJiBTdHJpbmcoYykudHJpbSgpICE9PSAnJykpOwogICAgICBpbXBvcnRTdGF0ZVt0eXBlXSA9IHsgLi4uaW1wb3J0U3RhdGVbdHlwZV0sIHJvd3MsIGhlYWRlcnMgfTsKICAgICAgc2hvd1RvYXN0KGDinIUgTG9hZGVkICR7cm93cy5sZW5ndGh9IHJvd3NgKTsKICAgICAgaWYgKHR5cGUgPT09ICd0cmFuc2FjdGlvbnMnKSBidWlsZFR4Q29sTWFwKGhlYWRlcnMsIHJvd3MpOwogICAgICBlbHNlIGlmICh0eXBlID09PSAnZ2l2ZW4nKSAgICAgIHNob3dHaXZlblByZXZpZXcocm93cywgaGVhZGVycyk7CiAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdtZXRhbHMnKSAgICAgc2hvd01ldGFsc1ByZXZpZXcocm93cywgaGVhZGVycyk7CiAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdyZWFsZXN0YXRlJykgc2hvd1JFUHJldmlldyhyb3dzLCBoZWFkZXJzKTsKICAgIH0gY2F0Y2goZXJyKSB7IHNob3dUb2FzdCgnRXJyb3IgcmVhZGluZyBmaWxlIOKdjCAnICsgZXJyLm1lc3NhZ2UpOyB9CiAgfTsKICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7Cn0KCi8vIOKUgOKUgCBUUkFOU0FDVElPTlMgSU1QT1JURVIg4pSA4pSACmZ1bmN0aW9uIGJ1aWxkVHhDb2xNYXAoaGVhZGVycywgcm93cykgewogIC8vIFNtYXJ0IGF1dG8tZGV0ZWN0CiAgY29uc3QgZmluZCA9IChrZXl3b3JkcykgPT4gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBrZXl3b3Jkcy5zb21lKGsgPT4gaC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGspKSk7CiAgY29uc3QgY29sTWFwID0gewogICAgZGF0ZTogICAgIGZpbmQoWydkYXRlJ10pLAogICAgY2F0ZWdvcnk6IGZpbmQoWydjYXRlZ29yeScsJ2NhdCcsJ3R5cGUnXSksCiAgICBhbW91bnQ6ICAgZmluZChbJ2Ftb3VudCcsJ2FtdCcsJ3N1bScsJ3ZhbHVlJ10pLAogICAgZGVzY3JpcHRpb246IGZpbmQoWydkZXNjcmlwdGlvbicsJ2Rlc2MnLCdzdG9yZScsJ25vdGUnLCdtZXJjaGFudCddKSwKICAgIG1vbnRoOiAgICBmaW5kKFsnbW9udGgnXSksCiAgfTsKICBpbXBvcnRTdGF0ZS50cmFuc2FjdGlvbnMuY29sTWFwID0gY29sTWFwOwoKICAvLyBCdWlsZCBjb2wgbWFwIFVJCiAgY29uc3QgZmllbGRzID0gWwogICAgeyBrZXk6ICdkYXRlJywgbGFiZWw6ICfwn5OFIERhdGUnLCByZXF1aXJlZDogdHJ1ZSB9LAogICAgeyBrZXk6ICdjYXRlZ29yeScsIGxhYmVsOiAn8J+Pt++4jyBDYXRlZ29yeScsIHJlcXVpcmVkOiB0cnVlIH0sCiAgICB7IGtleTogJ2Ftb3VudCcsIGxhYmVsOiAn8J+SsiBBbW91bnQnLCByZXF1aXJlZDogdHJ1ZSB9LAogICAgeyBrZXk6ICdkZXNjcmlwdGlvbicsIGxhYmVsOiAn8J+TnSBEZXNjcmlwdGlvbicsIHJlcXVpcmVkOiBmYWxzZSB9LAogIF07CiAgY29uc3QgdHhUeXBlID0gZG9j','dW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0iaXR4LXR5cGUiXTpjaGVja2VkJyk/LnZhbHVlIHx8ICdleHBlbnNlJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXR4LW1hcC1zdWInKS50ZXh0Q29udGVudCA9IGBNYXBwaW5nICR7cm93cy5sZW5ndGh9IHJvd3MgZnJvbSB5b3VyICR7dHhUeXBlfSBmaWxlLmA7CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtY29sLW1hcCcpLmlubmVySFRNTCA9IGZpZWxkcy5tYXAoZiA9PiBgCiAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtY29sLXJvdyI+CiAgICAgIDxkaXYgY2xhc3M9ImltcG9ydC1jb2wtZmllbGQiPiR7Zi5sYWJlbH0ke2YucmVxdWlyZWQ/JyAqJzonJ308L2Rpdj4KICAgICAgPHNlbGVjdCBjbGFzcz0iaW1wb3J0LWNvbC1zZWxlY3QiIGlkPSJpbWFwLSR7Zi5rZXl9IiBvbmNoYW5nZT0idXBkYXRlVHhQcmV2aWV3KCkiPgogICAgICAgIDxvcHRpb24gdmFsdWU9Ii0xIj7igJQgc2tpcCDigJQ8L29wdGlvbj4KICAgICAgICAke2hlYWRlcnMubWFwKChoLGkpID0+IGA8b3B0aW9uIHZhbHVlPSIke2l9IiAke2NvbE1hcFtmLmtleV09PT1pPydzZWxlY3RlZCc6Jyd9PiR7aH08L29wdGlvbj5gKS5qb2luKCcnKX0KICAgICAgPC9zZWxlY3Q+CiAgICA8L2Rpdj4KICBgKS5qb2luKCcnKTsKCiAgdXBkYXRlVHhQcmV2aWV3KCk7CiAgZ29Ub0ltcG9ydFN0ZXAoJ3RyYW5zYWN0aW9ucycsICdzdGVwMicpOwp9CgpmdW5jdGlvbiB1cGRhdGVUeFByZXZpZXcoKSB7CiAgY29uc3QgeyByb3dzLCBoZWFkZXJzIH0gPSBpbXBvcnRTdGF0ZS50cmFuc2FjdGlvbnM7CiAgY29uc3QgZ2V0Q29sID0ga2V5ID0+IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbWFwLSR7a2V5fWApPy52YWx1ZSA/PyAnLTEnKTsKICBjb25zdCBwcmV2aWV3ID0gcm93cy5zbGljZSgwLCA1KS5tYXAocm93ID0+ICh7CiAgICBEYXRlOiByb3dbZ2V0Q29sKCdkYXRlJyldIHx8ICcnLAogICAgQ2F0ZWdvcnk6IHJvd1tnZXRDb2woJ2NhdGVnb3J5JyldIHx8ICcnLAogICAgQW1vdW50OiByb3dbZ2V0Q29sKCdhbW91bnQnKV0gfHwgJycsCiAgICBEZXNjcmlwdGlvbjogcm93W2dldENvbCgnZGVzY3JpcHRpb24nKV0gfHwgJycsCiAgfSkpOwogIGNvbnN0IHRibCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtcHJldmlldy10YWJsZScpOwogIGlmICghdGJsKSByZXR1cm47CiAgY29uc3QgY29scyA9IFsnRGF0ZScsJ0NhdGVnb3J5JywnQW1vdW50JywnRGVzY3JpcHRpb24nXTsKICB0YmwuaW5uZXJIVE1MID0gYDx0aGVhZD48dHI+JHtjb2xzLm1hcChjPT5gPHRoPiR7Y308L3RoPmApLmpvaW4oJycpfTwvdHI+PC90aGVhZD48dGJvZHk+JHsKICAgIHByZXZpZXcubWFwKHIgPT4gYDx0cj4ke2NvbHMubWFwKGM9PmA8dGQ+JHtyW2NdfTwvdGQ+YCkuam9pbignJyl9PC90cj5gKS5qb2luKCcnKQogIH08L3Rib2R5PmA7Cn0KCmZ1bmN0aW9uIGdvVG9JbXBvcnRTdGVwKHR5cGUsIHN0ZXApIHsKICBpZiAodHlwZSA9PT0gJ3RyYW5zYWN0aW9ucycpIHsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNpc2VjLXRyYW5zYWN0aW9ucyAuaW1wb3J0LXN0ZXAnKS5mb3JFYWNoKHMgPT4gcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpdHgtJHtzdGVwfWApOwogICAgaWYgKGVsKSBlbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGlmIChzdGVwID09PSAnc3RlcDMnKSBidWlsZENhdFJldmlldygpOwogICAgaWYgKHN0ZXAgPT09ICdzdGVwNCcpIGJ1aWxkRmluYWxQcmV2aWV3KCk7CiAgfQp9CgpmdW5jdGlvbiBidWlsZENhdFJldmlldygpIHsKICBjb25zdCB7IHJvd3MsIGhlYWRlcnMsIGNhdE1lcmdlcyB9ID0gaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zOwogIGNvbnN0IGdldENvbCA9IGtleSA9PiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaW1hcC0ke2tleX1gKT8udmFsdWUgPz8gJy0xJyk7CiAgY29uc3QgY2F0Q29sID0gZ2V0Q29sKCdjYXRlZ29yeScpOwogIGlmIChjYXRDb2wgPCAwKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtY2F0LXJldmlldycpLmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXNpemU6MC44NWVtOyI+Tm8gY2F0ZWdvcnkgY29sdW1uIHNlbGVjdGVkLjwvZGl2Pic7IHJldHVybjsgfQoKICBjb25zdCByYXdDYXRzID0gWy4uLm5ldyBTZXQocm93cy5tYXAociA9PiBTdHJpbmcocltjYXRDb2xdIHx8ICcnKS50cmltKCkpLmZpbHRlcihCb29sZWFuKSldLnNvcnQoKTsKCiAgLy8gRGV0ZWN0IG5lYXItZHVwbGljYXRlczogdHJpbSwgbG93ZXJjYXNlLCByZW1vdmUgdHJhaWxpbmcgc3BhY2VzCiAgY29uc3QgZ3JvdXBzID0ge307CiAgcmF3Q2F0cy5mb3JFYWNoKGNhdCA9PiB7CiAgICBjb25zdCBub3JtID0gY2F0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXHMrL2csICcgJykudHJpbSgpOwogICAgaWYgKCFncm91cHNbbm9ybV0pIGdyb3Vwc1tub3JtXSA9IFtdOwogICAgZ3JvdXBzW25vcm1dLnB1c2goY2F0KTsKICB9KTsKCiAgLy8gRmxhZyBncm91cHMgd2l0aCBtdWx0aXBsZSByYXcgdmFsdWVzIGFzIGR1cGxpY2F0ZXMKICBjb25zdCBkdXBzID0gT2JqZWN0LmVudHJpZXMoZ3JvdXBzKS5maWx0ZXIoKFssY2F0c10pID0+IGNhdHMubGVuZ3RoID4gMSk7CiAgY29uc3Qgc2luZ2xlcyA9IE9iamVjdC5lbnRyaWVzKGdyb3VwcykuZmlsdGVyKChbLGNhdHNdKSA9PiBjYXRzLmxlbmd0aCA9PT0gMSk7CgogIGxldCBodG1sID0gJyc7CiAgaWYgKGR1cHMubGVuZ3RoID09PSAwKSB7CiAgICBodG1sID0gYDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I0YwRkJGMztib3JkZXItcmFkaXVzOnZhcigtLXJhZGl1cy1zbSk7cGFkZGluZzoxMnB4O2NvbG9yOiMxMEI5ODE7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTowLjg1ZW07bWFyZ2luLWJvdHRvbToxMnB4OyI+4pyFIE5vIGR1cGxpY2F0ZSBjYXRlZ29yaWVzIGRldGVjdGVkIOKAlCAke3Jhd0NhdHMubGVuZ3RofSB1bmlxdWUgY2F0ZWdvcmllcyBmb3VuZDwvZGl2PmA7CiAgfSBlbHNlIHsKICAgIGh0bWwgPSBgPGRpdiBzdHlsZT0iZm9udC1zaXplOjAuNzhlbTtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTtmb250LXdlaWdodDo3MDA7bWFyZ2luLWJvdHRvbToxMHB4OyI+JHtkdXBzLmxlbmd0aH0gcG9zc2libGUgZHVwbGljYXRlKHMpIGZvdW5kIOKAlCByZXZpZXcgYW5kIGNob29zZSBhY3Rpb246PC9kaXY+YDsKICAgIGR1cHMuZm9yRWFjaCgoW25vcm0sIGNhdHNdKSA9PiB7CiAgICAgIGNvbnN0IGlzTWVyZ2VkID0gY2F0TWVyZ2VzW25vcm1dICE9PSB1bmRlZmluZWQ7CiAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9ImNhdC1yZXZpZXctaXRlbSI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImNhdC1yZXZpZXctZmxhZyBkdXAiPuKaoO+4jyBEdXBsaWNhdGU8L3NwYW4+CiAgICAgICAgPGRpdiBjbGFzcz0iY2F0LXJldmlldy1uYW1lcyI+JHtjYXRzLm1hcChjPT5gIiR7Y30iYCkuam9pbignICsgJyl9PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2F0LXJldmlldy1hY3Rpb24iPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iY2F0LW1lcmdlLWJ0biAke2lzTWVyZ2VkJiZjYXRNZXJnZXNbbm9ybV09PT1jYXRzWzBdPydhY3RpdmUnOicnfSIgb25jbGljaz0ic2V0Q2F0TWVyZ2UoJyR7bm9ybX0nLCcke2NhdHNbMF0ucmVwbGFjZSgvJy9nLCJcXCciKX0nKSI+TWVyZ2Ug4oaSICIke2NhdHNbMF19IjwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iY2F0LWtlZXAtYnRuIiBvbmNsaWNrPSJzZXRDYXRLZWVwKCcke25vcm19JykiPktlZXAgc2VwYXJhdGU8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+YDsKICAgIH0pOwogIH0KCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0eC1jYXQtcmV2aWV3JykuaW5uZXJIVE1MID0gaHRtbDsKfQoKZnVuY3Rpb24gc2V0Q2F0TWVyZ2Uobm9ybSwgY2Fub25pY2FsKSB7CiAgaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zLmNhdE1lcmdlc1tub3JtXSA9IGNhbm9uaWNhbDsKICBidWlsZENhdFJldmlldygpOwogIHNob3dUb2FzdChgTWVyZ2VkIOKGkiAiJHtjYW5vbmljYWx9ImApOwp9CgpmdW5jdGlvbiBzZXRDYXRLZWVwKG5vcm0pIHsKICBkZWxldGUgaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zLmNhdE1lcmdlc1tub3JtXTsKICBidWlsZENhdFJldmlldygpOwp9CgpmdW5jdGlvbiBidWlsZEZpbmFsUHJldmlldygpIHsKICBjb25zdCByZWNvcmRzID0gYnVpbGRUeFJlY29yZHMoKTsKICBjb25zdCBtb250aENvdW50cyA9IHt9OwogIHJlY29yZHMuZm9yRWFjaChyID0+IHsgbW9udGhDb3VudHNbci5fbW9udGhdID0gKG1vbnRoQ291bnRzW3IuX21vbnRoXXx8MCkrMTsgfSk7CiAgY29uc3QgdG90YWxBbXQgPSByZWNvcmRzLnJlZHVjZSgocyxyKT0+cytyLmFtb3VudCwwKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0eC1zdW1tYXJ5LWdyaWQnKS5pbm5lckhUTUwgPSBgCiAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtc3VtbWFyeS1ib3giPjxkaXYgY2xhc3M9ImlzYi1udW0iPiR7cmVjb3Jkcy5sZW5ndGh9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5UcmFuc2FjdGlvbnM8L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImltcG9ydC1zdW1tYXJ5LWJveCI+PGRpdiBjbGFzcz0iaXNiLW51bSI+JHtPYmplY3Qua2V5cyhtb250aENvdW50cykubGVuZ3RofTwvZGl2PjxkaXYgY2xhc3M9ImlzYi1sYWJlbCI+TW9udGhzPC9kaXY+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtc3VtbWFyeS1ib3giPjxkaXYgY2xhc3M9ImlzYi1udW0iPiR7Zm10KHRvdGFsQW10KX08L2Rpdj48ZGl2IGNsYXNzPSJpc2ItbGFiZWwiPlRvdGFsPC9kaXY+PC9kaXY+CiAgYDsKCiAgY29uc3QgcHJldmlldyA9IHJlY29yZHMuc2xpY2UoMCwgMjApOwogIGNvbnN0IHRibCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtZmluYWwtdGFibGUnKTsKICB0YmwuaW5uZXJIVE1MID0gYDx0aGVhZD48dHI+PHRoPkRhdGU8L3RoPjx0aD5DYXRlZ29yeTwvdGg+PHRoPkFtb3VudDwvdGg+PHRoPkRlc2NyaXB0aW9uPC90aD48L3RyPjwvdGhlYWQ+PHRib2R5PiR7CiAgICBwcmV2aWV3Lm1hcChyPT5gPHRyPjx0ZD4ke3IuZGF0ZX08L3RkPjx0ZD4ke3IuY2F0ZWdvcnl9PC90ZD48dGQ+JHtmbXQoci5hbW91bnQpfTwvdGQ+PHRkPiR7ci5kZXNjcmlwdGlvbnx8Jyd9PC90ZD48L3RyPmApLmpvaW4oJycpCiAgfSR7cmVjb3Jkcy5sZW5ndGg+MjA/YDx0cj48dGQgY29sc3Bhbj0iNCIgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtc3R5bGU6aXRhbGljOyI+Li4uIGFuZCAke3JlY29yZHMubGVuZ3RoLTIwfSBtb3JlPC90ZD48L3RyPmA6Jyd9PC90Ym9keT5gOwp9CgpmdW5jdGlvbiBidWlsZFR4UmVjb3JkcygpIHsKICBjb25zdCB7IHJvd3MsIGNhdE1lcmdlcyB9ID0gaW1wb3J0U3RhdGUudHJhbnNhY3Rpb25zOwogIGNvbnN0IGdldENvbCA9IGtleSA9PiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaW1hcC0ke2tleX1gKT8udmFsdWUgPz8gJy0xJyk7CiAgY29uc3QgZGF0ZUNvbCA9IGdldENvbCgnZGF0ZScpLCBjYXRDb2wgPSBnZXRDb2woJ2NhdGVnb3J5JyksIGFtdENvbCA9IGdldENvbCgnYW1vdW50JyksIGRlc2NDb2wgPSBnZXRDb2woJ2Rlc2NyaXB0aW9uJyk7CiAgY29uc3QgdHhUeXBlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0iaXR4LXR5cGUiXTpjaGVja2VkJyk/LnZhbHVlIHx8ICdleHBlbnNlJzsKICBjb25zdCByZWNvcmRzID0gW107CgogIHJvd3MuZm9yRWFjaChyb3cgPT4gewogICAgY29uc3QgcmF3RGF0ZSA9IFN0cmluZyhyb3dbZGF0ZUNvbF0gfHwgJycpLnRyaW0oKTsKICAgIGxldCBkYXRlU3RyID0gJyc7CiAg','ICBpZiAocmF3RGF0ZSkgewogICAgICAvLyBIYW5kbGUgRXhjZWwgZGF0ZSBmb3JtYXRzCiAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShyYXdEYXRlKTsKICAgICAgaWYgKCFpc05hTihkKSkgZGF0ZVN0ciA9IGQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwogICAgICBlbHNlIGRhdGVTdHIgPSByYXdEYXRlLnN1YnN0cmluZygwLDEwKTsKICAgIH0KICAgIGlmICghZGF0ZVN0ciB8fCBkYXRlU3RyID09PSAnTmFOLWFOLWFOJykgcmV0dXJuOwoKICAgIGNvbnN0IG1vbnRoS2V5ID0gZGF0ZVN0ci5zdWJzdHJpbmcoMCw3KTsKICAgIGxldCByYXdDYXQgPSBTdHJpbmcocm93W2NhdENvbF0gfHwgJycpLnRyaW0oKTsKICAgIGNvbnN0IG5vcm0gPSByYXdDYXQudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9ccysvZywnICcpLnRyaW0oKTsKICAgIGlmIChjYXRNZXJnZXNbbm9ybV0pIHJhd0NhdCA9IGNhdE1lcmdlc1tub3JtXTsKCiAgICBjb25zdCByYXdBbXQgPSBTdHJpbmcocm93W2FtdENvbF0gfHwgJzAnKS5yZXBsYWNlKC9bJCxdL2csJycpOwogICAgY29uc3QgYW1vdW50ID0gTWF0aC5hYnMocGFyc2VGbG9hdChyYXdBbXQpIHx8IDApOwogICAgaWYgKCFhbW91bnQgJiYgIXJhd0NhdCkgcmV0dXJuOwoKICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZGVzY0NvbCA+PSAwID8gU3RyaW5nKHJvd1tkZXNjQ29sXSB8fCAnJykudHJpbSgpIDogJyc7CiAgICByZWNvcmRzLnB1c2goeyBkYXRlOiBkYXRlU3RyLCBjYXRlZ29yeTogcmF3Q2F0LCBhbW91bnQsIGRlc2NyaXB0aW9uLCBfbW9udGg6IG1vbnRoS2V5LCBfdHlwZTogdHhUeXBlIH0pOwogIH0pOwogIHJldHVybiByZWNvcmRzOwp9CgpmdW5jdGlvbiBjb25maXJtSW1wb3J0KHR5cGUpIHsKICBpZiAodHlwZSAhPT0gJ3RyYW5zYWN0aW9ucycpIHJldHVybjsKICBjb25zdCByZWNvcmRzID0gYnVpbGRUeFJlY29yZHMoKTsKICBpZiAocmVjb3Jkcy5sZW5ndGggPT09IDApIHsgc2hvd1RvYXN0KCdObyB2YWxpZCByZWNvcmRzIHRvIGltcG9ydCDinYwnKTsgcmV0dXJuOyB9CgogIGNvbnN0IHR5cGVNYXAgPSB7IGV4cGVuc2U6ICdleHBlbnNlcycsIGluY29tZTogJ2luY29tZScsIGludmVzdG1lbnQ6ICdpbnZlc3RtZW50cycgfTsKICBsZXQgaW1wb3J0ZWQgPSAwOwoKICByZWNvcmRzLmZvckVhY2gociA9PiB7CiAgICBlbnN1cmVNb250aChyLl9tb250aCk7CiAgICBjb25zdCBsaXN0S2V5ID0gdHlwZU1hcFtyLl90eXBlXSB8fCAnZXhwZW5zZXMnOwogICAgY29uc3QgZW50cnkgPSB7IGRhdGU6IHIuZGF0ZSwgY2F0ZWdvcnk6IHIuY2F0ZWdvcnksIGFtb3VudDogci5hbW91bnQsIGRlc2NyaXB0aW9uOiByLmRlc2NyaXB0aW9uLCBjdXJyZW5jeTogY3VycmVudEN1cnJlbmN5LmNvZGUgfTsKICAgIGRhdGFbci5fbW9udGhdW2xpc3RLZXldLnB1c2goZW50cnkpOwogICAgaW1wb3J0ZWQrKzsKICB9KTsKCiAgc2F2ZSgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpdHgtZG9uZS10aXRsZScpLnRleHRDb250ZW50ID0gYEltcG9ydCBDb21wbGV0ZSEg8J+OiWA7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0eC1kb25lLXN1YicpLnRleHRDb250ZW50ID0gYCR7aW1wb3J0ZWR9IHRyYW5zYWN0aW9ucyBsb2FkZWQgYWNyb3NzICR7bmV3IFNldChyZWNvcmRzLm1hcChyPT5yLl9tb250aCkpLnNpemV9IG1vbnRoc2A7CiAgZ29Ub0ltcG9ydFN0ZXAoJ3RyYW5zYWN0aW9ucycsICdzdGVwNScpOwogIHJlbmRlckhvbWUoKTsKICBzaG93VG9hc3QoYOKchSAke2ltcG9ydGVkfSB0cmFuc2FjdGlvbnMgaW1wb3J0ZWQhYCk7Cn0KCmZ1bmN0aW9uIHJlc2V0SW1wb3J0U3RlcCh0eXBlKSB7CiAgaWYgKHR5cGUgPT09ICd0cmFuc2FjdGlvbnMnKSB7CiAgICBpbXBvcnRTdGF0ZS50cmFuc2FjdGlvbnMgPSB7IHJvd3M6IFtdLCBoZWFkZXJzOiBbXSwgdHlwZTogJ2V4cGVuc2UnLCBjb2xNYXA6IHt9LCBjYXRNZXJnZXM6IHt9IH07CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjaXNlYy10cmFuc2FjdGlvbnMgLmltcG9ydC1zdGVwJykuZm9yRWFjaChzID0+IHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2l0eC1zdGVwMScpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIH0KfQoKLy8g4pSA4pSAIEdJVkVOIFRPIE9USEVSUyDilIDilIAKZnVuY3Rpb24gcHJvY2Vzc0dpdmVuSW1wb3J0KHJvd3MsIGhlYWRlcnMpIHsKICBjb25zdCBmaW5kID0ga3dzID0+IGhlYWRlcnMuZmluZEluZGV4KGggPT4ga3dzLnNvbWUoayA9PiBoLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaykpKTsKICBjb25zdCBkYXRlQ29sID0gZmluZChbJ2RhdGUnXSksIGNhdENvbCA9IGZpbmQoWydjYXRlZ29yeScsJ3BlcnNvbicsJ25hbWUnXSksIGFtdENvbCA9IGZpbmQoWydhbW91bnQnLCdhbXQnXSksIGRlc2NDb2wgPSBmaW5kKFsnZGVzYycsJ25vdGUnXSk7CgogIGlmIChkYXRlQ29sIDwgMCB8fCBjYXRDb2wgPCAwIHx8IGFtdENvbCA8IDApIHsgc2hvd1RvYXN0KCdDb3VsZCBub3QgZGV0ZWN0IHJlcXVpcmVkIGNvbHVtbnMg4p2MJyk7IHJldHVybjsgfQoKICBsZXQgaW1wb3J0ZWQgPSAwOwogIHJvd3MuZm9yRWFjaChyb3cgPT4gewogICAgY29uc3QgcmF3RGF0ZSA9IFN0cmluZyhyb3dbZGF0ZUNvbF18fCcnKS50cmltKCk7CiAgICBjb25zdCBkID0gbmV3IERhdGUocmF3RGF0ZSk7CiAgICBpZiAoaXNOYU4oZCkpIHJldHVybjsKICAgIGNvbnN0IGRhdGVTdHIgPSBkLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgIGNvbnN0IG1vbnRoS2V5ID0gZGF0ZVN0ci5zdWJzdHJpbmcoMCw3KTsKICAgIGVuc3VyZU1vbnRoKG1vbnRoS2V5KTsKICAgIGNvbnN0IGFtb3VudCA9IE1hdGguYWJzKHBhcnNlRmxvYXQoU3RyaW5nKHJvd1thbXRDb2xdfHwnMCcpLnJlcGxhY2UoL1skLF0vZywnJykpfHwwKTsKICAgIGlmICghYW1vdW50KSByZXR1cm47CiAgICBjb25zdCBlbnRyeSA9IHsgZGF0ZTogZGF0ZVN0ciwgY2F0ZWdvcnk6IFN0cmluZyhyb3dbY2F0Q29sXXx8JycpLnRyaW0oKSwgYW1vdW50LCBkZXNjcmlwdGlvbjogZGVzY0NvbD49MD9TdHJpbmcocm93W2Rlc2NDb2xdfHwnJykudHJpbSgpOicnLCBjdXJyZW5jeTogY3VycmVudEN1cnJlbmN5LmNvZGUgfTsKICAgIGlmICghZGF0YVttb250aEtleV0uZ2l2ZW5Ub090aGVycykgZGF0YVttb250aEtleV0uZ2l2ZW5Ub090aGVycyA9IFtdOwogICAgZGF0YVttb250aEtleV0uZ2l2ZW5Ub090aGVycy5wdXNoKGVudHJ5KTsKICAgIGltcG9ydGVkKys7CiAgfSk7CgogIHNhdmUoKTsKfQoKZnVuY3Rpb24gcmVuZGVyR2l2ZW5MZWRnZXIoKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2l2ZW4tbGVkZ2VyLWxpc3QnKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3QgYmFsYW5jZXMgPSB7fTsKICBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoaz0+IWsuc3RhcnRzV2l0aCgnXycpKS5mb3JFYWNoKG1rPT57CiAgICAoZGF0YVtta10uZ2l2ZW5Ub090aGVyc3x8W10pLmZvckVhY2goZT0+ewogICAgICBiYWxhbmNlc1tlLmNhdGVnb3J5XSA9IChiYWxhbmNlc1tlLmNhdGVnb3J5XXx8MCkgKyBjb252ZXJ0QW10KGUuYW1vdW50LCBlLmN1cnJlbmN5KTsKICAgIH0pOwogIH0pOwogIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhiYWxhbmNlcyk7CiAgaWYgKCFlbnRyaWVzLmxlbmd0aCkgeyBlbC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC1zaXplOjAuODJlbTtwYWRkaW5nOjhweCAwOyI+Tm8gZ2l2ZW4tdG8tb3RoZXJzIGRhdGEgeWV0PC9kaXY+JzsgcmV0dXJuOyB9CiAgY29uc3QgdG90YWwgPSBlbnRyaWVzLnJlZHVjZSgocyxbLHZdKT0+cyt2LDApOwogIGVsLmlubmVySFRNTCA9IGVudHJpZXMuc29ydCgoYSxiKT0+YlsxXS1hWzFdKS5tYXAoKFtuYW1lLCB2YWxdKSA9PgogICAgYDxkaXYgY2xhc3M9ImdpdmVuLWxlZGdlci1yb3ciPjxkaXY+PGRpdiBjbGFzcz0iZ2l2ZW4tcGVyc29uIj4ke25hbWV9PC9kaXY+PGRpdiBzdHlsZT0iZm9udC1zaXplOjAuN2VtO2NvbG9yOnZhcigtLXRleHQtbGlnaHQpO2ZvbnQtd2VpZ2h0OjYwMDsiPk91dHN0YW5kaW5nPC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0iZ2l2ZW4tdG90YWwiPiR7Zm10KHZhbCl9PC9kaXY+PC9kaXY+YAogICkuam9pbignJykgKyBgPGRpdiBzdHlsZT0iYm9yZGVyLXRvcDoycHggc29saWQgdmFyKC0teWVsbG93KTttYXJnaW4tdG9wOjhweDtwYWRkaW5nLXRvcDo4cHg7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2ZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45MmVtOyI+PHNwYW4+VG90YWw8L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWV4cGVuc2VzKTsiPiR7Zm10KHRvdGFsKX08L3NwYW4+PC9kaXY+YDsKfQoKLy8g4pSA4pSAIE1FVEFMUyBJTVBPUlRFUiDilIDilIAKCi8vIOKUgOKUgCBQcmV2aWV3IGhlbHBlcnMgZm9yIE1ldGFscyAvIEdpdmVuIC8gUkUgaW1wb3J0cyDilIDilIAKCmxldCBfbWV0YWxzUHJldmlld1Jvd3MgPSBbXSwgX21ldGFsc1ByZXZpZXdIZWFkZXJzID0gW107CmxldCBfZ2l2ZW5QcmV2aWV3Um93cyAgPSBbXSwgX2dpdmVuUHJldmlld0hlYWRlcnMgID0gW107CmxldCBfcmVQcmV2aWV3Um93cyAgICAgPSBbXSwgX3JlUHJldmlld0hlYWRlcnMgICAgID0gW107CgpmdW5jdGlvbiBfYnVpbGRQcmV2aWV3VGFibGUoaGVhZGVycywgcm93cywgbWF4Um93cz01KSB7CiAgY29uc3QgZGlzcGxheSA9IHJvd3Muc2xpY2UoMCwgbWF4Um93cyk7CiAgY29uc3QgdGggPSBoZWFkZXJzLm1hcChoPT5gPHRoIHN0eWxlPSJwYWRkaW5nOjZweCAxMHB4O2JhY2tncm91bmQ6I0YwRjBGMDtmb250LXNpemU6MC43NWVtO2ZvbnQtd2VpZ2h0OjgwMDt3aGl0ZS1zcGFjZTpub3dyYXA7Ij4ke2h9PC90aD5gKS5qb2luKCcnKTsKICBjb25zdCB0cnMgPSBkaXNwbGF5Lm1hcChyPT4nPHRyPicraGVhZGVycy5tYXAoKF8saSk9PmA8dGQgc3R5bGU9InBhZGRpbmc6NXB4IDEwcHg7Zm9udC1zaXplOjAuNzhlbTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjRjBGMEYwOyI+JHtyW2ldfHwnJ308L3RkPmApLmpvaW4oJycpKyc8L3RyPicpLmpvaW4oJycpOwogIHJldHVybiBgPHRhYmxlIHN0eWxlPSJib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7d2lkdGg6MTAwJTsiPjx0aGVhZD48dHI+JHt0aH08L3RyPjwvdGhlYWQ+PHRib2R5PiR7dHJzfTwvdGJvZHk+PC90YWJsZT5gOwp9CgpmdW5jdGlvbiBzaG93TWV0YWxzUHJldmlldyhyb3dzLCBoZWFkZXJzKSB7CiAgX21ldGFsc1ByZXZpZXdSb3dzID0gcm93czsgX21ldGFsc1ByZXZpZXdIZWFkZXJzID0gaGVhZGVyczsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1zdGVwMScpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LXN0ZXAyJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXRhbHMtcHJldmlldy10YWJsZS13cmFwJykuaW5uZXJIVE1MID0gX2J1aWxkUHJldmlld1RhYmxlKGhlYWRlcnMsIHJvd3MpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0YWxzLXN1bW1hcnknKS5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDojRjBGQkYzO2JvcmRlci1yYWRpdXM6MTBweDtwYWRkaW5nOjEwcHggMTRweDtjb2xvcjojMTBCOTgxO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MC44NWVtOyI+JHtyb3dzLmxlbmd0aH0gcm93cyBkZXRlY3RlZCDCtyBSZXZpZXcgYWJvdmUgdGhlbiBjb25maXJtPC9kaXY+YDsKfQpmdW5jdGlvbiByZXNldE1ldGFsc0ltcG9ydCgpIHsKICBfbWV0YWxzUHJldmlld1Jvd3M9W107IF9tZXRhbHNQcmV2aWV3SGVhZGVycz1bXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1zdGVwMScpLmNsYXNzTGlz','dC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtc3RlcDMnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKfQpmdW5jdGlvbiBjb25maXJtTWV0YWxzSW1wb3J0KCkgewogIGNvbnN0IGJlZm9yZSA9IChkYXRhLl9tZXRhbHN8fFtdKS5sZW5ndGg7CiAgcHJvY2Vzc01ldGFsc0ltcG9ydChfbWV0YWxzUHJldmlld1Jvd3MsIF9tZXRhbHNQcmV2aWV3SGVhZGVycyk7CiAgY29uc3QgYWZ0ZXIgPSAoZGF0YS5fbWV0YWxzfHxbXSkubGVuZ3RoOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWV0LXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtc3RlcDMnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1ldC1kb25lLXRpdGxlJykudGV4dENvbnRlbnQgPSAoYWZ0ZXItYmVmb3JlKSArICcgTWV0YWxzIEltcG9ydGVkISc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZXQtZG9uZS1zdWInKS50ZXh0Q29udGVudCA9ICdUb3RhbDogJyArIChkYXRhLl9tZXRhbHN8fFtdKS5sZW5ndGggKyAnIGVudHJpZXMgaW4gcG9ydGZvbGlvJzsKICBfbWV0YWxzUHJldmlld1Jvd3M9W107IF9tZXRhbHNQcmV2aWV3SGVhZGVycz1bXTsKfQoKZnVuY3Rpb24gc2hvd0dpdmVuUHJldmlldyhyb3dzLCBoZWFkZXJzKSB7CiAgX2dpdmVuUHJldmlld1Jvd3MgPSByb3dzOyBfZ2l2ZW5QcmV2aWV3SGVhZGVycyA9IGhlYWRlcnM7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtc3RlcDEnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdi1zdGVwMicpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2ZW4tcHJldmlldy10YWJsZS13cmFwJykuaW5uZXJIVE1MID0gX2J1aWxkUHJldmlld1RhYmxlKGhlYWRlcnMsIHJvd3MpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2ZW4tc3VtbWFyeScpLmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJiYWNrZ3JvdW5kOiNGMEZCRjM7Ym9yZGVyLXJhZGl1czoxMHB4O3BhZGRpbmc6MTBweCAxNHB4O2NvbG9yOiMxMEI5ODE7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTowLjg1ZW07Ij4ke3Jvd3MubGVuZ3RofSByb3dzIGRldGVjdGVkIMK3IFJldmlldyBhYm92ZSB0aGVuIGNvbmZpcm08L2Rpdj5gOwp9CmZ1bmN0aW9uIHJlc2V0R2l2ZW5JbXBvcnQoKSB7CiAgX2dpdmVuUHJldmlld1Jvd3M9W107IF9naXZlblByZXZpZXdIZWFkZXJzPVtdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LXN0ZXAxJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtc3RlcDInKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdi1zdGVwMycpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwp9CmZ1bmN0aW9uIGNvbmZpcm1HaXZlbkltcG9ydCgpIHsKICAvLyBDb3VudCByb3dzIHRoYXQgd2lsbCBiZSBpbXBvcnRlZCAobm9uLWVtcHR5IHZhbGlkIHJvd3MpCiAgY29uc3QgYWRkZWQgPSBfZ2l2ZW5QcmV2aWV3Um93cy5maWx0ZXIociA9PiByICYmIHIubGVuZ3RoID4gMCkubGVuZ3RoOwogIHByb2Nlc3NHaXZlbkltcG9ydChfZ2l2ZW5QcmV2aWV3Um93cywgX2dpdmVuUHJldmlld0hlYWRlcnMpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZ2l2LXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtc3RlcDMnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWdpdi1kb25lLXRpdGxlJykudGV4dENvbnRlbnQgPSBhZGRlZCArICcgUmVjb3JkcyBJbXBvcnRlZCEg8J+OiSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lnaXYtZG9uZS1zdWInKS50ZXh0Q29udGVudCA9ICdZb3VyIEdpdmVuIHRvIE90aGVycyBsZWRnZXIgaGFzIGJlZW4gdXBkYXRlZCc7CiAgX2dpdmVuUHJldmlld1Jvd3M9W107IF9naXZlblByZXZpZXdIZWFkZXJzPVtdOwogIHJlbmRlckdpdmVuTGVkZ2VyKCk7CiAgc2hvd1RvYXN0KCfinIUgJyArIGFkZGVkICsgJyBHaXZlbiB0byBPdGhlcnMgaW1wb3J0ZWQhJyk7Cn0KCmZ1bmN0aW9uIHNob3dSRVByZXZpZXcocm93cywgaGVhZGVycykgewogIF9yZVByZXZpZXdSb3dzID0gcm93czsgX3JlUHJldmlld0hlYWRlcnMgPSBoZWFkZXJzOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtc3RlcDEnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLXN0ZXAyJykuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1wcmV2aWV3LXRhYmxlLXdyYXAnKS5pbm5lckhUTUwgPSBfYnVpbGRQcmV2aWV3VGFibGUoaGVhZGVycywgcm93cyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdW1tYXJ5JykuaW5uZXJIVE1MID0gYDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6I0YwRkJGMztib3JkZXItcmFkaXVzOjEwcHg7cGFkZGluZzoxMHB4IDE0cHg7Y29sb3I6IzEwQjk4MTtmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOjAuODVlbTsiPiR7cm93cy5sZW5ndGh9IHByb3BlcnRpZXMgZGV0ZWN0ZWQgwrcgUmV2aWV3IGFib3ZlIHRoZW4gY29uZmlybTwvZGl2PmA7Cn0KZnVuY3Rpb24gcmVzZXRSRUltcG9ydCgpIHsKICBfcmVQcmV2aWV3Um93cz1bXTsgX3JlUHJldmlld0hlYWRlcnM9W107CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdGVwMScpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtc3RlcDInKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLXN0ZXAzJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7Cn0KZnVuY3Rpb24gY29uZmlybVJFSW1wb3J0KCkgewogIGNvbnN0IHJlQmVmb3JlID0gKChkYXRhLl9yZWFsRXN0YXRlKXx8W10pLmxlbmd0aDsKICBwcm9jZXNzUkVJbXBvcnQoX3JlUHJldmlld1Jvd3MsIF9yZVByZXZpZXdIZWFkZXJzKTsKICBjb25zdCByZUFmdGVyID0gKChkYXRhLl9yZWFsRXN0YXRlKXx8W10pLmxlbmd0aDsKICBjb25zdCBhZGRlZCA9IHJlQWZ0ZXIgLSByZUJlZm9yZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlLXN0ZXAyJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZS1zdGVwMycpLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtZG9uZS10aXRsZScpLnRleHRDb250ZW50ID0gYWRkZWQgKyAnIFByb3BlcnRpZXMgSW1wb3J0ZWQhIPCfjoknOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpcmUtZG9uZS1zdWInKS50ZXh0Q29udGVudCA9ICdUb3RhbDogJyArIHJlQWZ0ZXIgKyAnIHJlYWwgZXN0YXRlIGVudHJpZXMnOwogIF9yZVByZXZpZXdSb3dzPVtdOyBfcmVQcmV2aWV3SGVhZGVycz1bXTsKICBzaG93VG9hc3QoJ+KchSAnICsgYWRkZWQgKyAnIHByb3BlcnRpZXMgaW1wb3J0ZWQhJyk7Cn0KCmZ1bmN0aW9uIHByb2Nlc3NNZXRhbHNJbXBvcnQocm93cywgaGVhZGVycykgewogIGNvbnN0IGZpbmQgPSBrd3MgPT4gaGVhZGVycy5maW5kSW5kZXgoaCA9PiBrd3Muc29tZShrID0+IGgudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrKSkpOwogIGNvbnN0IG1ldGFsQ29sID0gZmluZChbJ21ldGFsJ10pLCBwdXJpdHlDb2wgPSBmaW5kKFsncHVyaXR5J10pLCBvY2Nhc2lvbkNvbCA9IGZpbmQoWydvY2Nhc2lvbiddKSwgaXRlbUNvbCA9IGZpbmQoWydpdGVtJywnbmFtZSddKSwgd2VpZ2h0Q29sID0gZmluZChbJ3dlaWdodCcsJ2dyYW1zJywnZ3JhbScsJ3d0J10pOwoKICBpZiAobWV0YWxDb2wgPCAwIHx8IHdlaWdodENvbCA8IDApIHsgc2hvd1RvYXN0KCdDb3VsZCBub3QgZGV0ZWN0IE1ldGFsIGFuZCBXZWlnaHQgY29sdW1ucyDinYwnKTsgcmV0dXJuOyB9CgogIGxldCBpbXBvcnRlZCA9IDA7CiAgaWYgKCFkYXRhLl9tZXRhbHMpIGRhdGEuX21ldGFscyA9IFtdOwogIHJvd3MuZm9yRWFjaChyb3cgPT4gewogICAgY29uc3QgbWV0YWxSYXcgPSBTdHJpbmcocm93W21ldGFsQ29sXXx8JycpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3QgbWV0YWxUeXBlID0gbWV0YWxSYXcuaW5jbHVkZXMoJ2dvbGQnKSA/ICdnb2xkJyA6IG1ldGFsUmF3LmluY2x1ZGVzKCdzaWx2ZXInKSA/ICdzaWx2ZXInIDogbWV0YWxSYXcuaW5jbHVkZXMoJ3BsYXRpbnVtJykgPyAncGxhdGludW0nIDogJ2dvbGQnOwogICAgY29uc3QgZ3JhbXMgPSBwYXJzZUZsb2F0KFN0cmluZyhyb3dbd2VpZ2h0Q29sXXx8JzAnKS5yZXBsYWNlKC9bXlxkLl0vZywnJykpfHwwOwogICAgaWYgKCFncmFtcykgcmV0dXJuOwogICAgZGF0YS5fbWV0YWxzLnB1c2goewogICAgICBtZXRhbFR5cGUsCiAgICAgIG5hbWU6IGl0ZW1Db2wgPj0gMCA/IFN0cmluZyhyb3dbaXRlbUNvbF18fCcnKS50cmltKCkgOiBtZXRhbFR5cGUsCiAgICAgIGdyYW1zLAogICAgICBwcmljZTogTUVUQUxfQ09ORklHW21ldGFsVHlwZV0/LnByaWNlUGVyR3JhbSB8fCAwLAogICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSwKICAgICAgZm9ybTogJ0pld2VscnknLAogICAgICBwdXJpdHk6IHB1cml0eUNvbCA+PSAwID8gU3RyaW5nKHJvd1twdXJpdHlDb2xdfHwnJykudHJpbSgpIDogJycsCiAgICAgIG9jY2FzaW9uOiBvY2Nhc2lvbkNvbCA+PSAwID8gU3RyaW5nKHJvd1tvY2Nhc2lvbkNvbF18fCcnKS50cmltKCkgOiAnJywKICAgIH0pOwogICAgaW1wb3J0ZWQrKzsKICB9KTsKCiAgc2F2ZSgpOwp9CgovLyDilIDilIAgUkVBTCBFU1RBVEUgSU1QT1JURVIg4pSA4pSACmZ1bmN0aW9uIHByb2Nlc3NSRUltcG9ydChyb3dzLCBoZWFkZXJzKSB7CiAgY29uc3QgZmluZCA9IGt3cyA9PiBoZWFkZXJzLmZpbmRJbmRleChoID0+IGt3cy5zb21lKGsgPT4gaC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGspKSk7CiAgY29uc3QgZGF0ZUNvbCA9IGZpbmQoWydkYXRlJ10pLCBjb3VudHJ5Q29sID0gZmluZChbJ2NvdW50cnknXSksIGN1cnJlbmN5Q29sID0gZmluZChbJ2N1cnJlbmN5JywnY3VyciddKSwKICAgICAgICBwdkNvbCA9IGZpbmQoWydwdXJjaGFzZSddKSwgZGVzY0NvbCA9IGZpbmQoWydkZXNjJywnZGVzY3JpcHRpb24nXSksIGFyZWFDb2wgPSBmaW5kKFsnYXJlYSddKSwKICAgICAgICBjdkNvbCA9IGZpbmQoWydjdXJyZW50J10pOwoKICBsZXQgaW1wb3J0ZWQgPSAwOwogIGNvbnN0IHJlQXNzZXRzID0gZ2V0UmVhbEVzdGF0ZUFzc2V0cygpOwogIHJvd3MuZm9yRWFjaChyb3cgPT4gewogICAgY29uc3QgZGVzYyA9IGRlc2NDb2wgPj0gMCA/IFN0cmluZyhyb3dbZGVzY0NvbF18fCcnKS50cmltKCkgOiAnJzsKICAgIGNvbnN0IHB2ID0gcGFyc2VGbG9hdChTdHJpbmcocm93W3B2Q29sPj0wP3B2Q29sOjBdfHwnMCcpLnJlcGxhY2UoL1teXGQuXS9nLCcnKSl8fDA7CiAgICBpZiAoIXB2ICYmICFkZXNjKSByZXR1cm47CiAgICBjb25zdCByYXdEYXRlID0gZGF0ZUNvbCA+PSAwID8gU3RyaW5nKHJvd1tkYXRlQ29sXXx8JycpIDogJyc7CiAgICBjb25zdCBkID0gbmV3IERhdGUocmF3RGF0ZSk7CiAgICBjb25zdCBkYXRlU3RyID0gIWlzTmFOKGQpID8gZC50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0gOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsKICAgIHJlQXNzZXRzLnB1c2go','ewogICAgICBkYXRlOiBkYXRlU3RyLAogICAgICBjb3VudHJ5OiBjb3VudHJ5Q29sID49IDAgPyBTdHJpbmcocm93W2NvdW50cnlDb2xdfHwnJykudHJpbSgpIDogJ1VTJywKICAgICAgY3VycmVuY3k6IGN1cnJlbmN5Q29sID49IDAgPyBTdHJpbmcocm93W2N1cnJlbmN5Q29sXXx8J1VTRCcpLnRyaW0oKS50b1VwcGVyQ2FzZSgpIDogJ1VTRCcsCiAgICAgIHB1cmNoYXNlVmFsdWU6IHB2LAogICAgICBjdXJyZW50VmFsdWU6IGN2Q29sID49IDAgPyBwYXJzZUZsb2F0KFN0cmluZyhyb3dbY3ZDb2xdfHwnMCcpLnJlcGxhY2UoL1teXGQuXS9nLCcnKSl8fHB2IDogcHYsCiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjLAogICAgICBhcmVhOiBhcmVhQ29sID49IDAgPyBTdHJpbmcocm93W2FyZWFDb2xdfHwnJykudHJpbSgpIDogJycsCiAgICB9KTsKICAgIGltcG9ydGVkKys7CiAgfSk7CgogIGRhdGEuX3JlYWxFc3RhdGUgPSByZUFzc2V0czsKICBzYXZlKCk7CiAgc2F2ZSgpOwp9CgovLyDilIDilIAgUkVTRVQg4pSA4pSACmZ1bmN0aW9uIHJlbmRlclJlc2V0U3VtbWFyeSgpIHsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldC1kYXRhLXN1bW1hcnknKTsKICBpZiAoIWVsKSByZXR1cm47CiAgY29uc3QgbW9udGhLZXlzID0gT2JqZWN0LmtleXMoZGF0YSkuZmlsdGVyKGsgPT4gIWsuc3RhcnRzV2l0aCgnXycpKTsKICBsZXQgdG90YWxUeCA9IDA7CiAgbW9udGhLZXlzLmZvckVhY2gobWsgPT4gewogICAgWydleHBlbnNlcycsJ2luY29tZScsJ2ludmVzdG1lbnRzJywnZGVidHMnLCdnaXZlblRvT3RoZXJzJywnYWRkaXRpb25hbCddLmZvckVhY2godCA9PiB7CiAgICAgIHRvdGFsVHggKz0gKGRhdGFbbWtdW3RdfHxbXSkubGVuZ3RoOwogICAgfSk7CiAgfSk7CiAgZWwuaW5uZXJIVE1MID0gYAogICAgPGRpdiBzdHlsZT0iZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMWZyO2dhcDo4cHg7Ij4KICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4ke3RvdGFsVHh9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5UcmFuc2FjdGlvbnM8L2Rpdj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4ke21vbnRoS2V5cy5sZW5ndGh9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5Nb250aHM8L2Rpdj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iaW1wb3J0LXN1bW1hcnktYm94Ij48ZGl2IGNsYXNzPSJpc2ItbnVtIj4keyhkYXRhLl9tZXRhbHN8fFtdKS5sZW5ndGh9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5NZXRhbCBJdGVtczwvZGl2PjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJpbXBvcnQtc3VtbWFyeS1ib3giPjxkaXYgY2xhc3M9ImlzYi1udW0iPiR7KGRhdGEuX3JlYWxFc3RhdGV8fFtdKS5sZW5ndGh9PC9kaXY+PGRpdiBjbGFzcz0iaXNiLWxhYmVsIj5Qcm9wZXJ0aWVzPC9kaXY+PC9kaXY+CiAgICA8L2Rpdj4KICBgOwogIC8vIFVwZGF0ZSBzcGVjaWZpYyBkYXRhc2V0IGNvdW50cwogIGNvbnN0IG1ldGFsc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LW1ldGFscy1jb3VudCcpOwogIGlmIChtZXRhbHNFbCkgbWV0YWxzRWwudGV4dENvbnRlbnQgPSAoZGF0YS5fbWV0YWxzfHxbXSkubGVuZ3RoICsgJyBlbnRyaWVzJzsKICBjb25zdCBnaXZlbkVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LWdpdmVuLWNvdW50Jyk7CiAgaWYgKGdpdmVuRWwpIGdpdmVuRWwudGV4dENvbnRlbnQgPSAoZGF0YS5fZ2l2ZW58fFtdKS5sZW5ndGggKyAnIHJlY29yZHMnOwogIGNvbnN0IHJlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXQtcmUtY291bnQnKTsKICBpZiAocmVFbCkgcmVFbC50ZXh0Q29udGVudCA9ICgoZGF0YS5fcmVhbEVzdGF0ZXx8e30pLmFzc2V0c3x8W10pLmxlbmd0aCArICcgcHJvcGVydGllcyc7CiAgY29uc3QgbndFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldC1udy1jb3VudCcpOwogIGlmIChud0VsKSBud0VsLnRleHRDb250ZW50ID0gKGRhdGEuX253QWNjb3VudHN8fFtdKS5sZW5ndGggKyAnIGFjY291bnRzJzsKfQoKZnVuY3Rpb24gcmVuZGVyTW9udGhzTGlzdCgpIHsKICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb250aHMtbGlzdCcpOwogIGlmICghZWwpIHJldHVybjsKICBjb25zdCBtb250aEtleXMgPSBPYmplY3Qua2V5cyhkYXRhKS5maWx0ZXIoayA9PiAhay5zdGFydHNXaXRoKCdfJykgJiYgL15cZHs0fS1cZHsyfSQvLnRlc3QoaykpLnNvcnQoKS5yZXZlcnNlKCk7CiAgaWYgKCFtb250aEtleXMubGVuZ3RoKSB7IGVsLmlubmVySFRNTCA9ICc8cCBzdHlsZT0iY29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC1zaXplOjAuODVlbTtwYWRkaW5nOjRweCAwOyI+Tm8gbW9udGggZGF0YSB5ZXQuPC9wPic7IHJldHVybjsgfQoKICAvLyBHcm91cCBieSB5ZWFyCiAgY29uc3QgYnlZZWFyID0ge307CiAgbW9udGhLZXlzLmZvckVhY2gobWsgPT4geyBjb25zdCB5ciA9IG1rLnNwbGl0KCctJylbMF07IGlmICghYnlZZWFyW3lyXSkgYnlZZWFyW3lyXT1bXTsgYnlZZWFyW3lyXS5wdXNoKG1rKTsgfSk7CiAgY29uc3QgeWVhcnMgPSBPYmplY3Qua2V5cyhieVllYXIpLnNvcnQoKS5yZXZlcnNlKCk7CgogIGVsLmlubmVySFRNTCA9IHllYXJzLm1hcCh5ciA9PiB7CiAgICBjb25zdCBta3MgPSBieVllYXJbeXJdOwogICAgY29uc3QgeXJJbmMgPSBta3MucmVkdWNlKChzLG1rKT0+cysoZGF0YVtta10/LmluY29tZXx8W10pLnJlZHVjZSgoc2ksZSk9PnNpK051bWJlcihlLmFtb3VudHx8MCksMCksMCk7CiAgICBjb25zdCB5ckV4cCA9IG1rcy5yZWR1Y2UoKHMsbWspPT5zKyhkYXRhW21rXT8uZXhwZW5zZXN8fFtdKS5yZWR1Y2UoKHNpLGUpPT5zaStOdW1iZXIoZS5hbW91bnR8fDApLDApLDApOwogICAgY29uc3QgeXJUeCAgPSBta3MucmVkdWNlKChzLG1rKT0+e2NvbnN0IG09ZGF0YVtta118fHt9O3JldHVybiBzKyhtLmV4cGVuc2VzfHxbXSkubGVuZ3RoKyhtLmluY29tZXx8W10pLmxlbmd0aCsobS5pbnZlc3RtZW50c3x8W10pLmxlbmd0aDt9LDApOwogICAgY29uc3QgY29sSWQgPSAncmVzZXQteXItJyArIHlyOwoKICAgIGNvbnN0IG1vbnRoUm93cyA9IG1rcy5tYXAobWsgPT4gewogICAgICBjb25zdCBtID0gZGF0YVtta10gfHwge307CiAgICAgIGNvbnN0IHR4Q291bnQgPSAobS5leHBlbnNlc3x8W10pLmxlbmd0aCArIChtLmluY29tZXx8W10pLmxlbmd0aCArIChtLmludmVzdG1lbnRzfHxbXSkubGVuZ3RoOwogICAgICBjb25zdCBpbmMgPSAobS5pbmNvbWV8fFtdKS5yZWR1Y2UoKHMsZSk9PnMrTnVtYmVyKGUuYW1vdW50fHwwKSwwKTsKICAgICAgY29uc3QgZXhwID0gKG0uZXhwZW5zZXN8fFtdKS5yZWR1Y2UoKHMsZSk9PnMrTnVtYmVyKGUuYW1vdW50fHwwKSwwKTsKICAgICAgcmV0dXJuIGA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6OXB4IDE0cHggOXB4IDIwcHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0Y1RjVGNTsiPgogICAgICAgIDxkaXY+PGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZTowLjg1ZW07Y29sb3I6dmFyKC0tdGV4dC1kYXJrKTsiPiR7Z2V0RGlzcGxheU1vbnRoKG1rKX08L2Rpdj4KICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MC43ZW07Y29sb3I6dmFyKC0tdGV4dC1saWdodCk7Zm9udC13ZWlnaHQ6NjAwOyI+JHt0eENvdW50fSB0eG5zIMK3IDxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1pbmNvbWUpOyI+KyR7Zm10KGluYyl9PC9zcGFuPiDCtyA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tZXhwZW5zZXMpOyI+LSR7Zm10KGV4cCl9PC9zcGFuPjwvZGl2PjwvZGl2PgogICAgICAgIDxidXR0b24gb25jbGljaz0iZGVsZXRlTW9udGgoJyR7bWt9JykiIHN0eWxlPSJiYWNrZ3JvdW5kOiNGRkYwRjA7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo5cHg7cGFkZGluZzo1cHggMTBweDtmb250LXdlaWdodDo4MDA7Zm9udC1zaXplOjAuNzVlbTtjb2xvcjp2YXIoLS1leHBlbnNlcyk7Y3Vyc29yOnBvaW50ZXI7ZmxleC1zaHJpbms6MDsiPvCfl5HvuI88L2J1dHRvbj4KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwoKICAgIHJldHVybiBgPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbTo2cHg7Ym9yZGVyOjFweCBzb2xpZCAjRUVFO2JvcmRlci1yYWRpdXM6MTJweDtvdmVyZmxvdzpoaWRkZW47Ij4KICAgICAgPGRpdiBvbmNsaWNrPSJ0b2dnbGVSZXNldFllYXIoJyR7Y29sSWR9JykiIHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO3BhZGRpbmc6MTFweCAxNHB4O2JhY2tncm91bmQ6I0Y4RjhGODtjdXJzb3I6cG9pbnRlcjsiPgogICAgICAgIDxkaXY+PHNwYW4gc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDtmb250LXNpemU6MC45MmVtO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4ke3lyfTwvc3Bhbj4KICAgICAgICAgIDxzcGFuIHN0eWxlPSJmb250LXNpemU6MC43MmVtO2ZvbnQtd2VpZ2h0OjcwMDtjb2xvcjp2YXIoLS10ZXh0LWxpZ2h0KTttYXJnaW4tbGVmdDo4cHg7Ij4ke21rcy5sZW5ndGh9IG1vbnRocyDCtyAke3lyVHh9IHR4bnM8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDsiPgogICAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDtmb250LXNpemU6MC43MmVtO2ZvbnQtd2VpZ2h0OjcwMDsiPgogICAgICAgICAgICA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0taW5jb21lKTsiPiske2ZtdCh5ckluYyl9PC9zcGFuPiA8c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tZXhwZW5zZXMpOyI+LSR7Zm10KHlyRXhwKX08L3NwYW4+PC9kaXY+CiAgICAgICAgICA8c3BhbiBpZD0iJHtjb2xJZH0tY2hldiIgc3R5bGU9ImZvbnQtc2l6ZTowLjhlbTt0cmFuc2l0aW9uOnRyYW5zZm9ybSAwLjJzOyI+4pa+PC9zcGFuPjwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBpZD0iJHtjb2xJZH0iIHN0eWxlPSJtYXgtaGVpZ2h0OjEyMDBweDtvdmVyZmxvdzpoaWRkZW47dHJhbnNpdGlvbjptYXgtaGVpZ2h0IDAuM3MgZWFzZTsiPiR7bW9udGhSb3dzfTwvZGl2PgogICAgPC9kaXY+YDsKICB9KS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gdG9nZ2xlUmVzZXRZZWFyKGlkKSB7CiAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgY29uc3QgY2hldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgJy1jaGV2Jyk7CiAgaWYgKCFlbCkgcmV0dXJuOwogIGNvbnN0IGlzT3BlbiA9IGVsLnN0eWxlLm1heEhlaWdodCAhPT0gJzBweCc7CiAgZWwuc3R5bGUubWF4SGVpZ2h0ID0gaXNPcGVuID8gJzBweCcgOiAnMTIwMHB4JzsKICBpZiAoY2hldikgY2hldi5zdHlsZS50cmFuc2Zvcm0gPSBpc09wZW4gPyAncm90YXRlKC05MGRlZyknIDogJyc7Cn0KCmZ1bmN0aW9uIGNsZWFyRGF0YXNldCh0eXBlKSB7CiAgY29uc3QgbGFiZWxzID0geyBtZXRhbHM6J01ldGFscyBIb2xkaW5ncycsIGdpdmVuOidHaXZlbiB0byBPdGhlcnMnLCByZWFsZXN0YXRlOidSZWFsIEVzdGF0ZSBBc3NldHMnLCBuZXR3b3J0aDonTmV0IFdvcnRoIEFjY291bnRzJyB9OwogIGlmICghY29uZmlybShgQ2xlYXIgYWxsICR7bGFiZWxzW3R5cGVdfHx0eXBlfSBkYXRhPyBZb3VyIHRyYW5zYWN0aW9ucyB3aWxsIE5PVCBiZSBhZmZlY3RlZC5gKSkgcmV0dXJuOwogIGlmICh0eXBlID09PSAnbWV0YWxzJykgICAgIHsgZGF0YS5fbWV0YWxzID0gW107IH0KICBpZiAodHlwZSA9PT0gJ2dpdmVuJykgICAgICB7IGRhdGEuX2dpdmVuID0gW107IH0KICBpZiAodHlwZSA9PT0gJ3Jl','YWxlc3RhdGUnKSB7IGlmIChkYXRhLl9yZWFsRXN0YXRlKSBkYXRhLl9yZWFsRXN0YXRlLmFzc2V0cyA9IFtdOyB9CiAgaWYgKHR5cGUgPT09ICduZXR3b3J0aCcpICAgeyBkYXRhLl9ud0FjY291bnRzID0gW107IH0KICBzYXZlKCk7CiAgcmVuZGVyUmVzZXRTdW1tYXJ5KCk7CiAgcmVuZGVyTW9udGhzTGlzdCgpOwogIGlmICh0eXBlID09PSAnbWV0YWxzJykgICAgIHsgdHJ5IHsgcmVuZGVyTWV0YWxzKCk7IH0gY2F0Y2goZSl7fSB9CiAgaWYgKHR5cGUgPT09ICduZXR3b3J0aCcpICAgeyB0cnkgeyByZW5kZXJOZXRXb3J0aCgpOyB9IGNhdGNoKGUpe30gfQogIHNob3dUb2FzdCgn8J+nuSAnICsgKGxhYmVsc1t0eXBlXXx8dHlwZSkgKyAnIGNsZWFyZWQnKTsKfQoKZnVuY3Rpb24gY29uZmlybVJlc2V0QWxsKCkgewogIGlmICghY29uZmlybSgn4pqg77iPIFRoaXMgd2lsbCBkZWxldGUgQUxMIGRhdGEgcGVybWFuZW50bHkuIEFyZSB5b3Ugc3VyZT8nKSkgcmV0dXJuOwogIGlmICghY29uZmlybSgn8J+aqCBGaW5hbCBjb25maXJtYXRpb24g4oCUIGRlbGV0ZSBldmVyeXRoaW5nPycpKSByZXR1cm47CiAgY29uc3Qga2VlcEtleXMgPSBbJ19jdXJyZW5jeScsJ19ob21lU3BlbmRDYXJkcycsJ19ob21lSW52Q2FyZHMnLCdfY3VzdG9tQ2F0cycsJ19leHBlbnNlR29hbHMnLCdfc2F2aW5nc0dvYWxzJ107CiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrID0+IHsgaWYgKCFrZWVwS2V5cy5pbmNsdWRlcyhrKSkgZGVsZXRlIGRhdGFba107IH0pOwogIHNhdmUoKTsKICByZW5kZXJSZXNldFN1bW1hcnkoKTsKICByZW5kZXJIb21lKCk7CiAgc2hvd1RvYXN0KCfwn5eR77iPIEFsbCB0cmFuc2FjdGlvbiBkYXRhIGNsZWFyZWQnKTsKfQoKLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCi8vIE9OQk9BUkRJTkcg4oCUIEludHJvIHNsaWRlcyArIENvYWNoIG1hcmtzCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApjb25zdCBPQl9TRUVOX0tFWSA9ICdtZl9vbmJvYXJkaW5nX3NlZW4nOwpsZXQgb2JDdXJyZW50U2xpZGUgPSAwOwpjb25zdCBPQl9UT1RBTCA9IDU7CgpmdW5jdGlvbiBzaG93T25ib2FyZGluZygpIHsKICBvYkN1cnJlbnRTbGlkZSA9IDA7CiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvbmJvYXJkaW5nLW92ZXJsYXknKTsKICBpZiAoIW92ZXJsYXkpIHJldHVybjsKICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGluZycpOwogIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICBvYkdvVG8oMCk7Cn0KCmZ1bmN0aW9uIGRpc21pc3NPbmJvYXJkaW5nKCkgewogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb25ib2FyZGluZy1vdmVybGF5Jyk7CiAgaWYgKCFvdmVybGF5KSByZXR1cm47CiAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdoaWRpbmcnKTsKICBzZXRUaW1lb3V0KCgpID0+IHsKICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkaW5nJyk7CiAgICAvLyBBZnRlciBpbnRybyBzbGlkZXMsIGxhdW5jaCB0aGUgY29hY2ggbWFya3MgdG91cgogICAgc3RhcnRDb2FjaFRvdXIoKTsKICB9LCA2MDApOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKE9CX1NFRU5fS0VZLCAnMScpOwp9CgpmdW5jdGlvbiBvYkdvVG8oaWR4KSB7CiAgb2JDdXJyZW50U2xpZGUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpZHgsIE9CX1RPVEFMIC0gMSkpOwogIGNvbnN0IHRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29iLXRyYWNrJyk7CiAgaWYgKHRyYWNrKSB0cmFjay5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWCgtJHtvYkN1cnJlbnRTbGlkZSAqIDEwMH12dylgOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vYi1kb3QnKS5mb3JFYWNoKChkLCBpKSA9PiBkLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGkgPT09IG9iQ3VycmVudFNsaWRlKSk7CiAgLy8gUmUtdHJpZ2dlciBhbmltYXRpb25zCiAgY29uc3Qgc2xpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm9iLXNsaWRlJyk7CiAgc2xpZGVzLmZvckVhY2goKHMsIGkpID0+IHsKICAgIGlmIChpICE9PSBvYkN1cnJlbnRTbGlkZSkgcmV0dXJuOwogICAgWycub2Itc2xpZGUtYXJ0JywnLm9iLXNsaWRlLXRpdGxlJywnLm9iLXNsaWRlLWRlc2MnXS5mb3JFYWNoKHNlbCA9PiB7CiAgICAgIGNvbnN0IGVsID0gcy5xdWVyeVNlbGVjdG9yKHNlbCk7CiAgICAgIGlmICghZWwpIHJldHVybjsKICAgICAgZWwuc3R5bGUuYW5pbWF0aW9uID0gJ25vbmUnOyBlbC5vZmZzZXRIZWlnaHQ7IGVsLnN0eWxlLmFuaW1hdGlvbiA9ICcnOwogICAgfSk7CiAgfSk7CiAgY29uc3QgbmV4dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvYi1uZXh0LWJ0bicpOwogIGNvbnN0IHNraXBCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb2Itc2tpcC1idG4nKTsKICBpZiAobmV4dEJ0bikgbmV4dEJ0bi50ZXh0Q29udGVudCA9IG9iQ3VycmVudFNsaWRlID09PSBPQl9UT1RBTCAtIDEgPyAiU3RhcnQgVG91ciDwn46vIiA6ICdOZXh0IOKGkic7CiAgaWYgKHNraXBCdG4pIHNraXBCdG4uc3R5bGUuZGlzcGxheSA9IG9iQ3VycmVudFNsaWRlID09PSBPQl9UT1RBTCAtIDEgPyAnbm9uZScgOiAnJzsKfQoKZnVuY3Rpb24gb2JOZXh0KCkgewogIGlmIChvYkN1cnJlbnRTbGlkZSA8IE9CX1RPVEFMIC0gMSkgb2JHb1RvKG9iQ3VycmVudFNsaWRlICsgMSk7CiAgZWxzZSBkaXNtaXNzT25ib2FyZGluZygpOwp9CgovLyBTd2lwZSBzdXBwb3J0IGZvciBpbnRybyBzbGlkZXMKKGZ1bmN0aW9uKCkgewogIGxldCBzeCA9IDAsIHN5ID0gMDsKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7CiAgICBjb25zdCBvdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvbmJvYXJkaW5nLW92ZXJsYXknKTsKICAgIGlmICghb3YgfHwgb3Yuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSByZXR1cm47CiAgICBzeCA9IGUudG91Y2hlc1swXS5jbGllbnRYOyBzeSA9IGUudG91Y2hlc1swXS5jbGllbnRZOwogIH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTsKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGUgPT4gewogICAgY29uc3Qgb3YgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb25ib2FyZGluZy1vdmVybGF5Jyk7CiAgICBpZiAoIW92IHx8IG92LnN0eWxlLmRpc3BsYXkgPT09ICdub25lJykgcmV0dXJuOwogICAgY29uc3QgZHggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLmNsaWVudFggLSBzeDsKICAgIGNvbnN0IGR5ID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZIC0gc3k7CiAgICBpZiAoTWF0aC5hYnMoZHgpID4gTWF0aC5hYnMoZHkpICYmIE1hdGguYWJzKGR4KSA+IDQwKQogICAgICBkeCA8IDAgPyBvYkdvVG8ob2JDdXJyZW50U2xpZGUgKyAxKSA6IG9iR29UbyhvYkN1cnJlbnRTbGlkZSAtIDEpOwogIH0sIHsgcGFzc2l2ZTogdHJ1ZSB9KTsKfSkoKTsKCi8vIOKUgOKUgCBDT0FDSCBNQVJLUyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKLy8gRWFjaCBzdGVwOiB7IHNjcmVlbiwgZWxlbWVudElkLCB0aXRsZSwgZGVzYywgdGFnLCBhcnJvdyB9Ci8vIHNjcmVlbiA9IHdoaWNoIHNjcmVlbiB0byBzd2l0Y2ggdG8gYmVmb3JlIHNob3dpbmcKLy8gYXJyb3cgID0gJ3VwJyB8ICdkb3duJyB8ICdyaWdodCcgKGRpcmVjdGlvbiBvZiB0b29sdGlwIGFycm93IHJlbGF0aXZlIHRvIHRvb2x0aXApCmNvbnN0IENPQUNIX1NURVBTID0gWwogIHsKICAgIHNjcmVlbjogJ2hvbWUnLAogICAgZWxlbWVudElkOiAnZmFiLWFkZC1idG4nLAogICAgdGFnOiAnUXVpY2sgQWRkIMK3IFN0ZXAgMSBvZiA5JywKICAgIHRpdGxlOiAn4p6VIFRoZSBBZGQgQnV0dG9uJywKICAgIGRlc2M6ICdUaGlzIGdvbGRlbiDvvIsgYnV0dG9uIGlzIHlvdXIgZmFzdGVzdCB3YXkgaW4uIFRhcCBpdCBmcm9tIGFueSBzY3JlZW4gdG8gbG9nIGFuIGV4cGVuc2UsIGluY29tZSwgb3IgaW52ZXN0bWVudCBpbiBzZWNvbmRzLicsCiAgICBhcnJvdzogJ2Rvd24nCiAgfSwKICB7CiAgICBzY3JlZW46ICdob21lJywKICAgIGVsZW1lbnRJZDogJ2ZtaS1leHBlbnNlJywKICAgIHRhZzogJ1F1aWNrIEFkZCDCtyBTdGVwIDIgb2YgOScsCiAgICB0aXRsZTogJ/CfkrggTG9nIGFuIEV4cGVuc2UnLAogICAgZGVzYzogJ1RhcCDwn5K4IEV4cGVuc2UgdG8gcmVjb3JkIHNwZW5kaW5nLiBQaWNrIGEgY2F0ZWdvcnksIGVudGVyIHRoZSBhbW91bnQgYW5kIGRlc2NyaXB0aW9uIOKAlCBkb25lIGluIHVuZGVyIDEwIHNlY29uZHMuJywKICAgIGFycm93OiAncmlnaHQnLAogICAgcHJlQWN0aW9uOiAoKSA9PiB7CiAgICAgIGNvbnN0IG1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLW1lbnUnKTsKICAgICAgY29uc3QgZmFiICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYWRkLWJ0bicpOwogICAgICBpZiAoZmFiICYmICghbWVudSB8fCAhbWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkpIGZhYi5jbGljaygpOwogICAgfQogIH0sCiAgewogICAgc2NyZWVuOiAnYnVkZ2V0JywKICAgIGVsZW1lbnRJZDogJ2J0YWItZ29hbHMnLAogICAgdGFnOiAnQnVkZ2V0ICYgR29hbHMgwrcgU3RlcCAzIG9mIDknLAogICAgdGl0bGU6ICfwn46vIEdvYWxzIFRhYicsCiAgICBkZXNjOiAnU3dpdGNoIHRvIEdvYWxzIGhlcmUgdG8gc2V0IGZpbmFuY2lhbCBtaWxlc3RvbmVzIOKAlCBzYXZlIGZvciBhIGhvdXNlLCBwYXkgb2ZmIGEgbG9hbiwgYnVpbGQgYW4gZW1lcmdlbmN5IGZ1bmQuJywKICAgIGFycm93OiAnZG93bicsCiAgICBwcmVBY3Rpb246ICgpID0+IHsKICAgICAgLy8gQ2xvc2UgZmFiIG1lbnUgaWYgb3BlbgogICAgICBjb25zdCBtZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1tZW51Jyk7CiAgICAgIGNvbnN0IGZhYiAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmFiLWFkZC1idG4nKTsKICAgICAgaWYgKGZhYiAmJiBtZW51ICYmIG1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVuJykpIGZhYi5jbGljaygpOwogICAgICBzd2l0Y2hTY3JlZW4oJ2J1ZGdldCcsIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXYtaXRlbTpudGgtY2hpbGQoMyknKSk7CiAgICB9CiAgfSwKICB7CiAgICBzY3JlZW46ICdidWRnZXQnLAogICAgZWxlbWVudElkOiAnZ29hbHMtZmFiLWJ0bicsCiAgICB0YWc6ICdCdWRnZXQgJiBHb2FscyDCtyBTdGVwIDQgb2YgOScsCiAgICB0aXRsZTogJ++8iyBBZGQgYSBHb2FsJywKICAgIGRlc2M6ICdUYXAgdGhpcyB0byBjcmVhdGUgYSBuZXcgZ29hbC4gQ2hvb3NlIEdyb3cgKGJ1aWxkIHNhdmluZ3MpIG9yIFJlZHVjZSAocGF5IGRvd24gZGVidCkuIE1hcCB5b3VyIGFjY291bnRzIHRvIHRyYWNrIHByb2dyZXNzIGF1dG9tYXRpY2FsbHkuJywKICAgIGFycm93OiAndXAnLAogICAgcHJlQWN0aW9uOiAoKSA9PiB7CiAgICAgIHNldEJ1ZGdldFRhYignZ29hbHMnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRhYi1nb2FscycpKTsKICAgIH0KICB9LAogIHsKICAgIHNjcmVlbjogJ25ldHdvcnRoJywKICAgIGVsZW1lbnRJZDogJ253LXRv','dGFsJywKICAgIHRhZzogJ05ldCBXb3J0aCDCtyBTdGVwIDUgb2YgOScsCiAgICB0aXRsZTogJ/Cfko4gWW91ciBOZXQgV29ydGgnLAogICAgZGVzYzogJ1RoaXMgaXMgdGhlIGJpZyBudW1iZXIg4oCUIHRvdGFsIGFzc2V0cyBtaW51cyB0b3RhbCBsaWFiaWxpdGllcy4gSXQgdXBkYXRlcyBsaXZlIGFzIHlvdSBhZGQgYWNjb3VudHMgYW5kIHRyYW5zYWN0aW9ucy4nLAogICAgYXJyb3c6ICdkb3duJywKICAgIHByZUFjdGlvbjogKCkgPT4gewogICAgICBzd2l0Y2hTY3JlZW4oJ25ldHdvcnRoJywgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5hdi1pdGVtOm50aC1jaGlsZCg0KScpKTsKICAgIH0KICB9LAogIHsKICAgIHNjcmVlbjogJ25ldHdvcnRoJywKICAgIC8vIFRhcmdldCB0aGUgYWx3YXlzLXZpc2libGUgc2VjdGlvbiBoZWFkZXIsIG5vdCB0aGUgY29sbGFwc2libGUgYm9keQogICAgZWxlbWVudElkOiAnbnctc2VjLWNoZWNraW5nJywKICAgIHRhZzogJ05ldCBXb3J0aCDCtyBTdGVwIDYgb2YgOScsCiAgICB0aXRsZTogJ/Cfj6YgQWRkIEFjY291bnRzJywKICAgIGRlc2M6ICdUYXAgYW55IHJvdyB0byBleHBhbmQgaXQsIHRoZW4gdGFwICIrIEFkZCBBY2NvdW50IiBpbnNpZGUuIEFkZCBjaGVja2luZywgc2F2aW5ncywgcmVhbCBlc3RhdGUsIGxvYW5zIOKAlCBlYWNoIGNhdGVnb3J5IHN0YXlzIG9yZ2FuaXNlZC4nLAogICAgYXJyb3c6ICd1cCcsCiAgICAvLyBObyBwcmVBY3Rpb24gbmVlZGVkIOKAlCBhbHJlYWR5IG9uIG5ldHdvcnRoIHNjcmVlbgogIH0sCiAgewogICAgc2NyZWVuOiAnbWV0YWxzJywKICAgIGVsZW1lbnRJZDogJ21pbmktZ29sZCcsCiAgICB0YWc6ICdNZXRhbHMgwrcgU3RlcCA3IG9mIDknLAogICAgdGl0bGU6ICfwn6WHIEdvbGQsIFNpbHZlciAmIFBsYXRpbnVtJywKICAgIGRlc2M6ICdTd2l0Y2ggYmV0d2VlbiBtZXRhbHMgdXNpbmcgdGhlc2UgY2FyZHMuIEVhY2ggc2hvd3MgeW91ciB0b3RhbCB3ZWlnaHQgYW5kIGN1cnJlbnQgZXN0aW1hdGVkIHZhbHVlIGJhc2VkIG9uIHlvdXIgc2V0IHByaWNlcy4nLAogICAgYXJyb3c6ICdkb3duJywKICAgIHByZUFjdGlvbjogKCkgPT4geyBnb1RvU2NyZWVuKCdtZXRhbHMnKTsgfQogIH0sCiAgewogICAgc2NyZWVuOiAnbWV0YWxzJywKICAgIGVsZW1lbnRJZDogJ21ldGFsLWxpdmUtcHJpY2UnLAogICAgdGFnOiAnTWV0YWxzIMK3IFN0ZXAgOCBvZiA5JywKICAgIHRpdGxlOiAn4pyP77iPIFNldCBZb3VyIE93biBQcmljZScsCiAgICBkZXNjOiAnVGFwIEVkaXQgbmV4dCB0byB0aGlzIHByaWNlIHRvIG92ZXJyaWRlIGl0LiBZb3UgY2FuIHNldCBhIGJhc2UgcmF0ZSBBTkQgYSBzcGVjaWZpYyBwcmljZSBwZXIgcHVyaXR5IOKAlCAyMksgdnMgMjRLIGdvbGQgd2lsbCBkaWZmZXIuJywKICAgIGFycm93OiAnZG93bicKICB9LAogIHsKICAgIHNjcmVlbjogJ3NldHRpbmdzJywKICAgIGVsZW1lbnRJZDogJ2Z4LXJhdGVzLWxpc3QnLAogICAgdGFnOiAnU2V0dGluZ3MgwrcgU3RlcCA5IG9mIDknLAogICAgdGl0bGU6ICfwn5KxIEZYIFJhdGUgT3ZlcnJpZGVzJywKICAgIGRlc2M6ICdFdmVyeSBmb3JlaWduIGN1cnJlbmN5IGluIHlvdXIgZGF0YSBhcHBlYXJzIGhlcmUuIFRhcCDinI/vuI8gU2V0IG9uIGFueSByb3cgdG8gY29ycmVjdCB0aGUgcmF0ZSDigJQgYWxsIHlvdXIgdmFsdWF0aW9ucyB1cGRhdGUgaW5zdGFudGx5LicsCiAgICBhcnJvdzogJ3VwJywKICAgIHByZUFjdGlvbjogKCkgPT4geyBnb1RvU2NyZWVuKCdzZXR0aW5ncycpOyB9CiAgfQpdOwoKbGV0IGNvYWNoU3RlcCA9IDA7CmxldCBfY29hY2hSZXNpemVPYnMgPSBudWxsOwoKZnVuY3Rpb24gc3RhcnRDb2FjaFRvdXIoKSB7CiAgY29hY2hTdGVwID0gMDsKICBzaG93Q29hY2hTdGVwKDApOwp9CgpmdW5jdGlvbiBzaG93Q29hY2hTdGVwKGlkeCkgewogIGlmIChpZHggPCAwIHx8IGlkeCA+PSBDT0FDSF9TVEVQUy5sZW5ndGgpIHsgZW5kQ29hY2hUb3VyKCk7IHJldHVybjsgfQogIGNvYWNoU3RlcCA9IGlkeDsKICBjb25zdCBzdGVwID0gQ09BQ0hfU1RFUFNbaWR4XTsKCiAgLy8gUnVuIGFueSBwcmUtYWN0aW9uIChzY3JlZW4gc3dpdGNoLCBvcGVuIG1lbnUgZXRjKQogIGlmIChzdGVwLnByZUFjdGlvbikgewogICAgdHJ5IHsgc3RlcC5wcmVBY3Rpb24oKTsgfSBjYXRjaChlKSB7fQogIH0KCiAgLy8gU21hbGwgZGVsYXkgc28gc2NyZWVuIHJlbmRlcnMgYmVmb3JlIHdlIG1lYXN1cmUKICBzZXRUaW1lb3V0KCgpID0+IF9yZW5kZXJDb2FjaFN0ZXAoc3RlcCwgaWR4KSwgc3RlcC5wcmVBY3Rpb24gPyAzMjAgOiA2MCk7Cn0KCmZ1bmN0aW9uIF9yZW5kZXJDb2FjaFN0ZXAoc3RlcCwgaWR4KSB7CiAgY29uc3QgdGFyZ2V0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzdGVwLmVsZW1lbnRJZCk7CiAgY29uc3Qgb3ZlcmxheSAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtb3ZlcmxheScpOwogIGNvbnN0IHN2ZyAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLXN2ZycpOwogIGNvbnN0IHRvb2x0aXAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLXRvb2x0aXAnKTsKICBjb25zdCBwdWxzZSAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1wdWxzZScpOwogIGlmICghb3ZlcmxheSB8fCAhc3ZnIHx8ICF0b29sdGlwKSByZXR1cm47CgogIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKCiAgY29uc3QgVyA9IHdpbmRvdy5pbm5lcldpZHRoOwogIGNvbnN0IEggPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CgogIC8vIEdldCB0YXJnZXQgcmVjdCDigJQgc2Nyb2xsIGl0IGludG8gdmlldyBmaXJzdAogIGxldCByID0gbnVsbDsKICBpZiAodGFyZ2V0RWwpIHsKICAgIHRhcmdldEVsLnNjcm9sbEludG9WaWV3KHsgYmxvY2s6ICduZWFyZXN0JywgaW5saW5lOiAnbmVhcmVzdCcgfSk7CiAgICByID0gdGFyZ2V0RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAvLyBJZiByZWN0IGlzIHplcm8tc2l6ZSBvciBmdWxseSBvZmYgc2NyZWVuLCB0cmVhdCBhcyBubyB0YXJnZXQKICAgIGlmIChyLndpZHRoIDwgMiB8fCByLmhlaWdodCA8IDIgfHwgci5ib3R0b20gPCAwIHx8IHIudG9wID4gSCkgciA9IG51bGw7CiAgfQoKICBpZiAoIXIpIHsKICAgIF9kcmF3Q29hY2hOb1RhcmdldChzdGVwLCBpZHgpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3QgcGFkICA9IDEwOwogIGNvbnN0IHJ4ICAgPSBNYXRoLm1heCgwLCByLmxlZnQgLSBwYWQpOwogIGNvbnN0IHJ5ICAgPSBNYXRoLm1heCgwLCByLnRvcCAgLSBwYWQpOwogIGNvbnN0IHJ3ICAgPSBNYXRoLm1heCg2MCwgci53aWR0aCAgKyBwYWQgKiAyKTsKICBjb25zdCByaCAgID0gTWF0aC5tYXgoNDQsIHIuaGVpZ2h0ICsgcGFkICogMik7CiAgY29uc3QgcnJhZCA9IDEyOwoKICAvLyBEcmF3IFNWRyBkaW0gbWFzayB3aXRoIGN1dG91dAogIHN2Zy5pbm5lckhUTUwgPSBgCiAgICA8ZGVmcz4KICAgICAgPG1hc2sgaWQ9ImNtIj4KICAgICAgICA8cmVjdCB3aWR0aD0iJHtXfSIgaGVpZ2h0PSIke0h9IiBmaWxsPSJ3aGl0ZSIvPgogICAgICAgIDxyZWN0IHg9IiR7cnh9IiB5PSIke3J5fSIgd2lkdGg9IiR7cnd9IiBoZWlnaHQ9IiR7cmh9IiByeD0iJHtycmFkfSIgZmlsbD0iYmxhY2siLz4KICAgICAgPC9tYXNrPgogICAgPC9kZWZzPgogICAgPHJlY3Qgd2lkdGg9IiR7V30iIGhlaWdodD0iJHtIfSIgZmlsbD0icmdiYSgxMCwxNCw0MCwwLjgyKSIgbWFzaz0idXJsKCNjbSkiLz4KICBgOwoKICAvLyBQdWxzZSByaW5nCiAgcHVsc2Uuc3R5bGUuY3NzVGV4dCA9IGAKICAgIGRpc3BsYXk6YmxvY2s7IGxlZnQ6JHtyeH1weDsgdG9wOiR7cnl9cHg7CiAgICB3aWR0aDoke3J3fXB4OyBoZWlnaHQ6JHtyaH1weDsgYm9yZGVyLXJhZGl1czoke3JyYWR9cHg7CiAgYDsKCiAgLy8gQnVpbGQgdG9vbHRpcCBIVE1MCiAgY29uc3QgaXNMYXN0ID0gaWR4ID09PSBDT0FDSF9TVEVQUy5sZW5ndGggLSAxOwogIHRvb2x0aXAuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iY29hY2gtYXJyb3cgJHtzdGVwLmFycm93IHx8ICdkb3duJ30iPjwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtc3RlcC10YWciPiR7c3RlcC50YWd9PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC10aXRsZSI+JHtzdGVwLnRpdGxlfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtZGVzYyI+JHtzdGVwLmRlc2N9PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC1idG4tcm93Ij4KICAgICAgJHtpZHggPiAwID8gYDxidXR0b24gY2xhc3M9ImNvYWNoLXByZXYtYnRuIiBvbmNsaWNrPSJzaG93Q29hY2hTdGVwKCR7aWR4LTF9KSI+4oC5IEJhY2s8L2J1dHRvbj5gIDogJyd9CiAgICAgIDxidXR0b24gY2xhc3M9ImNvYWNoLW5leHQtYnRuIiBvbmNsaWNrPSIke2lzTGFzdCA/ICdlbmRDb2FjaFRvdXIoKScgOiBgc2hvd0NvYWNoU3RlcCgke2lkeCsxfSlgfSI+CiAgICAgICAgJHtpc0xhc3QgPyAn8J+OiSBEb25lIScgOiAnTmV4dCDihpInfQogICAgICA8L2J1dHRvbj4KICAgICAgJHshaXNMYXN0ID8gYDxidXR0b24gY2xhc3M9ImNvYWNoLXNraXAtYnRuIiBvbmNsaWNrPSJlbmRDb2FjaFRvdXIoKSI+U2tpcCBhbGw8L2J1dHRvbj5gIDogJyd9CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvYWNoLXByb2dyZXNzIj4ke2lkeCArIDF9IC8gJHtDT0FDSF9TVEVQUy5sZW5ndGh9PC9kaXY+CiAgYDsKICB0b29sdGlwLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogIC8vIEVuc3VyZSB0b29sdGlwIGlzIGFsd2F5cyBhYm92ZSBTVkcgYW5kIGludGVyYWN0aXZlCiAgdG9vbHRpcC5zdHlsZS56SW5kZXggID0gJzEwMDAwJzsKICB0b29sdGlwLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYWxsJzsKCiAgLy8gUG9zaXRpb24gdG9vbHRpcCDigJQgbWVhc3VyZSBoZWlnaHQgZmlyc3QKICBjb25zdCBUVyAgPSAyNjg7CiAgY29uc3QgZ2FwID0gMTQ7CiAgdG9vbHRpcC5zdHlsZS5sZWZ0ID0gJzEwcHgnOwogIHRvb2x0aXAuc3R5bGUudG9wICA9ICctOTk5OXB4JzsKICBjb25zdCBUSCA9IHRvb2x0aXAub2Zmc2V0SGVpZ2h0IHx8IDE3MDsKCiAgLy8gQ2VudHJlIGhvcml6b250YWxseSBvbiB0YXJnZXQsIGNsYW1wZWQgdG8gc2NyZWVuIGVkZ2VzCiAgbGV0IHR4ID0gcnggKyBydyAvIDIgLSBUVyAvIDI7CiAgdHggPSBNYXRoLm1heCgxMCwgTWF0aC5taW4odHgsIFcgLSBUVyAtIDEwKSk7CgogIC8vIFByZWZlciBhYm92ZSwgZmFsbGJhY2sgYmVsb3csIGZhbGxiYWNrIGNlbnRyZQogIGxldCB0eSwgYXJyb3dEaXI7CiAgY29uc3Qgc3BhY2VBYm92ZSA9IHJ5IC0gZ2FwOwogIGNvbnN0IHNwYWNlQmVsb3cgPSBIIC0gKHJ5ICsgcmgpIC0gZ2FwOwoKICBpZiAoc3BhY2VBYm92ZSA+PSBUSCArIDEwKSB7CiAgICB0eSA9IHJ5IC0gVEggLSBnYXA7CiAgICBhcnJvd0RpciA9ICdkb3duJzsKICB9IGVsc2UgaWYgKHNwYWNlQmVsb3cgPj0gVEggKyAxMCkgewogICAgdHkgPSByeSArIHJoICsgZ2FwOwogICAgYXJyb3dEaXIgPSAndXAnOwogIH0gZWxzZSB7CiAgICB0eSA9IE1hdGgubWF4KDEwLCBIIC8gMiAtIFRIIC8gMik7CiAgICBhcnJvd0RpciA9IHN0ZXAuYXJyb3cgfHwgJ2Rvd24nOwogIH0KCiAgLy8gQ2xhbXAgdmVydGljYWxseSBzbyB0b29sdGlwIG5ldmVyIGhpZGVzIHVuZGVyIGJvdHRvbSBuYXYKICB0eSA9IE1hdGgubWF4KDgsIE1hdGgubWluKHR5LCBIIC0gVEggLSA3MCkpOwoKICBjb25zdCBhcnJvd0VsID0gdG9vbHRpcC5xdWVyeVNlbGVjdG9yKCcuY29hY2gtYXJyb3cnKTsKICBpZiAoYXJyb3dFbCkgYXJyb3dFbC5jbGFzc05hbWUgPSBgY29hY2gtYXJyb3cgJHthcnJvd0Rpcn1gOwoKICB0b29sdGlwLnN0eWxlLmxlZnQgPSB0eCArICdweCc7CiAgdG9vbHRpcC5zdHlsZS50b3AgID0gdHkgKyAncHgnOwoKICAvLyBSZS10cmlnZ2VyIHBvcCBhbmltYXRpb24KICB0b29sdGlwLnN0eWxl','LmFuaW1hdGlvbiA9ICdub25lJzsKICB0b29sdGlwLm9mZnNldEhlaWdodDsKICB0b29sdGlwLnN0eWxlLmFuaW1hdGlvbiA9ICdjb2FjaFBvcCAwLjNzIGN1YmljLWJlemllcigwLjM0LDEuNTYsMC42NCwxKSBib3RoJzsKfQoKZnVuY3Rpb24gX2RyYXdDb2FjaE5vVGFyZ2V0KHN0ZXAsIGlkeCkgewogIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtb3ZlcmxheScpOwogIGNvbnN0IHN2ZyAgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29hY2gtc3ZnJyk7CiAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC10b29sdGlwJyk7CiAgY29uc3QgcHVsc2UgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1wdWxzZScpOwogIGNvbnN0IFcgPSB3aW5kb3cuaW5uZXJXaWR0aCwgSCA9IHdpbmRvdy5pbm5lckhlaWdodDsKICBpZiAoc3ZnKSBzdmcuaW5uZXJIVE1MID0gYDxyZWN0IHdpZHRoPSIke1d9IiBoZWlnaHQ9IiR7SH0iIGZpbGw9InJnYmEoMTAsMTQsNDAsMC44MikiLz5gOwogIGlmIChwdWxzZSkgcHVsc2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBpZiAob3ZlcmxheSkgeyBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOyBvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOyB9CiAgaWYgKCF0b29sdGlwKSByZXR1cm47CiAgY29uc3QgaXNMYXN0ID0gaWR4ID09PSBDT0FDSF9TVEVQUy5sZW5ndGggLSAxOwogIHRvb2x0aXAuaW5uZXJIVE1MID0gYAogICAgPGRpdiBjbGFzcz0iY29hY2gtc3RlcC10YWciPiR7c3RlcC50YWd9PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC10aXRsZSI+JHtzdGVwLnRpdGxlfTwvZGl2PgogICAgPGRpdiBjbGFzcz0iY29hY2gtZGVzYyI+JHtzdGVwLmRlc2N9PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjb2FjaC1idG4tcm93Ij4KICAgICAgJHtpZHggPiAwID8gYDxidXR0b24gY2xhc3M9ImNvYWNoLXByZXYtYnRuIiBvbmNsaWNrPSJzaG93Q29hY2hTdGVwKCR7aWR4LTF9KSI+4oC5IEJhY2s8L2J1dHRvbj5gIDogJyd9CiAgICAgIDxidXR0b24gY2xhc3M9ImNvYWNoLW5leHQtYnRuIiBvbmNsaWNrPSIke2lzTGFzdCA/ICdlbmRDb2FjaFRvdXIoKScgOiBgc2hvd0NvYWNoU3RlcCgke2lkeCsxfSlgfSI+CiAgICAgICAgJHtpc0xhc3QgPyAn8J+OiSBEb25lIScgOiAnTmV4dCDihpInfQogICAgICA8L2J1dHRvbj4KICAgICAgJHshaXNMYXN0ID8gYDxidXR0b24gY2xhc3M9ImNvYWNoLXNraXAtYnRuIiBvbmNsaWNrPSJlbmRDb2FjaFRvdXIoKSI+U2tpcCBhbGw8L2J1dHRvbj5gIDogJyd9CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNvYWNoLXByb2dyZXNzIj4ke2lkeCArIDF9IC8gJHtDT0FDSF9TVEVQUy5sZW5ndGh9PC9kaXY+CiAgYDsKICB0b29sdGlwLnN0eWxlLmRpc3BsYXkgICAgICA9ICdibG9jayc7CiAgdG9vbHRpcC5zdHlsZS56SW5kZXggICAgICAgPSAnMTAwMDAnOwogIHRvb2x0aXAuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhbGwnOwogIGNvbnN0IFRXID0gMjY4OwogIHRvb2x0aXAuc3R5bGUubGVmdCA9IE1hdGgubWF4KDEwLCBXLzIgLSBUVy8yKSArICdweCc7CiAgdG9vbHRpcC5zdHlsZS50b3AgID0gJy05OTk5cHgnOwogIGNvbnN0IFRIID0gdG9vbHRpcC5vZmZzZXRIZWlnaHQgfHwgMTcwOwogIHRvb2x0aXAuc3R5bGUudG9wICA9IE1hdGgubWF4KDEwLCBILzIgLSBUSC8yKSArICdweCc7CiAgdG9vbHRpcC5zdHlsZS5hbmltYXRpb24gPSAnbm9uZSc7CiAgdG9vbHRpcC5vZmZzZXRIZWlnaHQ7CiAgdG9vbHRpcC5zdHlsZS5hbmltYXRpb24gPSAnY29hY2hQb3AgMC4zcyBjdWJpYy1iZXppZXIoMC4zNCwxLjU2LDAuNjQsMSkgYm90aCc7Cn0KCmZ1bmN0aW9uIGVuZENvYWNoVG91cigpIHsKICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLW92ZXJsYXknKTsKICBjb25zdCBwdWxzZSAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvYWNoLXB1bHNlJyk7CiAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC10b29sdGlwJyk7CiAgY29uc3Qgc3ZnICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2FjaC1zdmcnKTsKICAvLyBDbGVhciBTVkcgZGltIG1hc2sgc28gbm90aGluZyBibG9ja3MgdG91Y2hlcyBldmVuIGJyaWVmbHkKICBpZiAoc3ZnKSAgICAgc3ZnLmlubmVySFRNTCA9ICcnOwogIGlmIChwdWxzZSkgICB7IHB1bHNlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IH0KICBpZiAodG9vbHRpcCkgeyB0b29sdGlwLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IHRvb2x0aXAuaW5uZXJIVE1MID0gJyc7IH0KICBpZiAob3ZlcmxheSkgewogICAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgIG92ZXJsYXkuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICB9CiAgLy8gQ2xvc2UgZmFiIG1lbnUgaWYgb3BlbgogIHRyeSB7CiAgICBjb25zdCBtZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZhYi1tZW51Jyk7CiAgICBpZiAobWVudSAmJiBtZW51LmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYWItYWRkLWJ0bicpPy5jbGljaygpOwogICAgfQogIH0gY2F0Y2goZSkge30KICAvLyBSZXR1cm4gdG8gaG9tZQogIHN3aXRjaFNjcmVlbignaG9tZScsIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXYtaXRlbTpmaXJzdC1jaGlsZCcpKTsKICBzaG93VG9hc3QoJ/Cfjq8gVG91ciBjb21wbGV0ZSDigJQgeW91XCdyZSByZWFkeSEnKTsKfQoKLy8g4pSA4pSAIElOSVQKCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9wYmFyLW1vbnRoJykudGV4dENvbnRlbnQgPSBnZXREaXNwbGF5TW9udGgodmlld01vbnRoKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21ldGFsLWRhdGUnKS52YWx1ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW52LWRhdGUnKS52YWx1ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOwoKLy8gQXBwbHkgc3RvcmVkIHRoZW1lCmFwcGx5U3RvcmVkVGhlbWUoKTsKCi8vIEluaXQgcGVyaW9kCnNlbGVjdGVkRGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07CnVwZGF0ZVBlcmlvZExhYmVsKCk7CgovLyBSZW5kZXIgaG9tZQpyZW5kZXJIb21lKCk7CgovLyBTaG93IG9uYm9hcmRpbmcgb24gZmlyc3QgZXZlciBsb2FkCmlmICghbG9jYWxTdG9yYWdlLmdldEl0ZW0oT0JfU0VFTl9LRVkpKSB7CiAgc2hvd09uYm9hcmRpbmcoKTsKfQoKLy8gUElOIExvY2s6IERJU0FCTEVEIOKAlCB1bmNvbW1lbnQgaW5pdExvY2tTY3JlZW4oKSBiZWxvdyB0byByZS1lbmFibGUKLy8gaW5pdExvY2tTY3JlZW4oKTsKCi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAovLyBGSVJFQkFTRSBTWU5DIEVOR0lORQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKCmNvbnN0IEZJUkVCQVNFX0NPTkZJRyA9IHsKICBhcGlLZXk6ICJBSXphU3lDeE03VWhBTDdRRG0xcmxDUmtuX3VwVnhOd0JYSDVfVTQiLAogIGF1dGhEb21haW46ICJtb25leWZpLTc1OTI5LmZpcmViYXNlYXBwLmNvbSIsCiAgcHJvamVjdElkOiAibW9uZXlmaS03NTkyOSIsCiAgc3RvcmFnZUJ1Y2tldDogIm1vbmV5ZmktNzU5MjkuZmlyZWJhc2VzdG9yYWdlLmFwcCIsCiAgbWVzc2FnaW5nU2VuZGVySWQ6ICI0NTczNzgzOTcyOTciLAogIGFwcElkOiAiMTo0NTczNzgzOTcyOTc6d2ViOjQzOTQ0ZmU0OGFkMjhiMjE5YTJmZDAiCn07CgovLyDilIDilIAgSW5pdCBGaXJlYmFzZSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChGSVJFQkFTRV9DT05GSUcpOwpjb25zdCBfYXV0aCA9IGZpcmViYXNlLmF1dGgoKTsKY29uc3QgX2RiICAgPSBmaXJlYmFzZS5maXJlc3RvcmUoKTsKd2luZG93Ll9mYkRiID0gX2RiOwp3aW5kb3cuX2ZiVXNlciA9IG51bGw7CgovLyDilIDilIAgU3luYyBzdGF0dXMgVUkg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIHNob3dTeW5jU3RhdHVzKG1zZywgY29sb3I9JyMxMEI5ODEnLCBkdXJhdGlvbj0yNTAwKSB7CiAgY29uc3QgYmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtc3RhdHVzLWJhcicpOwogIGlmICghYmFyKSByZXR1cm47CiAgYmFyLnRleHRDb250ZW50ID0gbXNnOwogIGJhci5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3I7CiAgYmFyLnN0eWxlLmNvbG9yID0gJ3doaXRlJzsKICBiYXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgY2xlYXJUaW1lb3V0KGJhci5faGlkZVRpbWVyKTsKICBpZiAoZHVyYXRpb24gPiAwKSB7CiAgICBiYXIuX2hpZGVUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4geyBiYXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfSwgZHVyYXRpb24pOwogIH0KfQoKLy8g4pSA4pSAIEZhbWlseSB2cyBQZXJzb25hbCBkYXRhIHJvdXRpbmcg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmNvbnN0IEZBTUlMWV9FTUFJTFMgPSBbCiAgJ3BucmFnaHVraXNob3JlQGdtYWlsLmNvbScsCiAgJ3N3YXRoaWtpc2hvcmUxMkBnbWFpbC5jb20nLAogICdza2FuZGEucGVudWp1cmlAZ21haWwuY29tJwpdOwpjb25zdCBGQU1JTFlfRE9DX0lEID0gJ2tpc2hvcmUtZmFtaWx5JzsKCmZ1bmN0aW9uIGdldERhdGFSZWYoZGIsIHVpZCwgZW1haWwpIHsKICBjb25zdCBpc0ZhbWlseSA9IEZBTUlMWV9FTUFJTFMuaW5jbHVkZXMoKGVtYWlsIHx8ICcnKS50b0xvd2VyQ2FzZSgpKTsKICBpZiAoaXNGYW1pbHkpIHsKICAgIC8vIEZhbWlseSBtZW1iZXJzIHNoYXJlIG9uZSBkb2N1bWVudAogICAgcmV0dXJuIGRiLmNvbGxlY3Rpb24oJ2ZhbWlsaWVzJykuZG9jKEZBTUlMWV9ET0NfSUQpOwogIH0gZWxzZSB7CiAgICAvLyBFdmVyeW9uZSBlbHNlIGdldHMgdGhlaXIgb3duIHByaXZhdGUgZG9jdW1lbnQKICAgIHJldHVybiBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmRvYyh1aWQpOwogIH0KfQoKLy8g4pSA4pSAIEZpcmViYXNlIFNhdmU6IGNodW5rZWQgdG8gc3RheSB1bmRlciAxTUIgRmlyZXN0b3JlIGxpbWl0IOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgApsZXQgX3NhdmVUaW1lciA9IG51bGw7CmZ1bmN0aW9uIGZpcmViYXNlU2F2ZSgpIHsKICBpZiAoIXdpbmRvdy5fZmJVc2Vy','KSByZXR1cm47CiAgLy8gRGVib3VuY2U6IHdhaXQgMS41cyBhZnRlciBsYXN0IHNhdmUgY2FsbCBiZWZvcmUgd3JpdGluZyB0byBGaXJlc3RvcmUKICBjbGVhclRpbWVvdXQoX3NhdmVUaW1lcik7CiAgX3NhdmVUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gX2RvRmlyZWJhc2VTYXZlKCksIDE1MDApOwp9CgpmdW5jdGlvbiBfZG9GaXJlYmFzZVNhdmUoKSB7CiAgaWYgKCF3aW5kb3cuX2ZiVXNlcikgcmV0dXJuOwogIGNvbnN0IHVpZCAgID0gd2luZG93Ll9mYlVzZXIudWlkOwogIGNvbnN0IGVtYWlsID0gd2luZG93Ll9mYlVzZXIuZW1haWw7CiAgc2hvd1N5bmNTdGF0dXMoJ+KYge+4jyBTYXZpbmcuLi4nLCAnIzNCOUVGRicsIDApOwoKICAvLyBTcGxpdCBkYXRhIGludG8gY2h1bmtzIHRvIHN0YXkgd2VsbCB1bmRlciBGaXJlc3RvcmUgMU1CIGRvYyBsaW1pdAogIC8vIENodW5rIDE6IG1haW4gZGF0YSAodHJhbnNhY3Rpb25zLCBidWRnZXRzLCBnb2Fscywgc2V0dGluZ3MpCiAgLy8gQ2h1bmsgMjogaGVhdnkgYXJyYXlzIChtZXRhbHMsIE5XIGFjY291bnRzLCBpbnZlc3RtZW50cykKICBjb25zdCBjaHVuazEgPSB7fTsKICBjb25zdCBjaHVuazIgPSB7fTsKCiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChrID0+IHsKICAgIGNvbnN0IGhlYXZ5ID0gWydfbWV0YWxzJywnX253QWNjb3VudHMnLCdfcmVhbEVzdGF0ZSddOwogICAgaWYgKGhlYXZ5LmluY2x1ZGVzKGspKSBjaHVuazJba10gPSBkYXRhW2tdOwogICAgZWxzZSBjaHVuazFba10gPSBkYXRhW2tdOwogIH0pOwoKICBjb25zdCBiYXNlUmVmID0gZ2V0RGF0YVJlZihfZGIsIHVpZCwgZW1haWwpOwogIGNvbnN0IGJhdGNoID0gX2RiLmJhdGNoKCk7CiAgYmF0Y2guc2V0KGJhc2VSZWYuY29sbGVjdGlvbignYXBwRGF0YScpLmRvYygnbWFpbicpLAogICAgeyAuLi5jaHVuazEsIF9zYXZlZEF0OiBmaXJlYmFzZS5maXJlc3RvcmUuRmllbGRWYWx1ZS5zZXJ2ZXJUaW1lc3RhbXAoKSB9KTsKICBiYXRjaC5zZXQoYmFzZVJlZi5jb2xsZWN0aW9uKCdhcHBEYXRhJykuZG9jKCdhc3NldHMnKSwKICAgIHsgLi4uY2h1bmsyLCBfc2F2ZWRBdDogZmlyZWJhc2UuZmlyZXN0b3JlLkZpZWxkVmFsdWUuc2VydmVyVGltZXN0YW1wKCkgfSk7CgogIGJhdGNoLmNvbW1pdCgpCiAgICAudGhlbigoKSA9PiBzaG93U3luY1N0YXR1cygn4pyFIFN5bmNlZCcsICcjMTBCOTgxJywgMjAwMCkpCiAgICAuY2F0Y2goZXJyID0+IHsKICAgICAgY29uc29sZS5lcnJvcignRmlyZWJhc2Ugc2F2ZSBlcnJvcjonLCBlcnIpOwogICAgICBzaG93U3luY1N0YXR1cygn4pqg77iPIFN5bmMgZmFpbGVkIOKAlCBzYXZlZCBsb2NhbGx5JywgJyNGNTlFMEInLCAzMDAwKTsKICAgIH0pOwp9CgovLyDilIDilIAgRmlyZWJhc2UgTG9hZDogbWVyZ2UgY2h1bmtzIGJhY2sgaW50byBkYXRhIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAphc3luYyBmdW5jdGlvbiBmaXJlYmFzZUxvYWQodWlkKSB7CiAgc2hvd1N5bmNTdGF0dXMoJ+KYge+4jyBMb2FkaW5nIHlvdXIgZGF0YS4uLicsICcjM0I5RUZGJywgMCk7CiAgY29uc3QgZW1haWwgPSB3aW5kb3cuX2ZiVXNlciA/IHdpbmRvdy5fZmJVc2VyLmVtYWlsIDogJyc7CiAgdHJ5IHsKICAgIGNvbnN0IGJhc2VSZWYgPSBnZXREYXRhUmVmKF9kYiwgdWlkLCBlbWFpbCk7CiAgICBjb25zdCBbbWFpblNuYXAsIGFzc2V0c1NuYXBdID0gYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICBiYXNlUmVmLmNvbGxlY3Rpb24oJ2FwcERhdGEnKS5kb2MoJ21haW4nKS5nZXQoKSwKICAgICAgYmFzZVJlZi5jb2xsZWN0aW9uKCdhcHBEYXRhJykuZG9jKCdhc3NldHMnKS5nZXQoKQogICAgXSk7CgogICAgY29uc3QgbWFpbkRhdGEgICA9IG1haW5TbmFwLmV4aXN0cyAgID8gbWFpblNuYXAuZGF0YSgpICAgOiB7fTsKICAgIGNvbnN0IGFzc2V0c0RhdGEgPSBhc3NldHNTbmFwLmV4aXN0cyA/IGFzc2V0c1NuYXAuZGF0YSgpIDoge307CgogICAgLy8gUmVtb3ZlIEZpcmVzdG9yZSBtZXRhZGF0YSBmaWVsZHMKICAgIGRlbGV0ZSBtYWluRGF0YS5fc2F2ZWRBdDsKICAgIGRlbGV0ZSBhc3NldHNEYXRhLl9zYXZlZEF0OwoKICAgIGNvbnN0IG1lcmdlZCA9IHsgLi4ubWFpbkRhdGEsIC4uLmFzc2V0c0RhdGEgfTsKCiAgICBpZiAoT2JqZWN0LmtleXMobWVyZ2VkKS5sZW5ndGggPiAwKSB7CiAgICAgIC8vIENsb3VkIGRhdGEgZXhpc3RzIOKAlCBtZXJnZSB3aXRoIGxvY2FsIChjbG91ZCB3aW5zIGZvciBjb25mbGljdHMpCiAgICAgIGRhdGEgPSB7IC4uLmRhdGEsIC4uLm1lcmdlZCB9OwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgICBzaG93U3luY1N0YXR1cygn4pyFIERhdGEgbG9hZGVkIGZyb20gY2xvdWQnLCAnIzEwQjk4MScsIDI1MDApOwogICAgfSBlbHNlIHsKICAgICAgLy8gTm8gY2xvdWQgZGF0YSB5ZXQg4oCUIHB1c2ggbG9jYWwgZGF0YSB0byBjbG91ZAogICAgICBzaG93U3luY1N0YXR1cygn4piB77iPIEZpcnN0IHN5bmMg4oCUIHVwbG9hZGluZyBsb2NhbCBkYXRhLi4uJywgJyMzQjlFRkYnLCAwKTsKICAgICAgZmlyZWJhc2VTYXZlKCk7CiAgICB9CgogICAgLy8gUmVzdG9yZSBjdXN0b20gTlcgdHlwZXMKICAgIChkYXRhLl9ud0N1c3RvbVR5cGVzIHx8IFtdKS5mb3JFYWNoKGMgPT4gewogICAgICBOV19UWVBFU1tjLmtleV0gPSB7IGxhYmVsOiBjLmxhYmVsLCBlbW9qaTogYy5lbW9qaXx8J/Cfj6YnLCBjb2xvcjonIzZCNzI4MCcsIGlzTGlhYjogYy5pc0xpYWJ8fGZhbHNlIH07CiAgICB9KTsKCiAgICAvLyBSZS1yZW5kZXIgZXZlcnl0aGluZyB3aXRoIGNsb3VkIGRhdGEKICAgIGFwcGx5U3RvcmVkVGhlbWUoKTsKICAgIHJlbmRlckhvbWUoKTsKICAgIHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0ICYmIHBvcHVsYXRlRGF0YU1vbnRoU2VsZWN0KCk7CgogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5lcnJvcignRmlyZWJhc2UgbG9hZCBlcnJvcjonLCBlcnIpOwogICAgc2hvd1N5bmNTdGF0dXMoJ+KaoO+4jyBDb3VsZCBub3QgbG9hZCBjbG91ZCBkYXRhIOKAlCB1c2luZyBsb2NhbCcsICcjRjU5RTBCJywgMzAwMCk7CiAgfQp9CgovLyDilIDilIAgUmVhbC10aW1lIGxpc3RlbmVyOiB1cGRhdGUgVUkgd2hlbiBhbm90aGVyIGRldmljZSBzYXZlcyDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKbGV0IF91bnN1YnNjcmliZUxpc3RlbmVyID0gbnVsbDsKZnVuY3Rpb24gc3RhcnRSZWFsdGltZVN5bmModWlkKSB7CiAgaWYgKF91bnN1YnNjcmliZUxpc3RlbmVyKSBfdW5zdWJzY3JpYmVMaXN0ZW5lcigpOwogIGNvbnN0IGVtYWlsID0gd2luZG93Ll9mYlVzZXIgPyB3aW5kb3cuX2ZiVXNlci5lbWFpbCA6ICcnOwogIGNvbnN0IGJhc2VSZWYgPSBnZXREYXRhUmVmKF9kYiwgdWlkLCBlbWFpbCk7CiAgY29uc3QgbWFpblJlZiA9IGJhc2VSZWYuY29sbGVjdGlvbignYXBwRGF0YScpLmRvYygnbWFpbicpOwogIF91bnN1YnNjcmliZUxpc3RlbmVyID0gbWFpblJlZi5vblNuYXBzaG90KHNuYXAgPT4gewogICAgaWYgKCFzbmFwLmV4aXN0cyB8fCBzbmFwLm1ldGFkYXRhLmhhc1BlbmRpbmdXcml0ZXMpIHJldHVybjsKICAgIC8vIEFub3RoZXIgZGV2aWNlIHVwZGF0ZWQgZGF0YSDigJQgcmVsb2FkIHNpbGVudGx5CiAgICBmaXJlYmFzZUxvYWQodWlkKS50aGVuKCgpID0+IHsKICAgICAgc2hvd1N5bmNTdGF0dXMoJ/CflIQgVXBkYXRlZCBmcm9tIGFub3RoZXIgZGV2aWNlJywgJyM4QjVDRjYnLCAyNTAwKTsKICAgIH0pOwogIH0sIGVyciA9PiBjb25zb2xlLndhcm4oJ1JlYWx0aW1lIHN5bmMgZXJyb3I6JywgZXJyKSk7Cn0KCi8vIOKUgOKUgCBBdXRoIHN0YXRlIGhhbmRsZXIg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIHNpZ25JbldpdGhHb29nbGUoKSB7CiAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvb2dsZS1zaWduaW4tYnRuJyk7CiAgY29uc3Qgc3RhdHVzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW4tc3RhdHVzJyk7CiAgaWYgKGJ0bikgYnRuLmRpc2FibGVkID0gdHJ1ZTsKICBpZiAoc3RhdHVzRWwpIHN0YXR1c0VsLnRleHRDb250ZW50ID0gJ1NpZ25pbmcgaW4uLi4nOwoKICBjb25zdCBwcm92aWRlciA9IG5ldyBmaXJlYmFzZS5hdXRoLkdvb2dsZUF1dGhQcm92aWRlcigpOwogIF9hdXRoLnNpZ25JbldpdGhQb3B1cChwcm92aWRlcikKICAgIC5jYXRjaChlcnIgPT4gewogICAgICBjb25zb2xlLmVycm9yKCdTaWduIGluIGVycm9yOicsIGVycik7CiAgICAgIGlmIChidG4pIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICBpZiAoc3RhdHVzRWwpIHN0YXR1c0VsLnRleHRDb250ZW50ID0gJ1NpZ24gaW4gZmFpbGVkIOKAlCBwbGVhc2UgdHJ5IGFnYWluJzsKICAgIH0pOwp9CgpmdW5jdGlvbiBzaWduT3V0KCkgewogIGlmIChfdW5zdWJzY3JpYmVMaXN0ZW5lcikgX3Vuc3Vic2NyaWJlTGlzdGVuZXIoKTsKICBfYXV0aC5zaWduT3V0KCkudGhlbigoKSA9PiB7CiAgICB3aW5kb3cuX2ZiVXNlciA9IG51bGw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyZWVuLWxvZ2luJykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIHNob3dUb2FzdCgn8J+RiyBTaWduZWQgb3V0Jyk7CiAgfSk7Cn0KCi8vIOKUgOKUgCBBdXRoIHN0YXRlIGNoYW5nZSDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKX2F1dGgub25BdXRoU3RhdGVDaGFuZ2VkKGFzeW5jIHVzZXIgPT4gewogIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1sb2dpbicpOwoKICBpZiAodXNlcikgewogICAgLy8g4pSA4pSAIEFsbG93bGlzdCBjaGVjayDigJQgb25seSBmYW1pbHkgbWVtYmVycyBjYW4gYWNjZXNzIOKUgOKUgAogICAgY29uc3QgQUxMT1dFRF9FTUFJTFMgPSBbCiAgICAgICdwbnJhZ2h1a2lzaG9yZUBnbWFpbC5jb20nLAogICAgICAnc3dhdGhpa2lzaG9yZTEyQGdtYWlsLmNvbScsCiAgICAgICdza2FuZGEucGVudWp1cmlAZ21haWwuY29tJywKICAgICAgJ3N1amE4MUBnbWFpbC5jb20nLAogICAgICAnY2hhcmxlc2FrbEBnbWFpbC5jb20nLAogICAgICAnbmFyYXNpbWhhLm5lb0BnbWFpbC5jb20nLAogICAgICAncGluZzJydXBlc2hAZ21haWwuY29tJywKICAgICAgJ2Vib29rc29mcG5yQGdtYWlsLmNvbScsCiAgICAgICdwbnJraXJhbkBnbWFpbC5jb20nCiAgICBdOwoKICAgIGlmICghQUxMT1dFRF9FTUFJTFMuaW5jbHVkZXModXNlci5lbWFpbC50b0xvd2VyQ2FzZSgpKSkgewogICAgICAvLyBOb3QgYXV0aG9yaXNlZCDigJQgc2lnbiBvdXQgYW5kIHNob3cgYWNjZXNzIGRlbmllZAogICAgICBfYXV0aC5zaWduT3V0KCk7CiAgICAgIGNvbnN0IGxvZ2luU2NyZWVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmVlbi1sb2dpbicpOwogICAgICBpZiAobG9naW5TY3JlZW4pIHsKICAgICAgICBsb2dpblNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgIGNvbnN0IHN0YXR1c0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvZ2luLXN0YXR1cycpOwogICAgICAgIGlmIChzdGF0dXNFbCkgewogICAgICAgICAgc3RhdHVzRWwuaW5uZXJIVE1MID0gYDxzcGFuIHN0eWxlPSJjb2xvcjojRUY0NDQ0O2ZvbnQtd2VpZ2h0','OjgwMDsiPuKblCBBY2Nlc3MgZGVuaWVkPC9zcGFuPjxicj4KICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImNvbG9yOiM5OTk7Ij4ke3VzZXIuZW1haWx9IGlzIG5vdCBhdXRob3Jpc2VkLjxicj5Db250YWN0IHRoZSBhcHAgb3duZXIuPC9zcGFuPmA7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb29nbGUtc2lnbmluLWJ0bicpOwogICAgICAgIGlmIChidG4pIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIC8vIOKUgOKUgCBFbmQgYWxsb3dsaXN0IGNoZWNrIOKUgOKUgAoKICAgIC8vIFVzZXIgaXMgc2lnbmVkIGluCiAgICB3aW5kb3cuX2ZiVXNlciA9IHVzZXI7CiAgICB3aW5kb3cuX2ZiRGIgICA9IF9kYjsKCiAgICAvLyBIaWRlIGxvZ2luIHNjcmVlbgogICAgaWYgKGxvZ2luU2NyZWVuKSBsb2dpblNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgIC8vIFVwZGF0ZSB1c2VyIGRpc3BsYXkgaW4gc2V0dGluZ3MgaWYgZWxlbWVudCBleGlzdHMKICAgIGNvbnN0IHVzZXJFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaXJlYmFzZS11c2VyLWRpc3BsYXknKTsKICAgIGlmICh1c2VyRWwpIHsKICAgICAgdXNlckVsLnRleHRDb250ZW50ID0gdXNlci5kaXNwbGF5TmFtZSB8fCB1c2VyLmVtYWlsOwogICAgfQogICAgY29uc3QgdXNlckF2YXRhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaXJlYmFzZS11c2VyLWF2YXRhcicpOwogICAgaWYgKHVzZXJBdmF0YXIgJiYgdXNlci5waG90b1VSTCkgewogICAgICB1c2VyQXZhdGFyLnNyYyA9IHVzZXIucGhvdG9VUkw7CiAgICAgIHVzZXJBdmF0YXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9CgogICAgLy8gTG9hZCBkYXRhIGZyb20gY2xvdWQsIHRoZW4gc3RhcnQgcmVhbC10aW1lIHN5bmMKICAgIGF3YWl0IGZpcmViYXNlTG9hZCh1c2VyLnVpZCk7CiAgICBzdGFydFJlYWx0aW1lU3luYyh1c2VyLnVpZCk7CgogIH0gZWxzZSB7CiAgICAvLyBOb3Qgc2lnbmVkIGluIOKAlCBzaG93IGxvZ2luIHNjcmVlbgogICAgd2luZG93Ll9mYlVzZXIgPSBudWxsOwogICAgaWYgKGxvZ2luU2NyZWVuKSBsb2dpblNjcmVlbi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgaWYgKF91bnN1YnNjcmliZUxpc3RlbmVyKSBfdW5zdWJzY3JpYmVMaXN0ZW5lcigpOwogIH0KfSk7CgovLyDilIDilIAgU21hcnQgTGlua2VkIENhdGVnb3J5IFBpY2tlciDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIAKbGV0IF9saW5rZWRDYXRzU2VsZWN0ZWQgPSBbXTsKCmZ1bmN0aW9uIGluaXRMaW5rZWRDYXRQaWNrZXIoZXhpc3RpbmdDYXRzLCBidWRnZXRUeXBlKSB7CiAgLy8gZXhpc3RpbmdDYXRzOiBhcnJheSBvZiBzdHJpbmdzIGFscmVhZHkgbGlua2VkCiAgX2xpbmtlZENhdHNTZWxlY3RlZCA9IGV4aXN0aW5nQ2F0cyA/IFsuLi5leGlzdGluZ0NhdHNdIDogW107CiAgcmVuZGVyTGlua2VkQ2hpcHMoKTsKICBjb25zdCBzZWFyY2ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWxpbmtlZC1zZWFyY2gnKTsKICBpZiAoc2VhcmNoKSBzZWFyY2gudmFsdWUgPSAnJzsKICBzeW5jTGlua2VkQ2F0c0hpZGRlbigpOwoKICAvLyBTaG93IGNvbnRleHQtYXdhcmUgaGludAogIGNvbnN0IGhpbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWxpbmtlZC1jYXRzLWhpbnQnKTsKICBpZiAoaGludCkgewogICAgaWYgKGJ1ZGdldFR5cGUgPT09ICdzYXZpbmdzJykgewogICAgICBoaW50LmlubmVySFRNTCA9ICfwn5KhIE1hcHMgdG8gPHN0cm9uZz5JbnZlc3RpbmcgdGFiPC9zdHJvbmc+IHRyYW5zYWN0aW9ucyDigJQgdHlwZSBhIGNhdGVnb3J5IGxpa2UgU3RvY2tzLCBHb2xkLCBDcnlwdG8nOwogICAgfSBlbHNlIHsKICAgICAgaGludC5pbm5lckhUTUwgPSAn8J+SoSBNYXBzIHRvIDxzdHJvbmc+ZXhwZW5zZTwvc3Ryb25nPiB0cmFuc2FjdGlvbnMg4oCUIHR5cGUgYSBjYXRlZ29yeSBsaWtlIEdyb2NlcmllcywgRmFzdEZvb2QnOwogICAgfQogIH0KfQoKZnVuY3Rpb24gZ2V0QWxsQXZhaWxhYmxlQ2F0cyhidWRnZXRUeXBlKSB7CiAgLy8gRm9yIHNhdmluZ3MgZ29hbHMg4oCUIHByaW9yaXRpc2UgaW52ZXN0bWVudCArIHNhdmluZ3MgY2F0ZWdvcmllcwogIC8vIEZvciBleHBlbnNlIGdvYWxzIOKAlCBwcmlvcml0aXNlIGV4cGVuc2UgY2F0ZWdvcmllcwogIGNvbnN0IGlzU2F2aW5ncyA9IGJ1ZGdldFR5cGUgPT09ICdzYXZpbmdzJzsKICBjb25zdCBhbGwgPSBuZXcgU2V0KCk7CgogIGlmIChpc1NhdmluZ3MpIHsKICAgIC8vIEludmVzdG1lbnQgdHlwZXMgZmlyc3QgZm9yIHNhdmluZ3MgZ29hbHMKICAgIFsnaW52ZXN0bWVudCcsJ2FkZGl0aW9uYWwnLCdpbmNvbWUnLCdleHBlbnNlJ10uZm9yRWFjaCh0ID0+CiAgICAgIGdldENhdHNGb3JUeXBlKHQpLmZvckVhY2goYyA9PiBhbGwuYWRkKGMpKQogICAgKTsKICAgIC8vIFB1bGwgYWN0dWFsIGludmVzdG1lbnQgdHJhbnNhY3Rpb25zIHVzZWQKICAgIGNvbnN0IG1rID0gYnVkZ2V0Vmlld01vbnRoIHx8IGdldEN1cnJlbnRNb250aEtleSgpOwogICAgY29uc3QgbW9udGhEYXRhID0gZGF0YVtta10gfHwge307CiAgICAobW9udGhEYXRhLmludmVzdG1lbnRzIHx8IFtdKS5mb3JFYWNoKHR4ID0+IHsKICAgICAgaWYgKHR4LmNhdGVnb3J5KSAgICBhbGwuYWRkKHR4LmNhdGVnb3J5KTsKICAgICAgaWYgKHR4LmludmVzdFR5cGUpICBhbGwuYWRkKHR4LmludmVzdFR5cGUpOwogICAgfSk7CiAgfSBlbHNlIHsKICAgIC8vIEV4cGVuc2UgdHlwZXMgZmlyc3QgZm9yIGV4cGVuc2UgZ29hbHMKICAgIFsnZXhwZW5zZScsJ2FkZGl0aW9uYWwnLCdnaXZlbicsJ2luY29tZSddLmZvckVhY2godCA9PgogICAgICBnZXRDYXRzRm9yVHlwZSh0KS5mb3JFYWNoKGMgPT4gYWxsLmFkZChjKSkKICAgICk7CiAgfQoKICAvLyBBbHNvIHB1bGwgZnJvbSBhbGwgdHJhbnNhY3Rpb25zIGV2ZXIgdXNlZAogIE9iamVjdC5rZXlzKGRhdGEpLmZvckVhY2gobWsgPT4gewogICAgaWYgKCFtay5tYXRjaCgvXlxkezR9LVxkezJ9JC8pKSByZXR1cm47CiAgICBjb25zdCBtID0gZGF0YVtta107CiAgICBbJ2V4cGVuc2VzJywnaW52ZXN0bWVudHMnLCdhZGRpdGlvbmFsJywnaW5jb21lJ10uZm9yRWFjaChsaXN0ID0+IHsKICAgICAgKG1bbGlzdF0gfHwgW10pLmZvckVhY2godHggPT4gewogICAgICAgIGlmICh0eC5jYXRlZ29yeSkgYWxsLmFkZCh0eC5jYXRlZ29yeSk7CiAgICAgICAgaWYgKHR4LnN1YkNhdGVnb3J5KSBhbGwuYWRkKHR4LnN1YkNhdGVnb3J5KTsKICAgICAgICBpZiAodHguaW52ZXN0VHlwZSkgYWxsLmFkZCh0eC5pbnZlc3RUeXBlKTsKICAgICAgfSk7CiAgICB9KTsKICB9KTsKCiAgcmV0dXJuIFsuLi5hbGxdLnNvcnQoKGEsYikgPT4gYS5sb2NhbGVDb21wYXJlKGIpKTsKfQoKZnVuY3Rpb24gZmlsdGVyTGlua2VkQ2F0U3VnZ2VzdGlvbnMocXVlcnkpIHsKICBjb25zdCBkcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbGlua2VkLXN1Z2dlc3Rpb25zJyk7CiAgaWYgKCFkcm9wZG93bikgcmV0dXJuOwoKICAvLyBQYXNzIGN1cnJlbnQgYnVkZ2V0IHR5cGUgc28gc2F2aW5ncyBzaG93cyBpbnZlc3RtZW50IGNhdGVnb3JpZXMKICBjb25zdCBidWRnZXRUeXBlID0gKHR5cGVvZiBlZGl0aW5nQnVkZ2V0VHlwZSAhPT0gJ3VuZGVmaW5lZCcpID8gZWRpdGluZ0J1ZGdldFR5cGUgOiAnZXhwZW5zZSc7CiAgY29uc3QgYWxsID0gZ2V0QWxsQXZhaWxhYmxlQ2F0cyhidWRnZXRUeXBlKTsKICBjb25zdCBxID0gcXVlcnkudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgY29uc3QgZmlsdGVyZWQgPSBhbGwuZmlsdGVyKGMgPT4KICAgIGMudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxKSAmJiAhX2xpbmtlZENhdHNTZWxlY3RlZC5pbmNsdWRlcyhjKQogICk7CgogIGNvbnN0IHRyaW1tZWQgPSBxdWVyeS50cmltKCk7CgogIC8vIEJ1aWxkIHN1Z2dlc3Rpb24gcm93cwogIGNvbnN0IHJvd3MgPSBmaWx0ZXJlZC5tYXAoYyA9PiBgCiAgICA8ZGl2IG9uY2xpY2s9ImFkZExpbmtlZENhdCgnJHtjLnJlcGxhY2UoLycvZywgIlwnIil9JykiCiAgICAgIHN0eWxlPSJwYWRkaW5nOjEwcHggMTRweDtmb250LXNpemU6MC44NWVtO2ZvbnQtd2VpZ2h0OjcwMDtjdXJzb3I6cG9pbnRlcjsKICAgICAgICAgICAgIGNvbG9yOnZhcigtLXRleHQtZGFyayk7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI0Y1RjVGNTt0cmFuc2l0aW9uOmJhY2tncm91bmQgMC4xczsiCiAgICAgIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9JyNGRkY4RTgnIgogICAgICBvbm1vdXNlb3V0PSJ0aGlzLnN0eWxlLmJhY2tncm91bmQ9J3doaXRlJyI+CiAgICAgICR7Y30KICAgIDwvZGl2PgogIGApLmpvaW4oJycpOwoKICAvLyBJZiBubyBtYXRjaCBBTkQgdXNlciB0eXBlZCBzb21ldGhpbmcg4oCUIHNob3cgaW5saW5lIGNyZWF0ZSBvcHRpb24KICBjb25zdCBhbHJlYWR5RXhpc3RzID0gdHJpbW1lZCAmJiBnZXRBbGxBdmFpbGFibGVDYXRzKGJ1ZGdldFR5cGUpLnNvbWUoYyA9PiBjLnRvTG93ZXJDYXNlKCkgPT09IHRyaW1tZWQudG9Mb3dlckNhc2UoKSk7CiAgY29uc3QgY3JlYXRlUm93ID0gdHJpbW1lZCAmJiAhYWxyZWFkeUV4aXN0cyA/IGAKICAgIDxkaXYgb25jbGljaz0iY3JlYXRlQW5kQWRkTGlua2VkQ2F0KCcke3RyaW1tZWQucmVwbGFjZSgvJy9nLCAiXCciKX0nKSIKICAgICAgc3R5bGU9InBhZGRpbmc6MTBweCAxNHB4O2ZvbnQtc2l6ZTowLjg1ZW07Zm9udC13ZWlnaHQ6ODAwO2N1cnNvcjpwb2ludGVyOwogICAgICAgICAgICAgY29sb3I6IzEwQjk4MTtib3JkZXItdG9wOiR7ZmlsdGVyZWQubGVuZ3RoPjA/JzEuNXB4IHNvbGlkICNGMEYwRjAnOidub25lJ307CiAgICAgICAgICAgICBkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7dHJhbnNpdGlvbjpiYWNrZ3JvdW5kIDAuMXM7IgogICAgICBvbm1vdXNlb3Zlcj0idGhpcy5zdHlsZS5iYWNrZ3JvdW5kPScjRjBGQkYzJyIKICAgICAgb25tb3VzZW91dD0idGhpcy5zdHlsZS5iYWNrZ3JvdW5kPSd3aGl0ZSciPgogICAgICA8c3BhbiBzdHlsZT0iYmFja2dyb3VuZDojMTBCOTgxO2NvbG9yOndoaXRlO2JvcmRlci1yYWRpdXM6NTAlO3dpZHRoOjE4cHg7aGVpZ2h0OjE4cHg7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2ZvbnQtc2l6ZTowLjllbTtmbGV4LXNocmluazowOyI+Kzwvc3Bhbj4KICAgICAgQ3JlYXRlIDxzdHJvbmcgc3R5bGU9Im1hcmdpbi1sZWZ0OjNweDsiPiIke3RyaW1tZWR9Ijwvc3Ryb25nPiBhcyBuZXcgY2F0ZWdvcnkKICAgIDwvZGl2PgogIGAgOiAnJzsKCiAgaWYgKCFyb3dzICYmICFjcmVhdGVSb3cpIHsKICAgIGRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICByZXR1cm47CiAgfQoKICBkcm9wZG93bi5pbm5lckhUTUwgPSByb3dzICsgY3JlYXRlUm93OwogIGRyb3Bkb3duLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwp9CgovLyDilIDilIAgQ3JlYXRlIG5ldyBjYXRlZ29yeSBpbmxpbmUgYW5kIGFkZCB0byBwaWNrZXIgKyBhcHAg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACmZ1bmN0aW9uIGNyZWF0ZUFuZEFkZExpbmtlZENhdChjYXROYW1lKSB7CiAgY29uc3QgYnVkZ2V0VHlwZSA9ICh0eXBlb2YgZWRpdGluZ0J1ZGdldFR5cGUgIT09ICd1bmRlZmluZWQnKSA/IGVkaXRpbmdCdWRnZXRUeXBlIDogJ2V4cGVuc2UnOwogIGNvbnN0IHRyaW1tZWQgPSBjYXROYW1lLnRyaW0oKTsKICBpZiAoIXRyaW1tZWQpIHJldHVybjsKCiAgaWYgKGJ1ZGdldFR5cGUgPT09ICdzYXZpbmdzJykg','ewogICAgLy8gQWRkIHRvIGludmVzdG1lbnQgY3VzdG9tIGNhdGVnb3JpZXMKICAgIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogICAgaWYgKCFjYy5pbnZlc3RtZW50KSBjYy5pbnZlc3RtZW50ID0gWy4uLmdldENhdHNGb3JUeXBlKCdpbnZlc3RtZW50JyldOwogICAgaWYgKCFjYy5pbnZlc3RtZW50LmluY2x1ZGVzKHRyaW1tZWQpKSB7CiAgICAgIGNjLmludmVzdG1lbnQucHVzaCh0cmltbWVkKTsKICAgICAgZGF0YS5fY3VzdG9tQ2F0cyA9IGNjOwogICAgfQoKICAgIC8vIEFkZCB0byBIb21lIEludmVzdGluZyBjYXJkcyBzbyBpdCBhcHBlYXJzIGluc3RhbnRseQogICAgY29uc3QgY2FyZHMgPSBnZXRIb21lSW52Q2FyZHMoKTsKICAgIGNvbnN0IGFscmVhZHlDYXJkID0gY2FyZHMuZmluZChjID0+IGMua2V5ID09PSB0cmltbWVkKTsKICAgIGlmICghYWxyZWFkeUNhcmQpIHsKICAgICAgLy8gUGljayBhIGNvbG9yIGZyb20gYSBwYWxldHRlIGJhc2VkIG9uIG5hbWUgaGFzaAogICAgICBjb25zdCBwYWxldHRlID0gWwogICAgICAgIHtjb2xvcjonIzYzNjZGMScsYmc6JyNFRUYyRkYnfSx7Y29sb3I6JyNFQzQ4OTknLGJnOicjRkRGMkY4J30sCiAgICAgICAge2NvbG9yOicjMTRCOEE2JyxiZzonI0YwRkRGQSd9LHtjb2xvcjonI0Y5NzMxNicsYmc6JyNGRkY3RUQnfSwKICAgICAgICB7Y29sb3I6JyM4QjVDRjYnLGJnOicjRjVGM0ZGJ30se2NvbG9yOicjMEVBNUU5JyxiZzonI0YwRjlGRid9LAogICAgICAgIHtjb2xvcjonIzEwQjk4MScsYmc6JyNFQ0ZERjUnfSx7Y29sb3I6JyNEOTc3MDYnLGJnOicjRkZGQkVCJ30sCiAgICAgIF07CiAgICAgIGNvbnN0IHBpY2sgPSBwYWxldHRlW3RyaW1tZWQuY2hhckNvZGVBdCgwKSAlIHBhbGV0dGUubGVuZ3RoXTsKICAgICAgY2FyZHMucHVzaCh7CiAgICAgICAga2V5OiB0cmltbWVkLAogICAgICAgIGxhYmVsOiB0cmltbWVkLAogICAgICAgIGljb246ICfwn5K8JywKICAgICAgICBjb2xvcjogcGljay5jb2xvciwKICAgICAgICBiZzogcGljay5iZywKICAgICAgICBmaWVsZFRlbXBsYXRlOiAnR2VuZXJhbCcsCiAgICAgICAgdmlzaWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgc2F2ZUhvbWVJbnZDYXJkcyhjYXJkcyk7CiAgICB9IGVsc2UgaWYgKCFhbHJlYWR5Q2FyZC52aXNpYmxlKSB7CiAgICAgIC8vIENhcmQgZXhpc3RzIGJ1dCB3YXMgaGlkZGVuIOKAlCBtYWtlIGl0IHZpc2libGUKICAgICAgYWxyZWFkeUNhcmQudmlzaWJsZSA9IHRydWU7CiAgICAgIHNhdmVIb21lSW52Q2FyZHMoY2FyZHMpOwogICAgfQoKICAgIC8vIFJlLXJlbmRlciBob21lIGludmVzdGluZyB0YWIgaW5zdGFudGx5CiAgICBpZiAodHlwZW9mIHJlbmRlckhvbWUgPT09ICdmdW5jdGlvbicpIHJlbmRlckhvbWUoKTsKCiAgICBzaG93VG9hc3QoYOKchSAiJHt0cmltbWVkfSIgYWRkZWQgdG8gSW52ZXN0aW5nIHRhYmApOwoKICB9IGVsc2UgewogICAgLy8gRXhwZW5zZSDigJQgYWRkIHRvIGV4cGVuc2UgY3VzdG9tIGNhdGVnb3JpZXMKICAgIGNvbnN0IGNjID0gZ2V0Q3VzdG9tQ2F0cygpOwogICAgaWYgKCFjYy5leHBlbnNlKSBjYy5leHBlbnNlID0gWy4uLmdldENhdHNGb3JUeXBlKCdleHBlbnNlJyldOwogICAgaWYgKCFjYy5leHBlbnNlLmluY2x1ZGVzKHRyaW1tZWQpKSB7CiAgICAgIGNjLmV4cGVuc2UucHVzaCh0cmltbWVkKTsKICAgICAgZGF0YS5fY3VzdG9tQ2F0cyA9IGNjOwogICAgfQoKICAgIC8vIEFkZCB0byBIb21lIFNwZW5kaW5nIGNhcmRzCiAgICBjb25zdCBzcGVuZENhcmRzID0gZ2V0SG9tZVNwZW5kQ2FyZHMoKTsKCiAgICAvLyBDaGVjayBpZiBpdCBhbHJlYWR5IGV4aXN0cyBhcyBhIHN1YmNhdCBvZiBhbnkgZXhpc3RpbmcgY2FyZAogICAgY29uc3QgZXhpc3RpbmdDYXJkID0gc3BlbmRDYXJkcy5maW5kKGMgPT4KICAgICAgKGMuc3ViY2F0cyB8fCBbXSkuc29tZShzID0+IHMudG9Mb3dlckNhc2UoKSA9PT0gdHJpbW1lZC50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAoYy5sYWJlbCB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gdHJpbW1lZC50b0xvd2VyQ2FzZSgpCiAgICApOwoKICAgIGlmICghZXhpc3RpbmdDYXJkKSB7CiAgICAgIC8vIENyZWF0ZSBhIG5ldyBzcGVuZGluZyBjYXJkIGZvciB0aGlzIGNhdGVnb3J5CiAgICAgIGNvbnN0IHBhbGV0dGUgPSBbCiAgICAgICAge2NvbG9yOicjRkY2QjM1JyxjbHM6J2Zvb2QnfSwgIHtjb2xvcjonIzRBOUVGRicsY2xzOid0cmFuc3BvcnQnfSwKICAgICAgICB7Y29sb3I6JyNGRjQ3NTcnLGNsczonc2hvcHBpbmcnfSx7Y29sb3I6JyM0RUNEQzQnLGNsczonaGVhbHRoJ30sCiAgICAgICAge2NvbG9yOicjRkY2QjlEJyxjbHM6J2dpdmluZyd9LHtjb2xvcjonIzdDM0FFRCcsY2xzOidvdGhlci1jYXQnfSwKICAgICAgICB7Y29sb3I6JyNGNTlFMEInLGNsczonb3RoZXItY2F0J30se2NvbG9yOicjNjRCNUY2JyxjbHM6J290aGVyLWNhdCd9LAogICAgICBdOwogICAgICBjb25zdCBwaWNrID0gcGFsZXR0ZVt0cmltbWVkLmNoYXJDb2RlQXQoMCkgJSBwYWxldHRlLmxlbmd0aF07CiAgICAgIHNwZW5kQ2FyZHMucHVzaCh7CiAgICAgICAga2V5OiB0cmltbWVkLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXHMrL2csJ18nKSwKICAgICAgICBsYWJlbDogdHJpbW1lZCwKICAgICAgICBpY29uOiAn8J+Pt++4jycsCiAgICAgICAgY29sb3I6IHBpY2suY29sb3IsCiAgICAgICAgY2xzOiBwaWNrLmNscywKICAgICAgICBzdWJjYXRzOiBbdHJpbW1lZF0sCiAgICAgICAgdmlzaWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgc2F2ZUhvbWVTcGVuZENhcmRzKHNwZW5kQ2FyZHMpOwogICAgICBzaG93VG9hc3QoYOKchSAiJHt0cmltbWVkfSIgYWRkZWQgdG8gU3BlbmRpbmcgdGFiYCk7CiAgICB9IGVsc2UgewogICAgICAvLyBBbHJlYWR5IG1hcHBlZCB0byBhIGNhcmQg4oCUIGp1c3QgY29uZmlybQogICAgICBzaG93VG9hc3QoYOKchSAiJHt0cmltbWVkfSIgbGlua2VkIHRvICIke2V4aXN0aW5nQ2FyZC5sYWJlbH0iIG9uIFNwZW5kaW5nIHRhYmApOwogICAgfQoKICAgIC8vIFJlLXJlbmRlciBob21lIHNwZW5kaW5nIHRhYiBpbnN0YW50bHkKICAgIGlmICh0eXBlb2YgcmVuZGVySG9tZSA9PT0gJ2Z1bmN0aW9uJykgcmVuZGVySG9tZSgpOwogIH0KCiAgc2F2ZSgpOwoKICAvLyBOb3cgYWRkIHRvIHRoZSBwaWNrZXIgY2hpcHMKICBhZGRMaW5rZWRDYXQodHJpbW1lZCk7Cn0KCmZ1bmN0aW9uIGFkZExpbmtlZENhdChjYXQpIHsKICBpZiAoIV9saW5rZWRDYXRzU2VsZWN0ZWQuaW5jbHVkZXMoY2F0KSkgewogICAgX2xpbmtlZENhdHNTZWxlY3RlZC5wdXNoKGNhdCk7CiAgICByZW5kZXJMaW5rZWRDaGlwcygpOwogICAgc3luY0xpbmtlZENhdHNIaWRkZW4oKTsKICB9CiAgY29uc3Qgc2VhcmNoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1saW5rZWQtc2VhcmNoJyk7CiAgaWYgKHNlYXJjaCkgc2VhcmNoLnZhbHVlID0gJyc7CiAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWxpbmtlZC1zdWdnZXN0aW9ucycpOwogIGlmIChkcm9wZG93bikgZHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKfQoKZnVuY3Rpb24gcmVtb3ZlTGlua2VkQ2F0KGNhdCkgewogIF9saW5rZWRDYXRzU2VsZWN0ZWQgPSBfbGlua2VkQ2F0c1NlbGVjdGVkLmZpbHRlcihjID0+IGMgIT09IGNhdCk7CiAgcmVuZGVyTGlua2VkQ2hpcHMoKTsKICBzeW5jTGlua2VkQ2F0c0hpZGRlbigpOwp9CgpmdW5jdGlvbiByZW5kZXJMaW5rZWRDaGlwcygpIHsKICBjb25zdCB3cmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1saW5rZWQtY2hpcHMnKTsKICBpZiAoIXdyYXApIHJldHVybjsKICBpZiAoX2xpbmtlZENhdHNTZWxlY3RlZC5sZW5ndGggPT09IDApIHsKICAgIHdyYXAuaW5uZXJIVE1MID0gJyc7CiAgICB3cmFwLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcwJzsKICAgIHJldHVybjsKICB9CiAgd3JhcC5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnOHB4JzsKICB3cmFwLmlubmVySFRNTCA9IF9saW5rZWRDYXRzU2VsZWN0ZWQubWFwKGMgPT4gYAogICAgPHNwYW4gc3R5bGU9ImRpc3BsYXk6aW5saW5lLWZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo1cHg7CiAgICAgIGJhY2tncm91bmQ6dmFyKC0teWVsbG93LWxpZ2h0LCNGRkY4REMpO2JvcmRlcjoxLjVweCBzb2xpZCB2YXIoLS15ZWxsb3csI0Y1Qzg0Mik7CiAgICAgIGJvcmRlci1yYWRpdXM6MjBweDtwYWRkaW5nOjRweCAxMHB4IDRweCAxMnB4O2ZvbnQtc2l6ZTowLjc4ZW07Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOnZhcigtLXRleHQtZGFyayk7Ij4KICAgICAgJHtjfQogICAgICA8c3BhbiBvbmNsaWNrPSJyZW1vdmVMaW5rZWRDYXQoJyR7Yy5yZXBsYWNlKC8nL2csICJcJyIpfScpIgogICAgICAgIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6MWVtO2NvbG9yOiM5OTk7bGluZS1oZWlnaHQ6MTttYXJnaW4tbGVmdDoycHg7IgogICAgICAgIG9ubW91c2VvdmVyPSJ0aGlzLnN0eWxlLmNvbG9yPScjRUY0NDQ0JyIgb25tb3VzZW91dD0idGhpcy5zdHlsZS5jb2xvcj0nIzk5OSciPuKclTwvc3Bhbj4KICAgIDwvc3Bhbj4KICBgKS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gc3luY0xpbmtlZENhdHNIaWRkZW4oKSB7CiAgY29uc3QgaGlkZGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VicC1saW5rZWQtY2F0cycpOwogIGlmIChoaWRkZW4pIGhpZGRlbi52YWx1ZSA9IF9saW5rZWRDYXRzU2VsZWN0ZWQuam9pbignLCAnKTsKfQoKLy8gQ2xvc2Ugc3VnZ2VzdGlvbnMgd2hlbiBjbGlja2luZyBvdXRzaWRlCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7CiAgY29uc3QgZHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWJwLWxpbmtlZC1zdWdnZXN0aW9ucycpOwogIGNvbnN0IHNlYXJjaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlYnAtbGlua2VkLXNlYXJjaCcpOwogIGlmIChkcm9wZG93biAmJiBzZWFyY2ggJiYgIXNlYXJjaC5jb250YWlucyhlLnRhcmdldCkgJiYgIWRyb3Bkb3duLmNvbnRhaW5zKGUudGFyZ2V0KSkgewogICAgZHJvcGRvd24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICB9Cn0pOwovLyDilIDilIAgRW5kIFNtYXJ0IExpbmtlZCBDYXRlZ29yeSBQaWNrZXIg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSACgoKLy8g4pSA4pSAIEV4cG9zZSBhdXRoIGZ1bmN0aW9ucyBnbG9iYWxseSBmb3IgbG9naW4gc2NyZWVuIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgAp3aW5kb3cuc2lnbkluV2l0aEdvb2dsZSA9IGZ1bmN0aW9uKCkgeyBzaWduSW5XaXRoR29vZ2xlKCk7IH07CndpbmRvdy5zaWduT3V0ID0gZnVuY3Rpb24oKSB7IGlmKHR5cGVvZiBzaWduT3V0ID09PSAnZnVuY3Rpb24nKSBfZG9TaWduT3V0KCk7IH07CmZ1bmN0aW9uIF9kb1NpZ25PdXQoKSB7CiAgaWYgKF91bnN1YnNjcmliZUxpc3RlbmVyKSBfdW5zdWJzY3JpYmVMaXN0ZW5lcigpOwogIF9hdXRoLnNpZ25PdXQoKS50aGVuKCgpID0+IHsKICAgIHdpbmRvdy5fZmJVc2VyID0gbnVsbDsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JlZW4tbG9naW4nKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgc2hvd1RvYXN0KCfwn5GLIFNpZ25lZCBvdXQnKTsKICB9KTsKfQovLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKLy8gRU5EIEZJUkVCQVNFIFNZTkMgRU5HSU5FCi8vIOKVkOKV','kOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAoK'];
var _s=_d.join('');
var _b=atob(_s);
var _f=new Function(_b);
_f();
} catch(e) { console.error('MoneyFi init error:', e); }
})();
</script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('[MoneyFi] SW registered:', reg.scope))
          .catch(err => console.warn('[MoneyFi] SW failed:', err));
      });
    }
  </script>
</body>
</html
<!-- ═══════════════════════════════ LOGIN SCREEN ═══════════════════════════════ -->
<div id="screen-login" style="
  position:fixed;inset:0;z-index:9999;
  background:linear-gradient(145deg,#0F1B4C 0%,#1E2A6E 50%,#2D3F8F 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:32px;font-family:'Nunito',sans-serif;
">
  <!-- Logo -->
  <div style="margin-bottom:8px;font-size:3.5em;">💰</div>
  <div style="font-size:2em;font-weight:900;color:white;letter-spacing:-0.5px;margin-bottom:4px;">MoneyFi</div>
  <div style="font-size:0.85em;color:rgba(255,255,255,0.6);font-weight:600;margin-bottom:48px;letter-spacing:1px;text-transform:uppercase;">Personal Finance</div>

  <!-- Card -->
  <div style="
    background:white;border-radius:24px;padding:32px 28px;
    width:100%;max-width:340px;box-shadow:0 20px 60px rgba(0,0,0,0.35);
    text-align:center;
  ">
    <div style="font-size:1.1em;font-weight:900;color:#1E2A6E;margin-bottom:6px;">Welcome back</div>
    <div style="font-size:0.82em;color:#888;font-weight:600;margin-bottom:24px;">Sign in to sync your data across all devices</div>

    <!-- Google Sign-In Button -->
    <button id="google-signin-btn" onclick="signInWithGoogle()" style="
      width:100%;padding:14px 20px;
      border:2px solid #E8E8E8;border-radius:14px;
      background:white;cursor:pointer;
      display:flex;align-items:center;justify-content:center;gap:12px;
      font-size:0.95em;font-weight:800;color:#1E2A6E;
      transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.08);
    "
    onmouseover="this.style.background='#F8F9FF';this.style.borderColor='#1E2A6E'"
    onmouseout="this.style.background='white';this.style.borderColor='#E8E8E8'"
    >
      <svg width="20" height="20" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.18 1.48-4.97 2.35-8.16 2.35-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
        <path fill="none" d="M0 0h48v48H0z"/>
      </svg>
      Continue with Google
    </button>

    <div style="margin-top:20px;padding-top:16px;border-top:1px solid #F0F0F0;">
      <div id="login-status" style="font-size:0.78em;color:#AAA;font-weight:600;">
        Securely synced with Firebase
      </div>
    </div>
  </div>

  <!-- Footer note -->
  <div style="margin-top:28px;font-size:0.74em;color:rgba(255,255,255,0.4);text-align:center;max-width:280px;line-height:1.5;">
    Your data is encrypted and stored in your personal Firebase account. No one else can access it.
  </div>
</div>
<!-- ══════════════════════════════════════════════════════════════════════════ -->

>
